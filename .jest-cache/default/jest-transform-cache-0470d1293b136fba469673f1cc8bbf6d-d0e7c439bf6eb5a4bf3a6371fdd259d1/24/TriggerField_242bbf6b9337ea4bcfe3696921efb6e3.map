{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components-pro/trigger-field/TriggerField.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { CSSProperties, ReactNode } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport PropTypes from 'prop-types';\nimport omit from 'lodash/omit';\nimport noop from 'lodash/noop';\nimport { action, computed, observable } from 'mobx';\nimport { PropTypes as MobxPropTypes } from 'mobx-react';\nimport Trigger from '../trigger/Trigger';\nimport { Action } from '../trigger/enum';\nimport { TextField, TextFieldProps } from '../text-field/TextField';\nimport autobind from '../_util/autobind';\nimport Icon from '../icon';\nimport TaskRunner from '../_util/TaskRunner';\n\nconst BUILT_IN_PLACEMENTS = {\n  bottomLeft: {\n    points: ['tl', 'bl'],\n    offset: [0, 4],\n    overflow: {\n      adjustX: 1,\n      adjustY: 1,\n    },\n  },\n  bottomRight: {\n    points: ['tr', 'br'],\n    offset: [0, 4],\n    overflow: {\n      adjustX: 1,\n      adjustY: 1,\n    },\n  },\n  topLeft: {\n    points: ['bl', 'tl'],\n    offset: [0, -4],\n    overflow: {\n      adjustX: 1,\n      adjustY: 1,\n    },\n  },\n  topRight: {\n    points: ['br', 'tr'],\n    offset: [0, -4],\n    overflow: {\n      adjustX: 1,\n      adjustY: 1,\n    },\n  },\n};\n\nexport interface TriggerFieldProps extends TextFieldProps {\n  /**\n   * 下拉框的自定义内容\n   */\n  popupContent?: ReactNode | ((props: any) => ReactNode);\n  /**\n   * 下拉框的自定义样式名\n   */\n  popupCls?: string;\n  /**\n   * 下拉框的内链样式\n   */\n  popupStyle?: CSSProperties;\n  /**\n   * 触发下拉框的方式组\n   * 可选值：click | focus | hover | contextMenu\n   */\n  trigger?: Action[];\n  /**\n   * 下拉框显示延迟\n   * @defualt 150\n   */\n  triggerShowDelay?: number;\n  /**\n   * 下拉框隐藏延迟\n   * @defualt 50\n   */\n  triggerHiddenDelay?: number;\n  /**\n   * 下拉框变化钩子\n   */\n  onPopupHiddenChange?: (hidden: boolean) => void;\n}\n\nexport default abstract class TriggerField<T extends TriggerFieldProps> extends TextField<\n  T & TriggerFieldProps\n> {\n  static displayName = 'TriggerField';\n\n  static propTypes = {\n    /**\n     * 下拉框的自定义内容\n     */\n    popupContent: PropTypes.element,\n    /**\n     * 下拉框的自定义样式名\n     */\n    popupCls: PropTypes.string,\n    /**\n     * 下拉框的内链样式\n     */\n    popupStyle: PropTypes.object,\n    /**\n     * 触发下拉框的方式\n     * 可选值：click | focus | hover | contextMenu\n     */\n    trigger: MobxPropTypes.arrayOrObservableArrayOf(PropTypes.string),\n    /**\n     * 下拉框显示延迟\n     * @defualt 150\n     */\n    triggerShowDelay: PropTypes.number,\n    /**\n     * 下拉框隐藏延迟\n     * @defualt 50\n     */\n    triggerHiddenDelay: PropTypes.number,\n    /**\n     * 下拉框变化钩子\n     */\n    onPopupHiddenChange: PropTypes.func,\n    ...TextField.propTypes,\n  };\n\n  static defaultProps = {\n    ...TextField.defaultProps,\n    suffixCls: 'trigger',\n    clearButton: true,\n    trigger: ['focus', 'click'],\n    triggerShowDelay: 150,\n    triggerHiddenDelay: 50,\n  };\n\n  popupTask: TaskRunner = new TaskRunner();\n\n  trigger: Trigger | null;\n\n  @observable statePopup: boolean;\n\n  @computed\n  get popup(): boolean {\n    return this.statePopup;\n  }\n\n  constructor(props, context) {\n    super(props, context);\n    this.setPopup(false);\n  }\n\n  isValidationMessageHidden(message?: ReactNode): undefined | boolean {\n    return super.isValidationMessageHidden(message) || this.popup;\n  }\n\n  @action\n  setPopup(statePopup: boolean) {\n    this.statePopup = statePopup;\n  }\n\n  abstract getTriggerIconFont(): string;\n\n  abstract handlePopupAnimateAppear(key): void;\n\n  abstract handlePopupAnimateEnd(key, exists): void;\n\n  abstract getPopupStyleFromAlign(target): CSSProperties | undefined;\n\n  abstract getPopupContent(): ReactNode;\n\n  @autobind\n  getRootDomNode() {\n    return findDOMNode(this);\n  }\n\n  getOtherProps() {\n    return omit(super.getOtherProps(), [\n      'popupContent',\n      'popupCls',\n      'editable',\n      'trigger',\n      'triggerShowDelay',\n      'triggerHiddenDelay',\n      'onPopupHiddenChange',\n    ]);\n  }\n\n  getPopupProps() {\n    return {};\n  }\n\n  getWrappedEditor() {\n    const {\n      prefixCls,\n      props: {\n        popupCls,\n        popupStyle,\n        popupContent,\n        hidden,\n        trigger,\n        triggerShowDelay,\n        triggerHiddenDelay,\n      },\n    } = this;\n    let content;\n    if (popupContent !== undefined) {\n      if (popupContent instanceof Function) {\n        content = popupContent(this.getPopupProps());\n      } else {\n        content = popupContent;\n      }\n    } else {\n      content = this.getPopupContent();\n    }\n    return (\n      <Trigger\n        ref={node => (this.trigger = node)}\n        action={this.isReadOnly() || this.isDisabled() ? [] : trigger}\n        focusDelay={triggerShowDelay}\n        blurDelay={triggerHiddenDelay}\n        mouseEnterDelay={triggerShowDelay}\n        mouseLeaveDelay={triggerHiddenDelay}\n        prefixCls={prefixCls}\n        popupCls={popupCls}\n        popupStyle={popupStyle}\n        popupContent={content}\n        popupPlacement=\"bottomLeft\"\n        popupHidden={hidden || !this.popup}\n        builtinPlacements={BUILT_IN_PLACEMENTS}\n        onPopupAnimateAppear={this.handlePopupAnimateAppear}\n        onPopupAnimateEnd={this.handlePopupAnimateEnd}\n        onPopupHiddenChange={this.handlePopupHiddenChange}\n        getPopupStyleFromAlign={this.getPopupStyleFromAlign}\n        getRootDomNode={this.getRootDomNode}\n      >\n        {this.getEditor()}\n      </Trigger>\n    );\n  }\n\n  getWrapperClassNames(...args): string {\n    const { prefixCls } = this;\n    return super.getWrapperClassNames(...args, {\n      [`${prefixCls}-expand`]: this.popup,\n      [`${prefixCls}-not-editable`]: !this.isDisabled() && !this.editable,\n    });\n  }\n\n  getDefaultSuffix(): ReactNode {\n    const { prefixCls } = this;\n    return <Icon type={this.getTriggerIconFont()} className={`${prefixCls}-trigger`} />;\n  }\n\n  @autobind\n  handleTagAnimateEnd() {\n    this.forcePopupAlign();\n  }\n\n  @autobind\n  handlePopupMouseDown(e) {\n    e.preventDefault();\n    const { onMouseDown = noop } = this.props;\n    onMouseDown(e);\n  }\n\n  @autobind\n  handlePopupHiddenChange(hidden: boolean) {\n    this.setPopup(!hidden);\n    const { onPopupHiddenChange = noop } = this.props;\n    onPopupHiddenChange(hidden);\n  }\n\n  forcePopupAlign() {\n    if (this.trigger) {\n      this.trigger.forcePopupAlign();\n    }\n  }\n\n  expand() {\n    this.popupTask.cancel();\n    if (!this.isReadOnly() && !this.popup) {\n      this.popupTask.delay(this.props.triggerShowDelay as number, () => {\n        this.setPopup(true);\n      });\n    }\n  }\n\n  collapse() {\n    this.popupTask.cancel();\n    if (!this.isReadOnly() && this.popup) {\n      this.popupTask.delay(this.props.triggerHiddenDelay as number, () => {\n        this.setPopup(false);\n      });\n    }\n  }\n}\n"]}