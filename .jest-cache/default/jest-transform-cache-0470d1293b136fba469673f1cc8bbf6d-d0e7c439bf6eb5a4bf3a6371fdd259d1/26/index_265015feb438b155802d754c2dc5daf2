fb8a7c50a11c58fdaaa16fec397ee462
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = require("react-dom");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _openAnimation = _interopRequireDefault(require("../_util/openAnimation"));

var _warning = _interopRequireDefault(require("../_util/warning"));

var _SubMenu = _interopRequireDefault(require("./SubMenu"));

var _MenuItem = _interopRequireDefault(require("./MenuItem"));

var _menu = _interopRequireWildcard(require("../rc-components/menu"));

var _configure = require("../configure");

var Menu =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Menu, _Component);

  function Menu(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Menu);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Menu).call(this, props));
    _this.inlineOpenKeys = [];

    _this.handleClick = function (e) {
      _this.handleOpenChange([]);

      var onClick = _this.props.onClick;

      if (onClick) {
        onClick(e);
      }
    };

    _this.handleOpenChange = function (openKeys) {
      _this.setOpenKeys(openKeys);

      var onOpenChange = _this.props.onOpenChange;

      if (onOpenChange) {
        onOpenChange(openKeys);
      }
    };

    (0, _warning["default"])(!('onOpen' in props || 'onClose' in props), '`onOpen` and `onClose` are removed, please use `onOpenChange` instead');
    (0, _warning["default"])(!('inlineCollapsed' in props && props.mode !== 'inline'), "`inlineCollapsed` should only be used when Menu's `mode` is inline.");
    var openKeys;

    if ('defaultOpenKeys' in props) {
      openKeys = props.defaultOpenKeys;
    } else if ('openKeys' in props) {
      openKeys = props.openKeys;
    }

    _this.state = {
      openKeys: openKeys || []
    };
    return _this;
  }

  (0, _createClass2["default"])(Menu, [{
    key: "getChildContext",
    value: function getChildContext() {
      var theme = this.props.theme;
      return {
        inlineCollapsed: this.getInlineCollapsed(),
        menuTheme: theme
      };
    }
  }, {
    key: "getPrefixCls",
    value: function getPrefixCls() {
      var prefixCls = this.props.prefixCls;
      return (0, _configure.getPrefixCls)('menu', prefixCls);
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps, nextContext) {
      var _this$props = this.props,
          mode = _this$props.mode,
          inlineCollapsed = _this$props.inlineCollapsed;

      if (mode === 'inline' && nextProps.mode !== 'inline') {
        this.switchModeFromInline = true;
      }

      if ('openKeys' in nextProps) {
        this.setState({
          openKeys: nextProps.openKeys
        });
        return;
      }

      var openKeys = this.state.openKeys;
      var siderCollapsed = this.context.siderCollapsed;

      if (nextProps.inlineCollapsed && !inlineCollapsed || nextContext.siderCollapsed && !siderCollapsed) {
        this.switchModeFromInline = !!openKeys.length && !!(0, _reactDom.findDOMNode)(this).querySelectorAll(".".concat(this.getPrefixCls(), "-submenu-open")).length;
        this.inlineOpenKeys = openKeys;
        this.setState({
          openKeys: []
        });
      }

      if (!nextProps.inlineCollapsed && inlineCollapsed || !nextContext.siderCollapsed && siderCollapsed) {
        this.setState({
          openKeys: this.inlineOpenKeys
        });
        this.inlineOpenKeys = [];
      }
    }
  }, {
    key: "setOpenKeys",
    value: function setOpenKeys(openKeys) {
      if (!('openKeys' in this.props)) {
        this.setState({
          openKeys: openKeys
        });
      }
    }
  }, {
    key: "getRealMenuMode",
    value: function getRealMenuMode() {
      var inlineCollapsed = this.getInlineCollapsed();

      if (this.switchModeFromInline && inlineCollapsed) {
        return 'inline';
      }

      var mode = this.props.mode;
      return inlineCollapsed ? 'vertical' : mode;
    }
  }, {
    key: "getInlineCollapsed",
    value: function getInlineCollapsed() {
      var inlineCollapsed = this.props.inlineCollapsed;
      var _this$context$siderCo = this.context.siderCollapsed,
          siderCollapsed = _this$context$siderCo === void 0 ? inlineCollapsed : _this$context$siderCo;
      return siderCollapsed;
    }
  }, {
    key: "getMenuOpenAnimation",
    value: function getMenuOpenAnimation(menuMode) {
      var _this2 = this;

      var _this$props2 = this.props,
          openAnimation = _this$props2.openAnimation,
          openTransitionName = _this$props2.openTransitionName;
      var menuOpenAnimation = openAnimation || openTransitionName;

      if (openAnimation === undefined && openTransitionName === undefined) {
        switch (menuMode) {
          case 'horizontal':
            menuOpenAnimation = 'slide-up';
            break;

          case 'vertical':
          case 'vertical-left':
          case 'vertical-right':
            // When mode switch from inline
            // submenu should hide without animation
            if (this.switchModeFromInline) {
              menuOpenAnimation = '';
              this.switchModeFromInline = false;
            } else {
              menuOpenAnimation = 'zoom-big';
            }

            break;

          case 'inline':
            menuOpenAnimation = (0, _objectSpread2["default"])({}, _openAnimation["default"], {
              leave: function leave(node, done) {
                return _openAnimation["default"].leave(node, function () {
                  // Make sure inline menu leave animation finished before mode is switched
                  _this2.switchModeFromInline = false;

                  _this2.setState({}); // when inlineCollapsed change false to true, all submenu will be unmounted,
                  // so that we don't need handle animation leaving.


                  if (_this2.getRealMenuMode() === 'vertical') {
                    return;
                  }

                  done();
                });
              }
            });
            break;

          default:
        }
      }

      return menuOpenAnimation;
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props3 = this.props,
          className = _this$props3.className,
          theme = _this$props3.theme;
      var openKeys = this.state.openKeys;
      var prefixCls = this.getPrefixCls();
      var menuMode = this.getRealMenuMode();
      var menuOpenAnimation = this.getMenuOpenAnimation(menuMode);
      var menuClassName = (0, _classnames["default"])(className, "".concat(prefixCls, "-").concat(theme), (0, _defineProperty2["default"])({}, "".concat(prefixCls, "-inline-collapsed"), this.getInlineCollapsed()));
      var menuProps = {
        openKeys: openKeys,
        onOpenChange: this.handleOpenChange,
        className: menuClassName,
        mode: menuMode
      };

      if (menuMode !== 'inline') {
        // closing vertical popup submenu after click it
        menuProps.onClick = this.handleClick;
        menuProps.openTransitionName = menuOpenAnimation;
      } else {
        menuProps.openAnimation = menuOpenAnimation;
      }

      var collapsedWidth = this.context.collapsedWidth;

      if (this.getInlineCollapsed() && (collapsedWidth === 0 || collapsedWidth === '0' || collapsedWidth === '0px')) {
        return null;
      }

      return _react["default"].createElement(_menu["default"], (0, _extends2["default"])({}, this.props, menuProps, {
        prefixCls: prefixCls
      }));
    }
  }]);
  return Menu;
}(_react.Component);

exports["default"] = Menu;
Menu.displayName = 'Menu';
Menu.Divider = _menu.Divider;
Menu.Item = _MenuItem["default"];
Menu.SubMenu = _SubMenu["default"];
Menu.ItemGroup = _menu.ItemGroup;
Menu.defaultProps = {
  className: '',
  theme: 'light',
  focusable: false
};
Menu.childContextTypes = {
  inlineCollapsed: _propTypes["default"].bool,
  menuTheme: _propTypes["default"].string
};
Menu.contextTypes = {
  siderCollapsed: _propTypes["default"].bool,
  collapsedWidth: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string])
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lbnUvaW5kZXguanN4Il0sIm5hbWVzIjpbIk1lbnUiLCJDb21wb25lbnQiLCJvbkNsaWNrIiwib25PcGVuQ2hhbmdlIiwicHJvcHMiLCJvcGVuS2V5cyIsInRoZW1lIiwiaW5saW5lQ29sbGFwc2VkIiwibWVudVRoZW1lIiwicHJlZml4Q2xzIiwibmV4dFByb3BzIiwibmV4dENvbnRleHQiLCJtb2RlIiwic2lkZXJDb2xsYXBzZWQiLCJpbmxpbmVPcGVuS2V5cyIsIm1lbnVNb2RlIiwib3BlbkFuaW1hdGlvbiIsIm9wZW5UcmFuc2l0aW9uTmFtZSIsIm1lbnVPcGVuQW5pbWF0aW9uIiwiYW5pbWF0aW9uIiwibGVhdmUiLCJkb25lIiwiY2xhc3NOYW1lIiwibWVudUNsYXNzTmFtZSIsIm1lbnVQcm9wcyIsImNvbGxhcHNlZFdpZHRoIiwiRGl2aWRlciIsIkl0ZW0iLCJTdWJNZW51IiwiSXRlbUdyb3VwIiwiZm9jdXNhYmxlIiwiUHJvcFR5cGVzIiwic3RyaW5nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLE1BQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFNBQUEsR0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBOztBQUNBLElBQUEsVUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsV0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsY0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLHdCQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFFBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxrQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxRQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxTQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxLQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsdUJBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsVUFBQSxHQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUE7O0lBQ3FCQSxJOzs7OztBQUNqQixXQUFBLElBQUEsQ0FBQSxLQUFBLEVBQW1CO0FBQUEsUUFBQSxLQUFBOztBQUFBLEtBQUEsR0FBQSxnQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBO0FBQ2YsSUFBQSxLQUFBLEdBQUEsQ0FBQSxHQUFBLDJCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLENBQUEsR0FBQSxnQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsQ0FBQSxDQUFBO0FBQ0EsSUFBQSxLQUFBLENBQUEsY0FBQSxHQUFBLEVBQUE7O0FBQ0EsSUFBQSxLQUFBLENBQUEsV0FBQSxHQUFtQixVQUFBLENBQUEsRUFBTztBQUN0QixNQUFBLEtBQUEsQ0FBQSxnQkFBQSxDQUFBLEVBQUE7O0FBRHNCLFVBRWRFLE9BRmMsR0FFRixLQUFBLENBRkUsS0FFRixDQUZFLE9BQUE7O0FBR3RCLFVBQUEsT0FBQSxFQUFhO0FBQ1RBLFFBQUFBLE9BQU8sQ0FBUEEsQ0FBTyxDQUFQQTtBQUNIO0FBTEwsS0FBQTs7QUFPQSxJQUFBLEtBQUEsQ0FBQSxnQkFBQSxHQUF3QixVQUFBLFFBQUEsRUFBYztBQUNsQyxNQUFBLEtBQUEsQ0FBQSxXQUFBLENBQUEsUUFBQTs7QUFEa0MsVUFFMUJDLFlBRjBCLEdBRVQsS0FBQSxDQUZTLEtBRVQsQ0FGUyxZQUFBOztBQUdsQyxVQUFBLFlBQUEsRUFBa0I7QUFDZEEsUUFBQUEsWUFBWSxDQUFaQSxRQUFZLENBQVpBO0FBQ0g7QUFMTCxLQUFBOztBQU9BLEtBQUEsR0FBQSxRQUFBLENBQUEsU0FBQSxDQUFBLEVBQVEsRUFBRSxZQUFBLEtBQUEsSUFBcUIsYUFBL0IsS0FBUSxDQUFSLEVBQUEsdUVBQUE7QUFDQSxLQUFBLEdBQUEsUUFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFRLEVBQUUscUJBQUEsS0FBQSxJQUE4QkMsS0FBSyxDQUFMQSxJQUFBQSxLQUF4QyxRQUFRLENBQVIsRUFBQSxxRUFBQTtBQUNBLFFBQUEsUUFBQTs7QUFDQSxRQUFJLHFCQUFKLEtBQUEsRUFBZ0M7QUFDNUJDLE1BQUFBLFFBQVEsR0FBR0QsS0FBSyxDQUFoQkMsZUFBQUE7QUFESixLQUFBLE1BR0ssSUFBSSxjQUFKLEtBQUEsRUFBeUI7QUFDMUJBLE1BQUFBLFFBQVEsR0FBR0QsS0FBSyxDQUFoQkMsUUFBQUE7QUFDSDs7QUFDRCxJQUFBLEtBQUEsQ0FBQSxLQUFBLEdBQWE7QUFDVEEsTUFBQUEsUUFBUSxFQUFFQSxRQUFRLElBQUk7QUFEYixLQUFiO0FBMUJlLFdBQUEsS0FBQTtBQTZCbEI7Ozs7c0NBQ2lCO0FBQUEsVUFDTkMsS0FETSxHQUNJLEtBREosS0FDSSxDQURKLEtBQUE7QUFFZCxhQUFPO0FBQ0hDLFFBQUFBLGVBQWUsRUFBRSxLQURkLGtCQUNjLEVBRGQ7QUFFSEMsUUFBQUEsU0FBUyxFQUFFRjtBQUZSLE9BQVA7QUFJSDs7O21DQUNjO0FBQUEsVUFDSEcsU0FERyxHQUNXLEtBRFgsS0FDVyxDQURYLFNBQUE7QUFFWCxhQUFPLENBQUEsR0FBQSxVQUFBLENBQUEsWUFBQSxFQUFBLE1BQUEsRUFBUCxTQUFPLENBQVA7QUFDSDs7OzhDQUN5QkMsUyxFQUFXQyxXLEVBQWE7QUFBQSxVQUFBLFdBQUEsR0FDWixLQURZLEtBQUE7QUFBQSxVQUN0Q0MsSUFEc0MsR0FBQSxXQUFBLENBQUEsSUFBQTtBQUFBLFVBQ2hDTCxlQURnQyxHQUFBLFdBQUEsQ0FBQSxlQUFBOztBQUU5QyxVQUFJSyxJQUFJLEtBQUpBLFFBQUFBLElBQXFCRixTQUFTLENBQVRBLElBQUFBLEtBQXpCLFFBQUEsRUFBc0Q7QUFDbEQsYUFBQSxvQkFBQSxHQUFBLElBQUE7QUFDSDs7QUFDRCxVQUFJLGNBQUosU0FBQSxFQUE2QjtBQUN6QixhQUFBLFFBQUEsQ0FBYztBQUFFTCxVQUFBQSxRQUFRLEVBQUVLLFNBQVMsQ0FBQ0w7QUFBdEIsU0FBZDtBQUNBO0FBQ0g7O0FBUjZDLFVBU3RDQSxRQVRzQyxHQVN6QixLQVR5QixLQVN6QixDQVR5QixRQUFBO0FBQUEsVUFVdENRLGNBVnNDLEdBVW5CLEtBVm1CLE9BVW5CLENBVm1CLGNBQUE7O0FBVzlDLFVBQUtILFNBQVMsQ0FBVEEsZUFBQUEsSUFBNkIsQ0FBOUIsZUFBQ0EsSUFDQUMsV0FBVyxDQUFYQSxjQUFBQSxJQUE4QixDQURuQyxjQUFBLEVBQ3FEO0FBQ2pELGFBQUEsb0JBQUEsR0FDSSxDQUFDLENBQUNOLFFBQVEsQ0FBVixNQUFBLElBQ0ksQ0FBQyxDQUFDLENBQUEsR0FBQSxTQUFBLENBQUEsV0FBQSxFQUFBLElBQUEsRUFBQSxnQkFBQSxDQUFBLElBQUEsTUFBQSxDQUF1QyxLQUF2QyxZQUF1QyxFQUF2QyxFQUFBLGVBQUEsQ0FBQSxFQUZWLE1BQUE7QUFHQSxhQUFBLGNBQUEsR0FBQSxRQUFBO0FBQ0EsYUFBQSxRQUFBLENBQWM7QUFBRUEsVUFBQUEsUUFBUSxFQUFFO0FBQVosU0FBZDtBQUNIOztBQUNELFVBQUssQ0FBQ0ssU0FBUyxDQUFWLGVBQUEsSUFBRCxlQUFDLElBQ0EsQ0FBQ0MsV0FBVyxDQUFaLGNBQUEsSUFETCxjQUFBLEVBQ3FEO0FBQ2pELGFBQUEsUUFBQSxDQUFjO0FBQUVOLFVBQUFBLFFBQVEsRUFBRSxLQUFLUztBQUFqQixTQUFkO0FBQ0EsYUFBQSxjQUFBLEdBQUEsRUFBQTtBQUNIO0FBQ0o7OztnQ0FDV1QsUSxFQUFVO0FBQ2xCLFVBQUksRUFBRSxjQUFjLEtBQXBCLEtBQUksQ0FBSixFQUFpQztBQUM3QixhQUFBLFFBQUEsQ0FBYztBQUFFQSxVQUFBQSxRQUFRLEVBQVJBO0FBQUYsU0FBZDtBQUNIO0FBQ0o7OztzQ0FDaUI7QUFDZCxVQUFNRSxlQUFlLEdBQUcsS0FBeEIsa0JBQXdCLEVBQXhCOztBQUNBLFVBQUksS0FBQSxvQkFBQSxJQUFKLGVBQUEsRUFBa0Q7QUFDOUMsZUFBQSxRQUFBO0FBQ0g7O0FBSmEsVUFLTkssSUFMTSxHQUtHLEtBTEgsS0FLRyxDQUxILElBQUE7QUFNZCxhQUFPTCxlQUFlLEdBQUEsVUFBQSxHQUF0QixJQUFBO0FBQ0g7Ozt5Q0FDb0I7QUFBQSxVQUNUQSxlQURTLEdBQ1csS0FEWCxLQUNXLENBRFgsZUFBQTtBQUFBLFVBQUEscUJBQUEsR0FFNEIsS0FGNUIsT0FFNEIsQ0FGNUIsY0FBQTtBQUFBLFVBRVRNLGNBRlMsR0FBQSxxQkFBQSxLQUFBLEtBQUEsQ0FBQSxHQUFBLGVBQUEsR0FBQSxxQkFBQTtBQUdqQixhQUFBLGNBQUE7QUFDSDs7O3lDQUNvQkUsUSxFQUFVO0FBQUEsVUFBQSxNQUFBLEdBQUEsSUFBQTs7QUFBQSxVQUFBLFlBQUEsR0FDbUIsS0FEbkIsS0FBQTtBQUFBLFVBQ25CQyxhQURtQixHQUFBLFlBQUEsQ0FBQSxhQUFBO0FBQUEsVUFDSkMsa0JBREksR0FBQSxZQUFBLENBQUEsa0JBQUE7QUFFM0IsVUFBSUMsaUJBQWlCLEdBQUdGLGFBQWEsSUFBckMsa0JBQUE7O0FBQ0EsVUFBSUEsYUFBYSxLQUFiQSxTQUFBQSxJQUErQkMsa0JBQWtCLEtBQXJELFNBQUEsRUFBcUU7QUFDakUsZ0JBQUEsUUFBQTtBQUNJLGVBQUEsWUFBQTtBQUNJQyxZQUFBQSxpQkFBaUIsR0FBakJBLFVBQUFBO0FBQ0E7O0FBQ0osZUFBQSxVQUFBO0FBQ0EsZUFBQSxlQUFBO0FBQ0EsZUFBQSxnQkFBQTtBQUNJO0FBQ0E7QUFDQSxnQkFBSSxLQUFKLG9CQUFBLEVBQStCO0FBQzNCQSxjQUFBQSxpQkFBaUIsR0FBakJBLEVBQUFBO0FBQ0EsbUJBQUEsb0JBQUEsR0FBQSxLQUFBO0FBRkosYUFBQSxNQUlLO0FBQ0RBLGNBQUFBLGlCQUFpQixHQUFqQkEsVUFBQUE7QUFDSDs7QUFDRDs7QUFDSixlQUFBLFFBQUE7QUFDSUEsWUFBQUEsaUJBQWlCLEdBQUEsQ0FBQSxHQUFBLGNBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxFQUFBLEVBQ1ZDLGNBQUFBLENBRFUsU0FDVkEsQ0FEVSxFQUFBO0FBRWJDLGNBQUFBLEtBQUssRUFBRSxTQUFBLEtBQUEsQ0FBQSxJQUFBLEVBQUEsSUFBQSxFQUFBO0FBQUEsdUJBQWdCLGNBQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxLQUFBLENBQUEsSUFBQSxFQUFzQixZQUFNO0FBQy9DO0FBQ0Esa0JBQUEsTUFBSSxDQUFKLG9CQUFBLEdBQUEsS0FBQTs7QUFDQSxrQkFBQSxNQUFJLENBQUosUUFBQSxDQUgrQyxFQUcvQyxFQUgrQyxDQUkvQztBQUNBOzs7QUFDQSxzQkFBSSxNQUFJLENBQUosZUFBQSxPQUFKLFVBQUEsRUFBMkM7QUFDdkM7QUFDSDs7QUFDREMsa0JBQUFBLElBQUk7QUFURCxpQkFBZ0IsQ0FBaEI7QUFBQTtBQUZNLGFBQUEsQ0FBakJIO0FBY0E7O0FBQ0o7QUFqQ0o7QUFtQ0g7O0FBQ0QsYUFBQSxpQkFBQTtBQUNIOzs7NkJBQ1E7QUFBQSxVQUFBLFlBQUEsR0FDd0IsS0FEeEIsS0FBQTtBQUFBLFVBQ0dJLFNBREgsR0FBQSxZQUFBLENBQUEsU0FBQTtBQUFBLFVBQ2NoQixLQURkLEdBQUEsWUFBQSxDQUFBLEtBQUE7QUFBQSxVQUVHRCxRQUZILEdBRWdCLEtBRmhCLEtBRWdCLENBRmhCLFFBQUE7QUFHTCxVQUFNSSxTQUFTLEdBQUcsS0FBbEIsWUFBa0IsRUFBbEI7QUFDQSxVQUFNTSxRQUFRLEdBQUcsS0FBakIsZUFBaUIsRUFBakI7QUFDQSxVQUFNRyxpQkFBaUIsR0FBRyxLQUFBLG9CQUFBLENBQTFCLFFBQTBCLENBQTFCO0FBQ0EsVUFBTUssYUFBYSxHQUFHLENBQUEsR0FBQSxXQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsU0FBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxHQUFBLEVBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxnQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQUEsbUJBQUEsQ0FBQSxFQUNpQixLQUR2QyxrQkFDdUMsRUFEakIsQ0FBQSxDQUF0QjtBQUdBLFVBQU1DLFNBQVMsR0FBRztBQUNkbkIsUUFBQUEsUUFBUSxFQURNLFFBQUE7QUFFZEYsUUFBQUEsWUFBWSxFQUFFLEtBRkEsZ0JBQUE7QUFHZG1CLFFBQUFBLFNBQVMsRUFISyxhQUFBO0FBSWRWLFFBQUFBLElBQUksRUFBRUc7QUFKUSxPQUFsQjs7QUFNQSxVQUFJQSxRQUFRLEtBQVosUUFBQSxFQUEyQjtBQUN2QjtBQUNBUyxRQUFBQSxTQUFTLENBQVRBLE9BQUFBLEdBQW9CLEtBQXBCQSxXQUFBQTtBQUNBQSxRQUFBQSxTQUFTLENBQVRBLGtCQUFBQSxHQUFBQSxpQkFBQUE7QUFISixPQUFBLE1BS0s7QUFDREEsUUFBQUEsU0FBUyxDQUFUQSxhQUFBQSxHQUFBQSxpQkFBQUE7QUFDSDs7QUF0QkksVUF1QkdDLGNBdkJILEdBdUJzQixLQXZCdEIsT0F1QnNCLENBdkJ0QixjQUFBOztBQXdCTCxVQUFJLEtBQUEsa0JBQUEsT0FDQ0EsY0FBYyxLQUFkQSxDQUFBQSxJQUF3QkEsY0FBYyxLQUF0Q0EsR0FBQUEsSUFBa0RBLGNBQWMsS0FEckUsS0FBSSxDQUFKLEVBQ2tGO0FBQzlFLGVBQUEsSUFBQTtBQUNIOztBQUNELGFBQU8sTUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLGFBQUEsQ0FBQyxLQUFBLENBQUQsU0FBQyxDQUFELEVBQUEsQ0FBQSxHQUFBLFNBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxFQUFBLEVBQVksS0FBWixLQUFBLEVBQUEsU0FBQSxFQUFBO0FBQXVDLFFBQUEsU0FBUyxFQUFFaEI7QUFBbEQsT0FBQSxDQUFBLENBQVA7QUFDSDs7O0VBNUo2QlIsTUFBQUEsQ0FBQUEsUzs7O0FBOEpsQ0QsSUFBSSxDQUFKQSxXQUFBQSxHQUFBQSxNQUFBQTtBQUNBQSxJQUFJLENBQUpBLE9BQUFBLEdBQWUwQixLQUFBQSxDQUFmMUIsT0FBQUE7QUFDQUEsSUFBSSxDQUFKQSxJQUFBQSxHQUFZMkIsU0FBQUEsQ0FBWjNCLFNBQVkyQixDQUFaM0I7QUFDQUEsSUFBSSxDQUFKQSxPQUFBQSxHQUFlNEIsUUFBQUEsQ0FBZjVCLFNBQWU0QixDQUFmNUI7QUFDQUEsSUFBSSxDQUFKQSxTQUFBQSxHQUFpQjZCLEtBQUFBLENBQWpCN0IsU0FBQUE7QUFDQUEsSUFBSSxDQUFKQSxZQUFBQSxHQUFvQjtBQUNoQnNCLEVBQUFBLFNBQVMsRUFETyxFQUFBO0FBRWhCaEIsRUFBQUEsS0FBSyxFQUZXLE9BQUE7QUFHaEJ3QixFQUFBQSxTQUFTLEVBQUU7QUFISyxDQUFwQjlCO0FBS0FBLElBQUksQ0FBSkEsaUJBQUFBLEdBQXlCO0FBQ3JCTyxFQUFBQSxlQUFlLEVBQUV3QixVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQURJLElBQUE7QUFFckJ2QixFQUFBQSxTQUFTLEVBQUV1QixVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUFVQztBQUZBLENBQXpCaEM7QUFJQUEsSUFBSSxDQUFKQSxZQUFBQSxHQUFvQjtBQUNoQmEsRUFBQUEsY0FBYyxFQUFFa0IsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FEQSxJQUFBO0FBRWhCTixFQUFBQSxjQUFjLEVBQUVNLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQUFBLFNBQUFBLENBQW9CLENBQUNBLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQUQsTUFBQSxFQUFtQkEsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBdkNBLE1BQW9CLENBQXBCQTtBQUZBLENBQXBCL0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgZmluZERPTU5vZGUgfSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IGFuaW1hdGlvbiBmcm9tICcuLi9fdXRpbC9vcGVuQW5pbWF0aW9uJztcbmltcG9ydCB3YXJuaW5nIGZyb20gJy4uL191dGlsL3dhcm5pbmcnO1xuaW1wb3J0IFN1Yk1lbnUgZnJvbSAnLi9TdWJNZW51JztcbmltcG9ydCBJdGVtIGZyb20gJy4vTWVudUl0ZW0nO1xuaW1wb3J0IFJjTWVudSwgeyBEaXZpZGVyLCBJdGVtR3JvdXAgfSBmcm9tICcuLi9yYy1jb21wb25lbnRzL21lbnUnO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lbnUgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5pbmxpbmVPcGVuS2V5cyA9IFtdO1xuICAgICAgICB0aGlzLmhhbmRsZUNsaWNrID0gKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlT3BlbkNoYW5nZShbXSk7XG4gICAgICAgICAgICBjb25zdCB7IG9uQ2xpY2sgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgICAgICBpZiAob25DbGljaykge1xuICAgICAgICAgICAgICAgIG9uQ2xpY2soZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlT3BlbkNoYW5nZSA9IChvcGVuS2V5cykgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRPcGVuS2V5cyhvcGVuS2V5cyk7XG4gICAgICAgICAgICBjb25zdCB7IG9uT3BlbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgICAgIGlmIChvbk9wZW5DaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICBvbk9wZW5DaGFuZ2Uob3BlbktleXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB3YXJuaW5nKCEoJ29uT3BlbicgaW4gcHJvcHMgfHwgJ29uQ2xvc2UnIGluIHByb3BzKSwgJ2Bvbk9wZW5gIGFuZCBgb25DbG9zZWAgYXJlIHJlbW92ZWQsIHBsZWFzZSB1c2UgYG9uT3BlbkNoYW5nZWAgaW5zdGVhZCcpO1xuICAgICAgICB3YXJuaW5nKCEoJ2lubGluZUNvbGxhcHNlZCcgaW4gcHJvcHMgJiYgcHJvcHMubW9kZSAhPT0gJ2lubGluZScpLCBcImBpbmxpbmVDb2xsYXBzZWRgIHNob3VsZCBvbmx5IGJlIHVzZWQgd2hlbiBNZW51J3MgYG1vZGVgIGlzIGlubGluZS5cIik7XG4gICAgICAgIGxldCBvcGVuS2V5cztcbiAgICAgICAgaWYgKCdkZWZhdWx0T3BlbktleXMnIGluIHByb3BzKSB7XG4gICAgICAgICAgICBvcGVuS2V5cyA9IHByb3BzLmRlZmF1bHRPcGVuS2V5cztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgnb3BlbktleXMnIGluIHByb3BzKSB7XG4gICAgICAgICAgICBvcGVuS2V5cyA9IHByb3BzLm9wZW5LZXlzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBvcGVuS2V5czogb3BlbktleXMgfHwgW10sXG4gICAgICAgIH07XG4gICAgfVxuICAgIGdldENoaWxkQ29udGV4dCgpIHtcbiAgICAgICAgY29uc3QgeyB0aGVtZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlubGluZUNvbGxhcHNlZDogdGhpcy5nZXRJbmxpbmVDb2xsYXBzZWQoKSxcbiAgICAgICAgICAgIG1lbnVUaGVtZTogdGhlbWUsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGdldFByZWZpeENscygpIHtcbiAgICAgICAgY29uc3QgeyBwcmVmaXhDbHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHJldHVybiBnZXRQcmVmaXhDbHMoJ21lbnUnLCBwcmVmaXhDbHMpO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcywgbmV4dENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgeyBtb2RlLCBpbmxpbmVDb2xsYXBzZWQgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChtb2RlID09PSAnaW5saW5lJyAmJiBuZXh0UHJvcHMubW9kZSAhPT0gJ2lubGluZScpIHtcbiAgICAgICAgICAgIHRoaXMuc3dpdGNoTW9kZUZyb21JbmxpbmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgnb3BlbktleXMnIGluIG5leHRQcm9wcykge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW5LZXlzOiBuZXh0UHJvcHMub3BlbktleXMgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBvcGVuS2V5cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBzaWRlckNvbGxhcHNlZCB9ID0gdGhpcy5jb250ZXh0O1xuICAgICAgICBpZiAoKG5leHRQcm9wcy5pbmxpbmVDb2xsYXBzZWQgJiYgIWlubGluZUNvbGxhcHNlZCkgfHxcbiAgICAgICAgICAgIChuZXh0Q29udGV4dC5zaWRlckNvbGxhcHNlZCAmJiAhc2lkZXJDb2xsYXBzZWQpKSB7XG4gICAgICAgICAgICB0aGlzLnN3aXRjaE1vZGVGcm9tSW5saW5lID1cbiAgICAgICAgICAgICAgICAhIW9wZW5LZXlzLmxlbmd0aCAmJlxuICAgICAgICAgICAgICAgICAgICAhIWZpbmRET01Ob2RlKHRoaXMpLnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke3RoaXMuZ2V0UHJlZml4Q2xzKCl9LXN1Ym1lbnUtb3BlbmApLmxlbmd0aDtcbiAgICAgICAgICAgIHRoaXMuaW5saW5lT3BlbktleXMgPSBvcGVuS2V5cztcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuS2V5czogW10gfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCghbmV4dFByb3BzLmlubGluZUNvbGxhcHNlZCAmJiBpbmxpbmVDb2xsYXBzZWQpIHx8XG4gICAgICAgICAgICAoIW5leHRDb250ZXh0LnNpZGVyQ29sbGFwc2VkICYmIHNpZGVyQ29sbGFwc2VkKSkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW5LZXlzOiB0aGlzLmlubGluZU9wZW5LZXlzIH0pO1xuICAgICAgICAgICAgdGhpcy5pbmxpbmVPcGVuS2V5cyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldE9wZW5LZXlzKG9wZW5LZXlzKSB7XG4gICAgICAgIGlmICghKCdvcGVuS2V5cycgaW4gdGhpcy5wcm9wcykpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuS2V5cyB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRSZWFsTWVudU1vZGUoKSB7XG4gICAgICAgIGNvbnN0IGlubGluZUNvbGxhcHNlZCA9IHRoaXMuZ2V0SW5saW5lQ29sbGFwc2VkKCk7XG4gICAgICAgIGlmICh0aGlzLnN3aXRjaE1vZGVGcm9tSW5saW5lICYmIGlubGluZUNvbGxhcHNlZCkge1xuICAgICAgICAgICAgcmV0dXJuICdpbmxpbmUnO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbW9kZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgcmV0dXJuIGlubGluZUNvbGxhcHNlZCA/ICd2ZXJ0aWNhbCcgOiBtb2RlO1xuICAgIH1cbiAgICBnZXRJbmxpbmVDb2xsYXBzZWQoKSB7XG4gICAgICAgIGNvbnN0IHsgaW5saW5lQ29sbGFwc2VkIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHNpZGVyQ29sbGFwc2VkID0gaW5saW5lQ29sbGFwc2VkIH0gPSB0aGlzLmNvbnRleHQ7XG4gICAgICAgIHJldHVybiBzaWRlckNvbGxhcHNlZDtcbiAgICB9XG4gICAgZ2V0TWVudU9wZW5BbmltYXRpb24obWVudU1vZGUpIHtcbiAgICAgICAgY29uc3QgeyBvcGVuQW5pbWF0aW9uLCBvcGVuVHJhbnNpdGlvbk5hbWUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGxldCBtZW51T3BlbkFuaW1hdGlvbiA9IG9wZW5BbmltYXRpb24gfHwgb3BlblRyYW5zaXRpb25OYW1lO1xuICAgICAgICBpZiAob3BlbkFuaW1hdGlvbiA9PT0gdW5kZWZpbmVkICYmIG9wZW5UcmFuc2l0aW9uTmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKG1lbnVNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnaG9yaXpvbnRhbCc6XG4gICAgICAgICAgICAgICAgICAgIG1lbnVPcGVuQW5pbWF0aW9uID0gJ3NsaWRlLXVwJztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAndmVydGljYWwnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ3ZlcnRpY2FsLWxlZnQnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ3ZlcnRpY2FsLXJpZ2h0JzpcbiAgICAgICAgICAgICAgICAgICAgLy8gV2hlbiBtb2RlIHN3aXRjaCBmcm9tIGlubGluZVxuICAgICAgICAgICAgICAgICAgICAvLyBzdWJtZW51IHNob3VsZCBoaWRlIHdpdGhvdXQgYW5pbWF0aW9uXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN3aXRjaE1vZGVGcm9tSW5saW5lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZW51T3BlbkFuaW1hdGlvbiA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hNb2RlRnJvbUlubGluZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVudU9wZW5BbmltYXRpb24gPSAnem9vbS1iaWcnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6XG4gICAgICAgICAgICAgICAgICAgIG1lbnVPcGVuQW5pbWF0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uYW5pbWF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVhdmU6IChub2RlLCBkb25lKSA9PiBhbmltYXRpb24ubGVhdmUobm9kZSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSBpbmxpbmUgbWVudSBsZWF2ZSBhbmltYXRpb24gZmluaXNoZWQgYmVmb3JlIG1vZGUgaXMgc3dpdGNoZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN3aXRjaE1vZGVGcm9tSW5saW5lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBpbmxpbmVDb2xsYXBzZWQgY2hhbmdlIGZhbHNlIHRvIHRydWUsIGFsbCBzdWJtZW51IHdpbGwgYmUgdW5tb3VudGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgZG9uJ3QgbmVlZCBoYW5kbGUgYW5pbWF0aW9uIGxlYXZpbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0UmVhbE1lbnVNb2RlKCkgPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWVudU9wZW5BbmltYXRpb247XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjbGFzc05hbWUsIHRoZW1lIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IG9wZW5LZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBwcmVmaXhDbHMgPSB0aGlzLmdldFByZWZpeENscygpO1xuICAgICAgICBjb25zdCBtZW51TW9kZSA9IHRoaXMuZ2V0UmVhbE1lbnVNb2RlKCk7XG4gICAgICAgIGNvbnN0IG1lbnVPcGVuQW5pbWF0aW9uID0gdGhpcy5nZXRNZW51T3BlbkFuaW1hdGlvbihtZW51TW9kZSk7XG4gICAgICAgIGNvbnN0IG1lbnVDbGFzc05hbWUgPSBjbGFzc05hbWVzKGNsYXNzTmFtZSwgYCR7cHJlZml4Q2xzfS0ke3RoZW1lfWAsIHtcbiAgICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LWlubGluZS1jb2xsYXBzZWRgXTogdGhpcy5nZXRJbmxpbmVDb2xsYXBzZWQoKSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG1lbnVQcm9wcyA9IHtcbiAgICAgICAgICAgIG9wZW5LZXlzLFxuICAgICAgICAgICAgb25PcGVuQ2hhbmdlOiB0aGlzLmhhbmRsZU9wZW5DaGFuZ2UsXG4gICAgICAgICAgICBjbGFzc05hbWU6IG1lbnVDbGFzc05hbWUsXG4gICAgICAgICAgICBtb2RlOiBtZW51TW9kZSxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG1lbnVNb2RlICE9PSAnaW5saW5lJykge1xuICAgICAgICAgICAgLy8gY2xvc2luZyB2ZXJ0aWNhbCBwb3B1cCBzdWJtZW51IGFmdGVyIGNsaWNrIGl0XG4gICAgICAgICAgICBtZW51UHJvcHMub25DbGljayA9IHRoaXMuaGFuZGxlQ2xpY2s7XG4gICAgICAgICAgICBtZW51UHJvcHMub3BlblRyYW5zaXRpb25OYW1lID0gbWVudU9wZW5BbmltYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtZW51UHJvcHMub3BlbkFuaW1hdGlvbiA9IG1lbnVPcGVuQW5pbWF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgY29sbGFwc2VkV2lkdGggfSA9IHRoaXMuY29udGV4dDtcbiAgICAgICAgaWYgKHRoaXMuZ2V0SW5saW5lQ29sbGFwc2VkKCkgJiZcbiAgICAgICAgICAgIChjb2xsYXBzZWRXaWR0aCA9PT0gMCB8fCBjb2xsYXBzZWRXaWR0aCA9PT0gJzAnIHx8IGNvbGxhcHNlZFdpZHRoID09PSAnMHB4JykpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8UmNNZW51IHsuLi50aGlzLnByb3BzfSB7Li4ubWVudVByb3BzfSBwcmVmaXhDbHM9e3ByZWZpeENsc30vPjtcbiAgICB9XG59XG5NZW51LmRpc3BsYXlOYW1lID0gJ01lbnUnO1xuTWVudS5EaXZpZGVyID0gRGl2aWRlcjtcbk1lbnUuSXRlbSA9IEl0ZW07XG5NZW51LlN1Yk1lbnUgPSBTdWJNZW51O1xuTWVudS5JdGVtR3JvdXAgPSBJdGVtR3JvdXA7XG5NZW51LmRlZmF1bHRQcm9wcyA9IHtcbiAgICBjbGFzc05hbWU6ICcnLFxuICAgIHRoZW1lOiAnbGlnaHQnLFxuICAgIGZvY3VzYWJsZTogZmFsc2UsXG59O1xuTWVudS5jaGlsZENvbnRleHRUeXBlcyA9IHtcbiAgICBpbmxpbmVDb2xsYXBzZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIG1lbnVUaGVtZTogUHJvcFR5cGVzLnN0cmluZyxcbn07XG5NZW51LmNvbnRleHRUeXBlcyA9IHtcbiAgICBzaWRlckNvbGxhcHNlZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgY29sbGFwc2VkV2lkdGg6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5udW1iZXIsIFByb3BUeXBlcy5zdHJpbmddKSxcbn07XG4iXX0=