a82472d0c5a356535b408f23339c9612
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = require("react-dom");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _toArray = _interopRequireDefault(require("../util/Children/toArray"));

var _menu = _interopRequireDefault(require("../menu"));

var _domScrollIntoView = _interopRequireDefault(require("dom-scroll-into-view"));

var _util = require("./util");

var _FilterInput = _interopRequireDefault(require("./FilterInput"));

var _LocaleReceiver = _interopRequireDefault(require("../../locale-provider/LocaleReceiver"));

var _default = _interopRequireDefault(require("../../locale-provider/default"));

var DropdownMenu =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(DropdownMenu, _Component);

  function DropdownMenu() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, DropdownMenu);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(DropdownMenu)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "scrollActiveItemToView", function () {
      // scroll into view
      var itemComponent = (0, _reactDom.findDOMNode)(_this.firstActiveItem);
      var props = _this.props;

      if (itemComponent) {
        var scrollIntoViewOpts = {
          onlyScrollIfNeeded: true
        };

        if ((!props.value || props.value.length === 0) && props.firstActiveValue) {
          scrollIntoViewOpts.alignWithTop = true;
        }

        (0, _domScrollIntoView["default"])(itemComponent, (0, _reactDom.findDOMNode)(_this.menuRef), scrollIntoViewOpts);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderCheckLabel", function (locale) {
      var _this$props = _this.props,
          prefixCls = _this$props.prefixCls,
          checkAll = _this$props.checkAll;
      return _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-select-all-none")
      }, _react["default"].createElement("span", {
        name: "check-all",
        onClick: checkAll
      }, locale.selectAll), _react["default"].createElement("span", {
        name: "check-none",
        onClick: checkAll
      }, locale.selectNone));
    });
    return _this;
  }

  (0, _createClass2["default"])(DropdownMenu, [{
    key: "componentWillMount",
    value: function componentWillMount() {
      this.lastInputValue = this.props.inputValue;
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.scrollActiveItemToView();
      this.lastVisible = this.props.visible;
    }
  }, {
    key: "shouldComponentUpdate",
    value: function shouldComponentUpdate(nextProps) {
      if (!nextProps.visible) {
        this.lastVisible = false;
      } // freeze when hide


      return nextProps.visible;
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var props = this.props;

      if (!prevProps.visible && props.visible) {
        this.scrollActiveItemToView();
      }

      this.lastVisible = props.visible;
      this.lastInputValue = props.inputValue;
    }
  }, {
    key: "renderMenu",
    value: function renderMenu() {
      var _this2 = this;

      var props = this.props;
      var menuItems = props.menuItems,
          value = props.value,
          defaultActiveFirstOption = props.defaultActiveFirstOption,
          prefixCls = props.prefixCls,
          multiple = props.multiple,
          onMenuSelect = props.onMenuSelect,
          inputValue = props.inputValue,
          firstActiveValue = props.firstActiveValue,
          backfillValue = props.backfillValue;

      if (menuItems && menuItems.length) {
        var menuProps = {};

        if (multiple) {
          menuProps.onDeselect = props.onMenuDeselect;
          menuProps.onSelect = onMenuSelect;
        } else {
          menuProps.onClick = onMenuSelect;
        }

        var selectedKeys = (0, _util.getSelectKeys)(menuItems, value);
        var activeKeyProps = {};
        var clonedMenuItems = menuItems;

        if (selectedKeys.length || firstActiveValue) {
          if (props.visible && !this.lastVisible) {
            activeKeyProps.activeKey = selectedKeys[0] || firstActiveValue;
          }

          var foundFirst = false; // set firstActiveItem via cloning menus
          // for scroll into view

          var clone = function clone(item) {
            if (!foundFirst && selectedKeys.indexOf(item.key) !== -1 || !foundFirst && !selectedKeys.length && firstActiveValue.indexOf(item.key) !== -1) {
              foundFirst = true;
              return (0, _react.cloneElement)(item, {
                ref: function ref(_ref) {
                  _this2.firstActiveItem = _ref;
                }
              });
            }

            return item;
          };

          clonedMenuItems = menuItems.map(function (item) {
            if (item.type.isMenuItemGroup) {
              var children = (0, _toArray["default"])(item.props.children).map(clone);
              return (0, _react.cloneElement)(item, {}, children);
            }

            return clone(item);
          });
        } // clear activeKey when inputValue change


        var lastValue = value && value[value.length - 1];

        if (inputValue !== this.lastInputValue && (!lastValue || lastValue !== backfillValue)) {
          activeKeyProps.activeKey = '';
        }

        return _react["default"].createElement(_menu["default"], (0, _extends2["default"])({
          ref: (0, _util.saveRef)(this, 'menuRef'),
          style: this.props.dropdownMenuStyle,
          defaultActiveFirst: defaultActiveFirstOption
        }, activeKeyProps, {
          multiple: multiple
        }, menuProps, {
          selectedKeys: selectedKeys,
          prefixCls: "".concat(prefixCls, "-menu")
        }), clonedMenuItems);
      }

      return null;
    }
  }, {
    key: "renderFilterInput",
    value: function renderFilterInput() {
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          filter = _this$props2.filter,
          placeholder = _this$props2.placeholder,
          onFilterChange = _this$props2.onFilterChange,
          filterValue = _this$props2.filterValue,
          onKeyDown = _this$props2.onKeyDown;
      var props = {
        filterValue: filterValue,
        prefixCls: prefixCls,
        placeholder: placeholder,
        onChange: onFilterChange,
        onKeyDown: onKeyDown
      };
      return filter ? _react["default"].createElement(_FilterInput["default"], (0, _extends2["default"])({}, props, {
        ref: (0, _util.saveRef)(this, 'filterRef')
      })) : null;
    }
  }, {
    key: "getFooter",
    value: function getFooter() {
      var _this$props3 = this.props,
          prefixCls = _this$props3.prefixCls,
          footer = _this$props3.footer;
      return footer ? _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-footer"),
        onMouseDown: _util.preventDefaultEvent
      }, footer) : null;
    }
  }, {
    key: "render",
    value: function render() {
      var renderMenu = this.renderMenu();
      var filterInput = this.renderFilterInput();
      var _this$props4 = this.props,
          multiple = _this$props4.multiple,
          menuItems = _this$props4.menuItems,
          checkAll = _this$props4.checkAll,
          onMouseDown = _this$props4.onMouseDown;
      var selectOpt = null;

      if (checkAll && multiple && menuItems.length && menuItems[0].key !== 'NOT_FOUND') {
        selectOpt = _react["default"].createElement(_LocaleReceiver["default"], {
          componentName: "Select",
          defaultLocale: _default["default"].Select
        }, this.renderCheckLabel);
      }

      return _react["default"].createElement("div", {
        onMouseDown: onMouseDown
      }, filterInput, selectOpt, _react["default"].createElement("div", {
        style: {
          overflow: 'auto'
        },
        onScroll: this.props.onPopupScroll,
        onFocus: this.props.onPopupFocus
      }, renderMenu), this.getFooter());
    }
  }]);
  return DropdownMenu;
}(_react.Component);

exports["default"] = DropdownMenu;
(0, _defineProperty2["default"])(DropdownMenu, "propTypes", {
  defaultActiveFirstOption: _propTypes["default"].bool,
  value: _propTypes["default"].any,
  dropdownMenuStyle: _propTypes["default"].object,
  multiple: _propTypes["default"].bool,
  onPopupFocus: _propTypes["default"].func,
  onPopupScroll: _propTypes["default"].func,
  onMenuDeSelect: _propTypes["default"].func,
  onMenuSelect: _propTypes["default"].func,
  onMouseDown: _propTypes["default"].func,
  prefixCls: _propTypes["default"].string,
  menuItems: _propTypes["default"].any,
  inputValue: _propTypes["default"].string,
  visible: _propTypes["default"].bool,
  filter: _propTypes["default"].bool,
  checkAll: _propTypes["default"].func,
  footer: _propTypes["default"].oneOfType([_propTypes["default"].node, _propTypes["default"].string]),
  onKeyDown: _propTypes["default"].func
});
(0, _defineProperty2["default"])(DropdownMenu, "defaultProps", {
  footer: null
});
DropdownMenu.displayName = 'DropdownMenu';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRyb3Bkb3duTWVudS5qc3giXSwibmFtZXMiOlsiRHJvcGRvd25NZW51IiwiaXRlbUNvbXBvbmVudCIsImZpcnN0QWN0aXZlSXRlbSIsInByb3BzIiwic2Nyb2xsSW50b1ZpZXdPcHRzIiwib25seVNjcm9sbElmTmVlZGVkIiwidmFsdWUiLCJsZW5ndGgiLCJmaXJzdEFjdGl2ZVZhbHVlIiwiYWxpZ25XaXRoVG9wIiwibWVudVJlZiIsImxvY2FsZSIsInByZWZpeENscyIsImNoZWNrQWxsIiwic2VsZWN0QWxsIiwic2VsZWN0Tm9uZSIsImxhc3RJbnB1dFZhbHVlIiwiaW5wdXRWYWx1ZSIsInNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXciLCJsYXN0VmlzaWJsZSIsInZpc2libGUiLCJuZXh0UHJvcHMiLCJwcmV2UHJvcHMiLCJtZW51SXRlbXMiLCJkZWZhdWx0QWN0aXZlRmlyc3RPcHRpb24iLCJtdWx0aXBsZSIsIm9uTWVudVNlbGVjdCIsImJhY2tmaWxsVmFsdWUiLCJtZW51UHJvcHMiLCJvbkRlc2VsZWN0Iiwib25NZW51RGVzZWxlY3QiLCJvblNlbGVjdCIsIm9uQ2xpY2siLCJzZWxlY3RlZEtleXMiLCJhY3RpdmVLZXlQcm9wcyIsImNsb25lZE1lbnVJdGVtcyIsImFjdGl2ZUtleSIsImZvdW5kRmlyc3QiLCJjbG9uZSIsIml0ZW0iLCJpbmRleE9mIiwia2V5IiwicmVmIiwibWFwIiwidHlwZSIsImlzTWVudUl0ZW1Hcm91cCIsImNoaWxkcmVuIiwibGFzdFZhbHVlIiwiZHJvcGRvd25NZW51U3R5bGUiLCJmaWx0ZXIiLCJwbGFjZWhvbGRlciIsIm9uRmlsdGVyQ2hhbmdlIiwiZmlsdGVyVmFsdWUiLCJvbktleURvd24iLCJvbkNoYW5nZSIsImZvb3RlciIsInByZXZlbnREZWZhdWx0RXZlbnQiLCJyZW5kZXJNZW51IiwiZmlsdGVySW5wdXQiLCJyZW5kZXJGaWx0ZXJJbnB1dCIsIm9uTW91c2VEb3duIiwic2VsZWN0T3B0IiwiZGVmYXVsdExvY2FsZSIsIlNlbGVjdCIsInJlbmRlckNoZWNrTGFiZWwiLCJvdmVyZmxvdyIsIm9uUG9wdXBTY3JvbGwiLCJvblBvcHVwRm9jdXMiLCJnZXRGb290ZXIiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJib29sIiwiYW55Iiwib2JqZWN0IiwiZnVuYyIsIm9uTWVudURlU2VsZWN0Iiwic3RyaW5nIiwib25lT2ZUeXBlIiwibm9kZSIsImRpc3BsYXlOYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7SUFFcUJBLFk7Ozs7Ozs7Ozs7Ozs7Ozs7OytHQXNETSxZQUFNO0FBQzdCO0FBQ0EsVUFBTUMsYUFBYSxHQUFHLDJCQUFZLE1BQUtDLGVBQWpCLENBQXRCO0FBQ0EsVUFBTUMsS0FBSyxHQUFHLE1BQUtBLEtBQW5COztBQUVBLFVBQUlGLGFBQUosRUFBbUI7QUFDakIsWUFBTUcsa0JBQWtCLEdBQUc7QUFDekJDLFVBQUFBLGtCQUFrQixFQUFFO0FBREssU0FBM0I7O0FBR0EsWUFDRSxDQUFDLENBQUNGLEtBQUssQ0FBQ0csS0FBUCxJQUFnQkgsS0FBSyxDQUFDRyxLQUFOLENBQVlDLE1BQVosS0FBdUIsQ0FBeEMsS0FDQUosS0FBSyxDQUFDSyxnQkFGUixFQUdFO0FBQ0FKLFVBQUFBLGtCQUFrQixDQUFDSyxZQUFuQixHQUFrQyxJQUFsQztBQUNEOztBQUVELDJDQUNFUixhQURGLEVBRUUsMkJBQVksTUFBS1MsT0FBakIsQ0FGRixFQUdFTixrQkFIRjtBQUtEO0FBQ0YsSzt5R0EwR2tCLFVBQUNPLE1BQUQsRUFBWTtBQUFBLHdCQUNHLE1BQUtSLEtBRFI7QUFBQSxVQUNyQlMsU0FEcUIsZUFDckJBLFNBRHFCO0FBQUEsVUFDVkMsUUFEVSxlQUNWQSxRQURVO0FBRTdCLGFBQ0U7QUFBSyxRQUFBLFNBQVMsWUFBS0QsU0FBTDtBQUFkLFNBQ0U7QUFBTSxRQUFBLElBQUksRUFBQyxX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Z0Usc0JBQVVFLEdBRkE7QUFHakJ4QixFQUFBQSxpQkFBaUIsRUFBRXNCLHNCQUFVRyxNQUhaO0FBSWpCaEQsRUFBQUEsUUFBUSxFQUFFNkMsc0JBQVVDLElBSkg7QUFLakJKLEVBQUFBLFlBQVksRUFBRUcsc0JBQVVJLElBTFA7QUFNakJSLEVBQUFBLGFBQWEsRUFBRUksc0JBQVVJLElBTlI7QUFPakJDLEVBQUFBLGNBQWMsRUFBRUwsc0JBQVVJLElBUFQ7QUFRakJoRCxFQUFBQSxZQUFZLEVBQUU0QyxzQkFBVUksSUFSUDtBQVNqQmQsRUFBQUEsV0FBVyxFQUFFVSxzQkFBVUksSUFUTjtBQVVqQjlELEVBQUFBLFNBQVMsRUFBRTBELHNCQUFVTSxNQVZKO0FBV2pCckQsRUFBQUEsU0FBUyxFQUFFK0Msc0JBQVVFLEdBWEo7QUFZakJ2RCxFQUFBQSxVQUFVLEVBQUVxRCxzQkFBVU0sTUFaTDtBQWFqQnhELEVBQUFBLE9BQU8sRUFBRWtELHNCQUFVQyxJQWJGO0FBY2pCdEIsRUFBQUEsTUFBTSxFQUFFcUIsc0JBQVVDLElBZEQ7QUFlakIxRCxFQUFBQSxRQUFRLEVBQUV5RCxzQkFBVUksSUFmSDtBQWdCakJuQixFQUFBQSxNQUFNLEVBQUVlLHNCQUFVTyxTQUFWLENBQW9CLENBQzFCUCxzQkFBVVEsSUFEZ0IsRUFFMUJSLHNCQUFVTSxNQUZnQixDQUFwQixDQWhCUztBQW9CakJ2QixFQUFBQSxTQUFTLEVBQUVpQixzQkFBVUk7QUFwQkosQztpQ0FEQTFFLFksa0JBd0JHO0FBQ3BCdUQsRUFBQUEsTUFBTSxFQUFFO0FBRFksQztBQXlNeEJ2RCxZQUFZLENBQUMrRSxXQUFiLEdBQTJCLGNBQTNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IGNsb25lRWxlbWVudCwgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgZmluZERPTU5vZGUgfSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB0b0FycmF5IGZyb20gJy4uL3V0aWwvQ2hpbGRyZW4vdG9BcnJheSc7XG5pbXBvcnQgTWVudSBmcm9tICcuLi9tZW51JztcbmltcG9ydCBzY3JvbGxJbnRvVmlldyBmcm9tICdkb20tc2Nyb2xsLWludG8tdmlldyc7XG5pbXBvcnQgeyBnZXRTZWxlY3RLZXlzLCBwcmV2ZW50RGVmYXVsdEV2ZW50LCBzYXZlUmVmIH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCBGaWx0ZXJJbnB1dCBmcm9tICcuL0ZpbHRlcklucHV0JztcbmltcG9ydCBMb2NhbGVSZWNlaXZlciBmcm9tICcuLi8uLi9sb2NhbGUtcHJvdmlkZXIvTG9jYWxlUmVjZWl2ZXInO1xuaW1wb3J0IGRlZmF1bHRMb2NhbGUgZnJvbSAnLi4vLi4vbG9jYWxlLXByb3ZpZGVyL2RlZmF1bHQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEcm9wZG93bk1lbnUgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGRlZmF1bHRBY3RpdmVGaXJzdE9wdGlvbjogUHJvcFR5cGVzLmJvb2wsXG4gICAgdmFsdWU6IFByb3BUeXBlcy5hbnksXG4gICAgZHJvcGRvd25NZW51U3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgbXVsdGlwbGU6IFByb3BUeXBlcy5ib29sLFxuICAgIG9uUG9wdXBGb2N1czogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Qb3B1cFNjcm9sbDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25NZW51RGVTZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uTWVudVNlbGVjdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Nb3VzZURvd246IFByb3BUeXBlcy5mdW5jLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBtZW51SXRlbXM6IFByb3BUeXBlcy5hbnksXG4gICAgaW5wdXRWYWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB2aXNpYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBmaWx0ZXI6IFByb3BUeXBlcy5ib29sLFxuICAgIGNoZWNrQWxsOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBmb290ZXI6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLm5vZGUsXG4gICAgICBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIF0pLFxuICAgIG9uS2V5RG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBmb290ZXI6IG51bGwsXG4gIH07XG5cbiAgY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgIHRoaXMubGFzdElucHV0VmFsdWUgPSB0aGlzLnByb3BzLmlucHV0VmFsdWU7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXcoKTtcbiAgICB0aGlzLmxhc3RWaXNpYmxlID0gdGhpcy5wcm9wcy52aXNpYmxlO1xuICB9XG5cbiAgc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5leHRQcm9wcykge1xuICAgIGlmICghbmV4dFByb3BzLnZpc2libGUpIHtcbiAgICAgIHRoaXMubGFzdFZpc2libGUgPSBmYWxzZTtcbiAgICB9XG4gICAgLy8gZnJlZXplIHdoZW4gaGlkZVxuICAgIHJldHVybiBuZXh0UHJvcHMudmlzaWJsZTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCFwcmV2UHJvcHMudmlzaWJsZSAmJiBwcm9wcy52aXNpYmxlKSB7XG4gICAgICB0aGlzLnNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXcoKTtcbiAgICB9XG4gICAgdGhpcy5sYXN0VmlzaWJsZSA9IHByb3BzLnZpc2libGU7XG4gICAgdGhpcy5sYXN0SW5wdXRWYWx1ZSA9IHByb3BzLmlucHV0VmFsdWU7XG4gIH1cblxuICBzY3JvbGxBY3RpdmVJdGVtVG9WaWV3ID0gKCkgPT4ge1xuICAgIC8vIHNjcm9sbCBpbnRvIHZpZXdcbiAgICBjb25zdCBpdGVtQ29tcG9uZW50ID0gZmluZERPTU5vZGUodGhpcy5maXJzdEFjdGl2ZUl0ZW0pO1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChpdGVtQ29tcG9uZW50KSB7XG4gICAgICBjb25zdCBzY3JvbGxJbnRvVmlld09wdHMgPSB7XG4gICAgICAgIG9ubHlTY3JvbGxJZk5lZWRlZDogdHJ1ZSxcbiAgICAgIH07XG4gICAgICBpZiAoXG4gICAgICAgICghcHJvcHMudmFsdWUgfHwgcHJvcHMudmFsdWUubGVuZ3RoID09PSAwKSAmJlxuICAgICAgICBwcm9wcy5maXJzdEFjdGl2ZVZhbHVlXG4gICAgICApIHtcbiAgICAgICAgc2Nyb2xsSW50b1ZpZXdPcHRzLmFsaWduV2l0aFRvcCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIHNjcm9sbEludG9WaWV3KFxuICAgICAgICBpdGVtQ29tcG9uZW50LFxuICAgICAgICBmaW5kRE9NTm9kZSh0aGlzLm1lbnVSZWYpLFxuICAgICAgICBzY3JvbGxJbnRvVmlld09wdHMsXG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICByZW5kZXJNZW51KCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7XG4gICAgICBtZW51SXRlbXMsXG4gICAgICB2YWx1ZSxcbiAgICAgIGRlZmF1bHRBY3RpdmVGaXJzdE9wdGlvbixcbiAgICAgIHByZWZpeENscyxcbiAgICAgIG11bHRpcGxlLFxuICAgICAgb25NZW51U2VsZWN0LFxuICAgICAgaW5wdXRWYWx1ZSxcbiAgICAgIGZpcnN0QWN0aXZlVmFsdWUsXG4gICAgICBiYWNrZmlsbFZhbHVlLFxuICAgIH0gPSBwcm9wcztcblxuICAgIGlmIChtZW51SXRlbXMgJiYgbWVudUl0ZW1zLmxlbmd0aCkge1xuICAgICAgY29uc3QgbWVudVByb3BzID0ge307XG4gICAgICBpZiAobXVsdGlwbGUpIHtcbiAgICAgICAgbWVudVByb3BzLm9uRGVzZWxlY3QgPSBwcm9wcy5vbk1lbnVEZXNlbGVjdDtcbiAgICAgICAgbWVudVByb3BzLm9uU2VsZWN0ID0gb25NZW51U2VsZWN0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWVudVByb3BzLm9uQ2xpY2sgPSBvbk1lbnVTZWxlY3Q7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNlbGVjdGVkS2V5cyA9IGdldFNlbGVjdEtleXMobWVudUl0ZW1zLCB2YWx1ZSk7XG4gICAgICBjb25zdCBhY3RpdmVLZXlQcm9wcyA9IHt9O1xuXG4gICAgICBsZXQgY2xvbmVkTWVudUl0ZW1zID0gbWVudUl0ZW1zO1xuICAgICAgaWYgKHNlbGVjdGVkS2V5cy5sZW5ndGggfHwgZmlyc3RBY3RpdmVWYWx1ZSkge1xuICAgICAgICBpZiAocHJvcHMudmlzaWJsZSAmJiAhdGhpcy5sYXN0VmlzaWJsZSkge1xuICAgICAgICAgIGFjdGl2ZUtleVByb3BzLmFjdGl2ZUtleSA9IHNlbGVjdGVkS2V5c1swXSB8fCBmaXJzdEFjdGl2ZVZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGxldCBmb3VuZEZpcnN0ID0gZmFsc2U7XG4gICAgICAgIC8vIHNldCBmaXJzdEFjdGl2ZUl0ZW0gdmlhIGNsb25pbmcgbWVudXNcbiAgICAgICAgLy8gZm9yIHNjcm9sbCBpbnRvIHZpZXdcbiAgICAgICAgY29uc3QgY2xvbmUgPSBpdGVtID0+IHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAoIWZvdW5kRmlyc3QgJiYgc2VsZWN0ZWRLZXlzLmluZGV4T2YoaXRlbS5rZXkpICE9PSAtMSkgfHxcbiAgICAgICAgICAgICghZm91bmRGaXJzdCAmJlxuICAgICAgICAgICAgICAhc2VsZWN0ZWRLZXlzLmxlbmd0aCAmJlxuICAgICAgICAgICAgICBmaXJzdEFjdGl2ZVZhbHVlLmluZGV4T2YoaXRlbS5rZXkpICE9PSAtMSlcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGZvdW5kRmlyc3QgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIGNsb25lRWxlbWVudChpdGVtLCB7XG4gICAgICAgICAgICAgIHJlZjogcmVmID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpcnN0QWN0aXZlSXRlbSA9IHJlZjtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgfTtcblxuICAgICAgICBjbG9uZWRNZW51SXRlbXMgPSBtZW51SXRlbXMubWFwKGl0ZW0gPT4ge1xuICAgICAgICAgIGlmIChpdGVtLnR5cGUuaXNNZW51SXRlbUdyb3VwKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRvQXJyYXkoaXRlbS5wcm9wcy5jaGlsZHJlbikubWFwKGNsb25lKTtcbiAgICAgICAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQoaXRlbSwge30sIGNoaWxkcmVuKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGNsb25lKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gY2xlYXIgYWN0aXZlS2V5IHdoZW4gaW5wdXRWYWx1ZSBjaGFuZ2VcbiAgICAgIGNvbnN0IGxhc3RWYWx1ZSA9IHZhbHVlICYmIHZhbHVlW3ZhbHVlLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKGlucHV0VmFsdWUgIT09IHRoaXMubGFzdElucHV0VmFsdWUgJiYgKCFsYXN0VmFsdWUgfHwgbGFzdFZhbHVlICE9PSBiYWNrZmlsbFZhbHVlKSkge1xuICAgICAgICBhY3RpdmVLZXlQcm9wcy5hY3RpdmVLZXkgPSAnJztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPE1lbnVcbiAgICAgICAgICByZWY9e3NhdmVSZWYodGhpcywgJ21lbnVSZWYnKX1cbiAgICAgICAgICBzdHlsZT17dGhpcy5wcm9wcy5kcm9wZG93bk1lbnVTdHlsZX1cbiAgICAgICAgICBkZWZhdWx0QWN0aXZlRmlyc3Q9e2RlZmF1bHRBY3RpdmVGaXJzdE9wdGlvbn1cbiAgICAgICAgICB7Li4uYWN0aXZlS2V5UHJvcHN9XG4gICAgICAgICAgbXVsdGlwbGU9e211bHRpcGxlfVxuICAgICAgICAgIHsuLi5tZW51UHJvcHN9XG4gICAgICAgICAgc2VsZWN0ZWRLZXlzPXtzZWxlY3RlZEtleXN9XG4gICAgICAgICAgcHJlZml4Q2xzPXtgJHtwcmVmaXhDbHN9LW1lbnVgfVxuICAgICAgICA+XG4gICAgICAgICAge2Nsb25lZE1lbnVJdGVtc31cbiAgICAgICAgPC9NZW51PlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZW5kZXJGaWx0ZXJJbnB1dCgpIHtcbiAgICBjb25zdCB7IHByZWZpeENscywgZmlsdGVyLCBwbGFjZWhvbGRlciwgb25GaWx0ZXJDaGFuZ2UsIGZpbHRlclZhbHVlLCBvbktleURvd24gfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcHJvcHMgPSB7XG4gICAgICBmaWx0ZXJWYWx1ZSxcbiAgICAgIHByZWZpeENscyxcbiAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgb25DaGFuZ2U6IG9uRmlsdGVyQ2hhbmdlLFxuICAgICAgb25LZXlEb3duOiBvbktleURvd24sXG4gICAgfTtcbiAgICByZXR1cm4gZmlsdGVyID8gPEZpbHRlcklucHV0IHsuLi5wcm9wc30gcmVmPXtzYXZlUmVmKHRoaXMsICdmaWx0ZXJSZWYnKX0gLz4gOiBudWxsO1xuICB9XG5cbiAgZ2V0Rm9vdGVyKCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBmb290ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgcmV0dXJuIGZvb3RlciA/IChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWZvb3RlcmB9IG9uTW91c2VEb3duPXtwcmV2ZW50RGVmYXVsdEV2ZW50fT5cbiAgICAgICAge2Zvb3Rlcn1cbiAgICAgIDwvZGl2PikgOiBudWxsO1xuICB9XG5cbiAgcmVuZGVyQ2hlY2tMYWJlbCA9IChsb2NhbGUpID0+IHtcbiAgICBjb25zdCB7IHByZWZpeENscywgY2hlY2tBbGwgfSA9IHRoaXMucHJvcHM7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXNlbGVjdC1hbGwtbm9uZWB9PlxuICAgICAgICA8c3BhbiBuYW1lPVwiY2hlY2stYWxsXCIgb25DbGljaz17Y2hlY2tBbGx9Pntsb2NhbGUuc2VsZWN0QWxsfTwvc3Bhbj5cbiAgICAgICAgPHNwYW4gbmFtZT1cImNoZWNrLW5vbmVcIiBvbkNsaWNrPXtjaGVja0FsbH0+e2xvY2FsZS5zZWxlY3ROb25lfTwvc3Bhbj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHJlbmRlck1lbnUgPSB0aGlzLnJlbmRlck1lbnUoKTtcbiAgICBjb25zdCBmaWx0ZXJJbnB1dCA9IHRoaXMucmVuZGVyRmlsdGVySW5wdXQoKTtcbiAgICBjb25zdCB7IG11bHRpcGxlLCBtZW51SXRlbXMsIGNoZWNrQWxsLCBvbk1vdXNlRG93biB9ID0gdGhpcy5wcm9wcztcblxuICAgIGxldCBzZWxlY3RPcHQgPSBudWxsO1xuICAgIGlmIChjaGVja0FsbCAmJiBtdWx0aXBsZSAmJiBtZW51SXRlbXMubGVuZ3RoICYmIG1lbnVJdGVtc1swXS5rZXkgIT09ICdOT1RfRk9VTkQnKSB7XG4gICAgICBzZWxlY3RPcHQgPSAoXG4gICAgICAgIDxMb2NhbGVSZWNlaXZlclxuICAgICAgICAgIGNvbXBvbmVudE5hbWU9XCJTZWxlY3RcIlxuICAgICAgICAgIGRlZmF1bHRMb2NhbGU9e2RlZmF1bHRMb2NhbGUuU2VsZWN0fVxuICAgICAgICA+XG4gICAgICAgICAge3RoaXMucmVuZGVyQ2hlY2tMYWJlbH1cbiAgICAgICAgPC9Mb2NhbGVSZWNlaXZlcj5cbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IG9uTW91c2VEb3duPXtvbk1vdXNlRG93bn0+XG4gICAgICAgIHtmaWx0ZXJJbnB1dH1cbiAgICAgICAge3NlbGVjdE9wdH1cbiAgICAgICAgPGRpdlxuICAgICAgICAgIHN0eWxlPXt7IG92ZXJmbG93OiAnYXV0bycgfX1cbiAgICAgICAgICBvblNjcm9sbD17dGhpcy5wcm9wcy5vblBvcHVwU2Nyb2xsfVxuICAgICAgICAgIG9uRm9jdXM9e3RoaXMucHJvcHMub25Qb3B1cEZvY3VzfVxuICAgICAgICA+XG4gICAgICAgICAge3JlbmRlck1lbnV9XG4gICAgICAgIDwvZGl2PlxuICAgICAgICB7dGhpcy5nZXRGb290ZXIoKX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuRHJvcGRvd25NZW51LmRpc3BsYXlOYW1lID0gJ0Ryb3Bkb3duTWVudSc7XG4iXX0=