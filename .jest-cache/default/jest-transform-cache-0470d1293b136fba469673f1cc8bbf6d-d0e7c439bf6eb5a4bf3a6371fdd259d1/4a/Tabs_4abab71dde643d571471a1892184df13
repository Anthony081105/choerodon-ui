90de01817e5d05681381321045144ab6
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _classnames2 = _interopRequireDefault(require("classnames"));

var _KeyCode = _interopRequireDefault(require("./KeyCode"));

var _TabPane = _interopRequireDefault(require("./TabPane"));

var _utils = require("./utils");

function getDefaultActiveKey(props) {
  var activeKey;

  _react.Children.forEach(props.children, function (child, index) {
    if (child && !activeKey && !child.props.disabled) {
      activeKey = (0, _utils.generateKey)(child.key, index);
    }
  });

  return activeKey;
}

function activeKeyIsValid(props, key) {
  var keys = _react.Children.map(props.children, function (child, index) {
    return child && (0, _utils.generateKey)(child.key, index);
  });

  return keys.indexOf(key) >= 0;
}

var Tabs =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Tabs, _Component);

  function Tabs(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Tabs);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Tabs).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onTabClick", function (activeKey) {
      if (_this.tabBar.props.onTabClick) {
        _this.tabBar.props.onTabClick(activeKey);
      }

      _this.setActiveKey(activeKey);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onNavKeyDown", function (e) {
      var eventKeyCode = e.keyCode;

      if (eventKeyCode === _KeyCode["default"].RIGHT || eventKeyCode === _KeyCode["default"].DOWN) {
        e.preventDefault();

        var nextKey = _this.getNextActiveKey(true);

        _this.onTabClick(nextKey);
      } else if (eventKeyCode === _KeyCode["default"].LEFT || eventKeyCode === _KeyCode["default"].UP) {
        e.preventDefault();

        var previousKey = _this.getNextActiveKey(false);

        _this.onTabClick(previousKey);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setActiveKey", function (activeKey) {
      if (_this.state.activeKey !== activeKey) {
        if (!('activeKey' in _this.props)) {
          _this.setState({
            activeKey: activeKey
          });
        }

        _this.props.onChange(activeKey);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getNextActiveKey", function (next) {
      var activeKey = _this.state.activeKey;
      var children = [];

      _react.Children.forEach(_this.props.children, function (c) {
        if (c && !c.props.disabled) {
          if (next) {
            children.push(c);
          } else {
            children.unshift(c);
          }
        }
      });

      var length = children.length;
      var ret = length && (0, _utils.generateKey)(children[0].key, 0);
      children.forEach(function (child, i) {
        if ((0, _utils.generateKey)(child.key, i) === activeKey) {
          if (i === length - 1) {
            ret = (0, _utils.generateKey)(children[0].key, 0);
          } else {
            ret = (0, _utils.generateKey)(children[i + 1].key, i + 1);
          }
        }
      });
      return ret;
    });

    var _activeKey;

    if ('activeKey' in props) {
      _activeKey = props.activeKey;
    } else if ('defaultActiveKey' in props) {
      _activeKey = props.defaultActiveKey;
    } else {
      _activeKey = getDefaultActiveKey(props);
    }

    _this.state = {
      activeKey: _activeKey
    };
    return _this;
  }

  (0, _createClass2["default"])(Tabs, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('activeKey' in nextProps) {
        this.setState({
          activeKey: nextProps.activeKey
        });
      } else if (!activeKeyIsValid(nextProps, this.state.activeKey)) {
        this.setState({
          activeKey: getDefaultActiveKey(nextProps)
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _classnames;

      var props = this.props;
      var prefixCls = props.prefixCls,
          tabBarPosition = props.tabBarPosition,
          className = props.className,
          renderTabContent = props.renderTabContent,
          renderTabBar = props.renderTabBar,
          destroyInactiveTabPane = props.destroyInactiveTabPane,
          restProps = (0, _objectWithoutProperties2["default"])(props, ["prefixCls", "tabBarPosition", "className", "renderTabContent", "renderTabBar", "destroyInactiveTabPane"]);
      var cls = (0, _classnames2["default"])((_classnames = {}, (0, _defineProperty2["default"])(_classnames, prefixCls, 1), (0, _defineProperty2["default"])(_classnames, "".concat(prefixCls, "-").concat(tabBarPosition), 1), (0, _defineProperty2["default"])(_classnames, className, !!className), _classnames));
      this.tabBar = renderTabBar();
      var contents = [(0, _react.cloneElement)(this.tabBar, {
        prefixCls: prefixCls,
        key: 'tabBar',
        onKeyDown: this.onNavKeyDown,
        tabBarPosition: tabBarPosition,
        onTabClick: this.onTabClick,
        panels: props.children,
        activeKey: this.state.activeKey
      }), (0, _react.cloneElement)(renderTabContent(), {
        prefixCls: prefixCls,
        tabBarPosition: tabBarPosition,
        activeKey: this.state.activeKey,
        destroyInactiveTabPane: destroyInactiveTabPane,
        children: props.children,
        onChange: this.setActiveKey,
        key: 'tabContent'
      })];

      if (tabBarPosition === 'bottom') {
        contents.reverse();
      }

      return _react["default"].createElement("div", (0, _extends2["default"])({
        className: cls,
        style: props.style
      }, (0, _utils.getDataAttr)(restProps)), contents);
    }
  }]);
  return Tabs;
}(_react.Component);

exports["default"] = Tabs;
(0, _defineProperty2["default"])(Tabs, "propTypes", {
  destroyInactiveTabPane: _propTypes["default"].bool,
  renderTabBar: _propTypes["default"].func.isRequired,
  renderTabContent: _propTypes["default"].func.isRequired,
  onChange: _propTypes["default"].func,
  children: _propTypes["default"].any,
  prefixCls: _propTypes["default"].string,
  className: _propTypes["default"].string,
  tabBarPosition: _propTypes["default"].string,
  style: _propTypes["default"].object,
  activeKey: _propTypes["default"].string,
  defaultActiveKey: _propTypes["default"].string
});
(0, _defineProperty2["default"])(Tabs, "defaultProps", {
  prefixCls: 'rc-tabs',
  destroyInactiveTabPane: false,
  onChange: _noop["default"],
  tabBarPosition: 'top',
  style: {}
});
(0, _defineProperty2["default"])(Tabs, "TabPane", _TabPane["default"]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhYnMvVGFicy5qc3giXSwibmFtZXMiOlsiQ2hpbGRyZW4iLCJwcm9wcyIsImNoaWxkIiwiYWN0aXZlS2V5Iiwia2V5cyIsIlRhYnMiLCJDb21wb25lbnQiLCJkZXN0cm95SW5hY3RpdmVUYWJQYW5lIiwiUHJvcFR5cGVzIiwicmVuZGVyVGFiQmFyIiwicmVuZGVyVGFiQ29udGVudCIsIm9uQ2hhbmdlIiwiY2hpbGRyZW4iLCJwcmVmaXhDbHMiLCJjbGFzc05hbWUiLCJ0YWJCYXJQb3NpdGlvbiIsInN0eWxlIiwiZGVmYXVsdEFjdGl2ZUtleSIsInN0cmluZyIsIm5vb3AiLCJUYWJQYW5lIiwiZ2V0RGVmYXVsdEFjdGl2ZUtleSIsIm5leHRQcm9wcyIsImFjdGl2ZUtleUlzVmFsaWQiLCJldmVudEtleUNvZGUiLCJlIiwiS2V5Q29kZSIsIm5leHRLZXkiLCJwcmV2aW91c0tleSIsImMiLCJsZW5ndGgiLCJyZXQiLCJpIiwicmVzdFByb3BzIiwiY2xzIiwiY29udGVudHMiLCJrZXkiLCJvbktleURvd24iLCJvblRhYkNsaWNrIiwicGFuZWxzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsVUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsS0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsWUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsTUFBQSxH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Q0FBQUEsU0FBQUEsQ0FBQUEsQ0FUVSxNQUFBO0FBVWpCTCxFQUFBQSxTQUFTLEVBQUVLLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBVk0sTUFBQTtBQVdqQlMsRUFBQUEsZ0JBQWdCLEVBQUVULFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQVVVO0FBWFgsQztpQ0FEQWIsSSxrQkFlRztBQUNwQlEsRUFBQUEsU0FBUyxFQURXLFNBQUE7QUFFcEJOLEVBQUFBLHNCQUFzQixFQUZGLEtBQUE7QUFHcEJJLEVBQUFBLFFBQVEsRUFBRVEsS0FBQUEsQ0FIVSxTQUdWQSxDQUhVO0FBSXBCSixFQUFBQSxjQUFjLEVBSk0sS0FBQTtBQUtwQkMsRUFBQUEsS0FBSyxFQUFFO0FBTGEsQztpQ0FmSFgsSSxhQXVCRmUsUUFBQUEsQ0FBQUEsU0FBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDaGlsZHJlbiwgY2xvbmVFbGVtZW50LCBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IG5vb3AgZnJvbSAnbG9kYXNoL25vb3AnO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgS2V5Q29kZSBmcm9tICcuL0tleUNvZGUnO1xuaW1wb3J0IFRhYlBhbmUgZnJvbSAnLi9UYWJQYW5lJztcbmltcG9ydCB7IGdlbmVyYXRlS2V5LCBnZXREYXRhQXR0ciB9IGZyb20gJy4vdXRpbHMnO1xuXG5mdW5jdGlvbiBnZXREZWZhdWx0QWN0aXZlS2V5KHByb3BzKSB7XG4gIGxldCBhY3RpdmVLZXk7XG4gIENoaWxkcmVuLmZvckVhY2gocHJvcHMuY2hpbGRyZW4sIChjaGlsZCwgaW5kZXgpID0+IHtcbiAgICBpZiAoY2hpbGQgJiYgIWFjdGl2ZUtleSAmJiAhY2hpbGQucHJvcHMuZGlzYWJsZWQpIHtcbiAgICAgIGFjdGl2ZUtleSA9IGdlbmVyYXRlS2V5KGNoaWxkLmtleSwgaW5kZXgpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBhY3RpdmVLZXk7XG59XG5cbmZ1bmN0aW9uIGFjdGl2ZUtleUlzVmFsaWQocHJvcHMsIGtleSkge1xuICBjb25zdCBrZXlzID0gQ2hpbGRyZW4ubWFwKFxuICAgIHByb3BzLmNoaWxkcmVuLFxuICAgIChjaGlsZCwgaW5kZXgpID0+IGNoaWxkICYmIGdlbmVyYXRlS2V5KGNoaWxkLmtleSwgaW5kZXgpLFxuICApO1xuICByZXR1cm4ga2V5cy5pbmRleE9mKGtleSkgPj0gMDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGFicyBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZGVzdHJveUluYWN0aXZlVGFiUGFuZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgcmVuZGVyVGFiQmFyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHJlbmRlclRhYkNvbnRlbnQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55LFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGFiQmFyUG9zaXRpb246IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgYWN0aXZlS2V5OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGRlZmF1bHRBY3RpdmVLZXk6IFByb3BUeXBlcy5zdHJpbmcsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBwcmVmaXhDbHM6ICdyYy10YWJzJyxcbiAgICBkZXN0cm95SW5hY3RpdmVUYWJQYW5lOiBmYWxzZSxcbiAgICBvbkNoYW5nZTogbm9vcCxcbiAgICB0YWJCYXJQb3NpdGlvbjogJ3RvcCcsXG4gICAgc3R5bGU6IHt9LFxuICB9O1xuXG4gIHN0YXRpYyBUYWJQYW5lID0gVGFiUGFuZTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIGxldCBhY3RpdmVLZXk7XG4gICAgaWYgKCdhY3RpdmVLZXknIGluIHByb3BzKSB7XG4gICAgICBhY3RpdmVLZXkgPSBwcm9wcy5hY3RpdmVLZXk7XG4gICAgfSBlbHNlIGlmICgnZGVmYXVsdEFjdGl2ZUtleScgaW4gcHJvcHMpIHtcbiAgICAgIGFjdGl2ZUtleSA9IHByb3BzLmRlZmF1bHRBY3RpdmVLZXk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjdGl2ZUtleSA9IGdldERlZmF1bHRBY3RpdmVLZXkocHJvcHMpO1xuICAgIH1cblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBhY3RpdmVLZXksXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKCdhY3RpdmVLZXknIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGFjdGl2ZUtleTogbmV4dFByb3BzLmFjdGl2ZUtleSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoIWFjdGl2ZUtleUlzVmFsaWQobmV4dFByb3BzLCB0aGlzLnN0YXRlLmFjdGl2ZUtleSkpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBhY3RpdmVLZXk6IGdldERlZmF1bHRBY3RpdmVLZXkobmV4dFByb3BzKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9uVGFiQ2xpY2sgPSBhY3RpdmVLZXkgPT4ge1xuICAgIGlmICh0aGlzLnRhYkJhci5wcm9wcy5vblRhYkNsaWNrKSB7XG4gICAgICB0aGlzLnRhYkJhci5wcm9wcy5vblRhYkNsaWNrKGFjdGl2ZUtleSk7XG4gICAgfVxuICAgIHRoaXMuc2V0QWN0aXZlS2V5KGFjdGl2ZUtleSk7XG4gIH07XG5cbiAgb25OYXZLZXlEb3duID0gZSA9PiB7XG4gICAgY29uc3QgZXZlbnRLZXlDb2RlID0gZS5rZXlDb2RlO1xuICAgIGlmIChldmVudEtleUNvZGUgPT09IEtleUNvZGUuUklHSFQgfHwgZXZlbnRLZXlDb2RlID09PSBLZXlDb2RlLkRPV04pIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IG5leHRLZXkgPSB0aGlzLmdldE5leHRBY3RpdmVLZXkodHJ1ZSk7XG4gICAgICB0aGlzLm9uVGFiQ2xpY2sobmV4dEtleSk7XG4gICAgfSBlbHNlIGlmIChldmVudEtleUNvZGUgPT09IEtleUNvZGUuTEVGVCB8fCBldmVudEtleUNvZGUgPT09IEtleUNvZGUuVVApIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHByZXZpb3VzS2V5ID0gdGhpcy5nZXROZXh0QWN0aXZlS2V5KGZhbHNlKTtcbiAgICAgIHRoaXMub25UYWJDbGljayhwcmV2aW91c0tleSk7XG4gICAgfVxuICB9O1xuXG4gIHNldEFjdGl2ZUtleSA9IGFjdGl2ZUtleSA9PiB7XG4gICAgaWYgKHRoaXMuc3RhdGUuYWN0aXZlS2V5ICE9PSBhY3RpdmVLZXkpIHtcbiAgICAgIGlmICghKCdhY3RpdmVLZXknIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGFjdGl2ZUtleSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKGFjdGl2ZUtleSk7XG4gICAgfVxuICB9O1xuXG4gIGdldE5leHRBY3RpdmVLZXkgPSBuZXh0ID0+IHtcbiAgICBjb25zdCBhY3RpdmVLZXkgPSB0aGlzLnN0YXRlLmFjdGl2ZUtleTtcbiAgICBjb25zdCBjaGlsZHJlbiA9IFtdO1xuICAgIENoaWxkcmVuLmZvckVhY2godGhpcy5wcm9wcy5jaGlsZHJlbiwgYyA9PiB7XG4gICAgICBpZiAoYyAmJiAhYy5wcm9wcy5kaXNhYmxlZCkge1xuICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgIGNoaWxkcmVuLnB1c2goYyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hpbGRyZW4udW5zaGlmdChjKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IGxlbmd0aCA9IGNoaWxkcmVuLmxlbmd0aDtcbiAgICBsZXQgcmV0ID0gbGVuZ3RoICYmIGdlbmVyYXRlS2V5KGNoaWxkcmVuWzBdLmtleSwgMCk7XG4gICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQsIGkpID0+IHtcbiAgICAgIGlmIChnZW5lcmF0ZUtleShjaGlsZC5rZXksIGkpID09PSBhY3RpdmVLZXkpIHtcbiAgICAgICAgaWYgKGkgPT09IGxlbmd0aCAtIDEpIHtcbiAgICAgICAgICByZXQgPSBnZW5lcmF0ZUtleShjaGlsZHJlblswXS5rZXksIDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldCA9IGdlbmVyYXRlS2V5KGNoaWxkcmVuW2kgKyAxXS5rZXksIGkgKyAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXQ7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICB0YWJCYXJQb3NpdGlvbixcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIHJlbmRlclRhYkNvbnRlbnQsXG4gICAgICByZW5kZXJUYWJCYXIsXG4gICAgICBkZXN0cm95SW5hY3RpdmVUYWJQYW5lLFxuICAgICAgLi4ucmVzdFByb3BzXG4gICAgfSA9IHByb3BzO1xuICAgIGNvbnN0IGNscyA9IGNsYXNzbmFtZXMoe1xuICAgICAgW3ByZWZpeENsc106IDEsXG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke3RhYkJhclBvc2l0aW9ufWBdOiAxLFxuICAgICAgW2NsYXNzTmFtZV06ICEhY2xhc3NOYW1lLFxuICAgIH0pO1xuXG4gICAgdGhpcy50YWJCYXIgPSByZW5kZXJUYWJCYXIoKTtcbiAgICBjb25zdCBjb250ZW50cyA9IFtcbiAgICAgIGNsb25lRWxlbWVudCh0aGlzLnRhYkJhciwge1xuICAgICAgICBwcmVmaXhDbHMsXG4gICAgICAgIGtleTogJ3RhYkJhcicsXG4gICAgICAgIG9uS2V5RG93bjogdGhpcy5vbk5hdktleURvd24sXG4gICAgICAgIHRhYkJhclBvc2l0aW9uLFxuICAgICAgICBvblRhYkNsaWNrOiB0aGlzLm9uVGFiQ2xpY2ssXG4gICAgICAgIHBhbmVsczogcHJvcHMuY2hpbGRyZW4sXG4gICAgICAgIGFjdGl2ZUtleTogdGhpcy5zdGF0ZS5hY3RpdmVLZXksXG4gICAgICB9KSxcbiAgICAgIGNsb25lRWxlbWVudChyZW5kZXJUYWJDb250ZW50KCksIHtcbiAgICAgICAgcHJlZml4Q2xzLFxuICAgICAgICB0YWJCYXJQb3NpdGlvbixcbiAgICAgICAgYWN0aXZlS2V5OiB0aGlzLnN0YXRlLmFjdGl2ZUtleSxcbiAgICAgICAgZGVzdHJveUluYWN0aXZlVGFiUGFuZSxcbiAgICAgICAgY2hpbGRyZW46IHByb3BzLmNoaWxkcmVuLFxuICAgICAgICBvbkNoYW5nZTogdGhpcy5zZXRBY3RpdmVLZXksXG4gICAgICAgIGtleTogJ3RhYkNvbnRlbnQnLFxuICAgICAgfSksXG4gICAgXTtcbiAgICBpZiAodGFiQmFyUG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICBjb250ZW50cy5yZXZlcnNlKCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xzfSBzdHlsZT17cHJvcHMuc3R5bGV9IHsuLi5nZXREYXRhQXR0cihyZXN0UHJvcHMpfT5cbiAgICAgICAge2NvbnRlbnRzfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl19