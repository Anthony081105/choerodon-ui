0a5398d4f3bcb7fbc1ee92d4c25a6438
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _ColGroup = _interopRequireDefault(require("./ColGroup"));

var _TableHeader = _interopRequireDefault(require("./TableHeader"));

var _TableFooter = _interopRequireDefault(require("./TableFooter"));

var _TableRow = _interopRequireDefault(require("./TableRow"));

var _ExpandableRow = _interopRequireDefault(require("./ExpandableRow"));

var BaseTable =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(BaseTable, _Component);

  function BaseTable() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, BaseTable);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(BaseTable)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleRowHover", function (isHover, key) {
      _this.props.store.setState({
        currentHoverKey: isHover ? key : null
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderRows", function (renderData, indent) {
      var ancestorKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
      var table = _this.context.table;
      var columnManager = table.columnManager,
          components = table.components;
      var _table$props = table.props,
          prefixCls = _table$props.prefixCls,
          childrenColumnName = _table$props.childrenColumnName,
          rowClassName = _table$props.rowClassName,
          rowRef = _table$props.rowRef,
          onRowClick = _table$props.onRowClick,
          onRowDoubleClick = _table$props.onRowDoubleClick,
          onRowContextMenu = _table$props.onRowContextMenu,
          onRowMouseEnter = _table$props.onRowMouseEnter,
          onRowMouseLeave = _table$props.onRowMouseLeave,
          onRow = _table$props.onRow;
      var _this$props = _this.props,
          getRowKey = _this$props.getRowKey,
          fixed = _this$props.fixed,
          expander = _this$props.expander,
          isAnyColumnsFixed = _this$props.isAnyColumnsFixed;
      var rows = [];

      var _loop = function _loop(i) {
        var record = renderData[i];
        var key = getRowKey(record, i);
        var className = typeof rowClassName === 'string' ? rowClassName : rowClassName(record, i, indent);
        var onHoverProps = {};

        if (columnManager.isAnyColumnsFixed()) {
          onHoverProps.onHover = _this.handleRowHover;
        }

        var leafColumns = void 0;

        if (fixed === 'left') {
          leafColumns = columnManager.leftLeafColumns();
        } else if (fixed === 'right') {
          leafColumns = columnManager.rightLeafColumns();
        } else {
          leafColumns = columnManager.leafColumns();
        }

        var rowPrefixCls = "".concat(prefixCls, "-row");

        var row = _react["default"].createElement(_ExpandableRow["default"], (0, _extends2["default"])({}, expander.props, {
          fixed: fixed,
          index: i,
          prefixCls: rowPrefixCls,
          record: record,
          key: key,
          rowKey: key,
          onRowClick: onRowClick,
          needIndentSpaced: expander.needIndentSpaced,
          onExpandedChange: expander.handleExpandChange
        }), function (expandableRow) {
          return (// eslint-disable-line
            _react["default"].createElement(_TableRow["default"], (0, _extends2["default"])({
              fixed: fixed,
              indent: indent,
              className: className,
              record: record,
              index: i,
              prefixCls: rowPrefixCls,
              childrenColumnName: childrenColumnName,
              columns: leafColumns,
              onRow: onRow,
              onRowDoubleClick: onRowDoubleClick,
              onRowContextMenu: onRowContextMenu,
              onRowMouseEnter: onRowMouseEnter,
              onRowMouseLeave: onRowMouseLeave
            }, onHoverProps, {
              rowKey: key,
              ancestorKeys: ancestorKeys,
              ref: rowRef(record, i, indent),
              components: components,
              isAnyColumnsFixed: isAnyColumnsFixed
            }, expandableRow))
          );
        });

        rows.push(row);
        expander.renderRows(_this.renderRows, rows, record, i, indent, fixed, key, ancestorKeys);
      };

      for (var i = 0; i < renderData.length; i++) {
        _loop(i);
      }

      return rows;
    });
    return _this;
  }

  (0, _createClass2["default"])(BaseTable, [{
    key: "render",
    value: function render() {
      var table = this.context.table;
      var components = table.components;
      var _table$props2 = table.props,
          prefixCls = _table$props2.prefixCls,
          scroll = _table$props2.scroll,
          data = _table$props2.data,
          getBodyWrapper = _table$props2.getBodyWrapper;
      var _this$props2 = this.props,
          expander = _this$props2.expander,
          tableClassName = _this$props2.tableClassName,
          hasHead = _this$props2.hasHead,
          hasBody = _this$props2.hasBody,
          hasFoot = _this$props2.hasFoot,
          fixed = _this$props2.fixed,
          columns = _this$props2.columns;
      var tableStyle = {};

      if (!fixed && scroll.x) {
        // not set width, then use content fixed width
        if (scroll.x === true) {
          tableStyle.tableLayout = 'fixed';
        } else {
          tableStyle.width = scroll.x;
        }
      }

      var Table = hasBody ? components.table : 'table';
      var BodyWrapper = components.body.wrapper;
      var body;

      if (hasBody) {
        body = _react["default"].createElement(BodyWrapper, {
          className: "".concat(prefixCls, "-tbody")
        }, this.renderRows(data, 0));

        if (getBodyWrapper) {
          body = getBodyWrapper(body);
        }
      }

      return _react["default"].createElement(Table, {
        className: tableClassName,
        style: tableStyle,
        key: "table"
      }, _react["default"].createElement(_ColGroup["default"], {
        columns: columns,
        fixed: fixed
      }), hasHead && _react["default"].createElement(_TableHeader["default"], {
        expander: expander,
        columns: columns,
        fixed: fixed
      }), body, hasFoot && _react["default"].createElement(_TableFooter["default"], {
        onHover: this.handleRowHover,
        columns: columns,
        fixed: fixed
      }));
    }
  }]);
  return BaseTable;
}(_react.Component);

(0, _defineProperty2["default"])(BaseTable, "propTypes", {
  fixed: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].bool]),
  columns: _propTypes["default"].array.isRequired,
  tableClassName: _propTypes["default"].string.isRequired,
  hasHead: _propTypes["default"].bool.isRequired,
  hasBody: _propTypes["default"].bool.isRequired,
  hasFoot: _propTypes["default"].bool.isRequired,
  store: _propTypes["default"].object.isRequired,
  expander: _propTypes["default"].object.isRequired,
  getRowKey: _propTypes["default"].func,
  isAnyColumnsFixed: _propTypes["default"].bool
});
(0, _defineProperty2["default"])(BaseTable, "contextTypes", {
  table: _propTypes["default"].any
});

var _default = (0, _miniStore.connect)()(BaseTable);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2VUYWJsZS5qc3giXSwibmFtZXMiOlsiQmFzZVRhYmxlIiwiaXNIb3ZlciIsImtleSIsInByb3BzIiwic3RvcmUiLCJzZXRTdGF0ZSIsImN1cnJlbnRIb3ZlcktleSIsInJlbmRlckRhdGEiLCJpbmRlbnQiLCJhbmNlc3RvcktleXMiLCJ0YWJsZSIsImNvbnRleHQiLCJjb2x1bW5NYW5hZ2VyIiwiY29tcG9uZW50cyIsInByZWZpeENscyIsImNoaWxkcmVuQ29sdW1uTmFtZSIsInJvd0NsYXNzTmFtZSIsInJvd1JlZiIsIm9uUm93Q2xpY2siLCJvblJvd0RvdWJsZUNsaWNrIiwib25Sb3dDb250ZXh0TWVudSIsIm9uUm93TW91c2VFbnRlciIsIm9uUm93TW91c2VMZWF2ZSIsIm9uUm93IiwiZ2V0Um93S2V5IiwiZml4ZWQiLCJleHBhbmRlciIsImlzQW55Q29sdW1uc0ZpeGVkIiwicm93cyIsImkiLCJyZWNvcmQiLCJjbGFzc05hbWUiLCJvbkhvdmVyUHJvcHMiLCJvbkhvdmVyIiwiaGFuZGxlUm93SG92ZXIiLCJsZWFmQ29sdW1ucyIsImxlZnRMZWFmQ29sdW1ucyIsInJpZ2h0TGVhZkNvbHVtbnMiLCJyb3dQcmVmaXhDbHMiLCJyb3ciLCJuZWVkSW5kZW50U3BhY2VkIiwiaGFuZGxlRXhwYW5kQ2hhbmdlIiwiZXhwYW5kYWJsZVJvdyIsInB1c2giLCJyZW5kZXJSb3dzIiwibGVuZ3RoIiwic2Nyb2xsIiwiZGF0YSIsImdldEJvZHlXcmFwcGVyIiwidGFibGVDbGFzc05hbWUiLCJoYXNIZWFkIiwiaGFzQm9keSIsImhhc0Zvb3QiLCJjb2x1bW5zIiwidGFibGVTdHlsZSIsIngiLCJ0YWJsZUxheW91dCIsIndpZHRoIiwiVGFibGUiLCJCb2R5V3JhcHBlciIsImJvZHkiLCJ3cmFwcGVyIiwiQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwib25lT2ZUeXBlIiwic3RyaW5nIiwiYm9vbCIsImFycmF5IiwiaXNSZXF1aXJlZCIsIm9iamVjdCIsImZ1bmMiLCJh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QUEsS0FBSyxFQUFFc0Msc0JBQVVDLFNBQVYsQ0FBb0IsQ0FDekJELHNCQUFVRSxNQURlLEVBRXpCRixzQkFBVUcsSUFGZSxDQUFwQixDQURVO0FBS2pCYixFQUFBQSxPQUFPLEVBQUVVLHNCQUFVSSxLQUFWLENBQWdCQyxVQUxSO0FBTWpCbkIsRUFBQUEsY0FBYyxFQUFFYyxzQkFBVUUsTUFBVixDQUFpQkcsVUFOaEI7QUFPakJsQixFQUFBQSxPQUFPLEVBQUVhLHNCQUFVRyxJQUFWLENBQWVFLFVBUFA7QUFRakJqQixFQUFBQSxPQUFPLEVBQUVZLHNCQUFVRyxJQUFWLENBQWVFLFVBUlA7QUFTakJoQixFQUFBQSxPQUFPLEVBQUVXLHNCQUFVRyxJQUFWLENBQWVFLFVBVFA7QUFVakJoRSxFQUFBQSxLQUFLLEVBQUUyRCxzQkFBVU0sTUFBVixDQUFpQkQsVUFWUDtBQVdqQjFDLEVBQUFBLFFBQVEsRUFBRXFDLHNCQUFVTSxNQUFWLENBQWlCRCxVQVhWO0FBWWpCNUMsRUFBQUEsU0FBUyxFQUFFdUMsc0JBQVVPLElBWko7QUFhakIzQyxFQUFBQSxpQkFBaUIsRUFBRW9DLHNCQUFVRztBQWJaLEM7aUNBRGZsRSxTLGtCQWlCa0I7QUFDcEJVLEVBQUFBLEtBQUssRUFBRXFELHNCQUFVUTtBQURHLEM7O2VBc0pULDBCQUFVdkUsU0FBVixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAnbWluaS1zdG9yZSc7XG5pbXBvcnQgQ29sR3JvdXAgZnJvbSAnLi9Db2xHcm91cCc7XG5pbXBvcnQgVGFibGVIZWFkZXIgZnJvbSAnLi9UYWJsZUhlYWRlcic7XG5pbXBvcnQgVGFibGVGb290ZXIgZnJvbSAnLi9UYWJsZUZvb3Rlcic7XG5pbXBvcnQgVGFibGVSb3cgZnJvbSAnLi9UYWJsZVJvdyc7XG5pbXBvcnQgRXhwYW5kYWJsZVJvdyBmcm9tICcuL0V4cGFuZGFibGVSb3cnO1xuXG5jbGFzcyBCYXNlVGFibGUgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGZpeGVkOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICBQcm9wVHlwZXMuYm9vbCxcbiAgICBdKSxcbiAgICBjb2x1bW5zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICB0YWJsZUNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGhhc0hlYWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgaGFzQm9keTogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBoYXNGb290OiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIHN0b3JlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgZXhwYW5kZXI6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBnZXRSb3dLZXk6IFByb3BUeXBlcy5mdW5jLFxuICAgIGlzQW55Q29sdW1uc0ZpeGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgfTtcblxuICBzdGF0aWMgY29udGV4dFR5cGVzID0ge1xuICAgIHRhYmxlOiBQcm9wVHlwZXMuYW55LFxuICB9O1xuXG4gIGhhbmRsZVJvd0hvdmVyID0gKGlzSG92ZXIsIGtleSkgPT4ge1xuICAgIHRoaXMucHJvcHMuc3RvcmUuc2V0U3RhdGUoe1xuICAgICAgY3VycmVudEhvdmVyS2V5OiBpc0hvdmVyID8ga2V5IDogbnVsbCxcbiAgICB9KTtcbiAgfTtcblxuICByZW5kZXJSb3dzID0gKHJlbmRlckRhdGEsIGluZGVudCwgYW5jZXN0b3JLZXlzID0gW10pID0+IHtcbiAgICBjb25zdCB7IHRhYmxlIH0gPSB0aGlzLmNvbnRleHQ7XG4gICAgY29uc3QgeyBjb2x1bW5NYW5hZ2VyLCBjb21wb25lbnRzIH0gPSB0YWJsZTtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBjaGlsZHJlbkNvbHVtbk5hbWUsXG4gICAgICByb3dDbGFzc05hbWUsXG4gICAgICByb3dSZWYsXG4gICAgICBvblJvd0NsaWNrLFxuICAgICAgb25Sb3dEb3VibGVDbGljayxcbiAgICAgIG9uUm93Q29udGV4dE1lbnUsXG4gICAgICBvblJvd01vdXNlRW50ZXIsXG4gICAgICBvblJvd01vdXNlTGVhdmUsXG4gICAgICBvblJvdyxcbiAgICB9ID0gdGFibGUucHJvcHM7XG4gICAgY29uc3QgeyBnZXRSb3dLZXksIGZpeGVkLCBleHBhbmRlciwgaXNBbnlDb2x1bW5zRml4ZWQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCByb3dzID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbmRlckRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHJlY29yZCA9IHJlbmRlckRhdGFbaV07XG4gICAgICBjb25zdCBrZXkgPSBnZXRSb3dLZXkocmVjb3JkLCBpKTtcbiAgICAgIGNvbnN0IGNsYXNzTmFtZSA9IHR5cGVvZiByb3dDbGFzc05hbWUgPT09ICdzdHJpbmcnXG4gICAgICAgID8gcm93Q2xhc3NOYW1lXG4gICAgICAgIDogcm93Q2xhc3NOYW1lKHJlY29yZCwgaSwgaW5kZW50KTtcblxuICAgICAgY29uc3Qgb25Ib3ZlclByb3BzID0ge307XG4gICAgICBpZiAoY29sdW1uTWFuYWdlci5pc0FueUNvbHVtbnNGaXhlZCgpKSB7XG4gICAgICAgIG9uSG92ZXJQcm9wcy5vbkhvdmVyID0gdGhpcy5oYW5kbGVSb3dIb3ZlcjtcbiAgICAgIH1cblxuICAgICAgbGV0IGxlYWZDb2x1bW5zO1xuICAgICAgaWYgKGZpeGVkID09PSAnbGVmdCcpIHtcbiAgICAgICAgbGVhZkNvbHVtbnMgPSBjb2x1bW5NYW5hZ2VyLmxlZnRMZWFmQ29sdW1ucygpO1xuICAgICAgfSBlbHNlIGlmIChmaXhlZCA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICBsZWFmQ29sdW1ucyA9IGNvbHVtbk1hbmFnZXIucmlnaHRMZWFmQ29sdW1ucygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGVhZkNvbHVtbnMgPSBjb2x1bW5NYW5hZ2VyLmxlYWZDb2x1bW5zKCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJvd1ByZWZpeENscyA9IGAke3ByZWZpeENsc30tcm93YDtcblxuICAgICAgY29uc3Qgcm93ID0gKFxuICAgICAgICA8RXhwYW5kYWJsZVJvd1xuICAgICAgICAgIHsuLi5leHBhbmRlci5wcm9wc31cbiAgICAgICAgICBmaXhlZD17Zml4ZWR9XG4gICAgICAgICAgaW5kZXg9e2l9XG4gICAgICAgICAgcHJlZml4Q2xzPXtyb3dQcmVmaXhDbHN9XG4gICAgICAgICAgcmVjb3JkPXtyZWNvcmR9XG4gICAgICAgICAga2V5PXtrZXl9XG4gICAgICAgICAgcm93S2V5PXtrZXl9XG4gICAgICAgICAgb25Sb3dDbGljaz17b25Sb3dDbGlja31cbiAgICAgICAgICBuZWVkSW5kZW50U3BhY2VkPXtleHBhbmRlci5uZWVkSW5kZW50U3BhY2VkfVxuICAgICAgICAgIG9uRXhwYW5kZWRDaGFuZ2U9e2V4cGFuZGVyLmhhbmRsZUV4cGFuZENoYW5nZX1cbiAgICAgICAgPlxuICAgICAgICAgIHsoZXhwYW5kYWJsZVJvdykgPT4gKCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gICAgICAgICAgICA8VGFibGVSb3dcbiAgICAgICAgICAgICAgZml4ZWQ9e2ZpeGVkfVxuICAgICAgICAgICAgICBpbmRlbnQ9e2luZGVudH1cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWV9XG4gICAgICAgICAgICAgIHJlY29yZD17cmVjb3JkfVxuICAgICAgICAgICAgICBpbmRleD17aX1cbiAgICAgICAgICAgICAgcHJlZml4Q2xzPXtyb3dQcmVmaXhDbHN9XG4gICAgICAgICAgICAgIGNoaWxkcmVuQ29sdW1uTmFtZT17Y2hpbGRyZW5Db2x1bW5OYW1lfVxuICAgICAgICAgICAgICBjb2x1bW5zPXtsZWFmQ29sdW1uc31cbiAgICAgICAgICAgICAgb25Sb3c9e29uUm93fVxuICAgICAgICAgICAgICBvblJvd0RvdWJsZUNsaWNrPXtvblJvd0RvdWJsZUNsaWNrfVxuICAgICAgICAgICAgICBvblJvd0NvbnRleHRNZW51PXtvblJvd0NvbnRleHRNZW51fVxuICAgICAgICAgICAgICBvblJvd01vdXNlRW50ZXI9e29uUm93TW91c2VFbnRlcn1cbiAgICAgICAgICAgICAgb25Sb3dNb3VzZUxlYXZlPXtvblJvd01vdXNlTGVhdmV9XG4gICAgICAgICAgICAgIHsuLi5vbkhvdmVyUHJvcHN9XG4gICAgICAgICAgICAgIHJvd0tleT17a2V5fVxuICAgICAgICAgICAgICBhbmNlc3RvcktleXM9e2FuY2VzdG9yS2V5c31cbiAgICAgICAgICAgICAgcmVmPXtyb3dSZWYocmVjb3JkLCBpLCBpbmRlbnQpfVxuICAgICAgICAgICAgICBjb21wb25lbnRzPXtjb21wb25lbnRzfVxuICAgICAgICAgICAgICBpc0FueUNvbHVtbnNGaXhlZD17aXNBbnlDb2x1bW5zRml4ZWR9XG4gICAgICAgICAgICAgIHsuLi5leHBhbmRhYmxlUm93fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICApfVxuICAgICAgICA8L0V4cGFuZGFibGVSb3c+XG4gICAgICApO1xuXG4gICAgICByb3dzLnB1c2gocm93KTtcblxuICAgICAgZXhwYW5kZXIucmVuZGVyUm93cyhcbiAgICAgICAgdGhpcy5yZW5kZXJSb3dzLFxuICAgICAgICByb3dzLFxuICAgICAgICByZWNvcmQsXG4gICAgICAgIGksXG4gICAgICAgIGluZGVudCxcbiAgICAgICAgZml4ZWQsXG4gICAgICAgIGtleSxcbiAgICAgICAgYW5jZXN0b3JLZXlzLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHJvd3M7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgdGFibGUgfSA9IHRoaXMuY29udGV4dDtcbiAgICBjb25zdCB7IGNvbXBvbmVudHMgfSA9IHRhYmxlO1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBzY3JvbGwsIGRhdGEsIGdldEJvZHlXcmFwcGVyIH0gPSB0YWJsZS5wcm9wcztcbiAgICBjb25zdCB7IGV4cGFuZGVyLCB0YWJsZUNsYXNzTmFtZSwgaGFzSGVhZCwgaGFzQm9keSwgaGFzRm9vdCwgZml4ZWQsIGNvbHVtbnMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgdGFibGVTdHlsZSA9IHt9O1xuXG4gICAgaWYgKCFmaXhlZCAmJiBzY3JvbGwueCkge1xuICAgICAgLy8gbm90IHNldCB3aWR0aCwgdGhlbiB1c2UgY29udGVudCBmaXhlZCB3aWR0aFxuICAgICAgaWYgKHNjcm9sbC54ID09PSB0cnVlKSB7XG4gICAgICAgIHRhYmxlU3R5bGUudGFibGVMYXlvdXQgPSAnZml4ZWQnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFibGVTdHlsZS53aWR0aCA9IHNjcm9sbC54O1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IFRhYmxlID0gaGFzQm9keSA/IGNvbXBvbmVudHMudGFibGUgOiAndGFibGUnO1xuICAgIGNvbnN0IEJvZHlXcmFwcGVyID0gY29tcG9uZW50cy5ib2R5LndyYXBwZXI7XG5cbiAgICBsZXQgYm9keTtcbiAgICBpZiAoaGFzQm9keSkge1xuICAgICAgYm9keSA9IChcbiAgICAgICAgPEJvZHlXcmFwcGVyIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10Ym9keWB9PlxuICAgICAgICAgIHt0aGlzLnJlbmRlclJvd3MoZGF0YSwgMCl9XG4gICAgICAgIDwvQm9keVdyYXBwZXI+XG4gICAgICApO1xuICAgICAgaWYgKGdldEJvZHlXcmFwcGVyKSB7XG4gICAgICAgIGJvZHkgPSBnZXRCb2R5V3JhcHBlcihib2R5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFRhYmxlIGNsYXNzTmFtZT17dGFibGVDbGFzc05hbWV9IHN0eWxlPXt0YWJsZVN0eWxlfSBrZXk9XCJ0YWJsZVwiPlxuICAgICAgICA8Q29sR3JvdXAgY29sdW1ucz17Y29sdW1uc30gZml4ZWQ9e2ZpeGVkfSAvPlxuICAgICAgICB7aGFzSGVhZCAmJiA8VGFibGVIZWFkZXIgZXhwYW5kZXI9e2V4cGFuZGVyfSBjb2x1bW5zPXtjb2x1bW5zfSBmaXhlZD17Zml4ZWR9IC8+fVxuICAgICAgICB7Ym9keX1cbiAgICAgICAge2hhc0Zvb3QgJiYgPFRhYmxlRm9vdGVyIG9uSG92ZXI9e3RoaXMuaGFuZGxlUm93SG92ZXJ9IGNvbHVtbnM9e2NvbHVtbnN9IGZpeGVkPXtmaXhlZH0gLz59XG4gICAgICA8L1RhYmxlPlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdCgpKEJhc2VUYWJsZSk7XG4iXX0=