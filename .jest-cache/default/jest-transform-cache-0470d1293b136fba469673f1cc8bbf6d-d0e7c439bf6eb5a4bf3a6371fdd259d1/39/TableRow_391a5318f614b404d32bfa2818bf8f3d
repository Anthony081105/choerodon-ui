26c5a2df37f51fd1b39ec3c1f585a978
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread3 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _TableCell = _interopRequireDefault(require("./TableCell"));

var _warning = _interopRequireDefault(require("../../_util/warning"));

var TableRow =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(TableRow, _Component);

  function TableRow(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, TableRow);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(TableRow).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onRowClick", function (event) {
      var _this$props = _this.props,
          record = _this$props.record,
          index = _this$props.index,
          onRowClick = _this$props.onRowClick;

      if (onRowClick) {
        onRowClick(record, index, event);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onRowDoubleClick", function (event) {
      var _this$props2 = _this.props,
          record = _this$props2.record,
          index = _this$props2.index,
          onRowDoubleClick = _this$props2.onRowDoubleClick;

      if (onRowDoubleClick) {
        onRowDoubleClick(record, index, event);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onContextMenu", function (event) {
      var _this$props3 = _this.props,
          record = _this$props3.record,
          index = _this$props3.index,
          onRowContextMenu = _this$props3.onRowContextMenu;

      if (onRowContextMenu) {
        onRowContextMenu(record, index, event);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onMouseEnter", function (event) {
      var _this$props4 = _this.props,
          record = _this$props4.record,
          index = _this$props4.index,
          onRowMouseEnter = _this$props4.onRowMouseEnter,
          onHover = _this$props4.onHover,
          rowKey = _this$props4.rowKey;
      onHover(true, rowKey);

      if (onRowMouseEnter) {
        onRowMouseEnter(record, index, event);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onMouseLeave", function (event) {
      var _this$props5 = _this.props,
          record = _this$props5.record,
          index = _this$props5.index,
          onRowMouseLeave = _this$props5.onRowMouseLeave,
          onHover = _this$props5.onHover,
          rowKey = _this$props5.rowKey;
      onHover(false, rowKey);

      if (onRowMouseLeave) {
        onRowMouseLeave(record, index, event);
      }
    });
    _this.shouldRender = props.visible;
    return _this;
  }

  (0, _createClass2["default"])(TableRow, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.shouldRender) {
        this.saveRowRef();
      }
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (this.props.visible || !this.props.visible && nextProps.visible) {
        this.shouldRender = true;
      }
    }
  }, {
    key: "shouldComponentUpdate",
    value: function shouldComponentUpdate(nextProps) {
      return !!(this.props.visible || nextProps.visible);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      if (this.shouldRender && !this.rowRef) {
        this.saveRowRef();
      }
    }
  }, {
    key: "setExpanedRowHeight",
    value: function setExpanedRowHeight() {
      var _this$props6 = this.props,
          store = _this$props6.store,
          rowKey = _this$props6.rowKey;

      var _store$getState = store.getState(),
          expandedRowsHeight = _store$getState.expandedRowsHeight;

      var height = this.rowRef.getBoundingClientRect().height;
      expandedRowsHeight = (0, _objectSpread3["default"])({}, expandedRowsHeight, (0, _defineProperty2["default"])({}, rowKey, height));
      store.setState({
        expandedRowsHeight: expandedRowsHeight
      });
    }
  }, {
    key: "setRowHeight",
    value: function setRowHeight() {
      var _this$props7 = this.props,
          store = _this$props7.store,
          index = _this$props7.index;
      var fixedColumnsBodyRowsHeight = store.getState().fixedColumnsBodyRowsHeight.slice();
      var height = this.rowRef.getBoundingClientRect().height;
      fixedColumnsBodyRowsHeight[index] = height;
      store.setState({
        fixedColumnsBodyRowsHeight: fixedColumnsBodyRowsHeight
      });
    }
  }, {
    key: "getStyle",
    value: function getStyle() {
      var _this$props8 = this.props,
          height = _this$props8.height,
          visible = _this$props8.visible;

      if (height && height !== this.style.height) {
        this.style = (0, _objectSpread3["default"])({}, this.style, {
          height: height
        });
      }

      if (!visible && !this.style.display) {
        this.style = (0, _objectSpread3["default"])({}, this.style, {
          display: 'none'
        });
      }

      return this.style;
    }
  }, {
    key: "saveRowRef",
    value: function saveRowRef() {
      this.rowRef = _reactDom["default"].findDOMNode(this);
      var _this$props9 = this.props,
          isAnyColumnsFixed = _this$props9.isAnyColumnsFixed,
          fixed = _this$props9.fixed,
          expandedRow = _this$props9.expandedRow,
          ancestorKeys = _this$props9.ancestorKeys;

      if (!isAnyColumnsFixed) {
        return;
      }

      if (!fixed && expandedRow) {
        this.setExpanedRowHeight();
      }

      if (!fixed && ancestorKeys.length >= 0) {
        this.setRowHeight();
      }
    }
  }, {
    key: "render",
    value: function render() {
      if (!this.shouldRender) {
        return null;
      }

      var _this$props10 = this.props,
          prefixCls = _this$props10.prefixCls,
          columns = _this$props10.columns,
          record = _this$props10.record,
          index = _this$props10.index,
          onRow = _this$props10.onRow,
          indent = _this$props10.indent,
          indentSize = _this$props10.indentSize,
          hovered = _this$props10.hovered,
          height = _this$props10.height,
          visible = _this$props10.visible,
          components = _this$props10.components,
          hasExpandIcon = _this$props10.hasExpandIcon,
          renderExpandIcon = _this$props10.renderExpandIcon,
          renderExpandIconCell = _this$props10.renderExpandIconCell;
      var BodyRow = components.body.row;
      var BodyCell = components.body.cell;
      var className = this.props.className;

      if (hovered) {
        className += " ".concat(prefixCls, "-hover");
      }

      var cells = [];
      renderExpandIconCell(cells);

      for (var i = 0; i < columns.length; i++) {
        var column = columns[i];
        (0, _warning["default"])(column.onCellClick === undefined, 'column[onCellClick] is deprecated, please use column[onCell] instead.');
        cells.push(_react["default"].createElement(_TableCell["default"], {
          prefixCls: prefixCls,
          record: record,
          indentSize: indentSize,
          indent: indent,
          index: index,
          column: column,
          key: column.key || column.dataIndex,
          expandIcon: hasExpandIcon(i) && renderExpandIcon(),
          component: BodyCell
        }));
      }

      var rowClassName = "".concat(prefixCls, " ").concat(className, " ").concat(prefixCls, "-level-").concat(indent).trim();
      var rowProps = onRow(record, index);
      var customStyle = rowProps ? rowProps.style : {};
      var style = {
        height: height
      };

      if (!visible) {
        style.display = 'none';
      }

      style = (0, _objectSpread3["default"])({}, style, {}, customStyle);
      return _react["default"].createElement(BodyRow, (0, _extends2["default"])({
        onClick: this.onRowClick,
        onDoubleClick: this.onRowDoubleClick,
        onMouseEnter: this.onMouseEnter,
        onMouseLeave: this.onMouseLeave,
        onContextMenu: this.onContextMenu,
        className: rowClassName
      }, rowProps, {
        style: style
      }), cells);
    }
  }]);
  return TableRow;
}(_react.Component);

(0, _defineProperty2["default"])(TableRow, "propTypes", {
  onRow: _propTypes["default"].func,
  onRowClick: _propTypes["default"].func,
  onRowDoubleClick: _propTypes["default"].func,
  onRowContextMenu: _propTypes["default"].func,
  onRowMouseEnter: _propTypes["default"].func,
  onRowMouseLeave: _propTypes["default"].func,
  record: _propTypes["default"].object,
  prefixCls: _propTypes["default"].string,
  onHover: _propTypes["default"].func,
  columns: _propTypes["default"].array,
  height: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].number]),
  index: _propTypes["default"].number,
  rowKey: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].number]).isRequired,
  className: _propTypes["default"].string,
  indent: _propTypes["default"].number,
  indentSize: _propTypes["default"].number,
  hasExpandIcon: _propTypes["default"].func.isRequired,
  hovered: _propTypes["default"].bool.isRequired,
  visible: _propTypes["default"].bool.isRequired,
  store: _propTypes["default"].object.isRequired,
  fixed: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].bool]),
  renderExpandIcon: _propTypes["default"].func,
  renderExpandIconCell: _propTypes["default"].func,
  components: _propTypes["default"].any,
  expandedRow: _propTypes["default"].bool,
  isAnyColumnsFixed: _propTypes["default"].bool,
  ancestorKeys: _propTypes["default"].array.isRequired
});
(0, _defineProperty2["default"])(TableRow, "defaultProps", {
  onRow: function onRow() {},
  expandIconColumnIndex: 0,
  expandRowByClick: false,
  onHover: function onHover() {},
  hasExpandIcon: function hasExpandIcon() {},
  renderExpandIcon: function renderExpandIcon() {},
  renderExpandIconCell: function renderExpandIconCell() {}
});

function getRowHeight(state, props) {
  var expandedRowsHeight = state.expandedRowsHeight,
      fixedColumnsBodyRowsHeight = state.fixedColumnsBodyRowsHeight;
  var fixed = props.fixed,
      index = props.index,
      rowKey = props.rowKey;

  if (!fixed) {
    return null;
  }

  if (expandedRowsHeight[rowKey]) {
    return expandedRowsHeight[rowKey];
  }

  if (fixedColumnsBodyRowsHeight[index]) {
    return fixedColumnsBodyRowsHeight[index];
  }

  return null;
}

var _default = (0, _miniStore.connect)(function (state, props) {
  var currentHoverKey = state.currentHoverKey,
      expandedRowKeys = state.expandedRowKeys;
  var rowKey = props.rowKey,
      ancestorKeys = props.ancestorKeys;
  var visible = ancestorKeys.length === 0 || ancestorKeys.every(function (k) {
    return ~expandedRowKeys.indexOf(k);
  });
  return {
    visible: visible,
    hovered: currentHoverKey === rowKey,
    height: getRowHeight(state, props)
  };
})(TableRow);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRhYmxlUm93LmpzeCJdLCJuYW1lcyI6WyJUYWJsZVJvdyIsInByb3BzIiwiZXZlbnQiLCJyZWNvcmQiLCJpbmRleCIsIm9uUm93Q2xpY2siLCJvblJvd0RvdWJsZUNsaWNrIiwib25Sb3dDb250ZXh0TWVudSIsIm9uUm93TW91c2VFbnRlciIsIm9uSG92ZXIiLCJyb3dLZXkiLCJvblJvd01vdXNlTGVhdmUiLCJzaG91bGRSZW5kZXIiLCJ2aXNpYmxlIiwic2F2ZVJvd1JlZiIsIm5leHRQcm9wcyIsInJvd1JlZiIsInN0b3JlIiwiZ2V0U3RhdGUiLCJleHBhbmRlZFJvd3NIZWlnaHQiLCJoZWlnaHQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJzZXRTdGF0ZSIsImZpeGVkQ29sdW1uc0JvZHlSb3dzSGVpZ2h0Iiwic2xpY2UiLCJzdHlsZSIsImRpc3BsYXkiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwiaXNBbnlDb2x1bW5zRml4ZWQiLCJmaXhlZCIsImV4cGFuZGVkUm93IiwiYW5jZXN0b3JLZXlzIiwic2V0RXhwYW5lZFJvd0hlaWdodCIsImxlbmd0aCIsInNldFJvd0hlaWdodCIsInByZWZpeENscyIsImNvbHVtbnMiLCJvblJvdyIsImluZGVudCIsImluZGVudFNpemUiLCJob3ZlcmVkIiwiY29tcG9uZW50cyIsImhhc0V4cGFuZEljb24iLCJyZW5kZXJFeHBhbmRJY29uIiwicmVuZGVyRXhwYW5kSWNvbkNlbGwiLCJCb2R5Um93IiwiYm9keSIsInJvdyIsIkJvZHlDZWxsIiwiY2VsbCIsImNsYXNzTmFtZSIsImNlbGxzIiwiaSIsImNvbHVtbiIsIm9uQ2VsbENsaWNrIiwidW5kZWZpbmVkIiwicHVzaCIsImtleSIsImRhdGFJbmRleCIsInJvd0NsYXNzTmFtZSIsInRyaW0iLCJyb3dQcm9wcyIsImN1c3RvbVN0eWxlIiwib25Nb3VzZUVudGVyIiwib25Nb3VzZUxlYXZlIiwib25Db250ZXh0TWVudSIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImZ1bmMiLCJvYmplY3QiLCJzdHJpbmciLCJhcnJheSIsIm9uZU9mVHlwZSIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJib29sIiwiYW55IiwiZXhwYW5kSWNvbkNvbHVtbkluZGV4IiwiZXhwYW5kUm93QnlDbGljayIsImdldFJvd0hlaWdodCIsInN0YXRlIiwiY3VycmVudEhvdmVyS2V5IiwiZXhwYW5kZWRSb3dLZXlzIiwiZXZlcnkiLCJrIiwiaW5kZXhPZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7SUFFTUEsUTs7Ozs7QUFrREosb0JBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTtBQUNqQixvSEFBTUEsS0FBTjtBQURpQixtR0E0Qk4sVUFBQ0MsS0FBRCxFQUFXO0FBQUEsd0JBQ2dCLE1BQUtELEtBRHJCO0FBQUEsVUFDZEUsTUFEYyxlQUNkQSxNQURjO0FBQUEsVUFDTkMsS0FETSxlQUNOQSxLQURNO0FBQUEsVUFDQ0MsVUFERCxlQUNDQSxVQUREOztBQUV0QixVQUFJQSxVQUFKLEVBQWdCO0FBQ2RBLFFBQUFBLFVBQVUsQ0FBQ0YsTUFBRCxFQUFTQyxLQUFULEVBQWdCRixLQUFoQixDQUFWO0FBQ0Q7QUFDRixLQWpDa0I7QUFBQSx5R0FtQ0EsVUFBQ0EsS0FBRCxFQUFXO0FBQUEseUJBQ2dCLE1BQUtELEtBRHJCO0FBQUEsVUFDcEJFLE1BRG9CLGdCQUNwQkEsTUFEb0I7QUFBQSxVQUNaQyxLQURZLGdCQUNaQSxLQURZO0FBQUEsVUFDTEUsZ0JBREssZ0JBQ0xBLGdCQURLOztBQUU1QixVQUFJQSxnQkFBSixFQUFzQjtBQUNwQkEsUUFBQUEsZ0JBQWdCLENBQUNILE1BQUQsRUFBU0MsS0FBVCxFQUFnQkYsS0FBaEIsQ0FBaEI7QUFDRDtBQUNGLEtBeENrQjtBQUFBLHNHQTBDSCxVQUFDQSxLQUFELEVBQVc7QUFBQSx5QkFDbUIsTUFBS0QsS0FEeEI7QUFBQSxVQUNqQkUsTUFEaUIsZ0JBQ2pC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QUFJLENBQUNGLGVBQWUsQ0FBQ0csT0FBaEIsQ0FBd0JELENBQXhCLENBQUw7QUFBQSxHQUFwQixDQUE3QztBQUVBLFNBQVE7QUFDTnhFLElBQUFBLE9BQU8sRUFBUEEsT0FETTtBQUVONEIsSUFBQUEsT0FBTyxFQUFFeUMsZUFBZSxLQUFLeEUsTUFGdkI7QUFHTlUsSUFBQUEsTUFBTSxFQUFFNEQsWUFBWSxDQUFDQyxLQUFELEVBQVFoRixLQUFSO0FBSGQsR0FBUjtBQUtELENBVmMsRUFVWkQsUUFWWSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdtaW5pLXN0b3JlJztcbmltcG9ydCBUYWJsZUNlbGwgZnJvbSAnLi9UYWJsZUNlbGwnO1xuaW1wb3J0IHdhcm5pbmcgZnJvbSAnLi4vLi4vX3V0aWwvd2FybmluZyc7XG5cbmNsYXNzIFRhYmxlUm93IGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBvblJvdzogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Sb3dDbGljazogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Sb3dEb3VibGVDbGljazogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Sb3dDb250ZXh0TWVudTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Sb3dNb3VzZUVudGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvblJvd01vdXNlTGVhdmU6IFByb3BUeXBlcy5mdW5jLFxuICAgIHJlY29yZDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgb25Ib3ZlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY29sdW1uczogUHJvcFR5cGVzLmFycmF5LFxuICAgIGhlaWdodDogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgUHJvcFR5cGVzLm51bWJlcixcbiAgICBdKSxcbiAgICBpbmRleDogUHJvcFR5cGVzLm51bWJlcixcbiAgICByb3dLZXk6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIFByb3BUeXBlcy5udW1iZXIsXG4gICAgXSkuaXNSZXF1aXJlZCxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgaW5kZW50OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGluZGVudFNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgaGFzRXhwYW5kSWNvbjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBob3ZlcmVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIHZpc2libGU6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgc3RvcmU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBmaXhlZDogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgUHJvcFR5cGVzLmJvb2wsXG4gICAgXSksXG4gICAgcmVuZGVyRXhwYW5kSWNvbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgcmVuZGVyRXhwYW5kSWNvbkNlbGw6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNvbXBvbmVudHM6IFByb3BUeXBlcy5hbnksXG4gICAgZXhwYW5kZWRSb3c6IFByb3BUeXBlcy5ib29sLFxuICAgIGlzQW55Q29sdW1uc0ZpeGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBhbmNlc3RvcktleXM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBvblJvdygpIHt9LFxuICAgIGV4cGFuZEljb25Db2x1bW5JbmRleDogMCxcbiAgICBleHBhbmRSb3dCeUNsaWNrOiBmYWxzZSxcbiAgICBvbkhvdmVyKCkge30sXG4gICAgaGFzRXhwYW5kSWNvbigpIHt9LFxuICAgIHJlbmRlckV4cGFuZEljb24oKSB7fSxcbiAgICByZW5kZXJFeHBhbmRJY29uQ2VsbCgpIHt9LFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLnNob3VsZFJlbmRlciA9IHByb3BzLnZpc2libGU7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBpZiAodGhpcy5zaG91bGRSZW5kZXIpIHtcbiAgICAgIHRoaXMuc2F2ZVJvd1JlZigpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKHRoaXMucHJvcHMudmlzaWJsZSB8fCAoIXRoaXMucHJvcHMudmlzaWJsZSAmJiBuZXh0UHJvcHMudmlzaWJsZSkpIHtcbiAgICAgIHRoaXMuc2hvdWxkUmVuZGVyID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBzaG91bGRDb21wb25lbnRVcGRhdGUobmV4dFByb3BzKSB7XG4gICAgcmV0dXJuICEhKHRoaXMucHJvcHMudmlzaWJsZSB8fCBuZXh0UHJvcHMudmlzaWJsZSk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgaWYgKHRoaXMuc2hvdWxkUmVuZGVyICYmICF0aGlzLnJvd1JlZikge1xuICAgICAgdGhpcy5zYXZlUm93UmVmKCk7XG4gICAgfVxuICB9XG5cbiAgb25Sb3dDbGljayA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IHsgcmVjb3JkLCBpbmRleCwgb25Sb3dDbGljayB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAob25Sb3dDbGljaykge1xuICAgICAgb25Sb3dDbGljayhyZWNvcmQsIGluZGV4LCBldmVudCk7XG4gICAgfVxuICB9XG5cbiAgb25Sb3dEb3VibGVDbGljayA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IHsgcmVjb3JkLCBpbmRleCwgb25Sb3dEb3VibGVDbGljayB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAob25Sb3dEb3VibGVDbGljaykge1xuICAgICAgb25Sb3dEb3VibGVDbGljayhyZWNvcmQsIGluZGV4LCBldmVudCk7XG4gICAgfVxuICB9XG5cbiAgb25Db250ZXh0TWVudSA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IHsgcmVjb3JkLCBpbmRleCwgb25Sb3dDb250ZXh0TWVudSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAob25Sb3dDb250ZXh0TWVudSkge1xuICAgICAgb25Sb3dDb250ZXh0TWVudShyZWNvcmQsIGluZGV4LCBldmVudCk7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZUVudGVyID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgeyByZWNvcmQsIGluZGV4LCBvblJvd01vdXNlRW50ZXIsIG9uSG92ZXIsIHJvd0tleSB9ID0gdGhpcy5wcm9wcztcbiAgICBvbkhvdmVyKHRydWUsIHJvd0tleSk7XG4gICAgaWYgKG9uUm93TW91c2VFbnRlcikge1xuICAgICAgb25Sb3dNb3VzZUVudGVyKHJlY29yZCwgaW5kZXgsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBvbk1vdXNlTGVhdmUgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCB7IHJlY29yZCwgaW5kZXgsIG9uUm93TW91c2VMZWF2ZSwgb25Ib3Zlciwgcm93S2V5IH0gPSB0aGlzLnByb3BzO1xuICAgIG9uSG92ZXIoZmFsc2UsIHJvd0tleSk7XG4gICAgaWYgKG9uUm93TW91c2VMZWF2ZSkge1xuICAgICAgb25Sb3dNb3VzZUxlYXZlKHJlY29yZCwgaW5kZXgsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBzZXRFeHBhbmVkUm93SGVpZ2h0KCkge1xuICAgIGNvbnN0IHsgc3RvcmUsIHJvd0tleSB9ID0gdGhpcy5wcm9wcztcbiAgICBsZXQgeyBleHBhbmRlZFJvd3NIZWlnaHQgfSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5yb3dSZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0O1xuICAgIGV4cGFuZGVkUm93c0hlaWdodCA9IHtcbiAgICAgIC4uLmV4cGFuZGVkUm93c0hlaWdodCxcbiAgICAgIFtyb3dLZXldOiBoZWlnaHQsXG4gICAgfTtcbiAgICBzdG9yZS5zZXRTdGF0ZSh7IGV4cGFuZGVkUm93c0hlaWdodCB9KTtcbiAgfVxuXG4gIHNldFJvd0hlaWdodCgpIHtcbiAgICBjb25zdCB7IHN0b3JlLCBpbmRleCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBmaXhlZENvbHVtbnNCb2R5Um93c0hlaWdodCA9IHN0b3JlLmdldFN0YXRlKCkuZml4ZWRDb2x1bW5zQm9keVJvd3NIZWlnaHQuc2xpY2UoKTtcbiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLnJvd1JlZi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgZml4ZWRDb2x1bW5zQm9keVJvd3NIZWlnaHRbaW5kZXhdID0gaGVpZ2h0O1xuICAgIHN0b3JlLnNldFN0YXRlKHsgZml4ZWRDb2x1bW5zQm9keVJvd3NIZWlnaHQgfSk7XG4gIH1cblxuICBnZXRTdHlsZSgpIHtcbiAgICBjb25zdCB7IGhlaWdodCwgdmlzaWJsZSB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChoZWlnaHQgJiYgaGVpZ2h0ICE9PSB0aGlzLnN0eWxlLmhlaWdodCkge1xuICAgICAgdGhpcy5zdHlsZSA9IHsgLi4udGhpcy5zdHlsZSwgaGVpZ2h0IH07XG4gICAgfVxuXG4gICAgaWYgKCF2aXNpYmxlICYmICF0aGlzLnN0eWxlLmRpc3BsYXkpIHtcbiAgICAgIHRoaXMuc3R5bGUgPSB7IC4uLnRoaXMuc3R5bGUsIGRpc3BsYXk6ICdub25lJyB9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnN0eWxlO1xuICB9XG5cbiAgc2F2ZVJvd1JlZigpIHtcbiAgICB0aGlzLnJvd1JlZiA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpO1xuXG4gICAgY29uc3QgeyBpc0FueUNvbHVtbnNGaXhlZCwgZml4ZWQsIGV4cGFuZGVkUm93LCBhbmNlc3RvcktleXMgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIWlzQW55Q29sdW1uc0ZpeGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCFmaXhlZCAmJiBleHBhbmRlZFJvdykge1xuICAgICAgdGhpcy5zZXRFeHBhbmVkUm93SGVpZ2h0KCk7XG4gICAgfVxuXG4gICAgaWYgKCFmaXhlZCAmJiBhbmNlc3RvcktleXMubGVuZ3RoID49IDApIHtcbiAgICAgIHRoaXMuc2V0Um93SGVpZ2h0KCk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGlmICghdGhpcy5zaG91bGRSZW5kZXIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENscyxcbiAgICAgIGNvbHVtbnMsXG4gICAgICByZWNvcmQsXG4gICAgICBpbmRleCxcbiAgICAgIG9uUm93LFxuICAgICAgaW5kZW50LFxuICAgICAgaW5kZW50U2l6ZSxcbiAgICAgIGhvdmVyZWQsXG4gICAgICBoZWlnaHQsXG4gICAgICB2aXNpYmxlLFxuICAgICAgY29tcG9uZW50cyxcbiAgICAgIGhhc0V4cGFuZEljb24sXG4gICAgICByZW5kZXJFeHBhbmRJY29uLFxuICAgICAgcmVuZGVyRXhwYW5kSWNvbkNlbGwsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCBCb2R5Um93ID0gY29tcG9uZW50cy5ib2R5LnJvdztcbiAgICBjb25zdCBCb2R5Q2VsbCA9IGNvbXBvbmVudHMuYm9keS5jZWxsO1xuXG4gICAgbGV0IHsgY2xhc3NOYW1lIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGhvdmVyZWQpIHtcbiAgICAgIGNsYXNzTmFtZSArPSBgICR7cHJlZml4Q2xzfS1ob3ZlcmA7XG4gICAgfVxuXG4gICAgY29uc3QgY2VsbHMgPSBbXTtcblxuICAgIHJlbmRlckV4cGFuZEljb25DZWxsKGNlbGxzKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY29sdW1uID0gY29sdW1uc1tpXTtcblxuICAgICAgd2FybmluZyhcbiAgICAgICAgY29sdW1uLm9uQ2VsbENsaWNrID09PSB1bmRlZmluZWQsXG4gICAgICAgICdjb2x1bW5bb25DZWxsQ2xpY2tdIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgY29sdW1uW29uQ2VsbF0gaW5zdGVhZC4nLFxuICAgICAgKTtcblxuICAgICAgY2VsbHMucHVzaChcbiAgICAgICAgPFRhYmxlQ2VsbFxuICAgICAgICAgIHByZWZpeENscz17cHJlZml4Q2xzfVxuICAgICAgICAgIHJlY29yZD17cmVjb3JkfVxuICAgICAgICAgIGluZGVudFNpemU9e2luZGVudFNpemV9XG4gICAgICAgICAgaW5kZW50PXtpbmRlbnR9XG4gICAgICAgICAgaW5kZXg9e2luZGV4fVxuICAgICAgICAgIGNvbHVtbj17Y29sdW1ufVxuICAgICAgICAgIGtleT17Y29sdW1uLmtleSB8fCBjb2x1bW4uZGF0YUluZGV4fVxuICAgICAgICAgIGV4cGFuZEljb249e2hhc0V4cGFuZEljb24oaSkgJiYgcmVuZGVyRXhwYW5kSWNvbigpfVxuICAgICAgICAgIGNvbXBvbmVudD17Qm9keUNlbGx9XG4gICAgICAgIC8+XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHJvd0NsYXNzTmFtZSA9XG4gICAgICBgJHtwcmVmaXhDbHN9ICR7Y2xhc3NOYW1lfSAke3ByZWZpeENsc30tbGV2ZWwtJHtpbmRlbnR9YC50cmltKCk7XG5cbiAgICBjb25zdCByb3dQcm9wcyA9IG9uUm93KHJlY29yZCwgaW5kZXgpO1xuICAgIGNvbnN0IGN1c3RvbVN0eWxlID0gcm93UHJvcHMgPyByb3dQcm9wcy5zdHlsZSA6IHt9O1xuICAgIGxldCBzdHlsZSA9IHsgaGVpZ2h0IH07XG5cbiAgICBpZiAoIXZpc2libGUpIHtcbiAgICAgIHN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgfVxuXG4gICAgc3R5bGUgPSB7IC4uLnN0eWxlLCAuLi5jdXN0b21TdHlsZSB9O1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxCb2R5Um93XG4gICAgICAgIG9uQ2xpY2s9e3RoaXMub25Sb3dDbGlja31cbiAgICAgICAgb25Eb3VibGVDbGljaz17dGhpcy5vblJvd0RvdWJsZUNsaWNrfVxuICAgICAgICBvbk1vdXNlRW50ZXI9e3RoaXMub25Nb3VzZUVudGVyfVxuICAgICAgICBvbk1vdXNlTGVhdmU9e3RoaXMub25Nb3VzZUxlYXZlfVxuICAgICAgICBvbkNvbnRleHRNZW51PXt0aGlzLm9uQ29udGV4dE1lbnV9XG4gICAgICAgIGNsYXNzTmFtZT17cm93Q2xhc3NOYW1lfVxuICAgICAgICB7Li4ucm93UHJvcHN9XG4gICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgID5cbiAgICAgICAge2NlbGxzfVxuICAgICAgPC9Cb2R5Um93PlxuICAgICk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0Um93SGVpZ2h0KHN0YXRlLCBwcm9wcykge1xuICBjb25zdCB7IGV4cGFuZGVkUm93c0hlaWdodCwgZml4ZWRDb2x1bW5zQm9keVJvd3NIZWlnaHQgfSA9IHN0YXRlO1xuICBjb25zdCB7IGZpeGVkLCBpbmRleCwgcm93S2V5IH0gPSBwcm9wcztcblxuICBpZiAoIWZpeGVkKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAoZXhwYW5kZWRSb3dzSGVpZ2h0W3Jvd0tleV0pIHtcbiAgICByZXR1cm4gZXhwYW5kZWRSb3dzSGVpZ2h0W3Jvd0tleV07XG4gIH1cblxuICBpZiAoZml4ZWRDb2x1bW5zQm9keVJvd3NIZWlnaHRbaW5kZXhdKSB7XG4gICAgcmV0dXJuIGZpeGVkQ29sdW1uc0JvZHlSb3dzSGVpZ2h0W2luZGV4XTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KChzdGF0ZSwgcHJvcHMpID0+IHtcbiAgY29uc3QgeyBjdXJyZW50SG92ZXJLZXksIGV4cGFuZGVkUm93S2V5cyB9ID0gc3RhdGU7XG4gIGNvbnN0IHsgcm93S2V5LCBhbmNlc3RvcktleXMgfSA9IHByb3BzO1xuICBjb25zdCB2aXNpYmxlID0gYW5jZXN0b3JLZXlzLmxlbmd0aCA9PT0gMCB8fCBhbmNlc3RvcktleXMuZXZlcnkoayA9PiB+ZXhwYW5kZWRSb3dLZXlzLmluZGV4T2YoaykpO1xuXG4gIHJldHVybiAoe1xuICAgIHZpc2libGUsXG4gICAgaG92ZXJlZDogY3VycmVudEhvdmVyS2V5ID09PSByb3dLZXksXG4gICAgaGVpZ2h0OiBnZXRSb3dIZWlnaHQoc3RhdGUsIHByb3BzKSxcbiAgfSk7XG59KShUYWJsZVJvdyk7XG4iXX0=