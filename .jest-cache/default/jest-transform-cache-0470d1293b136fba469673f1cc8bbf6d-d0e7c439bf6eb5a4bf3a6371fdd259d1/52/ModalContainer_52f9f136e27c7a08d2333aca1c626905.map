{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components-pro/modal-container/ModalContainer.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { createPortal, render } from 'react-dom';\nimport classNames from 'classnames';\nimport findLast from 'lodash/findLast.js';\nimport noop from 'lodash/noop';\nimport measureScrollbar from 'choerodon-ui/lib/_util/measureScrollbar';\nimport { pxToRem } from 'choerodon-ui/lib/_util/UnitConvertor';\nimport warning from 'choerodon-ui/lib/_util/warning';\nimport { getProPrefixCls } from 'choerodon-ui/lib/configure';\nimport Modal, { ModalProps } from '../modal/Modal';\nimport Animate from '../animate';\nimport Mask from './Mask';\nimport { stopEvent } from '../_util/EventManager';\nimport { suffixCls } from '../modal/utils';\n\nconst KeyGen = (function*(id) {\n  while (true) {\n    yield `${getProPrefixCls(suffixCls)}-${id}`;\n    id += 1;\n  }\n})(1);\n\nconst containerInstanses: ModalContainer[] = [];\n\nfunction removeInstanse(instanse: ModalContainer) {\n  const index = containerInstanses.indexOf(instanse);\n  if (index > -1) {\n    containerInstanses.splice(index, 1);\n  }\n}\n\nfunction addInstanse(instanse: ModalContainer) {\n  removeInstanse(instanse);\n  containerInstanses.push(instanse);\n}\n\nexport function getKey(): string {\n  return KeyGen.next().value;\n}\n\nlet root;\nlet defaultBodyStyle: { overflow; paddingRight } | undefined;\n\nfunction getRoot() {\n  if (typeof window !== 'undefined') {\n    const doc = window.document;\n    if (root) {\n      if (!root.parentNode) {\n        doc.body.appendChild(root);\n      }\n    } else {\n      root = doc.createElement('div');\n      root.className = `${getProPrefixCls(suffixCls)}-container`;\n      doc.body.appendChild(root);\n    }\n  }\n  return root;\n}\n\n/**\n * 判断body是否有滚动条\n *\n * @returns {boolean}\n */\nfunction hasScrollBar(): boolean {\n  const { scrollHeight, clientHeight } = document.body;\n  return scrollHeight > clientHeight;\n}\n\nfunction hideBodyScrollBar() {\n  const { style } = document.body;\n  if (!defaultBodyStyle) {\n    defaultBodyStyle = {\n      overflow: style.overflow,\n      paddingRight: style.paddingRight,\n    };\n    style.overflow = 'hidden';\n    if (hasScrollBar()) {\n      style.paddingRight = pxToRem(measureScrollbar()) || '';\n    }\n  }\n}\n\nfunction showBodyScrollBar() {\n  const { style } = document.body;\n  if (defaultBodyStyle) {\n    const { overflow, paddingRight } = defaultBodyStyle;\n    defaultBodyStyle = undefined;\n    style.overflow = overflow;\n    style.paddingRight = paddingRight;\n  }\n}\n\nexport interface ModalContainerProps {\n  location?: { pathname: string };\n}\n\nexport interface ModalContainerState {\n  modals: ModalProps[];\n}\n\nexport default class ModalContainer extends Component<ModalContainerProps> {\n  static displayName = 'ModalContainer';\n\n  state: ModalContainerState = {\n    modals: [],\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.top();\n  }\n\n  handleAnimationEnd = (modalKey, isEnter) => {\n    if (!isEnter) {\n      const { modals } = this.state;\n      const index = this.findIndex(modalKey);\n      if (index !== -1) {\n        const props = modals[index];\n        modals.splice(index, 1);\n        if (!props.destroyOnClose) {\n          modals.unshift(props);\n        }\n        if (props.afterClose) {\n          props.afterClose();\n        }\n        this.setState({ modals });\n      }\n    }\n  };\n\n  handleMaskClick = async () => {\n    const { modals } = this.state;\n    const modal = findLast(modals, ({ hidden }) => !hidden);\n    if (modal) {\n      const { close = noop, onCancel = noop, maskClosable } = modal;\n      if (maskClosable) {\n        const ret = await onCancel();\n        if (ret !== false) {\n          close();\n        }\n      }\n    }\n  };\n\n  top(): ModalContainer {\n    addInstanse(this);\n    return this;\n  }\n\n  componentWillUpdate(nextProps) {\n    const { location } = nextProps;\n    const { location: currentLocation } = this.props;\n    if (location && currentLocation && location.pathname !== currentLocation.pathname) {\n      this.clear();\n    }\n    this.top();\n  }\n\n  componentWillUnmount() {\n    removeInstanse(this);\n  }\n\n  findIndex(modalKey) {\n    const { modals } = this.state;\n    return modals.findIndex(({ key }) => key === modalKey);\n  }\n\n  open(props: ModalProps) {\n    const { modals } = this.state;\n    if (!props.key) {\n      props.key = getKey();\n      warning(\n        !!props.destroyOnClose,\n        `The modal which opened has no key, please provide a key or set the \\`destroyOnClose\\` as true.`,\n      );\n    } else {\n      const index = this.findIndex(props.key);\n      if (index !== -1) {\n        modals.splice(index, 1);\n      }\n    }\n    modals.push({ ...props, hidden: false });\n    this.setState({ modals });\n  }\n\n  close(props: ModalProps) {\n    const { modals } = this.state;\n    const target = modals.find(({ key }) => key === props.key);\n    if (target) {\n      Object.assign(target, props, { hidden: true });\n      this.setState({ modals });\n    }\n  }\n\n  update(props: ModalProps) {\n    const { modals: originModals } = this.state;\n    const modals = [...originModals];\n    if (props.key) {\n      const index = this.findIndex(props.key);\n      if (index !== -1) {\n        modals[index] = props;\n        this.setState({ modals });\n      }\n    }\n  }\n\n  clear() {\n    const { modals } = this.state;\n    modals.forEach(modal => this.close({ ...modal, destroyOnClose: true }));\n  }\n\n  getOffset(modals, idx) {\n    const MARGIN_RIGHT_ARRAY: any = [];\n    const DEFAULT = 150;\n    const drawers = modals.filter(modal => modal.drawer && !modal.hidden);\n    const indexInDrawers = drawers.findIndex(drawer => drawer.key === modals[idx].key);\n    if (indexInDrawers === -1) {\n      return 0;\n    }\n    for (let i = drawers.length - 1; i >= indexInDrawers; i--) {\n      if (i === drawers.length - 1) {\n        MARGIN_RIGHT_ARRAY.push(0);\n      } else {\n        const CURRENT_WIDTH = this.getModalWidth(drawers[i]);\n        const NEXT_WIDTH = this.getModalWidth(drawers[i + 1]);\n        const NEXT_MARGIN = MARGIN_RIGHT_ARRAY[drawers.length - i - 2];\n        if (CURRENT_WIDTH >= NEXT_MARGIN + NEXT_WIDTH + DEFAULT) {\n          MARGIN_RIGHT_ARRAY.push(0);\n        } else {\n          MARGIN_RIGHT_ARRAY.push(NEXT_MARGIN + NEXT_WIDTH + DEFAULT - CURRENT_WIDTH);\n        }\n      }\n    }\n    return MARGIN_RIGHT_ARRAY[MARGIN_RIGHT_ARRAY.length - 1];\n  }\n\n  getModalWidth(modal) {\n    return (modal && modal.style && modal.style.width) || 520;\n  }\n\n  getComponent() {\n    let hidden = true;\n    const { modals } = this.state;\n    const items = modals.map((props, index) => {\n      const thisHidden = props.hidden;\n      const { drawerTransitionName = 'slide-right' } = props;\n      if (hidden && !thisHidden) {\n        hidden = false;\n      }\n      const newProps: any = {};\n      if (props.drawer) {\n        newProps.style = {\n          marginRight: this.getOffset(modals, index),\n          ...props.style,\n        };\n      }\n      if (index === modals.length - 1) {\n        newProps.className = classNames(props.className, `${getProPrefixCls(suffixCls)}-active`);\n      }\n      return (\n        <Animate\n          key={props.key}\n          component=\"div\"\n          transitionAppear\n          transitionName={props.drawer ? drawerTransitionName : 'zoom'}\n          hiddenProp=\"hidden\"\n          onEnd={this.handleAnimationEnd}\n        >\n          <Modal key={props.key} {...props} {...newProps} />\n        </Animate>\n      );\n    });\n    const animationProps: any = {};\n    if (typeof window !== 'undefined') {\n      if (hidden) {\n        animationProps.onEnd = showBodyScrollBar;\n      } else {\n        hideBodyScrollBar();\n      }\n    }\n    return (\n      <>\n        <Animate\n          component=\"\"\n          transitionAppear\n          transitionName=\"fade\"\n          hiddenProp=\"hidden\"\n          {...animationProps}\n        >\n          <Mask hidden={hidden} onClick={this.handleMaskClick} onMouseDown={stopEvent} />\n        </Animate>\n        {items}\n      </>\n    );\n  }\n\n  render() {\n    const mount = getRoot();\n    if (mount) {\n      return createPortal(this.getComponent(), mount);\n    }\n    return null;\n  }\n}\n\nexport function getContainer(loop?: boolean) {\n  const { length } = containerInstanses;\n  if (length) {\n    return containerInstanses[length - 1];\n  }\n  if (loop !== true) {\n    render(<ModalContainer />, getRoot());\n    return getContainer(true);\n  }\n}\n\nexport function open(props: ModalProps & { children }) {\n  const container = getContainer();\n\n  async function close(destroy?: boolean) {\n    const { onClose = noop } = props;\n    if ((await onClose()) !== false) {\n      if (destroy) {\n        container.close({ ...props, destroyOnClose: true });\n      } else {\n        container.close(props);\n      }\n    }\n  }\n\n  function show() {\n    container.open(props);\n  }\n\n  function update(newProps) {\n    container.update({ ...props, ...newProps });\n  }\n\n  props = {\n    close,\n    update,\n    ...Modal.defaultProps,\n    ...props,\n  };\n  container.open(props);\n\n  return {\n    close,\n    open: show,\n    update,\n  };\n}\n"]}