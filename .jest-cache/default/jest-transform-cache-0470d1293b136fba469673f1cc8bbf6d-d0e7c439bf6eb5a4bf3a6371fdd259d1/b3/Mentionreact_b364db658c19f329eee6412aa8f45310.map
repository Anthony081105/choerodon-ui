{"version":3,"sources":["Mention.react.jsx"],"names":["Mention","props","editorState","selection","getSelection","_decorator","getDecorator","content","getCurrentContent","onChange","setState","e","onFocus","focused","onBlur","_editor","Reset","mention","prefix","getPrefix","tag","mode","mentionStyle","Suggestions","plugins","state","suggestions","value","EditorState","createWithContent","CompositeDecorator","decorators","SelectionState","createEmpty","defaultValue","console","warn","undefined","controlledMode","nextProps","acceptSelection","Array","isArray","prefixCls","style","multiLines","suggestionStyle","placeholder","className","notFoundContent","getSuggestionContainer","readOnly","disabled","placement","editorClass","editorProps","defaultValueState","ContentState","createFromText","wrapper","_wrapper","editor","onEditorChange","onSearchChange","onSelect","noRedup","getUnderLine","Component","PropTypes","object","array","oneOfType","string","arrayOf","element","func","bool","any","position","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport { EditorCore } from 'rc-editor-core';\nimport { CompositeDecorator, ContentState, EditorState, SelectionState } from 'draft-js';\n\nimport createMention from '../utils/createMention';\nimport exportContent from '../utils/exportContent';\n\nclass Mention extends Component {\n  static propTypes = {\n    value: PropTypes.object,\n    suggestions: PropTypes.array,\n    prefix: PropTypes.oneOfType(\n      [PropTypes.string, PropTypes.arrayOf(PropTypes.string)],\n    ),\n    prefixCls: PropTypes.string,\n    tag: PropTypes.element,\n    style: PropTypes.object,\n    className: PropTypes.string,\n    onSearchChange: PropTypes.func,\n    onChange: PropTypes.func,\n    mode: PropTypes.string,\n    multiLines: PropTypes.bool,\n    suggestionStyle: PropTypes.object,\n    placeholder: PropTypes.string,\n    defaultValue: PropTypes.object,\n    notFoundContent: PropTypes.any,\n    position: PropTypes.string,\n    onFocus: PropTypes.func,\n    onBlur: PropTypes.func,\n    onSelect: PropTypes.func,\n    getSuggestionContainer: PropTypes.func,\n    noRedup: PropTypes.bool,\n    mentionStyle: PropTypes.object,\n    placement: PropTypes.string,\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.mention = createMention({\n      prefix: this.getPrefix(props),\n      tag: props.tag,\n      mode: props.mode,\n      mentionStyle: props.mentionStyle,\n    });\n\n    this.Suggestions = this.mention.Suggestions;\n    this.plugins = [this.mention];\n\n    this.state = {\n      suggestions: props.suggestions,\n      value: props.value && EditorState.createWithContent(props.value, new CompositeDecorator(this.mention.decorators)),\n      selection: SelectionState.createEmpty(),\n      focused: false,\n    };\n\n    if (typeof props.defaultValue === 'string') {\n      // eslint-disable-next-line\n      console.warn('The property `defaultValue` now allow `EditorState` only, see http://react-component.github.io/editor-mention/examples/defaultValue.html ');\n    }\n    if (props.value !== undefined) {\n      this.controlledMode = true;\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    const { suggestions } = nextProps;\n    const { selection } = this.state;\n    let value = nextProps.value;\n    if (value && selection) {\n      value = EditorState.acceptSelection(\n        EditorState.createWithContent(\n          value,\n          this._decorator,\n        ),\n        selection,\n      );\n    }\n    this.setState({\n      suggestions,\n      value,\n    });\n  }\n\n  onEditorChange = (editorState) => {\n    const selection = editorState.getSelection();\n    this._decorator = editorState.getDecorator();\n    const content = editorState.getCurrentContent();\n\n    if (this.props.onChange) {\n      this.setState({\n        selection,\n      }, () => {\n        this.props.onChange(content, exportContent(content));\n      });\n    } else {\n      this.setState({\n        editorState,\n        selection,\n      });\n    }\n  };\n  onFocus = (e) => {\n    if (this.props.onFocus) {\n      this.props.onFocus(e);\n    }\n    this.setState({ focused: true });\n  };\n  onBlur = (e) => {\n    if (this.props.onBlur) {\n      this.props.onBlur(e);\n    }\n    this.setState({ focused: false });\n  };\n\n  getPrefix(props = this.props) {\n    return Array.isArray(props.prefix) ? props.prefix : [props.prefix];\n  }\n\n  static controlledMode = false;\n\n  reset = () => {\n    /*eslint-disable*/\n    this._editor.Reset();\n    /*eslint-enable*/\n  };\n\n  getUnderLine() {\n    const { prefixCls } = this.props;\n    return (\n      <div className={`${prefixCls}-editor-underline`}>\n        <span className={`${prefixCls}-editor-ripple`} />\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      prefixCls, style, tag, multiLines,\n      suggestionStyle, placeholder, defaultValue, className, notFoundContent,\n      getSuggestionContainer, readOnly, disabled, placement,\n    } = this.props;\n    const { suggestions, focused } = this.state;\n    const { Suggestions } = this;\n    const editorClass = classnames(className, {\n      [`${prefixCls}-wrapper`]: true,\n      [`${prefixCls}-editor-focus`]: focused,\n      readonly: readOnly,\n      disabled,\n      multilines: multiLines,\n    });\n    const editorProps = this.controlledMode ? { value: this.state.value } : {};\n    const defaultValueState = defaultValue &&\n      EditorState.createWithContent(\n        typeof defaultValue === 'string' ? ContentState.createFromText(defaultValue) : defaultValue\n        , this._decorator);\n    return (\n      <div className={editorClass} style={style} ref={wrapper => this._wrapper = wrapper}>\n        <EditorCore\n          ref={editor => this._editor = editor}\n          prefixCls={prefixCls}\n          style={style}\n          multiLines={multiLines}\n          plugins={this.plugins}\n          defaultValue={defaultValueState}\n          placeholder={placeholder}\n          onFocus={this.onFocus}\n          onBlur={this.onBlur}\n          onChange={this.onEditorChange}\n          {...editorProps}\n          readOnly={readOnly || disabled}\n        >\n          <Suggestions\n            mode={tag ? 'immutable' : 'mutable'}\n            prefix={this.getPrefix()}\n            prefixCls={prefixCls}\n            style={suggestionStyle}\n            placement={placement}\n            notFoundContent={notFoundContent}\n            suggestions={suggestions}\n            getSuggestionContainer={getSuggestionContainer ? () => getSuggestionContainer(this._wrapper) : null}\n            onSearchChange={this.props.onSearchChange}\n            onSelect={this.props.onSelect}\n            noRedup={this.props.noRedup}\n          />\n        </EditorCore>\n        {this.getUnderLine()}\n      </div>\n    );\n  }\n}\n\nMention.defaultProps = {\n  prefixCls: 'rc-editor-mention',\n  prefix: '@',\n  mode: 'immutable',\n  suggestions: [],\n  multiLines: false,\n  className: '',\n  suggestionStyle: {},\n  notFoundContent: '无法找到',\n  position: 'absolute',\n  placement: 'bottom', // top, bottom\n  mentionStyle: {},\n};\n\nexport default Mention;\n"]}