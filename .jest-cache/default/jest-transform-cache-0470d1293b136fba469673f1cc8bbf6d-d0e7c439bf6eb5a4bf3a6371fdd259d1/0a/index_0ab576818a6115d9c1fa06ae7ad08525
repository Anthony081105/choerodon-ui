6790c73b950542ee5f06f3f9182c7135
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireDefault(require("react"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _isString = _interopRequireDefault(require("lodash/isString"));

var _icon = _interopRequireDefault(require("../icon"));

var _notification = _interopRequireDefault(require("../rc-components/notification"));

var _util = require("./util");

var _configure = require("../configure");

var defaultDuration = 3;
var defaultTop = 24;
var defaultBottom = 24;
var messageInstance;
var key = 1;
var customizePrefixCls;
var transitionName = 'move-up';
var defaultPlacement = 'leftBottom';
var getContainer;

function getCustomizePrefixCls() {
  return (0, _configure.getPrefixCls)('message', customizePrefixCls);
}

function getMessageInstance(placement, callback) {
  if (messageInstance) {
    callback(messageInstance);
    return;
  }

  _notification["default"].newInstance({
    prefixCls: getCustomizePrefixCls(),
    style: (0, _util.getPlacementStyle)(placement, defaultTop, defaultBottom),
    transitionName: (0, _util.getPlacementTransitionName)(placement, transitionName),
    getContainer: getContainer
  }, function (instance) {
    if (messageInstance) {
      callback(messageInstance);
      return;
    }

    messageInstance = instance;
    callback(instance);
  });
}

function notice(content) {
  var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultDuration;
  var type = arguments.length > 2 ? arguments[2] : undefined;
  var onClose = arguments.length > 3 ? arguments[3] : undefined;
  var placement = arguments.length > 4 ? arguments[4] : undefined;
  var iconType = {
    info: 'info',
    success: 'check_circle',
    error: 'error',
    warning: 'warning',
    loading: 'loading'
  }[type];

  if ((0, _isString["default"])(onClose)) {
    placement = onClose;
    onClose = _noop["default"];
  }

  if (typeof duration === 'function') {
    onClose = duration;
    duration = defaultDuration;
  } else if ((0, _isString["default"])(duration)) {
    placement = duration;
  }

  var target = key++;
  var prefixCls = getCustomizePrefixCls();
  getMessageInstance(placement || defaultPlacement, function (instance) {
    instance.notice({
      key: target,
      duration: duration,
      style: {},
      content: _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-custom-content ").concat(prefixCls, "-").concat(type)
      }, _react["default"].createElement(_icon["default"], {
        type: iconType
      }), _react["default"].createElement("span", null, content)),
      onClose: onClose
    });
  });
  return function () {
    if (messageInstance) {
      messageInstance.removeNotice(target);
    }
  };
}

var _default = {
  info: function info(content, duration, onClose, placement) {
    return notice(content, duration, 'info', onClose, placement);
  },
  success: function success(content, duration, onClose, placement) {
    return notice(content, duration, 'success', onClose, placement);
  },
  error: function error(content, duration, onClose, placement) {
    return notice(content, duration, 'error', onClose, placement);
  },
  // Departed usage, please use warning()
  warn: function warn(content, duration, onClose, placement) {
    return notice(content, duration, 'warning', onClose, placement);
  },
  warning: function warning(content, duration, onClose, placement) {
    return notice(content, duration, 'warning', onClose, placement);
  },
  loading: function loading(content, duration, onClose, placement) {
    return notice(content, duration, 'loading', onClose, placement);
  },
  config: function config(options) {
    if (options.top !== undefined) {
      defaultTop = options.top;
      messageInstance = null; // delete messageInstance for new defaultTop
    }

    if (options.bottom !== undefined) {
      defaultBottom = options.bottom;
      messageInstance = null; // delete messageInstance for new defaultBottom
    }

    if (options.duration !== undefined) {
      defaultDuration = options.duration;
    }

    if (options.prefixCls !== undefined) {
      customizePrefixCls = options.prefixCls;
    }

    if (options.getContainer !== undefined) {
      getContainer = options.getContainer;
    }

    if (options.transitionName !== undefined) {
      transitionName = options.transitionName;
      messageInstance = null; // delete messageInstance for new transitionName
    }

    if (options.placement !== undefined) {
      defaultPlacement = options.placement;
    }
  },
  destroy: function destroy() {
    if (messageInstance) {
      messageInstance.destroy();
      messageInstance = null;
    }
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2UvaW5kZXguanN4Il0sIm5hbWVzIjpbImRlZmF1bHREdXJhdGlvbiIsImRlZmF1bHRUb3AiLCJkZWZhdWx0Qm90dG9tIiwia2V5IiwidHJhbnNpdGlvbk5hbWUiLCJkZWZhdWx0UGxhY2VtZW50IiwiY2FsbGJhY2siLCJOb3RpZmljYXRpb24iLCJwcmVmaXhDbHMiLCJnZXRDdXN0b21pemVQcmVmaXhDbHMiLCJzdHlsZSIsImdldENvbnRhaW5lciIsIm1lc3NhZ2VJbnN0YW5jZSIsImR1cmF0aW9uIiwidHlwZSIsIm9uQ2xvc2UiLCJwbGFjZW1lbnQiLCJpY29uVHlwZSIsImluZm8iLCJzdWNjZXNzIiwiZXJyb3IiLCJ3YXJuaW5nIiwibG9hZGluZyIsIm5vb3AiLCJ0YXJnZXQiLCJnZXRNZXNzYWdlSW5zdGFuY2UiLCJpbnN0YW5jZSIsImNvbnRlbnQiLCJub3RpY2UiLCJ3YXJuIiwiY29uZmlnIiwib3B0aW9ucyIsImN1c3RvbWl6ZVByZWZpeENscyIsImRlc3Ryb3kiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsS0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGlCQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLEtBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLGFBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSwrQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxLQUFBLEdBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQTs7QUFDQSxJQUFBLFVBQUEsR0FBQSxPQUFBLENBQUEsY0FBQSxDQUFBOztBQUNBLElBQUlBLGVBQWUsR0FBbkIsQ0FBQTtBQUNBLElBQUlDLFVBQVUs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bSAncmVhY3QnO1xuaW1wb3J0IG5vb3AgZnJvbSAnbG9kYXNoL25vb3AnO1xuaW1wb3J0IGlzU3RyaW5nIGZyb20gJ2xvZGFzaC9pc1N0cmluZyc7XG5pbXBvcnQgSWNvbiBmcm9tICcuLi9pY29uJztcbmltcG9ydCBOb3RpZmljYXRpb24gZnJvbSAnLi4vcmMtY29tcG9uZW50cy9ub3RpZmljYXRpb24nO1xuaW1wb3J0IHsgZ2V0UGxhY2VtZW50U3R5bGUsIGdldFBsYWNlbWVudFRyYW5zaXRpb25OYW1lIH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7IGdldFByZWZpeENscyB9IGZyb20gJy4uL2NvbmZpZ3VyZSc7XG5sZXQgZGVmYXVsdER1cmF0aW9uID0gMztcbmxldCBkZWZhdWx0VG9wID0gMjQ7XG5sZXQgZGVmYXVsdEJvdHRvbSA9IDI0O1xubGV0IG1lc3NhZ2VJbnN0YW5jZTtcbmxldCBrZXkgPSAxO1xubGV0IGN1c3RvbWl6ZVByZWZpeENscztcbmxldCB0cmFuc2l0aW9uTmFtZSA9ICdtb3ZlLXVwJztcbmxldCBkZWZhdWx0UGxhY2VtZW50ID0gJ2xlZnRCb3R0b20nO1xubGV0IGdldENvbnRhaW5lcjtcbmZ1bmN0aW9uIGdldEN1c3RvbWl6ZVByZWZpeENscygpIHtcbiAgICByZXR1cm4gZ2V0UHJlZml4Q2xzKCdtZXNzYWdlJywgY3VzdG9taXplUHJlZml4Q2xzKTtcbn1cbmZ1bmN0aW9uIGdldE1lc3NhZ2VJbnN0YW5jZShwbGFjZW1lbnQsIGNhbGxiYWNrKSB7XG4gICAgaWYgKG1lc3NhZ2VJbnN0YW5jZSkge1xuICAgICAgICBjYWxsYmFjayhtZXNzYWdlSW5zdGFuY2UpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIE5vdGlmaWNhdGlvbi5uZXdJbnN0YW5jZSh7XG4gICAgICAgIHByZWZpeENsczogZ2V0Q3VzdG9taXplUHJlZml4Q2xzKCksXG4gICAgICAgIHN0eWxlOiBnZXRQbGFjZW1lbnRTdHlsZShwbGFjZW1lbnQsIGRlZmF1bHRUb3AsIGRlZmF1bHRCb3R0b20pLFxuICAgICAgICB0cmFuc2l0aW9uTmFtZTogZ2V0UGxhY2VtZW50VHJhbnNpdGlvbk5hbWUocGxhY2VtZW50LCB0cmFuc2l0aW9uTmFtZSksXG4gICAgICAgIGdldENvbnRhaW5lcixcbiAgICB9LCAoaW5zdGFuY2UpID0+IHtcbiAgICAgICAgaWYgKG1lc3NhZ2VJbnN0YW5jZSkge1xuICAgICAgICAgICAgY2FsbGJhY2sobWVzc2FnZUluc3RhbmNlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBtZXNzYWdlSW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICAgICAgY2FsbGJhY2soaW5zdGFuY2UpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uID0gZGVmYXVsdER1cmF0aW9uLCB0eXBlLCBvbkNsb3NlLCBwbGFjZW1lbnQpIHtcbiAgICBjb25zdCBpY29uVHlwZSA9IHtcbiAgICAgICAgaW5mbzogJ2luZm8nLFxuICAgICAgICBzdWNjZXNzOiAnY2hlY2tfY2lyY2xlJyxcbiAgICAgICAgZXJyb3I6ICdlcnJvcicsXG4gICAgICAgIHdhcm5pbmc6ICd3YXJuaW5nJyxcbiAgICAgICAgbG9hZGluZzogJ2xvYWRpbmcnLFxuICAgIH1bdHlwZV07XG4gICAgaWYgKGlzU3RyaW5nKG9uQ2xvc2UpKSB7XG4gICAgICAgIHBsYWNlbWVudCA9IG9uQ2xvc2U7XG4gICAgICAgIG9uQ2xvc2UgPSBub29wO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGR1cmF0aW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG9uQ2xvc2UgPSBkdXJhdGlvbjtcbiAgICAgICAgZHVyYXRpb24gPSBkZWZhdWx0RHVyYXRpb247XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzU3RyaW5nKGR1cmF0aW9uKSkge1xuICAgICAgICBwbGFjZW1lbnQgPSBkdXJhdGlvbjtcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0ID0ga2V5Kys7XG4gICAgY29uc3QgcHJlZml4Q2xzID0gZ2V0Q3VzdG9taXplUHJlZml4Q2xzKCk7XG4gICAgZ2V0TWVzc2FnZUluc3RhbmNlKHBsYWNlbWVudCB8fCBkZWZhdWx0UGxhY2VtZW50LCBpbnN0YW5jZSA9PiB7XG4gICAgICAgIGluc3RhbmNlLm5vdGljZSh7XG4gICAgICAgICAgICBrZXk6IHRhcmdldCxcbiAgICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgICAgc3R5bGU6IHt9LFxuICAgICAgICAgICAgY29udGVudDogKDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWN1c3RvbS1jb250ZW50ICR7cHJlZml4Q2xzfS0ke3R5cGV9YH0+XG4gICAgICAgICAgPEljb24gdHlwZT17aWNvblR5cGV9Lz5cbiAgICAgICAgICA8c3Bhbj57Y29udGVudH08L3NwYW4+XG4gICAgICAgIDwvZGl2PiksXG4gICAgICAgICAgICBvbkNsb3NlLFxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBpZiAobWVzc2FnZUluc3RhbmNlKSB7XG4gICAgICAgICAgICBtZXNzYWdlSW5zdGFuY2UucmVtb3ZlTm90aWNlKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0IGRlZmF1bHQge1xuICAgIGluZm8oY29udGVudCwgZHVyYXRpb24sIG9uQ2xvc2UsIHBsYWNlbWVudCkge1xuICAgICAgICByZXR1cm4gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uLCAnaW5mbycsIG9uQ2xvc2UsIHBsYWNlbWVudCk7XG4gICAgfSxcbiAgICBzdWNjZXNzKGNvbnRlbnQsIGR1cmF0aW9uLCBvbkNsb3NlLCBwbGFjZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG5vdGljZShjb250ZW50LCBkdXJhdGlvbiwgJ3N1Y2Nlc3MnLCBvbkNsb3NlLCBwbGFjZW1lbnQpO1xuICAgIH0sXG4gICAgZXJyb3IoY29udGVudCwgZHVyYXRpb24sIG9uQ2xvc2UsIHBsYWNlbWVudCkge1xuICAgICAgICByZXR1cm4gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uLCAnZXJyb3InLCBvbkNsb3NlLCBwbGFjZW1lbnQpO1xuICAgIH0sXG4gICAgLy8gRGVwYXJ0ZWQgdXNhZ2UsIHBsZWFzZSB1c2Ugd2FybmluZygpXG4gICAgd2Fybihjb250ZW50LCBkdXJhdGlvbiwgb25DbG9zZSwgcGxhY2VtZW50KSB7XG4gICAgICAgIHJldHVybiBub3RpY2UoY29udGVudCwgZHVyYXRpb24sICd3YXJuaW5nJywgb25DbG9zZSwgcGxhY2VtZW50KTtcbiAgICB9LFxuICAgIHdhcm5pbmcoY29udGVudCwgZHVyYXRpb24sIG9uQ2xvc2UsIHBsYWNlbWVudCkge1xuICAgICAgICByZXR1cm4gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uLCAnd2FybmluZycsIG9uQ2xvc2UsIHBsYWNlbWVudCk7XG4gICAgfSxcbiAgICBsb2FkaW5nKGNvbnRlbnQsIGR1cmF0aW9uLCBvbkNsb3NlLCBwbGFjZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG5vdGljZShjb250ZW50LCBkdXJhdGlvbiwgJ2xvYWRpbmcnLCBvbkNsb3NlLCBwbGFjZW1lbnQpO1xuICAgIH0sXG4gICAgY29uZmlnKG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRlZmF1bHRUb3AgPSBvcHRpb25zLnRvcDtcbiAgICAgICAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IG51bGw7IC8vIGRlbGV0ZSBtZXNzYWdlSW5zdGFuY2UgZm9yIG5ldyBkZWZhdWx0VG9wXG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuYm90dG9tICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRlZmF1bHRCb3R0b20gPSBvcHRpb25zLmJvdHRvbTtcbiAgICAgICAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IG51bGw7IC8vIGRlbGV0ZSBtZXNzYWdlSW5zdGFuY2UgZm9yIG5ldyBkZWZhdWx0Qm90dG9tXG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuZHVyYXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZGVmYXVsdER1cmF0aW9uID0gb3B0aW9ucy5kdXJhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5wcmVmaXhDbHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY3VzdG9taXplUHJlZml4Q2xzID0gb3B0aW9ucy5wcmVmaXhDbHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuZ2V0Q29udGFpbmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGdldENvbnRhaW5lciA9IG9wdGlvbnMuZ2V0Q29udGFpbmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnRyYW5zaXRpb25OYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRyYW5zaXRpb25OYW1lID0gb3B0aW9ucy50cmFuc2l0aW9uTmFtZTtcbiAgICAgICAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IG51bGw7IC8vIGRlbGV0ZSBtZXNzYWdlSW5zdGFuY2UgZm9yIG5ldyB0cmFuc2l0aW9uTmFtZVxuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnBsYWNlbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkZWZhdWx0UGxhY2VtZW50ID0gb3B0aW9ucy5wbGFjZW1lbnQ7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGlmIChtZXNzYWdlSW5zdGFuY2UpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VJbnN0YW5jZS5kZXN0cm95KCk7XG4gICAgICAgICAgICBtZXNzYWdlSW5zdGFuY2UgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcbn07XG4iXX0=