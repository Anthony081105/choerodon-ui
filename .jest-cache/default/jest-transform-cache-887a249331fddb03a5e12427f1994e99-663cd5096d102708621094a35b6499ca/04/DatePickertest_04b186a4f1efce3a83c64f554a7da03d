57f60533d657e5a3bee0efca041ae4e7
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _enzyme = require("enzyme");

var _moment = _interopRequireDefault(require("moment"));

var _mockdate = _interopRequireDefault(require("mockdate"));

var _ = _interopRequireDefault(require(".."));

var _utils = require("./utils");

var _focusTest = _interopRequireDefault(require("../../../tests/shared/focusTest"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

describe('DatePicker', function () {
  (0, _focusTest["default"])(_["default"]);
  beforeEach(function () {
    _mockdate["default"].set((0, _moment["default"])('2016-11-22'));
  });
  afterEach(function () {
    _mockdate["default"].reset();
  });
  it('prop locale should works', function () {
    var locale = {
      lang: {
        placeholder: 'Избери дата',
        rangePlaceholder: ['Начална дата', 'Крайна дата'],
        today: 'Днес',
        now: 'Сега',
        backToToday: 'Към днес',
        ok: 'Добре',
        clear: 'Изчистване',
        month: 'Месец',
        year: 'Година',
        timeSelect: 'Избор на час',
        dateSelect: 'Избор на дата',
        monthSelect: 'Избор на месец',
        yearSelect: 'Избор на година',
        decadeSelect: 'Десетилетие',
        previousMonth: 'Предишен месец (PageUp)',
        nextMonth: 'Следващ месец (PageDown)',
        previousYear: 'Последна година (Control + left)',
        nextYear: 'Следваща година (Control + right)',
        previousDecade: 'Предишно десетилетие',
        nextDecade: 'Следващо десетилетие',
        previousCentury: 'Последен век',
        nextCentury: 'Следващ век',
        yearFormat: 'YYYY',
        dateFormat: 'D M YYYY',
        dayFormat: 'D',
        dateTimeFormat: 'D M YYYY HH:mm:ss',
        monthBeforeYear: true
      },
      timePickerLocale: {
        placeholder: 'Избор на час'
      }
    };
    var birthday = (0, _moment["default"])('2000-01-01', 'YYYY-MM-DD');
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      open: true,
      locale: locale,
      value: birthday
    }));
    expect(wrapper.render()).toMatchSnapshot();
  });
  it('control value after panel closed', function () {
    var Test =
    /*#__PURE__*/
    function (_React$Component) {
      (0, _inherits2["default"])(Test, _React$Component);

      var _super = _createSuper(Test);

      function Test() {
        var _this;

        (0, _classCallCheck2["default"])(this, Test);

        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        _this = _super.call.apply(_super, [this].concat(args));
        (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
          cleared: false,
          value: (0, _moment["default"])()
        });
        (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onChange", function (value) {
          var cleared = _this.state.cleared;

          if (cleared) {
            value = (0, _moment["default"])((0, _moment["default"])(value).format('YYYY-MM-DD 12:12:12'));
            cleared = false;
          }

          if (!value) {
            cleared = true;
          }

          _this.setState({
            value: value,
            cleared: cleared
          });
        });
        return _this;
      }

      (0, _createClass2["default"])(Test, [{
        key: "render",
        value: function render() {
          var value = this.state.value;
          return _react["default"].createElement(_["default"], {
            showTime: true,
            value: value,
            format: "YYYY-MM-DD HH:mm:ss",
            onChange: this.onChange
          });
        }
      }]);
      return Test;
    }(_react["default"].Component);

    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(Test, null)); // clear input

    (0, _utils.clearInput)(wrapper);
    (0, _utils.openPanel)(wrapper);
    (0, _utils.selectDate)(wrapper, (0, _moment["default"])('2016-11-13'));
    expect(wrapper.find('.c7n-calendar-input').getDOMNode().value).toBe('2016-11-13 12:12:12');
    (0, _utils.selectDate)(wrapper, (0, _moment["default"])('2016-11-14'));
    expect(wrapper.find('.c7n-calendar-input').getDOMNode().value).toBe('2016-11-14 12:12:12');
  });
  it('triggers onChange only when date was selected', function () {
    var handleChange = jest.fn();
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      onChange: handleChange
    }));
    (0, _utils.openPanel)(wrapper);
    (0, _utils.nextYear)(wrapper);
    expect(handleChange).not.toHaveBeenCalled();
    (0, _utils.nextMonth)(wrapper);
    expect(handleChange).not.toHaveBeenCalled();
    (0, _utils.selectDate)(wrapper, (0, _moment["default"])('2017-12-22'));
    expect(handleChange).toHaveBeenCalled();
  });
  it('clear input', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    (0, _utils.openPanel)(wrapper);
    (0, _utils.selectDate)(wrapper, (0, _moment["default"])('2016-11-23'));
    (0, _utils.clearInput)(wrapper);
    (0, _utils.openPanel)(wrapper);
    expect((0, _utils.hasSelected)(wrapper, (0, _moment["default"])('2016-11-22'))).toBe(true);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGVQaWNrZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJkZXNjcmliZSIsIkRhdGVQaWNrZXIiLCJiZWZvcmVFYWNoIiwiTW9ja0RhdGUiLCJzZXQiLCJhZnRlckVhY2giLCJyZXNldCIsIml0IiwibG9jYWxlIiwibGFuZyIsInBsYWNlaG9sZGVyIiwicmFuZ2VQbGFjZWhvbGRlciIsInRvZGF5Iiwibm93IiwiYmFja1RvVG9kYXkiLCJvayIsImNsZWFyIiwibW9udGgiLCJ5ZWFyIiwidGltZVNlbGVjdCIsImRhdGVTZWxlY3QiLCJtb250aFNlbGVjdCIsInllYXJTZWxlY3QiLCJkZWNhZGVTZWxlY3QiLCJwcmV2aW91c01vbnRoIiwibmV4dE1vbnRoIiwicHJldmlvdXNZZWFyIiwibmV4dFllYXIiLCJwcmV2aW91c0RlY2FkZSIsIm5leHREZWNhZGUiLCJwcmV2aW91c0NlbnR1cnkiLCJuZXh0Q2VudHVyeSIsInllYXJGb3JtYXQiLCJkYXRlRm9ybWF0IiwiZGF5Rm9ybWF0IiwiZGF0ZVRpbWVGb3JtYXQiLCJtb250aEJlZm9yZVllYXIiLCJ0aW1lUGlja2VyTG9jYWxlIiwiYmlydGhkYXkiLCJ3cmFwcGVyIiwiZXhwZWN0IiwicmVuZGVyIiwidG9NYXRjaFNuYXBzaG90IiwiVGVzdCIsImNsZWFyZWQiLCJ2YWx1ZSIsInN0YXRlIiwiZm9ybWF0Iiwic2V0U3RhdGUiLCJvbkNoYW5nZSIsIlJlYWN0IiwiQ29tcG9uZW50IiwiZmluZCIsImdldERPTU5vZGUiLCJ0b0JlIiwiaGFuZGxlQ2hhbmdlIiwiamVzdCIsImZuIiwibm90IiwidG9IYXZlQmVlbkNhbGxlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQUEsUUFBUSxDQUFDLFlBQUQsRUFBZSxZQUFNO0FBQzNCLDZCQUFVQyxZQUFWO0FBRUFDLEVBQUFBLFVB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Q0EsMEJBQVVoQixPQUFWO0FBQ0EseUJBQVNBLE9BQVQ7QUFDQUMsSUFBQUEsTUFBTSxDQUFDZSxZQUFELENBQU4sQ0FBcUJHLEdBQXJCLENBQXlCQyxnQkFBekI7QUFDQSwwQkFBVXBCLE9BQVY7QUFDQUMsSUFBQUEsTUFBTSxDQUFDZSxZQUFELENBQU4sQ0FBcUJHLEdBQXJCLENBQXlCQyxnQkFBekI7QUFDQSwyQkFBV3BCLE9BQVgsRUFBb0Isd0JBQU8sWUFBUCxDQUFwQjtBQUNBQyxJQUFBQSxNQUFNLENBQUNlLFlBQUQsQ0FBTixDQUFxQkksZ0JBQXJCO0FBQ0QsR0FWQyxDQUFGO0FBWUFwRCxFQUFBQSxFQUFFLENBQUMsYUFBRCxFQUFnQixZQUFNO0FBQ3RCLFFBQU1nQyxPQUFPLEdBQUcsbUJBQU0sZ0NBQUMsWUFBRCxPQUFOLENBQWhCO0FBQ0EsMEJBQVVBLE9BQVY7QUFDQSwyQkFBV0EsT0FBWCxFQUFvQix3QkFBTyxZQUFQLENBQXBCO0FBQ0EsMkJBQVdBLE9BQVg7QUFDQSwwQkFBVUEsT0FBVjtBQUNBQyxJQUFBQSxNQUFNLENBQUMsd0JBQVlELE9BQVosRUFBcUIsd0JBQU8sWUFBUCxDQUFyQixDQUFELENBQU4sQ0FBbURlLElBQW5ELENBQXdELElBQXhEO0FBQ0QsR0FQQyxDQUFGO0FBUUQsQ0FwSE8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBtb3VudCB9IGZyb20gJ2VuenltZSc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5pbXBvcnQgTW9ja0RhdGUgZnJvbSAnbW9ja2RhdGUnO1xuaW1wb3J0IERhdGVQaWNrZXIgZnJvbSAnLi4nO1xuaW1wb3J0IHsgc2VsZWN0RGF0ZSwgb3BlblBhbmVsLCBjbGVhcklucHV0LCBuZXh0WWVhciwgbmV4dE1vbnRoLCBoYXNTZWxlY3RlZCB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IGZvY3VzVGVzdCBmcm9tICcuLi8uLi8uLi90ZXN0cy9zaGFyZWQvZm9jdXNUZXN0JztcblxuZGVzY3JpYmUoJ0RhdGVQaWNrZXInLCAoKSA9PiB7XG4gIGZvY3VzVGVzdChEYXRlUGlja2VyKTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBNb2NrRGF0ZS5zZXQobW9tZW50KCcyMDE2LTExLTIyJykpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIE1vY2tEYXRlLnJlc2V0KCk7XG4gIH0pO1xuXG4gIGl0KCdwcm9wIGxvY2FsZSBzaG91bGQgd29ya3MnLCAoKSA9PiB7XG4gICAgY29uc3QgbG9jYWxlID0ge1xuICAgICAgbGFuZzoge1xuICAgICAgICBwbGFjZWhvbGRlcjogJ9CY0LfQsdC10YDQuCDQtNCw0YLQsCcsXG4gICAgICAgIHJhbmdlUGxhY2Vob2xkZXI6IFsn0J3QsNGH0LDQu9C90LAg0LTQsNGC0LAnLCAn0JrRgNCw0LnQvdCwINC00LDRgtCwJ10sXG4gICAgICAgIHRvZGF5OiAn0JTQvdC10YEnLFxuICAgICAgICBub3c6ICfQodC10LPQsCcsXG4gICAgICAgIGJhY2tUb1RvZGF5OiAn0JrRitC8INC00L3QtdGBJyxcbiAgICAgICAgb2s6ICfQlNC+0LHRgNC1JyxcbiAgICAgICAgY2xlYXI6ICfQmNC30YfQuNGB0YLQstCw0L3QtScsXG4gICAgICAgIG1vbnRoOiAn0JzQtdGB0LXRhicsXG4gICAgICAgIHllYXI6ICfQk9C+0LTQuNC90LAnLFxuICAgICAgICB0aW1lU2VsZWN0OiAn0JjQt9Cx0L7RgCDQvdCwINGH0LDRgScsXG4gICAgICAgIGRhdGVTZWxlY3Q6ICfQmNC30LHQvtGAINC90LAg0LTQsNGC0LAnLFxuICAgICAgICBtb250aFNlbGVjdDogJ9CY0LfQsdC+0YAg0L3QsCDQvNC10YHQtdGGJyxcbiAgICAgICAgeWVhclNlbGVjdDogJ9CY0LfQsdC+0YAg0L3QsCDQs9C+0LTQuNC90LAnLFxuICAgICAgICBkZWNhZGVTZWxlY3Q6ICfQlNC10YHQtdGC0LjQu9C10YLQuNC1JyxcbiAgICAgICAgcHJldmlvdXNNb250aDogJ9Cf0YDQtdC00LjRiNC10L0g0LzQtdGB0LXRhiAoUGFnZVVwKScsXG4gICAgICAgIG5leHRNb250aDogJ9Ch0LvQtdC00LLQsNGJINC80LXRgdC10YYgKFBhZ2VEb3duKScsXG4gICAgICAgIHByZXZpb3VzWWVhcjogJ9Cf0L7RgdC70LXQtNC90LAg0LPQvtC00LjQvdCwIChDb250cm9sICsgbGVmdCknLFxuICAgICAgICBuZXh0WWVhcjogJ9Ch0LvQtdC00LLQsNGJ0LAg0LPQvtC00LjQvdCwIChDb250cm9sICsgcmlnaHQpJyxcbiAgICAgICAgcHJldmlvdXNEZWNhZGU6ICfQn9GA0LXQtNC40YjQvdC+INC00LXRgdC10YLQuNC70LXRgtC40LUnLFxuICAgICAgICBuZXh0RGVjYWRlOiAn0KHQu9C10LTQstCw0YnQviDQtNC10YHQtdGC0LjQu9C10YLQuNC1JyxcbiAgICAgICAgcHJldmlvdXNDZW50dXJ5OiAn0J/QvtGB0LvQtdC00LXQvSDQstC10LonLFxuICAgICAgICBuZXh0Q2VudHVyeTogJ9Ch0LvQtdC00LLQsNGJINCy0LXQuicsXG4gICAgICAgIHllYXJGb3JtYXQ6ICdZWVlZJyxcbiAgICAgICAgZGF0ZUZvcm1hdDogJ0QgTSBZWVlZJyxcbiAgICAgICAgZGF5Rm9ybWF0OiAnRCcsXG4gICAgICAgIGRhdGVUaW1lRm9ybWF0OiAnRCBNIFlZWVkgSEg6bW06c3MnLFxuICAgICAgICBtb250aEJlZm9yZVllYXI6IHRydWUsXG4gICAgICB9LFxuICAgICAgdGltZVBpY2tlckxvY2FsZToge1xuICAgICAgICBwbGFjZWhvbGRlcjogJ9CY0LfQsdC+0YAg0L3QsCDRh9Cw0YEnLFxuICAgICAgfSxcbiAgICB9O1xuICAgIGNvbnN0IGJpcnRoZGF5ID0gbW9tZW50KCcyMDAwLTAxLTAxJywgJ1lZWVktTU0tREQnKTtcbiAgICBjb25zdCB3cmFwcGVyID0gbW91bnQoPERhdGVQaWNrZXIgb3BlbiBsb2NhbGU9e2xvY2FsZX0gdmFsdWU9e2JpcnRoZGF5fSAvPik7XG4gICAgZXhwZWN0KHdyYXBwZXIucmVuZGVyKCkpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBpdCgnY29udHJvbCB2YWx1ZSBhZnRlciBwYW5lbCBjbG9zZWQnLCAoKSA9PiB7XG4gICAgY2xhc3MgVGVzdCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgICBzdGF0ZSA9IHtcbiAgICAgICAgY2xlYXJlZDogZmFsc2UsXG4gICAgICAgIHZhbHVlOiBtb21lbnQoKSxcbiAgICAgIH07XG5cbiAgICAgIG9uQ2hhbmdlID0gdmFsdWUgPT4ge1xuICAgICAgICBsZXQgeyBjbGVhcmVkIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgICAgIGlmIChjbGVhcmVkKSB7XG4gICAgICAgICAgdmFsdWUgPSBtb21lbnQobW9tZW50KHZhbHVlKS5mb3JtYXQoJ1lZWVktTU0tREQgMTI6MTI6MTInKSk7XG4gICAgICAgICAgY2xlYXJlZCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgIGNsZWFyZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlLCBjbGVhcmVkIH0pO1xuICAgICAgfTtcblxuICAgICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxEYXRlUGlja2VyXG4gICAgICAgICAgICBzaG93VGltZVxuICAgICAgICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgICAgICAgZm9ybWF0PVwiWVlZWS1NTS1ERCBISDptbTpzc1wiXG4gICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5vbkNoYW5nZX1cbiAgICAgICAgICAvPlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHdyYXBwZXIgPSBtb3VudCg8VGVzdCAvPik7XG4gICAgLy8gY2xlYXIgaW5wdXRcbiAgICBjbGVhcklucHV0KHdyYXBwZXIpO1xuICAgIG9wZW5QYW5lbCh3cmFwcGVyKTtcbiAgICBzZWxlY3REYXRlKHdyYXBwZXIsIG1vbWVudCgnMjAxNi0xMS0xMycpKTtcbiAgICBleHBlY3Qod3JhcHBlci5maW5kKCcuYzduLWNhbGVuZGFyLWlucHV0JykuZ2V0RE9NTm9kZSgpLnZhbHVlKS50b0JlKCcyMDE2LTExLTEzIDEyOjEyOjEyJyk7XG4gICAgc2VsZWN0RGF0ZSh3cmFwcGVyLCBtb21lbnQoJzIwMTYtMTEtMTQnKSk7XG4gICAgZXhwZWN0KHdyYXBwZXIuZmluZCgnLmM3bi1jYWxlbmRhci1pbnB1dCcpLmdldERPTU5vZGUoKS52YWx1ZSkudG9CZSgnMjAxNi0xMS0xNCAxMjoxMjoxMicpO1xuICB9KTtcblxuICBpdCgndHJpZ2dlcnMgb25DaGFuZ2Ugb25seSB3aGVuIGRhdGUgd2FzIHNlbGVjdGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGhhbmRsZUNoYW5nZSA9IGplc3QuZm4oKTtcbiAgICBjb25zdCB3cmFwcGVyID0gbW91bnQoPERhdGVQaWNrZXIgb25DaGFuZ2U9e2hhbmRsZUNoYW5nZX0gLz4pO1xuICAgIG9wZW5QYW5lbCh3cmFwcGVyKTtcbiAgICBuZXh0WWVhcih3cmFwcGVyKTtcbiAgICBleHBlY3QoaGFuZGxlQ2hhbmdlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIG5leHRNb250aCh3cmFwcGVyKTtcbiAgICBleHBlY3QoaGFuZGxlQ2hhbmdlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIHNlbGVjdERhdGUod3JhcHBlciwgbW9tZW50KCcyMDE3LTEyLTIyJykpO1xuICAgIGV4cGVjdChoYW5kbGVDaGFuZ2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ2NsZWFyIGlucHV0JywgKCkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBtb3VudCg8RGF0ZVBpY2tlciAvPik7XG4gICAgb3BlblBhbmVsKHdyYXBwZXIpO1xuICAgIHNlbGVjdERhdGUod3JhcHBlciwgbW9tZW50KCcyMDE2LTExLTIzJykpO1xuICAgIGNsZWFySW5wdXQod3JhcHBlcik7XG4gICAgb3BlblBhbmVsKHdyYXBwZXIpO1xuICAgIGV4cGVjdChoYXNTZWxlY3RlZCh3cmFwcGVyLCBtb21lbnQoJzIwMTYtMTEtMjInKSkpLnRvQmUodHJ1ZSk7XG4gIH0pO1xufSk7XG4iXX0=