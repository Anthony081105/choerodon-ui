{"version":3,"sources":["Suggestions.react.jsx"],"names":["isNotFalse","i","Suggestions","props","editorState","offset","store","getOffset","size","closeDropDown","selection","getSelection","callbacks","getEditorState","getHasFocus","word","selectionInsideMention","map","offsetKey","blockKey","decoratorKey","leafKey","anchorKey","leaf","getBlockTree","getIn","startKey","get","endKey","anchorOffset","selectionInText","some","activeOffsetKey","find","trigger","getTrigger","searchValue","substring","length","lastSearchValue","lastTrigger","onSearchChange","state","active","indexOf","openDropDown","ev","preventDefault","suggestions","newIndex","focusedIndex","setState","Math","max","popupContainer","document","createElement","mountNode","getSuggestionContainer","style","position","body","appendChild","command","selectedSuggestion","onMentionSelect","value","data","container","dropdownContainer","dropDownPosition","placement","dropDownStyle","getPositionStyle","isTopCrowded","parseFloat","top","window","scrollY","offsetHeight","isBottomCrowded","innerHeight","documentElement","clientHeight","Object","keys","forEach","key","focusItem","ReactDOM","findDOMNode","onlyScrollIfNeeded","prefixCls","Children","element","index","ref","node","mentionClass","focus","className","onMouseDown","notFoundContent","isActive","onChange","onEditorStateChange","nextProps","mention","onSelect","noRedup","mentions","getCurrentContent","console","warn","setEditorState","mode","getSuggestionStyle","left","onUpArrow","handleReturn","handleKeyBinding","onDownArrow","onBlur","getContainer","cls","transitionName","navigations","getNavigations","renderReady","Component","PropTypes","object","array","func","string","any","bool"],"mappings":"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","sourcesContent":["import React, { Children, cloneElement, Component, isValidElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { decode } from 'draft-js/lib/DraftOffsetKey';\nimport cx from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\nimport Animate from '../../../animate';\nimport Nav from './Nav.react';\nimport SuggetionWrapper from './SuggestionWrapper.react';\nimport insertMention from '../utils/insertMention';\nimport clearMention from '../utils/clearMention';\nimport getOffset from '../utils/getOffset';\nimport getMentions from '../utils/getMentions';\nimport getSearchWord from '../utils/getSearchWord';\n\nconst isNotFalse = i => i !== false;\n\nexport default class Suggestions extends Component {\n  static propTypes = {\n    callbacks: PropTypes.object,\n    suggestions: PropTypes.array,\n    store: PropTypes.object,\n    onSearchChange: PropTypes.func,\n    prefixCls: PropTypes.string,\n    mode: PropTypes.string,\n    style: PropTypes.object,\n    onSelect: PropTypes.func,\n    getSuggestionContainer: PropTypes.func,\n    notFoundContent: PropTypes.any,\n    getSuggestionStyle: PropTypes.func,\n    className: PropTypes.string,\n    noRedup: PropTypes.bool,\n    placement: PropTypes.string,\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isActive: false,\n      focusedIndex: 0,\n      container: false,\n    };\n  }\n\n  componentDidMount() {\n    this.props.callbacks.onChange = this.onEditorStateChange;\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.suggestions.length !== this.props.suggestions.length) {\n      this.setState({\n        focusedIndex: 0,\n      });\n    }\n  }\n\n  onEditorStateChange = (editorState) => {\n    const offset = this.props.store.getOffset();\n    if (offset.size === 0) {\n      this.closeDropDown();\n      return editorState;\n    }\n    const selection = editorState.getSelection();\n\n    // 修复: 焦点移出再移入时, dropdown 会闪动一下\n    // 原因: https://github.com/facebook/draft-js/blob/67c5e69499e3b0c149ce83b004872afdf4180463/src/component/handlers/edit/editOnFocus.js#L33\n    // 此处强制 update 了一下,因此 onEditorStateChange 会 call 两次\n    if (!this.props.callbacks.getEditorState().getSelection().getHasFocus()\n      && selection.getHasFocus()) {\n      return editorState;\n    }\n\n    const { word } = getSearchWord(editorState, selection);\n    if (!word) {\n      this.closeDropDown();\n      return editorState;\n    }\n    const selectionInsideMention = offset.map(({ offsetKey }) => {\n      const { blockKey, decoratorKey, leafKey } = decode(offsetKey);\n      if (blockKey !== selection.anchorKey) {\n        return false;\n      }\n      const leaf = editorState.getBlockTree(blockKey).getIn([decoratorKey, 'leaves', leafKey]);\n      if (!leaf) {\n        return false;\n      }\n      const startKey = leaf.get('start');\n      const endKey = leaf.get('end');\n      // 处理只有一个 `@` 符号时的情况\n      if (!word) {\n        return false;\n      }\n      if (startKey === endKey - 1) {\n        return selection.anchorOffset >= startKey + 1 && selection.anchorOffset <= endKey\n          ? offsetKey\n          : false;\n      }\n      return selection.anchorOffset > startKey + 1 && selection.anchorOffset <= endKey\n        ? offsetKey\n        : false;\n    });\n\n    const selectionInText = selectionInsideMention.some(isNotFalse);\n    this.activeOffsetKey = selectionInsideMention.find(isNotFalse);\n    const trigger = this.props.store.getTrigger(this.activeOffsetKey);\n\n    if (!selectionInText || !selection.getHasFocus()) {\n      this.closeDropDown();\n      return editorState;\n    }\n    const searchValue = word.substring(trigger.length, word.length);\n    if (this.lastSearchValue !== searchValue || this.lastTrigger !== trigger) {\n      this.lastSearchValue = searchValue;\n      this.lastTrigger = trigger;\n      this.props.onSearchChange(searchValue, trigger);\n    }\n    if (!this.state.active) {\n      // 暂时没有更优雅的方法\n      if (!trigger || word.indexOf(trigger) !== -1) {\n        this.openDropDown();\n      }\n    }\n    return editorState;\n  };\n\n  onMentionSelect(mention, data) {\n    const editorState = this.props.callbacks.getEditorState();\n    const { store, onSelect } = this.props;\n    const trigger = store.getTrigger(this.activeOffsetKey);\n    if (onSelect) {\n      onSelect(mention, data || mention);\n    }\n    if (this.props.noRedup) {\n      const mentions = getMentions(editorState.getCurrentContent(), trigger);\n      if (mentions.indexOf(`${trigger}${mention}`) !== -1) {\n        // eslint-disable-next-line\n        console.warn('you have specified `noRedup` props but have duplicated mentions.');\n        this.closeDropDown();\n        this.props.callbacks.setEditorState(\n          clearMention(editorState),\n        );\n        return;\n      }\n    }\n    this.props.callbacks.setEditorState(\n      insertMention(editorState, `${trigger}${mention}`, data, this.props.mode)\n      , true);\n    this.closeDropDown();\n  }\n\n  onUpArrow = (ev) => {\n    ev.preventDefault();\n    if (this.props.suggestions.length > 0) {\n      const newIndex = this.state.focusedIndex - 1;\n      this.setState({\n        focusedIndex: Math.max(newIndex, 0),\n      });\n    }\n  };\n  onBlur = (ev) => {\n    ev.preventDefault();\n    this.closeDropDown();\n  };\n  onDownArrow = (ev) => {\n    ev.preventDefault();\n    const newIndex = this.state.focusedIndex + 1;\n    this.setState({\n      focusedIndex: newIndex >= this.props.suggestions.length ? 0 : newIndex,\n    });\n  };\n\n  getPositionStyle(isActive, position) {\n    if (this.props.getSuggestionStyle) {\n      return this.props.getSuggestionStyle(isActive, position);\n    }\n    const container = this.props.getSuggestionContainer ? this.state.container : document.body;\n    const offset = getOffset(container);\n    return position ? {\n      position: 'absolute',\n      left: `${position.left - offset.left}px`,\n      top: `${position.top - offset.top}px`,\n      ...this.props.style,\n    } : {};\n  }\n\n  getContainer = () => {\n    const popupContainer = document.createElement('div');\n    let mountNode;\n    if (this.props.getSuggestionContainer) {\n      mountNode = this.props.getSuggestionContainer();\n      popupContainer.style.position = 'relative';\n    } else {\n      mountNode = document.body;\n    }\n    mountNode.appendChild(popupContainer);\n    return popupContainer;\n  };\n  handleKeyBinding = (command) => {\n    return command === 'split-block';\n  };\n  handleReturn = (ev) => {\n    ev.preventDefault();\n    const selectedSuggestion = this.props.suggestions[this.state.focusedIndex];\n    if (selectedSuggestion) {\n      if (isValidElement(selectedSuggestion)) {\n        this.onMentionSelect(selectedSuggestion.props.value, selectedSuggestion.props.data);\n      } else {\n        this.onMentionSelect(selectedSuggestion);\n      }\n      this.lastSearchValue = null;\n      this.lastTrigger = null;\n      return true;\n    }\n    return false;\n  };\n\n  openDropDown() {\n    this.props.callbacks.onUpArrow = this.onUpArrow;\n    this.props.callbacks.handleReturn = this.handleReturn;\n    this.props.callbacks.handleKeyBinding = this.handleKeyBinding;\n    this.props.callbacks.onDownArrow = this.onDownArrow;\n    this.props.callbacks.onBlur = this.onBlur;\n    this.setState({\n      active: true,\n      container: this.state.container || this.getContainer(),\n    });\n  }\n\n  closeDropDown() {\n    this.props.callbacks.onUpArrow = null;\n    this.props.callbacks.handleReturn = null;\n    this.props.callbacks.handleKeyBinding = null;\n    this.props.callbacks.onDownArrow = null;\n    this.props.callbacks.onBlur = null;\n    this.setState({\n      active: false,\n    });\n  }\n\n  renderReady = () => {\n    const container = this.dropdownContainer;\n    if (!container) {\n      return;\n    }\n    const { active } = this.state;\n    const { activeOffsetKey } = this;\n    const offset = this.props.store.getOffset();\n    const dropDownPosition = offset.get(activeOffsetKey);\n\n    if (active && dropDownPosition) {\n      const placement = this.props.placement;\n      const dropDownStyle = this.getPositionStyle(true, dropDownPosition.position());\n\n      // Check if the above space is crowded\n      const isTopCrowded = parseFloat(dropDownStyle.top) - window.scrollY - container.offsetHeight < 0;\n      // Check if the under space is crowded\n      const isBottomCrowded = (window.innerHeight || document.documentElement.clientHeight) - (parseFloat(dropDownStyle.top) - window.scrollY) - container.offsetHeight < 0;\n\n      if (placement === 'top' && !isTopCrowded) {\n        // The above space isn't crowded\n        dropDownStyle.top = `${parseFloat(dropDownStyle.top) - container.offsetHeight || 0}px`;\n      }\n\n      if (placement === 'bottom' && isBottomCrowded && !isTopCrowded) {\n        // The above space isn't crowded and the under space is crowded.\n        dropDownStyle.top = `${parseFloat(dropDownStyle.top) - container.offsetHeight || 0}px`;\n      }\n\n      Object.keys(dropDownStyle).forEach((key) => {\n        container.style[key] = dropDownStyle[key];\n      });\n    }\n\n    if (!this.focusItem) {\n      return;\n    }\n    scrollIntoView(\n      ReactDOM.findDOMNode(this.focusItem),\n      container, {\n        onlyScrollIfNeeded: true,\n      },\n    );\n  };\n  getNavigations = () => {\n    const { prefixCls, suggestions } = this.props;\n    const { focusedIndex } = this.state;\n    return suggestions.length ? Children.map(suggestions, (element, index) => {\n      const focusItem = index === focusedIndex;\n      const ref = focusItem ? (node) => {\n        this.focusItem = node;\n      } : null;\n      const mentionClass = cx(`${prefixCls}-dropdown-item`, {\n        focus: focusItem,\n      });\n      if (isValidElement(element)) {\n        return cloneElement(element, {\n          className: mentionClass,\n          onMouseDown: () => this.onMentionSelect(element.props.value, element.props.data),\n          ref,\n        });\n      }\n      return (\n        <Nav\n          ref={ref}\n          className={mentionClass}\n          onMouseDown={() => this.onMentionSelect(element)}\n        >\n          {element}\n        </Nav>\n      );\n    }, this) : (\n      <div className={`${prefixCls}-dropdown-notfound ${prefixCls}-dropdown-item`}>\n        {this.props.notFoundContent}\n      </div>\n    );\n  };\n\n  render() {\n    const { prefixCls, className, placement } = this.props;\n    const { container, active } = this.state;\n    const cls = cx({\n      [`${prefixCls}-dropdown`]: true,\n      [`${prefixCls}-dropdown-placement-${placement}`]: true,\n      ...className,\n    });\n    const transitionName = placement === 'top' ? 'slide-down' : 'slide-up';\n\n    const navigations = this.getNavigations();\n\n    return container ? (\n      <SuggetionWrapper renderReady={this.renderReady} container={container}>\n        <Animate transitionName={transitionName}>\n          {active ? (\n            <div className={cls} ref={(node) => {\n              this.dropdownContainer = node;\n            }}>\n              {navigations}\n            </div>\n          ) : null}\n        </Animate>\n      </SuggetionWrapper>\n    ) : null;\n  }\n}\n"]}