ae1e101b958d145b28deca56c6e47bf8
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _animate = _interopRequireDefault(require("../../animate"));

var _createChainedFunction = _interopRequireDefault(require("../util/createChainedFunction"));

var _classnames = _interopRequireDefault(require("classnames"));

var _Notice = _interopRequireDefault(require("./Notice"));

var seed = 0;
var now = Date.now();

function getUuid() {
  return "rcNotification_".concat(now, "_").concat(seed++);
}

var Notification =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Notification, _Component);

  function Notification() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, Notification);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(Notification)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      notices: []
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "add", function (notice) {
      var key = notice.key = notice.key || getUuid();

      _this.setState(function (previousState) {
        var notices = previousState.notices;

        if (!notices.filter(function (v) {
          return v.key === key;
        }).length) {
          return {
            notices: notices.concat(notice)
          };
        }
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "remove", function (key) {
      _this.setState(function (previousState) {
        return {
          notices: previousState.notices.filter(function (notice) {
            return notice.key !== key;
          })
        };
      });
    });
    return _this;
  }

  (0, _createClass2["default"])(Notification, [{
    key: "getTransitionName",
    value: function getTransitionName() {
      var props = this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(props.animation);
      }

      return transitionName;
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this,
          _className;

      var props = this.props;
      var noticeNodes = this.state.notices.map(function (notice) {
        var onClose = (0, _createChainedFunction["default"])(_this2.remove.bind(_this2, notice.key), notice.onClose);
        return _react["default"].createElement(_Notice["default"], (0, _extends2["default"])({
          prefixCls: props.prefixCls
        }, notice, {
          onClose: onClose,
          closeIcon: props.closeIcon
        }), notice.content);
      });
      var className = (_className = {}, (0, _defineProperty2["default"])(_className, props.prefixCls, 1), (0, _defineProperty2["default"])(_className, props.className, !!props.className), _className);
      return _react["default"].createElement("div", {
        className: (0, _classnames["default"])(className),
        style: props.style
      }, _react["default"].createElement(_animate["default"], {
        transitionName: this.getTransitionName()
      }, noticeNodes));
    }
  }]);
  return Notification;
}(_react.Component);

exports["default"] = Notification;
(0, _defineProperty2["default"])(Notification, "propTypes", {
  prefixCls: _propTypes["default"].string,
  transitionName: _propTypes["default"].string,
  animation: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].object]),
  style: _propTypes["default"].object,
  closeIcon: _propTypes["default"].node
});
(0, _defineProperty2["default"])(Notification, "defaultProps", {
  prefixCls: 'rc-notification',
  animation: 'fade',
  style: {
    top: 65,
    left: '50%'
  }
});
(0, _defineProperty2["default"])(Notification, "newInstance", function newNotificationInstance(properties, callback) {
  var _ref = properties || {},
      getContainer = _ref.getContainer,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["getContainer"]);

  var div = document.createElement('div');

  if (getContainer) {
    var root = getContainer();
    root.appendChild(div);
  } else {
    document.body.appendChild(div);
  }

  var called = false;

  function ref(notification) {
    if (called) {
      return;
    }

    called = true;
    callback({
      notice: function notice(noticeProps) {
        notification.add(noticeProps);
      },
      removeNotice: function removeNotice(key) {
        notification.remove(key);
      },
      component: notification,
      destroy: function destroy() {
        _reactDom["default"].unmountComponentAtNode(div);

        div.parentNode.removeChild(div);
      }
    });
  }

  _reactDom["default"].render(_react["default"].createElement(Notification, (0, _extends2["default"])({}, props, {
    ref: ref
  })), div);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vdGlmaWNhdGlvbi9Ob3RpZmljYXRpb24uanN4Il0sIm5hbWVzIjpbInNlZWQiLCJub3ciLCJEYXRlIiwiTm90aWZpY2F0aW9uIiwiQ29tcG9uZW50IiwicHJlZml4Q2xzIiwiUHJvcFR5cGVzIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb24iLCJzdHlsZSIsImNsb3NlSWNvbiIsIm5vZGUiLCJ0b3AiLCJsZWZ0IiwiZ2V0Q29udGFpbmVyIiwicHJvcHMiLCJwcm9wZXJ0aWVzIiwiZGl2IiwiZG9jdW1lbnQiLCJyb290IiwiY2FsbGVkIiwiY2FsbGJhY2siLCJub3RpY2UiLCJub3RpZmljYXRpb24iLCJyZW1vdmVOb3RpY2UiLCJjb21wb25lbnQiLCJkZXN0cm95IiwiUmVhY3RET00iLCJyZWYiLCJub3RpY2VzIiwia2V5IiwiZ2V0VXVpZCIsInByZXZpb3VzU3RhdGUiLCJ2Iiwibm90aWNlTm9kZXMiLCJvbkNsb3NlIiwiY2xhc3NOYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsVUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsc0JBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSwrQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxPQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxDQUFBLENBQUE7O0FBRUEsSUFBSUEs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RSxNQUFBQSxTQUFTLEVBUEYsWUFBQTtBQVFQQyxNQUFBQSxPQVJPLEVBQUEsU0FBQSxPQUFBLEdBUUc7QUFDUkMsUUFBQUEsU0FBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBQUEsc0JBQUFBLENBQUFBLEdBQUFBOztBQUNBVixRQUFBQSxHQUFHLENBQUhBLFVBQUFBLENBQUFBLFdBQUFBLENBQUFBLEdBQUFBO0FBQ0Q7QUFYTSxLQUFELENBQVJJO0FBYUQ7O0FBRURNLEVBQUFBLFNBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQUFBLE1BQUFBLENBQWdCLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxhQUFBLENBQUEsWUFBQSxFQUFBLENBQUEsR0FBQSxTQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsRUFBQSxFQUFBLEtBQUEsRUFBQTtBQUF5QixJQUFBLEdBQUcsRUFBRUM7QUFBOUIsR0FBQSxDQUFBLENBQWhCRCxFQUFBQSxHQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgQW5pbWF0ZSBmcm9tICcuLi8uLi9hbmltYXRlJztcbmltcG9ydCBjcmVhdGVDaGFpbmVkRnVuY3Rpb24gZnJvbSAnLi4vdXRpbC9jcmVhdGVDaGFpbmVkRnVuY3Rpb24nO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgTm90aWNlIGZyb20gJy4vTm90aWNlJztcblxubGV0IHNlZWQgPSAwO1xuY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuZnVuY3Rpb24gZ2V0VXVpZCgpIHtcbiAgcmV0dXJuIGByY05vdGlmaWNhdGlvbl8ke25vd31fJHtzZWVkKyt9YDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTm90aWZpY2F0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdHJhbnNpdGlvbk5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgYW5pbWF0aW9uOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMub2JqZWN0XSksXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgY2xvc2VJY29uOiBQcm9wVHlwZXMubm9kZSxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHByZWZpeENsczogJ3JjLW5vdGlmaWNhdGlvbicsXG4gICAgYW5pbWF0aW9uOiAnZmFkZScsXG4gICAgc3R5bGU6IHtcbiAgICAgIHRvcDogNjUsXG4gICAgICBsZWZ0OiAnNTAlJyxcbiAgICB9LFxuICB9O1xuXG4gIHN0YXRpYyBuZXdJbnN0YW5jZSA9IGZ1bmN0aW9uIG5ld05vdGlmaWNhdGlvbkluc3RhbmNlKHByb3BlcnRpZXMsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgeyBnZXRDb250YWluZXIsIC4uLnByb3BzIH0gPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGlmIChnZXRDb250YWluZXIpIHtcbiAgICAgIGNvbnN0IHJvb3QgPSBnZXRDb250YWluZXIoKTtcbiAgICAgIHJvb3QuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpO1xuICAgIH1cbiAgICBsZXQgY2FsbGVkID0gZmFsc2U7XG5cbiAgICBmdW5jdGlvbiByZWYobm90aWZpY2F0aW9uKSB7XG4gICAgICBpZiAoY2FsbGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhbGxlZCA9IHRydWU7XG4gICAgICBjYWxsYmFjayh7XG4gICAgICAgIG5vdGljZShub3RpY2VQcm9wcykge1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5hZGQobm90aWNlUHJvcHMpO1xuICAgICAgICB9LFxuICAgICAgICByZW1vdmVOb3RpY2Uoa2V5KSB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnJlbW92ZShrZXkpO1xuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnQ6IG5vdGlmaWNhdGlvbixcbiAgICAgICAgZGVzdHJveSgpIHtcbiAgICAgICAgICBSZWFjdERPTS51bm1vdW50Q29tcG9uZW50QXROb2RlKGRpdik7XG4gICAgICAgICAgZGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGl2KTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIFJlYWN0RE9NLnJlbmRlcig8Tm90aWZpY2F0aW9uIHsuLi5wcm9wc30gcmVmPXtyZWZ9IC8+LCBkaXYpO1xuICB9O1xuXG4gIHN0YXRlID0ge1xuICAgIG5vdGljZXM6IFtdLFxuICB9O1xuXG4gIGdldFRyYW5zaXRpb25OYW1lKCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBsZXQgdHJhbnNpdGlvbk5hbWUgPSBwcm9wcy50cmFuc2l0aW9uTmFtZTtcbiAgICBpZiAoIXRyYW5zaXRpb25OYW1lICYmIHByb3BzLmFuaW1hdGlvbikge1xuICAgICAgdHJhbnNpdGlvbk5hbWUgPSBgJHtwcm9wcy5wcmVmaXhDbHN9LSR7cHJvcHMuYW5pbWF0aW9ufWA7XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2l0aW9uTmFtZTtcbiAgfVxuXG4gIGFkZCA9IG5vdGljZSA9PiB7XG4gICAgY29uc3Qga2V5ID0gKG5vdGljZS5rZXkgPSBub3RpY2Uua2V5IHx8IGdldFV1aWQoKSk7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIGNvbnN0IG5vdGljZXMgPSBwcmV2aW91c1N0YXRlLm5vdGljZXM7XG4gICAgICBpZiAoIW5vdGljZXMuZmlsdGVyKHYgPT4gdi5rZXkgPT09IGtleSkubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbm90aWNlczogbm90aWNlcy5jb25jYXQobm90aWNlKSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZW1vdmUgPSBrZXkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUocHJldmlvdXNTdGF0ZSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBub3RpY2VzOiBwcmV2aW91c1N0YXRlLm5vdGljZXMuZmlsdGVyKG5vdGljZSA9PiBub3RpY2Uua2V5ICE9PSBrZXkpLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG5vdGljZU5vZGVzID0gdGhpcy5zdGF0ZS5ub3RpY2VzLm1hcChub3RpY2UgPT4ge1xuICAgICAgY29uc3Qgb25DbG9zZSA9IGNyZWF0ZUNoYWluZWRGdW5jdGlvbih0aGlzLnJlbW92ZS5iaW5kKHRoaXMsIG5vdGljZS5rZXkpLCBub3RpY2Uub25DbG9zZSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Tm90aWNlXG4gICAgICAgICAgcHJlZml4Q2xzPXtwcm9wcy5wcmVmaXhDbHN9XG4gICAgICAgICAgey4uLm5vdGljZX1cbiAgICAgICAgICBvbkNsb3NlPXtvbkNsb3NlfVxuICAgICAgICAgIGNsb3NlSWNvbj17cHJvcHMuY2xvc2VJY29ufVxuICAgICAgICA+XG4gICAgICAgICAge25vdGljZS5jb250ZW50fVxuICAgICAgICA8L05vdGljZT5cbiAgICAgICk7XG4gICAgfSk7XG4gICAgY29uc3QgY2xhc3NOYW1lID0ge1xuICAgICAgW3Byb3BzLnByZWZpeENsc106IDEsXG4gICAgICBbcHJvcHMuY2xhc3NOYW1lXTogISFwcm9wcy5jbGFzc05hbWUsXG4gICAgfTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzbmFtZXMoY2xhc3NOYW1lKX0gc3R5bGU9e3Byb3BzLnN0eWxlfT5cbiAgICAgICAgPEFuaW1hdGUgdHJhbnNpdGlvbk5hbWU9e3RoaXMuZ2V0VHJhbnNpdGlvbk5hbWUoKX0+e25vdGljZU5vZGVzfTwvQW5pbWF0ZT5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cbiJdfQ==