530f882ffc3384e9ad114272affbdfba
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _configure = require("choerodon-ui/lib/configure");

var _Panel = _interopRequireDefault(require("./Panel"));

var _openAnimationFactory = _interopRequireDefault(require("./openAnimationFactory"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

function toArray(activeKey) {
  var currentActiveKey = activeKey;

  if (!Array.isArray(currentActiveKey)) {
    currentActiveKey = currentActiveKey ? [currentActiveKey] : [];
  }

  return currentActiveKey;
}

var Collapse =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Collapse, _Component);

  var _super = _createSuper(Collapse);

  function Collapse(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Collapse);
    _this = _super.call(this, props);
    var _this$props = _this.props,
        activeKey = _this$props.activeKey,
        defaultActiveKey = _this$props.defaultActiveKey;
    var currentActiveKey = defaultActiveKey;

    if ('activeKey' in _this.props) {
      currentActiveKey = activeKey;
    }

    _this.state = {
      openAnimation: _this.props.openAnimation || (0, _openAnimationFactory["default"])(_this.props.prefixCls),
      activeKey: toArray(currentActiveKey)
    };
    return _this;
  }

  (0, _createClass2["default"])(Collapse, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('activeKey' in nextProps) {
        this.setState({
          activeKey: toArray(nextProps.activeKey)
        });
      }

      if ('openAnimation' in nextProps) {
        this.setState({
          openAnimation: nextProps.openAnimation
        });
      }
    }
  }, {
    key: "onClickItem",
    value: function onClickItem(key) {
      var activeKey = this.state.activeKey;

      if (this.props.accordion) {
        activeKey = activeKey[0] === key ? [] : [key];
      } else {
        activeKey = (0, _toConsumableArray2["default"])(activeKey);
        var index = activeKey.indexOf(key);
        var isActive = index > -1;

        if (isActive) {
          // remove active state
          activeKey.splice(index, 1);
        } else {
          activeKey.push(key);
        }
      }

      this.setActiveKey(activeKey);
    }
  }, {
    key: "getItems",
    value: function getItems() {
      var _this2 = this;

      var activeKey = this.state.activeKey;
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          accordion = _this$props2.accordion,
          destroyInactivePanel = _this$props2.destroyInactivePanel,
          expandIcon = _this$props2.expandIcon;
      var newChildren = [];

      _react.Children.forEach(this.props.children, function (child, index) {
        if (!child) return; // If there is no key provide, use the panel order as default key

        var key = child.key || String(index);
        var _child$props = child.props,
            header = _child$props.header,
            headerClass = _child$props.headerClass,
            disabled = _child$props.disabled;
        var isActive = false;

        if (accordion) {
          isActive = activeKey[0] === key;
        } else {
          isActive = activeKey.indexOf(key) > -1;
        }

        var trigger = _this2.props.trigger || (0, _configure.getConfig)('collapseTrigger');
        var props = {
          key: key,
          header: header,
          headerClass: headerClass,
          isActive: isActive,
          prefixCls: prefixCls,
          destroyInactivePanel: destroyInactivePanel,
          openAnimation: _this2.state.openAnimation,
          children: child.props.children,
          onItemClick: disabled ? null : function () {
            return _this2.onClickItem(key);
          },
          expandIcon: expandIcon,
          trigger: trigger
        };
        newChildren.push((0, _react.cloneElement)(child, props));
      });

      return newChildren;
    }
  }, {
    key: "setActiveKey",
    value: function setActiveKey(activeKey) {
      if (!('activeKey' in this.props)) {
        this.setState({
          activeKey: activeKey
        });
      }

      this.props.onChange(this.props.accordion ? activeKey[0] : activeKey);
    }
  }, {
    key: "render",
    value: function render() {
      var _classNames;

      var _this$props3 = this.props,
          prefixCls = _this$props3.prefixCls,
          className = _this$props3.className,
          style = _this$props3.style,
          accordion = _this$props3.accordion;
      var collapseClassName = (0, _classnames["default"])((_classNames = {}, (0, _defineProperty2["default"])(_classNames, prefixCls, true), (0, _defineProperty2["default"])(_classNames, className, !!className), _classNames));
      return _react["default"].createElement("div", {
        className: collapseClassName,
        style: style,
        role: accordion ? 'tablist' : null
      }, this.getItems());
    }
  }]);
  return Collapse;
}(_react.Component);

exports["default"] = Collapse;
(0, _defineProperty2["default"])(Collapse, "propTypes", {
  children: _propTypes["default"].any,
  prefixCls: _propTypes["default"].string,
  activeKey: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].arrayOf(_propTypes["default"].string)]),
  defaultActiveKey: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].arrayOf(_propTypes["default"].string)]),
  openAnimation: _propTypes["default"].object,
  onChange: _propTypes["default"].func,
  accordion: _propTypes["default"].bool,
  className: _propTypes["default"].string,
  style: _propTypes["default"].object,
  destroyInactivePanel: _propTypes["default"].bool
});
(0, _defineProperty2["default"])(Collapse, "defaultProps", {
  prefixCls: 'rc-collapse',
  onChange: function onChange() {},
  accordion: false,
  destroyInactivePanel: false
});
(0, _defineProperty2["default"])(Collapse, "Panel", _Panel["default"]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbGxhcHNlLmpzeCJdLCJuYW1lcyI6WyJ0b0FycmF5IiwiYWN0aXZlS2V5IiwiY3VycmVudEFjdGl2ZUtleSIsIkFycmF5IiwiaXNBcnJheSIsIkNvbGxhcHNlIiwicHJvcHMiLCJkZWZhdWx0QWN0aXZlS2V5Iiwic3RhdGUiLCJvcGVuQW5pbWF0aW9uIiwicHJlZml4Q2xzIiwibmV4dFByb3BzIiwic2V0U3RhdGUiLCJrZXkiLCJhY2NvcmRpb24iLCJpbmRleCIsImluZGV4T2YiLCJpc0FjdGl2ZSIsInNwbGljZSIsInB1c2giLCJzZXRBY3RpdmVLZXkiLCJkZXN0cm95SW5hY3RpdmVQYW5lbCIsImV4cGFuZEljb24iLCJuZXdDaGlsZHJlbiIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImNoaWxkcmVuIiwiY2hpbGQiLCJTdHJpbmciLCJoZWFkZXIiLCJoZWFkZXJDbGFzcyIsImRpc2FibGVkIiwidHJpZ2dlciIsIm9uSXRlbUNsaWNrIiwib25DbGlja0l0ZW0iLCJvbkNoYW5nZSIsImNsYXNzTmFtZSIsInN0eWxlIiwiY29sbGFwc2VDbGFzc05hbWUiLCJnZXRJdGVtcyIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImFueSIsInN0cmluZyIsIm9uZU9mVHlwZSIsImFycmF5T2YiLCJvYmplY3QiLCJmdW5jIiwiYm9vbCIsIkNvbGxhcHNlUGFuZWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLFNBQVNBLE9BQVQsQ0FBaUJDLFNBQWpCLEVBQTRCO0FBQzFCLE1BQUlDLGdCQUFnQixHQUFHRCxTQUF2Qjs7QUFDQSxNQUFJLENBQUNFLEtBQUssQ0FBQ0MsT0FBTixDQUFjRixnQkFBZCxDQUFMLEVBQXNDO0FBQ3BDQSxJQUFBQSxnQkFBZ0IsR0FBR0EsZ0JBQWdCLEdBQUcsQ0FBQ0EsZ0JBQUQsQ0FBSCxHQUF3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c0JBQVVLLE1BWFI7QUFZakJYLEVBQUFBLFFBQVEsRUFBRU0sc0JBQVVNLElBWkg7QUFhakJqQyxFQUFBQSxTQUFTLEVBQUUyQixzQkFBVU8sSUFiSjtBQWNqQlosRUFBQUEsU0FBUyxFQUFFSyxzQkFBVUUsTUFkSjtBQWVqQk4sRUFBQUEsS0FBSyxFQUFFSSxzQkFBVUssTUFmQTtBQWdCakJ6QixFQUFBQSxvQkFBb0IsRUFBRW9CLHNCQUFVTztBQWhCZixDO2lDQURBM0MsUSxrQkFvQkc7QUFDcEJLLEVBQUFBLFNBQVMsRUFBRSxhQURTO0FBRXBCeUIsRUFBQUEsUUFGb0Isc0JBRVQsQ0FDVixDQUhtQjtBQUlwQnJCLEVBQUFBLFNBQVMsRUFBRSxLQUpTO0FBS3BCTyxFQUFBQSxvQkFBb0IsRUFBRTtBQUxGLEM7aUNBcEJIaEIsUSxXQTRCSjRDLGlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENoaWxkcmVuLCBjbG9uZUVsZW1lbnQsIENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJ2Nob2Vyb2Rvbi11aS9saWIvY29uZmlndXJlJztcbmltcG9ydCBDb2xsYXBzZVBhbmVsIGZyb20gJy4vUGFuZWwnO1xuaW1wb3J0IG9wZW5BbmltYXRpb25GYWN0b3J5IGZyb20gJy4vb3BlbkFuaW1hdGlvbkZhY3RvcnknO1xuXG5mdW5jdGlvbiB0b0FycmF5KGFjdGl2ZUtleSkge1xuICBsZXQgY3VycmVudEFjdGl2ZUtleSA9IGFjdGl2ZUtleTtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGN1cnJlbnRBY3RpdmVLZXkpKSB7XG4gICAgY3VycmVudEFjdGl2ZUtleSA9IGN1cnJlbnRBY3RpdmVLZXkgPyBbY3VycmVudEFjdGl2ZUtleV0gOiBbXTtcbiAgfVxuICByZXR1cm4gY3VycmVudEFjdGl2ZUtleTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29sbGFwc2UgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55LFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBhY3RpdmVLZXk6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLFxuICAgIF0pLFxuICAgIGRlZmF1bHRBY3RpdmVLZXk6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLFxuICAgIF0pLFxuICAgIG9wZW5BbmltYXRpb246IFByb3BUeXBlcy5vYmplY3QsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIGFjY29yZGlvbjogUHJvcFR5cGVzLmJvb2wsXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRlc3Ryb3lJbmFjdGl2ZVBhbmVsOiBQcm9wVHlwZXMuYm9vbCxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHByZWZpeENsczogJ3JjLWNvbGxhcHNlJyxcbiAgICBvbkNoYW5nZSgpIHtcbiAgICB9LFxuICAgIGFjY29yZGlvbjogZmFsc2UsXG4gICAgZGVzdHJveUluYWN0aXZlUGFuZWw6IGZhbHNlLFxuICB9O1xuXG4gIHN0YXRpYyBQYW5lbCA9IENvbGxhcHNlUGFuZWw7XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICBjb25zdCB7IGFjdGl2ZUtleSwgZGVmYXVsdEFjdGl2ZUtleSB9ID0gdGhpcy5wcm9wcztcbiAgICBsZXQgY3VycmVudEFjdGl2ZUtleSA9IGRlZmF1bHRBY3RpdmVLZXk7XG4gICAgaWYgKCdhY3RpdmVLZXknIGluIHRoaXMucHJvcHMpIHtcbiAgICAgIGN1cnJlbnRBY3RpdmVLZXkgPSBhY3RpdmVLZXk7XG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIG9wZW5BbmltYXRpb246IHRoaXMucHJvcHMub3BlbkFuaW1hdGlvbiB8fCBvcGVuQW5pbWF0aW9uRmFjdG9yeSh0aGlzLnByb3BzLnByZWZpeENscyksXG4gICAgICBhY3RpdmVLZXk6IHRvQXJyYXkoY3VycmVudEFjdGl2ZUtleSksXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKCdhY3RpdmVLZXknIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGFjdGl2ZUtleTogdG9BcnJheShuZXh0UHJvcHMuYWN0aXZlS2V5KSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoJ29wZW5BbmltYXRpb24nIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIG9wZW5BbmltYXRpb246IG5leHRQcm9wcy5vcGVuQW5pbWF0aW9uLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgb25DbGlja0l0ZW0oa2V5KSB7XG4gICAgbGV0IGFjdGl2ZUtleSA9IHRoaXMuc3RhdGUuYWN0aXZlS2V5O1xuICAgIGlmICh0aGlzLnByb3BzLmFjY29yZGlvbikge1xuICAgICAgYWN0aXZlS2V5ID0gYWN0aXZlS2V5WzBdID09PSBrZXkgPyBbXSA6IFtrZXldO1xuICAgIH0gZWxzZSB7XG4gICAgICBhY3RpdmVLZXkgPSBbLi4uYWN0aXZlS2V5XTtcbiAgICAgIGNvbnN0IGluZGV4ID0gYWN0aXZlS2V5LmluZGV4T2Yoa2V5KTtcbiAgICAgIGNvbnN0IGlzQWN0aXZlID0gaW5kZXggPiAtMTtcbiAgICAgIGlmIChpc0FjdGl2ZSkge1xuICAgICAgICAvLyByZW1vdmUgYWN0aXZlIHN0YXRlXG4gICAgICAgIGFjdGl2ZUtleS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aXZlS2V5LnB1c2goa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zZXRBY3RpdmVLZXkoYWN0aXZlS2V5KTtcbiAgfVxuXG4gIGdldEl0ZW1zKCkge1xuICAgIGNvbnN0IGFjdGl2ZUtleSA9IHRoaXMuc3RhdGUuYWN0aXZlS2V5O1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBhY2NvcmRpb24sIGRlc3Ryb3lJbmFjdGl2ZVBhbmVsLCBleHBhbmRJY29uIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG5ld0NoaWxkcmVuID0gW107XG5cbiAgICBDaGlsZHJlbi5mb3JFYWNoKHRoaXMucHJvcHMuY2hpbGRyZW4sIChjaGlsZCwgaW5kZXgpID0+IHtcbiAgICAgIGlmICghY2hpbGQpIHJldHVybjtcbiAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGtleSBwcm92aWRlLCB1c2UgdGhlIHBhbmVsIG9yZGVyIGFzIGRlZmF1bHQga2V5XG4gICAgICBjb25zdCBrZXkgPSBjaGlsZC5rZXkgfHwgU3RyaW5nKGluZGV4KTtcbiAgICAgIGNvbnN0IHsgaGVhZGVyLCBoZWFkZXJDbGFzcywgZGlzYWJsZWQgfSA9IGNoaWxkLnByb3BzO1xuICAgICAgbGV0IGlzQWN0aXZlID0gZmFsc2U7XG4gICAgICBpZiAoYWNjb3JkaW9uKSB7XG4gICAgICAgIGlzQWN0aXZlID0gYWN0aXZlS2V5WzBdID09PSBrZXk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpc0FjdGl2ZSA9IGFjdGl2ZUtleS5pbmRleE9mKGtleSkgPiAtMTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdHJpZ2dlciA9IHRoaXMucHJvcHMudHJpZ2dlciB8fCBnZXRDb25maWcoJ2NvbGxhcHNlVHJpZ2dlcicpO1xuXG4gICAgICBjb25zdCBwcm9wcyA9IHtcbiAgICAgICAga2V5LFxuICAgICAgICBoZWFkZXIsXG4gICAgICAgIGhlYWRlckNsYXNzLFxuICAgICAgICBpc0FjdGl2ZSxcbiAgICAgICAgcHJlZml4Q2xzLFxuICAgICAgICBkZXN0cm95SW5hY3RpdmVQYW5lbCxcbiAgICAgICAgb3BlbkFuaW1hdGlvbjogdGhpcy5zdGF0ZS5vcGVuQW5pbWF0aW9uLFxuICAgICAgICBjaGlsZHJlbjogY2hpbGQucHJvcHMuY2hpbGRyZW4sXG4gICAgICAgIG9uSXRlbUNsaWNrOiBkaXNhYmxlZCA/IG51bGwgOiAoKSA9PiB0aGlzLm9uQ2xpY2tJdGVtKGtleSksXG4gICAgICAgIGV4cGFuZEljb24sXG4gICAgICAgIHRyaWdnZXIsXG4gICAgICB9O1xuXG4gICAgICBuZXdDaGlsZHJlbi5wdXNoKGNsb25lRWxlbWVudChjaGlsZCwgcHJvcHMpKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBuZXdDaGlsZHJlbjtcbiAgfVxuXG4gIHNldEFjdGl2ZUtleShhY3RpdmVLZXkpIHtcbiAgICBpZiAoISgnYWN0aXZlS2V5JyBpbiB0aGlzLnByb3BzKSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGFjdGl2ZUtleSB9KTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh0aGlzLnByb3BzLmFjY29yZGlvbiA/IGFjdGl2ZUtleVswXSA6IGFjdGl2ZUtleSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIGNsYXNzTmFtZSwgc3R5bGUsIGFjY29yZGlvbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBjb2xsYXBzZUNsYXNzTmFtZSA9IGNsYXNzTmFtZXMoe1xuICAgICAgW3ByZWZpeENsc106IHRydWUsXG4gICAgICBbY2xhc3NOYW1lXTogISFjbGFzc05hbWUsXG4gICAgfSk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtjb2xsYXBzZUNsYXNzTmFtZX0gc3R5bGU9e3N0eWxlfSByb2xlPXthY2NvcmRpb24gPyAndGFibGlzdCcgOiBudWxsfT5cbiAgICAgICAge3RoaXMuZ2V0SXRlbXMoKX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cbiJdfQ==