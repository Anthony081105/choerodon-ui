cf67c041eba8a1d97cc5131955d5a0ec
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _arrayTreeFilter = _interopRequireDefault(require("array-tree-filter"));

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var _trigger = _interopRequireDefault(require("../trigger"));

var _Menus = _interopRequireDefault(require("./Menus"));

var _KeyCode = _interopRequireDefault(require("../../_util/KeyCode"));

var BUILT_IN_PLACEMENTS = {
  bottomLeft: {
    points: ['tl', 'bl'],
    offset: [0, 4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  topLeft: {
    points: ['bl', 'tl'],
    offset: [0, -4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  bottomRight: {
    points: ['tr', 'br'],
    offset: [0, 4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  topRight: {
    points: ['br', 'tr'],
    offset: [0, -4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  }
};

var Cascader =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Cascader, _Component);

  function Cascader(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Cascader);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Cascader).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setPopupVisible", function (popupVisible) {
      if (!('popupVisible' in _this.props)) {
        _this.setState({
          popupVisible: popupVisible
        });
      } // sync activeValue with value when panel open


      if (popupVisible && !_this.state.visible) {
        _this.setState({
          activeValue: _this.state.value
        });
      }

      _this.props.onPopupVisibleChange(popupVisible);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleChange", function (options, setProps, e) {
      if (e.type !== 'keydown' || e.keyCode === _KeyCode["default"].ENTER) {
        _this.props.onChange(options.map(function (o) {
          return o.value;
        }), options);

        _this.setPopupVisible(setProps.visible);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handlePopupVisibleChange", function (popupVisible) {
      _this.setPopupVisible(popupVisible);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleMenuSelect", function (targetOption, menuIndex, e) {
      // Keep focused state for keyboard support
      var triggerNode = _this.trigger.getRootDomNode();

      if (triggerNode && triggerNode.focus) {
        triggerNode.focus();
      }

      var _this$props = _this.props,
          changeOnSelect = _this$props.changeOnSelect,
          loadData = _this$props.loadData,
          expandTrigger = _this$props.expandTrigger;

      if (!targetOption || targetOption.disabled) {
        return;
      }

      var activeValue = _this.state.activeValue;
      activeValue = activeValue.slice(0, menuIndex + 1);
      activeValue[menuIndex] = targetOption.value;

      var activeOptions = _this.getActiveOptions(activeValue);

      if (targetOption.isLeaf === false && !targetOption.children && loadData) {
        if (changeOnSelect) {
          _this.handleChange(activeOptions, {
            visible: true
          }, e);
        }

        _this.setState({
          activeValue: activeValue
        });

        loadData(activeOptions);
        return;
      }

      var newState = {};

      if (!targetOption.children || !targetOption.children.length) {
        _this.handleChange(activeOptions, {
          visible: false
        }, e); // set value to activeValue when select leaf option


        newState.value = activeValue; // add e.type judgement to prevent `onChange` being triggered by mouseEnter
      } else if (changeOnSelect && (e.type === 'click' || e.type === 'keydown')) {
        if (expandTrigger === 'hover') {
          _this.handleChange(activeOptions, {
            visible: false
          }, e);
        } else {
          _this.handleChange(activeOptions, {
            visible: true
          }, e);
        } // set value to activeValue on every select


        newState.value = activeValue;
      }

      newState.activeValue = activeValue; //  not change the value by keyboard

      if ('value' in _this.props || e.type === 'keydown' && e.keyCode !== _KeyCode["default"].ENTER) {
        delete newState.value;
      }

      _this.setState(newState);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleKeyDown", function (e) {
      var children = _this.props.children; // Don't bind keyboard support when children specify the onKeyDown

      if (children && children.props.onKeyDown) {
        children.props.onKeyDown(e);
        return;
      }

      var activeValue = (0, _toConsumableArray2["default"])(_this.state.activeValue);
      var currentLevel = activeValue.length - 1 < 0 ? 0 : activeValue.length - 1;

      var currentOptions = _this.getCurrentLevelOptions();

      var currentIndex = currentOptions.map(function (o) {
        return o.value;
      }).indexOf(activeValue[currentLevel]);

      if (e.keyCode !== _KeyCode["default"].DOWN && e.keyCode !== _KeyCode["default"].UP && e.keyCode !== _KeyCode["default"].LEFT && e.keyCode !== _KeyCode["default"].RIGHT && e.keyCode !== _KeyCode["default"].ENTER && e.keyCode !== _KeyCode["default"].BACKSPACE && e.keyCode !== _KeyCode["default"].ESC) {
        return;
      } // Press any keys above to reopen menu


      if (!_this.state.popupVisible && e.keyCode !== _KeyCode["default"].BACKSPACE && e.keyCode !== _KeyCode["default"].LEFT && e.keyCode !== _KeyCode["default"].RIGHT && e.keyCode !== _KeyCode["default"].ESC) {
        _this.setPopupVisible(true);

        return;
      }

      if (e.keyCode === _KeyCode["default"].DOWN || e.keyCode === _KeyCode["default"].UP) {
        var nextIndex = currentIndex;

        if (nextIndex !== -1) {
          if (e.keyCode === _KeyCode["default"].DOWN) {
            nextIndex += 1;
            nextIndex = nextIndex >= currentOptions.length ? 0 : nextIndex;
          } else {
            nextIndex -= 1;
            nextIndex = nextIndex < 0 ? currentOptions.length - 1 : nextIndex;
          }
        } else {
          nextIndex = 0;
        }

        activeValue[currentLevel] = currentOptions[nextIndex].value;
      } else if (e.keyCode === _KeyCode["default"].LEFT || e.keyCode === _KeyCode["default"].BACKSPACE) {
        activeValue.splice(activeValue.length - 1, 1);
      } else if (e.keyCode === _KeyCode["default"].RIGHT) {
        if (currentOptions[currentIndex] && currentOptions[currentIndex].children) {
          activeValue.push(currentOptions[currentIndex].children[0].value);
        }
      } else if (e.keyCode === _KeyCode["default"].ESC) {
        _this.setPopupVisible(false);

        return;
      }

      if (!activeValue || activeValue.length === 0) {
        _this.setPopupVisible(false);
      }

      var activeOptions = _this.getActiveOptions(activeValue);

      var targetOption = activeOptions[activeOptions.length - 1];

      _this.handleMenuSelect(targetOption, activeOptions.length - 1, e);

      if (_this.props.onKeyDown) {
        _this.props.onKeyDown(e);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveTrigger", function (node) {
      _this.trigger = node;
    });
    var initialValue = [];

    if ('value' in props) {
      initialValue = props.value || [];
    } else if ('defaultValue' in props) {
      initialValue = props.defaultValue || [];
    }

    _this.state = {
      popupVisible: props.popupVisible,
      activeValue: initialValue,
      value: initialValue
    };
    return _this;
  }

  (0, _createClass2["default"])(Cascader, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('value' in nextProps && !(0, _isEqual["default"])(this.props.value, nextProps.value)) {
        var newValues = {
          value: nextProps.value || [],
          activeValue: nextProps.value || []
        }; // allow activeValue diff from value

        if ('loadData' in nextProps) {
          delete newValues.activeValue;
        }

        this.setState(newValues);
      }

      if ('popupVisible' in nextProps) {
        this.setState({
          popupVisible: nextProps.popupVisible
        });
      }
    }
  }, {
    key: "getPopupDOMNode",
    value: function getPopupDOMNode() {
      return this.trigger.getPopupDomNode();
    }
  }, {
    key: "getCurrentLevelOptions",
    value: function getCurrentLevelOptions() {
      var options = this.props.options;
      var _this$state$activeVal = this.state.activeValue,
          activeValue = _this$state$activeVal === void 0 ? [] : _this$state$activeVal;
      var result = (0, _arrayTreeFilter["default"])(options, function (o, level) {
        return o.value === activeValue[level];
      });

      if (result[result.length - 2]) {
        return result[result.length - 2].children;
      }

      return (0, _toConsumableArray2["default"])(options).filter(function (o) {
        return !o.disabled;
      });
    }
  }, {
    key: "getActiveOptions",
    value: function getActiveOptions(activeValue) {
      return (0, _arrayTreeFilter["default"])(this.props.options, function (o, level) {
        return o.value === activeValue[level];
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          transitionName = _this$props2.transitionName,
          popupClassName = _this$props2.popupClassName,
          options = _this$props2.options,
          disabled = _this$props2.disabled,
          builtinPlacements = _this$props2.builtinPlacements,
          popupPlacement = _this$props2.popupPlacement,
          children = _this$props2.children,
          restProps = (0, _objectWithoutProperties2["default"])(_this$props2, ["prefixCls", "transitionName", "popupClassName", "options", "disabled", "builtinPlacements", "popupPlacement", "children"]); // Did not show popup when there is no options

      var menus = _react["default"].createElement("div", null);

      var emptyMenuClassName = '';

      if (options && options.length > 0) {
        menus = _react["default"].createElement(_Menus["default"], (0, _extends2["default"])({}, this.props, {
          value: this.state.value,
          activeValue: this.state.activeValue,
          onSelect: this.handleMenuSelect,
          visible: this.state.popupVisible
        }));
      } else {
        emptyMenuClassName = " ".concat(prefixCls, "-menus-empty");
      }

      return _react["default"].createElement(_trigger["default"], (0, _extends2["default"])({
        ref: this.saveTrigger
      }, restProps, {
        options: options,
        disabled: disabled,
        popupPlacement: popupPlacement,
        builtinPlacements: builtinPlacements,
        popupTransitionName: transitionName,
        action: disabled ? [] : ['click'],
        popupVisible: disabled ? false : this.state.popupVisible,
        onPopupVisibleChange: this.handlePopupVisibleChange,
        prefixCls: "".concat(prefixCls, "-menus"),
        popupClassName: popupClassName + emptyMenuClassName,
        popup: menus
      }), (0, _react.cloneElement)(children, {
        onKeyDown: this.handleKeyDown,
        tabIndex: disabled ? undefined : 0
      }));
    }
  }]);
  return Cascader;
}(_react.Component);

exports["default"] = Cascader;
(0, _defineProperty2["default"])(Cascader, "defaultProps", {
  options: [],
  onChange: function onChange() {},
  onPopupVisibleChange: function onPopupVisibleChange() {},
  disabled: false,
  transitionName: '',
  prefixCls: 'rc-cascader',
  popupClassName: '',
  popupPlacement: 'bottomLeft',
  builtinPlacements: BUILT_IN_PLACEMENTS,
  expandTrigger: 'click'
});
(0, _defineProperty2["default"])(Cascader, "propTypes", {
  value: _propTypes["default"].array,
  defaultValue: _propTypes["default"].array,
  options: _propTypes["default"].array.isRequired,
  onChange: _propTypes["default"].func,
  onPopupVisibleChange: _propTypes["default"].func,
  popupVisible: _propTypes["default"].bool,
  disabled: _propTypes["default"].bool,
  transitionName: _propTypes["default"].string,
  popupClassName: _propTypes["default"].string,
  popupPlacement: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  dropdownMenuColumnStyle: _propTypes["default"].object,
  builtinPlacements: _propTypes["default"].object,
  loadData: _propTypes["default"].func,
  changeOnSelect: _propTypes["default"].bool,
  children: _propTypes["default"].node,
  onKeyDown: _propTypes["default"].func,
  expandTrigger: _propTypes["default"].string
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhc2NhZGVyLmpzeCJdLCJuYW1lcyI6WyJCVUlMVF9JTl9QTEFDRU1FTlRTIiwiYm90dG9tTGVmdCIsInBvaW50cyIsIm9mZnNldCIsIm92ZXJmbG93IiwiYWRqdXN0WCIsImFkanVzdFkiLCJ0b3BMZWZ0IiwiYm90dG9tUmlnaHQiLCJ0b3BSaWdodCIsIkNhc2NhZGVyIiwicHJvcHMiLCJwb3B1cFZpc2libGUiLCJzZXRTdGF0ZSIsInN0YXRlIiwidmlzaWJsZSIsImFjdGl2ZVZhbHVlIiwidmFsdWUiLCJvblBvcHVwVmlzaWJsZUNoYW5nZSIsIm9wdGlvbnMiLCJzZXRQcm9wcyIsImUiLCJ0eXBlIiwia2V5Q29kZSIsIktleUNvZGUiLCJFTlRFUiIsIm9uQ2hhbmdlIiwibWFwIiwibyIsInNldFBvcHVwVmlzaWJsZSIsInRhcmdldE9wdGlvbiIsIm1lbnVJbmRleCIsInRyaWdnZXJOb2RlIiwidHJpZ2dlciIsImdldFJvb3REb21Ob2RlIiwiZm9jdXMiLCJjaGFuZ2VPblNlbGVjdCIsImxvYWREYXRhIiwiZXhwYW5kVHJpZ2dlciIsImRpc2FibGVkIiwic2xpY2UiLCJhY3RpdmVPcHRpb25zIiwiZ2V0QWN0aXZlT3B0aW9ucyIsImlzTGVhZiIsImNoaWxkcmVuIiwiaGFuZGxlQ2hhbmdlIiwibmV3U3RhdGUiLCJsZW5ndGgiLCJvbktleURvd24iLCJjdXJyZW50TGV2ZWwiLCJjdXJyZW50T3B0aW9ucyIsImdldEN1cnJlbnRMZXZlbE9wdGlvbnMiLCJjdXJyZW50SW5kZXgiLCJpbmRleE9mIiwiRE9XTiIsIlVQIiwiTEVGVCIsIlJJR0hUIiwiQkFDS1NQQUNFIiwiRVNDIiwibmV4dEluZGV4Iiwic3BsaWNlIiwicHVzaCIsImhhbmRsZU1lbnVTZWxlY3QiLCJub2RlIiwiaW5pdGlhbFZhbHVlIiwiZGVmYXVsdFZhbHVlIiwibmV4dFByb3BzIiwibmV3VmFsdWVzIiwiZ2V0UG9wdXBEb21Ob2RlIiwicmVzdWx0IiwibGV2ZWwiLCJmaWx0ZXIiLCJwcmVmaXhDbHMiLCJ0cmFuc2l0aW9uTmFtZSIsInBvcHVwQ2xhc3NOYW1lIiwiYnVpbHRpblBsYWNlbWVudHMiLCJwb3B1cFBsYWNlbWVudCIsInJlc3RQcm9wcyIsIm1lbnVzIiwiZW1wdHlNZW51Q2xhc3NOYW1lIiwic2F2ZVRyaWdnZXIiLCJoYW5kbGVQb3B1cFZpc2libGVDaGFuZ2UiLCJoYW5kbGVLZXlEb3duIiwidGFiSW5kZXgiLCJ1bmRlZmluZWQiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJhcnJheSIsImlzUmVxdWlyZWQiLCJmdW5jIiwiYm9vbCIsInN0cmluZyIsImRyb3Bkb3duTWVudUNvbHVtblN0eWxlIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBTUEsbUJBQW1CLEdBQUc7QUFDMUJDLEVBQUFBLFVBQVUsRUFBRTtBQUNWQyxJQUFBQSxNQUFNLEVBQUUsQ0FBQyxJQUFELEVBQU8sSUFBUCxDQURFO0FBRVZDLElBQUFBLE1BQU0sRUFBRSxDQUFDLENBQUQsRUFBSSxDQUFKLENBRkU7QUFHVkMsSUFBQUEsUUFBUSxFQUFFO0FBQ1JDLE1BQUFBLE9BQU8sRUFBRSxDQUREO0FBRVJDLE1BQUFBLE9BQU8sRUFBRTtBQUZEO0FBSEEsR0FEYztBQVMxQkMsRUFBQUEsT0FBTyxFQUFFO0FBQ1BMLElBQUFBLE1BQU0sRUFBRSxDQUFDLElBQUQsRUFBTyxJQUFQLENBREQ7QUFFUEMsSUFBQUEsTUFBTSxFQUFFLENBQUMsQ0FBRCxFQUFJLENBQUMsQ0FBTCxDQUZEO0FBR1BDLElBQUFBLFFBQVEsRUFBRTtBQUNSQyxNQUFBQSxPQUFPLEVBQUUsQ0FERDtBQUVSQyxNQUFBQSxPQUFPLEVBQUU7QUFGRDtBQUhILEdBVGlCO0FBaUIxQkUsRUFBQUEsV0FBVyxFQUFFO0FBQ1hOLElBQUFBLE1BQU0sRUFBRSxDQUFDLElBQUQsRUFBTyxJQUFQLENBREc7QUFFWEMs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LEVBQUFBLFFBQVEsRUFBRTZELHNCQUFVRyxJQUpIO0FBS2pCeEUsRUFBQUEsb0JBQW9CLEVBQUVxRSxzQkFBVUcsSUFMZjtBQU1qQjlFLEVBQUFBLFlBQVksRUFBRTJFLHNCQUFVSSxJQU5QO0FBT2pCcEQsRUFBQUEsUUFBUSxFQUFFZ0Qsc0JBQVVJLElBUEg7QUFRakJqQixFQUFBQSxjQUFjLEVBQUVhLHNCQUFVSyxNQVJUO0FBU2pCakIsRUFBQUEsY0FBYyxFQUFFWSxzQkFBVUssTUFUVDtBQVVqQmYsRUFBQUEsY0FBYyxFQUFFVSxzQkFBVUssTUFWVDtBQVdqQm5CLEVBQUFBLFNBQVMsRUFBRWMsc0JBQVVLLE1BWEo7QUFZakJDLEVBQUFBLHVCQUF1QixFQUFFTixzQkFBVU8sTUFabEI7QUFhakJsQixFQUFBQSxpQkFBaUIsRUFBRVcsc0JBQVVPLE1BYlo7QUFjakJ6RCxFQUFBQSxRQUFRLEVBQUVrRCxzQkFBVUcsSUFkSDtBQWVqQnRELEVBQUFBLGNBQWMsRUFBRW1ELHNCQUFVSSxJQWZUO0FBZ0JqQi9DLEVBQUFBLFFBQVEsRUFBRTJDLHNCQUFVdkIsSUFoQkg7QUFpQmpCaEIsRUFBQUEsU0FBUyxFQUFFdUMsc0JBQVVHLElBakJKO0FBa0JqQnBELEVBQUFBLGFBQWEsRUFBRWlELHNCQUFVSztBQWxCUixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IGNsb25lRWxlbWVudCwgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBhcnJheVRyZWVGaWx0ZXIgZnJvbSAnYXJyYXktdHJlZS1maWx0ZXInO1xuaW1wb3J0IGlzRXF1YWwgZnJvbSAnbG9kYXNoL2lzRXF1YWwnO1xuaW1wb3J0IFRyaWdnZXIgZnJvbSAnLi4vdHJpZ2dlcic7XG5pbXBvcnQgTWVudXMgZnJvbSAnLi9NZW51cyc7XG5pbXBvcnQgS2V5Q29kZSBmcm9tICcuLi8uLi9fdXRpbC9LZXlDb2RlJztcblxuY29uc3QgQlVJTFRfSU5fUExBQ0VNRU5UUyA9IHtcbiAgYm90dG9tTGVmdDoge1xuICAgIHBvaW50czogWyd0bCcsICdibCddLFxuICAgIG9mZnNldDogWzAsIDRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICB0b3BMZWZ0OiB7XG4gICAgcG9pbnRzOiBbJ2JsJywgJ3RsJ10sXG4gICAgb2Zmc2V0OiBbMCwgLTRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICBib3R0b21SaWdodDoge1xuICAgIHBvaW50czogWyd0cicsICdiciddLFxuICAgIG9mZnNldDogWzAsIDRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICB0b3BSaWdodDoge1xuICAgIHBvaW50czogWydicicsICd0ciddLFxuICAgIG9mZnNldDogWzAsIC00XSxcbiAgICBvdmVyZmxvdzoge1xuICAgICAgYWRqdXN0WDogMSxcbiAgICAgIGFkanVzdFk6IDEsXG4gICAgfSxcbiAgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhc2NhZGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBvcHRpb25zOiBbXSxcbiAgICBvbkNoYW5nZSgpIHt9LFxuICAgIG9uUG9wdXBWaXNpYmxlQ2hhbmdlKCkge30sXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIHRyYW5zaXRpb25OYW1lOiAnJyxcbiAgICBwcmVmaXhDbHM6ICdyYy1jYXNjYWRlcicsXG4gICAgcG9wdXBDbGFzc05hbWU6ICcnLFxuICAgIHBvcHVwUGxhY2VtZW50OiAnYm90dG9tTGVmdCcsXG4gICAgYnVpbHRpblBsYWNlbWVudHM6IEJVSUxUX0lOX1BMQUNFTUVOVFMsXG4gICAgZXhwYW5kVHJpZ2dlcjogJ2NsaWNrJyxcbiAgfTtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHZhbHVlOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgZGVmYXVsdFZhbHVlOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgb3B0aW9uczogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uUG9wdXBWaXNpYmxlQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBwb3B1cFZpc2libGU6IFByb3BUeXBlcy5ib29sLFxuICAgIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgICB0cmFuc2l0aW9uTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBwb3B1cENsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBwb3B1cFBsYWNlbWVudDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZHJvcGRvd25NZW51Q29sdW1uU3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgYnVpbHRpblBsYWNlbWVudHM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgbG9hZERhdGE6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNoYW5nZU9uU2VsZWN0OiBQcm9wVHlwZXMuYm9vbCxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG4gICAgb25LZXlEb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBleHBhbmRUcmlnZ2VyOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGxldCBpbml0aWFsVmFsdWUgPSBbXTtcbiAgICBpZiAoJ3ZhbHVlJyBpbiBwcm9wcykge1xuICAgICAgaW5pdGlhbFZhbHVlID0gcHJvcHMudmFsdWUgfHwgW107XG4gICAgfSBlbHNlIGlmICgnZGVmYXVsdFZhbHVlJyBpbiBwcm9wcykge1xuICAgICAgaW5pdGlhbFZhbHVlID0gcHJvcHMuZGVmYXVsdFZhbHVlIHx8IFtdO1xuICAgIH1cblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBwb3B1cFZpc2libGU6IHByb3BzLnBvcHVwVmlzaWJsZSxcbiAgICAgIGFjdGl2ZVZhbHVlOiBpbml0aWFsVmFsdWUsXG4gICAgICB2YWx1ZTogaW5pdGlhbFZhbHVlLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICgndmFsdWUnIGluIG5leHRQcm9wcyAmJiAhaXNFcXVhbCh0aGlzLnByb3BzLnZhbHVlLCBuZXh0UHJvcHMudmFsdWUpKSB7XG4gICAgICBjb25zdCBuZXdWYWx1ZXMgPSB7XG4gICAgICAgIHZhbHVlOiBuZXh0UHJvcHMudmFsdWUgfHwgW10sXG4gICAgICAgIGFjdGl2ZVZhbHVlOiBuZXh0UHJvcHMudmFsdWUgfHwgW10sXG4gICAgICB9O1xuICAgICAgLy8gYWxsb3cgYWN0aXZlVmFsdWUgZGlmZiBmcm9tIHZhbHVlXG4gICAgICBpZiAoJ2xvYWREYXRhJyBpbiBuZXh0UHJvcHMpIHtcbiAgICAgICAgZGVsZXRlIG5ld1ZhbHVlcy5hY3RpdmVWYWx1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUobmV3VmFsdWVzKTtcbiAgICB9XG4gICAgaWYgKCdwb3B1cFZpc2libGUnIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHBvcHVwVmlzaWJsZTogbmV4dFByb3BzLnBvcHVwVmlzaWJsZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldFBvcHVwRE9NTm9kZSgpIHtcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyLmdldFBvcHVwRG9tTm9kZSgpO1xuICB9XG5cbiAgZ2V0Q3VycmVudExldmVsT3B0aW9ucygpIHtcbiAgICBjb25zdCB7IG9wdGlvbnMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBhY3RpdmVWYWx1ZSA9IFtdIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHJlc3VsdCA9IGFycmF5VHJlZUZpbHRlcihvcHRpb25zLCAobywgbGV2ZWwpID0+IG8udmFsdWUgPT09IGFjdGl2ZVZhbHVlW2xldmVsXSk7XG4gICAgaWYgKHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMl0pIHtcbiAgICAgIHJldHVybiByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDJdLmNoaWxkcmVuO1xuICAgIH1cbiAgICByZXR1cm4gWy4uLm9wdGlvbnNdLmZpbHRlcihvID0+ICFvLmRpc2FibGVkKTtcbiAgfVxuXG4gIGdldEFjdGl2ZU9wdGlvbnMoYWN0aXZlVmFsdWUpIHtcbiAgICByZXR1cm4gYXJyYXlUcmVlRmlsdGVyKHRoaXMucHJvcHMub3B0aW9ucywgKG8sIGxldmVsKSA9PiBvLnZhbHVlID09PSBhY3RpdmVWYWx1ZVtsZXZlbF0pO1xuICB9XG5cbiAgc2V0UG9wdXBWaXNpYmxlID0gcG9wdXBWaXNpYmxlID0+IHtcbiAgICBpZiAoISgncG9wdXBWaXNpYmxlJyBpbiB0aGlzLnByb3BzKSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHBvcHVwVmlzaWJsZSB9KTtcbiAgICB9XG4gICAgLy8gc3luYyBhY3RpdmVWYWx1ZSB3aXRoIHZhbHVlIHdoZW4gcGFuZWwgb3BlblxuICAgIGlmIChwb3B1cFZpc2libGUgJiYgIXRoaXMuc3RhdGUudmlzaWJsZSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGFjdGl2ZVZhbHVlOiB0aGlzLnN0YXRlLnZhbHVlLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25Qb3B1cFZpc2libGVDaGFuZ2UocG9wdXBWaXNpYmxlKTtcbiAgfTtcbiAgaGFuZGxlQ2hhbmdlID0gKG9wdGlvbnMsIHNldFByb3BzLCBlKSA9PiB7XG4gICAgaWYgKGUudHlwZSAhPT0gJ2tleWRvd24nIHx8IGUua2V5Q29kZSA9PT0gS2V5Q29kZS5FTlRFUikge1xuICAgICAgdGhpcy5wcm9wcy5vbkNoYW5nZShvcHRpb25zLm1hcChvID0+IG8udmFsdWUpLCBvcHRpb25zKTtcbiAgICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKHNldFByb3BzLnZpc2libGUpO1xuICAgIH1cbiAgfTtcbiAgaGFuZGxlUG9wdXBWaXNpYmxlQ2hhbmdlID0gcG9wdXBWaXNpYmxlID0+IHtcbiAgICB0aGlzLnNldFBvcHVwVmlzaWJsZShwb3B1cFZpc2libGUpO1xuICB9O1xuICBoYW5kbGVNZW51U2VsZWN0ID0gKHRhcmdldE9wdGlvbiwgbWVudUluZGV4LCBlKSA9PiB7XG4gICAgLy8gS2VlcCBmb2N1c2VkIHN0YXRlIGZvciBrZXlib2FyZCBzdXBwb3J0XG4gICAgY29uc3QgdHJpZ2dlck5vZGUgPSB0aGlzLnRyaWdnZXIuZ2V0Um9vdERvbU5vZGUoKTtcbiAgICBpZiAodHJpZ2dlck5vZGUgJiYgdHJpZ2dlck5vZGUuZm9jdXMpIHtcbiAgICAgIHRyaWdnZXJOb2RlLmZvY3VzKCk7XG4gICAgfVxuICAgIGNvbnN0IHsgY2hhbmdlT25TZWxlY3QsIGxvYWREYXRhLCBleHBhbmRUcmlnZ2VyIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghdGFyZ2V0T3B0aW9uIHx8IHRhcmdldE9wdGlvbi5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgeyBhY3RpdmVWYWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBhY3RpdmVWYWx1ZSA9IGFjdGl2ZVZhbHVlLnNsaWNlKDAsIG1lbnVJbmRleCArIDEpO1xuICAgIGFjdGl2ZVZhbHVlW21lbnVJbmRleF0gPSB0YXJnZXRPcHRpb24udmFsdWU7XG4gICAgY29uc3QgYWN0aXZlT3B0aW9ucyA9IHRoaXMuZ2V0QWN0aXZlT3B0aW9ucyhhY3RpdmVWYWx1ZSk7XG4gICAgaWYgKHRhcmdldE9wdGlvbi5pc0xlYWYgPT09IGZhbHNlICYmICF0YXJnZXRPcHRpb24uY2hpbGRyZW4gJiYgbG9hZERhdGEpIHtcbiAgICAgIGlmIChjaGFuZ2VPblNlbGVjdCkge1xuICAgICAgICB0aGlzLmhhbmRsZUNoYW5nZShhY3RpdmVPcHRpb25zLCB7IHZpc2libGU6IHRydWUgfSwgZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnNldFN0YXRlKHsgYWN0aXZlVmFsdWUgfSk7XG4gICAgICBsb2FkRGF0YShhY3RpdmVPcHRpb25zKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbmV3U3RhdGUgPSB7fTtcbiAgICBpZiAoIXRhcmdldE9wdGlvbi5jaGlsZHJlbiB8fCAhdGFyZ2V0T3B0aW9uLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoYWN0aXZlT3B0aW9ucywgeyB2aXNpYmxlOiBmYWxzZSB9LCBlKTtcbiAgICAgIC8vIHNldCB2YWx1ZSB0byBhY3RpdmVWYWx1ZSB3aGVuIHNlbGVjdCBsZWFmIG9wdGlvblxuICAgICAgbmV3U3RhdGUudmFsdWUgPSBhY3RpdmVWYWx1ZTtcbiAgICAgIC8vIGFkZCBlLnR5cGUganVkZ2VtZW50IHRvIHByZXZlbnQgYG9uQ2hhbmdlYCBiZWluZyB0cmlnZ2VyZWQgYnkgbW91c2VFbnRlclxuICAgIH0gZWxzZSBpZiAoY2hhbmdlT25TZWxlY3QgJiYgKGUudHlwZSA9PT0gJ2NsaWNrJyB8fCBlLnR5cGUgPT09ICdrZXlkb3duJykpIHtcbiAgICAgIGlmIChleHBhbmRUcmlnZ2VyID09PSAnaG92ZXInKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKGFjdGl2ZU9wdGlvbnMsIHsgdmlzaWJsZTogZmFsc2UgfSwgZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmhhbmRsZUNoYW5nZShhY3RpdmVPcHRpb25zLCB7IHZpc2libGU6IHRydWUgfSwgZSk7XG4gICAgICB9XG4gICAgICAvLyBzZXQgdmFsdWUgdG8gYWN0aXZlVmFsdWUgb24gZXZlcnkgc2VsZWN0XG4gICAgICBuZXdTdGF0ZS52YWx1ZSA9IGFjdGl2ZVZhbHVlO1xuICAgIH1cbiAgICBuZXdTdGF0ZS5hY3RpdmVWYWx1ZSA9IGFjdGl2ZVZhbHVlO1xuICAgIC8vICBub3QgY2hhbmdlIHRoZSB2YWx1ZSBieSBrZXlib2FyZFxuICAgIGlmICgndmFsdWUnIGluIHRoaXMucHJvcHMgfHwgKGUudHlwZSA9PT0gJ2tleWRvd24nICYmIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5FTlRFUikpIHtcbiAgICAgIGRlbGV0ZSBuZXdTdGF0ZS52YWx1ZTtcbiAgICB9XG4gICAgdGhpcy5zZXRTdGF0ZShuZXdTdGF0ZSk7XG4gIH07XG4gIGhhbmRsZUtleURvd24gPSBlID0+IHtcbiAgICBjb25zdCB7IGNoaWxkcmVuIH0gPSB0aGlzLnByb3BzO1xuICAgIC8vIERvbid0IGJpbmQga2V5Ym9hcmQgc3VwcG9ydCB3aGVuIGNoaWxkcmVuIHNwZWNpZnkgdGhlIG9uS2V5RG93blxuICAgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5wcm9wcy5vbktleURvd24pIHtcbiAgICAgIGNoaWxkcmVuLnByb3BzLm9uS2V5RG93bihlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYWN0aXZlVmFsdWUgPSBbLi4udGhpcy5zdGF0ZS5hY3RpdmVWYWx1ZV07XG4gICAgY29uc3QgY3VycmVudExldmVsID0gYWN0aXZlVmFsdWUubGVuZ3RoIC0gMSA8IDAgPyAwIDogYWN0aXZlVmFsdWUubGVuZ3RoIC0gMTtcbiAgICBjb25zdCBjdXJyZW50T3B0aW9ucyA9IHRoaXMuZ2V0Q3VycmVudExldmVsT3B0aW9ucygpO1xuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IGN1cnJlbnRPcHRpb25zLm1hcChvID0+IG8udmFsdWUpLmluZGV4T2YoYWN0aXZlVmFsdWVbY3VycmVudExldmVsXSk7XG4gICAgaWYgKFxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkRPV04gJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5VUCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkxFRlQgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5SSUdIVCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkVOVEVSICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuQkFDS1NQQUNFICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuRVNDXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFByZXNzIGFueSBrZXlzIGFib3ZlIHRvIHJlb3BlbiBtZW51XG4gICAgaWYgKFxuICAgICAgIXRoaXMuc3RhdGUucG9wdXBWaXNpYmxlICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuQkFDS1NQQUNFICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuTEVGVCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLlJJR0hUICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuRVNDXG4gICAgKSB7XG4gICAgICB0aGlzLnNldFBvcHVwVmlzaWJsZSh0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5ET1dOIHx8IGUua2V5Q29kZSA9PT0gS2V5Q29kZS5VUCkge1xuICAgICAgbGV0IG5leHRJbmRleCA9IGN1cnJlbnRJbmRleDtcbiAgICAgIGlmIChuZXh0SW5kZXggIT09IC0xKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuRE9XTikge1xuICAgICAgICAgIG5leHRJbmRleCArPSAxO1xuICAgICAgICAgIG5leHRJbmRleCA9IG5leHRJbmRleCA+PSBjdXJyZW50T3B0aW9ucy5sZW5ndGggPyAwIDogbmV4dEluZGV4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5leHRJbmRleCAtPSAxO1xuICAgICAgICAgIG5leHRJbmRleCA9IG5leHRJbmRleCA8IDAgPyBjdXJyZW50T3B0aW9ucy5sZW5ndGggLSAxIDogbmV4dEluZGV4O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXh0SW5kZXggPSAwO1xuICAgICAgfVxuICAgICAgYWN0aXZlVmFsdWVbY3VycmVudExldmVsXSA9IGN1cnJlbnRPcHRpb25zW25leHRJbmRleF0udmFsdWU7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuTEVGVCB8fCBlLmtleUNvZGUgPT09IEtleUNvZGUuQkFDS1NQQUNFKSB7XG4gICAgICBhY3RpdmVWYWx1ZS5zcGxpY2UoYWN0aXZlVmFsdWUubGVuZ3RoIC0gMSwgMSk7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuUklHSFQpIHtcbiAgICAgIGlmIChjdXJyZW50T3B0aW9uc1tjdXJyZW50SW5kZXhdICYmIGN1cnJlbnRPcHRpb25zW2N1cnJlbnRJbmRleF0uY2hpbGRyZW4pIHtcbiAgICAgICAgYWN0aXZlVmFsdWUucHVzaChjdXJyZW50T3B0aW9uc1tjdXJyZW50SW5kZXhdLmNoaWxkcmVuWzBdLnZhbHVlKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5FU0MpIHtcbiAgICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKGZhbHNlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFhY3RpdmVWYWx1ZSB8fCBhY3RpdmVWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKGZhbHNlKTtcbiAgICB9XG4gICAgY29uc3QgYWN0aXZlT3B0aW9ucyA9IHRoaXMuZ2V0QWN0aXZlT3B0aW9ucyhhY3RpdmVWYWx1ZSk7XG4gICAgY29uc3QgdGFyZ2V0T3B0aW9uID0gYWN0aXZlT3B0aW9uc1thY3RpdmVPcHRpb25zLmxlbmd0aCAtIDFdO1xuICAgIHRoaXMuaGFuZGxlTWVudVNlbGVjdCh0YXJnZXRPcHRpb24sIGFjdGl2ZU9wdGlvbnMubGVuZ3RoIC0gMSwgZSk7XG5cbiAgICBpZiAodGhpcy5wcm9wcy5vbktleURvd24pIHtcbiAgICAgIHRoaXMucHJvcHMub25LZXlEb3duKGUpO1xuICAgIH1cbiAgfTtcblxuICBzYXZlVHJpZ2dlciA9IG5vZGUgPT4ge1xuICAgIHRoaXMudHJpZ2dlciA9IG5vZGU7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENscyxcbiAgICAgIHRyYW5zaXRpb25OYW1lLFxuICAgICAgcG9wdXBDbGFzc05hbWUsXG4gICAgICBvcHRpb25zLFxuICAgICAgZGlzYWJsZWQsXG4gICAgICBidWlsdGluUGxhY2VtZW50cyxcbiAgICAgIHBvcHVwUGxhY2VtZW50LFxuICAgICAgY2hpbGRyZW4sXG4gICAgICAuLi5yZXN0UHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICAvLyBEaWQgbm90IHNob3cgcG9wdXAgd2hlbiB0aGVyZSBpcyBubyBvcHRpb25zXG4gICAgbGV0IG1lbnVzID0gPGRpdiAvPjtcbiAgICBsZXQgZW1wdHlNZW51Q2xhc3NOYW1lID0gJyc7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBtZW51cyA9IChcbiAgICAgICAgPE1lbnVzXG4gICAgICAgICAgey4uLnRoaXMucHJvcHN9XG4gICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUudmFsdWV9XG4gICAgICAgICAgYWN0aXZlVmFsdWU9e3RoaXMuc3RhdGUuYWN0aXZlVmFsdWV9XG4gICAgICAgICAgb25TZWxlY3Q9e3RoaXMuaGFuZGxlTWVudVNlbGVjdH1cbiAgICAgICAgICB2aXNpYmxlPXt0aGlzLnN0YXRlLnBvcHVwVmlzaWJsZX1cbiAgICAgICAgLz5cbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVtcHR5TWVudUNsYXNzTmFtZSA9IGAgJHtwcmVmaXhDbHN9LW1lbnVzLWVtcHR5YDtcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxUcmlnZ2VyXG4gICAgICAgIHJlZj17dGhpcy5zYXZlVHJpZ2dlcn1cbiAgICAgICAgey4uLnJlc3RQcm9wc31cbiAgICAgICAgb3B0aW9ucz17b3B0aW9uc31cbiAgICAgICAgZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICBwb3B1cFBsYWNlbWVudD17cG9wdXBQbGFjZW1lbnR9XG4gICAgICAgIGJ1aWx0aW5QbGFjZW1lbnRzPXtidWlsdGluUGxhY2VtZW50c31cbiAgICAgICAgcG9wdXBUcmFuc2l0aW9uTmFtZT17dHJhbnNpdGlvbk5hbWV9XG4gICAgICAgIGFjdGlvbj17ZGlzYWJsZWQgPyBbXSA6IFsnY2xpY2snXX1cbiAgICAgICAgcG9wdXBWaXNpYmxlPXtkaXNhYmxlZCA/IGZhbHNlIDogdGhpcy5zdGF0ZS5wb3B1cFZpc2libGV9XG4gICAgICAgIG9uUG9wdXBWaXNpYmxlQ2hhbmdlPXt0aGlzLmhhbmRsZVBvcHVwVmlzaWJsZUNoYW5nZX1cbiAgICAgICAgcHJlZml4Q2xzPXtgJHtwcmVmaXhDbHN9LW1lbnVzYH1cbiAgICAgICAgcG9wdXBDbGFzc05hbWU9e3BvcHVwQ2xhc3NOYW1lICsgZW1wdHlNZW51Q2xhc3NOYW1lfVxuICAgICAgICBwb3B1cD17bWVudXN9XG4gICAgICA+XG4gICAgICAgIHtjbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgICAgICBvbktleURvd246IHRoaXMuaGFuZGxlS2V5RG93bixcbiAgICAgICAgICB0YWJJbmRleDogZGlzYWJsZWQgPyB1bmRlZmluZWQgOiAwLFxuICAgICAgICB9KX1cbiAgICAgIDwvVHJpZ2dlcj5cbiAgICApO1xuICB9XG59XG4iXX0=