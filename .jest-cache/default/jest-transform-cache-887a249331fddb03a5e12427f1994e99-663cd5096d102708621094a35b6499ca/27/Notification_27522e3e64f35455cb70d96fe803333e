4678554e233512fff2cbe99daf7edb00
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _animate = _interopRequireDefault(require("../../animate"));

var _createChainedFunction = _interopRequireDefault(require("../util/createChainedFunction"));

var _classnames = _interopRequireDefault(require("classnames"));

var _Notice = _interopRequireDefault(require("./Notice"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var seed = 0;
var now = Date.now();

function getUuid() {
  return "rcNotification_".concat(now, "_").concat(seed++);
}

var Notification =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Notification, _Component);

  var _super = _createSuper(Notification);

  function Notification() {
    var _this;

    (0, _classCallCheck2["default"])(this, Notification);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      notices: []
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "add", function (notice) {
      var key = notice.key = notice.key || getUuid();

      _this.setState(function (previousState) {
        var notices = previousState.notices;

        if (!notices.filter(function (v) {
          return v.key === key;
        }).length) {
          return {
            notices: notices.concat(notice)
          };
        }
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "remove", function (key) {
      _this.setState(function (previousState) {
        return {
          notices: previousState.notices.filter(function (notice) {
            return notice.key !== key;
          })
        };
      });
    });
    return _this;
  }

  (0, _createClass2["default"])(Notification, [{
    key: "getTransitionName",
    value: function getTransitionName() {
      var props = this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(props.animation);
      }

      return transitionName;
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this,
          _className;

      var props = this.props;
      var noticeNodes = this.state.notices.map(function (notice) {
        var onClose = (0, _createChainedFunction["default"])(_this2.remove.bind(_this2, notice.key), notice.onClose);
        return _react["default"].createElement(_Notice["default"], (0, _extends2["default"])({
          prefixCls: props.prefixCls
        }, notice, {
          onClose: onClose,
          closeIcon: props.closeIcon
        }), notice.content);
      });
      var className = (_className = {}, (0, _defineProperty2["default"])(_className, props.prefixCls, 1), (0, _defineProperty2["default"])(_className, props.className, !!props.className), _className);
      return _react["default"].createElement("div", {
        className: (0, _classnames["default"])(className),
        style: props.style
      }, _react["default"].createElement(_animate["default"], {
        transitionName: this.getTransitionName()
      }, noticeNodes));
    }
  }]);
  return Notification;
}(_react.Component);

exports["default"] = Notification;
(0, _defineProperty2["default"])(Notification, "propTypes", {
  prefixCls: _propTypes["default"].string,
  transitionName: _propTypes["default"].string,
  animation: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].object]),
  style: _propTypes["default"].object,
  closeIcon: _propTypes["default"].node
});
(0, _defineProperty2["default"])(Notification, "defaultProps", {
  prefixCls: 'rc-notification',
  animation: 'fade',
  style: {
    top: 65,
    left: '50%'
  }
});
(0, _defineProperty2["default"])(Notification, "newInstance", function newNotificationInstance(properties, callback) {
  var _ref = properties || {},
      getContainer = _ref.getContainer,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["getContainer"]);

  var div = document.createElement('div');

  if (getContainer) {
    var root = getContainer();
    root.appendChild(div);
  } else {
    document.body.appendChild(div);
  }

  var called = false;

  function ref(notification) {
    if (called) {
      return;
    }

    called = true;
    callback({
      notice: function notice(noticeProps) {
        notification.add(noticeProps);
      },
      removeNotice: function removeNotice(key) {
        notification.remove(key);
      },
      component: notification,
      destroy: function destroy() {
        _reactDom["default"].unmountComponentAtNode(div);

        div.parentNode.removeChild(div);
      }
    });
  }

  _reactDom["default"].render(_react["default"].createElement(Notification, (0, _extends2["default"])({}, props, {
    ref: ref
  })), div);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vdGlmaWNhdGlvbi9Ob3RpZmljYXRpb24uanN4Il0sIm5hbWVzIjpbInNlZWQiLCJub3ciLCJEYXRlIiwiTm90aWZpY2F0aW9uIiwiQ29tcG9uZW50IiwicHJlZml4Q2xzIiwiUHJvcFR5cGVzIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb24iLCJzdHlsZSIsImNsb3NlSWNvbiIsIm5vZGUiLCJ0b3AiLCJsZWZ0IiwiZ2V0Q29udGFpbmVyIiwicHJvcHMiLCJwcm9wZXJ0aWVzIiwiZGl2IiwiZG9jdW1lbnQiLCJyb290IiwiY2FsbGVkIiwiY2FsbGJhY2siLCJub3RpY2UiLCJub3RpZmljYXRpb24iLCJyZW1vdmVOb3RpY2UiLCJjb21wb25lbnQiLCJkZXN0cm95IiwiUmVhY3RET00iLCJyZWYiLCJub3RpY2VzIiwia2V5IiwiZ2V0VXVpZCIsInByZXZpb3VzU3RhdGUiLCJ2Iiwibm90aWNlTm9kZXMiLCJvbkNsb3NlIiwiY2xhc3NOYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsVUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGVBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsc0JBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSwrQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxPQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxDQUFBLENBQUE7Ozs7Ozs7Ozs7Ozs7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QUEsQ0FBQUEsR0FBQUE7QUFMSyxPQUFBO0FBT1BFLE1BQUFBLFNBQVMsRUFQRixZQUFBO0FBUVBDLE1BQUFBLE9BUk8sRUFBQSxTQUFBLE9BQUEsR0FRRztBQUNSQyxRQUFBQSxTQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUFBQSxzQkFBQUEsQ0FBQUEsR0FBQUE7O0FBQ0FWLFFBQUFBLEdBQUcsQ0FBSEEsVUFBQUEsQ0FBQUEsV0FBQUEsQ0FBQUEsR0FBQUE7QUFDRDtBQVhNLEtBQUQsQ0FBUkk7QUFhRDs7QUFFRE0sRUFBQUEsU0FBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBQUEsTUFBQUEsQ0FBZ0IsTUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLGFBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQSxHQUFBLFNBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxFQUFBLEVBQUEsS0FBQSxFQUFBO0FBQXlCLElBQUEsR0FBRyxFQUFFQztBQUE5QixHQUFBLENBQUEsQ0FBaEJELEVBQUFBLEdBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBBbmltYXRlIGZyb20gJy4uLy4uL2FuaW1hdGUnO1xuaW1wb3J0IGNyZWF0ZUNoYWluZWRGdW5jdGlvbiBmcm9tICcuLi91dGlsL2NyZWF0ZUNoYWluZWRGdW5jdGlvbic7XG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBOb3RpY2UgZnJvbSAnLi9Ob3RpY2UnO1xuXG5sZXQgc2VlZCA9IDA7XG5jb25zdCBub3cgPSBEYXRlLm5vdygpO1xuXG5mdW5jdGlvbiBnZXRVdWlkKCkge1xuICByZXR1cm4gYHJjTm90aWZpY2F0aW9uXyR7bm93fV8ke3NlZWQrK31gO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOb3RpZmljYXRpb24gZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB0cmFuc2l0aW9uTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBhbmltYXRpb246IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5zdHJpbmcsIFByb3BUeXBlcy5vYmplY3RdKSxcbiAgICBzdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBjbG9zZUljb246IFByb3BUeXBlcy5ub2RlLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgcHJlZml4Q2xzOiAncmMtbm90aWZpY2F0aW9uJyxcbiAgICBhbmltYXRpb246ICdmYWRlJyxcbiAgICBzdHlsZToge1xuICAgICAgdG9wOiA2NSxcbiAgICAgIGxlZnQ6ICc1MCUnLFxuICAgIH0sXG4gIH07XG5cbiAgc3RhdGljIG5ld0luc3RhbmNlID0gZnVuY3Rpb24gbmV3Tm90aWZpY2F0aW9uSW5zdGFuY2UocHJvcGVydGllcywgY2FsbGJhY2spIHtcbiAgICBjb25zdCB7IGdldENvbnRhaW5lciwgLi4ucHJvcHMgfSA9IHByb3BlcnRpZXMgfHwge307XG4gICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgaWYgKGdldENvbnRhaW5lcikge1xuICAgICAgY29uc3Qgcm9vdCA9IGdldENvbnRhaW5lcigpO1xuICAgICAgcm9vdC5hcHBlbmRDaGlsZChkaXYpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRpdik7XG4gICAgfVxuICAgIGxldCBjYWxsZWQgPSBmYWxzZTtcblxuICAgIGZ1bmN0aW9uIHJlZihub3RpZmljYXRpb24pIHtcbiAgICAgIGlmIChjYWxsZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgIGNhbGxiYWNrKHtcbiAgICAgICAgbm90aWNlKG5vdGljZVByb3BzKSB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLmFkZChub3RpY2VQcm9wcyk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlbW92ZU5vdGljZShrZXkpIHtcbiAgICAgICAgICBub3RpZmljYXRpb24ucmVtb3ZlKGtleSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBvbmVudDogbm90aWZpY2F0aW9uLFxuICAgICAgICBkZXN0cm95KCkge1xuICAgICAgICAgIFJlYWN0RE9NLnVubW91bnRDb21wb25lbnRBdE5vZGUoZGl2KTtcbiAgICAgICAgICBkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkaXYpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgUmVhY3RET00ucmVuZGVyKDxOb3RpZmljYXRpb24gey4uLnByb3BzfSByZWY9e3JlZn0gLz4sIGRpdik7XG4gIH07XG5cbiAgc3RhdGUgPSB7XG4gICAgbm90aWNlczogW10sXG4gIH07XG5cbiAgZ2V0VHJhbnNpdGlvbk5hbWUoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCB0cmFuc2l0aW9uTmFtZSA9IHByb3BzLnRyYW5zaXRpb25OYW1lO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgcHJvcHMuYW5pbWF0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3Byb3BzLnByZWZpeENsc30tJHtwcm9wcy5hbmltYXRpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9XG5cbiAgYWRkID0gbm90aWNlID0+IHtcbiAgICBjb25zdCBrZXkgPSAobm90aWNlLmtleSA9IG5vdGljZS5rZXkgfHwgZ2V0VXVpZCgpKTtcbiAgICB0aGlzLnNldFN0YXRlKHByZXZpb3VzU3RhdGUgPT4ge1xuICAgICAgY29uc3Qgbm90aWNlcyA9IHByZXZpb3VzU3RhdGUubm90aWNlcztcbiAgICAgIGlmICghbm90aWNlcy5maWx0ZXIodiA9PiB2LmtleSA9PT0ga2V5KS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBub3RpY2VzOiBub3RpY2VzLmNvbmNhdChub3RpY2UpLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJlbW92ZSA9IGtleSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5vdGljZXM6IHByZXZpb3VzU3RhdGUubm90aWNlcy5maWx0ZXIobm90aWNlID0+IG5vdGljZS5rZXkgIT09IGtleSksXG4gICAgICB9O1xuICAgIH0pO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qgbm90aWNlTm9kZXMgPSB0aGlzLnN0YXRlLm5vdGljZXMubWFwKG5vdGljZSA9PiB7XG4gICAgICBjb25zdCBvbkNsb3NlID0gY3JlYXRlQ2hhaW5lZEZ1bmN0aW9uKHRoaXMucmVtb3ZlLmJpbmQodGhpcywgbm90aWNlLmtleSksIG5vdGljZS5vbkNsb3NlKTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxOb3RpY2VcbiAgICAgICAgICBwcmVmaXhDbHM9e3Byb3BzLnByZWZpeENsc31cbiAgICAgICAgICB7Li4ubm90aWNlfVxuICAgICAgICAgIG9uQ2xvc2U9e29uQ2xvc2V9XG4gICAgICAgICAgY2xvc2VJY29uPXtwcm9wcy5jbG9zZUljb259XG4gICAgICAgID5cbiAgICAgICAgICB7bm90aWNlLmNvbnRlbnR9XG4gICAgICAgIDwvTm90aWNlPlxuICAgICAgKTtcbiAgICB9KTtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB7XG4gICAgICBbcHJvcHMucHJlZml4Q2xzXTogMSxcbiAgICAgIFtwcm9wcy5jbGFzc05hbWVdOiAhIXByb3BzLmNsYXNzTmFtZSxcbiAgICB9O1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NuYW1lcyhjbGFzc05hbWUpfSBzdHlsZT17cHJvcHMuc3R5bGV9PlxuICAgICAgICA8QW5pbWF0ZSB0cmFuc2l0aW9uTmFtZT17dGhpcy5nZXRUcmFuc2l0aW9uTmFtZSgpfT57bm90aWNlTm9kZXN9PC9BbmltYXRlPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl19