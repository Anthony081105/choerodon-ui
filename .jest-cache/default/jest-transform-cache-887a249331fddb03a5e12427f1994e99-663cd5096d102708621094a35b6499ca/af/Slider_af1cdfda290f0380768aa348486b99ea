7eaece10249e6672ea6dc5951c37e0bf
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _warning = _interopRequireDefault(require("../../_util/warning"));

var _Track = _interopRequireDefault(require("./common/Track"));

var _createSlider = _interopRequireDefault(require("./common/createSlider"));

var utils = _interopRequireWildcard(require("./utils"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Slider =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Slider, _Component);

  var _super = _createSuper(Slider);

  function Slider(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Slider);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onEnd", function () {
      _this.setState({
        dragging: false
      });

      _this.removeDocumentEvents();

      _this.props.onAfterChange(_this.getValue());
    });
    var defaultValue = props.defaultValue !== undefined ? props.defaultValue : props.min;
    var value = props.value !== undefined ? props.value : defaultValue;
    _this.state = {
      value: _this.trimAlignValue(value),
      dragging: false
    };

    if (process.env.NODE_ENV !== 'production') {
      (0, _warning["default"])(!('minimumTrackStyle' in props), 'minimumTrackStyle will be deprecate, please use trackStyle instead.');
      (0, _warning["default"])(!('maximumTrackStyle' in props), 'maximumTrackStyle will be deprecate, please use railStyle instead.');
    }

    return _this;
  }

  (0, _createClass2["default"])(Slider, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this$props = this.props,
          autoFocus = _this$props.autoFocus,
          disabled = _this$props.disabled;

      if (autoFocus && !disabled) {
        this.focus();
      }
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (!('value' in nextProps || 'min' in nextProps || 'max' in nextProps)) return;
      var prevValue = this.state.value;
      var value = nextProps.value !== undefined ? nextProps.value : prevValue;
      var nextValue = this.trimAlignValue(value, nextProps);
      if (nextValue === prevValue) return;
      this.setState({
        value: nextValue
      });

      if (utils.isValueOutOfRange(value, nextProps)) {
        this.props.onChange(nextValue);
      }
    }
  }, {
    key: "onChange",
    value: function onChange(state) {
      var props = this.props;
      var isNotControlled = !('value' in props);

      if (isNotControlled) {
        this.setState(state);
      }

      var changedValue = state.value;
      props.onChange(changedValue);
    }
  }, {
    key: "onStart",
    value: function onStart(position) {
      this.setState({
        dragging: true
      });
      var props = this.props;
      var prevValue = this.getValue();
      props.onBeforeChange(prevValue);
      var value = this.calcValueByPos(position);
      this.startValue = value;
      this.startPosition = position;
      if (value === prevValue) return;
      this.prevMovedHandleIndex = 0;
      this.onChange({
        value: value
      });
    }
  }, {
    key: "onMove",
    value: function onMove(e, position) {
      utils.pauseEvent(e);
      var oldValue = this.state.value;
      var value = this.calcValueByPos(position);
      if (value === oldValue) return;
      this.onChange({
        value: value
      });
    }
  }, {
    key: "onKeyboard",
    value: function onKeyboard(e) {
      var valueMutator = utils.getKeyboardValueMutator(e);

      if (valueMutator) {
        utils.pauseEvent(e);
        var state = this.state;
        var oldValue = state.value;
        var mutatedValue = valueMutator(oldValue, this.props);
        var value = this.trimAlignValue(mutatedValue);
        if (value === oldValue) return;
        this.onChange({
          value: value
        });
      }
    }
  }, {
    key: "getValue",
    value: function getValue() {
      return this.state.value;
    }
  }, {
    key: "getLowerBound",
    value: function getLowerBound() {
      return this.props.min;
    }
  }, {
    key: "getUpperBound",
    value: function getUpperBound() {
      return this.state.value;
    }
  }, {
    key: "trimAlignValue",
    value: function trimAlignValue(v) {
      var nextProps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      var mergedProps = (0, _objectSpread2["default"])({}, this.props, {}, nextProps);
      var val = utils.ensureValueInRange(v, mergedProps);
      return utils.ensureValuePrecision(val, mergedProps);
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          vertical = _this$props2.vertical,
          included = _this$props2.included,
          disabled = _this$props2.disabled,
          minimumTrackStyle = _this$props2.minimumTrackStyle,
          trackStyle = _this$props2.trackStyle,
          handleStyle = _this$props2.handleStyle,
          tabIndex = _this$props2.tabIndex,
          min = _this$props2.min,
          max = _this$props2.max,
          handleGenerator = _this$props2.handle;
      var _this$state = this.state,
          value = _this$state.value,
          dragging = _this$state.dragging;
      var offset = this.calcOffset(value);
      var handle = handleGenerator({
        className: "".concat(prefixCls, "-handle"),
        prefixCls: prefixCls,
        vertical: vertical,
        offset: offset,
        value: value,
        dragging: dragging,
        disabled: disabled,
        min: min,
        max: max,
        index: 0,
        tabIndex: tabIndex,
        style: handleStyle[0] || handleStyle,
        ref: function ref(h) {
          return _this2.saveHandle(0, h);
        }
      });

      var _trackStyle = trackStyle[0] || trackStyle;

      var track = _react["default"].createElement(_Track["default"], {
        className: "".concat(prefixCls, "-track"),
        vertical: vertical,
        included: included,
        offset: 0,
        length: offset,
        style: (0, _objectSpread2["default"])({}, minimumTrackStyle, {}, _trackStyle)
      });

      return {
        tracks: track,
        handles: handle
      };
    }
  }]);
  return Slider;
}(_react.Component);

(0, _defineProperty2["default"])(Slider, "propTypes", {
  defaultValue: _propTypes["default"].number,
  value: _propTypes["default"].number,
  disabled: _propTypes["default"].bool,
  autoFocus: _propTypes["default"].bool,
  tabIndex: _propTypes["default"].number
});

var _default = (0, _createSlider["default"])(Slider);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNsaWRlci5qc3giXSwibmFtZXMiOlsiU2xpZGVyIiwicHJvcHMiLCJzZXRTdGF0ZSIsImRyYWdnaW5nIiwicmVtb3ZlRG9jdW1lbnRFdmVudHMiLCJvbkFmdGVyQ2hhbmdlIiwiZ2V0VmFsdWUiLCJkZWZhdWx0VmFsdWUiLCJ1bmRlZmluZWQiLCJtaW4iLCJ2YWx1ZSIsInN0YXRlIiwidHJpbUFsaWduVmFsdWUiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJhdXRvRm9jdXMiLCJkaXNhYmxlZCIsImZvY3VzIiwibmV4dFByb3BzIiwicHJldlZhbHVlIiwibmV4dFZhbHVlIiwidXRpbHMiLCJpc1ZhbHVlT3V0T2ZSYW5nZSIsIm9uQ2hhbmdlIiwiaXNOb3RDb250cm9sbGVkIiwiY2hhbmdlZFZhbHVlIiwicG9zaXRpb24iLCJvbkJlZm9yZUNoYW5nZSIsImNhbGNWYWx1ZUJ5UG9zIiwic3RhcnRWYWx1ZSIsInN0YXJ0UG9zaXRpb24iLCJwcmV2TW92ZWRIYW5kbGVJbmRleCIsImUiLCJwYXVzZUV2ZW50Iiwib2xkVmFsdWUiLCJ2YWx1ZU11dGF0b3IiLCJnZXRLZXlib2FyZFZhbHVlTXV0YXRvciIsIm11dGF0ZWRWYWx1ZSIsInYiLCJtZXJnZWRQcm9wcyIsInZhbCIsImVuc3VyZVZhbHVlSW5SYW5nZSIsImVuc3VyZVZhbHVlUHJlY2lzaW9uIiwicHJlZml4Q2xzIiwidmVydGljYWwiLCJpbmNsdWRlZCIsIm1pbmltdW1UcmFja1N0eWxlIiwidHJhY2tTdHlsZSIsImhhbmRsZVN0eWxlIiwidGFiSW5kZXgiLCJtYXgiLCJoYW5kbGVHZW5lcmF0b3IiLCJoYW5kbGUiLCJvZmZzZXQiLCJjYWxjT2Zmc2V0IiwiY2xhc3NOYW1lIiwiaW5kZXgiLCJzdHlsZSIsInJlZiIsImgiLCJzYXZlSGFuZGxlIiwiX3RyYWNrU3R5bGUiLCJ0cmFjayIsInRyYWNrcyIsImhhbmRsZXMiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJudW1iZXIiLCJib29sIl0sIm1h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TyxFQUFFWjtBQUExQixPQUFQO0FBQ0Q7OztFQW5Ma0JhLGdCOztpQ0FBZmxFLE0sZUFDZTtBQUNqQk8sRUFBQUEsWUFBWSxFQUFFNEQsc0JBQVVDLE1BRFA7QUFFakIxRCxFQUFBQSxLQUFLLEVBQUV5RCxzQkFBVUMsTUFGQTtBQUdqQm5ELEVBQUFBLFFBQVEsRUFBRWtELHNCQUFVRSxJQUhIO0FBSWpCckQsRUFBQUEsU0FBUyxFQUFFbUQsc0JBQVVFLElBSko7QUFLakJuQixFQUFBQSxRQUFRLEVBQUVpQixzQkFBVUM7QUFMSCxDOztlQXFMTiw4QkFBYXBFLE1BQWIsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L3Byb3AtdHlwZXMgKi9cbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHdhcm5pbmcgZnJvbSAnLi4vLi4vX3V0aWwvd2FybmluZyc7XG5pbXBvcnQgVHJhY2sgZnJvbSAnLi9jb21tb24vVHJhY2snO1xuaW1wb3J0IGNyZWF0ZVNsaWRlciBmcm9tICcuL2NvbW1vbi9jcmVhdGVTbGlkZXInO1xuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi91dGlscyc7XG5cbmNsYXNzIFNsaWRlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZGVmYXVsdFZhbHVlOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHZhbHVlOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBhdXRvRm9jdXM6IFByb3BUeXBlcy5ib29sLFxuICAgIHRhYkluZGV4OiBQcm9wVHlwZXMubnVtYmVyLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgY29uc3QgZGVmYXVsdFZhbHVlID0gcHJvcHMuZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQgP1xuICAgICAgICAgICAgcHJvcHMuZGVmYXVsdFZhbHVlIDogcHJvcHMubWluO1xuICAgIGNvbnN0IHZhbHVlID0gcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgICBwcm9wcy52YWx1ZSA6IGRlZmF1bHRWYWx1ZTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB2YWx1ZTogdGhpcy50cmltQWxpZ25WYWx1ZSh2YWx1ZSksXG4gICAgICBkcmFnZ2luZzogZmFsc2UsXG4gICAgfTtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgd2FybmluZyhcbiAgICAgICAgISgnbWluaW11bVRyYWNrU3R5bGUnIGluIHByb3BzKSxcbiAgICAgICAgJ21pbmltdW1UcmFja1N0eWxlIHdpbGwgYmUgZGVwcmVjYXRlLCBwbGVhc2UgdXNlIHRyYWNrU3R5bGUgaW5zdGVhZC4nXG4gICAgICApO1xuICAgICAgd2FybmluZyhcbiAgICAgICAgISgnbWF4aW11bVRyYWNrU3R5bGUnIGluIHByb3BzKSxcbiAgICAgICAgJ21heGltdW1UcmFja1N0eWxlIHdpbGwgYmUgZGVwcmVjYXRlLCBwbGVhc2UgdXNlIHJhaWxTdHlsZSBpbnN0ZWFkLidcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgY29uc3QgeyBhdXRvRm9jdXMsIGRpc2FibGVkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChhdXRvRm9jdXMgJiYgIWRpc2FibGVkKSB7XG4gICAgICB0aGlzLmZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAoISgndmFsdWUnIGluIG5leHRQcm9wcyB8fCAnbWluJyBpbiBuZXh0UHJvcHMgfHwgJ21heCcgaW4gbmV4dFByb3BzKSkgcmV0dXJuO1xuXG4gICAgY29uc3QgcHJldlZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICBjb25zdCB2YWx1ZSA9IG5leHRQcm9wcy52YWx1ZSAhPT0gdW5kZWZpbmVkID9cbiAgICAgICAgICAgIG5leHRQcm9wcy52YWx1ZSA6IHByZXZWYWx1ZTtcbiAgICBjb25zdCBuZXh0VmFsdWUgPSB0aGlzLnRyaW1BbGlnblZhbHVlKHZhbHVlLCBuZXh0UHJvcHMpO1xuICAgIGlmIChuZXh0VmFsdWUgPT09IHByZXZWYWx1ZSkgcmV0dXJuO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiBuZXh0VmFsdWUgfSk7XG4gICAgaWYgKHV0aWxzLmlzVmFsdWVPdXRPZlJhbmdlKHZhbHVlLCBuZXh0UHJvcHMpKSB7XG4gICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG5leHRWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgb25DaGFuZ2Uoc3RhdGUpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgaXNOb3RDb250cm9sbGVkID0gISgndmFsdWUnIGluIHByb3BzKTtcbiAgICBpZiAoaXNOb3RDb250cm9sbGVkKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHN0YXRlKTtcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2VkVmFsdWUgPSBzdGF0ZS52YWx1ZTtcbiAgICBwcm9wcy5vbkNoYW5nZShjaGFuZ2VkVmFsdWUpO1xuICB9XG5cbiAgb25TdGFydChwb3NpdGlvbikge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBkcmFnZ2luZzogdHJ1ZSB9KTtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcHJldlZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuICAgIHByb3BzLm9uQmVmb3JlQ2hhbmdlKHByZXZWYWx1ZSk7XG5cbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuY2FsY1ZhbHVlQnlQb3MocG9zaXRpb24pO1xuICAgIHRoaXMuc3RhcnRWYWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMuc3RhcnRQb3NpdGlvbiA9IHBvc2l0aW9uO1xuXG4gICAgaWYgKHZhbHVlID09PSBwcmV2VmFsdWUpIHJldHVybjtcblxuICAgIHRoaXMucHJldk1vdmVkSGFuZGxlSW5kZXggPSAwO1xuXG4gICAgdGhpcy5vbkNoYW5nZSh7IHZhbHVlIH0pO1xuICB9XG5cbiAgb25FbmQgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGRyYWdnaW5nOiBmYWxzZSB9KTtcbiAgICB0aGlzLnJlbW92ZURvY3VtZW50RXZlbnRzKCk7XG4gICAgdGhpcy5wcm9wcy5vbkFmdGVyQ2hhbmdlKHRoaXMuZ2V0VmFsdWUoKSk7XG4gIH1cblxuICBvbk1vdmUoZSwgcG9zaXRpb24pIHtcbiAgICB1dGlscy5wYXVzZUV2ZW50KGUpO1xuICAgIGNvbnN0IHsgdmFsdWU6IG9sZFZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jYWxjVmFsdWVCeVBvcyhwb3NpdGlvbik7XG4gICAgaWYgKHZhbHVlID09PSBvbGRWYWx1ZSkgcmV0dXJuO1xuXG4gICAgdGhpcy5vbkNoYW5nZSh7IHZhbHVlIH0pO1xuICB9XG5cbiAgb25LZXlib2FyZChlKSB7XG4gICAgY29uc3QgdmFsdWVNdXRhdG9yID0gdXRpbHMuZ2V0S2V5Ym9hcmRWYWx1ZU11dGF0b3IoZSk7XG5cbiAgICBpZiAodmFsdWVNdXRhdG9yKSB7XG4gICAgICB1dGlscy5wYXVzZUV2ZW50KGUpO1xuICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnN0YXRlO1xuICAgICAgY29uc3Qgb2xkVmFsdWUgPSBzdGF0ZS52YWx1ZTtcbiAgICAgIGNvbnN0IG11dGF0ZWRWYWx1ZSA9IHZhbHVlTXV0YXRvcihvbGRWYWx1ZSwgdGhpcy5wcm9wcyk7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMudHJpbUFsaWduVmFsdWUobXV0YXRlZFZhbHVlKTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gb2xkVmFsdWUpIHJldHVybjtcblxuICAgICAgdGhpcy5vbkNoYW5nZSh7IHZhbHVlIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLnZhbHVlO1xuICB9XG5cbiAgZ2V0TG93ZXJCb3VuZCgpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5taW47XG4gIH1cblxuICBnZXRVcHBlckJvdW5kKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLnZhbHVlO1xuICB9XG5cbiAgdHJpbUFsaWduVmFsdWUodiwgbmV4dFByb3BzID0ge30pIHtcbiAgICBjb25zdCBtZXJnZWRQcm9wcyA9IHsgLi4udGhpcy5wcm9wcywgLi4ubmV4dFByb3BzIH07XG4gICAgY29uc3QgdmFsID0gdXRpbHMuZW5zdXJlVmFsdWVJblJhbmdlKHYsIG1lcmdlZFByb3BzKTtcbiAgICByZXR1cm4gdXRpbHMuZW5zdXJlVmFsdWVQcmVjaXNpb24odmFsLCBtZXJnZWRQcm9wcyk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgdmVydGljYWwsXG4gICAgICBpbmNsdWRlZCxcbiAgICAgIGRpc2FibGVkLFxuICAgICAgbWluaW11bVRyYWNrU3R5bGUsXG4gICAgICB0cmFja1N0eWxlLFxuICAgICAgaGFuZGxlU3R5bGUsXG4gICAgICB0YWJJbmRleCxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICAgIGhhbmRsZTogaGFuZGxlR2VuZXJhdG9yLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgdmFsdWUsIGRyYWdnaW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuY2FsY09mZnNldCh2YWx1ZSk7XG4gICAgY29uc3QgaGFuZGxlID0gaGFuZGxlR2VuZXJhdG9yKHtcbiAgICAgIGNsYXNzTmFtZTogYCR7cHJlZml4Q2xzfS1oYW5kbGVgLFxuICAgICAgcHJlZml4Q2xzLFxuICAgICAgdmVydGljYWwsXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICAgIGRyYWdnaW5nLFxuICAgICAgZGlzYWJsZWQsXG4gICAgICBtaW4sXG4gICAgICBtYXgsXG4gICAgICBpbmRleDogMCxcbiAgICAgIHRhYkluZGV4LFxuICAgICAgc3R5bGU6IGhhbmRsZVN0eWxlWzBdIHx8IGhhbmRsZVN0eWxlLFxuICAgICAgcmVmOiBoID0+IHRoaXMuc2F2ZUhhbmRsZSgwLCBoKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IF90cmFja1N0eWxlID0gdHJhY2tTdHlsZVswXSB8fCB0cmFja1N0eWxlO1xuICAgIGNvbnN0IHRyYWNrID0gKFxuICAgICAgPFRyYWNrXG4gICAgICAgIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10cmFja2B9XG4gICAgICAgIHZlcnRpY2FsPXt2ZXJ0aWNhbH1cbiAgICAgICAgaW5jbHVkZWQ9e2luY2x1ZGVkfVxuICAgICAgICBvZmZzZXQ9ezB9XG4gICAgICAgIGxlbmd0aD17b2Zmc2V0fVxuICAgICAgICBzdHlsZT17e1xuICAgICAgICAgIC4uLm1pbmltdW1UcmFja1N0eWxlLFxuICAgICAgICAgIC4uLl90cmFja1N0eWxlLFxuICAgICAgICB9fVxuICAgICAgLz5cbiAgICApO1xuXG4gICAgcmV0dXJuIHsgdHJhY2tzOiB0cmFjaywgaGFuZGxlczogaGFuZGxlIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU2xpZGVyKFNsaWRlcik7XG4iXX0=