33a9091114a2b983982bfc680b062f62
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var _enzyme = require("enzyme");

var _ = _interopRequireDefault(require(".."));

var _IntlList = _interopRequireDefault(require("../IntlList"));

var _intlField = _interopRequireDefault(require("./intlField"));

var _focusTest = _interopRequireDefault(require("../../../tests/shared/focusTest"));

var _mountTest = _interopRequireDefault(require("../../../tests/shared/mountTest"));

var _ModalContainer = require("../../modal-container/ModalContainer");

var _dataSet = _interopRequireDefault(require("../../data-set"));

(0, _mountTest["default"])(_IntlList["default"]);
(0, _mountTest["default"])(_["default"]);
(0, _focusTest["default"])(_["default"]);
describe('IntlField-pro', function () {
  var errorSpy = jest.spyOn(console, 'error').mockImplementation(function () {});
  beforeEach(function () {
    jest.useFakeTimers();
  });
  afterEach(function () {
    errorSpy.mockReset();
    document.body.innerHTML = '';
    jest.useRealTimers();
  });
  afterAll(function () {
    errorSpy.mockRestore();
  });

  var _pro = function _pro(className) {
    return document.body.querySelectorAll(className);
  };

  it('renders IntlField correctly', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    expect(wrapper).toMatchSnapshot();
  });
  it('should focused when the input click or mousedown', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    expect(wrapper.find('.c7n-pro-input-focused')).toHaveLength(0);
    wrapper.find('input').simulate('focus');
    jest.runAllTimers();
    wrapper.update();
    expect(wrapper.find('.c7n-pro-input-focused')).toHaveLength(1);
  });
  it('input should render readOnly correctly', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    expect(wrapper.prop('readOnly')).toBe(false);
    wrapper.setProps({
      readOnly: true
    });
    wrapper.update();
    expect(wrapper.prop('readOnly')).toBe(true);
    wrapper.find('.c7n-pro-input-suffix').simulate('click');
    jest.runAllTimers();
    expect(_pro('.c7n-pro-modal-container')).toHaveLength(0);
  });
  it('trigger onOk once when click on ok button', function () {
    var onCancel = jest.fn();
    var onOk = jest.fn();
    (0, _ModalContainer.open)({
      onCancel: onCancel,
      onOk: onOk
    });

    _pro('.c7n-pro-modal-footer')[0].querySelector('.c7n-pro-btn-primary').click();

    expect(onCancel.mock.calls.length).toBe(0);
    expect(onOk.mock.calls.length).toBe(1);
  });
  it('renders dataset correctly', function () {
    var handleDataSetChange = jest.fn();
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_intlField["default"], null));
    expect(wrapper.find('IntlField').props().name).toEqual('first-name');
    expect(wrapper.find('input').props().value).toEqual('Âê¥');
    expect(wrapper).toMatchSnapshot();
    var ds = new _dataSet["default"]({
      lang: 'en_GB',
      primaryKey: 'pk',
      data: [{}],
      tlsUrl: '/dataset/user/languages',
      fields: [{
        name: 'first',
        type: 'intl',
        required: true
      }],
      events: {
        update: handleDataSetChange
      }
    });
    var wrapper1 = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      dataSet: ds,
      name: "first"
    }));
    expect(wrapper1.find('IntlField').props().name).toEqual('first');
    expect(wrapper1).toMatchSnapshot();
  });
  it('{ ok, cancel } button click render correctly', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    expect(_pro('.c7n-pro-modal-container')).toHaveLength(0);
    wrapper.find('.c7n-pro-input-suffix').simulate('click');
    jest.runAllTimers();
    expect(_pro('.c7n-pro-modal-container')).toHaveLength(1);
    expect(_pro('.c7n-pro-btn')).toHaveLength(2);

    _pro('.c7n-pro-btn-primary')[0].click();

    jest.runAllTimers();
    wrapper.update();

    _pro('.c7n-pro-btn-default')[0].click();

    jest.runAllTimers();
    wrapper.update();
    expect(wrapper).toMatchSnapshot();
  });
  it('the input keydown event , keyCode {down}', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    expect(_pro('.c7n-pro-modal-container')).toHaveLength(0);
    wrapper.find('input').simulate('keydown', {
      keyCode: 40
    });
    jest.runAllTimers();
    wrapper.update();
    expect(_pro('.c7n-pro-modal-container')).toHaveLength(1);
  });
  it('modal should unmout', function () {
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    wrapper.unmount();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRlc3QuanMiXSwibmFtZXMiOlsiSW50bExpc3QiLCJJbnRsRmllbGQiLCJkZXNjcmliZSIsImVycm9yU3B5IiwiamVzdCIsInNweU9uIiwiY29uc29sZSIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsImJlZm9yZUVhY2giLCJ1c2VGYWtlVGltZXJzIiwiYWZ0ZXJFYWNoIiwibW9ja1Jlc2V0IiwiZG9jdW1lbnQiLCJib2R5IiwiaW5uZXJIVE1MIiwidXNlUmVhbFRpbWVycyIsImFmdGVyQWxsIiwibW9ja1Jlc3RvcmUiLCJfcHJvIiwiY2xhc3NOYW1lIiwicXVlcnlTZWxlY3RvckFsbCIsIml0Iiwid3JhcHBlciIsImV4cGVjdCIsInRvTWF0Y2hTbmFwc2hvdCIsImZpbmQiLCJ0b0hhdmVMZW5ndGgiLCJzaW11bGF0ZSIsInJ1bkFsbFRpbWVycyIsInVwZGF0ZSIsInByb3AiLCJ0b0JlIiwic2V0UHJvcHMiLCJyZWFkT25seSIsIm9uQ2FuY2VsIiwiZm4iLCJvbk9rIiwicXVlcnlTZWxlY3RvciIsImNsaWNrIiwibW9jayIsImNhbGxzIiwibGVuZ3RoIiwiaGFuZGxlRGF0YVNldENoYW5nZSIsInByb3BzIiwibmFtZSIsInRvRXF1YWwiLCJ2YWx1ZSIsImRzIiwiRGF0YVNldCIsImxhbmciLCJwcmltYXJ5S2V5IiwiZGF0YSIsInRsc1VybCIsImZpZWxkcyIsInR5cGUiLCJyZXF1aXJlZCIsImV2ZW50cyIsIndyYXBwZXIxIiwia2V5Q29kZSIsInVubW91bnQiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSwyQkFBVUEsb0JBQVY7QUFDQSwyQkFBVUMsWUFBVjtBQUNBLDJCQUFVQSxZQUFWO0FBRUFDLFFBQVEsQ0FBQyxlQUFELEVBQWtCLFlBQU07QUFDOUIsTUFBTUMsUUFBUSxHQUFHQyxJQUFJLENBQUNDLEtBQUwsQ0FBV0MsT0FBWCxFQUFvQixPQUFwQixF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QUE2QixDQUE3QixFQUFnQ29CLEtBQWhDOztBQUNBbEMsSUFBQUEsSUFBSSxDQUFDd0IsWUFBTDtBQUNBTixJQUFBQSxPQUFPLENBQUNPLE1BQVI7QUFDQU4sSUFBQUEsTUFBTSxDQUFDRCxPQUFELENBQU4sQ0FBZ0JFLGVBQWhCO0FBQ0QsR0FkQyxDQUFGO0FBZ0JBSCxFQUFBQSxFQUFFLENBQUMsMENBQUQsRUFBNkMsWUFBTTtBQUNuRCxRQUFNQyxPQUFPLEdBQUcsbUJBQU0sZ0NBQUMsWUFBRCxPQUFOLENBQWhCO0FBQ0FDLElBQUFBLE1BQU0sQ0FBQ0wsSUFBSSxDQUFDLDBCQUFELENBQUwsQ0FBTixDQUF5Q1EsWUFBekMsQ0FBc0QsQ0FBdEQ7QUFDQUosSUFBQUEsT0FBTyxDQUFDRyxJQUFSLENBQWEsT0FBYixFQUFzQkUsUUFBdEIsQ0FBK0IsU0FBL0IsRUFBMEM7QUFBRStCLE1BQUFBLE9BQU8sRUFBRTtBQUFYLEtBQTFDO0FBQ0F0RCxJQUFBQSxJQUFJLENBQUN3QixZQUFMO0FBQ0FOLElBQUFBLE9BQU8sQ0FBQ08sTUFBUjtBQUNBTixJQUFBQSxNQUFNLENBQUNMLElBQUksQ0FBQywwQkFBRCxDQUFMLENBQU4sQ0FBeUNRLFlBQXpDLENBQXNELENBQXREO0FBQ0QsR0FQQyxDQUFGO0FBU0FMLEVBQUFBLEVBQUUsQ0FBQyxxQkFBRCxFQUF3QixZQUFNO0FBQzlCLFFBQU1DLE9BQU8sR0FBRyxtQkFBTSxnQ0FBQyxZQUFELE9BQU4sQ0FBaEI7QUFDQUEsSUFBQUEsT0FBTyxDQUFDcUMsT0FBUjtBQUNELEdBSEMsQ0FBRjtBQUlELENBcEhPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgbW91bnQgfSBmcm9tICdlbnp5bWUnO1xuaW1wb3J0IEludGxGaWVsZCBmcm9tICcuLic7XG5pbXBvcnQgSW50bExpc3QgZnJvbSAnLi4vSW50bExpc3QnO1xuaW1wb3J0IEludGxGaWVsZFRlc3QgZnJvbSAnLi9pbnRsRmllbGQnO1xuaW1wb3J0IGZvY3VzVGVzdCBmcm9tICcuLi8uLi8uLi90ZXN0cy9zaGFyZWQvZm9jdXNUZXN0JztcbmltcG9ydCBtb3VudFRlc3QgZnJvbSAnLi4vLi4vLi4vdGVzdHMvc2hhcmVkL21vdW50VGVzdCc7XG5pbXBvcnQgeyBvcGVuIH0gZnJvbSAnLi4vLi4vbW9kYWwtY29udGFpbmVyL01vZGFsQ29udGFpbmVyJztcbmltcG9ydCBEYXRhU2V0IGZyb20gJy4uLy4uL2RhdGEtc2V0JztcblxubW91bnRUZXN0KEludGxMaXN0KTtcbm1vdW50VGVzdChJbnRsRmllbGQpO1xuZm9jdXNUZXN0KEludGxGaWVsZCk7XG5cbmRlc2NyaWJlKCdJbnRsRmllbGQtcHJvJywgKCkgPT4ge1xuICBjb25zdCBlcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBlcnJvclNweS5tb2NrUmVzZXQoKTtcbiAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICcnO1xuICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xuICB9KTtcblxuICBhZnRlckFsbCgoKSA9PiB7XG4gICAgZXJyb3JTcHkubW9ja1Jlc3RvcmUoKTtcbiAgfSk7XG5cbiAgY29uc3QgX3BybyA9IGNsYXNzTmFtZSA9PiB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvckFsbChjbGFzc05hbWUpO1xuICB9O1xuXG4gIGl0KCdyZW5kZXJzIEludGxGaWVsZCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KDxJbnRsRmllbGQgLz4pO1xuICAgIGV4cGVjdCh3cmFwcGVyKS50b01hdGNoU25hcHNob3QoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBmb2N1c2VkIHdoZW4gdGhlIGlucHV0IGNsaWNrIG9yIG1vdXNlZG93bicsICgpID0+IHtcbiAgICBjb25zdCB3cmFwcGVyID0gbW91bnQoPEludGxGaWVsZCAvPik7XG4gICAgZXhwZWN0KHdyYXBwZXIuZmluZCgnLmM3bi1wcm8taW5wdXQtZm9jdXNlZCcpKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgd3JhcHBlci5maW5kKCdpbnB1dCcpLnNpbXVsYXRlKCdmb2N1cycpO1xuICAgIGplc3QucnVuQWxsVGltZXJzKCk7XG4gICAgd3JhcHBlci51cGRhdGUoKTtcbiAgICBleHBlY3Qod3JhcHBlci5maW5kKCcuYzduLXByby1pbnB1dC1mb2N1c2VkJykpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgfSk7XG5cbiAgaXQoJ2lucHV0IHNob3VsZCByZW5kZXIgcmVhZE9ubHkgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBtb3VudCg8SW50bEZpZWxkIC8+KTtcbiAgICBleHBlY3Qod3JhcHBlci5wcm9wKCdyZWFkT25seScpKS50b0JlKGZhbHNlKTtcbiAgICB3cmFwcGVyLnNldFByb3BzKHsgcmVhZE9ubHk6IHRydWUgfSk7XG4gICAgd3JhcHBlci51cGRhdGUoKTtcbiAgICBleHBlY3Qod3JhcHBlci5wcm9wKCdyZWFkT25seScpKS50b0JlKHRydWUpO1xuICAgIHdyYXBwZXIuZmluZCgnLmM3bi1wcm8taW5wdXQtc3VmZml4Jykuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgamVzdC5ydW5BbGxUaW1lcnMoKTtcbiAgICBleHBlY3QoX3BybygnLmM3bi1wcm8tbW9kYWwtY29udGFpbmVyJykpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3RyaWdnZXIgb25PayBvbmNlIHdoZW4gY2xpY2sgb24gb2sgYnV0dG9uJywgKCkgPT4ge1xuICAgIGNvbnN0IG9uQ2FuY2VsID0gamVzdC5mbigpO1xuICAgIGNvbnN0IG9uT2sgPSBqZXN0LmZuKCk7XG4gICAgb3Blbih7XG4gICAgICBvbkNhbmNlbCxcbiAgICAgIG9uT2ssXG4gICAgfSk7XG4gICAgX3BybygnLmM3bi1wcm8tbW9kYWwtZm9vdGVyJylbMF1cbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuYzduLXByby1idG4tcHJpbWFyeScpXG4gICAgICAuY2xpY2soKTtcbiAgICBleHBlY3Qob25DYW5jZWwubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgZXhwZWN0KG9uT2subW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIGl0KCdyZW5kZXJzIGRhdGFzZXQgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgIGNvbnN0IGhhbmRsZURhdGFTZXRDaGFuZ2UgPSBqZXN0LmZuKCk7XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KDxJbnRsRmllbGRUZXN0IC8+KTtcbiAgICBleHBlY3Qod3JhcHBlci5maW5kKCdJbnRsRmllbGQnKS5wcm9wcygpLm5hbWUpLnRvRXF1YWwoJ2ZpcnN0LW5hbWUnKTtcbiAgICBleHBlY3Qod3JhcHBlci5maW5kKCdpbnB1dCcpLnByb3BzKCkudmFsdWUpLnRvRXF1YWwoJ+WQtCcpO1xuICAgIGV4cGVjdCh3cmFwcGVyKS50b01hdGNoU25hcHNob3QoKTtcbiAgICBjb25zdCBkcyA9IG5ldyBEYXRhU2V0KHtcbiAgICAgIGxhbmc6ICdlbl9HQicsXG4gICAgICBwcmltYXJ5S2V5OiAncGsnLFxuICAgICAgZGF0YTogW3t9XSxcbiAgICAgIHRsc1VybDogJy9kYXRhc2V0L3VzZXIvbGFuZ3VhZ2VzJyxcbiAgICAgIGZpZWxkczogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ2ZpcnN0JyxcbiAgICAgICAgICB0eXBlOiAnaW50bCcsXG4gICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZXZlbnRzOiB7XG4gICAgICAgIHVwZGF0ZTogaGFuZGxlRGF0YVNldENoYW5nZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgY29uc3Qgd3JhcHBlcjEgPSBtb3VudCg8SW50bEZpZWxkIGRhdGFTZXQ9e2RzfSBuYW1lPVwiZmlyc3RcIiAvPik7XG4gICAgZXhwZWN0KHdyYXBwZXIxLmZpbmQoJ0ludGxGaWVsZCcpLnByb3BzKCkubmFtZSkudG9FcXVhbCgnZmlyc3QnKTtcbiAgICBleHBlY3Qod3JhcHBlcjEpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBpdCgneyBvaywgY2FuY2VsIH0gYnV0dG9uIGNsaWNrIHJlbmRlciBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KDxJbnRsRmllbGQgLz4pO1xuICAgIGV4cGVjdChfcHJvKCcuYzduLXByby1tb2RhbC1jb250YWluZXInKSkudG9IYXZlTGVuZ3RoKDApO1xuICAgIHdyYXBwZXIuZmluZCgnLmM3bi1wcm8taW5wdXQtc3VmZml4Jykuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgamVzdC5ydW5BbGxUaW1lcnMoKTtcbiAgICBleHBlY3QoX3BybygnLmM3bi1wcm8tbW9kYWwtY29udGFpbmVyJykpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICBleHBlY3QoX3BybygnLmM3bi1wcm8tYnRuJykpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICBfcHJvKCcuYzduLXByby1idG4tcHJpbWFyeScpWzBdLmNsaWNrKCk7XG4gICAgamVzdC5ydW5BbGxUaW1lcnMoKTtcbiAgICB3cmFwcGVyLnVwZGF0ZSgpO1xuICAgIF9wcm8oJy5jN24tcHJvLWJ0bi1kZWZhdWx0JylbMF0uY2xpY2soKTtcbiAgICBqZXN0LnJ1bkFsbFRpbWVycygpO1xuICAgIHdyYXBwZXIudXBkYXRlKCk7XG4gICAgZXhwZWN0KHdyYXBwZXIpLnRvTWF0Y2hTbmFwc2hvdCgpO1xuICB9KTtcblxuICBpdCgndGhlIGlucHV0IGtleWRvd24gZXZlbnQgLCBrZXlDb2RlIHtkb3dufScsICgpID0+IHtcbiAgICBjb25zdCB3cmFwcGVyID0gbW91bnQoPEludGxGaWVsZCAvPik7XG4gICAgZXhwZWN0KF9wcm8oJy5jN24tcHJvLW1vZGFsLWNvbnRhaW5lcicpKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgd3JhcHBlci5maW5kKCdpbnB1dCcpLnNpbXVsYXRlKCdrZXlkb3duJywgeyBrZXlDb2RlOiA0MCB9KTtcbiAgICBqZXN0LnJ1bkFsbFRpbWVycygpO1xuICAgIHdyYXBwZXIudXBkYXRlKCk7XG4gICAgZXhwZWN0KF9wcm8oJy5jN24tcHJvLW1vZGFsLWNvbnRhaW5lcicpKS50b0hhdmVMZW5ndGgoMSk7XG4gIH0pO1xuXG4gIGl0KCdtb2RhbCBzaG91bGQgdW5tb3V0JywgKCkgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSBtb3VudCg8SW50bEZpZWxkIC8+KTtcbiAgICB3cmFwcGVyLnVubW91bnQoKTtcbiAgfSk7XG59KTtcbiJdfQ==