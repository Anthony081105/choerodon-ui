d6e42d9e82cd5ffd9a39ea006dda84ec
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var React = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _Title = _interopRequireDefault(require("./Title"));

var _Paragraph = _interopRequireDefault(require("./Paragraph"));

var _configure = require("../configure");

var _Element = _interopRequireDefault(require("./Element"));

function getComponentProps(prop) {
  if (prop && (0, _typeof2["default"])(prop) === 'object') {
    return prop;
  }

  return {};
}

function getAvatarBasicProps(hasTitle, hasParagraph) {
  if (hasTitle && !hasParagraph) {
    // Square avatar
    return {
      size: 'large',
      shape: 'square'
    };
  }

  return {
    size: 'large',
    shape: 'circle'
  };
}

function getTitleBasicProps(hasAvatar, hasParagraph) {
  if (!hasAvatar && hasParagraph) {
    return {
      width: '38%'
    };
  }

  if (hasAvatar && hasParagraph) {
    return {
      width: '50%'
    };
  }

  return {};
}

function getParagraphBasicProps(hasAvatar, hasTitle) {
  var basicProps = {}; // Width

  if (!hasAvatar || !hasTitle) {
    basicProps.width = '61%';
  } // Rows


  if (!hasAvatar && hasTitle) {
    basicProps.rows = 3;
  } else {
    basicProps.rows = 2;
  }

  return basicProps;
}

var Skeleton =
/*#__PURE__*/
function (_React$Component) {
  (0, _inherits2["default"])(Skeleton, _React$Component);

  function Skeleton() {
    var _this;

    (0, _classCallCheck2["default"])(this, Skeleton);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Skeleton).apply(this, arguments));

    _this.renderSkeleton = function () {
      var _this$props = _this.props,
          customizePrefixCls = _this$props.prefixCls,
          loading = _this$props.loading,
          className = _this$props.className,
          children = _this$props.children,
          avatar = _this$props.avatar,
          title = _this$props.title,
          paragraph = _this$props.paragraph,
          active = _this$props.active;
      var prefixCls = (0, _configure.getPrefixCls)('skeleton', customizePrefixCls);

      if (loading || !('loading' in _this.props)) {
        var _classNames;

        var hasAvatar = !!avatar;
        var hasTitle = !!title;
        var hasParagraph = !!paragraph; // Avatar

        var avatarNode;

        if (hasAvatar) {
          var avatarProps = (0, _objectSpread2["default"])({
            prefixCls: "".concat(prefixCls, "-avatar")
          }, getAvatarBasicProps(hasTitle, hasParagraph), {}, getComponentProps(avatar)); // We direct use SkeletonElement as avatar in skeleton internal.

          avatarNode = React.createElement("div", {
            className: "".concat(prefixCls, "-header")
          }, React.createElement(_Element["default"], (0, _extends2["default"])({}, avatarProps)));
        }

        var contentNode;

        if (hasTitle || hasParagraph) {
          // Title
          var $title;

          if (hasTitle) {
            var titleProps = (0, _objectSpread2["default"])({
              prefixCls: "".concat(prefixCls, "-title")
            }, getTitleBasicProps(hasAvatar, hasParagraph), {}, getComponentProps(title));
            $title = React.createElement(_Title["default"], (0, _extends2["default"])({}, titleProps));
          } // Paragraph


          var paragraphNode;

          if (hasParagraph) {
            var paragraphProps = (0, _objectSpread2["default"])({
              prefixCls: "".concat(prefixCls, "-paragraph")
            }, getParagraphBasicProps(hasAvatar, hasTitle), {}, getComponentProps(paragraph));
            paragraphNode = React.createElement(_Paragraph["default"], (0, _extends2["default"])({}, paragraphProps));
          }

          contentNode = React.createElement("div", {
            className: "".concat(prefixCls, "-content")
          }, $title, paragraphNode);
        }

        var cls = (0, _classnames["default"])(prefixCls, className, (_classNames = {}, (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-with-avatar"), hasAvatar), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-active"), active), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-rtl"), false), _classNames));
        return React.createElement("div", {
          className: cls
        }, avatarNode, contentNode);
      }

      return children;
    };

    return _this;
  }

  (0, _createClass2["default"])(Skeleton, [{
    key: "render",
    value: function render() {
      return React.createElement(React.Fragment, null, this.renderSkeleton());
    }
  }]);
  return Skeleton;
}(React.Component);

Skeleton.defaultProps = {
  avatar: false,
  title: true,
  paragraph: true
};
var _default = Skeleton;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNrZWxldG9uL1NrZWxldG9uLmpzIl0sIm5hbWVzIjpbInByb3AiLCJoYXNUaXRsZSIsInNpemUiLCJzaGFwZSIsIndpZHRoIiwiaGFzQXZhdGFyIiwiYmFzaWNQcm9wcyIsIlNrZWxldG9uIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjdXN0b21pemVQcmVmaXhDbHMiLCJsb2FkaW5nIiwiY2xhc3NOYW1lIiwiY2hpbGRyZW4iLCJhdmF0YXIiLCJ0aXRsZSIsInBhcmFncmFwaCIsImFjdGl2ZSIsInByZWZpeENscyIsImhhc1BhcmFncmFwaCIsImF2YXRhclByb3BzIiwiZ2V0QXZhdGFyQmFzaWNQcm9wcyIsImdldENvbXBvbmVudFByb3BzIiwiYXZhdGFyTm9kZSIsIkVsZW1lbnQiLCJ0aXRsZVByb3BzIiwiZ2V0VGl0bGVCYXNpY1Byb3BzIiwiJHRpdGxlIiwiVGl0bGUiLCJwYXJhZ3JhcGhQcm9wcyIsImdldFBhcmFncmFwaEJhc2ljUHJvcHMiLCJwYXJhZ3JhcGhOb2RlIiwiUGFyYWdyYXBoIiwiY29udGVudE5vZGUiLCJjbHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxLQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQTs7QUFDQSxJQUFBLFFBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQTs7QUFDQSxTQUFBLGlCQUFBLENBQUEsSUFBQSxFQUFpQztBQUM3QixN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QUEsRUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQUEsU0FBQSxDQUFBLEVBQUEsTUFBQSxDQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxNQUFBLENBQUEsRUFBQSxLQUFBLENBQUEsRUFBWixXQUFZLEVBQVo7QUFLQSxlQUFRLEtBQUssQ0FBTCxhQUFBLENBQUEsS0FBQSxFQUEyQjtBQUFFdEIsVUFBQUEsU0FBUyxFQUFFc0I7QUFBYixTQUEzQixFQUFBLFVBQUEsRUFBUixXQUFRLENBQVI7QUFHSDs7QUFDRCxhQUFBLFFBQUE7QUF0REosS0FBQTs7QUFGVSxXQUFBLEtBQUE7QUEwRGI7Ozs7NkJBQ1E7QUFDTCxhQUFPMUIsS0FBSyxDQUFMQSxhQUFBQSxDQUFvQkEsS0FBSyxDQUF6QkEsUUFBQUEsRUFBQUEsSUFBQUEsRUFBMEMsS0FBakQsY0FBaUQsRUFBMUNBLENBQVA7QUFDSDs7O0VBOURrQkEsS0FBSyxDQUFDQyxTOztBQWdFN0JGLFFBQVEsQ0FBUkEsWUFBQUEsR0FBd0I7QUFDcEJPLEVBQUFBLE1BQU0sRUFEYyxLQUFBO0FBRXBCQyxFQUFBQSxLQUFLLEVBRmUsSUFBQTtBQUdwQkMsRUFBQUEsU0FBUyxFQUFFO0FBSFMsQ0FBeEJUO2VBS2VBLFEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBUaXRsZSBmcm9tICcuL1RpdGxlJztcbmltcG9ydCBQYXJhZ3JhcGggZnJvbSAnLi9QYXJhZ3JhcGgnO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcbmltcG9ydCBFbGVtZW50IGZyb20gJy4vRWxlbWVudCc7XG5mdW5jdGlvbiBnZXRDb21wb25lbnRQcm9wcyhwcm9wKSB7XG4gICAgaWYgKHByb3AgJiYgdHlwZW9mIHByb3AgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBwcm9wO1xuICAgIH1cbiAgICByZXR1cm4ge307XG59XG5mdW5jdGlvbiBnZXRBdmF0YXJCYXNpY1Byb3BzKGhhc1RpdGxlLCBoYXNQYXJhZ3JhcGgpIHtcbiAgICBpZiAoaGFzVGl0bGUgJiYgIWhhc1BhcmFncmFwaCkge1xuICAgICAgICAvLyBTcXVhcmUgYXZhdGFyXG4gICAgICAgIHJldHVybiB7IHNpemU6ICdsYXJnZScsIHNoYXBlOiAnc3F1YXJlJyB9O1xuICAgIH1cbiAgICByZXR1cm4geyBzaXplOiAnbGFyZ2UnLCBzaGFwZTogJ2NpcmNsZScgfTtcbn1cbmZ1bmN0aW9uIGdldFRpdGxlQmFzaWNQcm9wcyhoYXNBdmF0YXIsIGhhc1BhcmFncmFwaCkge1xuICAgIGlmICghaGFzQXZhdGFyICYmIGhhc1BhcmFncmFwaCkge1xuICAgICAgICByZXR1cm4geyB3aWR0aDogJzM4JScgfTtcbiAgICB9XG4gICAgaWYgKGhhc0F2YXRhciAmJiBoYXNQYXJhZ3JhcGgpIHtcbiAgICAgICAgcmV0dXJuIHsgd2lkdGg6ICc1MCUnIH07XG4gICAgfVxuICAgIHJldHVybiB7fTtcbn1cbmZ1bmN0aW9uIGdldFBhcmFncmFwaEJhc2ljUHJvcHMoaGFzQXZhdGFyLCBoYXNUaXRsZSkge1xuICAgIGNvbnN0IGJhc2ljUHJvcHMgPSB7fTtcbiAgICAvLyBXaWR0aFxuICAgIGlmICghaGFzQXZhdGFyIHx8ICFoYXNUaXRsZSkge1xuICAgICAgICBiYXNpY1Byb3BzLndpZHRoID0gJzYxJSc7XG4gICAgfVxuICAgIC8vIFJvd3NcbiAgICBpZiAoIWhhc0F2YXRhciAmJiBoYXNUaXRsZSkge1xuICAgICAgICBiYXNpY1Byb3BzLnJvd3MgPSAzO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYmFzaWNQcm9wcy5yb3dzID0gMjtcbiAgICB9XG4gICAgcmV0dXJuIGJhc2ljUHJvcHM7XG59XG5jbGFzcyBTa2VsZXRvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMucmVuZGVyU2tlbGV0b24gPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHByZWZpeENsczogY3VzdG9taXplUHJlZml4Q2xzLCBsb2FkaW5nLCBjbGFzc05hbWUsIGNoaWxkcmVuLCBhdmF0YXIsIHRpdGxlLCBwYXJhZ3JhcGgsIGFjdGl2ZSwgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgICAgICBjb25zdCBwcmVmaXhDbHMgPSBnZXRQcmVmaXhDbHMoJ3NrZWxldG9uJywgY3VzdG9taXplUHJlZml4Q2xzKTtcbiAgICAgICAgICAgIGlmIChsb2FkaW5nIHx8ICEoJ2xvYWRpbmcnIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzQXZhdGFyID0gISFhdmF0YXI7XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzVGl0bGUgPSAhIXRpdGxlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhc1BhcmFncmFwaCA9ICEhcGFyYWdyYXBoO1xuICAgICAgICAgICAgICAgIC8vIEF2YXRhclxuICAgICAgICAgICAgICAgIGxldCBhdmF0YXJOb2RlO1xuICAgICAgICAgICAgICAgIGlmIChoYXNBdmF0YXIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXZhdGFyUHJvcHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXhDbHM6IGAke3ByZWZpeENsc30tYXZhdGFyYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmdldEF2YXRhckJhc2ljUHJvcHMoaGFzVGl0bGUsIGhhc1BhcmFncmFwaCksXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5nZXRDb21wb25lbnRQcm9wcyhhdmF0YXIpLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBkaXJlY3QgdXNlIFNrZWxldG9uRWxlbWVudCBhcyBhdmF0YXIgaW4gc2tlbGV0b24gaW50ZXJuYWwuXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhck5vZGUgPSAoUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogYCR7cHJlZml4Q2xzfS1oZWFkZXJgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEVsZW1lbnQsIE9iamVjdC5hc3NpZ24oe30sIGF2YXRhclByb3BzKSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGNvbnRlbnROb2RlO1xuICAgICAgICAgICAgICAgIGlmIChoYXNUaXRsZSB8fCBoYXNQYXJhZ3JhcGgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGl0bGVcbiAgICAgICAgICAgICAgICAgICAgbGV0ICR0aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1RpdGxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aXRsZVByb3BzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWZpeENsczogYCR7cHJlZml4Q2xzfS10aXRsZWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZ2V0VGl0bGVCYXNpY1Byb3BzKGhhc0F2YXRhciwgaGFzUGFyYWdyYXBoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5nZXRDb21wb25lbnRQcm9wcyh0aXRsZSksXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRpdGxlID0gUmVhY3QuY3JlYXRlRWxlbWVudChUaXRsZSwgT2JqZWN0LmFzc2lnbih7fSwgdGl0bGVQcm9wcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIFBhcmFncmFwaFxuICAgICAgICAgICAgICAgICAgICBsZXQgcGFyYWdyYXBoTm9kZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1BhcmFncmFwaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYWdyYXBoUHJvcHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZml4Q2xzOiBgJHtwcmVmaXhDbHN9LXBhcmFncmFwaGAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uZ2V0UGFyYWdyYXBoQmFzaWNQcm9wcyhoYXNBdmF0YXIsIGhhc1RpdGxlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5nZXRDb21wb25lbnRQcm9wcyhwYXJhZ3JhcGgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFncmFwaE5vZGUgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFBhcmFncmFwaCwgT2JqZWN0LmFzc2lnbih7fSwgcGFyYWdyYXBoUHJvcHMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb250ZW50Tm9kZSA9IChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBgJHtwcmVmaXhDbHN9LWNvbnRlbnRgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhZ3JhcGhOb2RlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGNscyA9IGNsYXNzTmFtZXMocHJlZml4Q2xzLCBjbGFzc05hbWUsIHtcbiAgICAgICAgICAgICAgICAgICAgW2Ake3ByZWZpeENsc30td2l0aC1hdmF0YXJgXTogaGFzQXZhdGFyLFxuICAgICAgICAgICAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1hY3RpdmVgXTogYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1ydGxgXTogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjbHMgfSxcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyTm9kZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudE5vZGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbjtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgdGhpcy5yZW5kZXJTa2VsZXRvbigpKTtcbiAgICB9XG59XG5Ta2VsZXRvbi5kZWZhdWx0UHJvcHMgPSB7XG4gICAgYXZhdGFyOiBmYWxzZSxcbiAgICB0aXRsZTogdHJ1ZSxcbiAgICBwYXJhZ3JhcGg6IHRydWUsXG59O1xuZXhwb3J0IGRlZmF1bHQgU2tlbGV0b247XG4iXX0=