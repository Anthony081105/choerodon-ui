d2ef7628b6d27754362b829027510ae9
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.toArray = toArray;
exports.generateKey = generateKey;
exports.getActiveIndex = getActiveIndex;
exports.getActiveKey = getActiveKey;
exports.setTransform = setTransform;
exports.isTransformSupported = isTransformSupported;
exports.setTransition = setTransition;
exports.getTransformPropValue = getTransformPropValue;
exports.isVertical = isVertical;
exports.getTransformByIndex = getTransformByIndex;
exports.getMarginStyle = getMarginStyle;
exports.getStyle = getStyle;
exports.setPxStyle = setPxStyle;
exports.getDataAttr = getDataAttr;
exports.getLeft = getLeft;
exports.getTop = getTop;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = require("react");

var _isNil = _interopRequireDefault(require("lodash/isNil"));

function toArray(children) {
  var c = [];

  _react.Children.forEach(children, function (child) {
    if (child) {
      c.push(child);
    }
  });

  return c;
}

function generateKey(key, index) {
  return String((0, _isNil["default"])(key) ? index : key);
}

function getActiveIndex(children, activeKey) {
  var c = toArray(children);
  return c.findIndex(function (child, index) {
    return generateKey(child.key, index) === activeKey;
  });
}

function getActiveKey(children, index) {
  var c = toArray(children);
  return generateKey(c[index].key, index);
}

function setTransform(style, v) {
  style.transform = v;
  style.webkitTransform = v;
  style.mozTransform = v;
}

function isTransformSupported(style) {
  return 'transform' in style || 'webkitTransform' in style || 'MozTransform' in style;
}

function setTransition(style, v) {
  style.transition = v;
  style.webkitTransition = v;
  style.MozTransition = v;
}

function getTransformPropValue(v) {
  return {
    transform: v,
    WebkitTransform: v,
    MozTransform: v
  };
}

function isVertical(tabBarPosition) {
  return tabBarPosition === 'left' || tabBarPosition === 'right';
}

function getTransformByIndex(index, tabBarPosition) {
  var translate = isVertical(tabBarPosition) ? 'translateY' : 'translateX';
  return "".concat(translate, "(").concat(-index * 100, "%) translateZ(0)");
}

function getMarginStyle(index, tabBarPosition) {
  var marginDirection = isVertical(tabBarPosition) ? 'marginTop' : 'marginLeft';
  return (0, _defineProperty2["default"])({}, marginDirection, "".concat(-index * 100, "%"));
}

function getStyle(el, property) {
  return +getComputedStyle(el).getPropertyValue(property).replace('px', '');
}

function setPxStyle(el, value, vertical) {
  value = vertical ? "0px, ".concat(value, "px, 0px") : "".concat(value, "px, 0px, 0px");
  setTransform(el.style, "translate3d(".concat(value, ")"));
}

function getDataAttr(props) {
  return Object.keys(props).reduce(function (prev, key) {
    if (key.substr(0, 5) === 'aria-' || key.substr(0, 5) === 'data-' || key === 'role') {
      prev[key] = props[key];
    }

    return prev;
  }, {});
}

function toNum(style, property) {
  return +style.getPropertyValue(property).replace('px', '');
}

function getTypeValue(start, current, end, tabNode, wrapperNode) {
  var total = getStyle(wrapperNode, "padding-".concat(start));
  var childNodes = tabNode.parentNode.childNodes;
  Array.prototype.some.call(childNodes, function (node) {
    if (node !== tabNode) {
      // 此处对代码进行了修改 取自rc-tabs@9.4.2 这版本进行了计算方式的调整,避免了在类似modal等有动画的内容中使用的时候，计算出现错误的问题，因为在动画过程中的计算，会有一次Height width为0的情况
      // 在 9.4.2版本中 因为前几个版本的修改 refactor: rm mixin and react-create-class 
      // 对dom结构进行了调整 bar不与item在一个父元素中,因此有如下代码，在c7n中暂时不进行dom结构调整
      if (node.className.includes('ink-bar')) {
        return false;
      }

      var style = getComputedStyle(node);
      total += toNum(style, "margin-".concat(start));
      total += toNum(style, "margin-".concat(end));
      total += toNum(style, current);

      if (style.boxSizing === 'content-box') {
        total += toNum(style, "border-".concat(start, "-width")) + toNum(style, "padding-".concat(start)) + toNum(style, "border-".concat(end, "-width")) + toNum(style, "padding-".concat(end));
      }

      return false;
    }

    return true;
  });
  return total;
}

function getLeft(tabNode, wrapperNode) {
  return getTypeValue('left', 'width', 'right', tabNode, wrapperNode);
}

function getTop(tabNode, wrapperNode) {
  var top = getTypeValue('top', 'height', 'bottom', tabNode, wrapperNode);
  var height = getStyle(tabNode.parentNode, 'height');
  return top - height;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhYnMvdXRpbHMuanN4Il0sIm5hbWVzIjpbImMiLCJDaGlsZHJlbiIsIlN0cmluZyIsInRvQXJyYXkiLCJnZW5lcmF0ZUtleSIsImNoaWxkIiwic3R5bGUiLCJ0cmFuc2Zvcm0iLCJXZWJraXRUcmFuc2Zvcm0iLCJNb3pUcmFuc2Zvcm0iLCJ2IiwidGFiQmFyUG9zaXRpb24iLCJ0cmFuc2xhdGUiLCJpc1ZlcnRpY2FsIiwibWFyZ2luRGlyZWN0aW9uIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsInZhbHVlIiwidmVydGljYWwiLCJzZXRUcmFuc2Zvcm0iLCJlbCIsImtleSIsInByZXYiLCJwcm9wcyIsInRvdGFsIiwiZ2V0U3R5bGUiLCJjaGlsZE5vZGVzIiwidGFiTm9kZSIsIkFycmF5Iiwibm9kZSIsInRvTnVtIiwiZ2V0VHlwZVZhbHVlIiwidG9wIiwiaGVpZ2h0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsY0FBQSxDQUFBLENBQUE7O0FBRU8sU0FBQSxPQUFBLENBQUEsUUFBQSxFQUE0QjtBQUNqQyxNQUFNQSxDQUFDLEdBQVAsRUFBQTs7QUFDQUMsRUFBQUEsTUFBQUEsQ0FBQUEsUUFBQUEsQ0FBQUEsT0FBQUEsQ0FBQUEsUUFBQUEsRUFBMkIsVUFBQSxLQUFBLEVBQVM7QUFDbEMsUUFBQSxLQUFBLEVBQVc7QUFDVEQsTUFBQUEsQ0FBQyxDQUFEQSxJQUFBQSxDQUFBQSxLQUFBQTtBQUNEO0FBSEhDLEdBQUFBOztBQUtBLFNBQUEsQ0FBQTtBQUNEOztBQUVNLFNBQUEsV0FBQSxDQUFBLEdBQUEsRUFBQSxLQUFBLEVBQWtDO0FBQ3ZDLFNBQU9DLE1BQU0sQ0FBQyxDQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEdBQUEsSUFBQSxLQUFBLEdBQWQsR0FBYSxDQUFiO0FB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QUEsT0FBQSxFQUFuQixXQUFtQixDQUFuQjtBQUNEOztBQUVNLFNBQUEsTUFBQSxDQUFBLE9BQUEsRUFBQSxXQUFBLEVBQXVDO0FBQzVDLE1BQU1DLEdBQUcsR0FBR0QsWUFBWSxDQUFBLEtBQUEsRUFBQSxRQUFBLEVBQUEsUUFBQSxFQUFBLE9BQUEsRUFBeEIsV0FBd0IsQ0FBeEI7QUFDQSxNQUFNRSxNQUFNLEdBQUdSLFFBQVEsQ0FBQ0UsT0FBTyxDQUFSLFVBQUEsRUFBdkIsUUFBdUIsQ0FBdkI7QUFDQSxTQUFPSyxHQUFHLEdBQVYsTUFBQTtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hpbGRyZW4gfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgaXNOaWwgZnJvbSAnbG9kYXNoL2lzTmlsJztcblxuZXhwb3J0IGZ1bmN0aW9uIHRvQXJyYXkgKGNoaWxkcmVuKSB7XG4gIGNvbnN0IGMgPSBbXTtcbiAgQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgY2hpbGQgPT4ge1xuICAgIGlmIChjaGlsZCkge1xuICAgICAgYy5wdXNoKGNoaWxkKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gYztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlS2V5IChrZXksIGluZGV4KSB7XG4gIHJldHVybiBTdHJpbmcoaXNOaWwoa2V5KSA/IGluZGV4IDoga2V5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFjdGl2ZUluZGV4IChjaGlsZHJlbiwgYWN0aXZlS2V5KSB7XG4gIGNvbnN0IGMgPSB0b0FycmF5KGNoaWxkcmVuKTtcbiAgcmV0dXJuIGMuZmluZEluZGV4KChjaGlsZCwgaW5kZXgpID0+IGdlbmVyYXRlS2V5KGNoaWxkLmtleSwgaW5kZXgpID09PSBhY3RpdmVLZXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWN0aXZlS2V5IChjaGlsZHJlbiwgaW5kZXgpIHtcbiAgY29uc3QgYyA9IHRvQXJyYXkoY2hpbGRyZW4pO1xuICByZXR1cm4gZ2VuZXJhdGVLZXkoY1tpbmRleF0ua2V5LCBpbmRleCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRUcmFuc2Zvcm0gKHN0eWxlLCB2KSB7XG4gIHN0eWxlLnRyYW5zZm9ybSA9IHY7XG4gIHN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IHY7XG4gIHN0eWxlLm1velRyYW5zZm9ybSA9IHY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1RyYW5zZm9ybVN1cHBvcnRlZCAoc3R5bGUpIHtcbiAgcmV0dXJuICd0cmFuc2Zvcm0nIGluIHN0eWxlIHx8XG4gICAgJ3dlYmtpdFRyYW5zZm9ybScgaW4gc3R5bGUgfHxcbiAgICAnTW96VHJhbnNmb3JtJyBpbiBzdHlsZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldFRyYW5zaXRpb24gKHN0eWxlLCB2KSB7XG4gIHN0eWxlLnRyYW5zaXRpb24gPSB2O1xuICBzdHlsZS53ZWJraXRUcmFuc2l0aW9uID0gdjtcbiAgc3R5bGUuTW96VHJhbnNpdGlvbiA9IHY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUcmFuc2Zvcm1Qcm9wVmFsdWUgKHYpIHtcbiAgcmV0dXJuIHtcbiAgICB0cmFuc2Zvcm06IHYsXG4gICAgV2Via2l0VHJhbnNmb3JtOiB2LFxuICAgIE1velRyYW5zZm9ybTogdixcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzVmVydGljYWwgKHRhYkJhclBvc2l0aW9uKSB7XG4gIHJldHVybiB0YWJCYXJQb3NpdGlvbiA9PT0gJ2xlZnQnIHx8IHRhYkJhclBvc2l0aW9uID09PSAncmlnaHQnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHJhbnNmb3JtQnlJbmRleCAoaW5kZXgsIHRhYkJhclBvc2l0aW9uKSB7XG4gIGNvbnN0IHRyYW5zbGF0ZSA9IGlzVmVydGljYWwodGFiQmFyUG9zaXRpb24pID8gJ3RyYW5zbGF0ZVknIDogJ3RyYW5zbGF0ZVgnO1xuICByZXR1cm4gYCR7dHJhbnNsYXRlfSgkey1pbmRleCAqIDEwMH0lKSB0cmFuc2xhdGVaKDApYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1hcmdpblN0eWxlIChpbmRleCwgdGFiQmFyUG9zaXRpb24pIHtcbiAgY29uc3QgbWFyZ2luRGlyZWN0aW9uID0gaXNWZXJ0aWNhbCh0YWJCYXJQb3NpdGlvbikgPyAnbWFyZ2luVG9wJyA6ICdtYXJnaW5MZWZ0JztcbiAgcmV0dXJuIHtcbiAgICBbbWFyZ2luRGlyZWN0aW9uXTogYCR7LWluZGV4ICogMTAwfSVgLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3R5bGUgKGVsLCBwcm9wZXJ0eSkge1xuICByZXR1cm4gK2dldENvbXB1dGVkU3R5bGUoZWwpLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHkpLnJlcGxhY2UoJ3B4JywgJycpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0UHhTdHlsZSAoZWwsIHZhbHVlLCB2ZXJ0aWNhbCkge1xuICB2YWx1ZSA9IHZlcnRpY2FsID8gYDBweCwgJHt2YWx1ZX1weCwgMHB4YCA6IGAke3ZhbHVlfXB4LCAwcHgsIDBweGA7XG4gIHNldFRyYW5zZm9ybShlbC5zdHlsZSwgYHRyYW5zbGF0ZTNkKCR7dmFsdWV9KWApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGF0YUF0dHIgKHByb3BzKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhwcm9wcykucmVkdWNlKChwcmV2LCBrZXkpID0+IHtcbiAgICBpZiAoa2V5LnN1YnN0cigwLCA1KSA9PT0gJ2FyaWEtJyB8fCBrZXkuc3Vic3RyKDAsIDUpID09PSAnZGF0YS0nIHx8IGtleSA9PT0gJ3JvbGUnKSB7XG4gICAgICBwcmV2W2tleV0gPSBwcm9wc1trZXldO1xuICAgIH1cbiAgICByZXR1cm4gcHJldjtcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiB0b051bSAoc3R5bGUsIHByb3BlcnR5KSB7XG4gIHJldHVybiArc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSkucmVwbGFjZSgncHgnLCAnJyk7XG59XG5cbmZ1bmN0aW9uIGdldFR5cGVWYWx1ZSAoc3RhcnQsIGN1cnJlbnQsIGVuZCwgdGFiTm9kZSwgd3JhcHBlck5vZGUpIHtcbiAgbGV0IHRvdGFsID0gZ2V0U3R5bGUod3JhcHBlck5vZGUsIGBwYWRkaW5nLSR7c3RhcnR9YCk7XG4gIGNvbnN0IHsgY2hpbGROb2RlcyB9ID0gdGFiTm9kZS5wYXJlbnROb2RlO1xuICBBcnJheS5wcm90b3R5cGUuc29tZS5jYWxsKGNoaWxkTm9kZXMsIChub2RlKSA9PiB7XG4gICAgaWYgKG5vZGUgIT09IHRhYk5vZGUpIHtcbiAgICAgIC8vIOatpOWkhOWvueS7o+eggei/m+ihjOS6huS/ruaUuSDlj5boh6pyYy10YWJzQDkuNC4yIOi/meeJiOacrOi/m+ihjOS6huiuoeeul+aWueW8j+eahOiwg+aVtCzpgb/lhY3kuoblnKjnsbvkvLxtb2RhbOetieacieWKqOeUu+eahOWGheWuueS4reS9v+eUqOeahOaXtuWAme+8jOiuoeeul+WHuueOsOmUmeivr+eahOmXrumimO+8jOWboOS4uuWcqOWKqOeUu+i/h+eoi+S4reeahOiuoeeul++8jOS8muacieS4gOasoUhlaWdodCB3aWR0aOS4ujDnmoTmg4XlhrVcbiAgICAgIC8vIOWcqCA5LjQuMueJiOacrOS4rSDlm6DkuLrliY3lh6DkuKrniYjmnKznmoTkv67mlLkgcmVmYWN0b3I6IHJtIG1peGluIGFuZCByZWFjdC1jcmVhdGUtY2xhc3MgXG4gICAgICAvLyDlr7lkb23nu5PmnoTov5vooYzkuobosIPmlbQgYmFy5LiN5LiOaXRlbeWcqOS4gOS4queItuWFg+e0oOS4rSzlm6DmraTmnInlpoLkuIvku6PnoIHvvIzlnKhjN27kuK3mmoLml7bkuI3ov5vooYxkb23nu5PmnoTosIPmlbRcbiAgICAgIGlmIChub2RlLmNsYXNzTmFtZS5pbmNsdWRlcygnaW5rLWJhcicpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTtcbiAgICAgIHRvdGFsICs9IHRvTnVtKHN0eWxlLCBgbWFyZ2luLSR7c3RhcnR9YCk7XG4gICAgICB0b3RhbCArPSB0b051bShzdHlsZSwgYG1hcmdpbi0ke2VuZH1gKTtcbiAgICAgIHRvdGFsICs9IHRvTnVtKHN0eWxlLCBjdXJyZW50KTtcblxuICAgICAgaWYgKHN0eWxlLmJveFNpemluZyA9PT0gJ2NvbnRlbnQtYm94Jykge1xuICAgICAgICB0b3RhbCArPSB0b051bShzdHlsZSwgYGJvcmRlci0ke3N0YXJ0fS13aWR0aGApICsgdG9OdW0oc3R5bGUsIGBwYWRkaW5nLSR7c3RhcnR9YCkgK1xuICAgICAgICAgIHRvTnVtKHN0eWxlLCBgYm9yZGVyLSR7ZW5kfS13aWR0aGApICsgdG9OdW0oc3R5bGUsIGBwYWRkaW5nLSR7ZW5kfWApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRvdGFsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGVmdCAodGFiTm9kZSwgd3JhcHBlck5vZGUpIHtcbiAgcmV0dXJuIGdldFR5cGVWYWx1ZSgnbGVmdCcsICd3aWR0aCcsICdyaWdodCcsIHRhYk5vZGUsIHdyYXBwZXJOb2RlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRvcCAodGFiTm9kZSwgd3JhcHBlck5vZGUpIHtcbiAgY29uc3QgdG9wID0gZ2V0VHlwZVZhbHVlKCd0b3AnLCAnaGVpZ2h0JywgJ2JvdHRvbScsIHRhYk5vZGUsIHdyYXBwZXJOb2RlKTtcbiAgY29uc3QgaGVpZ2h0ID0gZ2V0U3R5bGUodGFiTm9kZS5wYXJlbnROb2RlLCAnaGVpZ2h0Jyk7XG4gIHJldHVybiB0b3AgLSBoZWlnaHQ7XG59XG4iXX0=