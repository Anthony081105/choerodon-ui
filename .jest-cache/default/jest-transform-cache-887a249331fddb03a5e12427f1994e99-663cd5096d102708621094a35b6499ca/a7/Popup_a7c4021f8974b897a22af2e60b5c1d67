96339297eabcd2f8e2c8827a1dddd5be
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _align = _interopRequireDefault(require("../../align"));

var _animate = _interopRequireDefault(require("../../animate"));

var _PopupInner = _interopRequireDefault(require("./PopupInner"));

var _LazyRenderBox = _interopRequireDefault(require("./LazyRenderBox"));

var _utils = require("./utils");

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Popup =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Popup, _Component);

  var _super = _createSuper(Popup);

  function Popup(_props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Popup);
    _this = _super.call(this, _props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onAlign", function (popupDomNode, align) {
      var props = _this.props;
      var currentAlignClassName = props.getClassNameFromAlign(align); // FIX: https://github.com/react-component/trigger/issues/56
      // FIX: https://github.com/react-component/tooltip/issues/79

      if (_this.currentAlignClassName !== currentAlignClassName) {
        _this.currentAlignClassName = currentAlignClassName;
        popupDomNode.className = _this.getClassName(currentAlignClassName);
      }

      props.onAlign(popupDomNode, align);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setStretchSize", function () {
      var _this$props = _this.props,
          stretch = _this$props.stretch,
          getRootDomNode = _this$props.getRootDomNode,
          visible = _this$props.visible;
      var _this$state = _this.state,
          stretchChecked = _this$state.stretchChecked,
          targetHeight = _this$state.targetHeight,
          targetWidth = _this$state.targetWidth;

      if (!stretch || !visible) {
        if (stretchChecked) {
          _this.setState({
            stretchChecked: false
          });
        }

        return;
      }

      var $ele = getRootDomNode();
      if (!$ele) return;
      var height = $ele.offsetHeight;
      var width = $ele.offsetWidth;

      if (targetHeight !== height || targetWidth !== width || !stretchChecked) {
        _this.setState({
          stretchChecked: true,
          targetHeight: height,
          targetWidth: width
        });
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getTarget", function () {
      return _this.props.getRootDomNode();
    });
    _this.state = {
      // Used for stretch
      stretchChecked: false,
      targetWidth: undefined,
      targetHeight: undefined
    };
    _this.savePopupRef = _utils.saveRef.bind((0, _assertThisInitialized2["default"])(_this), 'popupInstance');
    _this.saveAlignRef = _utils.saveRef.bind((0, _assertThisInitialized2["default"])(_this), 'alignInstance');
    return _this;
  }

  (0, _createClass2["default"])(Popup, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.rootNode = this.getPopupDomNode();
      this.setStretchSize();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.setStretchSize();
    }
  }, {
    key: "getPopupDomNode",
    value: function getPopupDomNode() {
      return _reactDom["default"].findDOMNode(this.popupInstance);
    }
  }, {
    key: "getMaskTransitionName",
    value: function getMaskTransitionName() {
      var props = this.props;
      var transitionName = props.maskTransitionName;
      var animation = props.maskAnimation;

      if (!transitionName && animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(animation);
      }

      return transitionName;
    }
  }, {
    key: "getTransitionName",
    value: function getTransitionName() {
      var props = this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(props.animation);
      }

      return transitionName;
    }
  }, {
    key: "getClassName",
    value: function getClassName(currentAlignClassName) {
      return "".concat(this.props.prefixCls, " ").concat(this.props.className, " ").concat(currentAlignClassName);
    }
  }, {
    key: "getPopupElement",
    value: function getPopupElement() {
      var savePopupRef = this.savePopupRef;
      var _this$state2 = this.state,
          stretchChecked = _this$state2.stretchChecked,
          targetHeight = _this$state2.targetHeight,
          targetWidth = _this$state2.targetWidth;
      var _this$props2 = this.props,
          align = _this$props2.align,
          visible = _this$props2.visible,
          prefixCls = _this$props2.prefixCls,
          style = _this$props2.style,
          getClassNameFromAlign = _this$props2.getClassNameFromAlign,
          destroyPopupOnHide = _this$props2.destroyPopupOnHide,
          stretch = _this$props2.stretch,
          children = _this$props2.children,
          onMouseEnter = _this$props2.onMouseEnter,
          onMouseLeave = _this$props2.onMouseLeave;
      var className = this.getClassName(this.currentAlignClassName || getClassNameFromAlign(align));
      var hiddenClassName = "".concat(prefixCls, "-hidden");

      if (!visible) {
        this.currentAlignClassName = null;
      }

      var sizeStyle = {};

      if (stretch) {
        if (stretchChecked) {
          // Stretch with target
          if (stretch.indexOf('height') !== -1) {
            sizeStyle.height = targetHeight;
          } else if (stretch.indexOf('minHeight') !== -1) {
            sizeStyle.minHeight = targetHeight;
          }

          if (stretch.indexOf('width') !== -1) {
            sizeStyle.width = targetWidth;
          } else if (stretch.indexOf('minWidth') !== -1) {
            sizeStyle.minWidth = targetWidth;
          }
        } else {
          // Do nothing when stretch not ready
          return null;
        }
      }

      var newStyle = (0, _objectSpread2["default"])({}, sizeStyle, {}, style, {}, this.getZIndexStyle());
      var popupInnerProps = {
        className: className,
        prefixCls: prefixCls,
        ref: savePopupRef,
        onMouseEnter: onMouseEnter,
        onMouseLeave: onMouseLeave,
        style: newStyle
      };

      if (destroyPopupOnHide) {
        return _react["default"].createElement(_animate["default"], {
          component: "",
          exclusive: true,
          transitionAppear: true,
          transitionName: this.getTransitionName()
        }, visible ? _react["default"].createElement(_align["default"], {
          target: this.getTarget,
          key: "popup",
          ref: this.saveAlignRef,
          monitorWindowResize: true,
          hidden: !visible,
          childrenProps: {
            hidden: 'hidden'
          },
          align: align,
          onAlign: this.onAlign
        }, _react["default"].createElement(_PopupInner["default"], popupInnerProps, children)) : null);
      }

      return _react["default"].createElement(_animate["default"], {
        component: "",
        exclusive: true,
        transitionAppear: true,
        transitionName: this.getTransitionName(),
        hiddenProp: "hidden"
      }, _react["default"].createElement(_align["default"], {
        target: this.getTarget,
        key: "popup",
        ref: this.saveAlignRef,
        monitorWindowResize: true,
        hidden: !visible,
        childrenProps: {
          hidden: 'hidden'
        },
        disabled: !visible,
        align: align,
        onAlign: this.onAlign
      }, _react["default"].createElement(_PopupInner["default"], (0, _extends2["default"])({
        hiddenClassName: hiddenClassName
      }, popupInnerProps), children)));
    }
  }, {
    key: "getZIndexStyle",
    value: function getZIndexStyle() {
      var style = {};
      var props = this.props;

      if (props.zIndex !== undefined) {
        style.zIndex = props.zIndex;
      }

      return style;
    }
  }, {
    key: "getMaskElement",
    value: function getMaskElement() {
      var props = this.props;
      var maskElement;

      if (props.mask) {
        var maskTransition = this.getMaskTransitionName();
        maskElement = _react["default"].createElement(_LazyRenderBox["default"], {
          style: this.getZIndexStyle(),
          key: "mask",
          className: "".concat(props.prefixCls, "-mask"),
          hiddenClassName: "".concat(props.prefixCls, "-mask-hidden"),
          hidden: !props.visible
        });

        if (maskTransition) {
          maskElement = _react["default"].createElement(_animate["default"], {
            key: "mask",
            hiddenProp: "hidden",
            transitionAppear: true,
            component: "",
            transitionName: maskTransition
          }, maskElement);
        }
      }

      return maskElement;
    }
  }, {
    key: "render",
    value: function render() {
      return _react["default"].createElement("div", null, this.getMaskElement(), this.getPopupElement());
    }
  }]);
  return Popup;
}(_react.Component);

(0, _defineProperty2["default"])(Popup, "propTypes", {
  visible: _propTypes["default"].bool,
  style: _propTypes["default"].object,
  getClassNameFromAlign: _propTypes["default"].func,
  onAlign: _propTypes["default"].func,
  getRootDomNode: _propTypes["default"].func,
  onMouseEnter: _propTypes["default"].func,
  align: _propTypes["default"].any,
  destroyPopupOnHide: _propTypes["default"].bool,
  className: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  onMouseLeave: _propTypes["default"].func,
  stretch: _propTypes["default"].string,
  children: _propTypes["default"].node
});
var _default = Popup;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBvcHVwLmpzeCJdLCJuYW1lcyI6WyJQb3B1cCIsInByb3BzIiwicG9wdXBEb21Ob2RlIiwiYWxpZ24iLCJjdXJyZW50QWxpZ25DbGFzc05hbWUiLCJnZXRDbGFzc05hbWVGcm9tQWxpZ24iLCJjbGFzc05hbWUiLCJnZXRDbGFzc05hbWUiLCJvbkFsaWduIiwic3RyZXRjaCIsImdldFJvb3REb21Ob2RlIiwidmlzaWJsZSIsInN0YXRlIiwic3RyZXRjaENoZWNrZWQiLCJ0YXJnZXRIZWlnaHQiLCJ0YXJnZXRXaWR0aCIsInNldFN0YXRlIiwiJGVsZSIsImhlaWdodCIsIm9mZnNldEhlaWdodCIsIndpZHRoIiwib2Zmc2V0V2lkdGgiLCJ1bmRlZmluZWQiLCJzYXZlUG9wdXBSZWYiLCJzYXZlUmVmIiwiYmluZCIsInNhdmVBbGlnblJlZiIsInJvb3ROb2RlIiwiZ2V0UG9wdXBEb21Ob2RlIiwic2V0U3RyZXRjaFNpemUiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwicG9wdXBJbnN0YW5jZSIsInRyYW5zaXRpb25OYW1lIiwibWFza1RyYW5zaXRpb25OYW1lIiwiYW5pbWF0aW9uIiwibWFza0FuaW1hdGlvbiIsInByZWZpeENscyIsInN0eWxlIiwiZGVzdHJveVBvcHVwT25IaWRlIiwiY2hpbGRyZW4iLCJvbk1vdXNlRW50ZXIiLCJvbk1vdXNlTGVhdmUiLCJoaWRkZW5DbGFzc05hbWUiLCJzaXplU3R5bGUiLCJpbmRleE9mIiwibWluSGVpZ2h0IiwibWluV2lkdGgiLCJuZXdTdHlsZSIsImdldFpJbmRleFN0eWxlIiwicG9wdXBJbm5lclByb3BzIiwicmVmIiwiZ2V0VHJhbnNpdGlvbk5hbWUiLCJnZXRUYXJnZXQiLCJoaWRkZW4iLCJ6SW5kZXgiLCJtYXNrRWxlbWVudCIsIm1hc2siLCJtYXNrVHJhbnNpdGlvbiIsImdldE1hc2tUcmFuc2l0aW9uTmFtZSIsImdldE1hc2tFbGVtZW50IiwiZ2V0UG9wdXBFbGVtZW50IiwiQ29tcG9uZW50IiwiUHJvcFR5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VUssTUFaRjtBQWFqQjVCLEVBQUFBLFFBQVEsRUFBRXVCLHNCQUFVTTtBQWJILEM7ZUE2UU5yRSxLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBBbGlnbiBmcm9tICcuLi8uLi9hbGlnbic7XG5pbXBvcnQgQW5pbWF0ZSBmcm9tICcuLi8uLi9hbmltYXRlJztcbmltcG9ydCBQb3B1cElubmVyIGZyb20gJy4vUG9wdXBJbm5lcic7XG5pbXBvcnQgTGF6eVJlbmRlckJveCBmcm9tICcuL0xhenlSZW5kZXJCb3gnO1xuaW1wb3J0IHsgc2F2ZVJlZiB9IGZyb20gJy4vdXRpbHMnO1xuXG5jbGFzcyBQb3B1cCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgdmlzaWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZ2V0Q2xhc3NOYW1lRnJvbUFsaWduOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkFsaWduOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRSb290RG9tTm9kZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Nb3VzZUVudGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBhbGlnbjogUHJvcFR5cGVzLmFueSxcbiAgICBkZXN0cm95UG9wdXBPbkhpZGU6IFByb3BUeXBlcy5ib29sLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgb25Nb3VzZUxlYXZlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzdHJldGNoOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAvLyBVc2VkIGZvciBzdHJldGNoXG4gICAgICBzdHJldGNoQ2hlY2tlZDogZmFsc2UsXG4gICAgICB0YXJnZXRXaWR0aDogdW5kZWZpbmVkLFxuICAgICAgdGFyZ2V0SGVpZ2h0OiB1bmRlZmluZWQsXG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZVBvcHVwUmVmID0gc2F2ZVJlZi5iaW5kKHRoaXMsICdwb3B1cEluc3RhbmNlJyk7XG4gICAgdGhpcy5zYXZlQWxpZ25SZWYgPSBzYXZlUmVmLmJpbmQodGhpcywgJ2FsaWduSW5zdGFuY2UnKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMucm9vdE5vZGUgPSB0aGlzLmdldFBvcHVwRG9tTm9kZSgpO1xuICAgIHRoaXMuc2V0U3RyZXRjaFNpemUoKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnNldFN0cmV0Y2hTaXplKCk7XG4gIH1cblxuICBvbkFsaWduID0gKHBvcHVwRG9tTm9kZSwgYWxpZ24pID0+IHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY3VycmVudEFsaWduQ2xhc3NOYW1lID0gcHJvcHMuZ2V0Q2xhc3NOYW1lRnJvbUFsaWduKGFsaWduKTtcbiAgICAvLyBGSVg6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdC1jb21wb25lbnQvdHJpZ2dlci9pc3N1ZXMvNTZcbiAgICAvLyBGSVg6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdC1jb21wb25lbnQvdG9vbHRpcC9pc3N1ZXMvNzlcbiAgICBpZiAodGhpcy5jdXJyZW50QWxpZ25DbGFzc05hbWUgIT09IGN1cnJlbnRBbGlnbkNsYXNzTmFtZSkge1xuICAgICAgdGhpcy5jdXJyZW50QWxpZ25DbGFzc05hbWUgPSBjdXJyZW50QWxpZ25DbGFzc05hbWU7XG4gICAgICBwb3B1cERvbU5vZGUuY2xhc3NOYW1lID0gdGhpcy5nZXRDbGFzc05hbWUoY3VycmVudEFsaWduQ2xhc3NOYW1lKTtcbiAgICB9XG4gICAgcHJvcHMub25BbGlnbihwb3B1cERvbU5vZGUsIGFsaWduKTtcbiAgfTtcblxuICAvLyBSZWNvcmQgc2l6ZSBpZiBzdHJldGNoIG5lZWRlZFxuICBzZXRTdHJldGNoU2l6ZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IHN0cmV0Y2gsIGdldFJvb3REb21Ob2RlLCB2aXNpYmxlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgc3RyZXRjaENoZWNrZWQsIHRhcmdldEhlaWdodCwgdGFyZ2V0V2lkdGggfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAoIXN0cmV0Y2ggfHwgIXZpc2libGUpIHtcbiAgICAgIGlmIChzdHJldGNoQ2hlY2tlZCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc3RyZXRjaENoZWNrZWQ6IGZhbHNlIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0ICRlbGUgPSBnZXRSb290RG9tTm9kZSgpO1xuICAgIGlmICghJGVsZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGVpZ2h0ID0gJGVsZS5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3Qgd2lkdGggPSAkZWxlLm9mZnNldFdpZHRoO1xuXG4gICAgaWYgKHRhcmdldEhlaWdodCAhPT0gaGVpZ2h0IHx8IHRhcmdldFdpZHRoICE9PSB3aWR0aCB8fCAhc3RyZXRjaENoZWNrZWQpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBzdHJldGNoQ2hlY2tlZDogdHJ1ZSxcbiAgICAgICAgdGFyZ2V0SGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHRhcmdldFdpZHRoOiB3aWR0aCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBnZXRQb3B1cERvbU5vZGUoKSB7XG4gICAgcmV0dXJuIFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMucG9wdXBJbnN0YW5jZSk7XG4gIH1cblxuICBnZXRUYXJnZXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMuZ2V0Um9vdERvbU5vZGUoKTtcbiAgfTtcblxuICBnZXRNYXNrVHJhbnNpdGlvbk5hbWUoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCB0cmFuc2l0aW9uTmFtZSA9IHByb3BzLm1hc2tUcmFuc2l0aW9uTmFtZTtcbiAgICBjb25zdCBhbmltYXRpb24gPSBwcm9wcy5tYXNrQW5pbWF0aW9uO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgYW5pbWF0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3Byb3BzLnByZWZpeENsc30tJHthbmltYXRpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9XG5cbiAgZ2V0VHJhbnNpdGlvbk5hbWUoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCB0cmFuc2l0aW9uTmFtZSA9IHByb3BzLnRyYW5zaXRpb25OYW1lO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgcHJvcHMuYW5pbWF0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3Byb3BzLnByZWZpeENsc30tJHtwcm9wcy5hbmltYXRpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9XG5cbiAgZ2V0Q2xhc3NOYW1lKGN1cnJlbnRBbGlnbkNsYXNzTmFtZSkge1xuICAgIHJldHVybiBgJHt0aGlzLnByb3BzLnByZWZpeENsc30gJHt0aGlzLnByb3BzLmNsYXNzTmFtZX0gJHtjdXJyZW50QWxpZ25DbGFzc05hbWV9YDtcbiAgfVxuXG4gIGdldFBvcHVwRWxlbWVudCgpIHtcbiAgICBjb25zdCB7IHNhdmVQb3B1cFJlZiB9ID0gdGhpcztcbiAgICBjb25zdCB7IHN0cmV0Y2hDaGVja2VkLCB0YXJnZXRIZWlnaHQsIHRhcmdldFdpZHRoIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHtcbiAgICAgIGFsaWduLCB2aXNpYmxlLFxuICAgICAgcHJlZml4Q2xzLCBzdHlsZSwgZ2V0Q2xhc3NOYW1lRnJvbUFsaWduLFxuICAgICAgZGVzdHJveVBvcHVwT25IaWRlLCBzdHJldGNoLCBjaGlsZHJlbixcbiAgICAgIG9uTW91c2VFbnRlciwgb25Nb3VzZUxlYXZlLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuZ2V0Q2xhc3NOYW1lKHRoaXMuY3VycmVudEFsaWduQ2xhc3NOYW1lIHx8XG4gICAgICBnZXRDbGFzc05hbWVGcm9tQWxpZ24oYWxpZ24pKTtcbiAgICBjb25zdCBoaWRkZW5DbGFzc05hbWUgPSBgJHtwcmVmaXhDbHN9LWhpZGRlbmA7XG5cbiAgICBpZiAoIXZpc2libGUpIHtcbiAgICAgIHRoaXMuY3VycmVudEFsaWduQ2xhc3NOYW1lID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBzaXplU3R5bGUgPSB7fTtcbiAgICBpZiAoc3RyZXRjaCkge1xuICAgICAgaWYgKHN0cmV0Y2hDaGVja2VkKSB7XG4gICAgICAgIC8vIFN0cmV0Y2ggd2l0aCB0YXJnZXRcbiAgICAgICAgaWYgKHN0cmV0Y2guaW5kZXhPZignaGVpZ2h0JykgIT09IC0xKSB7XG4gICAgICAgICAgc2l6ZVN0eWxlLmhlaWdodCA9IHRhcmdldEhlaWdodDtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJldGNoLmluZGV4T2YoJ21pbkhlaWdodCcpICE9PSAtMSkge1xuICAgICAgICAgIHNpemVTdHlsZS5taW5IZWlnaHQgPSB0YXJnZXRIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cmV0Y2guaW5kZXhPZignd2lkdGgnKSAhPT0gLTEpIHtcbiAgICAgICAgICBzaXplU3R5bGUud2lkdGggPSB0YXJnZXRXaWR0aDtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJldGNoLmluZGV4T2YoJ21pbldpZHRoJykgIT09IC0xKSB7XG4gICAgICAgICAgc2l6ZVN0eWxlLm1pbldpZHRoID0gdGFyZ2V0V2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIERvIG5vdGhpbmcgd2hlbiBzdHJldGNoIG5vdCByZWFkeVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBuZXdTdHlsZSA9IHtcbiAgICAgIC4uLnNpemVTdHlsZSxcbiAgICAgIC4uLnN0eWxlLFxuICAgICAgLi4udGhpcy5nZXRaSW5kZXhTdHlsZSgpLFxuICAgIH07XG5cbiAgICBjb25zdCBwb3B1cElubmVyUHJvcHMgPSB7XG4gICAgICBjbGFzc05hbWUsXG4gICAgICBwcmVmaXhDbHMsXG4gICAgICByZWY6IHNhdmVQb3B1cFJlZixcbiAgICAgIG9uTW91c2VFbnRlcixcbiAgICAgIG9uTW91c2VMZWF2ZSxcbiAgICAgIHN0eWxlOiBuZXdTdHlsZSxcbiAgICB9O1xuICAgIGlmIChkZXN0cm95UG9wdXBPbkhpZGUpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxBbmltYXRlXG4gICAgICAgICAgY29tcG9uZW50PVwiXCJcbiAgICAgICAgICBleGNsdXNpdmVcbiAgICAgICAgICB0cmFuc2l0aW9uQXBwZWFyXG4gICAgICAgICAgdHJhbnNpdGlvbk5hbWU9e3RoaXMuZ2V0VHJhbnNpdGlvbk5hbWUoKX1cbiAgICAgICAgPlxuICAgICAgICAgIHt2aXNpYmxlID8gKFxuICAgICAgICAgICAgPEFsaWduXG4gICAgICAgICAgICAgIHRhcmdldD17dGhpcy5nZXRUYXJnZXR9XG4gICAgICAgICAgICAgIGtleT1cInBvcHVwXCJcbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnNhdmVBbGlnblJlZn1cbiAgICAgICAgICAgICAgbW9uaXRvcldpbmRvd1Jlc2l6ZVxuICAgICAgICAgICAgICBoaWRkZW49eyF2aXNpYmxlfVxuICAgICAgICAgICAgICBjaGlsZHJlblByb3BzPXt7IGhpZGRlbjogJ2hpZGRlbicgfX1cbiAgICAgICAgICAgICAgYWxpZ249e2FsaWdufVxuICAgICAgICAgICAgICBvbkFsaWduPXt0aGlzLm9uQWxpZ259XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxQb3B1cElubmVyXG4gICAgICAgICAgICAgICAgey4uLnBvcHVwSW5uZXJQcm9wc31cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAgPC9Qb3B1cElubmVyPlxuICAgICAgICAgICAgPC9BbGlnbj5cbiAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgPC9BbmltYXRlPlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlXG4gICAgICAgIGNvbXBvbmVudD1cIlwiXG4gICAgICAgIGV4Y2x1c2l2ZVxuICAgICAgICB0cmFuc2l0aW9uQXBwZWFyXG4gICAgICAgIHRyYW5zaXRpb25OYW1lPXt0aGlzLmdldFRyYW5zaXRpb25OYW1lKCl9XG4gICAgICAgIGhpZGRlblByb3A9XCJoaWRkZW5cIlxuICAgICAgPlxuICAgICAgICA8QWxpZ25cbiAgICAgICAgICB0YXJnZXQ9e3RoaXMuZ2V0VGFyZ2V0fVxuICAgICAgICAgIGtleT1cInBvcHVwXCJcbiAgICAgICAgICByZWY9e3RoaXMuc2F2ZUFsaWduUmVmfVxuICAgICAgICAgIG1vbml0b3JXaW5kb3dSZXNpemVcbiAgICAgICAgICBoaWRkZW49eyF2aXNpYmxlfVxuICAgICAgICAgIGNoaWxkcmVuUHJvcHM9e3sgaGlkZGVuOiAnaGlkZGVuJyB9fVxuICAgICAgICAgIGRpc2FibGVkPXshdmlzaWJsZX1cbiAgICAgICAgICBhbGlnbj17YWxpZ259XG4gICAgICAgICAgb25BbGlnbj17dGhpcy5vbkFsaWdufVxuICAgICAgICA+XG4gICAgICAgICAgPFBvcHVwSW5uZXJcbiAgICAgICAgICAgIGhpZGRlbkNsYXNzTmFtZT17aGlkZGVuQ2xhc3NOYW1lfVxuICAgICAgICAgICAgey4uLnBvcHVwSW5uZXJQcm9wc31cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgPC9Qb3B1cElubmVyPlxuICAgICAgICA8L0FsaWduPlxuICAgICAgPC9BbmltYXRlPlxuICAgICk7XG4gIH1cblxuICBnZXRaSW5kZXhTdHlsZSgpIHtcbiAgICBjb25zdCBzdHlsZSA9IHt9O1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBpZiAocHJvcHMuekluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHN0eWxlLnpJbmRleCA9IHByb3BzLnpJbmRleDtcbiAgICB9XG4gICAgcmV0dXJuIHN0eWxlO1xuICB9XG5cbiAgZ2V0TWFza0VsZW1lbnQoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCBtYXNrRWxlbWVudDtcbiAgICBpZiAocHJvcHMubWFzaykge1xuICAgICAgY29uc3QgbWFza1RyYW5zaXRpb24gPSB0aGlzLmdldE1hc2tUcmFuc2l0aW9uTmFtZSgpO1xuICAgICAgbWFza0VsZW1lbnQgPSAoXG4gICAgICAgIDxMYXp5UmVuZGVyQm94XG4gICAgICAgICAgc3R5bGU9e3RoaXMuZ2V0WkluZGV4U3R5bGUoKX1cbiAgICAgICAgICBrZXk9XCJtYXNrXCJcbiAgICAgICAgICBjbGFzc05hbWU9e2Ake3Byb3BzLnByZWZpeENsc30tbWFza2B9XG4gICAgICAgICAgaGlkZGVuQ2xhc3NOYW1lPXtgJHtwcm9wcy5wcmVmaXhDbHN9LW1hc2staGlkZGVuYH1cbiAgICAgICAgICBoaWRkZW49eyFwcm9wcy52aXNpYmxlfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICAgIGlmIChtYXNrVHJhbnNpdGlvbikge1xuICAgICAgICBtYXNrRWxlbWVudCA9IChcbiAgICAgICAgICA8QW5pbWF0ZVxuICAgICAgICAgICAga2V5PVwibWFza1wiXG4gICAgICAgICAgICBoaWRkZW5Qcm9wPVwiaGlkZGVuXCJcbiAgICAgICAgICAgIHRyYW5zaXRpb25BcHBlYXJcbiAgICAgICAgICAgIGNvbXBvbmVudD1cIlwiXG4gICAgICAgICAgICB0cmFuc2l0aW9uTmFtZT17bWFza1RyYW5zaXRpb259XG4gICAgICAgICAgPlxuICAgICAgICAgICAge21hc2tFbGVtZW50fVxuICAgICAgICAgIDwvQW5pbWF0ZT5cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1hc2tFbGVtZW50O1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2PlxuICAgICAgICB7dGhpcy5nZXRNYXNrRWxlbWVudCgpfVxuICAgICAgICB7dGhpcy5nZXRQb3B1cEVsZW1lbnQoKX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXA7XG4iXX0=