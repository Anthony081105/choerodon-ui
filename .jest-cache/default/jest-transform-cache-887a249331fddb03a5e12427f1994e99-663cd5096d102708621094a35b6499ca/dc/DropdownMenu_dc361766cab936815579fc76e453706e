a9fe2dcae21bdc6f27e15f0af8de1f02
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = require("react-dom");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _toArray = _interopRequireDefault(require("../util/Children/toArray"));

var _menu = _interopRequireDefault(require("../menu"));

var _domScrollIntoView = _interopRequireDefault(require("dom-scroll-into-view"));

var _util = require("./util");

var _FilterInput = _interopRequireDefault(require("./FilterInput"));

var _LocaleReceiver = _interopRequireDefault(require("../../locale-provider/LocaleReceiver"));

var _default = _interopRequireDefault(require("../../locale-provider/default"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var DropdownMenu =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(DropdownMenu, _Component);

  var _super = _createSuper(DropdownMenu);

  function DropdownMenu() {
    var _this;

    (0, _classCallCheck2["default"])(this, DropdownMenu);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "scrollActiveItemToView", function () {
      // scroll into view
      var itemComponent = (0, _reactDom.findDOMNode)(_this.firstActiveItem);
      var props = _this.props;

      if (itemComponent) {
        var scrollIntoViewOpts = {
          onlyScrollIfNeeded: true
        };

        if ((!props.value || props.value.length === 0) && props.firstActiveValue) {
          scrollIntoViewOpts.alignWithTop = true;
        }

        (0, _domScrollIntoView["default"])(itemComponent, (0, _reactDom.findDOMNode)(_this.menuRef), scrollIntoViewOpts);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderCheckLabel", function (locale) {
      var _this$props = _this.props,
          prefixCls = _this$props.prefixCls,
          checkAll = _this$props.checkAll;
      return _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-select-all-none")
      }, _react["default"].createElement("span", {
        name: "check-all",
        onClick: checkAll
      }, locale.selectAll), _react["default"].createElement("span", {
        name: "check-none",
        onClick: checkAll
      }, locale.selectNone));
    });
    return _this;
  }

  (0, _createClass2["default"])(DropdownMenu, [{
    key: "componentWillMount",
    value: function componentWillMount() {
      this.lastInputValue = this.props.inputValue;
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.scrollActiveItemToView();
      this.lastVisible = this.props.visible;
    }
  }, {
    key: "shouldComponentUpdate",
    value: function shouldComponentUpdate(nextProps) {
      if (!nextProps.visible) {
        this.lastVisible = false;
      } // freeze when hide


      return nextProps.visible;
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var props = this.props;

      if (!prevProps.visible && props.visible) {
        this.scrollActiveItemToView();
      }

      this.lastVisible = props.visible;
      this.lastInputValue = props.inputValue;
    }
  }, {
    key: "renderMenu",
    value: function renderMenu() {
      var _this2 = this;

      var props = this.props;
      var menuItems = props.menuItems,
          value = props.value,
          defaultActiveFirstOption = props.defaultActiveFirstOption,
          prefixCls = props.prefixCls,
          multiple = props.multiple,
          onMenuSelect = props.onMenuSelect,
          inputValue = props.inputValue,
          firstActiveValue = props.firstActiveValue,
          backfillValue = props.backfillValue;

      if (menuItems && menuItems.length) {
        var menuProps = {};

        if (multiple) {
          menuProps.onDeselect = props.onMenuDeselect;
          menuProps.onSelect = onMenuSelect;
        } else {
          menuProps.onClick = onMenuSelect;
        }

        var selectedKeys = (0, _util.getSelectKeys)(menuItems, value);
        var activeKeyProps = {};
        var clonedMenuItems = menuItems;

        if (selectedKeys.length || firstActiveValue) {
          if (props.visible && !this.lastVisible) {
            activeKeyProps.activeKey = selectedKeys[0] || firstActiveValue;
          }

          var foundFirst = false; // set firstActiveItem via cloning menus
          // for scroll into view

          var clone = function clone(item) {
            if (!foundFirst && selectedKeys.indexOf(item.key) !== -1 || !foundFirst && !selectedKeys.length && firstActiveValue.indexOf(item.key) !== -1) {
              foundFirst = true;
              return (0, _react.cloneElement)(item, {
                ref: function ref(_ref) {
                  _this2.firstActiveItem = _ref;
                }
              });
            }

            return item;
          };

          clonedMenuItems = menuItems.map(function (item) {
            if (item.type.isMenuItemGroup) {
              var children = (0, _toArray["default"])(item.props.children).map(clone);
              return (0, _react.cloneElement)(item, {}, children);
            }

            return clone(item);
          });
        } // clear activeKey when inputValue change


        var lastValue = value && value[value.length - 1];

        if (inputValue !== this.lastInputValue && (!lastValue || lastValue !== backfillValue)) {
          activeKeyProps.activeKey = '';
        }

        return _react["default"].createElement(_menu["default"], (0, _extends2["default"])({
          ref: (0, _util.saveRef)(this, 'menuRef'),
          style: this.props.dropdownMenuStyle,
          defaultActiveFirst: defaultActiveFirstOption
        }, activeKeyProps, {
          multiple: multiple
        }, menuProps, {
          selectedKeys: selectedKeys,
          prefixCls: "".concat(prefixCls, "-menu")
        }), clonedMenuItems);
      }

      return null;
    }
  }, {
    key: "renderFilterInput",
    value: function renderFilterInput() {
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          filter = _this$props2.filter,
          placeholder = _this$props2.placeholder,
          onFilterChange = _this$props2.onFilterChange,
          filterValue = _this$props2.filterValue,
          onKeyDown = _this$props2.onKeyDown;
      var props = {
        filterValue: filterValue,
        prefixCls: prefixCls,
        placeholder: placeholder,
        onChange: onFilterChange,
        onKeyDown: onKeyDown
      };
      return filter ? _react["default"].createElement(_FilterInput["default"], (0, _extends2["default"])({}, props, {
        ref: (0, _util.saveRef)(this, 'filterRef')
      })) : null;
    }
  }, {
    key: "getFooter",
    value: function getFooter() {
      var _this$props3 = this.props,
          prefixCls = _this$props3.prefixCls,
          footer = _this$props3.footer;
      return footer ? _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-footer"),
        onMouseDown: _util.preventDefaultEvent
      }, footer) : null;
    }
  }, {
    key: "render",
    value: function render() {
      var renderMenu = this.renderMenu();
      var filterInput = this.renderFilterInput();
      var _this$props4 = this.props,
          multiple = _this$props4.multiple,
          menuItems = _this$props4.menuItems,
          checkAll = _this$props4.checkAll,
          onMouseDown = _this$props4.onMouseDown;
      var selectOpt = null;

      if (checkAll && multiple && menuItems.length && menuItems[0].key !== 'NOT_FOUND') {
        selectOpt = _react["default"].createElement(_LocaleReceiver["default"], {
          componentName: "Select",
          defaultLocale: _default["default"].Select
        }, this.renderCheckLabel);
      }

      return _react["default"].createElement("div", {
        onMouseDown: onMouseDown
      }, filterInput, selectOpt, _react["default"].createElement("div", {
        style: {
          overflow: 'auto'
        },
        onScroll: this.props.onPopupScroll,
        onFocus: this.props.onPopupFocus
      }, renderMenu), this.getFooter());
    }
  }]);
  return DropdownMenu;
}(_react.Component);

exports["default"] = DropdownMenu;
(0, _defineProperty2["default"])(DropdownMenu, "propTypes", {
  defaultActiveFirstOption: _propTypes["default"].bool,
  value: _propTypes["default"].any,
  dropdownMenuStyle: _propTypes["default"].object,
  multiple: _propTypes["default"].bool,
  onPopupFocus: _propTypes["default"].func,
  onPopupScroll: _propTypes["default"].func,
  onMenuDeSelect: _propTypes["default"].func,
  onMenuSelect: _propTypes["default"].func,
  onMouseDown: _propTypes["default"].func,
  prefixCls: _propTypes["default"].string,
  menuItems: _propTypes["default"].any,
  inputValue: _propTypes["default"].string,
  visible: _propTypes["default"].bool,
  filter: _propTypes["default"].bool,
  checkAll: _propTypes["default"].func,
  footer: _propTypes["default"].oneOfType([_propTypes["default"].node, _propTypes["default"].string]),
  onKeyDown: _propTypes["default"].func
});
(0, _defineProperty2["default"])(DropdownMenu, "defaultProps", {
  footer: null
});
DropdownMenu.displayName = 'DropdownMenu';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRyb3Bkb3duTWVudS5qc3giXSwibmFtZXMiOlsiRHJvcGRvd25NZW51IiwiaXRlbUNvbXBvbmVudCIsImZpcnN0QWN0aXZlSXRlbSIsInByb3BzIiwic2Nyb2xsSW50b1ZpZXdPcHRzIiwib25seVNjcm9sbElmTmVlZGVkIiwidmFsdWUiLCJsZW5ndGgiLCJmaXJzdEFjdGl2ZVZhbHVlIiwiYWxpZ25XaXRoVG9wIiwibWVudVJlZiIsImxvY2FsZSIsInByZWZpeENscyIsImNoZWNrQWxsIiwic2VsZWN0QWxsIiwic2VsZWN0Tm9uZSIsImxhc3RJbnB1dFZhbHVlIiwiaW5wdXRWYWx1ZSIsInNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXciLCJsYXN0VmlzaWJsZSIsInZpc2libGUiLCJuZXh0UHJvcHMiLCJwcmV2UHJvcHMiLCJtZW51SXRlbXMiLCJkZWZhdWx0QWN0aXZlRmlyc3RPcHRpb24iLCJtdWx0aXBsZSIsIm9uTWVudVNlbGVjdCIsImJhY2tmaWxsVmFsdWUiLCJtZW51UHJvcHMiLCJvbkRlc2VsZWN0Iiwib25NZW51RGVzZWxlY3QiLCJvblNlbGVjdCIsIm9uQ2xpY2siLCJzZWxlY3RlZEtleXMiLCJhY3RpdmVLZXlQcm9wcyIsImNsb25lZE1lbnVJdGVtcyIsImFjdGl2ZUtleSIsImZvdW5kRmlyc3QiLCJjbG9uZSIsIml0ZW0iLCJpbmRleE9mIiwia2V5IiwicmVmIiwibWFwIiwidHlwZSIsImlzTWVudUl0ZW1Hcm91cCIsImNoaWxkcmVuIiwibGFzdFZhbHVlIiwiZHJvcGRvd25NZW51U3R5bGUiLCJmaWx0ZXIiLCJwbGFjZWhvbGRlciIsIm9uRmlsdGVyQ2hhbmdlIiwiZmlsdGVyVmFsdWUiLCJvbktleURvd24iLCJvbkNoYW5nZSIsImZvb3RlciIsInByZXZlbnREZWZhdWx0RXZlbnQiLCJyZW5kZXJNZW51IiwiZmlsdGVySW5wdXQiLCJyZW5kZXJGaWx0ZXJJbnB1dCIsIm9uTW91c2VEb3duIiwic2VsZWN0T3B0IiwiZGVmYXVsdExvY2FsZSIsIlNlbGVjdCIsInJlbmRlckNoZWNrTGFiZWwiLCJvdmVyZmxvdyIsIm9uUG9wdXBTY3JvbGwiLCJvblBvcHVwRm9jdXMiLCJnZXRGb290ZXIiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJib29sIiwiYW55Iiwib2JqZWN0IiwiZnVuYyIsIm9uTWVudURlU2VsZWN0Iiwic3RyaW5nIiwib25lT2ZUeXBlIiwibm9kZSIsImRpc3BsYXlOYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUVxQkEsWTs7Ozs7Ozs7Ozs7Ozs7Ozs7K0dBc0RNLFlBQU07QUFDN0I7QUFDQSxVQUFNQyxhQUFhLEdBQUcsMkJBQVksTUFBS0MsZUFBakIsQ0FBdEI7QUFDQSxVQUFNQyxLQUFLLEdBQUcsTUFBS0EsS0FBbkI7O0FBRUEsVUFBSUYsYUFBSixFQUFtQjtBQUNqQixZQUFNRyxrQkFBa0IsR0FBRztBQUN6QkMsVUFBQUEsa0JBQWtCLEVBQUU7QUFESyxTQUEzQjs7QUFHQSxZQUNFLENBQUMsQ0FBQ0YsS0FBSyxDQUFDRyxLQUFQLElBQWdCSCxLQUFLLENBQUNHLEtBQU4sQ0FBWUMsTUFBWixLQUF1QixDQUF4QyxLQUNBSixLQUFLLENBQUNLLGdCQUZSLEVBR0U7QUFDQUosVUFBQUEsa0JBQWtCLENBQUNLLFlBQW5CLEdBQWtDLElBQWxDO0FBQ0Q7O0FBRUQsMkNBQ0VSLGFBREYsRUFFRSwyQkFBWSxNQUFLUyxPQUFqQixDQUZGLEVBR0VOLGtCQUhGO0FBS0Q7QUFDRixLO3lHQTBHa0IsVUFBQ08sTUFBRCxFQUFZO0FBQUEsd0JBQ0csTUFBS1IsS0FEUjtBQUFBLFVBQ3JCUyxTQURxQixlQUNyQkEsU0FEcUI7QUFBQSxVQUNWQyxRQURVLGVBQ1ZBLFFBRFU7QUFFN0IsYUFDRTtBQUFLLFFBQUEsU0FBUyxZQUFLRCxTQUFMO0FB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SUFEbkI7QUFFakJqRSxFQUFBQSxLQUFLLEVBQUVnRSxzQkFBVUUsR0FGQTtBQUdqQnhCLEVBQUFBLGlCQUFpQixFQUFFc0Isc0JBQVVHLE1BSFo7QUFJakJoRCxFQUFBQSxRQUFRLEVBQUU2QyxzQkFBVUMsSUFKSDtBQUtqQkosRUFBQUEsWUFBWSxFQUFFRyxzQkFBVUksSUFMUDtBQU1qQlIsRUFBQUEsYUFBYSxFQUFFSSxzQkFBVUksSUFOUjtBQU9qQkMsRUFBQUEsY0FBYyxFQUFFTCxzQkFBVUksSUFQVDtBQVFqQmhELEVBQUFBLFlBQVksRUFBRTRDLHNCQUFVSSxJQVJQO0FBU2pCZCxFQUFBQSxXQUFXLEVBQUVVLHNCQUFVSSxJQVROO0FBVWpCOUQsRUFBQUEsU0FBUyxFQUFFMEQsc0JBQVVNLE1BVko7QUFXakJyRCxFQUFBQSxTQUFTLEVBQUUrQyxzQkFBVUUsR0FYSjtBQVlqQnZELEVBQUFBLFVBQVUsRUFBRXFELHNCQUFVTSxNQVpMO0FBYWpCeEQsRUFBQUEsT0FBTyxFQUFFa0Qsc0JBQVVDLElBYkY7QUFjakJ0QixFQUFBQSxNQUFNLEVBQUVxQixzQkFBVUMsSUFkRDtBQWVqQjFELEVBQUFBLFFBQVEsRUFBRXlELHNCQUFVSSxJQWZIO0FBZ0JqQm5CLEVBQUFBLE1BQU0sRUFBRWUsc0JBQVVPLFNBQVYsQ0FBb0IsQ0FDMUJQLHNCQUFVUSxJQURnQixFQUUxQlIsc0JBQVVNLE1BRmdCLENBQXBCLENBaEJTO0FBb0JqQnZCLEVBQUFBLFNBQVMsRUFBRWlCLHNCQUFVSTtBQXBCSixDO2lDQURBMUUsWSxrQkF3Qkc7QUFDcEJ1RCxFQUFBQSxNQUFNLEVBQUU7QUFEWSxDO0FBeU14QnZELFlBQVksQ0FBQytFLFdBQWIsR0FBMkIsY0FBM0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgY2xvbmVFbGVtZW50LCBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBmaW5kRE9NTm9kZSB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHRvQXJyYXkgZnJvbSAnLi4vdXRpbC9DaGlsZHJlbi90b0FycmF5JztcbmltcG9ydCBNZW51IGZyb20gJy4uL21lbnUnO1xuaW1wb3J0IHNjcm9sbEludG9WaWV3IGZyb20gJ2RvbS1zY3JvbGwtaW50by12aWV3JztcbmltcG9ydCB7IGdldFNlbGVjdEtleXMsIHByZXZlbnREZWZhdWx0RXZlbnQsIHNhdmVSZWYgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IEZpbHRlcklucHV0IGZyb20gJy4vRmlsdGVySW5wdXQnO1xuaW1wb3J0IExvY2FsZVJlY2VpdmVyIGZyb20gJy4uLy4uL2xvY2FsZS1wcm92aWRlci9Mb2NhbGVSZWNlaXZlcic7XG5pbXBvcnQgZGVmYXVsdExvY2FsZSBmcm9tICcuLi8uLi9sb2NhbGUtcHJvdmlkZXIvZGVmYXVsdCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERyb3Bkb3duTWVudSBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZGVmYXVsdEFjdGl2ZUZpcnN0T3B0aW9uOiBQcm9wVHlwZXMuYm9vbCxcbiAgICB2YWx1ZTogUHJvcFR5cGVzLmFueSxcbiAgICBkcm9wZG93bk1lbnVTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtdWx0aXBsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgb25Qb3B1cEZvY3VzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvblBvcHVwU2Nyb2xsOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbk1lbnVEZVNlbGVjdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25NZW51U2VsZWN0OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbk1vdXNlRG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgcHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG1lbnVJdGVtczogUHJvcFR5cGVzLmFueSxcbiAgICBpbnB1dFZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHZpc2libGU6IFByb3BUeXBlcy5ib29sLFxuICAgIGZpbHRlcjogUHJvcFR5cGVzLmJvb2wsXG4gICAgY2hlY2tBbGw6IFByb3BUeXBlcy5mdW5jLFxuICAgIGZvb3RlcjogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICBQcm9wVHlwZXMubm9kZSxcbiAgICAgIFByb3BUeXBlcy5zdHJpbmcsXG4gICAgXSksXG4gICAgb25LZXlEb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGZvb3RlcjogbnVsbCxcbiAgfTtcblxuICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgdGhpcy5sYXN0SW5wdXRWYWx1ZSA9IHRoaXMucHJvcHMuaW5wdXRWYWx1ZTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuc2Nyb2xsQWN0aXZlSXRlbVRvVmlldygpO1xuICAgIHRoaXMubGFzdFZpc2libGUgPSB0aGlzLnByb3BzLnZpc2libGU7XG4gIH1cblxuICBzaG91bGRDb21wb25lbnRVcGRhdGUobmV4dFByb3BzKSB7XG4gICAgaWYgKCFuZXh0UHJvcHMudmlzaWJsZSkge1xuICAgICAgdGhpcy5sYXN0VmlzaWJsZSA9IGZhbHNlO1xuICAgIH1cbiAgICAvLyBmcmVlemUgd2hlbiBoaWRlXG4gICAgcmV0dXJuIG5leHRQcm9wcy52aXNpYmxlO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBpZiAoIXByZXZQcm9wcy52aXNpYmxlICYmIHByb3BzLnZpc2libGUpIHtcbiAgICAgIHRoaXMuc2Nyb2xsQWN0aXZlSXRlbVRvVmlldygpO1xuICAgIH1cbiAgICB0aGlzLmxhc3RWaXNpYmxlID0gcHJvcHMudmlzaWJsZTtcbiAgICB0aGlzLmxhc3RJbnB1dFZhbHVlID0gcHJvcHMuaW5wdXRWYWx1ZTtcbiAgfVxuXG4gIHNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXcgPSAoKSA9PiB7XG4gICAgLy8gc2Nyb2xsIGludG8gdmlld1xuICAgIGNvbnN0IGl0ZW1Db21wb25lbnQgPSBmaW5kRE9NTm9kZSh0aGlzLmZpcnN0QWN0aXZlSXRlbSk7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGl0ZW1Db21wb25lbnQpIHtcbiAgICAgIGNvbnN0IHNjcm9sbEludG9WaWV3T3B0cyA9IHtcbiAgICAgICAgb25seVNjcm9sbElmTmVlZGVkOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIGlmIChcbiAgICAgICAgKCFwcm9wcy52YWx1ZSB8fCBwcm9wcy52YWx1ZS5sZW5ndGggPT09IDApICYmXG4gICAgICAgIHByb3BzLmZpcnN0QWN0aXZlVmFsdWVcbiAgICAgICkge1xuICAgICAgICBzY3JvbGxJbnRvVmlld09wdHMuYWxpZ25XaXRoVG9wID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgc2Nyb2xsSW50b1ZpZXcoXG4gICAgICAgIGl0ZW1Db21wb25lbnQsXG4gICAgICAgIGZpbmRET01Ob2RlKHRoaXMubWVudVJlZiksXG4gICAgICAgIHNjcm9sbEludG9WaWV3T3B0cyxcbiAgICAgICk7XG4gICAgfVxuICB9O1xuXG4gIHJlbmRlck1lbnUoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHtcbiAgICAgIG1lbnVJdGVtcyxcbiAgICAgIHZhbHVlLFxuICAgICAgZGVmYXVsdEFjdGl2ZUZpcnN0T3B0aW9uLFxuICAgICAgcHJlZml4Q2xzLFxuICAgICAgbXVsdGlwbGUsXG4gICAgICBvbk1lbnVTZWxlY3QsXG4gICAgICBpbnB1dFZhbHVlLFxuICAgICAgZmlyc3RBY3RpdmVWYWx1ZSxcbiAgICAgIGJhY2tmaWxsVmFsdWUsXG4gICAgfSA9IHByb3BzO1xuXG4gICAgaWYgKG1lbnVJdGVtcyAmJiBtZW51SXRlbXMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBtZW51UHJvcHMgPSB7fTtcbiAgICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgICBtZW51UHJvcHMub25EZXNlbGVjdCA9IHByb3BzLm9uTWVudURlc2VsZWN0O1xuICAgICAgICBtZW51UHJvcHMub25TZWxlY3QgPSBvbk1lbnVTZWxlY3Q7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtZW51UHJvcHMub25DbGljayA9IG9uTWVudVNlbGVjdDtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2VsZWN0ZWRLZXlzID0gZ2V0U2VsZWN0S2V5cyhtZW51SXRlbXMsIHZhbHVlKTtcbiAgICAgIGNvbnN0IGFjdGl2ZUtleVByb3BzID0ge307XG5cbiAgICAgIGxldCBjbG9uZWRNZW51SXRlbXMgPSBtZW51SXRlbXM7XG4gICAgICBpZiAoc2VsZWN0ZWRLZXlzLmxlbmd0aCB8fCBmaXJzdEFjdGl2ZVZhbHVlKSB7XG4gICAgICAgIGlmIChwcm9wcy52aXNpYmxlICYmICF0aGlzLmxhc3RWaXNpYmxlKSB7XG4gICAgICAgICAgYWN0aXZlS2V5UHJvcHMuYWN0aXZlS2V5ID0gc2VsZWN0ZWRLZXlzWzBdIHx8IGZpcnN0QWN0aXZlVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGZvdW5kRmlyc3QgPSBmYWxzZTtcbiAgICAgICAgLy8gc2V0IGZpcnN0QWN0aXZlSXRlbSB2aWEgY2xvbmluZyBtZW51c1xuICAgICAgICAvLyBmb3Igc2Nyb2xsIGludG8gdmlld1xuICAgICAgICBjb25zdCBjbG9uZSA9IGl0ZW0gPT4ge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICghZm91bmRGaXJzdCAmJiBzZWxlY3RlZEtleXMuaW5kZXhPZihpdGVtLmtleSkgIT09IC0xKSB8fFxuICAgICAgICAgICAgKCFmb3VuZEZpcnN0ICYmXG4gICAgICAgICAgICAgICFzZWxlY3RlZEtleXMubGVuZ3RoICYmXG4gICAgICAgICAgICAgIGZpcnN0QWN0aXZlVmFsdWUuaW5kZXhPZihpdGVtLmtleSkgIT09IC0xKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgZm91bmRGaXJzdCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gY2xvbmVFbGVtZW50KGl0ZW0sIHtcbiAgICAgICAgICAgICAgcmVmOiByZWYgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlyc3RBY3RpdmVJdGVtID0gcmVmO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNsb25lZE1lbnVJdGVtcyA9IG1lbnVJdGVtcy5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgaWYgKGl0ZW0udHlwZS5pc01lbnVJdGVtR3JvdXApIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdG9BcnJheShpdGVtLnByb3BzLmNoaWxkcmVuKS5tYXAoY2xvbmUpO1xuICAgICAgICAgICAgcmV0dXJuIGNsb25lRWxlbWVudChpdGVtLCB7fSwgY2hpbGRyZW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gY2xvbmUoaXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBjbGVhciBhY3RpdmVLZXkgd2hlbiBpbnB1dFZhbHVlIGNoYW5nZVxuICAgICAgY29uc3QgbGFzdFZhbHVlID0gdmFsdWUgJiYgdmFsdWVbdmFsdWUubGVuZ3RoIC0gMV07XG4gICAgICBpZiAoaW5wdXRWYWx1ZSAhPT0gdGhpcy5sYXN0SW5wdXRWYWx1ZSAmJiAoIWxhc3RWYWx1ZSB8fCBsYXN0VmFsdWUgIT09IGJhY2tmaWxsVmFsdWUpKSB7XG4gICAgICAgIGFjdGl2ZUtleVByb3BzLmFjdGl2ZUtleSA9ICcnO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8TWVudVxuICAgICAgICAgIHJlZj17c2F2ZVJlZih0aGlzLCAnbWVudVJlZicpfVxuICAgICAgICAgIHN0eWxlPXt0aGlzLnByb3BzLmRyb3Bkb3duTWVudVN0eWxlfVxuICAgICAgICAgIGRlZmF1bHRBY3RpdmVGaXJzdD17ZGVmYXVsdEFjdGl2ZUZpcnN0T3B0aW9ufVxuICAgICAgICAgIHsuLi5hY3RpdmVLZXlQcm9wc31cbiAgICAgICAgICBtdWx0aXBsZT17bXVsdGlwbGV9XG4gICAgICAgICAgey4uLm1lbnVQcm9wc31cbiAgICAgICAgICBzZWxlY3RlZEtleXM9e3NlbGVjdGVkS2V5c31cbiAgICAgICAgICBwcmVmaXhDbHM9e2Ake3ByZWZpeENsc30tbWVudWB9XG4gICAgICAgID5cbiAgICAgICAgICB7Y2xvbmVkTWVudUl0ZW1zfVxuICAgICAgICA8L01lbnU+XG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJlbmRlckZpbHRlcklucHV0KCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBmaWx0ZXIsIHBsYWNlaG9sZGVyLCBvbkZpbHRlckNoYW5nZSwgZmlsdGVyVmFsdWUsIG9uS2V5RG93biB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBwcm9wcyA9IHtcbiAgICAgIGZpbHRlclZhbHVlLFxuICAgICAgcHJlZml4Q2xzLFxuICAgICAgcGxhY2Vob2xkZXIsXG4gICAgICBvbkNoYW5nZTogb25GaWx0ZXJDaGFuZ2UsXG4gICAgICBvbktleURvd246IG9uS2V5RG93bixcbiAgICB9O1xuICAgIHJldHVybiBmaWx0ZXIgPyA8RmlsdGVySW5wdXQgey4uLnByb3BzfSByZWY9e3NhdmVSZWYodGhpcywgJ2ZpbHRlclJlZicpfSAvPiA6IG51bGw7XG4gIH1cblxuICBnZXRGb290ZXIoKSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIGZvb3RlciB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gZm9vdGVyID8gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tZm9vdGVyYH0gb25Nb3VzZURvd249e3ByZXZlbnREZWZhdWx0RXZlbnR9PlxuICAgICAgICB7Zm9vdGVyfVxuICAgICAgPC9kaXY+KSA6IG51bGw7XG4gIH1cblxuICByZW5kZXJDaGVja0xhYmVsID0gKGxvY2FsZSkgPT4ge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBjaGVja0FsbCB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tc2VsZWN0LWFsbC1ub25lYH0+XG4gICAgICAgIDxzcGFuIG5hbWU9XCJjaGVjay1hbGxcIiBvbkNsaWNrPXtjaGVja0FsbH0+e2xvY2FsZS5zZWxlY3RBbGx9PC9zcGFuPlxuICAgICAgICA8c3BhbiBuYW1lPVwiY2hlY2stbm9uZVwiIG9uQ2xpY2s9e2NoZWNrQWxsfT57bG9jYWxlLnNlbGVjdE5vbmV9PC9zcGFuPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgcmVuZGVyTWVudSA9IHRoaXMucmVuZGVyTWVudSgpO1xuICAgIGNvbnN0IGZpbHRlcklucHV0ID0gdGhpcy5yZW5kZXJGaWx0ZXJJbnB1dCgpO1xuICAgIGNvbnN0IHsgbXVsdGlwbGUsIG1lbnVJdGVtcywgY2hlY2tBbGwsIG9uTW91c2VEb3duIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgbGV0IHNlbGVjdE9wdCA9IG51bGw7XG4gICAgaWYgKGNoZWNrQWxsICYmIG11bHRpcGxlICYmIG1lbnVJdGVtcy5sZW5ndGggJiYgbWVudUl0ZW1zWzBdLmtleSAhPT0gJ05PVF9GT1VORCcpIHtcbiAgICAgIHNlbGVjdE9wdCA9IChcbiAgICAgICAgPExvY2FsZVJlY2VpdmVyXG4gICAgICAgICAgY29tcG9uZW50TmFtZT1cIlNlbGVjdFwiXG4gICAgICAgICAgZGVmYXVsdExvY2FsZT17ZGVmYXVsdExvY2FsZS5TZWxlY3R9XG4gICAgICAgID5cbiAgICAgICAgICB7dGhpcy5yZW5kZXJDaGVja0xhYmVsfVxuICAgICAgICA8L0xvY2FsZVJlY2VpdmVyPlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgb25Nb3VzZURvd249e29uTW91c2VEb3dufT5cbiAgICAgICAge2ZpbHRlcklucHV0fVxuICAgICAgICB7c2VsZWN0T3B0fVxuICAgICAgICA8ZGl2XG4gICAgICAgICAgc3R5bGU9e3sgb3ZlcmZsb3c6ICdhdXRvJyB9fVxuICAgICAgICAgIG9uU2Nyb2xsPXt0aGlzLnByb3BzLm9uUG9wdXBTY3JvbGx9XG4gICAgICAgICAgb25Gb2N1cz17dGhpcy5wcm9wcy5vblBvcHVwRm9jdXN9XG4gICAgICAgID5cbiAgICAgICAgICB7cmVuZGVyTWVudX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIHt0aGlzLmdldEZvb3RlcigpfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5Ecm9wZG93bk1lbnUuZGlzcGxheU5hbWUgPSAnRHJvcGRvd25NZW51JztcbiJdfQ==