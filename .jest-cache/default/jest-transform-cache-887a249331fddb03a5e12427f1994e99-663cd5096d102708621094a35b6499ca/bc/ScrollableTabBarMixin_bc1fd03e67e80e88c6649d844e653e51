a7ee2f7c328f36e9ae87343b898c6163
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classnames5 = _interopRequireDefault(require("classnames"));

var _utils = require("./utils");

var _react = _interopRequireDefault(require("react"));

var _addEventListener = _interopRequireDefault(require("../../_util/addEventListener"));

var _debounce = _interopRequireDefault(require("lodash/debounce"));

var _default = {
  getDefaultProps: function getDefaultProps() {
    return {
      scrollAnimated: true,
      onPrevClick: function onPrevClick() {},
      onNextClick: function onNextClick() {}
    };
  },
  getInitialState: function getInitialState() {
    this.offset = 0;
    return {
      next: false,
      prev: false
    };
  },
  componentDidMount: function componentDidMount() {
    var _this = this;

    this.componentDidUpdate();
    this.debouncedResize = (0, _debounce["default"])(function () {
      _this.setNextPrev();

      _this.scrollToActiveTab();
    }, 200);
    this.resizeEvent = (0, _addEventListener["default"])(window, 'resize', this.debouncedResize);
  },
  componentDidUpdate: function componentDidUpdate(prevProps) {
    var props = this.props;

    if (prevProps && prevProps.tabBarPosition !== props.tabBarPosition) {
      this.setOffset(0);
      return;
    }

    var nextPrev = this.setNextPrev(); // wait next, prev show hide

    /* eslint react/no-did-update-set-state:0 */

    if (this.isNextPrevShown(this.state) !== this.isNextPrevShown(nextPrev)) {
      this.setState({}, this.scrollToActiveTab);
    } else if (!prevProps || props.activeKey !== prevProps.activeKey) {
      // can not use props.activeKey
      this.scrollToActiveTab();
    }
  },
  componentWillUnmount: function componentWillUnmount() {
    if (this.resizeEvent) {
      this.resizeEvent.remove();
    }

    if (this.debouncedResize && this.debouncedResize.cancel) {
      this.debouncedResize.cancel();
    }
  },
  setNextPrev: function setNextPrev() {
    var navNode = this.nav;
    var navNodeWH = this.getScrollWH(navNode);
    var containerWH = this.getOffsetWH(this.container);
    var navWrapNodeWH = this.getOffsetWH(this.navWrap);
    var offset = this.offset;
    var minOffset = containerWH - navNodeWH;
    var _this$state = this.state,
        next = _this$state.next,
        prev = _this$state.prev;

    if (minOffset >= 0) {
      next = false;
      this.setOffset(0, false);
      offset = 0;
    } else if (minOffset < offset) {
      next = true;
    } else {
      next = false; // Test with container offset which is stable
      // and set the offset of the nav wrap node

      var realOffset = navWrapNodeWH - navNodeWH;
      this.setOffset(realOffset, false);
      offset = realOffset;
    }

    if (offset < 0) {
      prev = true;
    } else {
      prev = false;
    }

    this.setNext(next);
    this.setPrev(prev);
    return {
      next: next,
      prev: prev
    };
  },
  getOffsetWH: function getOffsetWH(node) {
    var tabBarPosition = this.props.tabBarPosition;
    var prop = 'offsetWidth';

    if (tabBarPosition === 'left' || tabBarPosition === 'right') {
      prop = 'offsetHeight';
    }

    return node[prop];
  },
  getScrollWH: function getScrollWH(node) {
    var tabBarPosition = this.props.tabBarPosition;
    var prop = 'scrollWidth';

    if (tabBarPosition === 'left' || tabBarPosition === 'right') {
      prop = 'scrollHeight';
    }

    return node[prop];
  },
  getOffsetLT: function getOffsetLT(node) {
    var tabBarPosition = this.props.tabBarPosition;
    var prop = 'left';

    if (tabBarPosition === 'left' || tabBarPosition === 'right') {
      prop = 'top';
    }

    return node.getBoundingClientRect()[prop];
  },
  setOffset: function setOffset(offset) {
    var checkNextPrev = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
    var target = Math.min(0, offset);

    if (this.offset !== target) {
      this.offset = target;
      var navOffset = {};
      var tabBarPosition = this.props.tabBarPosition;
      var navStyle = this.nav.style;
      var transformSupported = (0, _utils.isTransformSupported)(navStyle);

      if (tabBarPosition === 'left' || tabBarPosition === 'right') {
        if (transformSupported) {
          navOffset = {
            value: "translate3d(0,".concat(target, "px,0)")
          };
        } else {
          navOffset = {
            name: 'top',
            value: "".concat(target, "px")
          };
        }
      } else {
        if (transformSupported) {
          navOffset = {
            value: "translate3d(".concat(target, "px,0,0)")
          };
        } else {
          navOffset = {
            name: 'left',
            value: "".concat(target, "px")
          };
        }
      }

      if (transformSupported) {
        (0, _utils.setTransform)(navStyle, navOffset.value);
      } else {
        navStyle[navOffset.name] = navOffset.value;
      }

      if (checkNextPrev) {
        this.setNextPrev();
      }
    }
  },
  setPrev: function setPrev(v) {
    if (this.state.prev !== v) {
      this.setState({
        prev: v
      });
    }
  },
  setNext: function setNext(v) {
    if (this.state.next !== v) {
      this.setState({
        next: v
      });
    }
  },
  isNextPrevShown: function isNextPrevShown(state) {
    if (state) {
      return state.next || state.prev;
    }

    return this.state.next || this.state.prev;
  },
  prevTransitionEnd: function prevTransitionEnd(e) {
    if (e.propertyName !== 'opacity') {
      return;
    }

    var container = this.container;
    this.scrollToActiveTab({
      target: container,
      currentTarget: container
    });
  },
  scrollToActiveTab: function scrollToActiveTab(e) {
    var activeTab = this.activeTab,
        navWrap = this.navWrap;

    if (e && e.target !== e.currentTarget || !activeTab) {
      return;
    } // when not scrollable or enter scrollable first time, don't emit scrolling


    var needToSroll = this.isNextPrevShown() && this.lastNextPrevShown;
    this.lastNextPrevShown = this.isNextPrevShown();

    if (!needToSroll) {
      return;
    }

    var activeTabWH = this.getScrollWH(activeTab);
    var navWrapNodeWH = this.getOffsetWH(navWrap);
    var offset = this.offset;
    var wrapOffset = this.getOffsetLT(navWrap);
    var activeTabOffset = this.getOffsetLT(activeTab);

    if (wrapOffset > activeTabOffset) {
      offset += wrapOffset - activeTabOffset;
      this.setOffset(offset);
    } else if (wrapOffset + navWrapNodeWH < activeTabOffset + activeTabWH) {
      offset -= activeTabOffset + activeTabWH - (wrapOffset + navWrapNodeWH);
      this.setOffset(offset);
    }
  },
  prev: function prev(e) {
    this.props.onPrevClick(e);
    var navWrapNode = this.navWrap;
    var navWrapNodeWH = this.getOffsetWH(navWrapNode);
    var offset = this.offset;
    this.setOffset(offset + navWrapNodeWH);
  },
  next: function next(e) {
    this.props.onNextClick(e);
    var navWrapNode = this.navWrap;
    var navWrapNodeWH = this.getOffsetWH(navWrapNode);
    var offset = this.offset;
    this.setOffset(offset - navWrapNodeWH);
  },
  getScrollBarNode: function getScrollBarNode(content) {
    var _classnames, _classnames2, _classnames3, _classnames4;

    var _this$state2 = this.state,
        next = _this$state2.next,
        prev = _this$state2.prev;
    var _this$props = this.props,
        prefixCls = _this$props.prefixCls,
        scrollAnimated = _this$props.scrollAnimated;
    var showNextPrev = prev || next;

    var prevButton = _react["default"].createElement("span", {
      onClick: prev ? this.prev : null,
      unselectable: "unselectable",
      className: (0, _classnames5["default"])((_classnames = {}, (0, _defineProperty2["default"])(_classnames, "".concat(prefixCls, "-tab-prev"), 1), (0, _defineProperty2["default"])(_classnames, "".concat(prefixCls, "-tab-btn-disabled"), !prev), (0, _defineProperty2["default"])(_classnames, "".concat(prefixCls, "-tab-arrow-show"), showNextPrev), _classnames)),
      onTransitionEnd: this.prevTransitionEnd
    }, _react["default"].createElement("span", {
      className: "".concat(prefixCls, "-tab-prev-icon")
    }));

    var nextButton = _react["default"].createElement("span", {
      onClick: next ? this.next : null,
      unselectable: "unselectable",
      className: (0, _classnames5["default"])((_classnames2 = {}, (0, _defineProperty2["default"])(_classnames2, "".concat(prefixCls, "-tab-next"), 1), (0, _defineProperty2["default"])(_classnames2, "".concat(prefixCls, "-tab-btn-disabled"), !next), (0, _defineProperty2["default"])(_classnames2, "".concat(prefixCls, "-tab-arrow-show"), showNextPrev), _classnames2))
    }, _react["default"].createElement("span", {
      className: "".concat(prefixCls, "-tab-next-icon")
    }));

    var navClassName = "".concat(prefixCls, "-nav");
    var navClasses = (0, _classnames5["default"])((_classnames3 = {}, (0, _defineProperty2["default"])(_classnames3, navClassName, true), (0, _defineProperty2["default"])(_classnames3, scrollAnimated ? "".concat(navClassName, "-animated") : "".concat(navClassName, "-no-animated"), true), _classnames3));
    return _react["default"].createElement("div", {
      className: (0, _classnames5["default"])((_classnames4 = {}, (0, _defineProperty2["default"])(_classnames4, "".concat(prefixCls, "-nav-container"), 1), (0, _defineProperty2["default"])(_classnames4, "".concat(prefixCls, "-nav-container-scrolling"), showNextPrev), _classnames4)),
      key: "container",
      ref: this.saveRef('container')
    }, prevButton, nextButton, _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-nav-wrap"),
      ref: this.saveRef('navWrap')
    }, _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-nav-scroll")
    }, _react["default"].createElement("div", {
      className: navClasses,
      ref: this.saveRef('nav')
    }, content))));
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhYnMvU2Nyb2xsYWJsZVRhYkJhck1peGluLmpzeCJdLCJuYW1lcyI6WyJnZXREZWZhdWx0UHJvcHMiLCJzY3JvbGxBbmltYXRlZCIsIm9uUHJldkNsaWNrIiwib25OZXh0Q2xpY2siLCJnZXRJbml0aWFsU3RhdGUiLCJuZXh0IiwicHJldiIsImNvbXBvbmVudERpZE1vdW50IiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJvcHMiLCJwcmV2UHJvcHMiLCJuZXh0UHJldiIsImNvbXBvbmVudFdpbGxVbm1vdW50Iiwic2V0TmV4dFByZXYiLCJuYXZOb2RlIiwibmF2Tm9kZVdIIiwiY29udGFpbmVyV0giLCJuYXZXcmFwTm9kZVdIIiwib2Zmc2V0IiwibWluT2Zmc2V0IiwicmVhbE9mZnNldCIsImdldE9mZnNldFdIIiwidGFiQmFyUG9zaXRpb24iLCJwcm9wIiwibm9kZSIsImdldFNjcm9sbFdIIiwiZ2V0T2Zmc2V0TFQiLCJzZXRPZmZzZXQiLCJjaGVja05leHRQcmV2IiwidGFyZ2V0IiwiTWF0aCIsIm5hdk9mZnNldCIsIm5hdlN0eWxlIiwidHJhbnNmb3JtU3VwcG9ydGVkIiwidmFsdWUiLCJuYW1lIiwic2V0UHJldiIsInYiLCJzZXROZXh0IiwiaXNOZXh0UHJldlNob3duIiwic3RhdGUiLCJwcmV2VHJhbnNpdGlvbkVuZCIsImUiLCJjb250YWluZXIiLCJjdXJyZW50VGFyZ2V0Iiwic2Nyb2xsVG9BY3RpdmVUYWIiLCJhY3RpdmVUYWIiLCJuYXZXcmFwIiwibmVlZFRvU3JvbGwiLCJhY3RpdmVUYWJXSCIsIndyYXBPZmZzZXQiLCJhY3RpdmVUYWJPZmZzZXQiLCJuYXZXcmFwTm9kZSIsImdldFNjcm9sbEJhck5vZGUiLCJwcmVmaXhDbHMiLCJzaG93TmV4dFByZXYiLCJwcmV2QnV0dG9uIiwibmV4dEJ1dHRvbiIsIm5hdkNsYXNzTmFtZSIsIm5hdkNsYXNzZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxZQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQTs7QUFDQSxJQUFBLE1BQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLGlCQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsOEJBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGlCQUFBLENBQUEsQ0FBQTs7ZUFFZTtBQUNiQSxFQUFBQSxlQURhLEVBQUEsU0FBQSxlQUFBLEdBQ0s7QUFDaEIsV0FBTztBQUNMQyxNQUFBQSxjQUFjLEVBRFQsSUFBQTtBQUVMQyxNQUFBQSxXQUZLLEVBQUEsU0FBQSxXQUFBLEdBRVMsQ0FGVCxDQUFBO0FBR0xDLE1BQUFBLFdBSEssRUFBQSxTQUFBLFdBQUEsR0FHUyxDQUFFO0FBSFgsS0FBUDtBQUZXLEdBQUE7QUFTYkMsRUFBQUEsZUFUYSxFQUFBLFNBQUEsZUFBQSxHQVNLO0FBQ2hCLFNBQUEsTUFBQSxHQUFBLENBQUE7QUFDQSxXQUFPO0FBQ0xDLE1BQUFBLElBQUksRUFEQyxLQUFBO0FBRUxDLE1BQUFBLElBQUksRUFBRTtBQUZELEtBQVA7QUFYVyxHQUFBO0FBaUJiQyxFQUFBQSxpQkFqQmEsRUFBQSxTQUFBLGlCQUFBLEdBaUJPO0FBQUEsUUFBQSxLQUFBLEdBQUEsSUFBQTs7QUFDbEIsU0FBQSxrQkFBQTtBQUNBLFNBQUEsZUFBQSxHQUF1QixDQUFBLEdBQUEsU0FBQSxDQUFBLFNBQUEsQ0FBQSxFQUFTLFlBQU07QUFDcEMsTUFBQSxLQUFJLENBQUosV0FBQTs7QUFDQSxNQUFBLEtBQUksQ0FBSixpQkFBQTtBQUZxQixLQUFBLEVBQXZCLEdBQXVCLENBQXZCO0FBSUEsU0FBQSxXQUFBLEdBQW1CLENBQUEsR0FBQSxpQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLE1BQUEsRUFBQSxRQUFBLEVBQW1DLEtBQXRELGVBQW1CLENBQW5CO0FBdkJXLEdBQUE7QUEwQmJDLEVBQUFBLGtCQTFCYSxFQUFBLFNBQUEsa0JBQUEsQ0FBQSxTQUFBLEVBMEJpQjtBQUM1QixRQUFNQyxLQUFLLEdBQUcsS0FBZCxLQUFBOztBQUNBLFFBQUlDLFNBQVMsSUFBSUEsU0FBUyxDQUFUQSxjQUFBQSxLQUE2QkQsS0FBSyxDQUFuRCxjQUFBLEVBQW9FO0FBQ2xFLFdBQUEsU0FBQSxDQUFBLENBQUE7QUFDQTtBQUNEOztBQUNELFFBQU1FLFFBQVEsR0FBRyxLQU5XLFdBTVgsRUFBakIsQ0FONEIsQ0FPNUI7O0FBQ0E7O0FBQ0EsUUFBSSxLQUFBLGVBQUEsQ0FBcUIsS0FBckIsS0FBQSxNQUFxQyxLQUFBLGVBQUEsQ0FBekMsUUFBeUMsQ0FBekMsRUFBeUU7QUFDdkUsV0FBQSxRQUFBLENBQUEsRUFBQSxFQUFrQixLQUFsQixpQkFBQTtBQURGLEtBQUEsTUFFTyxJQUFJLENBQUEsU0FBQSxJQUFjRixLQUFLLENBQUxBLFNBQUFBLEtBQW9CQyxTQUFTLENBQS9DLFNBQUEsRUFBMkQ7QUFDaEU7QUFDQSxXQUFBLGlCQUFBO0FBQ0Q7QUF4Q1UsR0FBQTtBQTJDYkUsRUFBQUEsb0JBM0NhLEVBQUEsU0FBQSxvQkFBQSxHQTJDVTtBQUNyQixRQUFJLEtBQUosV0FBQSxFQUFzQjtBQUNwQixXQUFBLFdBQUEsQ0FBQSxNQUFBO0FBQ0Q7O0FBQ0QsUUFBSSxLQUFBLGVBQUEsSUFBd0IsS0FBQSxlQUFBLENBQTVCLE1BQUEsRUFBeUQ7QUFDdkQsV0FBQSxlQUFBLENBQUEsTUFBQTtBQUNEO0FBakRVLEdBQUE7QUFvRGJDLEVBQUFBLFdBcERhLEVBQUEsU0FBQSxXQUFBLEdBb0RDO0FBQ1osUUFBTUMsT0FBTyxHQUFHLEtBQWhCLEdBQUE7QUFDQSxRQUFNQyxTQUFTLEdBQUcsS0FBQSxXQUFBLENBQWxCLE9BQWtCLENBQWxCO0FBQ0EsUUFBTUMsV0FBVyxHQUFHLEtBQUEsV0FBQSxDQUFpQixLQUFyQyxTQUFvQixDQUFwQjtBQUNBLFFBQU1DLGFBQWEsR0FBRyxLQUFBLFdBQUEsQ0FBaUIsS0FBdkMsT0FBc0IsQ0FBdEI7QUFKWSxRQUtOQyxNQUxNLEdBQUEsS0FBQSxNQUFBO0FBTVosUUFBTUMsU0FBUyxHQUFHSCxXQUFXLEdBQTdCLFNBQUE7QUFOWSxRQUFBLFdBQUEsR0FPUyxLQVBULEtBQUE7QUFBQSxRQU9OWCxJQVBNLEdBQUEsV0FBQSxDQUFBLElBQUE7QUFBQSxRQU9BQyxJQVBBLEdBQUEsV0FBQSxDQUFBLElBQUE7O0FBUVosUUFBSWEsU0FBUyxJQUFiLENBQUEsRUFBb0I7QUFDbEJkLE1BQUFBLElBQUksR0FBSkEsS0FBQUE7QUFDQSxXQUFBLFNBQUEsQ0FBQSxDQUFBLEVBQUEsS0FBQTtBQUNBYSxNQUFBQSxNQUFNLEdBQU5BLENBQUFBO0FBSEYsS0FBQSxNQUlPLElBQUlDLFNBQVMsR0FBYixNQUFBLEVBQXdCO0FBQzdCZCxNQUFBQSxJQUFJLEdBQUpBLElBQUFBO0FBREssS0FBQSxNQUVBO0FBQ0xBLE1BQUFBLElBQUksR0FEQyxLQUNMQSxDQURLLENBRUw7QUFDQTs7QUFDQSxVQUFNZSxVQUFVLEdBQUdILGFBQWEsR0FBaEMsU0FBQTtBQUNBLFdBQUEsU0FBQSxDQUFBLFVBQUEsRUFBQSxLQUFBO0FBQ0FDLE1BQUFBLE1BQU0sR0FBTkEsVUFBQUE7QUFDRDs7QUFFRCxRQUFJQSxNQUFNLEdBQVYsQ0FBQSxFQUFnQjtBQUNkWixNQUFBQSxJQUFJLEdBQUpBLElBQUFBO0FBREYsS0FBQSxNQUVPO0FBQ0xBLE1BQUFBLElBQUksR0FBSkEsS0FBQUE7QUFDRDs7QUFFRCxTQUFBLE9BQUEsQ0FBQSxJQUFBO0FBQ0EsU0FBQSxPQUFBLENBQUEsSUFBQTtBQUNBLFdBQU87QUFDTEQsTUFBQUEsSUFBSSxFQURDLElBQUE7QUFFTEMsTUFBQUEsSUFBSSxFQUFKQTtBQUZLLEtBQVA7QUFuRlcsR0FBQTtBQXlGYmUsRUFBQUEsV0F6RmEsRUFBQSxTQUFBLFdBQUEsQ0FBQSxJQUFBLEVBeUZLO0FBQ2hCLFFBQU1DLGNBQWMsR0FBRyxLQUFBLEtBQUEsQ0FBdkIsY0FBQTtBQUNBLFFBQUlDLElBQUksR0FBUixhQUFBOztBQUNBLFFBQUlELGNBQWMsS0FBZEEsTUFBQUEsSUFBNkJBLGNBQWMsS0FBL0MsT0FBQSxFQUE2RDtBQUMzREMsTUFBQUEsSUFBSSxHQUFKQSxjQUFBQTtBQUNEOztBQUNELFdBQU9DLElBQUksQ0FBWCxJQUFXLENBQVg7QUEvRlcsR0FBQTtBQWtHYkMsRUFBQUEsV0FsR2EsRUFBQSxTQUFBLFdBQUEsQ0FBQSxJQUFBLEVBa0dLO0FBQ2hCLFFBQU1ILGNBQWMsR0FBRyxLQUFBLEtBQUEsQ0FBdkIsY0FBQTtBQUNBLFFBQUlDLElBQUksR0FBUixhQUFBOztBQUNBLFFBQUlELGNBQWMsS0FBZEEsTUFBQUEsSUFBNkJBLGNBQWMsS0FBL0MsT0FBQSxFQUE2RDtBQUMzREMsTUFBQUEsSUFBSSxHQUFKQSxjQUFBQTtBQUNEOztBQUNELFdBQU9DLElBQUksQ0FBWCxJQUFXLENBQVg7QUF4R1csR0FBQTtBQTRHYkUsRUFBQUEsV0E1R2EsRUFBQSxTQUFBLFdBQUEsQ0FBQSxJQUFBLEVBNEdLO0FBQ2hCLFFBQU1KLGNBQWMsR0FBRyxLQUFBLEtBQUEsQ0FBdkIsY0FBQTtBQUNBLFFBQUlDLElBQUksR0FBUixNQUFBOztBQUNBLFFBQUlELGNBQWMsS0FBZEEsTUFBQUEsSUFBNkJBLGNBQWMsS0FBL0MsT0FBQSxFQUE2RDtBQUMzREMsTUFBQUEsSUFBSSxHQUFKQSxLQUFBQTtBQUNEOztBQUNELFdBQU9DLElBQUksQ0FBSkEscUJBQUFBLEdBQVAsSUFBT0EsQ0FBUDtBQWxIVyxHQUFBO0FBcUhiRyxFQUFBQSxTQXJIYSxFQUFBLFNBQUEsU0FBQSxDQUFBLE1BQUEsRUFxSDJCO0FBQUEsUUFBdEJDLGFBQXNCLEdBQUEsU0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLElBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLFNBQUEsR0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLEdBQU4sSUFBTTtBQUN0QyxRQUFNQyxNQUFNLEdBQUdDLElBQUksQ0FBSkEsR0FBQUEsQ0FBQUEsQ0FBQUEsRUFBZixNQUFlQSxDQUFmOztBQUNBLFFBQUksS0FBQSxNQUFBLEtBQUosTUFBQSxFQUE0QjtBQUMxQixXQUFBLE1BQUEsR0FBQSxNQUFBO0FBQ0EsVUFBSUMsU0FBUyxHQUFiLEVBQUE7QUFDQSxVQUFNVCxjQUFjLEdBQUcsS0FBQSxLQUFBLENBQXZCLGNBQUE7QUFDQSxVQUFNVSxRQUFRLEdBQUcsS0FBQSxHQUFBLENBQWpCLEtBQUE7QUFDQSxVQUFNQyxrQkFBa0IsR0FBRyxDQUFBLEdBQUEsTUFBQSxDQUFBLG9CQUFBLEVBQTNCLFFBQTJCLENBQTNCOztBQUNBLFVBQUlYLGNBQWMsS0FBZEEsTUFBQUEsSUFBNkJBLGNBQWMsS0FBL0MsT0FBQSxFQUE2RDtBQUMzRCxZQUFBLGtCQUFBLEVBQXdCO0FBQ3RCUyxVQUFBQSxTQUFTLEdBQUc7QUFDVkcsWUFBQUEsS0FBSyxFQUFBLGlCQUFBLE1BQUEsQ0FBQSxNQUFBLEVBQUEsT0FBQTtBQURLLFdBQVpIO0FBREYsU0FBQSxNQUlPO0FBQ0xBLFVBQUFBLFNBQVMsR0FBRztBQUNWSSxZQUFBQSxJQUFJLEVBRE0sS0FBQTtBQUVWRCxZQUFBQSxLQUFLLEVBQUEsR0FBQSxNQUFBLENBQUEsTUFBQSxFQUFBLElBQUE7QUFGSyxXQUFaSDtBQUlEO0FBVkgsT0FBQSxNQVdPO0FBQ0wsWUFBQSxrQkFBQSxFQUF3QjtBQUN0QkEsVUFBQUEsU0FBUyxHQUFHO0FBQ1ZHLFlBQUFBLEtBQUssRUFBQSxlQUFBLE1BQUEsQ0FBQSxNQUFBLEVBQUEsU0FBQTtBQURLLFdBQVpIO0FBREYsU0FBQSxNQUlPO0FBQ0xBLFVBQUFBLFNBQVMsR0FBRztBQUNWSSxZQUFBQSxJQUFJLEVBRE0sTUFBQTtBQUVWRCxZQUFBQSxLQUFLLEVBQUEsR0FBQSxNQUFBLENBQUEsTUFBQSxFQUFBLElBQUE7QUFGSyxXQUFaSDtBQUlEO0FBQ0Y7O0FBQ0QsVUFBQSxrQkFBQSxFQUF3QjtBQUN0QixTQUFBLEdBQUEsTUFBQSxDQUFBLFlBQUEsRUFBQSxRQUFBLEVBQXVCQSxTQUFTLENBQWhDLEtBQUE7QUFERixPQUFBLE1BRU87QUFDTEMsUUFBQUEsUUFBUSxDQUFDRCxTQUFTLENBQWxCQyxJQUFRLENBQVJBLEdBQTJCRCxTQUFTLENBQXBDQyxLQUFBQTtBQUNEOztBQUNELFVBQUEsYUFBQSxFQUFtQjtBQUNqQixhQUFBLFdBQUE7QUFDRDtBQUNGO0FBNUpVLEdBQUE7QUErSmJJLEVBQUFBLE9BL0phLEVBQUEsU0FBQSxPQUFBLENBQUEsQ0FBQSxFQStKRjtBQUNULFFBQUksS0FBQSxLQUFBLENBQUEsSUFBQSxLQUFKLENBQUEsRUFBMkI7QUFDekIsV0FBQSxRQUFBLENBQWM7QUFDWjlCLFFBQUFBLElBQUksRUFBRStCO0FBRE0sT0FBZDtBQUdEO0FBcEtVLEdBQUE7QUF1S2JDLEVBQUFBLE9BdkthLEVBQUEsU0FBQSxPQUFBLENBQUEsQ0FBQSxFQXVLRjtBQUNULFFBQUksS0FBQSxLQUFBLENBQUEsSUFBQSxLQUFKLENBQUEsRUFBMkI7QUFDekIsV0FBQSxRQUFBLENBQWM7QUFDWmpDLFFBQUFBLElBQUksRUFBRWdDO0FBRE0sT0FBZDtBQUdEO0FBNUtVLEdBQUE7QUErS2JFLEVBQUFBLGVBL0thLEVBQUEsU0FBQSxlQUFBLENBQUEsS0FBQSxFQStLVTtBQUNyQixRQUFBLEtBQUEsRUFBVztBQUNULGFBQU9DLEtBQUssQ0FBTEEsSUFBQUEsSUFBY0EsS0FBSyxDQUExQixJQUFBO0FBQ0Q7O0FBQ0QsV0FBTyxLQUFBLEtBQUEsQ0FBQSxJQUFBLElBQW1CLEtBQUEsS0FBQSxDQUExQixJQUFBO0FBbkxXLEdBQUE7QUFzTGJDLEVBQUFBLGlCQXRMYSxFQUFBLFNBQUEsaUJBQUEsQ0FBQSxDQUFBLEVBc0xRO0FBQ25CLFFBQUlDLENBQUMsQ0FBREEsWUFBQUEsS0FBSixTQUFBLEVBQWtDO0FBQ2hDO0FBQ0Q7O0FBSGtCLFFBSVhDLFNBSlcsR0FBQSxLQUFBLFNBQUE7QUFLbkIsU0FBQSxpQkFBQSxDQUF1QjtBQUNyQmQsTUFBQUEsTUFBTSxFQURlLFNBQUE7QUFFckJlLE1BQUFBLGFBQWEsRUFBRUQ7QUFGTSxLQUF2QjtBQTNMVyxHQUFBO0FBaU1iRSxFQUFBQSxpQkFqTWEsRUFBQSxTQUFBLGlCQUFBLENBQUEsQ0FBQSxFQWlNUTtBQUFBLFFBQ1hDLFNBRFcsR0FBQSxLQUFBLFNBQUE7QUFBQSxRQUNBQyxPQURBLEdBQUEsS0FBQSxPQUFBOztBQUVuQixRQUFJTCxDQUFDLElBQUlBLENBQUMsQ0FBREEsTUFBQUEsS0FBYUEsQ0FBQyxDQUFuQkEsYUFBQUEsSUFBcUMsQ0FBekMsU0FBQSxFQUFxRDtBQUNuRDtBQUhpQixLQUFBLENBTW5COzs7QUFDQSxRQUFNTSxXQUFXLEdBQUcsS0FBQSxlQUFBLE1BQTBCLEtBQTlDLGlCQUFBO0FBQ0EsU0FBQSxpQkFBQSxHQUF5QixLQUF6QixlQUF5QixFQUF6Qjs7QUFDQSxRQUFJLENBQUosV0FBQSxFQUFrQjtBQUNoQjtBQUNEOztBQUVELFFBQU1DLFdBQVcsR0FBRyxLQUFBLFdBQUEsQ0FBcEIsU0FBb0IsQ0FBcEI7QUFDQSxRQUFNaEMsYUFBYSxHQUFHLEtBQUEsV0FBQSxDQUF0QixPQUFzQixDQUF0QjtBQWRtQixRQWViQyxNQWZhLEdBQUEsS0FBQSxNQUFBO0FBZ0JuQixRQUFNZ0MsVUFBVSxHQUFHLEtBQUEsV0FBQSxDQUFuQixPQUFtQixDQUFuQjtBQUNBLFFBQU1DLGVBQWUsR0FBRyxLQUFBLFdBQUEsQ0FBeEIsU0FBd0IsQ0FBeEI7O0FBQ0EsUUFBSUQsVUFBVSxHQUFkLGVBQUEsRUFBa0M7QUFDaENoQyxNQUFBQSxNQUFNLElBQUtnQyxVQUFVLEdBQXJCaEMsZUFBQUE7QUFDQSxXQUFBLFNBQUEsQ0FBQSxNQUFBO0FBRkYsS0FBQSxNQUdPLElBQUtnQyxVQUFVLEdBQVgsYUFBQ0EsR0FBK0JDLGVBQWUsR0FBbkQsV0FBQSxFQUFvRTtBQUN6RWpDLE1BQUFBLE1BQU0sSUFBS2lDLGVBQWUsR0FBaEIsV0FBQ0EsSUFBa0NELFVBQVUsR0FBdkRoQyxhQUFXaUMsQ0FBWGpDO0FBQ0EsV0FBQSxTQUFBLENBQUEsTUFBQTtBQUNEO0FBek5VLEdBQUE7QUE0TmJaLEVBQUFBLElBNU5hLEVBQUEsU0FBQSxJQUFBLENBQUEsQ0FBQSxFQTROTDtBQUNOLFNBQUEsS0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBO0FBQ0EsUUFBTThDLFdBQVcsR0FBRyxLQUFwQixPQUFBO0FBQ0EsUUFBTW5DLGFBQWEsR0FBRyxLQUFBLFdBQUEsQ0FBdEIsV0FBc0IsQ0FBdEI7QUFITSxRQUlFQyxNQUpGLEdBQUEsS0FBQSxNQUFBO0FBS04sU0FBQSxTQUFBLENBQWVBLE1BQU0sR0FBckIsYUFBQTtBQWpPVyxHQUFBO0FBb09iYixFQUFBQSxJQXBPYSxFQUFBLFNBQUEsSUFBQSxDQUFBLENBQUEsRUFvT0w7QUFDTixTQUFBLEtBQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQTtBQUNBLFFBQU0rQyxXQUFXLEdBQUcsS0FBcEIsT0FBQTtBQUNBLFFBQU1uQyxhQUFhLEdBQUcsS0FBQSxXQUFBLENBQXRCLFdBQXNCLENBQXRCO0FBSE0sUUFJRUMsTUFKRixHQUFBLEtBQUEsTUFBQTtBQUtOLFNBQUEsU0FBQSxDQUFlQSxNQUFNLEdBQXJCLGFBQUE7QUF6T1csR0FBQTtBQTRPYm1DLEVBQUFBLGdCQTVPYSxFQUFBLFNBQUEsZ0JBQUEsQ0FBQSxPQUFBLEVBNE9hO0FBQUEsUUFBQSxXQUFBLEVBQUEsWUFBQSxFQUFBLFlBQUEsRUFBQSxZQUFBOztBQUFBLFFBQUEsWUFBQSxHQUNELEtBREMsS0FBQTtBQUFBLFFBQ2hCaEQsSUFEZ0IsR0FBQSxZQUFBLENBQUEsSUFBQTtBQUFBLFFBQ1ZDLElBRFUsR0FBQSxZQUFBLENBQUEsSUFBQTtBQUFBLFFBQUEsV0FBQSxHQUVjLEtBRmQsS0FBQTtBQUFBLFFBRWhCZ0QsU0FGZ0IsR0FBQSxXQUFBLENBQUEsU0FBQTtBQUFBLFFBRUxyRCxjQUZLLEdBQUEsV0FBQSxDQUFBLGNBQUE7QUFHeEIsUUFBTXNELFlBQVksR0FBR2pELElBQUksSUFBekIsSUFBQTs7QUFFQSxRQUFNa0QsVUFBVSxHQUNkLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxhQUFBLENBQUEsTUFBQSxFQUFBO0FBQ0UsTUFBQSxPQUFPLEVBQUVsRCxJQUFJLEdBQUcsS0FBSCxJQUFBLEdBRGYsSUFBQTtBQUVFLE1BQUEsWUFBWSxFQUZkLGNBQUE7QUFHRSxNQUFBLFNBQVMsRUFBRSxDQUFBLEdBQUEsWUFBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLFdBQUEsR0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxXQUFBLENBQUEsRUFBQSxDQUFBLENBQUEsRUFBQSxDQUFBLEdBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxXQUFBLEVBQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxFQUFBLG1CQUFBLENBQUEsRUFFMEIsQ0FGMUIsSUFBQSxDQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxpQkFBQSxDQUFBLEVBQUEsWUFBQSxDQUFBLEVBSGIsV0FHYSxFQUhiO0FBUUUsTUFBQSxlQUFlLEVBQUUsS0FBS21DO0FBUnhCLEtBQUEsRUFVRSxNQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsYUFBQSxDQUFBLE1BQUEsRUFBQTtBQUFNLE1BQUEsU0FBUyxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxnQkFBQTtBQUFmLEtBQUEsQ0FWRixDQURGOztBQWVBLFFBQU1nQixVQUFVLEdBQ2QsTUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLGFBQUEsQ0FBQSxNQUFBLEVBQUE7QUFDRSxNQUFBLE9BQU8sRUFBRXBELElBQUksR0FBRyxLQUFILElBQUEsR0FEZixJQUFBO0FBRUUsTUFBQSxZQUFZLEVBRmQsY0FBQTtBQUdFLE1BQUEsU0FBUyxFQUFFLENBQUEsR0FBQSxZQUFBLENBQUEsU0FBQSxDQUFBLEdBQUEsWUFBQSxHQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxFQUFBLFdBQUEsQ0FBQSxFQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxnQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLFlBQUEsRUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQUEsbUJBQUEsQ0FBQSxFQUUwQixDQUYxQixJQUFBLENBQUEsRUFBQSxDQUFBLEdBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxFQUFBLGlCQUFBLENBQUEsRUFBQSxZQUFBLENBQUEsRUFBQSxZQUFBO0FBSGIsS0FBQSxFQVNFLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxhQUFBLENBQUEsTUFBQSxFQUFBO0FBQU0sTUFBQSxTQUFTLEVBQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxFQUFBLGdCQUFBO0FBQWYsS0FBQSxDQVRGLENBREY7O0FBY0EsUUFBTXFELFlBQVksR0FBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQWxCLE1BQWtCLENBQWxCO0FBQ0EsUUFBTUMsVUFBVSxHQUFHLENBQUEsR0FBQSxZQUFBLENBQUEsU0FBQSxDQUFBLEdBQUEsWUFBQSxHQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsWUFBQSxFQUFBLElBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxnQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLFlBQUEsRUFHZjFELGNBQWMsR0FBQSxHQUFBLE1BQUEsQ0FBQSxZQUFBLEVBQUEsV0FBQSxDQUFBLEdBQUEsR0FBQSxNQUFBLENBQUEsWUFBQSxFQUhDLGNBR0QsQ0FIQyxFQUFBLElBQUEsQ0FBQSxFQUFuQixZQUFtQixFQUFuQjtBQVNBLFdBQ0UsTUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLGFBQUEsQ0FBQSxLQUFBLEVBQUE7QUFDRSxNQUFBLFNBQVMsRUFBRSxDQUFBLEdBQUEsWUFBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLFlBQUEsR0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsWUFBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxnQkFBQSxDQUFBLEVBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsWUFBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSwwQkFBQSxDQUFBLEVBQUEsWUFBQSxDQUFBLEVBRGIsWUFDYSxFQURiO0FBS0UsTUFBQSxHQUFHLEVBTEwsV0FBQTtBQU1FLE1BQUEsR0FBRyxFQUFFLEtBQUEsT0FBQSxDQUFBLFdBQUE7QUFOUCxLQUFBLEVBQUEsVUFBQSxFQUFBLFVBQUEsRUFVRSxNQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsYUFBQSxDQUFBLEtBQUEsRUFBQTtBQUFLLE1BQUEsU0FBUyxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBZCxXQUFjLENBQWQ7QUFBeUMsTUFBQSxHQUFHLEVBQUUsS0FBQSxPQUFBLENBQUEsU0FBQTtBQUE5QyxLQUFBLEVBQ0UsTUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLGFBQUEsQ0FBQSxLQUFBLEVBQUE7QUFBSyxNQUFBLFNBQVMsRUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQUEsYUFBQTtBQUFkLEtBQUEsRUFDRSxNQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsYUFBQSxDQUFBLEtBQUEsRUFBQTtBQUFLLE1BQUEsU0FBUyxFQUFkLFVBQUE7QUFBNEIsTUFBQSxHQUFHLEVBQUUsS0FBQSxPQUFBLENBQUEsS0FBQTtBQUFqQyxLQUFBLEVBYlIsT0FhUSxDQURGLENBREYsQ0FWRixDQURGO0FBb0JEO0FBNVNZLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCB7IGlzVHJhbnNmb3JtU3VwcG9ydGVkLCBzZXRUcmFuc2Zvcm0gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgYWRkRXZlbnRMaXN0ZW5lciBmcm9tICcuLi8uLi9fdXRpbC9hZGRFdmVudExpc3RlbmVyJztcbmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2gvZGVib3VuY2UnO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2Nyb2xsQW5pbWF0ZWQ6IHRydWUsXG4gICAgICBvblByZXZDbGljaygpIHt9LFxuICAgICAgb25OZXh0Q2xpY2soKSB7fSxcbiAgICB9O1xuICB9LFxuXG4gIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICB0aGlzLm9mZnNldCA9IDA7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5leHQ6IGZhbHNlLFxuICAgICAgcHJldjogZmFsc2UsXG4gICAgfTtcbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLmNvbXBvbmVudERpZFVwZGF0ZSgpO1xuICAgIHRoaXMuZGVib3VuY2VkUmVzaXplID0gZGVib3VuY2UoKCkgPT4ge1xuICAgICAgdGhpcy5zZXROZXh0UHJldigpO1xuICAgICAgdGhpcy5zY3JvbGxUb0FjdGl2ZVRhYigpO1xuICAgIH0sIDIwMCk7XG4gICAgdGhpcy5yZXNpemVFdmVudCA9IGFkZEV2ZW50TGlzdGVuZXIod2luZG93LCAncmVzaXplJywgdGhpcy5kZWJvdW5jZWRSZXNpemUpO1xuICB9LFxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgaWYgKHByZXZQcm9wcyAmJiBwcmV2UHJvcHMudGFiQmFyUG9zaXRpb24gIT09IHByb3BzLnRhYkJhclBvc2l0aW9uKSB7XG4gICAgICB0aGlzLnNldE9mZnNldCgwKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbmV4dFByZXYgPSB0aGlzLnNldE5leHRQcmV2KCk7XG4gICAgLy8gd2FpdCBuZXh0LCBwcmV2IHNob3cgaGlkZVxuICAgIC8qIGVzbGludCByZWFjdC9uby1kaWQtdXBkYXRlLXNldC1zdGF0ZTowICovXG4gICAgaWYgKHRoaXMuaXNOZXh0UHJldlNob3duKHRoaXMuc3RhdGUpICE9PSB0aGlzLmlzTmV4dFByZXZTaG93bihuZXh0UHJldikpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe30sIHRoaXMuc2Nyb2xsVG9BY3RpdmVUYWIpO1xuICAgIH0gZWxzZSBpZiAoIXByZXZQcm9wcyB8fCBwcm9wcy5hY3RpdmVLZXkgIT09IHByZXZQcm9wcy5hY3RpdmVLZXkpIHtcbiAgICAgIC8vIGNhbiBub3QgdXNlIHByb3BzLmFjdGl2ZUtleVxuICAgICAgdGhpcy5zY3JvbGxUb0FjdGl2ZVRhYigpO1xuICAgIH1cbiAgfSxcblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBpZiAodGhpcy5yZXNpemVFdmVudCkge1xuICAgICAgdGhpcy5yZXNpemVFdmVudC5yZW1vdmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZGVib3VuY2VkUmVzaXplICYmIHRoaXMuZGVib3VuY2VkUmVzaXplLmNhbmNlbCkge1xuICAgICAgdGhpcy5kZWJvdW5jZWRSZXNpemUuY2FuY2VsKCk7XG4gICAgfVxuICB9LFxuXG4gIHNldE5leHRQcmV2KCkge1xuICAgIGNvbnN0IG5hdk5vZGUgPSB0aGlzLm5hdjtcbiAgICBjb25zdCBuYXZOb2RlV0ggPSB0aGlzLmdldFNjcm9sbFdIKG5hdk5vZGUpO1xuICAgIGNvbnN0IGNvbnRhaW5lcldIID0gdGhpcy5nZXRPZmZzZXRXSCh0aGlzLmNvbnRhaW5lcik7XG4gICAgY29uc3QgbmF2V3JhcE5vZGVXSCA9IHRoaXMuZ2V0T2Zmc2V0V0godGhpcy5uYXZXcmFwKTtcbiAgICBsZXQgeyBvZmZzZXQgfSA9IHRoaXM7XG4gICAgY29uc3QgbWluT2Zmc2V0ID0gY29udGFpbmVyV0ggLSBuYXZOb2RlV0g7XG4gICAgbGV0IHsgbmV4dCwgcHJldiB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAobWluT2Zmc2V0ID49IDApIHtcbiAgICAgIG5leHQgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2V0T2Zmc2V0KDAsIGZhbHNlKTtcbiAgICAgIG9mZnNldCA9IDA7XG4gICAgfSBlbHNlIGlmIChtaW5PZmZzZXQgPCBvZmZzZXQpIHtcbiAgICAgIG5leHQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0ID0gZmFsc2U7XG4gICAgICAvLyBUZXN0IHdpdGggY29udGFpbmVyIG9mZnNldCB3aGljaCBpcyBzdGFibGVcbiAgICAgIC8vIGFuZCBzZXQgdGhlIG9mZnNldCBvZiB0aGUgbmF2IHdyYXAgbm9kZVxuICAgICAgY29uc3QgcmVhbE9mZnNldCA9IG5hdldyYXBOb2RlV0ggLSBuYXZOb2RlV0g7XG4gICAgICB0aGlzLnNldE9mZnNldChyZWFsT2Zmc2V0LCBmYWxzZSk7XG4gICAgICBvZmZzZXQgPSByZWFsT2Zmc2V0O1xuICAgIH1cblxuICAgIGlmIChvZmZzZXQgPCAwKSB7XG4gICAgICBwcmV2ID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJldiA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuc2V0TmV4dChuZXh0KTtcbiAgICB0aGlzLnNldFByZXYocHJldik7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5leHQsXG4gICAgICBwcmV2LFxuICAgIH07XG4gIH0sXG5cbiAgZ2V0T2Zmc2V0V0gobm9kZSkge1xuICAgIGNvbnN0IHRhYkJhclBvc2l0aW9uID0gdGhpcy5wcm9wcy50YWJCYXJQb3NpdGlvbjtcbiAgICBsZXQgcHJvcCA9ICdvZmZzZXRXaWR0aCc7XG4gICAgaWYgKHRhYkJhclBvc2l0aW9uID09PSAnbGVmdCcgfHwgdGFiQmFyUG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgIHByb3AgPSAnb2Zmc2V0SGVpZ2h0JztcbiAgICB9XG4gICAgcmV0dXJuIG5vZGVbcHJvcF07XG4gIH0sXG5cbiAgZ2V0U2Nyb2xsV0gobm9kZSkge1xuICAgIGNvbnN0IHRhYkJhclBvc2l0aW9uID0gdGhpcy5wcm9wcy50YWJCYXJQb3NpdGlvbjtcbiAgICBsZXQgcHJvcCA9ICdzY3JvbGxXaWR0aCc7XG4gICAgaWYgKHRhYkJhclBvc2l0aW9uID09PSAnbGVmdCcgfHwgdGFiQmFyUG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgIHByb3AgPSAnc2Nyb2xsSGVpZ2h0JztcbiAgICB9XG4gICAgcmV0dXJuIG5vZGVbcHJvcF07XG4gIH0sXG5cblxuICBnZXRPZmZzZXRMVChub2RlKSB7XG4gICAgY29uc3QgdGFiQmFyUG9zaXRpb24gPSB0aGlzLnByb3BzLnRhYkJhclBvc2l0aW9uO1xuICAgIGxldCBwcm9wID0gJ2xlZnQnO1xuICAgIGlmICh0YWJCYXJQb3NpdGlvbiA9PT0gJ2xlZnQnIHx8IHRhYkJhclBvc2l0aW9uID09PSAncmlnaHQnKSB7XG4gICAgICBwcm9wID0gJ3RvcCc7XG4gICAgfVxuICAgIHJldHVybiBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpW3Byb3BdO1xuICB9LFxuXG4gIHNldE9mZnNldChvZmZzZXQsIGNoZWNrTmV4dFByZXYgPSB0cnVlKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gTWF0aC5taW4oMCwgb2Zmc2V0KTtcbiAgICBpZiAodGhpcy5vZmZzZXQgIT09IHRhcmdldCkge1xuICAgICAgdGhpcy5vZmZzZXQgPSB0YXJnZXQ7XG4gICAgICBsZXQgbmF2T2Zmc2V0ID0ge307XG4gICAgICBjb25zdCB0YWJCYXJQb3NpdGlvbiA9IHRoaXMucHJvcHMudGFiQmFyUG9zaXRpb247XG4gICAgICBjb25zdCBuYXZTdHlsZSA9IHRoaXMubmF2LnN0eWxlO1xuICAgICAgY29uc3QgdHJhbnNmb3JtU3VwcG9ydGVkID0gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQobmF2U3R5bGUpO1xuICAgICAgaWYgKHRhYkJhclBvc2l0aW9uID09PSAnbGVmdCcgfHwgdGFiQmFyUG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgaWYgKHRyYW5zZm9ybVN1cHBvcnRlZCkge1xuICAgICAgICAgIG5hdk9mZnNldCA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBgdHJhbnNsYXRlM2QoMCwke3RhcmdldH1weCwwKWAsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuYXZPZmZzZXQgPSB7XG4gICAgICAgICAgICBuYW1lOiAndG9wJyxcbiAgICAgICAgICAgIHZhbHVlOiBgJHt0YXJnZXR9cHhgLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0cmFuc2Zvcm1TdXBwb3J0ZWQpIHtcbiAgICAgICAgICBuYXZPZmZzZXQgPSB7XG4gICAgICAgICAgICB2YWx1ZTogYHRyYW5zbGF0ZTNkKCR7dGFyZ2V0fXB4LDAsMClgLFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmF2T2Zmc2V0ID0ge1xuICAgICAgICAgICAgbmFtZTogJ2xlZnQnLFxuICAgICAgICAgICAgdmFsdWU6IGAke3RhcmdldH1weGAsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRyYW5zZm9ybVN1cHBvcnRlZCkge1xuICAgICAgICBzZXRUcmFuc2Zvcm0obmF2U3R5bGUsIG5hdk9mZnNldC52YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuYXZTdHlsZVtuYXZPZmZzZXQubmFtZV0gPSBuYXZPZmZzZXQudmFsdWU7XG4gICAgICB9XG4gICAgICBpZiAoY2hlY2tOZXh0UHJldikge1xuICAgICAgICB0aGlzLnNldE5leHRQcmV2KCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHNldFByZXYodikge1xuICAgIGlmICh0aGlzLnN0YXRlLnByZXYgIT09IHYpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBwcmV2OiB2LFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHNldE5leHQodikge1xuICAgIGlmICh0aGlzLnN0YXRlLm5leHQgIT09IHYpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBuZXh0OiB2LFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIGlzTmV4dFByZXZTaG93bihzdGF0ZSkge1xuICAgIGlmIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlLm5leHQgfHwgc3RhdGUucHJldjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUubmV4dCB8fCB0aGlzLnN0YXRlLnByZXY7XG4gIH0sXG5cbiAgcHJldlRyYW5zaXRpb25FbmQoZSkge1xuICAgIGlmIChlLnByb3BlcnR5TmFtZSAhPT0gJ29wYWNpdHknKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgY29udGFpbmVyIH0gPSB0aGlzO1xuICAgIHRoaXMuc2Nyb2xsVG9BY3RpdmVUYWIoe1xuICAgICAgdGFyZ2V0OiBjb250YWluZXIsXG4gICAgICBjdXJyZW50VGFyZ2V0OiBjb250YWluZXIsXG4gICAgfSk7XG4gIH0sXG5cbiAgc2Nyb2xsVG9BY3RpdmVUYWIoZSkge1xuICAgIGNvbnN0IHsgYWN0aXZlVGFiLCBuYXZXcmFwIH0gPSB0aGlzO1xuICAgIGlmIChlICYmIGUudGFyZ2V0ICE9PSBlLmN1cnJlbnRUYXJnZXQgfHwgIWFjdGl2ZVRhYikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIHdoZW4gbm90IHNjcm9sbGFibGUgb3IgZW50ZXIgc2Nyb2xsYWJsZSBmaXJzdCB0aW1lLCBkb24ndCBlbWl0IHNjcm9sbGluZ1xuICAgIGNvbnN0IG5lZWRUb1Nyb2xsID0gdGhpcy5pc05leHRQcmV2U2hvd24oKSAmJiB0aGlzLmxhc3ROZXh0UHJldlNob3duO1xuICAgIHRoaXMubGFzdE5leHRQcmV2U2hvd24gPSB0aGlzLmlzTmV4dFByZXZTaG93bigpO1xuICAgIGlmICghbmVlZFRvU3JvbGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBhY3RpdmVUYWJXSCA9IHRoaXMuZ2V0U2Nyb2xsV0goYWN0aXZlVGFiKTtcbiAgICBjb25zdCBuYXZXcmFwTm9kZVdIID0gdGhpcy5nZXRPZmZzZXRXSChuYXZXcmFwKTtcbiAgICBsZXQgeyBvZmZzZXQgfSA9IHRoaXM7XG4gICAgY29uc3Qgd3JhcE9mZnNldCA9IHRoaXMuZ2V0T2Zmc2V0TFQobmF2V3JhcCk7XG4gICAgY29uc3QgYWN0aXZlVGFiT2Zmc2V0ID0gdGhpcy5nZXRPZmZzZXRMVChhY3RpdmVUYWIpO1xuICAgIGlmICh3cmFwT2Zmc2V0ID4gYWN0aXZlVGFiT2Zmc2V0KSB7XG4gICAgICBvZmZzZXQgKz0gKHdyYXBPZmZzZXQgLSBhY3RpdmVUYWJPZmZzZXQpO1xuICAgICAgdGhpcy5zZXRPZmZzZXQob2Zmc2V0KTtcbiAgICB9IGVsc2UgaWYgKCh3cmFwT2Zmc2V0ICsgbmF2V3JhcE5vZGVXSCkgPCAoYWN0aXZlVGFiT2Zmc2V0ICsgYWN0aXZlVGFiV0gpKSB7XG4gICAgICBvZmZzZXQgLT0gKGFjdGl2ZVRhYk9mZnNldCArIGFjdGl2ZVRhYldIKSAtICh3cmFwT2Zmc2V0ICsgbmF2V3JhcE5vZGVXSCk7XG4gICAgICB0aGlzLnNldE9mZnNldChvZmZzZXQpO1xuICAgIH1cbiAgfSxcblxuICBwcmV2KGUpIHtcbiAgICB0aGlzLnByb3BzLm9uUHJldkNsaWNrKGUpO1xuICAgIGNvbnN0IG5hdldyYXBOb2RlID0gdGhpcy5uYXZXcmFwO1xuICAgIGNvbnN0IG5hdldyYXBOb2RlV0ggPSB0aGlzLmdldE9mZnNldFdIKG5hdldyYXBOb2RlKTtcbiAgICBjb25zdCB7IG9mZnNldCB9ID0gdGhpcztcbiAgICB0aGlzLnNldE9mZnNldChvZmZzZXQgKyBuYXZXcmFwTm9kZVdIKTtcbiAgfSxcblxuICBuZXh0KGUpIHtcbiAgICB0aGlzLnByb3BzLm9uTmV4dENsaWNrKGUpO1xuICAgIGNvbnN0IG5hdldyYXBOb2RlID0gdGhpcy5uYXZXcmFwO1xuICAgIGNvbnN0IG5hdldyYXBOb2RlV0ggPSB0aGlzLmdldE9mZnNldFdIKG5hdldyYXBOb2RlKTtcbiAgICBjb25zdCB7IG9mZnNldCB9ID0gdGhpcztcbiAgICB0aGlzLnNldE9mZnNldChvZmZzZXQgLSBuYXZXcmFwTm9kZVdIKTtcbiAgfSxcblxuICBnZXRTY3JvbGxCYXJOb2RlKGNvbnRlbnQpIHtcbiAgICBjb25zdCB7IG5leHQsIHByZXYgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIHNjcm9sbEFuaW1hdGVkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHNob3dOZXh0UHJldiA9IHByZXYgfHwgbmV4dDtcblxuICAgIGNvbnN0IHByZXZCdXR0b24gPSAoXG4gICAgICA8c3BhblxuICAgICAgICBvbkNsaWNrPXtwcmV2ID8gdGhpcy5wcmV2IDogbnVsbH1cbiAgICAgICAgdW5zZWxlY3RhYmxlPVwidW5zZWxlY3RhYmxlXCJcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKHtcbiAgICAgICAgICBbYCR7cHJlZml4Q2xzfS10YWItcHJldmBdOiAxLFxuICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LXRhYi1idG4tZGlzYWJsZWRgXTogIXByZXYsXG4gICAgICAgICAgW2Ake3ByZWZpeENsc30tdGFiLWFycm93LXNob3dgXTogc2hvd05leHRQcmV2LFxuICAgICAgICB9KX1cbiAgICAgICAgb25UcmFuc2l0aW9uRW5kPXt0aGlzLnByZXZUcmFuc2l0aW9uRW5kfVxuICAgICAgPlxuICAgICAgICA8c3BhbiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdGFiLXByZXYtaWNvbmB9IC8+XG4gICAgICA8L3NwYW4+XG4gICAgKTtcblxuICAgIGNvbnN0IG5leHRCdXR0b24gPSAoXG4gICAgICA8c3BhblxuICAgICAgICBvbkNsaWNrPXtuZXh0ID8gdGhpcy5uZXh0IDogbnVsbH1cbiAgICAgICAgdW5zZWxlY3RhYmxlPVwidW5zZWxlY3RhYmxlXCJcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKHtcbiAgICAgICAgICBbYCR7cHJlZml4Q2xzfS10YWItbmV4dGBdOiAxLFxuICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LXRhYi1idG4tZGlzYWJsZWRgXTogIW5leHQsXG4gICAgICAgICAgW2Ake3ByZWZpeENsc30tdGFiLWFycm93LXNob3dgXTogc2hvd05leHRQcmV2LFxuICAgICAgICB9KX1cbiAgICAgID5cbiAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXRhYi1uZXh0LWljb25gfSAvPlxuICAgICAgPC9zcGFuPlxuICAgICk7XG5cbiAgICBjb25zdCBuYXZDbGFzc05hbWUgPSBgJHtwcmVmaXhDbHN9LW5hdmA7XG4gICAgY29uc3QgbmF2Q2xhc3NlcyA9IGNsYXNzbmFtZXMoe1xuICAgICAgW25hdkNsYXNzTmFtZV06IHRydWUsXG4gICAgICBbXG4gICAgICAgIHNjcm9sbEFuaW1hdGVkID9cbiAgICAgICAgICBgJHtuYXZDbGFzc05hbWV9LWFuaW1hdGVkYCA6XG4gICAgICAgICAgYCR7bmF2Q2xhc3NOYW1lfS1uby1hbmltYXRlZGBcbiAgICAgICAgXTogdHJ1ZSxcbiAgICB9KTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NuYW1lcyh7XG4gICAgICAgICAgW2Ake3ByZWZpeENsc30tbmF2LWNvbnRhaW5lcmBdOiAxLFxuICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LW5hdi1jb250YWluZXItc2Nyb2xsaW5nYF06IHNob3dOZXh0UHJldixcbiAgICAgICAgfSl9XG4gICAgICAgIGtleT1cImNvbnRhaW5lclwiXG4gICAgICAgIHJlZj17dGhpcy5zYXZlUmVmKCdjb250YWluZXInKX1cbiAgICAgID5cbiAgICAgICAge3ByZXZCdXR0b259XG4gICAgICAgIHtuZXh0QnV0dG9ufVxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1uYXYtd3JhcGB9IHJlZj17dGhpcy5zYXZlUmVmKCduYXZXcmFwJyl9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LW5hdi1zY3JvbGxgfT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtuYXZDbGFzc2VzfSByZWY9e3RoaXMuc2F2ZVJlZignbmF2Jyl9PlxuICAgICAgICAgICAgICB7Y29udGVudH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH0sXG59O1xuIl19