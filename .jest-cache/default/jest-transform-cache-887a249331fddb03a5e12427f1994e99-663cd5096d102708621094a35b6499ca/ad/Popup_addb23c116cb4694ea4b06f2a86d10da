53fae36d41b50fe09dbdcf4260a79811
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _align = _interopRequireDefault(require("../../align"));

var _animate = _interopRequireDefault(require("../../animate"));

var _PopupInner = _interopRequireDefault(require("./PopupInner"));

var _LazyRenderBox = _interopRequireDefault(require("./LazyRenderBox"));

var _utils = require("./utils");

var Popup =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Popup, _Component);

  function Popup(_props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Popup);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Popup).call(this, _props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onAlign", function (popupDomNode, align) {
      var props = _this.props;
      var currentAlignClassName = props.getClassNameFromAlign(align); // FIX: https://github.com/react-component/trigger/issues/56
      // FIX: https://github.com/react-component/tooltip/issues/79

      if (_this.currentAlignClassName !== currentAlignClassName) {
        _this.currentAlignClassName = currentAlignClassName;
        popupDomNode.className = _this.getClassName(currentAlignClassName);
      }

      props.onAlign(popupDomNode, align);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setStretchSize", function () {
      var _this$props = _this.props,
          stretch = _this$props.stretch,
          getRootDomNode = _this$props.getRootDomNode,
          visible = _this$props.visible;
      var _this$state = _this.state,
          stretchChecked = _this$state.stretchChecked,
          targetHeight = _this$state.targetHeight,
          targetWidth = _this$state.targetWidth;

      if (!stretch || !visible) {
        if (stretchChecked) {
          _this.setState({
            stretchChecked: false
          });
        }

        return;
      }

      var $ele = getRootDomNode();
      if (!$ele) return;
      var height = $ele.offsetHeight;
      var width = $ele.offsetWidth;

      if (targetHeight !== height || targetWidth !== width || !stretchChecked) {
        _this.setState({
          stretchChecked: true,
          targetHeight: height,
          targetWidth: width
        });
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getTarget", function () {
      return _this.props.getRootDomNode();
    });
    _this.state = {
      // Used for stretch
      stretchChecked: false,
      targetWidth: undefined,
      targetHeight: undefined
    };
    _this.savePopupRef = _utils.saveRef.bind((0, _assertThisInitialized2["default"])(_this), 'popupInstance');
    _this.saveAlignRef = _utils.saveRef.bind((0, _assertThisInitialized2["default"])(_this), 'alignInstance');
    return _this;
  }

  (0, _createClass2["default"])(Popup, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.rootNode = this.getPopupDomNode();
      this.setStretchSize();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.setStretchSize();
    }
  }, {
    key: "getPopupDomNode",
    value: function getPopupDomNode() {
      return _reactDom["default"].findDOMNode(this.popupInstance);
    }
  }, {
    key: "getMaskTransitionName",
    value: function getMaskTransitionName() {
      var props = this.props;
      var transitionName = props.maskTransitionName;
      var animation = props.maskAnimation;

      if (!transitionName && animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(animation);
      }

      return transitionName;
    }
  }, {
    key: "getTransitionName",
    value: function getTransitionName() {
      var props = this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(props.animation);
      }

      return transitionName;
    }
  }, {
    key: "getClassName",
    value: function getClassName(currentAlignClassName) {
      return "".concat(this.props.prefixCls, " ").concat(this.props.className, " ").concat(currentAlignClassName);
    }
  }, {
    key: "getPopupElement",
    value: function getPopupElement() {
      var savePopupRef = this.savePopupRef;
      var _this$state2 = this.state,
          stretchChecked = _this$state2.stretchChecked,
          targetHeight = _this$state2.targetHeight,
          targetWidth = _this$state2.targetWidth;
      var _this$props2 = this.props,
          align = _this$props2.align,
          visible = _this$props2.visible,
          prefixCls = _this$props2.prefixCls,
          style = _this$props2.style,
          getClassNameFromAlign = _this$props2.getClassNameFromAlign,
          destroyPopupOnHide = _this$props2.destroyPopupOnHide,
          stretch = _this$props2.stretch,
          children = _this$props2.children,
          onMouseEnter = _this$props2.onMouseEnter,
          onMouseLeave = _this$props2.onMouseLeave;
      var className = this.getClassName(this.currentAlignClassName || getClassNameFromAlign(align));
      var hiddenClassName = "".concat(prefixCls, "-hidden");

      if (!visible) {
        this.currentAlignClassName = null;
      }

      var sizeStyle = {};

      if (stretch) {
        if (stretchChecked) {
          // Stretch with target
          if (stretch.indexOf('height') !== -1) {
            sizeStyle.height = targetHeight;
          } else if (stretch.indexOf('minHeight') !== -1) {
            sizeStyle.minHeight = targetHeight;
          }

          if (stretch.indexOf('width') !== -1) {
            sizeStyle.width = targetWidth;
          } else if (stretch.indexOf('minWidth') !== -1) {
            sizeStyle.minWidth = targetWidth;
          }
        } else {
          // Do nothing when stretch not ready
          return null;
        }
      }

      var newStyle = (0, _objectSpread2["default"])({}, sizeStyle, {}, style, {}, this.getZIndexStyle());
      var popupInnerProps = {
        className: className,
        prefixCls: prefixCls,
        ref: savePopupRef,
        onMouseEnter: onMouseEnter,
        onMouseLeave: onMouseLeave,
        style: newStyle
      };

      if (destroyPopupOnHide) {
        return _react["default"].createElement(_animate["default"], {
          component: "",
          exclusive: true,
          transitionAppear: true,
          transitionName: this.getTransitionName()
        }, visible ? _react["default"].createElement(_align["default"], {
          target: this.getTarget,
          key: "popup",
          ref: this.saveAlignRef,
          monitorWindowResize: true,
          hidden: !visible,
          childrenProps: {
            hidden: 'hidden'
          },
          align: align,
          onAlign: this.onAlign
        }, _react["default"].createElement(_PopupInner["default"], popupInnerProps, children)) : null);
      }

      return _react["default"].createElement(_animate["default"], {
        component: "",
        exclusive: true,
        transitionAppear: true,
        transitionName: this.getTransitionName(),
        hiddenProp: "hidden"
      }, _react["default"].createElement(_align["default"], {
        target: this.getTarget,
        key: "popup",
        ref: this.saveAlignRef,
        monitorWindowResize: true,
        hidden: !visible,
        childrenProps: {
          hidden: 'hidden'
        },
        disabled: !visible,
        align: align,
        onAlign: this.onAlign
      }, _react["default"].createElement(_PopupInner["default"], (0, _extends2["default"])({
        hiddenClassName: hiddenClassName
      }, popupInnerProps), children)));
    }
  }, {
    key: "getZIndexStyle",
    value: function getZIndexStyle() {
      var style = {};
      var props = this.props;

      if (props.zIndex !== undefined) {
        style.zIndex = props.zIndex;
      }

      return style;
    }
  }, {
    key: "getMaskElement",
    value: function getMaskElement() {
      var props = this.props;
      var maskElement;

      if (props.mask) {
        var maskTransition = this.getMaskTransitionName();
        maskElement = _react["default"].createElement(_LazyRenderBox["default"], {
          style: this.getZIndexStyle(),
          key: "mask",
          className: "".concat(props.prefixCls, "-mask"),
          hiddenClassName: "".concat(props.prefixCls, "-mask-hidden"),
          hidden: !props.visible
        });

        if (maskTransition) {
          maskElement = _react["default"].createElement(_animate["default"], {
            key: "mask",
            hiddenProp: "hidden",
            transitionAppear: true,
            component: "",
            transitionName: maskTransition
          }, maskElement);
        }
      }

      return maskElement;
    }
  }, {
    key: "render",
    value: function render() {
      return _react["default"].createElement("div", null, this.getMaskElement(), this.getPopupElement());
    }
  }]);
  return Popup;
}(_react.Component);

(0, _defineProperty2["default"])(Popup, "propTypes", {
  visible: _propTypes["default"].bool,
  style: _propTypes["default"].object,
  getClassNameFromAlign: _propTypes["default"].func,
  onAlign: _propTypes["default"].func,
  getRootDomNode: _propTypes["default"].func,
  onMouseEnter: _propTypes["default"].func,
  align: _propTypes["default"].any,
  destroyPopupOnHide: _propTypes["default"].bool,
  className: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  onMouseLeave: _propTypes["default"].func,
  stretch: _propTypes["default"].string,
  children: _propTypes["default"].node
});
var _default = Popup;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyaWdnZXIvUG9wdXAuanN4Il0sIm5hbWVzIjpbIlBvcHVwIiwiQ29tcG9uZW50IiwidmlzaWJsZSIsIlByb3BUeXBlcyIsInN0eWxlIiwiZ2V0Q2xhc3NOYW1lRnJvbUFsaWduIiwib25BbGlnbiIsImdldFJvb3REb21Ob2RlIiwib25Nb3VzZUVudGVyIiwiYWxpZ24iLCJkZXN0cm95UG9wdXBPbkhpZGUiLCJjbGFzc05hbWUiLCJwcmVmaXhDbHMiLCJvbk1vdXNlTGVhdmUiLCJzdHJldGNoIiwiY2hpbGRyZW4iLCJub2RlIiwic3RyZXRjaENoZWNrZWQiLCJ0YXJnZXRXaWR0aCIsInRhcmdldEhlaWdodCIsInVuZGVmaW5lZCIsInNhdmVSZWYiLCJwcm9wcyIsImN1cnJlbnRBbGlnbkNsYXNzTmFtZSIsInBvcHVwRG9tTm9kZSIsIiRlbGUiLCJoZWlnaHQiLCJ3aWR0aCIsIlJlYWN0RE9NIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb24iLCJzYXZlUG9wdXBSZWYiLCJoaWRkZW5DbGFzc05hbWUiLCJzaXplU3R5bGUiLCJuZXdTdHlsZSIsInBvcHVwSW5uZXJQcm9wcyIsInJlZiIsImhpZGRlbiIsIm1hc2tUcmFuc2l0aW9uIiwibWFza0VsZW1lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxTQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxRQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsZUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFB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QU8sRUFBRVgsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FaUSxNQUFBO0FBYWpCWSxFQUFBQSxRQUFRLEVBQUVaLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQVVhO0FBYkgsQztlQTZRTmhCLEsiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IEFsaWduIGZyb20gJy4uLy4uL2FsaWduJztcbmltcG9ydCBBbmltYXRlIGZyb20gJy4uLy4uL2FuaW1hdGUnO1xuaW1wb3J0IFBvcHVwSW5uZXIgZnJvbSAnLi9Qb3B1cElubmVyJztcbmltcG9ydCBMYXp5UmVuZGVyQm94IGZyb20gJy4vTGF6eVJlbmRlckJveCc7XG5pbXBvcnQgeyBzYXZlUmVmIH0gZnJvbSAnLi91dGlscyc7XG5cbmNsYXNzIFBvcHVwIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICB2aXNpYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBzdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBnZXRDbGFzc05hbWVGcm9tQWxpZ246IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQWxpZ246IFByb3BUeXBlcy5mdW5jLFxuICAgIGdldFJvb3REb21Ob2RlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbk1vdXNlRW50ZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIGFsaWduOiBQcm9wVHlwZXMuYW55LFxuICAgIGRlc3Ryb3lQb3B1cE9uSGlkZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBvbk1vdXNlTGVhdmU6IFByb3BUeXBlcy5mdW5jLFxuICAgIHN0cmV0Y2g6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIC8vIFVzZWQgZm9yIHN0cmV0Y2hcbiAgICAgIHN0cmV0Y2hDaGVja2VkOiBmYWxzZSxcbiAgICAgIHRhcmdldFdpZHRoOiB1bmRlZmluZWQsXG4gICAgICB0YXJnZXRIZWlnaHQ6IHVuZGVmaW5lZCxcbiAgICB9O1xuXG4gICAgdGhpcy5zYXZlUG9wdXBSZWYgPSBzYXZlUmVmLmJpbmQodGhpcywgJ3BvcHVwSW5zdGFuY2UnKTtcbiAgICB0aGlzLnNhdmVBbGlnblJlZiA9IHNhdmVSZWYuYmluZCh0aGlzLCAnYWxpZ25JbnN0YW5jZScpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5yb290Tm9kZSA9IHRoaXMuZ2V0UG9wdXBEb21Ob2RlKCk7XG4gICAgdGhpcy5zZXRTdHJldGNoU2l6ZSgpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIHRoaXMuc2V0U3RyZXRjaFNpemUoKTtcbiAgfVxuXG4gIG9uQWxpZ24gPSAocG9wdXBEb21Ob2RlLCBhbGlnbikgPT4ge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBjdXJyZW50QWxpZ25DbGFzc05hbWUgPSBwcm9wcy5nZXRDbGFzc05hbWVGcm9tQWxpZ24oYWxpZ24pO1xuICAgIC8vIEZJWDogaHR0cHM6Ly9naXRodWIuY29tL3JlYWN0LWNvbXBvbmVudC90cmlnZ2VyL2lzc3Vlcy81NlxuICAgIC8vIEZJWDogaHR0cHM6Ly9naXRodWIuY29tL3JlYWN0LWNvbXBvbmVudC90b29sdGlwL2lzc3Vlcy83OVxuICAgIGlmICh0aGlzLmN1cnJlbnRBbGlnbkNsYXNzTmFtZSAhPT0gY3VycmVudEFsaWduQ2xhc3NOYW1lKSB7XG4gICAgICB0aGlzLmN1cnJlbnRBbGlnbkNsYXNzTmFtZSA9IGN1cnJlbnRBbGlnbkNsYXNzTmFtZTtcbiAgICAgIHBvcHVwRG9tTm9kZS5jbGFzc05hbWUgPSB0aGlzLmdldENsYXNzTmFtZShjdXJyZW50QWxpZ25DbGFzc05hbWUpO1xuICAgIH1cbiAgICBwcm9wcy5vbkFsaWduKHBvcHVwRG9tTm9kZSwgYWxpZ24pO1xuICB9O1xuXG4gIC8vIFJlY29yZCBzaXplIGlmIHN0cmV0Y2ggbmVlZGVkXG4gIHNldFN0cmV0Y2hTaXplID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgc3RyZXRjaCwgZ2V0Um9vdERvbU5vZGUsIHZpc2libGUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBzdHJldGNoQ2hlY2tlZCwgdGFyZ2V0SGVpZ2h0LCB0YXJnZXRXaWR0aCB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGlmICghc3RyZXRjaCB8fCAhdmlzaWJsZSkge1xuICAgICAgaWYgKHN0cmV0Y2hDaGVja2VkKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzdHJldGNoQ2hlY2tlZDogZmFsc2UgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgJGVsZSA9IGdldFJvb3REb21Ob2RlKCk7XG4gICAgaWYgKCEkZWxlKSByZXR1cm47XG5cbiAgICBjb25zdCBoZWlnaHQgPSAkZWxlLm9mZnNldEhlaWdodDtcbiAgICBjb25zdCB3aWR0aCA9ICRlbGUub2Zmc2V0V2lkdGg7XG5cbiAgICBpZiAodGFyZ2V0SGVpZ2h0ICE9PSBoZWlnaHQgfHwgdGFyZ2V0V2lkdGggIT09IHdpZHRoIHx8ICFzdHJldGNoQ2hlY2tlZCkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHN0cmV0Y2hDaGVja2VkOiB0cnVlLFxuICAgICAgICB0YXJnZXRIZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgdGFyZ2V0V2lkdGg6IHdpZHRoLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGdldFBvcHVwRG9tTm9kZSgpIHtcbiAgICByZXR1cm4gUmVhY3RET00uZmluZERPTU5vZGUodGhpcy5wb3B1cEluc3RhbmNlKTtcbiAgfVxuXG4gIGdldFRhcmdldCA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5nZXRSb290RG9tTm9kZSgpO1xuICB9O1xuXG4gIGdldE1hc2tUcmFuc2l0aW9uTmFtZSgpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgbGV0IHRyYW5zaXRpb25OYW1lID0gcHJvcHMubWFza1RyYW5zaXRpb25OYW1lO1xuICAgIGNvbnN0IGFuaW1hdGlvbiA9IHByb3BzLm1hc2tBbmltYXRpb247XG4gICAgaWYgKCF0cmFuc2l0aW9uTmFtZSAmJiBhbmltYXRpb24pIHtcbiAgICAgIHRyYW5zaXRpb25OYW1lID0gYCR7cHJvcHMucHJlZml4Q2xzfS0ke2FuaW1hdGlvbn1gO1xuICAgIH1cbiAgICByZXR1cm4gdHJhbnNpdGlvbk5hbWU7XG4gIH1cblxuICBnZXRUcmFuc2l0aW9uTmFtZSgpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgbGV0IHRyYW5zaXRpb25OYW1lID0gcHJvcHMudHJhbnNpdGlvbk5hbWU7XG4gICAgaWYgKCF0cmFuc2l0aW9uTmFtZSAmJiBwcm9wcy5hbmltYXRpb24pIHtcbiAgICAgIHRyYW5zaXRpb25OYW1lID0gYCR7cHJvcHMucHJlZml4Q2xzfS0ke3Byb3BzLmFuaW1hdGlvbn1gO1xuICAgIH1cbiAgICByZXR1cm4gdHJhbnNpdGlvbk5hbWU7XG4gIH1cblxuICBnZXRDbGFzc05hbWUoY3VycmVudEFsaWduQ2xhc3NOYW1lKSB7XG4gICAgcmV0dXJuIGAke3RoaXMucHJvcHMucHJlZml4Q2xzfSAke3RoaXMucHJvcHMuY2xhc3NOYW1lfSAke2N1cnJlbnRBbGlnbkNsYXNzTmFtZX1gO1xuICB9XG5cbiAgZ2V0UG9wdXBFbGVtZW50KCkge1xuICAgIGNvbnN0IHsgc2F2ZVBvcHVwUmVmIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgc3RyZXRjaENoZWNrZWQsIHRhcmdldEhlaWdodCwgdGFyZ2V0V2lkdGggfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3Qge1xuICAgICAgYWxpZ24sIHZpc2libGUsXG4gICAgICBwcmVmaXhDbHMsIHN0eWxlLCBnZXRDbGFzc05hbWVGcm9tQWxpZ24sXG4gICAgICBkZXN0cm95UG9wdXBPbkhpZGUsIHN0cmV0Y2gsIGNoaWxkcmVuLFxuICAgICAgb25Nb3VzZUVudGVyLCBvbk1vdXNlTGVhdmUsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5nZXRDbGFzc05hbWUodGhpcy5jdXJyZW50QWxpZ25DbGFzc05hbWUgfHxcbiAgICAgIGdldENsYXNzTmFtZUZyb21BbGlnbihhbGlnbikpO1xuICAgIGNvbnN0IGhpZGRlbkNsYXNzTmFtZSA9IGAke3ByZWZpeENsc30taGlkZGVuYDtcblxuICAgIGlmICghdmlzaWJsZSkge1xuICAgICAgdGhpcy5jdXJyZW50QWxpZ25DbGFzc05hbWUgPSBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHNpemVTdHlsZSA9IHt9O1xuICAgIGlmIChzdHJldGNoKSB7XG4gICAgICBpZiAoc3RyZXRjaENoZWNrZWQpIHtcbiAgICAgICAgLy8gU3RyZXRjaCB3aXRoIHRhcmdldFxuICAgICAgICBpZiAoc3RyZXRjaC5pbmRleE9mKCdoZWlnaHQnKSAhPT0gLTEpIHtcbiAgICAgICAgICBzaXplU3R5bGUuaGVpZ2h0ID0gdGFyZ2V0SGVpZ2h0O1xuICAgICAgICB9IGVsc2UgaWYgKHN0cmV0Y2guaW5kZXhPZignbWluSGVpZ2h0JykgIT09IC0xKSB7XG4gICAgICAgICAgc2l6ZVN0eWxlLm1pbkhlaWdodCA9IHRhcmdldEhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RyZXRjaC5pbmRleE9mKCd3aWR0aCcpICE9PSAtMSkge1xuICAgICAgICAgIHNpemVTdHlsZS53aWR0aCA9IHRhcmdldFdpZHRoO1xuICAgICAgICB9IGVsc2UgaWYgKHN0cmV0Y2guaW5kZXhPZignbWluV2lkdGgnKSAhPT0gLTEpIHtcbiAgICAgICAgICBzaXplU3R5bGUubWluV2lkdGggPSB0YXJnZXRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRG8gbm90aGluZyB3aGVuIHN0cmV0Y2ggbm90IHJlYWR5XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG5ld1N0eWxlID0ge1xuICAgICAgLi4uc2l6ZVN0eWxlLFxuICAgICAgLi4uc3R5bGUsXG4gICAgICAuLi50aGlzLmdldFpJbmRleFN0eWxlKCksXG4gICAgfTtcblxuICAgIGNvbnN0IHBvcHVwSW5uZXJQcm9wcyA9IHtcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIHByZWZpeENscyxcbiAgICAgIHJlZjogc2F2ZVBvcHVwUmVmLFxuICAgICAgb25Nb3VzZUVudGVyLFxuICAgICAgb25Nb3VzZUxlYXZlLFxuICAgICAgc3R5bGU6IG5ld1N0eWxlLFxuICAgIH07XG4gICAgaWYgKGRlc3Ryb3lQb3B1cE9uSGlkZSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPEFuaW1hdGVcbiAgICAgICAgICBjb21wb25lbnQ9XCJcIlxuICAgICAgICAgIGV4Y2x1c2l2ZVxuICAgICAgICAgIHRyYW5zaXRpb25BcHBlYXJcbiAgICAgICAgICB0cmFuc2l0aW9uTmFtZT17dGhpcy5nZXRUcmFuc2l0aW9uTmFtZSgpfVxuICAgICAgICA+XG4gICAgICAgICAge3Zpc2libGUgPyAoXG4gICAgICAgICAgICA8QWxpZ25cbiAgICAgICAgICAgICAgdGFyZ2V0PXt0aGlzLmdldFRhcmdldH1cbiAgICAgICAgICAgICAga2V5PVwicG9wdXBcIlxuICAgICAgICAgICAgICByZWY9e3RoaXMuc2F2ZUFsaWduUmVmfVxuICAgICAgICAgICAgICBtb25pdG9yV2luZG93UmVzaXplXG4gICAgICAgICAgICAgIGhpZGRlbj17IXZpc2libGV9XG4gICAgICAgICAgICAgIGNoaWxkcmVuUHJvcHM9e3sgaGlkZGVuOiAnaGlkZGVuJyB9fVxuICAgICAgICAgICAgICBhbGlnbj17YWxpZ259XG4gICAgICAgICAgICAgIG9uQWxpZ249e3RoaXMub25BbGlnbn1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFBvcHVwSW5uZXJcbiAgICAgICAgICAgICAgICB7Li4ucG9wdXBJbm5lclByb3BzfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgICAgICA8L1BvcHVwSW5uZXI+XG4gICAgICAgICAgICA8L0FsaWduPlxuICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICA8L0FuaW1hdGU+XG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPEFuaW1hdGVcbiAgICAgICAgY29tcG9uZW50PVwiXCJcbiAgICAgICAgZXhjbHVzaXZlXG4gICAgICAgIHRyYW5zaXRpb25BcHBlYXJcbiAgICAgICAgdHJhbnNpdGlvbk5hbWU9e3RoaXMuZ2V0VHJhbnNpdGlvbk5hbWUoKX1cbiAgICAgICAgaGlkZGVuUHJvcD1cImhpZGRlblwiXG4gICAgICA+XG4gICAgICAgIDxBbGlnblxuICAgICAgICAgIHRhcmdldD17dGhpcy5nZXRUYXJnZXR9XG4gICAgICAgICAga2V5PVwicG9wdXBcIlxuICAgICAgICAgIHJlZj17dGhpcy5zYXZlQWxpZ25SZWZ9XG4gICAgICAgICAgbW9uaXRvcldpbmRvd1Jlc2l6ZVxuICAgICAgICAgIGhpZGRlbj17IXZpc2libGV9XG4gICAgICAgICAgY2hpbGRyZW5Qcm9wcz17eyBoaWRkZW46ICdoaWRkZW4nIH19XG4gICAgICAgICAgZGlzYWJsZWQ9eyF2aXNpYmxlfVxuICAgICAgICAgIGFsaWduPXthbGlnbn1cbiAgICAgICAgICBvbkFsaWduPXt0aGlzLm9uQWxpZ259XG4gICAgICAgID5cbiAgICAgICAgICA8UG9wdXBJbm5lclxuICAgICAgICAgICAgaGlkZGVuQ2xhc3NOYW1lPXtoaWRkZW5DbGFzc05hbWV9XG4gICAgICAgICAgICB7Li4ucG9wdXBJbm5lclByb3BzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICA8L1BvcHVwSW5uZXI+XG4gICAgICAgIDwvQWxpZ24+XG4gICAgICA8L0FuaW1hdGU+XG4gICAgKTtcbiAgfVxuXG4gIGdldFpJbmRleFN0eWxlKCkge1xuICAgIGNvbnN0IHN0eWxlID0ge307XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGlmIChwcm9wcy56SW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgc3R5bGUuekluZGV4ID0gcHJvcHMuekluZGV4O1xuICAgIH1cbiAgICByZXR1cm4gc3R5bGU7XG4gIH1cblxuICBnZXRNYXNrRWxlbWVudCgpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgbGV0IG1hc2tFbGVtZW50O1xuICAgIGlmIChwcm9wcy5tYXNrKSB7XG4gICAgICBjb25zdCBtYXNrVHJhbnNpdGlvbiA9IHRoaXMuZ2V0TWFza1RyYW5zaXRpb25OYW1lKCk7XG4gICAgICBtYXNrRWxlbWVudCA9IChcbiAgICAgICAgPExhenlSZW5kZXJCb3hcbiAgICAgICAgICBzdHlsZT17dGhpcy5nZXRaSW5kZXhTdHlsZSgpfVxuICAgICAgICAgIGtleT1cIm1hc2tcIlxuICAgICAgICAgIGNsYXNzTmFtZT17YCR7cHJvcHMucHJlZml4Q2xzfS1tYXNrYH1cbiAgICAgICAgICBoaWRkZW5DbGFzc05hbWU9e2Ake3Byb3BzLnByZWZpeENsc30tbWFzay1oaWRkZW5gfVxuICAgICAgICAgIGhpZGRlbj17IXByb3BzLnZpc2libGV9XG4gICAgICAgIC8+XG4gICAgICApO1xuICAgICAgaWYgKG1hc2tUcmFuc2l0aW9uKSB7XG4gICAgICAgIG1hc2tFbGVtZW50ID0gKFxuICAgICAgICAgIDxBbmltYXRlXG4gICAgICAgICAgICBrZXk9XCJtYXNrXCJcbiAgICAgICAgICAgIGhpZGRlblByb3A9XCJoaWRkZW5cIlxuICAgICAgICAgICAgdHJhbnNpdGlvbkFwcGVhclxuICAgICAgICAgICAgY29tcG9uZW50PVwiXCJcbiAgICAgICAgICAgIHRyYW5zaXRpb25OYW1lPXttYXNrVHJhbnNpdGlvbn1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7bWFza0VsZW1lbnR9XG4gICAgICAgICAgPC9BbmltYXRlPlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFza0VsZW1lbnQ7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXY+XG4gICAgICAgIHt0aGlzLmdldE1hc2tFbGVtZW50KCl9XG4gICAgICAgIHt0aGlzLmdldFBvcHVwRWxlbWVudCgpfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3B1cDtcbiJdfQ==