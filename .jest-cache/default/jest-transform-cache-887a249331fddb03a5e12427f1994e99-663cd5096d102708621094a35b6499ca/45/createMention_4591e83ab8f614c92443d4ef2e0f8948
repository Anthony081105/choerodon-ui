7893ecbbcc218958a28cd5f8cf6c3dfa
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = createMention;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _react = _interopRequireWildcard(require("react"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _Suggestions2 = _interopRequireDefault(require("../component/Suggestions.react"));

var _SuggestionPortal = _interopRequireDefault(require("../component/SuggestionPortal.react"));

var _MentionContent = _interopRequireDefault(require("../component/MentionContent.react"));

var _mentionStore = _interopRequireDefault(require("../model/mentionStore"));

var _exportContent = _interopRequireDefault(require("./exportContent"));

var _getRegExp = _interopRequireDefault(require("../utils/getRegExp"));

function findWithRegex(regex, contentBlock, callback) {
  // Get the text from the contentBlock
  var text = contentBlock.getText();
  var matchArr;
  var start; // eslint-disable-line
  // Go through all matches in the text and return the indizes to the callback

  while ((matchArr = regex.exec(text)) !== null) {
    // eslint-disable-line
    start = matchArr.index;
    callback(start, start + matchArr[0].length);
  }
}

function mentionContentStrategy(contentBlock, callback, contentState) {
  contentBlock.findEntityRanges(function (character) {
    var entityKey = character.getEntity();
    return entityKey && contentState.getEntity(entityKey).getType() === 'mention';
  }, callback);
}

var MentionContentComponent = function MentionContentComponent(props) {
  var entityKey = props.entityKey,
      tag = props.tag,
      callbacks = props.callbacks;
  var contentState = callbacks.getEditorState().getCurrentContent();
  var data = contentState.getEntity(entityKey).getData();
  return (0, _react.createElement)(tag, (0, _objectSpread2["default"])({}, props, {
    data: data
  }));
};

function createMention() {
  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var callbacks = {
    onChange: _noop["default"],
    onUpArrow: _noop["default"],
    onDownArrow: _noop["default"],
    getEditorState: _noop["default"],
    setEditorState: _noop["default"],
    handleReturn: _noop["default"],
    onBlur: _noop["default"]
  };
  var componentProps = {
    callbacks: callbacks,
    mentionStore: _mentionStore["default"]
  };
  var suggestionRegex = (0, _getRegExp["default"])(config.prefix);
  var tag = config.tag || _MentionContent["default"];
  var decorators = [{
    strategy: function strategy(contentBlock, callback) {
      findWithRegex(suggestionRegex, contentBlock, callback);
    },
    component: function component(props) {
      return _react["default"].createElement(_SuggestionPortal["default"], (0, _extends2["default"])({}, props, componentProps, {
        style: config.mentionStyle,
        suggestionRegex: (0, _getRegExp["default"])(config.prefix)
      }));
    }
  }];

  if (config.mode !== 'immutable') {
    decorators.unshift({
      strategy: mentionContentStrategy,
      component: function component(props) {
        return _react["default"].createElement(MentionContentComponent, (0, _extends2["default"])({
          tag: tag
        }, props, {
          callbacks: callbacks
        }));
      }
    });
  }

  return {
    name: 'mention',
    Suggestions: function Suggestions(props) {
      return _react["default"].createElement(_Suggestions2["default"], (0, _extends2["default"])({}, props, componentProps, {
        store: _mentionStore["default"]
      }));
    },
    decorators: decorators,
    onChange: function onChange(editorState) {
      return callbacks.onChange ? callbacks.onChange(editorState) : editorState;
    },
    callbacks: callbacks,
    "export": _exportContent["default"]
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZU1lbnRpb24uanN4Il0sIm5hbWVzIjpbImZpbmRXaXRoUmVnZXgiLCJyZWdleCIsImNvbnRlbnRCbG9jayIsImNhbGxiYWNrIiwidGV4dCIsImdldFRleHQiLCJtYXRjaEFyciIsInN0YXJ0IiwiZXhlYyIsImluZGV4IiwibGVuZ3RoIiwibWVudGlvbkNvbnRlbnRTdHJhdGVneSIsImNvbnRlbnRTdGF0ZSIsImZpbmRFbnRpdHlSYW5nZXMiLCJjaGFyYWN0ZXIiLCJlbnRpdHlLZXkiLCJnZXRFbnRpdHkiLCJnZXRUeXBlIiwiTWVudGlvbkNvbnRlbnRDb21wb25lbnQiLCJwcm9wcyIsInRhZyIsImNhbGxiYWNrcyIsImdldEVkaXRvclN0YXRlIiwiZ2V0Q3VycmVudENvbnRlbnQiLCJkYXRhIiwiZ2V0RGF0YSIsImNyZWF0ZU1lbnRpb24iLCJjb25maWciLCJvbkNoYW5nZSIsIm5vb3AiLCJvblVwQXJyb3ciLCJvbkRvd25BcnJvdyIsInNldEVkaXRvclN0YXRlIiwiaGFuZGxlUmV0dXJuIiwib25CbHVyIiwiY29tcG9uZW50UHJvcHMiLCJtZW50aW9uU3RvcmUiLCJzdWdnZXN0aW9uUmVnZXgiLCJwcmVmaXgiLCJNZW50aW9uQ29udGVudCIsImRlY29yYXRvcnMiLCJzdHJhdGVneSIsImNvbXBvbmVudCIsIm1lbnRpb25TdHlsZSIsIm1vZGUiLCJ1bnNoaWZ0IiwibmFtZSIsIlN1Z2dlc3Rpb25zIiwiZWRpdG9yU3RhdGUiLCJleHBvcnRDb250ZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxTQUFTQSxhQUFULENBQXVCQyxLQUF2QixFQUE4QkMsWUFBOUIsRUFBNENDLFFBQTVDLEVBQXNEO0FBQ3BEO0FBQ0EsTUFBTUMsSUFBSSxHQUFHRixZQUFZLENBQUNHLE9BQWIsRUFBYjtBQUNBLE1BQUlDLFFBQUo7QUFDQSxNQUFJQyxLQUFKLENB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TUFBQUEsUUFBUSxFQUFFOUIsc0JBRE87QUFFakIrQixNQUFBQSxTQUFTLEVBQUUsbUJBQUF2QixLQUFLO0FBQUEsZUFBSSxnQ0FBQyx1QkFBRDtBQUF5QixVQUFBLEdBQUcsRUFBRUM7QUFBOUIsV0FBdUNELEtBQXZDO0FBQThDLFVBQUEsU0FBUyxFQUFFRTtBQUF6RCxXQUFKO0FBQUE7QUFGQyxLQUFuQjtBQUlEOztBQUVELFNBQU87QUFDTHlCLElBQUFBLElBQUksRUFBRSxTQUREO0FBRUxDLElBQUFBLFdBQVcsRUFBRSxxQkFBQTVCLEtBQUs7QUFBQSxhQUFLLGdDQUFDLHdCQUFELGdDQUFpQkEsS0FBakIsRUFDakJnQixjQURpQjtBQUVyQixRQUFBLEtBQUssRUFBRUM7QUFGYyxTQUFMO0FBQUEsS0FGYjtBQU1MSSxJQUFBQSxVQUFVLEVBQVZBLFVBTks7QUFPTFosSUFBQUEsUUFBUSxFQUFFLGtCQUFDb0IsV0FBRCxFQUFpQjtBQUN6QixhQUFPM0IsU0FBUyxDQUFDTyxRQUFWLEdBQXFCUCxTQUFTLENBQUNPLFFBQVYsQ0FBbUJvQixXQUFuQixDQUFyQixHQUF1REEsV0FBOUQ7QUFDRCxLQVRJO0FBVUwzQixJQUFBQSxTQUFTLEVBQVRBLFNBVks7QUFXTCxjQUFRNEI7QUFYSCxHQUFQO0FBYUQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgY3JlYXRlRWxlbWVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBub29wIGZyb20gJ2xvZGFzaC9ub29wJztcbmltcG9ydCBTdWdnZXN0aW9ucyBmcm9tICcuLi9jb21wb25lbnQvU3VnZ2VzdGlvbnMucmVhY3QnO1xuaW1wb3J0IFN1Z2dlc3Rpb25Qb3J0YWwgZnJvbSAnLi4vY29tcG9uZW50L1N1Z2dlc3Rpb25Qb3J0YWwucmVhY3QnO1xuaW1wb3J0IE1lbnRpb25Db250ZW50IGZyb20gJy4uL2NvbXBvbmVudC9NZW50aW9uQ29udGVudC5yZWFjdCc7XG5pbXBvcnQgbWVudGlvblN0b3JlIGZyb20gJy4uL21vZGVsL21lbnRpb25TdG9yZSc7XG5pbXBvcnQgZXhwb3J0Q29udGVudCBmcm9tICcuL2V4cG9ydENvbnRlbnQnO1xuaW1wb3J0IGdldFJlZ0V4cCBmcm9tICcuLi91dGlscy9nZXRSZWdFeHAnO1xuXG5mdW5jdGlvbiBmaW5kV2l0aFJlZ2V4KHJlZ2V4LCBjb250ZW50QmxvY2ssIGNhbGxiYWNrKSB7XG4gIC8vIEdldCB0aGUgdGV4dCBmcm9tIHRoZSBjb250ZW50QmxvY2tcbiAgY29uc3QgdGV4dCA9IGNvbnRlbnRCbG9jay5nZXRUZXh0KCk7XG4gIGxldCBtYXRjaEFycjtcbiAgbGV0IHN0YXJ0OyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIC8vIEdvIHRocm91Z2ggYWxsIG1hdGNoZXMgaW4gdGhlIHRleHQgYW5kIHJldHVybiB0aGUgaW5kaXplcyB0byB0aGUgY2FsbGJhY2tcbiAgd2hpbGUgKChtYXRjaEFyciA9IHJlZ2V4LmV4ZWModGV4dCkpICE9PSBudWxsKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICBzdGFydCA9IG1hdGNoQXJyLmluZGV4O1xuICAgIGNhbGxiYWNrKHN0YXJ0LCBzdGFydCArIG1hdGNoQXJyWzBdLmxlbmd0aCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWVudGlvbkNvbnRlbnRTdHJhdGVneShjb250ZW50QmxvY2ssIGNhbGxiYWNrLCBjb250ZW50U3RhdGUpIHtcbiAgY29udGVudEJsb2NrLmZpbmRFbnRpdHlSYW5nZXMoKGNoYXJhY3RlcikgPT4ge1xuICAgIGNvbnN0IGVudGl0eUtleSA9IGNoYXJhY3Rlci5nZXRFbnRpdHkoKTtcbiAgICByZXR1cm4gZW50aXR5S2V5ICYmIGNvbnRlbnRTdGF0ZS5nZXRFbnRpdHkoZW50aXR5S2V5KS5nZXRUeXBlKCkgPT09ICdtZW50aW9uJztcbiAgfSwgY2FsbGJhY2spO1xufVxuXG5jb25zdCBNZW50aW9uQ29udGVudENvbXBvbmVudCA9IChwcm9wcykgPT4ge1xuICBjb25zdCB7IGVudGl0eUtleSwgdGFnLCBjYWxsYmFja3MgfSA9IHByb3BzO1xuICBjb25zdCBjb250ZW50U3RhdGUgPSBjYWxsYmFja3MuZ2V0RWRpdG9yU3RhdGUoKS5nZXRDdXJyZW50Q29udGVudCgpO1xuICBjb25zdCBkYXRhID0gY29udGVudFN0YXRlLmdldEVudGl0eShlbnRpdHlLZXkpLmdldERhdGEoKTtcbiAgcmV0dXJuIGNyZWF0ZUVsZW1lbnQodGFnLCB7IC4uLnByb3BzLCBkYXRhIH0pO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlTWVudGlvbihjb25maWcgPSB7fSkge1xuICBjb25zdCBjYWxsYmFja3MgPSB7XG4gICAgb25DaGFuZ2U6IG5vb3AsXG4gICAgb25VcEFycm93OiBub29wLFxuICAgIG9uRG93bkFycm93OiBub29wLFxuICAgIGdldEVkaXRvclN0YXRlOiBub29wLFxuICAgIHNldEVkaXRvclN0YXRlOiBub29wLFxuICAgIGhhbmRsZVJldHVybjogbm9vcCxcbiAgICBvbkJsdXI6IG5vb3AsXG4gIH07XG4gIGNvbnN0IGNvbXBvbmVudFByb3BzID0ge1xuICAgIGNhbGxiYWNrcyxcbiAgICBtZW50aW9uU3RvcmUsXG4gIH07XG4gIGNvbnN0IHN1Z2dlc3Rpb25SZWdleCA9IGdldFJlZ0V4cChjb25maWcucHJlZml4KTtcblxuICBjb25zdCB0YWcgPSBjb25maWcudGFnIHx8IE1lbnRpb25Db250ZW50O1xuICBjb25zdCBkZWNvcmF0b3JzID0gW3tcbiAgICBzdHJhdGVneTogKGNvbnRlbnRCbG9jaywgY2FsbGJhY2spID0+IHtcbiAgICAgIGZpbmRXaXRoUmVnZXgoc3VnZ2VzdGlvblJlZ2V4LCBjb250ZW50QmxvY2ssIGNhbGxiYWNrKTtcbiAgICB9LFxuICAgIGNvbXBvbmVudDogcHJvcHMgPT4gKDxTdWdnZXN0aW9uUG9ydGFsXG4gICAgICB7Li4ucHJvcHN9XG4gICAgICB7Li4uY29tcG9uZW50UHJvcHN9XG4gICAgICBzdHlsZT17Y29uZmlnLm1lbnRpb25TdHlsZX1cbiAgICAgIHN1Z2dlc3Rpb25SZWdleD17Z2V0UmVnRXhwKGNvbmZpZy5wcmVmaXgpfVxuICAgIC8+KSxcbiAgfV07XG4gIGlmIChjb25maWcubW9kZSAhPT0gJ2ltbXV0YWJsZScpIHtcbiAgICBkZWNvcmF0b3JzLnVuc2hpZnQoe1xuICAgICAgc3RyYXRlZ3k6IG1lbnRpb25Db250ZW50U3RyYXRlZ3ksXG4gICAgICBjb21wb25lbnQ6IHByb3BzID0+IDxNZW50aW9uQ29udGVudENvbXBvbmVudCB0YWc9e3RhZ30gey4uLnByb3BzfSBjYWxsYmFja3M9e2NhbGxiYWNrc30gLz4sXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG5hbWU6ICdtZW50aW9uJyxcbiAgICBTdWdnZXN0aW9uczogcHJvcHMgPT4gKDxTdWdnZXN0aW9ucyB7Li4ucHJvcHN9XG4gICAgICB7Li4uY29tcG9uZW50UHJvcHN9XG4gICAgICBzdG9yZT17bWVudGlvblN0b3JlfVxuICAgIC8+KSxcbiAgICBkZWNvcmF0b3JzLFxuICAgIG9uQ2hhbmdlOiAoZWRpdG9yU3RhdGUpID0+IHtcbiAgICAgIHJldHVybiBjYWxsYmFja3Mub25DaGFuZ2UgPyBjYWxsYmFja3Mub25DaGFuZ2UoZWRpdG9yU3RhdGUpIDogZWRpdG9yU3RhdGU7XG4gICAgfSxcbiAgICBjYWxsYmFja3MsXG4gICAgZXhwb3J0OiBleHBvcnRDb250ZW50LFxuICB9O1xufVxuIl19