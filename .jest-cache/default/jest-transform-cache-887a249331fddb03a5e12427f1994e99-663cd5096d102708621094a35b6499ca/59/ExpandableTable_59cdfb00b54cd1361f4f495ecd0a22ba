d83ccec6ee019b35579f6ad30f3b01f0
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _TableRow = _interopRequireDefault(require("./TableRow"));

var ExpandableTable =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(ExpandableTable, _Component);

  function ExpandableTable(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, ExpandableTable);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(ExpandableTable).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleExpandChange", function (expanded, record, event, rowKey) {
      var destroy = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;

      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }

      var _this$props = _this.props,
          onExpandedRowsChange = _this$props.onExpandedRowsChange,
          onExpand = _this$props.onExpand;

      var _this$store$getState = _this.store.getState(),
          expandedRowKeys = _this$store$getState.expandedRowKeys;

      if (expanded) {
        // row was expaned
        expandedRowKeys = [].concat((0, _toConsumableArray2["default"])(expandedRowKeys), [rowKey]);
      } else {
        // row was collapse
        var expandedRowIndex = expandedRowKeys.indexOf(rowKey);

        if (expandedRowIndex !== -1) {
          expandedRowKeys.splice(expandedRowIndex, 1);
        }
      }

      if (!_this.props.expandedRowKeys) {
        _this.store.setState({
          expandedRowKeys: expandedRowKeys
        });
      }

      onExpandedRowsChange(expandedRowKeys);

      if (!destroy) {
        onExpand(expanded, record);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderExpandIndentCell", function (rows, fixed) {
      var _this$props2 = _this.props,
          prefixCls = _this$props2.prefixCls,
          expandIconAsCell = _this$props2.expandIconAsCell;

      if (!expandIconAsCell || fixed === 'right' || !rows.length) {
        return;
      }

      var iconColumn = {
        key: 'rc-table-expand-icon-cell',
        className: "".concat(prefixCls, "-expand-icon-th"),
        title: '',
        rowSpan: rows.length
      };
      rows[0].unshift((0, _objectSpread2["default"])({}, iconColumn, {
        column: iconColumn
      }));
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderRows", function (renderRows, rows, record, index, indent, fixed, parentKey, ancestorKeys) {
      var _this$props3 = _this.props,
          expandedRowClassName = _this$props3.expandedRowClassName,
          expandedRowRender = _this$props3.expandedRowRender,
          childrenColumnName = _this$props3.childrenColumnName;
      var childrenData = record[childrenColumnName];
      var nextAncestorKeys = [].concat((0, _toConsumableArray2["default"])(ancestorKeys), [parentKey]);
      var nextIndent = indent + 1;

      if (expandedRowRender) {
        rows.push(_this.renderExpandedRow(record, index, expandedRowRender, expandedRowClassName(record, index, indent), nextAncestorKeys, nextIndent, fixed));
      }

      if (childrenData) {
        rows.push.apply(rows, (0, _toConsumableArray2["default"])(renderRows(childrenData, nextIndent, nextAncestorKeys)));
      }
    });
    var data = props.data,
        _childrenColumnName = props.childrenColumnName,
        defaultExpandAllRows = props.defaultExpandAllRows,
        _expandedRowKeys = props.expandedRowKeys,
        defaultExpandedRowKeys = props.defaultExpandedRowKeys,
        getRowKey = props.getRowKey;
    var finnalExpandedRowKeys = [];

    var _rows = (0, _toConsumableArray2["default"])(data);

    if (defaultExpandAllRows) {
      for (var i = 0; i < _rows.length; i++) {
        var row = _rows[i];
        finnalExpandedRowKeys.push(getRowKey(row, i));
        _rows = _rows.concat(row[_childrenColumnName] || []);
      }
    } else {
      finnalExpandedRowKeys = _expandedRowKeys || defaultExpandedRowKeys;
    }

    _this.columnManager = props.columnManager;
    _this.store = props.store;

    _this.store.setState({
      expandedRowsHeight: {},
      expandedRowKeys: finnalExpandedRowKeys
    });

    return _this;
  }

  (0, _createClass2["default"])(ExpandableTable, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('expandedRowKeys' in nextProps) {
        this.store.setState({
          expandedRowKeys: nextProps.expandedRowKeys
        });
      }
    }
  }, {
    key: "renderExpandedRow",
    value: function renderExpandedRow(record, index, _render, className, ancestorKeys, indent, fixed) {
      var _this$props4 = this.props,
          prefixCls = _this$props4.prefixCls,
          expandIconAsCell = _this$props4.expandIconAsCell,
          indentSize = _this$props4.indentSize;
      var colCount;

      if (fixed === 'left') {
        colCount = this.columnManager.leftLeafColumns().length;
      } else if (fixed === 'right') {
        colCount = this.columnManager.rightLeafColumns().length;
      } else {
        colCount = this.columnManager.leafColumns().length;
      }

      var columns = [{
        key: 'extra-row',
        render: function render() {
          return {
            props: {
              colSpan: colCount
            },
            children: fixed !== 'right' ? _render(record, index, indent) : '&nbsp;'
          };
        }
      }];

      if (expandIconAsCell && fixed !== 'right') {
        columns.unshift({
          key: 'expand-icon-placeholder',
          render: function render() {
            return null;
          }
        });
      }

      var parentKey = ancestorKeys[ancestorKeys.length - 1];
      var rowKey = "".concat(parentKey, "-extra-row");
      var components = {
        body: {
          row: 'tr',
          cell: 'td'
        }
      };
      return _react["default"].createElement(_TableRow["default"], {
        key: rowKey,
        columns: columns,
        className: className,
        rowKey: rowKey,
        ancestorKeys: ancestorKeys,
        prefixCls: "".concat(prefixCls, "-expanded-row"),
        indentSize: indentSize,
        indent: indent,
        fixed: fixed,
        components: components,
        expandedRow: true
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props5 = this.props,
          data = _this$props5.data,
          childrenColumnName = _this$props5.childrenColumnName,
          children = _this$props5.children;
      var needIndentSpaced = data.some(function (record) {
        return record[childrenColumnName];
      });
      return children({
        props: this.props,
        needIndentSpaced: needIndentSpaced,
        renderRows: this.renderRows,
        handleExpandChange: this.handleExpandChange,
        renderExpandIndentCell: this.renderExpandIndentCell
      });
    }
  }]);
  return ExpandableTable;
}(_react.Component);

(0, _defineProperty2["default"])(ExpandableTable, "propTypes", {
  expandIconAsCell: _propTypes["default"].bool,
  expandedRowKeys: _propTypes["default"].array,
  expandedRowClassName: _propTypes["default"].func,
  defaultExpandAllRows: _propTypes["default"].bool,
  defaultExpandedRowKeys: _propTypes["default"].array,
  expandIconColumnIndex: _propTypes["default"].number,
  expandedRowRender: _propTypes["default"].func,
  childrenColumnName: _propTypes["default"].string,
  indentSize: _propTypes["default"].number,
  onExpand: _propTypes["default"].func,
  onExpandedRowsChange: _propTypes["default"].func,
  columnManager: _propTypes["default"].object.isRequired,
  store: _propTypes["default"].object.isRequired,
  prefixCls: _propTypes["default"].string.isRequired,
  data: _propTypes["default"].array,
  children: _propTypes["default"].func.isRequired
});
(0, _defineProperty2["default"])(ExpandableTable, "defaultProps", {
  expandIconAsCell: false,
  expandedRowClassName: function expandedRowClassName() {
    return '';
  },
  expandIconColumnIndex: 0,
  defaultExpandAllRows: false,
  defaultExpandedRowKeys: [],
  childrenColumnName: 'children',
  indentSize: 15,
  onExpand: function onExpand() {},
  onExpandedRowsChange: function onExpandedRowsChange() {}
});

var _default = (0, _miniStore.connect)()(ExpandableTable);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4cGFuZGFibGVUYWJsZS5qc3giXSwibmFtZXMiOlsiRXhwYW5kYWJsZVRhYmxlIiwicHJvcHMiLCJleHBhbmRlZCIsInJlY29yZCIsImV2ZW50Iiwicm93S2V5IiwiZGVzdHJveSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwib25FeHBhbmRlZFJvd3NDaGFuZ2UiLCJvbkV4cGFuZCIsInN0b3JlIiwiZ2V0U3RhdGUiLCJleHBhbmRlZFJvd0tleXMiLCJleHBhbmRlZFJvd0luZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsInNldFN0YXRlIiwicm93cyIsImZpeGVkIiwicHJlZml4Q2xzIiwiZXhwYW5kSWNvbkFzQ2VsbCIsImxlbmd0aCIsImljb25Db2x1bW4iLCJrZXkiLCJjbGFzc05hbWUiLCJ0aXRsZSIsInJvd1NwYW4iLCJ1bnNoaWZ0IiwiY29sdW1uIiwicmVuZGVyUm93cyIsImluZGV4IiwiaW5kZW50IiwicGFyZW50S2V5IiwiYW5jZXN0b3JLZXlzIiwiZXhwYW5kZWRSb3dDbGFzc05hbWUiLCJleHBhbmRlZFJvd1JlbmRlciIsImNoaWxkcmVuQ29sdW1uTmFtZSIsImNoaWxkcmVuRGF0YSIsIm5leHRBbmNlc3RvcktleXMiLCJuZXh0SW5kZW50IiwicHVzaCIsInJlbmRlckV4cGFuZGVkUm93IiwiZGF0YSIsImRlZmF1bHRFeHBhbmRBbGxSb3dzIiwiZGVmYXVsdEV4cGFuZGVkUm93S2V5cyIsImdldFJvd0tleSIsImZpbm5hbEV4cGFuZGVkUm93S2V5cyIsImkiLCJyb3ciLCJjb25jYXQiLCJjb2x1bW5NYW5hZ2VyIiwiZXhwYW5kZWRSb3dzSGVpZ2h0IiwibmV4dFByb3BzIiwicmVuZGVyIiwiaW5kZW50U2l6ZSIsImNvbENvdW50IiwibGVmdExlYWZDb2x1bW5zIiwicmlnaHRMZWFmQ29sdW1ucyIsImxlYWZDb2x1bW5zIiwiY29sdW1ucyIsImNvbFNwYW4iLCJjaGlsZHJlbiIsImNvbXBvbmVudHMiLCJib2R5IiwiY2VsbCIsIm5lZWRJbmRlbnRTcGFjZWQiLCJzb21lIiwiaGFuZGxlRXhwYW5kQ2hhbmdlIiwicmVuZGVyRXhwYW5kSW5kZW50Q2VsbCIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImJvb2wiLCJhcnJheSIsImZ1bmMiLCJleHBhbmRJY29uQ29sdW1uSW5kZXgiLCJudW1iZXIiLCJzdHJpbmciLCJvYmplY3QiLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztJQUVNQSxlOzs7OztBQWtDSiwyQkFBWUMsS0FBWixFQUFtQjtBQUFBOztBQUFBO0FBQ2pCLDJIQUFNQSxLQUFOO0FBRGlCLDJHQTBDRSxVQUFDQyxRQUFELEVBQVdDLE1BQVgsRUFBbUJDLEtBQW5CLEVBQTBCQyxNQUExQixFQUFzRDtBQUFBLFVBQXBCQyxPQUFvQix1RUFBVixLQUFVOztBQUN6RSxVQUFJRixLQUFKLEVBQVc7QUFDVEEsUUFBQUEsS0FBSyxDQUFDRyxjQUFOO0FBQ0FILFFBQUFBLEtBQUssQ0FBQ0ksZUFBTjtBQUNEOztBQUp3RSx3QkFNOUIsTUFBS1AsS0FOeUI7QUFBQSxVQU1qRVEsb0JBTmlFLGVBTWpFQSxvQkFOaUU7QUFBQSxVQU0zQ0MsUUFOMkMsZUFNM0NBLFFBTjJDOztBQUFBLGlDQU8vQyxNQUFLQyxLQUFMLENBQVdDLFFBQVgsRUFQK0M7QUFBQSxVQU9uRUMsZUFQbUUsd0JBT25FQSxlQVBtRTs7QUFTekUsVUFBSVgsUUFBSixFQUFjO0FBQ1o7QUFDQVcsUUFBQUEsZUFBZSxpREFBT0EsZUFBUCxJQUF3QlIsTUFBeEIsRUFBZjtBQUNELE9BSEQsTUFHTztBQUNMO0FBQ0EsWUFBTVMsZ0JBQWdCLEdBQUdELGVBQWUsQ0FBQ0UsT0FBaEIsQ0FBd0JWLE1BQXhCLENBQXpCOztBQUNBLFlBQUlTLGdCQUFnQixLQUFLLENBQUMsQ0FBMUIsRUFBNkI7QUFDM0JELFVBQUFBLGVBQWUsQ0FBQ0csTUFBaEIsQ0FBdUJGLGdCQUF2QixF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QUUsRUFQUTtBQVFwQjdDLEVBQUFBLFFBUm9CLHNCQVFULENBQ1YsQ0FUbUI7QUFVcEJELEVBQUFBLG9CQVZvQixrQ0FVRyxDQUN0QjtBQVhtQixDOztlQXNNVCwwQkFBVVQsZUFBVixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAnbWluaS1zdG9yZSc7XG5pbXBvcnQgVGFibGVSb3cgZnJvbSAnLi9UYWJsZVJvdyc7XG5cbmNsYXNzIEV4cGFuZGFibGVUYWJsZSBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZXhwYW5kSWNvbkFzQ2VsbDogUHJvcFR5cGVzLmJvb2wsXG4gICAgZXhwYW5kZWRSb3dLZXlzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgZXhwYW5kZWRSb3dDbGFzc05hbWU6IFByb3BUeXBlcy5mdW5jLFxuICAgIGRlZmF1bHRFeHBhbmRBbGxSb3dzOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBkZWZhdWx0RXhwYW5kZWRSb3dLZXlzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgZXhwYW5kSWNvbkNvbHVtbkluZGV4OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGV4cGFuZGVkUm93UmVuZGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBjaGlsZHJlbkNvbHVtbk5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgaW5kZW50U2l6ZTogUHJvcFR5cGVzLm51bWJlcixcbiAgICBvbkV4cGFuZDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25FeHBhbmRlZFJvd3NDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNvbHVtbk1hbmFnZXI6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBzdG9yZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGRhdGE6IFByb3BUeXBlcy5hcnJheSxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGV4cGFuZEljb25Bc0NlbGw6IGZhbHNlLFxuICAgIGV4cGFuZGVkUm93Q2xhc3NOYW1lOiAoKSA9PiAnJyxcbiAgICBleHBhbmRJY29uQ29sdW1uSW5kZXg6IDAsXG4gICAgZGVmYXVsdEV4cGFuZEFsbFJvd3M6IGZhbHNlLFxuICAgIGRlZmF1bHRFeHBhbmRlZFJvd0tleXM6IFtdLFxuICAgIGNoaWxkcmVuQ29sdW1uTmFtZTogJ2NoaWxkcmVuJyxcbiAgICBpbmRlbnRTaXplOiAxNSxcbiAgICBvbkV4cGFuZCgpIHtcbiAgICB9LFxuICAgIG9uRXhwYW5kZWRSb3dzQ2hhbmdlKCkge1xuICAgIH0sXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICBjb25zdCB7XG4gICAgICBkYXRhLFxuICAgICAgY2hpbGRyZW5Db2x1bW5OYW1lLFxuICAgICAgZGVmYXVsdEV4cGFuZEFsbFJvd3MsXG4gICAgICBleHBhbmRlZFJvd0tleXMsXG4gICAgICBkZWZhdWx0RXhwYW5kZWRSb3dLZXlzLFxuICAgICAgZ2V0Um93S2V5LFxuICAgIH0gPSBwcm9wcztcblxuICAgIGxldCBmaW5uYWxFeHBhbmRlZFJvd0tleXMgPSBbXTtcbiAgICBsZXQgcm93cyA9IFsuLi5kYXRhXTtcblxuICAgIGlmIChkZWZhdWx0RXhwYW5kQWxsUm93cykge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJvdyA9IHJvd3NbaV07XG4gICAgICAgIGZpbm5hbEV4cGFuZGVkUm93S2V5cy5wdXNoKGdldFJvd0tleShyb3csIGkpKTtcbiAgICAgICAgcm93cyA9IHJvd3MuY29uY2F0KHJvd1tjaGlsZHJlbkNvbHVtbk5hbWVdIHx8IFtdKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZmlubmFsRXhwYW5kZWRSb3dLZXlzID0gZXhwYW5kZWRSb3dLZXlzIHx8IGRlZmF1bHRFeHBhbmRlZFJvd0tleXM7XG4gICAgfVxuXG4gICAgdGhpcy5jb2x1bW5NYW5hZ2VyID0gcHJvcHMuY29sdW1uTWFuYWdlcjtcbiAgICB0aGlzLnN0b3JlID0gcHJvcHMuc3RvcmU7XG5cbiAgICB0aGlzLnN0b3JlLnNldFN0YXRlKHtcbiAgICAgIGV4cGFuZGVkUm93c0hlaWdodDoge30sXG4gICAgICBleHBhbmRlZFJvd0tleXM6IGZpbm5hbEV4cGFuZGVkUm93S2V5cyxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKCdleHBhbmRlZFJvd0tleXMnIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zdG9yZS5zZXRTdGF0ZSh7XG4gICAgICAgIGV4cGFuZGVkUm93S2V5czogbmV4dFByb3BzLmV4cGFuZGVkUm93S2V5cyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUV4cGFuZENoYW5nZSA9IChleHBhbmRlZCwgcmVjb3JkLCBldmVudCwgcm93S2V5LCBkZXN0cm95ID0gZmFsc2UpID0+IHtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IG9uRXhwYW5kZWRSb3dzQ2hhbmdlLCBvbkV4cGFuZCB9ID0gdGhpcy5wcm9wcztcbiAgICBsZXQgeyBleHBhbmRlZFJvd0tleXMgfSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcblxuICAgIGlmIChleHBhbmRlZCkge1xuICAgICAgLy8gcm93IHdhcyBleHBhbmVkXG4gICAgICBleHBhbmRlZFJvd0tleXMgPSBbLi4uZXhwYW5kZWRSb3dLZXlzLCByb3dLZXldO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyByb3cgd2FzIGNvbGxhcHNlXG4gICAgICBjb25zdCBleHBhbmRlZFJvd0luZGV4ID0gZXhwYW5kZWRSb3dLZXlzLmluZGV4T2Yocm93S2V5KTtcbiAgICAgIGlmIChleHBhbmRlZFJvd0luZGV4ICE9PSAtMSkge1xuICAgICAgICBleHBhbmRlZFJvd0tleXMuc3BsaWNlKGV4cGFuZGVkUm93SW5kZXgsIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghdGhpcy5wcm9wcy5leHBhbmRlZFJvd0tleXMpIHtcbiAgICAgIHRoaXMuc3RvcmUuc2V0U3RhdGUoeyBleHBhbmRlZFJvd0tleXMgfSk7XG4gICAgfVxuXG4gICAgb25FeHBhbmRlZFJvd3NDaGFuZ2UoZXhwYW5kZWRSb3dLZXlzKTtcbiAgICBpZiAoIWRlc3Ryb3kpIHtcbiAgICAgIG9uRXhwYW5kKGV4cGFuZGVkLCByZWNvcmQpO1xuICAgIH1cbiAgfTtcblxuICByZW5kZXJFeHBhbmRJbmRlbnRDZWxsID0gKHJvd3MsIGZpeGVkKSA9PiB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIGV4cGFuZEljb25Bc0NlbGwgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCFleHBhbmRJY29uQXNDZWxsIHx8IGZpeGVkID09PSAncmlnaHQnIHx8ICFyb3dzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGljb25Db2x1bW4gPSB7XG4gICAgICBrZXk6ICdyYy10YWJsZS1leHBhbmQtaWNvbi1jZWxsJyxcbiAgICAgIGNsYXNzTmFtZTogYCR7cHJlZml4Q2xzfS1leHBhbmQtaWNvbi10aGAsXG4gICAgICB0aXRsZTogJycsXG4gICAgICByb3dTcGFuOiByb3dzLmxlbmd0aCxcbiAgICB9O1xuXG4gICAgcm93c1swXS51bnNoaWZ0KHsgLi4uaWNvbkNvbHVtbiwgY29sdW1uOiBpY29uQ29sdW1uIH0pO1xuICB9O1xuXG4gIHJlbmRlckV4cGFuZGVkUm93KHJlY29yZCwgaW5kZXgsIHJlbmRlciwgY2xhc3NOYW1lLCBhbmNlc3RvcktleXMsIGluZGVudCwgZml4ZWQpIHtcbiAgICBjb25zdCB7IHByZWZpeENscywgZXhwYW5kSWNvbkFzQ2VsbCwgaW5kZW50U2l6ZSB9ID0gdGhpcy5wcm9wcztcbiAgICBsZXQgY29sQ291bnQ7XG4gICAgaWYgKGZpeGVkID09PSAnbGVmdCcpIHtcbiAgICAgIGNvbENvdW50ID0gdGhpcy5jb2x1bW5NYW5hZ2VyLmxlZnRMZWFmQ29sdW1ucygpLmxlbmd0aDtcbiAgICB9IGVsc2UgaWYgKGZpeGVkID09PSAncmlnaHQnKSB7XG4gICAgICBjb2xDb3VudCA9IHRoaXMuY29sdW1uTWFuYWdlci5yaWdodExlYWZDb2x1bW5zKCkubGVuZ3RoO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb2xDb3VudCA9IHRoaXMuY29sdW1uTWFuYWdlci5sZWFmQ29sdW1ucygpLmxlbmd0aDtcbiAgICB9XG4gICAgY29uc3QgY29sdW1ucyA9IFt7XG4gICAgICBrZXk6ICdleHRyYS1yb3cnLFxuICAgICAgcmVuZGVyOiAoKSA9PiAoe1xuICAgICAgICBwcm9wczoge1xuICAgICAgICAgIGNvbFNwYW46IGNvbENvdW50LFxuICAgICAgICB9LFxuICAgICAgICBjaGlsZHJlbjogZml4ZWQgIT09ICdyaWdodCcgPyByZW5kZXIocmVjb3JkLCBpbmRleCwgaW5kZW50KSA6ICcmbmJzcDsnLFxuICAgICAgfSksXG4gICAgfV07XG4gICAgaWYgKGV4cGFuZEljb25Bc0NlbGwgJiYgZml4ZWQgIT09ICdyaWdodCcpIHtcbiAgICAgIGNvbHVtbnMudW5zaGlmdCh7XG4gICAgICAgIGtleTogJ2V4cGFuZC1pY29uLXBsYWNlaG9sZGVyJyxcbiAgICAgICAgcmVuZGVyOiAoKSA9PiBudWxsLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHBhcmVudEtleSA9IGFuY2VzdG9yS2V5c1thbmNlc3RvcktleXMubGVuZ3RoIC0gMV07XG4gICAgY29uc3Qgcm93S2V5ID0gYCR7cGFyZW50S2V5fS1leHRyYS1yb3dgO1xuICAgIGNvbnN0IGNvbXBvbmVudHMgPSB7XG4gICAgICBib2R5OiB7XG4gICAgICAgIHJvdzogJ3RyJyxcbiAgICAgICAgY2VsbDogJ3RkJyxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8VGFibGVSb3dcbiAgICAgICAga2V5PXtyb3dLZXl9XG4gICAgICAgIGNvbHVtbnM9e2NvbHVtbnN9XG4gICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lfVxuICAgICAgICByb3dLZXk9e3Jvd0tleX1cbiAgICAgICAgYW5jZXN0b3JLZXlzPXthbmNlc3RvcktleXN9XG4gICAgICAgIHByZWZpeENscz17YCR7cHJlZml4Q2xzfS1leHBhbmRlZC1yb3dgfVxuICAgICAgICBpbmRlbnRTaXplPXtpbmRlbnRTaXplfVxuICAgICAgICBpbmRlbnQ9e2luZGVudH1cbiAgICAgICAgZml4ZWQ9e2ZpeGVkfVxuICAgICAgICBjb21wb25lbnRzPXtjb21wb25lbnRzfVxuICAgICAgICBleHBhbmRlZFJvd1xuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyUm93cyA9IChyZW5kZXJSb3dzLCByb3dzLCByZWNvcmQsIGluZGV4LCBpbmRlbnQsIGZpeGVkLCBwYXJlbnRLZXksIGFuY2VzdG9yS2V5cykgPT4ge1xuICAgIGNvbnN0IHsgZXhwYW5kZWRSb3dDbGFzc05hbWUsIGV4cGFuZGVkUm93UmVuZGVyLCBjaGlsZHJlbkNvbHVtbk5hbWUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY2hpbGRyZW5EYXRhID0gcmVjb3JkW2NoaWxkcmVuQ29sdW1uTmFtZV07XG4gICAgY29uc3QgbmV4dEFuY2VzdG9yS2V5cyA9IFsuLi5hbmNlc3RvcktleXMsIHBhcmVudEtleV07XG4gICAgY29uc3QgbmV4dEluZGVudCA9IGluZGVudCArIDE7XG5cbiAgICBpZiAoZXhwYW5kZWRSb3dSZW5kZXIpIHtcbiAgICAgIHJvd3MucHVzaChcbiAgICAgICAgdGhpcy5yZW5kZXJFeHBhbmRlZFJvdyhcbiAgICAgICAgICByZWNvcmQsXG4gICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgZXhwYW5kZWRSb3dSZW5kZXIsXG4gICAgICAgICAgZXhwYW5kZWRSb3dDbGFzc05hbWUocmVjb3JkLCBpbmRleCwgaW5kZW50KSxcbiAgICAgICAgICBuZXh0QW5jZXN0b3JLZXlzLFxuICAgICAgICAgIG5leHRJbmRlbnQsXG4gICAgICAgICAgZml4ZWQsXG4gICAgICAgICksXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChjaGlsZHJlbkRhdGEpIHtcbiAgICAgIHJvd3MucHVzaChcbiAgICAgICAgLi4ucmVuZGVyUm93cyhcbiAgICAgICAgICBjaGlsZHJlbkRhdGEsXG4gICAgICAgICAgbmV4dEluZGVudCxcbiAgICAgICAgICBuZXh0QW5jZXN0b3JLZXlzLFxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBkYXRhLCBjaGlsZHJlbkNvbHVtbk5hbWUsIGNoaWxkcmVuIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG5lZWRJbmRlbnRTcGFjZWQgPSBkYXRhLnNvbWUocmVjb3JkID0+IHJlY29yZFtjaGlsZHJlbkNvbHVtbk5hbWVdKTtcblxuICAgIHJldHVybiBjaGlsZHJlbih7XG4gICAgICBwcm9wczogdGhpcy5wcm9wcyxcbiAgICAgIG5lZWRJbmRlbnRTcGFjZWQsXG4gICAgICByZW5kZXJSb3dzOiB0aGlzLnJlbmRlclJvd3MsXG4gICAgICBoYW5kbGVFeHBhbmRDaGFuZ2U6IHRoaXMuaGFuZGxlRXhwYW5kQ2hhbmdlLFxuICAgICAgcmVuZGVyRXhwYW5kSW5kZW50Q2VsbDogdGhpcy5yZW5kZXJFeHBhbmRJbmRlbnRDZWxsLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QoKShFeHBhbmRhYmxlVGFibGUpO1xuIl19