de39843a9cfd42529c1576f30ef6e592
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = calculateNodeHeight; // Thanks to https://github.com/andreypopp/react-textarea-autosize/

/**
 * calculateNodeHeight(uiTextNode, useCache = false)
 */

var HIDDEN_TEXTAREA_STYLE = "\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n";
var SIZING_STYLE = ['letter-spacing', 'line-height', 'padding-top', 'padding-bottom', 'font-family', 'font-weight', 'font-size', 'text-rendering', 'text-transform', 'width', 'text-indent', 'padding-left', 'padding-right', 'border-width', 'box-sizing'];
var computedStyleCache = {};
var hiddenTextarea;

function calculateNodeStyling(node) {
  var useCache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var nodeRef = node.getAttribute('id') || node.getAttribute('data-reactid') || node.getAttribute('name');

  if (useCache && computedStyleCache[nodeRef]) {
    return computedStyleCache[nodeRef];
  }

  var style = window.getComputedStyle(node);
  var boxSizing = style.getPropertyValue('box-sizing') || style.getPropertyValue('-moz-box-sizing') || style.getPropertyValue('-webkit-box-sizing');
  var paddingSize = parseFloat(style.getPropertyValue('padding-bottom')) + parseFloat(style.getPropertyValue('padding-top'));
  var borderSize = parseFloat(style.getPropertyValue('border-bottom-width')) + parseFloat(style.getPropertyValue('border-top-width'));
  var sizingStyle = SIZING_STYLE.map(function (name) {
    return "".concat(name, ":").concat(style.getPropertyValue(name));
  }).join(';');
  var nodeInfo = {
    sizingStyle: sizingStyle,
    paddingSize: paddingSize,
    borderSize: borderSize,
    boxSizing: boxSizing
  };

  if (useCache && nodeRef) {
    computedStyleCache[nodeRef] = nodeInfo;
  }

  return nodeInfo;
}

function calculateNodeHeight(uiTextNode) {
  var useCache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var minRows = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
  var maxRows = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;

  if (!hiddenTextarea) {
    hiddenTextarea = document.createElement('textarea');
    document.body.appendChild(hiddenTextarea);
  } // Fix wrap="off" issue


  if (uiTextNode.getAttribute('wrap')) {
    hiddenTextarea.setAttribute('wrap', uiTextNode.getAttribute('wrap'));
  } else {
    hiddenTextarea.removeAttribute('wrap');
  } // Copy all CSS properties that have an impact on the height of the content in
  // the textbox


  var _calculateNodeStyling = calculateNodeStyling(uiTextNode, useCache),
      paddingSize = _calculateNodeStyling.paddingSize,
      borderSize = _calculateNodeStyling.borderSize,
      boxSizing = _calculateNodeStyling.boxSizing,
      sizingStyle = _calculateNodeStyling.sizingStyle; // Need to have the overflow attribute to hide the scrollbar otherwise
  // text-lines will not calculated properly as the shadow will technically be
  // narrower for content


  hiddenTextarea.setAttribute('style', "".concat(sizingStyle, ";").concat(HIDDEN_TEXTAREA_STYLE));
  hiddenTextarea.value = uiTextNode.value || uiTextNode.placeholder || '';
  var minHeight = Number.MIN_SAFE_INTEGER;
  var maxHeight = Number.MAX_SAFE_INTEGER;
  var height = hiddenTextarea.scrollHeight;
  var overflowY;

  if (boxSizing === 'border-box') {
    // border-box: add border, since height = content + padding + border
    height += borderSize;
  } else if (boxSizing === 'content-box') {
    // remove padding, since height = content
    height -= paddingSize;
  }

  if (minRows !== null || maxRows !== null) {
    // measure height of a textarea with a single row
    hiddenTextarea.value = ' ';
    var singleRowHeight = hiddenTextarea.scrollHeight - paddingSize;

    if (minRows !== null) {
      minHeight = singleRowHeight * minRows;

      if (boxSizing === 'border-box') {
        minHeight = minHeight + paddingSize + borderSize;
      }

      height = Math.max(minHeight, height);
    }

    if (maxRows !== null) {
      maxHeight = singleRowHeight * maxRows;

      if (boxSizing === 'border-box') {
        maxHeight = maxHeight + paddingSize + borderSize;
      }

      overflowY = height > maxHeight ? '' : 'hidden';
      height = Math.min(maxHeight, height);
    }
  } // Remove scroll bar flash when autosize without maxRows


  if (!maxRows) {
    overflowY = 'hidden';
  }

  return {
    height: height,
    minHeight: minHeight,
    maxHeight: maxHeight,
    overflowY: overflowY
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlucHV0L2NhbGN1bGF0ZU5vZGVIZWlnaHQuanMiXSwibmFtZXMiOlsiSElEREVOX1RFWFRBUkVBX1NUWUxFIiwiU0laSU5HX1NUWUxFIiwiY29tcHV0ZWRTdHlsZUNhY2hlIiwidXNlQ2FjaGUiLCJub2RlUmVmIiwibm9kZSIsInN0eWxlIiwid2luZG93IiwiYm94U2l6aW5nIiwicGFkZGluZ1NpemUiLCJwYXJzZUZsb2F0IiwiYm9yZGVyU2l6ZSIsInNpemluZ1N0eWxlIiwibm9kZUluZm8iLCJtaW5Sb3dzIiwibWF4Um93cyIsImhpZGRlblRleHRhcmVhIiwiZG9jdW1lbnQiLCJ1aVRleHROb2RlIiwiY2FsY3VsYXRlTm9kZVN0eWxpbmciLCJtaW5IZWlnaHQiLCJOdW1iZXIiLCJtYXhIZWlnaHQiLCJoZWlnaHQiLCJzaW5nbGVSb3dIZWlnaHQiLCJNYXRoIiwib3ZlcmZsb3dZIl0sIm1hcHBpbmdzIjoiOzs7OzswQ0FBQTs7QUFDQTs7OztBQUdBLElBQU1BLHFCQUFxQixHQUEzQixnUUFBQTtBQVdBLElBQU1DLFlBQVksR0FBRyxDQUFBLGdCQUFBLEVBQUEsYUFBQSxFQUFBLGFBQUEsRUFBQSxnQkFBQSxFQUFBLGFBQUEsRUFBQSxhQUFBLEVBQUEsV0FBQSxFQUFBLGdCQUFBLEVBQUEsZ0JBQUEsRUFBQSxPQUFBLEVBQUEsYUFBQSxFQUFBLGNBQUEsRUFBQSxlQUFBLEVBQUEsY0FBQSxFQUFyQixZQUFxQixDQUFyQjtBQWlCQSxJQUFNQyxrQkFBa0IsR0FBeEIsRUFBQTtBQUNBLElBQUEsY0FBQTs7QUFDQSxTQUFBLG9CQUFBLENBQUEsSUFBQSxFQUFzRDtBQUFBLE1BQWxCQyxRQUFrQixHQUFBLFNBQUEsQ0FBQSxNQUFBLEdBQUEsQ0FBQSxJQUFBLFNBQUEsQ0FBQSxDQUFBLENBQUEsS0FBQSxTQUFBLEdBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFQLEtBQU87QUFDbEQsTUFBTUMsT0FBTyxHQUFJQyxJQUFJLENBQUpBLFlBQUFBLENBQUFBLElBQUFBLEtBQ2JBLElBQUksQ0FBSkEsWUFBQUEsQ0FEYUEsY0FDYkEsQ0FEYUEsSUFFYkEsSUFBSSxDQUFKQSxZQUFBQSxDQUZKLE1BRUlBLENBRko7O0FBR0EsTUFBSUYsUUFBUSxJQUFJRCxrQkFBa0IsQ0FBbEMsT0FBa0MsQ0FBbEMsRUFBNkM7QUFDekMsV0FBT0Esa0JBQWtCLENBQXpCLE9BQXlCLENBQXpCO0FBQ0g7O0FBQ0QsTUFBTUksS0FBSyxHQUFHQyxNQUFNLENBQU5BLGdCQUFBQSxDQUFkLElBQWNBLENBQWQ7QUFDQSxNQUFNQyxTQUFTLEdBQUdGLEtBQUssQ0FBTEEsZ0JBQUFBLENBQUFBLFlBQUFBLEtBQ2RBLEtBQUssQ0FBTEEsZ0JBQUFBLENBRGNBLGlCQUNkQSxDQURjQSxJQUVkQSxLQUFLLENBQUxBLGdCQUFBQSxDQUZKLG9CQUVJQSxDQUZKO0FBR0EsTUFBTUcsV0FBVyxHQUFHQyxVQUFVLENBQUNKLEtBQUssQ0FBTEEsZ0JBQUFBLENBQVhJLGdCQUFXSixDQUFELENBQVZJLEdBQ2hCQSxVQUFVLENBQUNKLEtBQUssQ0FBTEEsZ0JBQUFBLENBRGYsYUFDZUEsQ0FBRCxDQURkO0FBRUEsTUFBTUssVUFBVSxHQUFHRCxVQUFVLENBQUNKLEtBQUssQ0FBTEEsZ0JBQUFBLENBQVhJLHFCQUFXSixDQUFELENBQVZJLEdBQ2ZBLFVBQVUsQ0FBQ0osS0FBSyxDQUFMQSxnQkFBQUEsQ0FEZixrQkFDZUEsQ0FBRCxDQURkO0FBRUEsTUFBTU0sV0FBVyxHQUFHLFlBQVksQ0FBWixHQUFBLENBQWlCLFVBQUEsSUFBQSxFQUFJO0FBQUEsV0FBQSxHQUFBLE1BQUEsQ0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLE1BQUEsQ0FBZU4sS0FBSyxDQUFMQSxnQkFBQUEsQ0FBZixJQUFlQSxDQUFmLENBQUE7QUFBckIsR0FBQSxFQUFBLElBQUEsQ0FBcEIsR0FBb0IsQ0FBcEI7QUFDQSxNQUFNTyxRQUFRLEdBQUc7QUFDYkQsSUFBQUEsV0FBVyxFQURFLFdBQUE7QUFFYkgsSUFBQUEsV0FBVyxFQUZFLFdBQUE7QUFHYkUsSUFBQUEsVUFBVSxFQUhHLFVBQUE7QUFJYkgsSUFBQUEsU0FBUyxFQUFUQTtBQUphLEdBQWpCOztBQU1BLE1BQUlMLFFBQVEsSUFBWixPQUFBLEVBQXlCO0FBQ3JCRCxJQUFBQSxrQkFBa0IsQ0FBbEJBLE9BQWtCLENBQWxCQSxHQUFBQSxRQUFBQTtBQUNIOztBQUNELFNBQUEsUUFBQTtBQUNIOztBQUNjLFNBQUEsbUJBQUEsQ0FBQSxVQUFBLEVBQTJGO0FBQUEsTUFBbERDLFFBQWtELEdBQUEsU0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLElBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLFNBQUEsR0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLEdBQXZDLEtBQXVDO0FBQUEsTUFBaENXLE9BQWdDLEdBQUEsU0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLElBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLFNBQUEsR0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLEdBQXRCLElBQXNCO0FBQUEsTUFBaEJDLE9BQWdCLEdBQUEsU0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLElBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLFNBQUEsR0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLEdBQU4sSUFBTTs7QUFDdEcsTUFBSSxDQUFKLGNBQUEsRUFBcUI7QUFDakJDLElBQUFBLGNBQWMsR0FBR0MsUUFBUSxDQUFSQSxhQUFBQSxDQUFqQkQsVUFBaUJDLENBQWpCRDtBQUNBQyxJQUFBQSxRQUFRLENBQVJBLElBQUFBLENBQUFBLFdBQUFBLENBQUFBLGNBQUFBO0FBSGtHLEdBQUEsQ0FLdEc7OztBQUNBLE1BQUlDLFVBQVUsQ0FBVkEsWUFBQUEsQ0FBSixNQUFJQSxDQUFKLEVBQXFDO0FBQ2pDRixJQUFBQSxjQUFjLENBQWRBLFlBQUFBLENBQUFBLE1BQUFBLEVBQW9DRSxVQUFVLENBQVZBLFlBQUFBLENBQXBDRixNQUFvQ0UsQ0FBcENGO0FBREosR0FBQSxNQUdLO0FBQ0RBLElBQUFBLGNBQWMsQ0FBZEEsZUFBQUEsQ0FBQUEsTUFBQUE7QUFWa0csR0FBQSxDQVl0RztBQUNBOzs7QUFic0csTUFBQSxxQkFBQSxHQWMxQ0csb0JBQW9CLENBQUEsVUFBQSxFQWRzQixRQWN0QixDQWRzQjtBQUFBLE1BYzlGVixXQWQ4RixHQUFBLHFCQUFBLENBQUEsV0FBQTtBQUFBLE1BY2pGRSxVQWRpRixHQUFBLHFCQUFBLENBQUEsVUFBQTtBQUFBLE1BY3JFSCxTQWRxRSxHQUFBLHFCQUFBLENBQUEsU0FBQTtBQUFBLE1BYzFESSxXQWQwRCxHQUFBLHFCQUFBLENBQUEsV0FBQSxDQUFBLENBZXRHO0FBQ0E7QUFDQTs7O0FBQ0FJLEVBQUFBLGNBQWMsQ0FBZEEsWUFBQUEsQ0FBQUEsT0FBQUEsRUFBQUEsR0FBQUEsTUFBQUEsQ0FBQUEsV0FBQUEsRUFBQUEsR0FBQUEsRUFBQUEsTUFBQUEsQ0FBQUEscUJBQUFBLENBQUFBO0FBQ0FBLEVBQUFBLGNBQWMsQ0FBZEEsS0FBQUEsR0FBdUJFLFVBQVUsQ0FBVkEsS0FBQUEsSUFBb0JBLFVBQVUsQ0FBOUJBLFdBQUFBLElBQXZCRixFQUFBQTtBQUNBLE1BQUlJLFNBQVMsR0FBR0MsTUFBTSxDQUF0QixnQkFBQTtBQUNBLE1BQUlDLFNBQVMsR0FBR0QsTUFBTSxDQUF0QixnQkFBQTtBQUNBLE1BQUlFLE1BQU0sR0FBR1AsY0FBYyxDQUEzQixZQUFBO0FBQ0EsTUFBQSxTQUFBOztBQUNBLE1BQUlSLFNBQVMsS0FBYixZQUFBLEVBQWdDO0FBQzVCO0FBQ0FlLElBQUFBLE1BQU0sSUFBTkEsVUFBQUE7QUFGSixHQUFBLE1BSUssSUFBSWYsU0FBUyxLQUFiLGFBQUEsRUFBaUM7QUFDbEM7QUFDQWUsSUFBQUEsTUFBTSxJQUFOQSxXQUFBQTtBQUNIOztBQUNELE1BQUlULE9BQU8sS0FBUEEsSUFBQUEsSUFBb0JDLE9BQU8sS0FBL0IsSUFBQSxFQUEwQztBQUN0QztBQUNBQyxJQUFBQSxjQUFjLENBQWRBLEtBQUFBLEdBQUFBLEdBQUFBO0FBQ0EsUUFBTVEsZUFBZSxHQUFHUixjQUFjLENBQWRBLFlBQUFBLEdBQXhCLFdBQUE7O0FBQ0EsUUFBSUYsT0FBTyxLQUFYLElBQUEsRUFBc0I7QUFDbEJNLE1BQUFBLFNBQVMsR0FBR0ksZUFBZSxHQUEzQkosT0FBQUE7O0FBQ0EsVUFBSVosU0FBUyxLQUFiLFlBQUEsRUFBZ0M7QUFDNUJZLFFBQUFBLFNBQVMsR0FBR0EsU0FBUyxHQUFUQSxXQUFBQSxHQUFaQSxVQUFBQTtBQUNIOztBQUNERyxNQUFBQSxNQUFNLEdBQUdFLElBQUksQ0FBSkEsR0FBQUEsQ0FBQUEsU0FBQUEsRUFBVEYsTUFBU0UsQ0FBVEY7QUFDSDs7QUFDRCxRQUFJUixPQUFPLEtBQVgsSUFBQSxFQUFzQjtBQUNsQk8sTUFBQUEsU0FBUyxHQUFHRSxlQUFlLEdBQTNCRixPQUFBQTs7QUFDQSxVQUFJZCxTQUFTLEtBQWIsWUFBQSxFQUFnQztBQUM1QmMsUUFBQUEsU0FBUyxHQUFHQSxTQUFTLEdBQVRBLFdBQUFBLEdBQVpBLFVBQUFBO0FBQ0g7O0FBQ0RJLE1BQUFBLFNBQVMsR0FBR0gsTUFBTSxHQUFOQSxTQUFBQSxHQUFBQSxFQUFBQSxHQUFaRyxRQUFBQTtBQUNBSCxNQUFBQSxNQUFNLEdBQUdFLElBQUksQ0FBSkEsR0FBQUEsQ0FBQUEsU0FBQUEsRUFBVEYsTUFBU0UsQ0FBVEY7QUFDSDtBQWxEaUcsR0FBQSxDQW9EdEc7OztBQUNBLE1BQUksQ0FBSixPQUFBLEVBQWM7QUFDVkcsSUFBQUEsU0FBUyxHQUFUQSxRQUFBQTtBQUNIOztBQUNELFNBQU87QUFBRUgsSUFBQUEsTUFBTSxFQUFSLE1BQUE7QUFBVUgsSUFBQUEsU0FBUyxFQUFuQixTQUFBO0FBQXFCRSxJQUFBQSxTQUFTLEVBQTlCLFNBQUE7QUFBZ0NJLElBQUFBLFNBQVMsRUFBVEE7QUFBaEMsR0FBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhhbmtzIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmRyZXlwb3BwL3JlYWN0LXRleHRhcmVhLWF1dG9zaXplL1xuLyoqXG4gKiBjYWxjdWxhdGVOb2RlSGVpZ2h0KHVpVGV4dE5vZGUsIHVzZUNhY2hlID0gZmFsc2UpXG4gKi9cbmNvbnN0IEhJRERFTl9URVhUQVJFQV9TVFlMRSA9IGBcbiAgbWluLWhlaWdodDowICFpbXBvcnRhbnQ7XG4gIG1heC1oZWlnaHQ6bm9uZSAhaW1wb3J0YW50O1xuICBoZWlnaHQ6MCAhaW1wb3J0YW50O1xuICB2aXNpYmlsaXR5OmhpZGRlbiAhaW1wb3J0YW50O1xuICBvdmVyZmxvdzpoaWRkZW4gIWltcG9ydGFudDtcbiAgcG9zaXRpb246YWJzb2x1dGUgIWltcG9ydGFudDtcbiAgei1pbmRleDotMTAwMCAhaW1wb3J0YW50O1xuICB0b3A6MCAhaW1wb3J0YW50O1xuICByaWdodDowICFpbXBvcnRhbnRcbmA7XG5jb25zdCBTSVpJTkdfU1RZTEUgPSBbXG4gICAgJ2xldHRlci1zcGFjaW5nJyxcbiAgICAnbGluZS1oZWlnaHQnLFxuICAgICdwYWRkaW5nLXRvcCcsXG4gICAgJ3BhZGRpbmctYm90dG9tJyxcbiAgICAnZm9udC1mYW1pbHknLFxuICAgICdmb250LXdlaWdodCcsXG4gICAgJ2ZvbnQtc2l6ZScsXG4gICAgJ3RleHQtcmVuZGVyaW5nJyxcbiAgICAndGV4dC10cmFuc2Zvcm0nLFxuICAgICd3aWR0aCcsXG4gICAgJ3RleHQtaW5kZW50JyxcbiAgICAncGFkZGluZy1sZWZ0JyxcbiAgICAncGFkZGluZy1yaWdodCcsXG4gICAgJ2JvcmRlci13aWR0aCcsXG4gICAgJ2JveC1zaXppbmcnLFxuXTtcbmNvbnN0IGNvbXB1dGVkU3R5bGVDYWNoZSA9IHt9O1xubGV0IGhpZGRlblRleHRhcmVhO1xuZnVuY3Rpb24gY2FsY3VsYXRlTm9kZVN0eWxpbmcobm9kZSwgdXNlQ2FjaGUgPSBmYWxzZSkge1xuICAgIGNvbnN0IG5vZGVSZWYgPSAobm9kZS5nZXRBdHRyaWJ1dGUoJ2lkJykgfHxcbiAgICAgICAgbm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcmVhY3RpZCcpIHx8XG4gICAgICAgIG5vZGUuZ2V0QXR0cmlidXRlKCduYW1lJykpO1xuICAgIGlmICh1c2VDYWNoZSAmJiBjb21wdXRlZFN0eWxlQ2FjaGVbbm9kZVJlZl0pIHtcbiAgICAgICAgcmV0dXJuIGNvbXB1dGVkU3R5bGVDYWNoZVtub2RlUmVmXTtcbiAgICB9XG4gICAgY29uc3Qgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShub2RlKTtcbiAgICBjb25zdCBib3hTaXppbmcgPSBzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdib3gtc2l6aW5nJykgfHxcbiAgICAgICAgc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLW1vei1ib3gtc2l6aW5nJykgfHxcbiAgICAgICAgc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLXdlYmtpdC1ib3gtc2l6aW5nJyk7XG4gICAgY29uc3QgcGFkZGluZ1NpemUgPSBwYXJzZUZsb2F0KHN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ3BhZGRpbmctYm90dG9tJykpICtcbiAgICAgICAgcGFyc2VGbG9hdChzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdwYWRkaW5nLXRvcCcpKTtcbiAgICBjb25zdCBib3JkZXJTaXplID0gcGFyc2VGbG9hdChzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdib3JkZXItYm90dG9tLXdpZHRoJykpICtcbiAgICAgICAgcGFyc2VGbG9hdChzdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCdib3JkZXItdG9wLXdpZHRoJykpO1xuICAgIGNvbnN0IHNpemluZ1N0eWxlID0gU0laSU5HX1NUWUxFLm1hcChuYW1lID0+IGAke25hbWV9OiR7c3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShuYW1lKX1gKS5qb2luKCc7Jyk7XG4gICAgY29uc3Qgbm9kZUluZm8gPSB7XG4gICAgICAgIHNpemluZ1N0eWxlLFxuICAgICAgICBwYWRkaW5nU2l6ZSxcbiAgICAgICAgYm9yZGVyU2l6ZSxcbiAgICAgICAgYm94U2l6aW5nLFxuICAgIH07XG4gICAgaWYgKHVzZUNhY2hlICYmIG5vZGVSZWYpIHtcbiAgICAgICAgY29tcHV0ZWRTdHlsZUNhY2hlW25vZGVSZWZdID0gbm9kZUluZm87XG4gICAgfVxuICAgIHJldHVybiBub2RlSW5mbztcbn1cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNhbGN1bGF0ZU5vZGVIZWlnaHQodWlUZXh0Tm9kZSwgdXNlQ2FjaGUgPSBmYWxzZSwgbWluUm93cyA9IG51bGwsIG1heFJvd3MgPSBudWxsKSB7XG4gICAgaWYgKCFoaWRkZW5UZXh0YXJlYSkge1xuICAgICAgICBoaWRkZW5UZXh0YXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJyk7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaGlkZGVuVGV4dGFyZWEpO1xuICAgIH1cbiAgICAvLyBGaXggd3JhcD1cIm9mZlwiIGlzc3VlXG4gICAgaWYgKHVpVGV4dE5vZGUuZ2V0QXR0cmlidXRlKCd3cmFwJykpIHtcbiAgICAgICAgaGlkZGVuVGV4dGFyZWEuc2V0QXR0cmlidXRlKCd3cmFwJywgdWlUZXh0Tm9kZS5nZXRBdHRyaWJ1dGUoJ3dyYXAnKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBoaWRkZW5UZXh0YXJlYS5yZW1vdmVBdHRyaWJ1dGUoJ3dyYXAnKTtcbiAgICB9XG4gICAgLy8gQ29weSBhbGwgQ1NTIHByb3BlcnRpZXMgdGhhdCBoYXZlIGFuIGltcGFjdCBvbiB0aGUgaGVpZ2h0IG9mIHRoZSBjb250ZW50IGluXG4gICAgLy8gdGhlIHRleHRib3hcbiAgICBjb25zdCB7IHBhZGRpbmdTaXplLCBib3JkZXJTaXplLCBib3hTaXppbmcsIHNpemluZ1N0eWxlIH0gPSBjYWxjdWxhdGVOb2RlU3R5bGluZyh1aVRleHROb2RlLCB1c2VDYWNoZSk7XG4gICAgLy8gTmVlZCB0byBoYXZlIHRoZSBvdmVyZmxvdyBhdHRyaWJ1dGUgdG8gaGlkZSB0aGUgc2Nyb2xsYmFyIG90aGVyd2lzZVxuICAgIC8vIHRleHQtbGluZXMgd2lsbCBub3QgY2FsY3VsYXRlZCBwcm9wZXJseSBhcyB0aGUgc2hhZG93IHdpbGwgdGVjaG5pY2FsbHkgYmVcbiAgICAvLyBuYXJyb3dlciBmb3IgY29udGVudFxuICAgIGhpZGRlblRleHRhcmVhLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgJHtzaXppbmdTdHlsZX07JHtISURERU5fVEVYVEFSRUFfU1RZTEV9YCk7XG4gICAgaGlkZGVuVGV4dGFyZWEudmFsdWUgPSB1aVRleHROb2RlLnZhbHVlIHx8IHVpVGV4dE5vZGUucGxhY2Vob2xkZXIgfHwgJyc7XG4gICAgbGV0IG1pbkhlaWdodCA9IE51bWJlci5NSU5fU0FGRV9JTlRFR0VSO1xuICAgIGxldCBtYXhIZWlnaHQgPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcbiAgICBsZXQgaGVpZ2h0ID0gaGlkZGVuVGV4dGFyZWEuc2Nyb2xsSGVpZ2h0O1xuICAgIGxldCBvdmVyZmxvd1k7XG4gICAgaWYgKGJveFNpemluZyA9PT0gJ2JvcmRlci1ib3gnKSB7XG4gICAgICAgIC8vIGJvcmRlci1ib3g6IGFkZCBib3JkZXIsIHNpbmNlIGhlaWdodCA9IGNvbnRlbnQgKyBwYWRkaW5nICsgYm9yZGVyXG4gICAgICAgIGhlaWdodCArPSBib3JkZXJTaXplO1xuICAgIH1cbiAgICBlbHNlIGlmIChib3hTaXppbmcgPT09ICdjb250ZW50LWJveCcpIHtcbiAgICAgICAgLy8gcmVtb3ZlIHBhZGRpbmcsIHNpbmNlIGhlaWdodCA9IGNvbnRlbnRcbiAgICAgICAgaGVpZ2h0IC09IHBhZGRpbmdTaXplO1xuICAgIH1cbiAgICBpZiAobWluUm93cyAhPT0gbnVsbCB8fCBtYXhSb3dzICE9PSBudWxsKSB7XG4gICAgICAgIC8vIG1lYXN1cmUgaGVpZ2h0IG9mIGEgdGV4dGFyZWEgd2l0aCBhIHNpbmdsZSByb3dcbiAgICAgICAgaGlkZGVuVGV4dGFyZWEudmFsdWUgPSAnICc7XG4gICAgICAgIGNvbnN0IHNpbmdsZVJvd0hlaWdodCA9IGhpZGRlblRleHRhcmVhLnNjcm9sbEhlaWdodCAtIHBhZGRpbmdTaXplO1xuICAgICAgICBpZiAobWluUm93cyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgbWluSGVpZ2h0ID0gc2luZ2xlUm93SGVpZ2h0ICogbWluUm93cztcbiAgICAgICAgICAgIGlmIChib3hTaXppbmcgPT09ICdib3JkZXItYm94Jykge1xuICAgICAgICAgICAgICAgIG1pbkhlaWdodCA9IG1pbkhlaWdodCArIHBhZGRpbmdTaXplICsgYm9yZGVyU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhlaWdodCA9IE1hdGgubWF4KG1pbkhlaWdodCwgaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF4Um93cyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgbWF4SGVpZ2h0ID0gc2luZ2xlUm93SGVpZ2h0ICogbWF4Um93cztcbiAgICAgICAgICAgIGlmIChib3hTaXppbmcgPT09ICdib3JkZXItYm94Jykge1xuICAgICAgICAgICAgICAgIG1heEhlaWdodCA9IG1heEhlaWdodCArIHBhZGRpbmdTaXplICsgYm9yZGVyU2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG92ZXJmbG93WSA9IGhlaWdodCA+IG1heEhlaWdodCA/ICcnIDogJ2hpZGRlbic7XG4gICAgICAgICAgICBoZWlnaHQgPSBNYXRoLm1pbihtYXhIZWlnaHQsIGhlaWdodCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gUmVtb3ZlIHNjcm9sbCBiYXIgZmxhc2ggd2hlbiBhdXRvc2l6ZSB3aXRob3V0IG1heFJvd3NcbiAgICBpZiAoIW1heFJvd3MpIHtcbiAgICAgICAgb3ZlcmZsb3dZID0gJ2hpZGRlbic7XG4gICAgfVxuICAgIHJldHVybiB7IGhlaWdodCwgbWluSGVpZ2h0LCBtYXhIZWlnaHQsIG92ZXJmbG93WSB9O1xufVxuIl19