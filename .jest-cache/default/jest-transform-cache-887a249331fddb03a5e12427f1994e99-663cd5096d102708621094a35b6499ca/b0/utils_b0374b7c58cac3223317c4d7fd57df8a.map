{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components/upload/utils.tsx"],"names":[],"mappings":"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","sourcesContent":["import { UploadFile } from './interface';\n\nexport function T() {\n  return true;\n}\n\n// Fix IE file.status problem\n// via coping a new Object\nexport function fileToObject(file: UploadFile) {\n  return {\n    lastModified: file.lastModified,\n    lastModifiedDate: file.lastModifiedDate,\n    name: file.filename || file.name,\n    size: file.size,\n    type: file.type,\n    uid: file.uid,\n    response: file.response,\n    error: file.error,\n    percent: 0,\n    originFileObj: file as (File | UploadFile),\n  } as UploadFile;\n}\n\n/**\n * 生成Progress percent: 0.1 -> 0.98\n *   - for ie\n */\nexport function genPercentAdd() {\n  let k = 0.1;\n  const i = 0.01;\n  const end = 0.98;\n  return function(s: number) {\n    let start = s;\n    if (start >= end) {\n      return start;\n    }\n\n    start += k;\n    k -= i;\n    if (k < 0.001) {\n      k = 0.001;\n    }\n    return start * 100;\n  };\n}\n\nexport function getFileItem(file: UploadFile, fileList: UploadFile[]) {\n  const matchKey = file.uid !== undefined ? 'uid' : 'name';\n  return fileList.filter(item => item[matchKey] === file[matchKey])[0];\n}\n\nexport function removeFileItem(file: UploadFile, fileList: UploadFile[]) {\n  const matchKey = file.uid !== undefined ? 'uid' : 'name';\n  const removed = fileList.filter(item => item[matchKey] !== file[matchKey]);\n  if (removed.length === fileList.length) {\n    return null;\n  }\n  return removed;\n}\n\nconst isImageFileType = (type: string): boolean => type.indexOf('image/') === 0;\n\nconst MEASURE_SIZE = 200;\nexport function previewImage(file: File | Blob): Promise<string> {\n  return new Promise(resolve => {\n    if (!file.type || !isImageFileType(file.type)) {\n      resolve('');\n      return;\n    }\n\n    const canvas = document.createElement('canvas');\n    canvas.width = MEASURE_SIZE;\n    canvas.height = MEASURE_SIZE;\n    canvas.style.cssText = `position: fixed; left: 0; top: 0; width: ${MEASURE_SIZE}px; height: ${MEASURE_SIZE}px; z-index: 9999; display: none;`;\n    document.body.appendChild(canvas);\n    const ctx = canvas.getContext('2d');\n    const img = new Image();\n    img.onload = () => {\n      const { width, height } = img;\n\n      let drawWidth = MEASURE_SIZE;\n      let drawHeight = MEASURE_SIZE;\n      let offsetX = 0;\n      let offsetY = 0;\n\n      if (width < height) {\n        drawHeight = height * (MEASURE_SIZE / width);\n        offsetY = -(drawHeight - drawWidth) / 2;\n      } else {\n        drawWidth = width * (MEASURE_SIZE / height);\n        offsetX = -(drawWidth - drawHeight) / 2;\n      }\n\n      ctx!.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);\n      const dataURL = canvas.toDataURL();\n      document.body.removeChild(canvas);\n\n      resolve(dataURL);\n    };\n    img.src = window.URL.createObjectURL(file);\n  });\n}\n\n"]}