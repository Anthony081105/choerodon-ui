2de9b6238351b375cad1d1743f1db707
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _tslib = require("tslib");

var _react = _interopRequireDefault(require("react"));

var _reactDom = require("react-dom");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _omit = _interopRequireDefault(require("lodash/omit"));

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _isElement = _interopRequireDefault(require("lodash/isElement"));

var _align = _interopRequireDefault(require("choerodon-ui/lib/align"));

var _configure = require("choerodon-ui/lib/configure");

var _animate = _interopRequireDefault(require("../animate"));

var _ViewComponent2 = _interopRequireDefault(require("../core/ViewComponent"));

var _PopupInner = _interopRequireDefault(require("./PopupInner"));

var _autobind = _interopRequireDefault(require("../_util/autobind"));

var popupContainer;

function getContainer(getPopupContainer, getRootDomNode) {
  if (!popupContainer && typeof window !== 'undefined') {
    var doc = window.document;
    popupContainer = doc.createElement('div');
    popupContainer.className = (0, _configure.getProPrefixCls)('popup-container');
    var mountNode = getPopupContainer ? getPopupContainer(getRootDomNode) : doc.body;

    if ((0, _isElement["default"])(mountNode)) {
      mountNode.appendChild(popupContainer);
    } else {
      doc.body.appendChild(popupContainer);
    }
  }

  return popupContainer;
}
/**
 * 记录ID生成器
 */


var PopupKeyGen =
/*#__PURE__*/
_regenerator["default"].mark(function _callee(start) {
  return _regenerator["default"].wrap(function _callee$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          if (!true) {
            _context.next = 5;
            break;
          }

          _context.next = 3;
          return "popup-key-".concat(start++);

        case 3:
          _context.next = 0;
          break;

        case 5:
        case "end":
          return _context.stop();
      }
    }
  }, _callee);
})(1);

var Popup =
/*#__PURE__*/
function (_ViewComponent) {
  (0, _inherits2["default"])(Popup, _ViewComponent);

  function Popup() {
    var _this;

    (0, _classCallCheck2["default"])(this, Popup);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Popup).apply(this, arguments));
    _this.contentRendered = false;
    _this.popupKey = PopupKeyGen.next().value;

    _this.saveRef = function (align) {
      return _this.align = align;
    };

    return _this;
  }

  (0, _createClass2["default"])(Popup, [{
    key: "getOtherProps",
    value: function getOtherProps() {
      var otherProps = (0, _omit["default"])((0, _get2["default"])((0, _getPrototypeOf2["default"])(Popup.prototype), "getOtherProps", this).call(this), ['align', 'transitionName', 'getRootDomNode', 'getPopupContainer', 'getClassNameFromAlign', 'getStyleFromAlign', 'onAlign', 'onAnimateAppear', 'onAnimateEnter', 'onAnimateLeave', 'onAnimateEnd']);
      return otherProps;
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          hidden = _this$props.hidden,
          align = _this$props.align,
          transitionName = _this$props.transitionName,
          getRootDomNode = _this$props.getRootDomNode,
          getPopupContainer = _this$props.getPopupContainer,
          children = _this$props.children,
          _this$props$onAnimate = _this$props.onAnimateAppear,
          onAnimateAppear = _this$props$onAnimate === void 0 ? _noop["default"] : _this$props$onAnimate,
          _this$props$onAnimate2 = _this$props.onAnimateEnter,
          onAnimateEnter = _this$props$onAnimate2 === void 0 ? _noop["default"] : _this$props$onAnimate2,
          _this$props$onAnimate3 = _this$props.onAnimateLeave,
          onAnimateLeave = _this$props$onAnimate3 === void 0 ? _noop["default"] : _this$props$onAnimate3,
          _this$props$onAnimate4 = _this$props.onAnimateEnd,
          onAnimateEnd = _this$props$onAnimate4 === void 0 ? _noop["default"] : _this$props$onAnimate4;

      if (!hidden) {
        this.contentRendered = true;
      }

      var container = getContainer(getPopupContainer, getRootDomNode);
      return container && this.contentRendered ? (0, _reactDom.createPortal)(_react["default"].createElement(_animate["default"], {
        component: "",
        exclusive: true,
        transitionAppear: true,
        transitionName: transitionName,
        hiddenProp: "hidden",
        onAppear: onAnimateAppear,
        onEnter: onAnimateEnter,
        onLeave: onAnimateLeave,
        onEnd: onAnimateEnd
      }, _react["default"].createElement(_align["default"], {
        ref: this.saveRef,
        key: "align",
        childrenProps: {
          hidden: 'hidden'
        },
        align: align,
        onAlign: this.onAlign,
        target: getRootDomNode,
        hidden: hidden,
        monitorWindowResize: true
      }, _react["default"].createElement(_PopupInner["default"], (0, _extends2["default"])({}, (0, _omit["default"])(this.getMergedProps(), ['ref'])), children))), container, this.popupKey) : null;
    }
  }, {
    key: "onAlign",
    value: function onAlign(source, align, target) {
      var _this$props2 = this.props,
          _this$props2$getClass = _this$props2.getClassNameFromAlign,
          getClassNameFromAlign = _this$props2$getClass === void 0 ? _noop["default"] : _this$props2$getClass,
          _this$props2$getStyle = _this$props2.getStyleFromAlign,
          getStyleFromAlign = _this$props2$getStyle === void 0 ? _noop["default"] : _this$props2$getStyle,
          _this$props2$onAlign = _this$props2.onAlign,
          onAlign = _this$props2$onAlign === void 0 ? _noop["default"] : _this$props2$onAlign;
      var currentAlignClassName = getClassNameFromAlign(align);

      if (this.currentAlignClassName !== currentAlignClassName) {
        this.currentAlignClassName = currentAlignClassName;
        source.className = this.getMergedClassNames(currentAlignClassName);
      }

      var currentAlignStyle = getStyleFromAlign(target, align);

      if (!(0, _isEqual["default"])(this.currentAlignStyle, currentAlignStyle)) {
        this.currentAlignStyle = currentAlignStyle;
        (0, _extends2["default"])(source.style, currentAlignStyle);
      }

      onAlign(source, align, target);
    }
  }, {
    key: "forceAlign",
    value: function forceAlign() {
      if (this.align) {
        this.align.forceAlign();
      }
    }
  }]);
  return Popup;
}(_ViewComponent2["default"]);

exports["default"] = Popup;
Popup.displayName = 'Popup';
Popup.propTypes = (0, _objectSpread2["default"])({
  align: _propTypes["default"].object,
  onAlign: _propTypes["default"].func,
  getRootDomNode: _propTypes["default"].func,
  getPopupContainer: _propTypes["default"].func,
  transitionName: _propTypes["default"].string,
  onAnimateAppear: _propTypes["default"].func,
  onAnimateEnter: _propTypes["default"].func,
  onAnimateLeave: _propTypes["default"].func,
  onAnimateEnd: _propTypes["default"].func,
  getStyleFromAlign: _propTypes["default"].func,
  getClassNameFromAlign: _propTypes["default"].func
}, _ViewComponent2["default"].propTypes);
Popup.defaultProps = {
  suffixCls: 'popup',
  transitionName: 'zoom'
};
(0, _tslib.__decorate)([_autobind["default"]], Popup.prototype, "onAlign", null);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby90cmlnZ2VyL1BvcHVwLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUksY0FBSjs7QUFFQSxTQUFTLFlBQVQsQ0FBc0IsaUJBQXRCLEVBQXlDLGNBQXpDLEVBQXVEO0FBQ3JELE1BQUksQ0FBQyxjQUFELElBQW1CLE9BQU8sTUFBUCxLQUFrQixXQUF6QyxFQUFzRDtBQUNwRCxRQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsUUFBbkI7QUFDQSxJQUFBLGNBQWMsR0FBRyxHQUFHLENBQUMsYUFBSixDQUFrQixLQUFsQixDQUFqQjtBQUNBLElBQUEsY0FBYyxDQUFDLFNBQWYsR0FBMkIsZ0NBQWdCLGlCQUFoQixDQUEzQjtBQUNBLFFBQU0sU0FBUyxHQUFHLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDLGNBQUQsQ0FBcEIsR0FBdUMsR0FBRyxDQUFDLElBQTlFOztBQUNBLFFBQUksMkJBQVUsU0FBVixDQUFKLEVBQTBCO0FBQ3hCLE1BQUEsU0FBUyxDQUFDLFdBQVYsQ0FBc0IsY0FBdEI7QUFDRCxLQUZELE1BRU87QUFDTCxNQUFBLEdBQUcsQ0FBQyxJQUFKLENBQVMsV0FBVCxDQUFxQixjQUFyQjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBTyxjQUFQO0FBQ0Q7QUFFRDs7Ozs7QUFHQSxJQUFNLFdBQVc7QUFBNkI7QUFBQSw2QkFBQyxpQkFBVSxLQUFWO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUN0QyxJQURzQztBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUUzQyxxQ0FBbUIsS0FBSyxFQUF4Qjs7QUFGMkM7QUFBQTtBQUFBOztBQUFBO0FBQUE7QUFBQTtB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WUFBWSxFQUFFLHNCQUFVLElBVG5CO0FBVUwsRUFBQSxpQkFBaUIsRUFBRSxzQkFBVSxJQVZ4QjtBQVdMLEVBQUEscUJBQXFCLEVBQUUsc0JBQVU7QUFYNUIsR0FZRiwyQkFBYyxTQVpaO0FBZUEsS0FBQSxDQUFBLFlBQUEsR0FBZTtBQUNwQixFQUFBLFNBQVMsRUFBRSxPQURTO0FBRXBCLEVBQUEsY0FBYyxFQUFFO0FBRkksQ0FBZjtBQW9GUCx1QkFBQSxDQURDLG9CQUNELENBQUEsRSxlQUFBLEUsU0FBQSxFQWFDLElBYkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ1NTUHJvcGVydGllcywgS2V5IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgY3JlYXRlUG9ydGFsIH0gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgb21pdCBmcm9tICdsb2Rhc2gvb21pdCc7XG5pbXBvcnQgc2hhbGxvd0VxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcbmltcG9ydCBub29wIGZyb20gJ2xvZGFzaC9ub29wJztcbmltcG9ydCBpc0VsZW1lbnQgZnJvbSAnbG9kYXNoL2lzRWxlbWVudCc7XG5pbXBvcnQgQWxpZ24gZnJvbSAnY2hvZXJvZG9uLXVpL2xpYi9hbGlnbic7XG5pbXBvcnQgeyBnZXRQcm9QcmVmaXhDbHMgfSBmcm9tICdjaG9lcm9kb24tdWkvbGliL2NvbmZpZ3VyZSc7XG5pbXBvcnQgQW5pbWF0ZSBmcm9tICcuLi9hbmltYXRlJztcbmltcG9ydCBWaWV3Q29tcG9uZW50LCB7IFZpZXdDb21wb25lbnRQcm9wcyB9IGZyb20gJy4uL2NvcmUvVmlld0NvbXBvbmVudCc7XG5pbXBvcnQgUG9wdXBJbm5lciBmcm9tICcuL1BvcHVwSW5uZXInO1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJy4uL191dGlsL2F1dG9iaW5kJztcblxubGV0IHBvcHVwQ29udGFpbmVyO1xuXG5mdW5jdGlvbiBnZXRDb250YWluZXIoZ2V0UG9wdXBDb250YWluZXIsIGdldFJvb3REb21Ob2RlKSB7XG4gIGlmICghcG9wdXBDb250YWluZXIgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBjb25zdCBkb2MgPSB3aW5kb3cuZG9jdW1lbnQ7XG4gICAgcG9wdXBDb250YWluZXIgPSBkb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcG9wdXBDb250YWluZXIuY2xhc3NOYW1lID0gZ2V0UHJvUHJlZml4Q2xzKCdwb3B1cC1jb250YWluZXInKTtcbiAgICBjb25zdCBtb3VudE5vZGUgPSBnZXRQb3B1cENvbnRhaW5lciA/IGdldFBvcHVwQ29udGFpbmVyKGdldFJvb3REb21Ob2RlKSA6IGRvYy5ib2R5O1xuICAgIGlmIChpc0VsZW1lbnQobW91bnROb2RlKSkge1xuICAgICAgbW91bnROb2RlLmFwcGVuZENoaWxkKHBvcHVwQ29udGFpbmVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9jLmJvZHkuYXBwZW5kQ2hpbGQocG9wdXBDb250YWluZXIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcG9wdXBDb250YWluZXI7XG59XG5cbi8qKlxuICog6K6w5b2VSUTnlJ/miJDlmahcbiAqL1xuY29uc3QgUG9wdXBLZXlHZW46IEl0ZXJhYmxlSXRlcmF0b3I8c3RyaW5nPiA9IChmdW5jdGlvbiooc3RhcnQ6IG51bWJlcikge1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIHlpZWxkIGBwb3B1cC1rZXktJHtzdGFydCsrfWA7XG4gIH1cbn0pKDEpO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBvcHVwUHJvcHMgZXh0ZW5kcyBWaWV3Q29tcG9uZW50UHJvcHMge1xuICBhbGlnbjogb2JqZWN0O1xuICBvbkFsaWduPzogKHNvdXJjZTogTm9kZSwgYWxpZ246IG9iamVjdCwgdGFyZ2V0OiBOb2RlIHwgV2luZG93KSA9PiB2b2lkO1xuICBnZXRSb290RG9tTm9kZT86ICgpID0+IE5vZGU7XG4gIGdldFBvcHVwQ29udGFpbmVyPzogKHRyaWdnZXJOb2RlOiBFbGVtZW50KSA9PiBIVE1MRWxlbWVudDtcbiAgdHJhbnNpdGlvbk5hbWU/OiBzdHJpbmc7XG4gIG9uQW5pbWF0ZUFwcGVhcj86IChrZXk6IEtleSB8IG51bGwpID0+IHZvaWQ7XG4gIG9uQW5pbWF0ZUVudGVyPzogKGtleTogS2V5IHwgbnVsbCkgPT4gdm9pZDtcbiAgb25BbmltYXRlTGVhdmU/OiAoa2V5OiBLZXkgfCBudWxsKSA9PiB2b2lkO1xuICBvbkFuaW1hdGVFbmQ/OiAoa2V5OiBLZXkgfCBudWxsLCBleGlzdHM6IGJvb2xlYW4pID0+IHZvaWQ7XG4gIGdldFN0eWxlRnJvbUFsaWduPzogKHRhcmdldDogTm9kZSB8IFdpbmRvdywgYWxpZ246IG9iamVjdCkgPT4gb2JqZWN0IHwgdW5kZWZpbmVkO1xuICBnZXRDbGFzc05hbWVGcm9tQWxpZ24/OiAoYWxpZ246IG9iamVjdCkgPT4gc3RyaW5nIHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCBleHRlbmRzIFZpZXdDb21wb25lbnQ8UG9wdXBQcm9wcz4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnUG9wdXAnO1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgYWxpZ246IFByb3BUeXBlcy5vYmplY3QsXG4gICAgb25BbGlnbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZ2V0Um9vdERvbU5vZGU6IFByb3BUeXBlcy5mdW5jLFxuICAgIGdldFBvcHVwQ29udGFpbmVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICB0cmFuc2l0aW9uTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBvbkFuaW1hdGVBcHBlYXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQW5pbWF0ZUVudGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkFuaW1hdGVMZWF2ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25BbmltYXRlRW5kOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRTdHlsZUZyb21BbGlnbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZ2V0Q2xhc3NOYW1lRnJvbUFsaWduOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAuLi5WaWV3Q29tcG9uZW50LnByb3BUeXBlcyxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHN1ZmZpeENsczogJ3BvcHVwJyxcbiAgICB0cmFuc2l0aW9uTmFtZTogJ3pvb20nLFxuICB9O1xuXG4gIGN1cnJlbnRBbGlnbkNsYXNzTmFtZT86IHN0cmluZztcblxuICBjdXJyZW50QWxpZ25TdHlsZT86IENTU1Byb3BlcnRpZXM7XG5cbiAgYWxpZ246IEFsaWduIHwgbnVsbDtcblxuICBjb250ZW50UmVuZGVyZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwb3B1cEtleTogc3RyaW5nID0gUG9wdXBLZXlHZW4ubmV4dCgpLnZhbHVlO1xuXG4gIHNhdmVSZWYgPSBhbGlnbiA9PiAodGhpcy5hbGlnbiA9IGFsaWduKTtcblxuICBnZXRPdGhlclByb3BzKCkge1xuICAgIGNvbnN0IG90aGVyUHJvcHMgPSBvbWl0KHN1cGVyLmdldE90aGVyUHJvcHMoKSwgW1xuICAgICAgJ2FsaWduJyxcbiAgICAgICd0cmFuc2l0aW9uTmFtZScsXG4gICAgICAnZ2V0Um9vdERvbU5vZGUnLFxuICAgICAgJ2dldFBvcHVwQ29udGFpbmVyJyxcbiAgICAgICdnZXRDbGFzc05hbWVGcm9tQWxpZ24nLFxuICAgICAgJ2dldFN0eWxlRnJvbUFsaWduJyxcbiAgICAgICdvbkFsaWduJyxcbiAgICAgICdvbkFuaW1hdGVBcHBlYXInLFxuICAgICAgJ29uQW5pbWF0ZUVudGVyJyxcbiAgICAgICdvbkFuaW1hdGVMZWF2ZScsXG4gICAgICAnb25BbmltYXRlRW5kJyxcbiAgICBdKTtcbiAgICByZXR1cm4gb3RoZXJQcm9wcztcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBoaWRkZW4sXG4gICAgICBhbGlnbixcbiAgICAgIHRyYW5zaXRpb25OYW1lLFxuICAgICAgZ2V0Um9vdERvbU5vZGUsXG4gICAgICBnZXRQb3B1cENvbnRhaW5lcixcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgb25BbmltYXRlQXBwZWFyID0gbm9vcCxcbiAgICAgIG9uQW5pbWF0ZUVudGVyID0gbm9vcCxcbiAgICAgIG9uQW5pbWF0ZUxlYXZlID0gbm9vcCxcbiAgICAgIG9uQW5pbWF0ZUVuZCA9IG5vb3AsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCFoaWRkZW4pIHtcbiAgICAgIHRoaXMuY29udGVudFJlbmRlcmVkID0gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgY29udGFpbmVyID0gZ2V0Q29udGFpbmVyKGdldFBvcHVwQ29udGFpbmVyLCBnZXRSb290RG9tTm9kZSk7XG4gICAgcmV0dXJuIGNvbnRhaW5lciAmJiB0aGlzLmNvbnRlbnRSZW5kZXJlZFxuICAgICAgPyBjcmVhdGVQb3J0YWwoXG4gICAgICAgICAgPEFuaW1hdGVcbiAgICAgICAgICAgIGNvbXBvbmVudD1cIlwiXG4gICAgICAgICAgICBleGNsdXNpdmVcbiAgICAgICAgICAgIHRyYW5zaXRpb25BcHBlYXJcbiAgICAgICAgICAgIHRyYW5zaXRpb25OYW1lPXt0cmFuc2l0aW9uTmFtZX1cbiAgICAgICAgICAgIGhpZGRlblByb3A9XCJoaWRkZW5cIlxuICAgICAgICAgICAgb25BcHBlYXI9e29uQW5pbWF0ZUFwcGVhcn1cbiAgICAgICAgICAgIG9uRW50ZXI9e29uQW5pbWF0ZUVudGVyfVxuICAgICAgICAgICAgb25MZWF2ZT17b25BbmltYXRlTGVhdmV9XG4gICAgICAgICAgICBvbkVuZD17b25BbmltYXRlRW5kfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxBbGlnblxuICAgICAgICAgICAgICByZWY9e3RoaXMuc2F2ZVJlZn1cbiAgICAgICAgICAgICAga2V5PVwiYWxpZ25cIlxuICAgICAgICAgICAgICBjaGlsZHJlblByb3BzPXt7IGhpZGRlbjogJ2hpZGRlbicgfX1cbiAgICAgICAgICAgICAgYWxpZ249e2FsaWdufVxuICAgICAgICAgICAgICBvbkFsaWduPXt0aGlzLm9uQWxpZ259XG4gICAgICAgICAgICAgIHRhcmdldD17Z2V0Um9vdERvbU5vZGV9XG4gICAgICAgICAgICAgIGhpZGRlbj17aGlkZGVufVxuICAgICAgICAgICAgICBtb25pdG9yV2luZG93UmVzaXplXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxQb3B1cElubmVyIHsuLi5vbWl0KHRoaXMuZ2V0TWVyZ2VkUHJvcHMoKSwgWydyZWYnXSl9PntjaGlsZHJlbn08L1BvcHVwSW5uZXI+XG4gICAgICAgICAgICA8L0FsaWduPlxuICAgICAgICAgIDwvQW5pbWF0ZT4sXG4gICAgICAgICAgY29udGFpbmVyLFxuICAgICAgICAgIHRoaXMucG9wdXBLZXksXG4gICAgICAgIClcbiAgICAgIDogbnVsbDtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBvbkFsaWduKHNvdXJjZSwgYWxpZ24sIHRhcmdldCkge1xuICAgIGNvbnN0IHsgZ2V0Q2xhc3NOYW1lRnJvbUFsaWduID0gbm9vcCwgZ2V0U3R5bGVGcm9tQWxpZ24gPSBub29wLCBvbkFsaWduID0gbm9vcCB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBjdXJyZW50QWxpZ25DbGFzc05hbWUgPSBnZXRDbGFzc05hbWVGcm9tQWxpZ24oYWxpZ24pO1xuICAgIGlmICh0aGlzLmN1cnJlbnRBbGlnbkNsYXNzTmFtZSAhPT0gY3VycmVudEFsaWduQ2xhc3NOYW1lKSB7XG4gICAgICB0aGlzLmN1cnJlbnRBbGlnbkNsYXNzTmFtZSA9IGN1cnJlbnRBbGlnbkNsYXNzTmFtZTtcbiAgICAgIHNvdXJjZS5jbGFzc05hbWUgPSB0aGlzLmdldE1lcmdlZENsYXNzTmFtZXMoY3VycmVudEFsaWduQ2xhc3NOYW1lKTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudEFsaWduU3R5bGUgPSBnZXRTdHlsZUZyb21BbGlnbih0YXJnZXQsIGFsaWduKTtcbiAgICBpZiAoIXNoYWxsb3dFcXVhbCh0aGlzLmN1cnJlbnRBbGlnblN0eWxlLCBjdXJyZW50QWxpZ25TdHlsZSkpIHtcbiAgICAgIHRoaXMuY3VycmVudEFsaWduU3R5bGUgPSBjdXJyZW50QWxpZ25TdHlsZTtcbiAgICAgIE9iamVjdC5hc3NpZ24oc291cmNlLnN0eWxlLCBjdXJyZW50QWxpZ25TdHlsZSk7XG4gICAgfVxuICAgIG9uQWxpZ24oc291cmNlLCBhbGlnbiwgdGFyZ2V0KTtcbiAgfVxuXG4gIGZvcmNlQWxpZ24oKSB7XG4gICAgaWYgKHRoaXMuYWxpZ24pIHtcbiAgICAgIHRoaXMuYWxpZ24uZm9yY2VBbGlnbigpO1xuICAgIH1cbiAgfVxufVxuIl19