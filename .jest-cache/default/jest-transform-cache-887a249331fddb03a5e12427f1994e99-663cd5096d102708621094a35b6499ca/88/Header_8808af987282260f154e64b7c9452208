e9cddb781fbe0adc42aae92d6ee9fc17
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _moment = _interopRequireDefault(require("moment"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Header =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Header, _Component);

  var _super = _createSuper(Header);

  function Header(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Header);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onInputChange", function (event) {
      var str = event.target.value;

      _this.setState({
        str: str
      });

      var _this$props = _this.props,
          format = _this$props.format,
          hourOptions = _this$props.hourOptions,
          minuteOptions = _this$props.minuteOptions,
          secondOptions = _this$props.secondOptions,
          disabledHours = _this$props.disabledHours,
          disabledMinutes = _this$props.disabledMinutes,
          disabledSeconds = _this$props.disabledSeconds,
          onChange = _this$props.onChange,
          allowEmpty = _this$props.allowEmpty;

      if (str) {
        var originalValue = _this.props.value;

        var value = _this.getProtoValue().clone();

        var parsed = (0, _moment["default"])(str, format, true);

        if (!parsed.isValid()) {
          _this.setState({
            invalid: true
          });

          return;
        }

        value.hour(parsed.hour()).minute(parsed.minute()).second(parsed.second()); // if time value not allowed, response warning.

        if (hourOptions.indexOf(value.hour()) < 0 || minuteOptions.indexOf(value.minute()) < 0 || secondOptions.indexOf(value.second()) < 0) {
          _this.setState({
            invalid: true
          });

          return;
        } // if time value is disabled, response warning.


        var disabledHourOptions = disabledHours();
        var disabledMinuteOptions = disabledMinutes(value.hour());
        var disabledSecondOptions = disabledSeconds(value.hour(), value.minute());

        if (disabledHourOptions && disabledHourOptions.indexOf(value.hour()) >= 0 || disabledMinuteOptions && disabledMinuteOptions.indexOf(value.minute()) >= 0 || disabledSecondOptions && disabledSecondOptions.indexOf(value.second()) >= 0) {
          _this.setState({
            invalid: true
          });

          return;
        }

        if (originalValue) {
          if (originalValue.hour() !== value.hour() || originalValue.minute() !== value.minute() || originalValue.second() !== value.second()) {
            // keep other fields for rc-calendar
            var changedValue = originalValue.clone();
            changedValue.hour(value.hour());
            changedValue.minute(value.minute());
            changedValue.second(value.second());
            onChange(changedValue);
          }
        } else if (originalValue !== value) {
          onChange(value);
        }
      } else if (allowEmpty) {
        onChange(null);
      } else {
        _this.setState({
          invalid: true
        });

        return;
      }

      _this.setState({
        invalid: false
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onKeyDown", function (e) {
      var _this$props2 = _this.props,
          onEsc = _this$props2.onEsc,
          onKeyDown = _this$props2.onKeyDown;

      if (e.keyCode === 27) {
        onEsc();
      }

      onKeyDown(e);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onClear", function () {
      _this.setState({
        str: ''
      });

      _this.props.onClear();
    });
    var _value = props.value,
        _format = props.format;
    _this.state = {
      str: _value && _value.format(_format) || '',
      invalid: false
    };
    return _this;
  }

  (0, _createClass2["default"])(Header, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this2 = this;

      if (this.props.focusOnOpen) {
        // Wait one frame for the panel to be positioned before focusing
        var requestAnimationFrame = window.requestAnimationFrame || window.setTimeout;
        requestAnimationFrame(function () {
          _this2.refs.input.focus();

          _this2.refs.input.select();
        });
      }
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      var value = nextProps.value,
          format = nextProps.format;
      this.setState({
        str: value && value.format(format) || '',
        invalid: false
      });
    }
  }, {
    key: "getClearButton",
    value: function getClearButton() {
      var _this$props3 = this.props,
          prefixCls = _this$props3.prefixCls,
          allowEmpty = _this$props3.allowEmpty;

      if (!allowEmpty) {
        return null;
      }

      return _react["default"].createElement("a", {
        className: "".concat(prefixCls, "-clear-btn"),
        role: "button",
        title: this.props.clearText,
        onMouseDown: this.onClear
      });
    }
  }, {
    key: "getProtoValue",
    value: function getProtoValue() {
      return this.props.value || this.props.defaultOpenValue;
    }
  }, {
    key: "getInput",
    value: function getInput() {
      var _this$props4 = this.props,
          prefixCls = _this$props4.prefixCls,
          placeholder = _this$props4.placeholder,
          inputReadOnly = _this$props4.inputReadOnly;
      var _this$state = this.state,
          invalid = _this$state.invalid,
          str = _this$state.str;
      var invalidClass = invalid ? "".concat(prefixCls, "-input-invalid") : '';
      return _react["default"].createElement("input", {
        className: "".concat(prefixCls, "-input  ").concat(invalidClass),
        ref: "input",
        onKeyDown: this.onKeyDown,
        value: str,
        placeholder: placeholder,
        onChange: this.onInputChange,
        readOnly: !!inputReadOnly
      });
    }
  }, {
    key: "render",
    value: function render() {
      var prefixCls = this.props.prefixCls;
      return _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-input-wrap")
      }, this.getInput(), this.getClearButton());
    }
  }]);
  return Header;
}(_react.Component);

(0, _defineProperty2["default"])(Header, "propTypes", {
  format: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  disabledDate: _propTypes["default"].func,
  placeholder: _propTypes["default"].string,
  clearText: _propTypes["default"].string,
  value: _propTypes["default"].object,
  inputReadOnly: _propTypes["default"].bool,
  hourOptions: _propTypes["default"].array,
  minuteOptions: _propTypes["default"].array,
  secondOptions: _propTypes["default"].array,
  disabledHours: _propTypes["default"].func,
  disabledMinutes: _propTypes["default"].func,
  disabledSeconds: _propTypes["default"].func,
  onChange: _propTypes["default"].func,
  onClear: _propTypes["default"].func,
  onEsc: _propTypes["default"].func,
  allowEmpty: _propTypes["default"].bool,
  defaultOpenValue: _propTypes["default"].object,
  currentSelectPanel: _propTypes["default"].string,
  focusOnOpen: _propTypes["default"].bool,
  onKeyDown: _propTypes["default"].func
});
(0, _defineProperty2["default"])(Header, "defaultProps", {
  inputReadOnly: false
});
var _default = Header;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkhlYWRlci5qc3giXSwibmFtZXMiOlsiSGVhZGVyIiwicHJvcHMiLCJldmVudCIsInN0ciIsInRhcmdldCIsInZhbHVlIiwic2V0U3RhdGUiLCJmb3JtYXQiLCJob3VyT3B0aW9ucyIsIm1pbnV0ZU9wdGlvbnMiLCJzZWNvbmRPcHRpb25zIiwiZGlzYWJsZWRIb3VycyIsImRpc2FibGVkTWludXRlcyIsImRpc2FibGVkU2Vjb25kcyIsIm9uQ2hhbmdlIiwiYWxsb3dFbXB0eSIsIm9yaWdpbmFsVmFsdWUiLCJnZXRQcm90b1ZhbHVlIiwiY2xvbmUiLCJwYXJzZWQiLCJpc1ZhbGlkIiwiaW52YWxpZCIsImhvdXIiLCJtaW51dGUiLCJzZWNvbmQiLCJpbmRleE9mIiwiZGlzYWJsZWRIb3VyT3B0aW9ucyIsImRpc2FibGVkTWludXRlT3B0aW9ucyIsImRpc2FibGVkU2Vjb25kT3B0aW9ucyIsImNoYW5nZWRWYWx1ZSIsImUiLCJvbkVzYyIsIm9uS2V5RG93biIsImtleUNvZGUiLCJvbkNsZWFyIiwic3RhdGUiLCJmb2N1c09uT3BlbiIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIndpbmRvdyIsInNldFRpbWVvdXQiLCJyZWZzIiwiaW5wdXQiLCJmb2N1cyIsInNlbGVjdCIsIm5leHRQcm9wcyIsInByZWZpeENscyIsImNsZWFyVGV4dCIsImRlZmF1bHRPcGVuVmFsdWUiLCJwbGFjZWhvbGRlciIsImlucHV0UmVhZE9ubHkiLCJpbnZhbGlkQ2xhc3MiLCJvbklucHV0Q2hhbmdlIiwiZ2V0SW5wdXQiLCJnZXRDbGVhckJ1dHRvbiIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsInN0cmluZyIsImRpc2FibGVkRGF0ZSIsImZ1bmMiLCJvYmplY3QiLCJib29sIiwiYXJyYXkiLCJjdXJyZW50U2VsZWN0UGFuZWwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJ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QkFBVUc7QUFyQkosQztpQ0FEZjFELE0sa0JBeUJrQjtBQUNwQmlELEVBQUFBLGFBQWEsRUFBRTtBQURLLEM7ZUEyS1RqRCxNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5cbmNsYXNzIEhlYWRlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZm9ybWF0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBkaXNhYmxlZERhdGU6IFByb3BUeXBlcy5mdW5jLFxuICAgIHBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNsZWFyVGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB2YWx1ZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBpbnB1dFJlYWRPbmx5OiBQcm9wVHlwZXMuYm9vbCxcbiAgICBob3VyT3B0aW9uczogUHJvcFR5cGVzLmFycmF5LFxuICAgIG1pbnV0ZU9wdGlvbnM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBzZWNvbmRPcHRpb25zOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgZGlzYWJsZWRIb3VyczogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZGlzYWJsZWRNaW51dGVzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBkaXNhYmxlZFNlY29uZHM6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkNsZWFyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkVzYzogUHJvcFR5cGVzLmZ1bmMsXG4gICAgYWxsb3dFbXB0eTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZGVmYXVsdE9wZW5WYWx1ZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBjdXJyZW50U2VsZWN0UGFuZWw6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZm9jdXNPbk9wZW46IFByb3BUeXBlcy5ib29sLFxuICAgIG9uS2V5RG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBpbnB1dFJlYWRPbmx5OiBmYWxzZSxcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcm1hdCB9ID0gcHJvcHM7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHN0cjogdmFsdWUgJiYgdmFsdWUuZm9ybWF0KGZvcm1hdCkgfHwgJycsXG4gICAgICBpbnZhbGlkOiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZm9jdXNPbk9wZW4pIHtcbiAgICAgIC8vIFdhaXQgb25lIGZyYW1lIGZvciB0aGUgcGFuZWwgdG8gYmUgcG9zaXRpb25lZCBiZWZvcmUgZm9jdXNpbmdcbiAgICAgIGNvbnN0IHJlcXVlc3RBbmltYXRpb25GcmFtZSA9ICh3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5zZXRUaW1lb3V0KTtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHRoaXMucmVmcy5pbnB1dC5mb2N1cygpO1xuICAgICAgICB0aGlzLnJlZnMuaW5wdXQuc2VsZWN0KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGNvbnN0IHsgdmFsdWUsIGZvcm1hdCB9ID0gbmV4dFByb3BzO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc3RyOiB2YWx1ZSAmJiB2YWx1ZS5mb3JtYXQoZm9ybWF0KSB8fCAnJyxcbiAgICAgIGludmFsaWQ6IGZhbHNlLFxuICAgIH0pO1xuICB9XG5cbiAgb25JbnB1dENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IHN0ciA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHN0cixcbiAgICB9KTtcbiAgICBjb25zdCB7XG4gICAgICBmb3JtYXQsIGhvdXJPcHRpb25zLCBtaW51dGVPcHRpb25zLCBzZWNvbmRPcHRpb25zLFxuICAgICAgZGlzYWJsZWRIb3VycywgZGlzYWJsZWRNaW51dGVzLFxuICAgICAgZGlzYWJsZWRTZWNvbmRzLCBvbkNoYW5nZSwgYWxsb3dFbXB0eSxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChzdHIpIHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsVmFsdWUgPSB0aGlzLnByb3BzLnZhbHVlO1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFByb3RvVmFsdWUoKS5jbG9uZSgpO1xuICAgICAgY29uc3QgcGFyc2VkID0gbW9tZW50KHN0ciwgZm9ybWF0LCB0cnVlKTtcbiAgICAgIGlmICghcGFyc2VkLmlzVmFsaWQoKSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpbnZhbGlkOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFsdWUuaG91cihwYXJzZWQuaG91cigpKS5taW51dGUocGFyc2VkLm1pbnV0ZSgpKS5zZWNvbmQocGFyc2VkLnNlY29uZCgpKTtcblxuICAgICAgLy8gaWYgdGltZSB2YWx1ZSBub3QgYWxsb3dlZCwgcmVzcG9uc2Ugd2FybmluZy5cbiAgICAgIGlmIChcbiAgICAgICAgaG91ck9wdGlvbnMuaW5kZXhPZih2YWx1ZS5ob3VyKCkpIDwgMCB8fFxuICAgICAgICBtaW51dGVPcHRpb25zLmluZGV4T2YodmFsdWUubWludXRlKCkpIDwgMCB8fFxuICAgICAgICBzZWNvbmRPcHRpb25zLmluZGV4T2YodmFsdWUuc2Vjb25kKCkpIDwgMFxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGludmFsaWQ6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRpbWUgdmFsdWUgaXMgZGlzYWJsZWQsIHJlc3BvbnNlIHdhcm5pbmcuXG4gICAgICBjb25zdCBkaXNhYmxlZEhvdXJPcHRpb25zID0gZGlzYWJsZWRIb3VycygpO1xuICAgICAgY29uc3QgZGlzYWJsZWRNaW51dGVPcHRpb25zID0gZGlzYWJsZWRNaW51dGVzKHZhbHVlLmhvdXIoKSk7XG4gICAgICBjb25zdCBkaXNhYmxlZFNlY29uZE9wdGlvbnMgPSBkaXNhYmxlZFNlY29uZHModmFsdWUuaG91cigpLCB2YWx1ZS5taW51dGUoKSk7XG4gICAgICBpZiAoXG4gICAgICAgIChkaXNhYmxlZEhvdXJPcHRpb25zICYmIGRpc2FibGVkSG91ck9wdGlvbnMuaW5kZXhPZih2YWx1ZS5ob3VyKCkpID49IDApIHx8XG4gICAgICAgIChkaXNhYmxlZE1pbnV0ZU9wdGlvbnMgJiYgZGlzYWJsZWRNaW51dGVPcHRpb25zLmluZGV4T2YodmFsdWUubWludXRlKCkpID49IDApIHx8XG4gICAgICAgIChkaXNhYmxlZFNlY29uZE9wdGlvbnMgJiYgZGlzYWJsZWRTZWNvbmRPcHRpb25zLmluZGV4T2YodmFsdWUuc2Vjb25kKCkpID49IDApXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgaW52YWxpZDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKG9yaWdpbmFsVmFsdWUpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIG9yaWdpbmFsVmFsdWUuaG91cigpICE9PSB2YWx1ZS5ob3VyKCkgfHxcbiAgICAgICAgICBvcmlnaW5hbFZhbHVlLm1pbnV0ZSgpICE9PSB2YWx1ZS5taW51dGUoKSB8fFxuICAgICAgICAgIG9yaWdpbmFsVmFsdWUuc2Vjb25kKCkgIT09IHZhbHVlLnNlY29uZCgpXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIGtlZXAgb3RoZXIgZmllbGRzIGZvciByYy1jYWxlbmRhclxuICAgICAgICAgIGNvbnN0IGNoYW5nZWRWYWx1ZSA9IG9yaWdpbmFsVmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICBjaGFuZ2VkVmFsdWUuaG91cih2YWx1ZS5ob3VyKCkpO1xuICAgICAgICAgIGNoYW5nZWRWYWx1ZS5taW51dGUodmFsdWUubWludXRlKCkpO1xuICAgICAgICAgIGNoYW5nZWRWYWx1ZS5zZWNvbmQodmFsdWUuc2Vjb25kKCkpO1xuICAgICAgICAgIG9uQ2hhbmdlKGNoYW5nZWRWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAob3JpZ2luYWxWYWx1ZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgb25DaGFuZ2UodmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYWxsb3dFbXB0eSkge1xuICAgICAgb25DaGFuZ2UobnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBpbnZhbGlkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpbnZhbGlkOiBmYWxzZSxcbiAgICB9KTtcbiAgfVxuXG4gIG9uS2V5RG93biA9IChlKSA9PiB7XG4gICAgY29uc3QgeyBvbkVzYywgb25LZXlEb3duIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChlLmtleUNvZGUgPT09IDI3KSB7XG4gICAgICBvbkVzYygpO1xuICAgIH1cblxuICAgIG9uS2V5RG93bihlKTtcbiAgfVxuXG4gIG9uQ2xlYXIgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHN0cjogJycgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkNsZWFyKCk7XG4gIH1cblxuICBnZXRDbGVhckJ1dHRvbigpIHtcbiAgICBjb25zdCB7IHByZWZpeENscywgYWxsb3dFbXB0eSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoIWFsbG93RW1wdHkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gKDxhXG4gICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tY2xlYXItYnRuYH1cbiAgICAgIHJvbGU9XCJidXR0b25cIlxuICAgICAgdGl0bGU9e3RoaXMucHJvcHMuY2xlYXJUZXh0fVxuICAgICAgb25Nb3VzZURvd249e3RoaXMub25DbGVhcn1cbiAgICAvPik7XG4gIH1cblxuICBnZXRQcm90b1ZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnByb3BzLnZhbHVlIHx8IHRoaXMucHJvcHMuZGVmYXVsdE9wZW5WYWx1ZTtcbiAgfVxuXG4gIGdldElucHV0KCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBwbGFjZWhvbGRlciwgaW5wdXRSZWFkT25seSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGludmFsaWQsIHN0ciB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBpbnZhbGlkQ2xhc3MgPSBpbnZhbGlkID8gYCR7cHJlZml4Q2xzfS1pbnB1dC1pbnZhbGlkYCA6ICcnO1xuICAgIHJldHVybiAoXG4gICAgICA8aW5wdXRcbiAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWlucHV0ICAke2ludmFsaWRDbGFzc31gfVxuICAgICAgICByZWY9XCJpbnB1dFwiXG4gICAgICAgIG9uS2V5RG93bj17dGhpcy5vbktleURvd259XG4gICAgICAgIHZhbHVlPXtzdHJ9XG4gICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMub25JbnB1dENoYW5nZX1cbiAgICAgICAgcmVhZE9ubHk9eyEhaW5wdXRSZWFkT25seX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHByZWZpeENscyB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taW5wdXQtd3JhcGB9PlxuICAgICAgICB7dGhpcy5nZXRJbnB1dCgpfVxuICAgICAgICB7dGhpcy5nZXRDbGVhckJ1dHRvbigpfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBIZWFkZXI7XG4iXX0=