{"version":3,"sources":["Picker.jsx"],"names":["refFn","field","component","Picker","propTypes","animation","PropTypes","oneOfType","func","string","disabled","bool","transitionName","onChange","onOpenChange","children","getCalendarContainer","calendar","element","style","object","open","defaultOpen","prefixCls","placement","any","value","array","defaultValue","align","getDefaultProps","noop","getInitialState","props","saveCalendarRef","bind","componentWillReceiveProps","nextProps","setState","undefined","componentDidUpdate","_","prevState","state","focusTimeout","setTimeout","focusCalendar","componentWillUnmount","clearTimeout","onCalendarKeyDown","event","keyCode","KeyCode","ESC","stopPropagation","close","focus","onCalendarSelect","cause","source","timePicker","onKeyDown","DOWN","preventDefault","onCalendarOk","onCalendarClear","onVisibleChange","setOpen","getCalendarElement","calendarProps","extraProps","ref","selectedValue","onOk","onSelect","onClear","callback","ReactDOM","findDOMNode","calendarInstance","getBuiltInPlacements","label","placement_haslabel","placements","render","dropdownClassName"],"mappings":"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","sourcesContent":["import React, { cloneElement } from 'react';\nimport ReactDOM from 'react-dom';\nimport createReactClass from 'create-react-class';\nimport PropTypes from 'prop-types';\nimport noop from 'lodash/noop';\nimport createChainedFunction from '../util/createChainedFunction';\nimport KeyCode from '../../_util/KeyCode';\nimport placements, { getPlacements } from './picker/placements';\nimport Trigger from '../trigger';\n\nfunction refFn(field, component) {\n  this[field] = component;\n}\n\nconst Picker = createReactClass({\n  propTypes: {\n    animation: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n    disabled: PropTypes.bool,\n    transitionName: PropTypes.string,\n    onChange: PropTypes.func,\n    onOpenChange: PropTypes.func,\n    children: PropTypes.func,\n    getCalendarContainer: PropTypes.func,\n    calendar: PropTypes.element,\n    style: PropTypes.object,\n    open: PropTypes.bool,\n    defaultOpen: PropTypes.bool,\n    prefixCls: PropTypes.string,\n    placement: PropTypes.any,\n    value: PropTypes.oneOfType([\n      PropTypes.object,\n      PropTypes.array,\n    ]),\n    defaultValue: PropTypes.oneOfType([\n      PropTypes.object,\n      PropTypes.array,\n    ]),\n    align: PropTypes.object,\n  },\n\n  getDefaultProps() {\n    return {\n      prefixCls: 'rc-calendar-picker',\n      style: {},\n      align: {},\n      placement: 'bottomLeft',\n      defaultOpen: false,\n      onChange: noop,\n      onOpenChange: noop,\n    };\n  },\n\n  getInitialState() {\n    const props = this.props;\n    let open;\n    if ('open' in props) {\n      open = props.open;\n    } else {\n      open = props.defaultOpen;\n    }\n    const value = props.value || props.defaultValue;\n    this.saveCalendarRef = refFn.bind(this, 'calendarInstance');\n    return {\n      open,\n      value,\n    };\n  },\n\n  componentWillReceiveProps(nextProps) {\n    const { value, open } = nextProps;\n    if ('value' in nextProps) {\n      this.setState({\n        value,\n      });\n    }\n    if (open !== undefined) {\n      this.setState({\n        open,\n      });\n    }\n  },\n\n  componentDidUpdate(_, prevState) {\n    if (!prevState.open && this.state.open) {\n      // setTimeout is for making sure saveCalendarRef happen before focusCalendar\n      this.focusTimeout = setTimeout(this.focusCalendar, 0, this);\n    }\n  },\n\n  componentWillUnmount() {\n    clearTimeout(this.focusTimeout);\n  },\n\n  onCalendarKeyDown(event) {\n    if (event.keyCode === KeyCode.ESC) {\n      event.stopPropagation();\n      this.close(this.focus);\n    }\n  },\n\n  onCalendarSelect(value, cause = {}) {\n    const props = this.props;\n    if (!('value' in props)) {\n      this.setState({\n        value,\n      });\n    }\n    if (\n      cause.source === 'keyboard' ||\n      (!props.calendar.props.timePicker && cause.source !== 'dateInput') ||\n      cause.source === 'todayButton') {\n      this.close(this.focus);\n    }\n    props.onChange(value);\n  },\n\n  onKeyDown(event) {\n    if (event.keyCode === KeyCode.DOWN && !this.state.open) {\n      this.open();\n      event.preventDefault();\n    }\n  },\n\n  onCalendarOk() {\n    this.close(this.focus);\n  },\n\n  onCalendarClear() {\n    this.close(this.focus);\n  },\n\n  onVisibleChange(open) {\n    this.setOpen(open);\n  },\n\n  getCalendarElement() {\n    const props = this.props;\n    const state = this.state;\n    const calendarProps = props.calendar.props;\n    const { value } = state;\n    const defaultValue = value;\n    const extraProps = {\n      ref: this.saveCalendarRef,\n      defaultValue: defaultValue || calendarProps.defaultValue,\n      selectedValue: value,\n      onKeyDown: this.onCalendarKeyDown,\n      onOk: createChainedFunction(calendarProps.onOk, this.onCalendarOk),\n      onSelect: createChainedFunction(calendarProps.onSelect, this.onCalendarSelect),\n      onClear: createChainedFunction(calendarProps.onClear, this.onCalendarClear),\n    };\n\n    return cloneElement(props.calendar, extraProps);\n  },\n\n  setOpen(open, callback) {\n    const { onOpenChange } = this.props;\n    if (this.state.open !== open) {\n      if (!('open' in this.props)) {\n        this.setState({\n          open,\n        }, callback);\n      }\n      onOpenChange(open);\n    }\n  },\n\n  open(callback) {\n    this.setOpen(true, callback);\n  },\n\n  close(callback) {\n    this.setOpen(false, callback);\n  },\n\n  focus() {\n    if (!this.state.open) {\n      ReactDOM.findDOMNode(this).focus();\n    }\n  },\n\n  focusCalendar() {\n    if (this.state.open && !!this.calendarInstance) {\n      this.calendarInstance.focus();\n    }\n  },\n\n  getBuiltInPlacements() {\n    const { label } = this.props;\n    const placement_haslabel = {\n      'bottomLeft': [0, -19],\n      'bottomRight': [0, -19],\n    };\n    if (label) {\n      return getPlacements(placement_haslabel);\n    }\n    return placements;\n  },\n\n  render() {\n    const props = this.props;\n    const {\n      prefixCls, placement,\n      style, getCalendarContainer,\n      align, animation,\n      disabled,\n      dropdownClassName,\n      transitionName, children,\n    } = props;\n    const state = this.state;\n    const getBuiltInPlacements = this.getBuiltInPlacements();\n    return (<Trigger\n      popup={this.getCalendarElement()}\n      popupAlign={align}\n      builtinPlacements={this.getBuiltInPlacements()}\n      popupPlacement={placement}\n      action={(disabled && !state.open) ? [] : ['click']}\n      destroyPopupOnHide\n      getPopupContainer={getCalendarContainer}\n      popupStyle={style}\n      popupAnimation={animation}\n      popupTransitionName={transitionName}\n      popupVisible={state.open}\n      onPopupVisibleChange={this.onVisibleChange}\n      prefixCls={prefixCls}\n      popupClassName={dropdownClassName}\n    >\n      {cloneElement(children(state, props), { onKeyDown: this.onKeyDown })}\n    </Trigger>);\n  },\n});\n\nexport default Picker;\n"]}