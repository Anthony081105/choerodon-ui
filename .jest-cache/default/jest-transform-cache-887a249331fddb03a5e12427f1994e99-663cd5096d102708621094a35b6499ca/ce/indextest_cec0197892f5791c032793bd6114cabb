218224b27304b56275a117c9905a1bab
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var _moment = _interopRequireDefault(require("moment"));

var _enzyme = require("enzyme");

var _ = _interopRequireDefault(require(".."));

describe('Calendar', function () {
  it('Calendar should be selectable', function () {
    var onSelect = jest.fn();
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      onSelect: onSelect
    }));
    wrapper.find('.c7n-fullcalendar-cell').at(0).simulate('click');
    expect(onSelect).toHaveBeenCalledWith(expect.anything());
    var value = onSelect.mock.calls[0][0];
    expect(_moment["default"].isMoment(value)).toBe(true);
  });
  it('only Valid range should be selectable', function () {
    var onSelect = jest.fn();
    var validRange = [(0, _moment["default"])('2018-02-02'), (0, _moment["default"])('2018-02-18')];
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      onSelect: onSelect,
      validRange: validRange,
      defaultValue: (0, _moment["default"])('2018-02-02')
    }));
    wrapper.find('[title="February 1, 2018"]').at(0).simulate('click');
    wrapper.find('[title="February 2, 2018"]').at(0).simulate('click');
    expect(onSelect.mock.calls.length).toBe(1);
  });
  it('dates other than in valid range should be disabled', function () {
    var onSelect = jest.fn();
    var validRange = [(0, _moment["default"])('2018-02-02'), (0, _moment["default"])('2018-02-18')];
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      onSelect: onSelect,
      validRange: validRange,
      defaultValue: (0, _moment["default"])('2018-02-02')
    }));
    wrapper.find('[title="February 20, 2018"]').at(0).simulate('click');
    var elem = wrapper.find('[title="February 20, 2018"]').hasClass('c7n-fullcalendar-disabled-cell');
    expect(elem).toEqual(true);
    expect(onSelect.mock.calls.length).toBe(0);
  });
  it('months other than in valid range should be disabled', function () {
    var onSelect = jest.fn();
    var validRange = [(0, _moment["default"])('2018-02-02'), (0, _moment["default"])('2018-05-18')];
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      onSelect: onSelect,
      validRange: validRange,
      defaultValue: (0, _moment["default"])('2018-02-02'),
      mode: "year"
    }));
    expect(wrapper.find('[title="Jan"]').at(0).hasClass('c7n-fullcalendar-month-panel-cell-disabled')).toBe(true);
    expect(wrapper.find('[title="Feb"]').at(0).hasClass('c7n-fullcalendar-month-panel-cell-disabled')).toBe(false);
    expect(wrapper.find('[title="Jun"]').at(0).hasClass('c7n-fullcalendar-month-panel-cell-disabled')).toBe(true);
    wrapper.find('[title="Jan"]').at(0).simulate('click');
    wrapper.find('[title="Mar"]').at(0).simulate('click');
    expect(onSelect.mock.calls.length).toBe(1);
  });
  it('months other than in valid range should not be shown in header', function () {
    var validRange = [(0, _moment["default"])('2017-02-02'), (0, _moment["default"])('2018-05-18')];
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      validRange: validRange
    }));
    wrapper.find('.c7n-fullcalendar-year-select').hostNodes().simulate('click');
    wrapper.find('.c7n-select-dropdown-menu-item').first().simulate('click');
    wrapper.find('.c7n-fullcalendar-month-select').hostNodes().simulate('click'); // 2 years and 11 months

    expect(wrapper.find('.c7n-select-dropdown-menu-item').length).toBe(13);
  });
  it('getDateRange should returns a disabledDate function', function () {
    var validRange = [(0, _moment["default"])('2018-02-02'), (0, _moment["default"])('2018-05-18')];
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      validRange: validRange,
      defaultValue: (0, _moment["default"])('2018-02-02')
    }));
    var instance = wrapper.instance();
    var disabledDate = instance.getDateRange(validRange);
    expect(disabledDate((0, _moment["default"])('2018-06-02'))).toBe(true);
    expect(disabledDate((0, _moment["default"])('2018-04-02'))).toBe(false);
  });
  it('Calendar should change mode by prop', function () {
    var monthMode = 'month';
    var yearMode = 'year';
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], null));
    expect(wrapper.state().mode).toEqual(monthMode);
    wrapper.setProps({
      mode: 'year'
    });
    expect(wrapper.state().mode).toEqual(yearMode);
  });
  it('Calendar should switch mode', function () {
    var monthMode = 'month';
    var yearMode = 'year';
    var onPanelChangeStub = jest.fn();
    var wrapper = (0, _enzyme.mount)(_react["default"].createElement(_["default"], {
      mode: yearMode,
      onPanelChange: onPanelChangeStub
    }));
    expect(wrapper.state().mode).toEqual(yearMode);
    wrapper.instance().setType('date');
    expect(wrapper.state().mode).toEqual(monthMode);
    expect(onPanelChangeStub).toHaveBeenCalledTimes(1);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRlc3QuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJpdCIsIm9uU2VsZWN0IiwiamVzdCIsImZuIiwid3JhcHBlciIsImZpbmQiLCJhdCIsInNpbXVsYXRlIiwiZXhwZWN0IiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJhbnl0aGluZyIsInZhbHVlIiwibW9jayIsImNhbGxzIiwiTW9tZW50IiwiaXNNb21lbnQiLCJ0b0JlIiwidmFsaWRSYW5nZSIsImxlbmd0aCIsImVsZW0iLCJoYXNDbGFzcyIsInRvRXF1YWwiLCJob3N0Tm9kZXMiLCJmaXJzdCIsImluc3RhbmNlIiwiZGlzYWJsZWREYXRlIiwiZ2V0RGF0ZVJhbmdlIiwibW9udGhNb2RlIiwieWVhck1vZGUiLCJzdGF0ZSIsIm1vZGUiLCJzZXRQcm9wcyIsIm9uUGFuZWxDaGFuZ2VTdHViIiwic2V0VHlwZSIsInRvSGF2ZUJlZW5DYWxsZWRUaW1lcyJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBQSxRQUFRLENBQUMsVUFBRCxFQUFhLFlBQU07QUFDekJDLEVBQUFBLEVBQUUsQ0FBQywrQkFBRCxFQUFrQyxZQUFNO0FBQ3hDLFFBQU1DLFFBQVEsR0FBR0MsSUFBSSxDQUFDQyxFQUFMLEVBQWpCO0FBQ0EsUUFBTUMsT0FBTyxHQUFHLG1CQUFNLGdDQUFDLFlBQUQ7QUFBVSxNQUFBLFFBQVEsRUFBRUg7QUFBcEIsTUFBTixDQUFoQjtBQUNBRyxJQUFBQSxPQUFPLENBQ0pDLElBREgsQ0FDUSx3QkFEUixFQUVHQyxFQUZILENBRU0sQ0FGTixFQUdHQyxRQUhILENBR1ksT0FIWjtBQUlBQyxJQUFBQSxNQUFNLENBQUNQLFFBQUQsQ0FBTixDQUFpQlEsb0JBQWpCLENBQXNDRCxNQUFNLENBQUNFLFFBQVAsRUFBdEM7QUFDQSxRQUFNQyxLQUFLLEdBQUdWLFFBQVEsQ0FBQ1csSUFBVCxDQUFjQyxLQUFkLENBQW9CLENBQXBCLEVBQXVCLENBQXZCLENBQWQ7QUFD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QSxNQUFNLENBQUNKLE9BQU8sQ0FBQ3lCLEtBQVIsR0FBZ0JDLElBQWpCLENBQU4sQ0FBNkJULE9BQTdCLENBQXFDTyxRQUFyQztBQUNELEdBUEMsQ0FBRjtBQVNBNUIsRUFBQUEsRUFBRSxDQUFDLDZCQUFELEVBQWdDLFlBQU07QUFDdEMsUUFBTTJCLFNBQVMsR0FBRyxPQUFsQjtBQUNBLFFBQU1DLFFBQVEsR0FBRyxNQUFqQjtBQUNBLFFBQU1JLGlCQUFpQixHQUFHOUIsSUFBSSxDQUFDQyxFQUFMLEVBQTFCO0FBQ0EsUUFBTUMsT0FBTyxHQUFHLG1CQUFNLGdDQUFDLFlBQUQ7QUFBVSxNQUFBLElBQUksRUFBRXdCLFFBQWhCO0FBQTBCLE1BQUEsYUFBYSxFQUFFSTtBQUF6QyxNQUFOLENBQWhCO0FBQ0F4QixJQUFBQSxNQUFNLENBQUNKLE9BQU8sQ0FBQ3lCLEtBQVIsR0FBZ0JDLElBQWpCLENBQU4sQ0FBNkJULE9BQTdCLENBQXFDTyxRQUFyQztBQUNBeEIsSUFBQUEsT0FBTyxDQUFDb0IsUUFBUixHQUFtQlMsT0FBbkIsQ0FBMkIsTUFBM0I7QUFDQXpCLElBQUFBLE1BQU0sQ0FBQ0osT0FBTyxDQUFDeUIsS0FBUixHQUFnQkMsSUFBakIsQ0FBTixDQUE2QlQsT0FBN0IsQ0FBcUNNLFNBQXJDO0FBQ0FuQixJQUFBQSxNQUFNLENBQUN3QixpQkFBRCxDQUFOLENBQTBCRSxxQkFBMUIsQ0FBZ0QsQ0FBaEQ7QUFDRCxHQVRDLENBQUY7QUFVRCxDQXRJTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBNb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IG1vdW50IH0gZnJvbSAnZW56eW1lJztcbmltcG9ydCBDYWxlbmRhciBmcm9tICcuLic7XG5cbmRlc2NyaWJlKCdDYWxlbmRhcicsICgpID0+IHtcbiAgaXQoJ0NhbGVuZGFyIHNob3VsZCBiZSBzZWxlY3RhYmxlJywgKCkgPT4ge1xuICAgIGNvbnN0IG9uU2VsZWN0ID0gamVzdC5mbigpO1xuICAgIGNvbnN0IHdyYXBwZXIgPSBtb3VudCg8Q2FsZW5kYXIgb25TZWxlY3Q9e29uU2VsZWN0fSAvPik7XG4gICAgd3JhcHBlclxuICAgICAgLmZpbmQoJy5jN24tZnVsbGNhbGVuZGFyLWNlbGwnKVxuICAgICAgLmF0KDApXG4gICAgICAuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgZXhwZWN0KG9uU2VsZWN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55dGhpbmcoKSk7XG4gICAgY29uc3QgdmFsdWUgPSBvblNlbGVjdC5tb2NrLmNhbGxzWzBdWzBdO1xuICAgIGV4cGVjdChNb21lbnQuaXNNb21lbnQodmFsdWUpKS50b0JlKHRydWUpO1xuICB9KTtcblxuICBpdCgnb25seSBWYWxpZCByYW5nZSBzaG91bGQgYmUgc2VsZWN0YWJsZScsICgpID0+IHtcbiAgICBjb25zdCBvblNlbGVjdCA9IGplc3QuZm4oKTtcbiAgICBjb25zdCB2YWxpZFJhbmdlID0gW01vbWVudCgnMjAxOC0wMi0wMicpLCBNb21lbnQoJzIwMTgtMDItMTgnKV07XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KFxuICAgICAgPENhbGVuZGFyIG9uU2VsZWN0PXtvblNlbGVjdH0gdmFsaWRSYW5nZT17dmFsaWRSYW5nZX0gZGVmYXVsdFZhbHVlPXtNb21lbnQoJzIwMTgtMDItMDInKX0gLz4sXG4gICAgKTtcbiAgICB3cmFwcGVyXG4gICAgICAuZmluZCgnW3RpdGxlPVwiRmVicnVhcnkgMSwgMjAxOFwiXScpXG4gICAgICAuYXQoMClcbiAgICAgIC5zaW11bGF0ZSgnY2xpY2snKTtcbiAgICB3cmFwcGVyXG4gICAgICAuZmluZCgnW3RpdGxlPVwiRmVicnVhcnkgMiwgMjAxOFwiXScpXG4gICAgICAuYXQoMClcbiAgICAgIC5zaW11bGF0ZSgnY2xpY2snKTtcbiAgICBleHBlY3Qob25TZWxlY3QubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIGl0KCdkYXRlcyBvdGhlciB0aGFuIGluIHZhbGlkIHJhbmdlIHNob3VsZCBiZSBkaXNhYmxlZCcsICgpID0+IHtcbiAgICBjb25zdCBvblNlbGVjdCA9IGplc3QuZm4oKTtcbiAgICBjb25zdCB2YWxpZFJhbmdlID0gW01vbWVudCgnMjAxOC0wMi0wMicpLCBNb21lbnQoJzIwMTgtMDItMTgnKV07XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KFxuICAgICAgPENhbGVuZGFyIG9uU2VsZWN0PXtvblNlbGVjdH0gdmFsaWRSYW5nZT17dmFsaWRSYW5nZX0gZGVmYXVsdFZhbHVlPXtNb21lbnQoJzIwMTgtMDItMDInKX0gLz4sXG4gICAgKTtcbiAgICB3cmFwcGVyXG4gICAgICAuZmluZCgnW3RpdGxlPVwiRmVicnVhcnkgMjAsIDIwMThcIl0nKVxuICAgICAgLmF0KDApXG4gICAgICAuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgY29uc3QgZWxlbSA9IHdyYXBwZXJcbiAgICAgIC5maW5kKCdbdGl0bGU9XCJGZWJydWFyeSAyMCwgMjAxOFwiXScpXG4gICAgICAuaGFzQ2xhc3MoJ2M3bi1mdWxsY2FsZW5kYXItZGlzYWJsZWQtY2VsbCcpO1xuICAgIGV4cGVjdChlbGVtKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdChvblNlbGVjdC5tb2NrLmNhbGxzLmxlbmd0aCkudG9CZSgwKTtcbiAgfSk7XG5cbiAgaXQoJ21vbnRocyBvdGhlciB0aGFuIGluIHZhbGlkIHJhbmdlIHNob3VsZCBiZSBkaXNhYmxlZCcsICgpID0+IHtcbiAgICBjb25zdCBvblNlbGVjdCA9IGplc3QuZm4oKTtcbiAgICBjb25zdCB2YWxpZFJhbmdlID0gW01vbWVudCgnMjAxOC0wMi0wMicpLCBNb21lbnQoJzIwMTgtMDUtMTgnKV07XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KFxuICAgICAgPENhbGVuZGFyXG4gICAgICAgIG9uU2VsZWN0PXtvblNlbGVjdH1cbiAgICAgICAgdmFsaWRSYW5nZT17dmFsaWRSYW5nZX1cbiAgICAgICAgZGVmYXVsdFZhbHVlPXtNb21lbnQoJzIwMTgtMDItMDInKX1cbiAgICAgICAgbW9kZT1cInllYXJcIlxuICAgICAgLz4sXG4gICAgKTtcbiAgICBleHBlY3QoXG4gICAgICB3cmFwcGVyXG4gICAgICAgIC5maW5kKCdbdGl0bGU9XCJKYW5cIl0nKVxuICAgICAgICAuYXQoMClcbiAgICAgICAgLmhhc0NsYXNzKCdjN24tZnVsbGNhbGVuZGFyLW1vbnRoLXBhbmVsLWNlbGwtZGlzYWJsZWQnKSxcbiAgICApLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KFxuICAgICAgd3JhcHBlclxuICAgICAgICAuZmluZCgnW3RpdGxlPVwiRmViXCJdJylcbiAgICAgICAgLmF0KDApXG4gICAgICAgIC5oYXNDbGFzcygnYzduLWZ1bGxjYWxlbmRhci1tb250aC1wYW5lbC1jZWxsLWRpc2FibGVkJyksXG4gICAgKS50b0JlKGZhbHNlKTtcbiAgICBleHBlY3QoXG4gICAgICB3cmFwcGVyXG4gICAgICAgIC5maW5kKCdbdGl0bGU9XCJKdW5cIl0nKVxuICAgICAgICAuYXQoMClcbiAgICAgICAgLmhhc0NsYXNzKCdjN24tZnVsbGNhbGVuZGFyLW1vbnRoLXBhbmVsLWNlbGwtZGlzYWJsZWQnKSxcbiAgICApLnRvQmUodHJ1ZSk7XG4gICAgd3JhcHBlclxuICAgICAgLmZpbmQoJ1t0aXRsZT1cIkphblwiXScpXG4gICAgICAuYXQoMClcbiAgICAgIC5zaW11bGF0ZSgnY2xpY2snKTtcbiAgICB3cmFwcGVyXG4gICAgICAuZmluZCgnW3RpdGxlPVwiTWFyXCJdJylcbiAgICAgIC5hdCgwKVxuICAgICAgLnNpbXVsYXRlKCdjbGljaycpO1xuICAgIGV4cGVjdChvblNlbGVjdC5tb2NrLmNhbGxzLmxlbmd0aCkudG9CZSgxKTtcbiAgfSk7XG5cbiAgaXQoJ21vbnRocyBvdGhlciB0aGFuIGluIHZhbGlkIHJhbmdlIHNob3VsZCBub3QgYmUgc2hvd24gaW4gaGVhZGVyJywgKCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkUmFuZ2UgPSBbTW9tZW50KCcyMDE3LTAyLTAyJyksIE1vbWVudCgnMjAxOC0wNS0xOCcpXTtcbiAgICBjb25zdCB3cmFwcGVyID0gbW91bnQoPENhbGVuZGFyIHZhbGlkUmFuZ2U9e3ZhbGlkUmFuZ2V9IC8+KTtcbiAgICB3cmFwcGVyXG4gICAgICAuZmluZCgnLmM3bi1mdWxsY2FsZW5kYXIteWVhci1zZWxlY3QnKVxuICAgICAgLmhvc3ROb2RlcygpXG4gICAgICAuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgd3JhcHBlclxuICAgICAgLmZpbmQoJy5jN24tc2VsZWN0LWRyb3Bkb3duLW1lbnUtaXRlbScpXG4gICAgICAuZmlyc3QoKVxuICAgICAgLnNpbXVsYXRlKCdjbGljaycpO1xuICAgIHdyYXBwZXJcbiAgICAgIC5maW5kKCcuYzduLWZ1bGxjYWxlbmRhci1tb250aC1zZWxlY3QnKVxuICAgICAgLmhvc3ROb2RlcygpXG4gICAgICAuc2ltdWxhdGUoJ2NsaWNrJyk7XG4gICAgLy8gMiB5ZWFycyBhbmQgMTEgbW9udGhzXG4gICAgZXhwZWN0KHdyYXBwZXIuZmluZCgnLmM3bi1zZWxlY3QtZHJvcGRvd24tbWVudS1pdGVtJykubGVuZ3RoKS50b0JlKDEzKTtcbiAgfSk7XG5cbiAgaXQoJ2dldERhdGVSYW5nZSBzaG91bGQgcmV0dXJucyBhIGRpc2FibGVkRGF0ZSBmdW5jdGlvbicsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZFJhbmdlID0gW01vbWVudCgnMjAxOC0wMi0wMicpLCBNb21lbnQoJzIwMTgtMDUtMTgnKV07XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KDxDYWxlbmRhciB2YWxpZFJhbmdlPXt2YWxpZFJhbmdlfSBkZWZhdWx0VmFsdWU9e01vbWVudCgnMjAxOC0wMi0wMicpfSAvPik7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB3cmFwcGVyLmluc3RhbmNlKCk7XG4gICAgY29uc3QgZGlzYWJsZWREYXRlID0gaW5zdGFuY2UuZ2V0RGF0ZVJhbmdlKHZhbGlkUmFuZ2UpO1xuICAgIGV4cGVjdChkaXNhYmxlZERhdGUoTW9tZW50KCcyMDE4LTA2LTAyJykpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChkaXNhYmxlZERhdGUoTW9tZW50KCcyMDE4LTA0LTAyJykpKS50b0JlKGZhbHNlKTtcbiAgfSk7XG5cbiAgaXQoJ0NhbGVuZGFyIHNob3VsZCBjaGFuZ2UgbW9kZSBieSBwcm9wJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vbnRoTW9kZSA9ICdtb250aCc7XG4gICAgY29uc3QgeWVhck1vZGUgPSAneWVhcic7XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KDxDYWxlbmRhciAvPik7XG4gICAgZXhwZWN0KHdyYXBwZXIuc3RhdGUoKS5tb2RlKS50b0VxdWFsKG1vbnRoTW9kZSk7XG4gICAgd3JhcHBlci5zZXRQcm9wcyh7IG1vZGU6ICd5ZWFyJyB9KTtcbiAgICBleHBlY3Qod3JhcHBlci5zdGF0ZSgpLm1vZGUpLnRvRXF1YWwoeWVhck1vZGUpO1xuICB9KTtcblxuICBpdCgnQ2FsZW5kYXIgc2hvdWxkIHN3aXRjaCBtb2RlJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vbnRoTW9kZSA9ICdtb250aCc7XG4gICAgY29uc3QgeWVhck1vZGUgPSAneWVhcic7XG4gICAgY29uc3Qgb25QYW5lbENoYW5nZVN0dWIgPSBqZXN0LmZuKCk7XG4gICAgY29uc3Qgd3JhcHBlciA9IG1vdW50KDxDYWxlbmRhciBtb2RlPXt5ZWFyTW9kZX0gb25QYW5lbENoYW5nZT17b25QYW5lbENoYW5nZVN0dWJ9IC8+KTtcbiAgICBleHBlY3Qod3JhcHBlci5zdGF0ZSgpLm1vZGUpLnRvRXF1YWwoeWVhck1vZGUpO1xuICAgIHdyYXBwZXIuaW5zdGFuY2UoKS5zZXRUeXBlKCdkYXRlJyk7XG4gICAgZXhwZWN0KHdyYXBwZXIuc3RhdGUoKS5tb2RlKS50b0VxdWFsKG1vbnRoTW9kZSk7XG4gICAgZXhwZWN0KG9uUGFuZWxDaGFuZ2VTdHViKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gIH0pO1xufSk7XG4iXX0=