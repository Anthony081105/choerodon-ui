6585826db3a89d7bce7fa735c2373f25
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _omit = _interopRequireDefault(require("lodash/omit"));

var _isCssAnimationSupported = _interopRequireDefault(require("../_util/isCssAnimationSupported"));

var _animate = _interopRequireDefault(require("../animate"));

var _progress = _interopRequireDefault(require("../progress/progress"));

var _configure = require("../configure");

var Spin =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Spin, _Component);

  function Spin(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Spin);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Spin).call(this, props));
    var spinning = props.spinning;
    _this.state = {
      spinning: spinning
    };
    return _this;
  }

  (0, _createClass2["default"])(Spin, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (!(0, _isCssAnimationSupported["default"])()) {
        // Show text in IE9
        this.setState({
          notCssAnimationSupported: true
        });
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (this.debounceTimeout) {
        clearTimeout(this.debounceTimeout);
      }

      if (this.delayTimeout) {
        clearTimeout(this.delayTimeout);
      }
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      var _this2 = this;

      var currentSpinning = this.props.spinning;
      var spinning = nextProps.spinning;
      var delay = this.props.delay;

      if (this.debounceTimeout) {
        clearTimeout(this.debounceTimeout);
      }

      if (currentSpinning && !spinning) {
        this.debounceTimeout = window.setTimeout(function () {
          return _this2.setState({
            spinning: spinning
          });
        }, 200);

        if (this.delayTimeout) {
          clearTimeout(this.delayTimeout);
        }
      } else if (spinning && delay && !isNaN(Number(delay))) {
        if (this.delayTimeout) {
          clearTimeout(this.delayTimeout);
        }

        this.delayTimeout = window.setTimeout(function () {
          return _this2.setState({
            spinning: spinning
          });
        }, delay);
      } else {
        this.setState({
          spinning: spinning
        });
      }
    }
  }, {
    key: "renderIndicator",
    value: function renderIndicator(prefixCls) {
      var _this$props = this.props,
          indicator = _this$props.indicator,
          size = _this$props.size;
      var dotClassName = "".concat(prefixCls, "-dot");

      if ((0, _react.isValidElement)(indicator)) {
        return (0, _react.cloneElement)(indicator, {
          className: (0, _classnames["default"])(indicator.props.className, dotClassName)
        });
      }

      return _react["default"].createElement(_progress["default"], {
        size: size,
        className: dotClassName,
        type: "loading"
        /* loading */

      });
    }
  }, {
    key: "render",
    value: function render() {
      var _classNames;

      var _this$props2 = this.props,
          className = _this$props2.className,
          size = _this$props2.size,
          customizePrefixCls = _this$props2.prefixCls,
          tip = _this$props2.tip,
          wrapperClassName = _this$props2.wrapperClassName,
          children = _this$props2.children,
          style = _this$props2.style,
          restProps = (0, _objectWithoutProperties2["default"])(_this$props2, ["className", "size", "prefixCls", "tip", "wrapperClassName", "children", "style"]);
      var _this$state = this.state,
          spinning = _this$state.spinning,
          notCssAnimationSupported = _this$state.notCssAnimationSupported;
      var prefixCls = (0, _configure.getPrefixCls)('spin', customizePrefixCls);
      var spinClassName = (0, _classnames["default"])(prefixCls, (_classNames = {}, (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-sm"), size === "small"), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-lg"), size === "large"), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-spinning"), spinning), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-show-text"), !!tip || notCssAnimationSupported), _classNames), className); // fix https://fb.me/react-unknown-prop

      var divProps = (0, _omit["default"])(restProps, ['spinning', 'delay', 'indicator']);

      var spinElement = _react["default"].createElement("div", (0, _extends2["default"])({}, divProps, {
        className: spinClassName,
        style: style,
        key: "loading"
      }), this.renderIndicator(prefixCls), tip ? _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-text")
      }, tip) : null);

      if (children) {
        var _classNames2;

        var animateClassName = "".concat(prefixCls, "-nested-loading");

        if (wrapperClassName) {
          animateClassName += " ".concat(wrapperClassName);
        }

        var containerClassName = (0, _classnames["default"])((_classNames2 = {}, (0, _defineProperty2["default"])(_classNames2, "".concat(prefixCls, "-container"), true), (0, _defineProperty2["default"])(_classNames2, "".concat(prefixCls, "-blur"), spinning), _classNames2));
        return _react["default"].createElement(_animate["default"], (0, _extends2["default"])({}, divProps, {
          component: "div",
          className: animateClassName,
          transitionName: "fade"
        }), spinning && spinElement, _react["default"].createElement("div", {
          className: containerClassName,
          key: "container"
        }, children));
      }

      return spinElement;
    }
  }]);
  return Spin;
}(_react.Component);

exports["default"] = Spin;
Spin.displayName = 'Spin';
Spin.defaultProps = {
  spinning: true,
  size: "default"
  /* default */
  ,
  wrapperClassName: ''
};
Spin.propTypes = {
  prefixCls: _propTypes["default"].string,
  className: _propTypes["default"].string,
  spinning: _propTypes["default"].bool,
  size: _propTypes["default"].oneOf(["small"
  /* small */
  , "default"
  /* default */
  , "large"
  /* large */
  ]),
  wrapperClassName: _propTypes["default"].string,
  indicator: _propTypes["default"].node
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNwaW4vaW5kZXguanMiXSwibmFtZXMiOlsiU3BpbiIsIkNvbXBvbmVudCIsInNwaW5uaW5nIiwicHJvcHMiLCJub3RDc3NBbmltYXRpb25TdXBwb3J0ZWQiLCJjbGVhclRpbWVvdXQiLCJuZXh0UHJvcHMiLCJjdXJyZW50U3Bpbm5pbmciLCJkZWxheSIsImlzTmFOIiwiTnVtYmVyIiwicHJlZml4Q2xzIiwiaW5kaWNhdG9yIiwic2l6ZSIsImRvdENsYXNzTmFtZSIsImNsYXNzTmFtZSIsIlByb2dyZXNzIiwidHlwZSIsImN1c3RvbWl6ZVByZWZpeENscyIsInRpcCIsIndyYXBwZXJDbGFzc05hbWUiLCJjaGlsZHJlbiIsInN0eWxlIiwicmVzdFByb3BzIiwic3BpbkNsYXNzTmFtZSIsImRpdlByb3BzIiwic3BpbkVsZW1lbnQiLCJrZXkiLCJhbmltYXRlQ2xhc3NOYW1lIiwiY29udGFpbmVyQ2xhc3NOYW1lIiwiQW5pbWF0ZSIsImNvbXBvbmVudCIsInRyYW5zaXRpb25OYW1lIiwiUHJvcFR5cGVzIiwibm9kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxLQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSx3QkFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGtDQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFFBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxZQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFNBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxzQkFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQTs7SUFDcUJBLEk7Ozs7O0FBQ2pCLFdBQUEsSUFBQSxDQUFBLEtBQUEsRUFBbUI7QUFBQSxRQUFBLEtBQUE7O0FBQUEsS0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLElBQUE7QUFDZixJQUFBLEtBQUEsR0FBQSxDQUFBLEdBQUEsMkJBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxJQUFBLEVBQUEsS0FBQSxDQUFBLENBQUE7QUFDQSxRQUFNRSxRQUFRLEdBQUdDLEtBQUssQ0FBdEIsUUFBQTtBQUNBLElBQUEsS0FBQSxDQUFBLEtBQUEsR0FBYTtBQUNURCxNQUFBQSxRQUFRLEVBQVJBO0FBRFMsS0FBYjtBQUhlLFdBQUEsS0FBQTtBQU1sQjs7Ozt3Q0FDbUI7QUFDaEIsVUFBSSxDQUFDLENBQUEsR0FBQSx3QkFBQSxDQUFMLFNBQUssQ0FBQSxHQUFMLEVBQWdDO0FBQzVCO0FBQ0EsYUFBQSxRQUFBLENBQWM7QUFDVkUsVUFBQUEsd0JBQXdCLEVBQUU7QUFEaEIsU0FBZDtBQUdIO0FBQ0o7OzsyQ0FDc0I7QUFDbkIsVUFBSSxLQUFKLGVBQUEsRUFBMEI7QUFDdEJDLFFBQUFBLFlBQVksQ0FBQyxLQUFiQSxlQUFZLENBQVpBO0FBQ0g7O0FBQ0QsVUFBSSxLQUFKLFlBQUEsRUFBdUI7QUFDbkJBLFFBQUFBLFlBQVksQ0FBQyxLQUFiQSxZQUFZLENBQVpBO0FBQ0g7QUFDSjs7OzhDQUN5QkMsUyxFQUFXO0FBQUEsVUFBQSxNQUFBLEdBQUEsSUFBQTs7QUFBQSxVQUNmQyxlQURlLEdBQ0ssS0FETCxLQUNLLENBREwsUUFBQTtBQUVqQyxVQUFNTCxRQUFRLEdBQUdJLFNBQVMsQ0FBMUIsUUFBQTtBQUZpQyxVQUd6QkUsS0FIeUIsR0FHZixLQUhlLEtBR2YsQ0FIZSxLQUFBOztBQUlqQyxVQUFJLEtBQUosZUFBQSxFQUEwQjtBQUN0QkgsUUFBQUEsWUFBWSxDQUFDLEtBQWJBLGVBQVksQ0FBWkE7QUFDSDs7QUFDRCxVQUFJRSxlQUFlLElBQUksQ0FBdkIsUUFBQSxFQUFrQztBQUM5QixhQUFBLGVBQUEsR0FBdUIsTUFBTSxDQUFOLFVBQUEsQ0FBa0IsWUFBQTtBQUFBLGlCQUFNLE1BQUksQ0FBSixRQUFBLENBQWM7QUFBRUwsWUFBQUEsUUFBUSxFQUFSQTtBQUFGLFdBQWQsQ0FBTjtBQUFsQixTQUFBLEVBQXZCLEdBQXVCLENBQXZCOztBQUNBLFlBQUksS0FBSixZQUFBLEVBQXVCO0FBQ25CRyxVQUFBQSxZQUFZLENBQUMsS0FBYkEsWUFBWSxDQUFaQTtBQUNIO0FBSkwsT0FBQSxNQU1LLElBQUlILFFBQVEsSUFBUkEsS0FBQUEsSUFBcUIsQ0FBQ08sS0FBSyxDQUFDQyxNQUFNLENBQXRDLEtBQXNDLENBQVAsQ0FBL0IsRUFBZ0Q7QUFDakQsWUFBSSxLQUFKLFlBQUEsRUFBdUI7QUFDbkJMLFVBQUFBLFlBQVksQ0FBQyxLQUFiQSxZQUFZLENBQVpBO0FBQ0g7O0FBQ0QsYUFBQSxZQUFBLEdBQW9CLE1BQU0sQ0FBTixVQUFBLENBQWtCLFlBQUE7QUFBQSxpQkFBTSxNQUFJLENBQUosUUFBQSxDQUFjO0FBQUVILFlBQUFBLFFBQVEsRUFBUkE7QUFBRixXQUFkLENBQU47QUFBbEIsU0FBQSxFQUFwQixLQUFvQixDQUFwQjtBQUpDLE9BQUEsTUFNQTtBQUNELGFBQUEsUUFBQSxDQUFjO0FBQUVBLFVBQUFBLFFBQVEsRUFBUkE7QUFBRixTQUFkO0FBQ0g7QUFDSjs7O29DQUNlUyxTLEVBQVc7QUFBQSxVQUFBLFdBQUEsR0FDSyxLQURMLEtBQUE7QUFBQSxVQUNmQyxTQURlLEdBQUEsV0FBQSxDQUFBLFNBQUE7QUFBQSxVQUNKQyxJQURJLEdBQUEsV0FBQSxDQUFBLElBQUE7QUFFdkIsVUFBTUMsWUFBWSxHQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBbEIsTUFBa0IsQ0FBbEI7O0FBQ0EsVUFBSSxDQUFBLEdBQUEsTUFBQSxDQUFBLGNBQUEsRUFBSixTQUFJLENBQUosRUFBK0I7QUFDM0IsZUFBTyxDQUFBLEdBQUEsTUFBQSxDQUFBLFlBQUEsRUFBQSxTQUFBLEVBQXdCO0FBQzNCQyxVQUFBQSxTQUFTLEVBQUUsQ0FBQSxHQUFBLFdBQUEsQ0FBQSxTQUFBLENBQUEsRUFBV0gsU0FBUyxDQUFUQSxLQUFBQSxDQUFYLFNBQUEsRUFBQSxZQUFBO0FBRGdCLFNBQXhCLENBQVA7QUFHSDs7QUFDRCxhQUFRLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxhQUFBLENBQW9CSSxTQUFBQSxDQUFwQixTQUFvQkEsQ0FBcEIsRUFBOEI7QUFBRUgsUUFBQUEsSUFBSSxFQUFOLElBQUE7QUFBY0UsUUFBQUEsU0FBUyxFQUF2QixZQUFBO0FBQXVDRSxRQUFBQSxJQUFJLEVBQUU7QUFBVTs7QUFBdkQsT0FBOUIsQ0FBUjtBQUNIOzs7NkJBQ1E7QUFBQSxVQUFBLFdBQUE7O0FBQUEsVUFBQSxZQUFBLEdBQzRHLEtBRDVHLEtBQUE7QUFBQSxVQUNHRixTQURILEdBQUEsWUFBQSxDQUFBLFNBQUE7QUFBQSxVQUNjRixJQURkLEdBQUEsWUFBQSxDQUFBLElBQUE7QUFBQSxVQUMrQkssa0JBRC9CLEdBQUEsWUFBQSxDQUFBLFNBQUE7QUFBQSxVQUNtREMsR0FEbkQsR0FBQSxZQUFBLENBQUEsR0FBQTtBQUFBLFVBQ3dEQyxnQkFEeEQsR0FBQSxZQUFBLENBQUEsZ0JBQUE7QUFBQSxVQUMwRUMsUUFEMUUsR0FBQSxZQUFBLENBQUEsUUFBQTtBQUFBLFVBQ29GQyxLQURwRixHQUFBLFlBQUEsQ0FBQSxLQUFBO0FBQUEsVUFDOEZDLFNBRDlGLEdBQUEsQ0FBQSxHQUFBLHlCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsWUFBQSxFQUFBLENBQUEsV0FBQSxFQUFBLE1BQUEsRUFBQSxXQUFBLEVBQUEsS0FBQSxFQUFBLGtCQUFBLEVBQUEsVUFBQSxFQUFBLE9BQUEsQ0FBQSxDQUFBO0FBQUEsVUFBQSxXQUFBLEdBRTBDLEtBRjFDLEtBQUE7QUFBQSxVQUVHckIsUUFGSCxHQUFBLFdBQUEsQ0FBQSxRQUFBO0FBQUEsVUFFYUUsd0JBRmIsR0FBQSxXQUFBLENBQUEsd0JBQUE7QUFHTCxVQUFNTyxTQUFTLEdBQUcsQ0FBQSxHQUFBLFVBQUEsQ0FBQSxZQUFBLEVBQUEsTUFBQSxFQUFsQixrQkFBa0IsQ0FBbEI7QUFDQSxVQUFNYSxhQUFhLEdBQUcsQ0FBQSxHQUFBLFdBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxTQUFBLEdBQUEsV0FBQSxHQUFBLEVBQUEsRUFBQSxDQUFBLEdBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxXQUFBLEVBQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxFQUFBLEtBQUEsQ0FBQSxFQUNHWCxJQUFJLEtBRFAsT0FBQSxDQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxLQUFBLENBQUEsRUFFR0EsSUFBSSxLQUZQLE9BQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxnQkFBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLFdBQUEsRUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQUEsV0FBQSxDQUFBLEVBQUEsUUFBQSxDQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsV0FBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxZQUFBLENBQUEsRUFJVSxDQUFDLENBQUQsR0FBQSxJQUpWLHdCQUFBLENBQUEsRUFBQSxXQUFBLEdBSmpCLFNBSWlCLENBQXRCLENBSkssQ0FVTDs7QUFDQSxVQUFNWSxRQUFRLEdBQUcsQ0FBQSxHQUFBLEtBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxTQUFBLEVBQWdCLENBQUEsVUFBQSxFQUFBLE9BQUEsRUFBakMsV0FBaUMsQ0FBaEIsQ0FBakI7O0FBQ0EsVUFBTUMsV0FBVyxHQUFJLE1BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxhQUFBLENBQUEsS0FBQSxFQUEyQixDQUFBLEdBQUEsU0FBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLEVBQTRCO0FBQUVYLFFBQUFBLFNBQVMsRUFBWCxhQUFBO0FBQTRCTyxRQUFBQSxLQUFLLEVBQWpDLEtBQUE7QUFBMENLLFFBQUFBLEdBQUcsRUFBRTtBQUEvQyxPQUE1QixDQUEzQixFQUNqQixLQUFBLGVBQUEsQ0FEaUIsU0FDakIsQ0FEaUIsRUFFakJSLEdBQUcsR0FBRyxNQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsYUFBQSxDQUFBLEtBQUEsRUFBMkI7QUFBRUosUUFBQUEsU0FBUyxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxPQUFBO0FBQVgsT0FBM0IsRUFBSCxHQUFHLENBQUgsR0FGUCxJQUFxQixDQUFyQjs7QUFHQSxVQUFBLFFBQUEsRUFBYztBQUFBLFlBQUEsWUFBQTs7QUFDVixZQUFJYSxnQkFBZ0IsR0FBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLEVBQXBCLGlCQUFvQixDQUFwQjs7QUFDQSxZQUFBLGdCQUFBLEVBQXNCO0FBQ2xCQSxVQUFBQSxnQkFBZ0IsSUFBQSxJQUFBLE1BQUEsQ0FBaEJBLGdCQUFnQixDQUFoQkE7QUFDSDs7QUFDRCxZQUFNQyxrQkFBa0IsR0FBRyxDQUFBLEdBQUEsV0FBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLFlBQUEsR0FBQSxFQUFBLEVBQUEsQ0FBQSxHQUFBLGdCQUFBLENBQUEsU0FBQSxDQUFBLEVBQUEsWUFBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFNBQUEsRUFBQSxZQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsRUFBQSxDQUFBLEdBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSxZQUFBLEVBQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxFQUFBLE9BQUEsQ0FBQSxFQUFBLFFBQUEsQ0FBQSxFQUEzQixZQUEyQixFQUEzQjtBQUlBLGVBQVEsTUFBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLGFBQUEsQ0FBb0JDLFFBQUFBLENBQXBCLFNBQW9CQSxDQUFwQixFQUE2QixDQUFBLEdBQUEsU0FBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxRQUFBLEVBQTRCO0FBQUVDLFVBQUFBLFNBQVMsRUFBWCxLQUFBO0FBQW9CaEIsVUFBQUEsU0FBUyxFQUE3QixnQkFBQTtBQUFpRGlCLFVBQUFBLGNBQWMsRUFBRTtBQUFqRSxTQUE1QixDQUE3QixFQUNKOUIsUUFBUSxJQURKLFdBQUEsRUFFSixNQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsYUFBQSxDQUFBLEtBQUEsRUFBMkI7QUFBRWEsVUFBQUEsU0FBUyxFQUFYLGtCQUFBO0FBQWlDWSxVQUFBQSxHQUFHLEVBQUU7QUFBdEMsU0FBM0IsRUFGSixRQUVJLENBRkksQ0FBUjtBQUdIOztBQUNELGFBQUEsV0FBQTtBQUNIOzs7RUF0RjZCMUIsTUFBQUEsQ0FBQUEsUzs7O0FBd0ZsQ0QsSUFBSSxDQUFKQSxXQUFBQSxHQUFBQSxNQUFBQTtBQUNBQSxJQUFJLENBQUpBLFlBQUFBLEdBQW9CO0FBQ2hCRSxFQUFBQSxRQUFRLEVBRFEsSUFBQTtBQUVoQlcsRUFBQUEsSUFBSSxFQUFFO0FBQVU7QUFGQTtBQUdoQk8sRUFBQUEsZ0JBQWdCLEVBQUU7QUFIRixDQUFwQnBCO0FBS0FBLElBQUksQ0FBSkEsU0FBQUEsR0FBaUI7QUFDYlcsRUFBQUEsU0FBUyxFQUFFc0IsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FERSxNQUFBO0FBRWJsQixFQUFBQSxTQUFTLEVBQUVrQixVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUZFLE1BQUE7QUFHYi9CLEVBQUFBLFFBQVEsRUFBRStCLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBSEcsSUFBQTtBQUlicEIsRUFBQUEsSUFBSSxFQUFFLFVBQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxLQUFBLENBQWdCLENBQUM7QUFBUTtBQUFULElBQXNCO0FBQVU7QUFBaEMsSUFBK0M7QUFBUTtBQUF2RCxHQUFoQixDQUpPO0FBS2JPLEVBQUFBLGdCQUFnQixFQUFFYSxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUxMLE1BQUE7QUFNYnJCLEVBQUFBLFNBQVMsRUFBRXFCLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQVVDO0FBTlIsQ0FBakJsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBjbG9uZUVsZW1lbnQsIENvbXBvbmVudCwgaXNWYWxpZEVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgb21pdCBmcm9tICdsb2Rhc2gvb21pdCc7XG5pbXBvcnQgaXNDc3NBbmltYXRpb25TdXBwb3J0ZWQgZnJvbSAnLi4vX3V0aWwvaXNDc3NBbmltYXRpb25TdXBwb3J0ZWQnO1xuaW1wb3J0IEFuaW1hdGUgZnJvbSAnLi4vYW5pbWF0ZSc7XG5pbXBvcnQgUHJvZ3Jlc3MgZnJvbSAnLi4vcHJvZ3Jlc3MvcHJvZ3Jlc3MnO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNwaW4gZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3Qgc3Bpbm5pbmcgPSBwcm9wcy5zcGlubmluZztcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHNwaW5uaW5nLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgaWYgKCFpc0Nzc0FuaW1hdGlvblN1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICAvLyBTaG93IHRleHQgaW4gSUU5XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBub3RDc3NBbmltYXRpb25TdXBwb3J0ZWQ6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGVib3VuY2VUaW1lb3V0KSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5kZWJvdW5jZVRpbWVvdXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRlbGF5VGltZW91dCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lb3V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgICBjb25zdCB7IHNwaW5uaW5nOiBjdXJyZW50U3Bpbm5pbmcgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHNwaW5uaW5nID0gbmV4dFByb3BzLnNwaW5uaW5nO1xuICAgICAgICBjb25zdCB7IGRlbGF5IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAodGhpcy5kZWJvdW5jZVRpbWVvdXQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRlYm91bmNlVGltZW91dCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnRTcGlubmluZyAmJiAhc3Bpbm5pbmcpIHtcbiAgICAgICAgICAgIHRoaXMuZGVib3VuY2VUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXRTdGF0ZSh7IHNwaW5uaW5nIH0pLCAyMDApO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGVsYXlUaW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lb3V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzcGlubmluZyAmJiBkZWxheSAmJiAhaXNOYU4oTnVtYmVyKGRlbGF5KSkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRlbGF5VGltZW91dCkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRlbGF5VGltZW91dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmRlbGF5VGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHRoaXMuc2V0U3RhdGUoeyBzcGlubmluZyB9KSwgZGVsYXkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNwaW5uaW5nIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlckluZGljYXRvcihwcmVmaXhDbHMpIHtcbiAgICAgICAgY29uc3QgeyBpbmRpY2F0b3IsIHNpemUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGRvdENsYXNzTmFtZSA9IGAke3ByZWZpeENsc30tZG90YDtcbiAgICAgICAgaWYgKGlzVmFsaWRFbGVtZW50KGluZGljYXRvcikpIHtcbiAgICAgICAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQoaW5kaWNhdG9yLCB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWVzKGluZGljYXRvci5wcm9wcy5jbGFzc05hbWUsIGRvdENsYXNzTmFtZSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoUHJvZ3Jlc3MsIHsgc2l6ZTogc2l6ZSwgY2xhc3NOYW1lOiBkb3RDbGFzc05hbWUsIHR5cGU6IFwibG9hZGluZ1wiIC8qIGxvYWRpbmcgKi8gfSkpO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY2xhc3NOYW1lLCBzaXplLCBwcmVmaXhDbHM6IGN1c3RvbWl6ZVByZWZpeENscywgdGlwLCB3cmFwcGVyQ2xhc3NOYW1lLCBjaGlsZHJlbiwgc3R5bGUsIC4uLnJlc3RQcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBzcGlubmluZywgbm90Q3NzQW5pbWF0aW9uU3VwcG9ydGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBwcmVmaXhDbHMgPSBnZXRQcmVmaXhDbHMoJ3NwaW4nLCBjdXN0b21pemVQcmVmaXhDbHMpO1xuICAgICAgICBjb25zdCBzcGluQ2xhc3NOYW1lID0gY2xhc3NOYW1lcyhwcmVmaXhDbHMsIHtcbiAgICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LXNtYF06IHNpemUgPT09IFwic21hbGxcIiAvKiBzbWFsbCAqLyxcbiAgICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LWxnYF06IHNpemUgPT09IFwibGFyZ2VcIiAvKiBsYXJnZSAqLyxcbiAgICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LXNwaW5uaW5nYF06IHNwaW5uaW5nLFxuICAgICAgICAgICAgW2Ake3ByZWZpeENsc30tc2hvdy10ZXh0YF06ICEhdGlwIHx8IG5vdENzc0FuaW1hdGlvblN1cHBvcnRlZCxcbiAgICAgICAgfSwgY2xhc3NOYW1lKTtcbiAgICAgICAgLy8gZml4IGh0dHBzOi8vZmIubWUvcmVhY3QtdW5rbm93bi1wcm9wXG4gICAgICAgIGNvbnN0IGRpdlByb3BzID0gb21pdChyZXN0UHJvcHMsIFsnc3Bpbm5pbmcnLCAnZGVsYXknLCAnaW5kaWNhdG9yJ10pO1xuICAgICAgICBjb25zdCBzcGluRWxlbWVudCA9IChSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIE9iamVjdC5hc3NpZ24oe30sIGRpdlByb3BzLCB7IGNsYXNzTmFtZTogc3BpbkNsYXNzTmFtZSwgc3R5bGU6IHN0eWxlLCBrZXk6IFwibG9hZGluZ1wiIH0pLFxuICAgICAgICAgICAgdGhpcy5yZW5kZXJJbmRpY2F0b3IocHJlZml4Q2xzKSxcbiAgICAgICAgICAgIHRpcCA/IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IGAke3ByZWZpeENsc30tdGV4dGAgfSwgdGlwKSA6IG51bGwpKTtcbiAgICAgICAgaWYgKGNoaWxkcmVuKSB7XG4gICAgICAgICAgICBsZXQgYW5pbWF0ZUNsYXNzTmFtZSA9IGAke3ByZWZpeENsc30tbmVzdGVkLWxvYWRpbmdgO1xuICAgICAgICAgICAgaWYgKHdyYXBwZXJDbGFzc05hbWUpIHtcbiAgICAgICAgICAgICAgICBhbmltYXRlQ2xhc3NOYW1lICs9IGAgJHt3cmFwcGVyQ2xhc3NOYW1lfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjb250YWluZXJDbGFzc05hbWUgPSBjbGFzc05hbWVzKHtcbiAgICAgICAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1jb250YWluZXJgXTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1ibHVyYF06IHNwaW5uaW5nLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoQW5pbWF0ZSwgT2JqZWN0LmFzc2lnbih7fSwgZGl2UHJvcHMsIHsgY29tcG9uZW50OiBcImRpdlwiLCBjbGFzc05hbWU6IGFuaW1hdGVDbGFzc05hbWUsIHRyYW5zaXRpb25OYW1lOiBcImZhZGVcIiB9KSxcbiAgICAgICAgICAgICAgICBzcGlubmluZyAmJiBzcGluRWxlbWVudCxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjb250YWluZXJDbGFzc05hbWUsIGtleTogXCJjb250YWluZXJcIiB9LCBjaGlsZHJlbikpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3BpbkVsZW1lbnQ7XG4gICAgfVxufVxuU3Bpbi5kaXNwbGF5TmFtZSA9ICdTcGluJztcblNwaW4uZGVmYXVsdFByb3BzID0ge1xuICAgIHNwaW5uaW5nOiB0cnVlLFxuICAgIHNpemU6IFwiZGVmYXVsdFwiIC8qIGRlZmF1bHQgKi8sXG4gICAgd3JhcHBlckNsYXNzTmFtZTogJycsXG59O1xuU3Bpbi5wcm9wVHlwZXMgPSB7XG4gICAgcHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBzcGlubmluZzogUHJvcFR5cGVzLmJvb2wsXG4gICAgc2l6ZTogUHJvcFR5cGVzLm9uZU9mKFtcInNtYWxsXCIgLyogc21hbGwgKi8sIFwiZGVmYXVsdFwiIC8qIGRlZmF1bHQgKi8sIFwibGFyZ2VcIiAvKiBsYXJnZSAqL10pLFxuICAgIHdyYXBwZXJDbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgaW5kaWNhdG9yOiBQcm9wVHlwZXMubm9kZSxcbn07XG4iXX0=