35ba6d6b743f2952fcae767c43a5eb40
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _getOffset = _interopRequireDefault(require("../utils/getOffset"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var SuggestionPortal =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(SuggestionPortal, _Component);

  var _super = _createSuper(SuggestionPortal);

  function SuggestionPortal() {
    var _this;

    (0, _classCallCheck2["default"])(this, SuggestionPortal);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "matchDecorates", function (props) {
      var callbacks = props.callbacks,
          suggestionRegex = props.suggestionRegex,
          decoratedText = props.decoratedText;
      var matches = suggestionRegex.exec(decoratedText);
      _this.trigger = matches[2];

      _this.updatePortalPosition(_this.props);

      callbacks.setEditorState(callbacks.getEditorState());
    });
    return _this;
  }

  (0, _createClass2["default"])(SuggestionPortal, [{
    key: "componentWillMount",
    value: function componentWillMount() {
      this.matchDecorates(this.props);
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (nextProps.decoratedText !== this.props.decoratedText) {
        this.matchDecorates(nextProps);
      }

      this.updatePortalPosition(nextProps);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      var _this$props = this.props,
          offsetKey = _this$props.offsetKey,
          mentionStore = _this$props.mentionStore;
      mentionStore.inActiveSuggestion({
        offsetKey: offsetKey
      });
    }
  }, {
    key: "updatePortalPosition",
    value: function updatePortalPosition(props) {
      var _this2 = this;

      var offsetKey = props.offsetKey,
          mentionStore = props.mentionStore;
      mentionStore.updateSuggestion({
        offsetKey: offsetKey,
        trigger: this.trigger,
        position: function position() {
          var element = _this2.searchPortal;
          var rect = (0, _getOffset["default"])(element);
          return {
            left: rect.left,
            top: rect.top,
            width: element.offsetWidth,
            height: element.offsetHeight
          };
        }
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;

      return _react["default"].createElement("span", {
        ref: function ref(node) {
          _this3.searchPortal = node;
        },
        style: this.props.style
      }, this.props.children);
    }
  }]);
  return SuggestionPortal;
}(_react.Component);

exports["default"] = SuggestionPortal;
(0, _defineProperty2["default"])(SuggestionPortal, "propTypes", {
  offsetKey: _propTypes["default"].any,
  mentionStore: _propTypes["default"].object,
  decoratedText: _propTypes["default"].string,
  children: _propTypes["default"].any,
  callbacks: _propTypes["default"].any,
  suggestionRegex: _propTypes["default"].any
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN1Z2dlc3Rpb25Qb3J0YWwucmVhY3QuanN4Il0sIm5hbWVzIjpbIlN1Z2dlc3Rpb25Qb3J0YWwiLCJwcm9wcyIsImNhbGxiYWNrcyIsInN1Z2dlc3Rpb25SZWdleCIsImRlY29yYXRlZFRleHQiLCJtYXRjaGVzIiwiZXhlYyIsInRyaWdnZXIiLCJ1cGRhdGVQb3J0YWxQb3NpdGlvbiIsInNldEVkaXRvclN0YXRlIiwiZ2V0RWRpdG9yU3RhdGUiLCJtYXRjaERlY29yYXRlcyIsIm5leHRQcm9wcyIsIm9mZnNldEtleSIsIm1lbnRpb25TdG9yZSIsImluQWN0aXZlU3VnZ2VzdGlvbiIsInVwZGF0ZVN1Z2dlc3Rpb24iLCJwb3NpdGlvbiIsImVsZW1lbnQiLCJzZWFyY2hQb3J0YWwiLCJyZWN0IiwibGVmdCIsInRvcCIsIndpZHRoIiwib2Zmc2V0V2lkdGgiLCJoZWlnaHQiLCJvZmZzZXRIZWlnaHQiLCJub2RlIiwic3R5bGUiLCJjaGlsZHJlbiIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImFueSIsIm9iamVjdCIsInN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBRXFCQSxnQjs7Ozs7Ozs7Ozs7Ozs7Ozs7dUdBcUJGLFVBQUNDLEtBQUQsRUFBVztBQUFBLFVBQ2xCQyxTQURrQixHQUM0QkQsS0FENUIsQ0FDbEJDLFNBRGtCO0FBQUEsVUFDUEMsZUFETyxHQUM0QkYsS0FENUIsQ0FDUEUsZUFETztBQUFBLFVBQ1VDLGFBRFYsR0FDNEJILEtBRDVCLENBQ1VHLGFBRFY7QUFFMUIsVUFBTUMsT0FBTyxHQUFHRixlQUFlLENBQUNHLElBQWhCLENBQXFCRixhQUFyQixDQUFoQjtBQUNBLFlBQUtHLE9BQUwsR0FBZUYsT0FBTyxDQUFDLENBQUQsQ0FBdEI7O0FBQ0EsWUFBS0csb0JBQUwsQ0FBMEIsTUFBS1AsS0FBL0I7O0FBQ0FDLE1BQUFBLFNBQVMsQ0FBQ08sY0FBVixDQUF5QlAsU0FBUyxDQUFDUSxjQUFWLEVBQXpCO0FBQ0QsSzs7Ozs7O3lDQWpCb0I7QUFDbkIsV0FBS0MsY0FBTCxDQUFvQixLQUFLVixLQUF6QjtBQUNEOzs7OENBRXlCVyxTLEVBQVc7QUFDbkMsVUFBSUEsU0FBUyxDQUFDUixhQUFWLEtBQTRCLEtBQUtILEtBQUwsQ0FBV0csYUFBM0MsRUFBMEQ7QUFDeEQsYUFBS08sY0FBTCxDQUFvQkMsU0FBcEI7QUFDRDs7QUFDRCxXQUFLSixvQkFBTCxDQUEwQkksU0FBMUI7QUFDRDs7OzJDQVVzQjtBQUFBLHdCQUNlLEtBQUtYLEtBRHBCO0FBQUEsVUFDYlksU0FEYSxlQUNiQSxTQURhO0FBQUEsVUFDRkMsWUFERSxlQUNGQSxZQURFO0FBRXJCQSxNQUFBQSxZQUFZLENBQUNDLGtCQUFiLENBQWdDO0FBQUVGLFFBQUFBLFNBQVMsRUFBVEE7QUFBRixPQUFoQztBQUNEOzs7eUNBRW9CWixLLEVBQU87QUFBQTs7QUFBQSxVQUNsQlksU0FEa0IsR0FDVVosS0FEVixDQUNsQlksU0FEa0I7QUFBQSxVQUNQQyxZQURPLEdBQ1ViLEtBRFYsQ0FDUGEsWUFETztBQUUxQkEsTUFBQUEsWUFBWSxDQUFDRSxnQkFBYixDQUE4QjtBQUM1QkgsUUFBQUEsU0FBUyxFQUFUQSxTQUQ0QjtBQUU1Qk4sUUFBQUEsT0FBTyxFQUFFLEtBQUtBLE9BRmM7QUFHNUJVLFFBQUFBLFFBQVEsRUFBRSxvQkFBTTtBQUNkLGNBQU1DLE9BQU8sR0FBRyxNQUFJLENBQUNDLFlBQXJCO0FBQ0EsY0FBTUMsSUFBSSxHQUFHLDJCQUFVRixPQUFWLENBQWI7QUFDQSxpQkFBTztBQUNMRyxZQUFBQSxJQUFJLEVBQUVELElBQUksQ0FBQ0MsSUFETjtBQUVMQyxZQUFBQSxHQUFHLEVBQUVGLElBQUksQ0FBQ0UsR0FGTDtBQUdMQyxZQUFBQSxLQUFLLEVBQUVMLE9BQU8sQ0FBQ00sV0FIVjtBQUlMQyxZQUFBQSxNQUFNLEVBQUVQLE9BQU8sQ0FBQ1E7QUFKWCxXQUFQO0FBTUQ7QUFaMkIsT0FBOUI7QUFjRDs7OzZCQUVRO0FBQUE7O0FBQ1AsYUFDRTtBQUFNLFFBQUEsR0FBRyxFQUFFLGFBQUNDLElBQUQsRUFBVTtBQUNuQixVQUFBLE1BQUksQ0FBQ1IsWUFBTCxHQUFvQlEsSUFBcEI7QUFDRCxTQUZEO0FBRUcsUUFBQSxLQUFLLEVBQUUsS0FBSzFCLEtBQUwsQ0FBVzJCO0FBRnJCLFNBR0csS0FBSzNCLEtBQUwsQ0FBVzRCLFFBSGQsQ0FERjtBQU9EOzs7RUE1RDJDQyxnQjs7O2lDQUF6QjlCLGdCLGVBQ0E7QUFDakJhLEVBQUFBLFNBQVMsRUFBRWtCLHNCQUFVQyxHQURKO0FBRWpCbEIsRUFBQUEsWUFBWSxFQUFFaUIsc0JBQVVFLE1BRlA7QUFHakI3QixFQUFBQSxhQUFhLEVBQUUyQixzQkFBVUcsTUFIUjtBQUlqQkwsRUFBQUEsUUFBUSxFQUFFRSxzQkFBVUMsR0FKSDtBQUtqQjlCLEVBQUFBLFNBQVMsRUFBRTZCLHNCQUFVQyxHQUxKO0FBTWpCN0IsRUFBQUEsZUFBZSxFQUFFNEIsc0JBQVVDO0FBTlYsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGdldE9mZnNldCBmcm9tICcuLi91dGlscy9nZXRPZmZzZXQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdWdnZXN0aW9uUG9ydGFsIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBvZmZzZXRLZXk6IFByb3BUeXBlcy5hbnksXG4gICAgbWVudGlvblN0b3JlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRlY29yYXRlZFRleHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gICAgY2FsbGJhY2tzOiBQcm9wVHlwZXMuYW55LFxuICAgIHN1Z2dlc3Rpb25SZWdleDogUHJvcFR5cGVzLmFueSxcbiAgfTtcblxuICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgdGhpcy5tYXRjaERlY29yYXRlcyh0aGlzLnByb3BzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKG5leHRQcm9wcy5kZWNvcmF0ZWRUZXh0ICE9PSB0aGlzLnByb3BzLmRlY29yYXRlZFRleHQpIHtcbiAgICAgIHRoaXMubWF0Y2hEZWNvcmF0ZXMobmV4dFByb3BzKTtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVQb3J0YWxQb3NpdGlvbihuZXh0UHJvcHMpO1xuICB9XG5cbiAgbWF0Y2hEZWNvcmF0ZXMgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IGNhbGxiYWNrcywgc3VnZ2VzdGlvblJlZ2V4LCBkZWNvcmF0ZWRUZXh0IH0gPSBwcm9wcztcbiAgICBjb25zdCBtYXRjaGVzID0gc3VnZ2VzdGlvblJlZ2V4LmV4ZWMoZGVjb3JhdGVkVGV4dCk7XG4gICAgdGhpcy50cmlnZ2VyID0gbWF0Y2hlc1syXTtcbiAgICB0aGlzLnVwZGF0ZVBvcnRhbFBvc2l0aW9uKHRoaXMucHJvcHMpO1xuICAgIGNhbGxiYWNrcy5zZXRFZGl0b3JTdGF0ZShjYWxsYmFja3MuZ2V0RWRpdG9yU3RhdGUoKSk7XG4gIH07XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgY29uc3QgeyBvZmZzZXRLZXksIG1lbnRpb25TdG9yZSB9ID0gdGhpcy5wcm9wcztcbiAgICBtZW50aW9uU3RvcmUuaW5BY3RpdmVTdWdnZXN0aW9uKHsgb2Zmc2V0S2V5IH0pO1xuICB9XG5cbiAgdXBkYXRlUG9ydGFsUG9zaXRpb24ocHJvcHMpIHtcbiAgICBjb25zdCB7IG9mZnNldEtleSwgbWVudGlvblN0b3JlIH0gPSBwcm9wcztcbiAgICBtZW50aW9uU3RvcmUudXBkYXRlU3VnZ2VzdGlvbih7XG4gICAgICBvZmZzZXRLZXksXG4gICAgICB0cmlnZ2VyOiB0aGlzLnRyaWdnZXIsXG4gICAgICBwb3NpdGlvbjogKCkgPT4ge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5zZWFyY2hQb3J0YWw7XG4gICAgICAgIGNvbnN0IHJlY3QgPSBnZXRPZmZzZXQoZWxlbWVudCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbGVmdDogcmVjdC5sZWZ0LFxuICAgICAgICAgIHRvcDogcmVjdC50b3AsXG4gICAgICAgICAgd2lkdGg6IGVsZW1lbnQub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBlbGVtZW50Lm9mZnNldEhlaWdodCxcbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxzcGFuIHJlZj17KG5vZGUpID0+IHtcbiAgICAgICAgdGhpcy5zZWFyY2hQb3J0YWwgPSBub2RlO1xuICAgICAgfX0gc3R5bGU9e3RoaXMucHJvcHMuc3R5bGV9PlxuICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgIDwvc3Bhbj5cbiAgICApO1xuICB9XG59XG4iXX0=