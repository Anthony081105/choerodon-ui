37391eee87dfeaf15f1b80eeb9436caa
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.destroyFns = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _tslib = require("tslib");

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _omit = _interopRequireDefault(require("lodash/omit"));

var _defer = _interopRequireDefault(require("lodash/defer"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _classnames = _interopRequireDefault(require("classnames"));

var _componentClasses = _interopRequireDefault(require("component-classes"));

var _UnitConvertor = require("choerodon-ui/lib/_util/UnitConvertor");

var _KeyCode = _interopRequireDefault(require("choerodon-ui/lib/_util/KeyCode"));

var _configure = require("choerodon-ui/lib/configure");

var _ViewComponent2 = _interopRequireDefault(require("../core/ViewComponent"));

var _icon = _interopRequireDefault(require("../icon"));

var _autobind = _interopRequireDefault(require("../_util/autobind"));

var _Button = _interopRequireDefault(require("../button/Button"));

var _EventManager = _interopRequireDefault(require("../_util/EventManager"));

var _isEmpty = _interopRequireDefault(require("../_util/isEmpty"));

var _AsyncComponent = _interopRequireDefault(require("../_util/AsyncComponent"));

var _message = _interopRequireDefault(require("../message"));

var _exception = _interopRequireDefault(require("../_util/exception"));

var _localeContext = require("../locale-context");

var _DataSetRequestError = _interopRequireDefault(require("../data-set/DataSetRequestError"));

var _utils = require("./utils");

var destroyFns = [];
exports.destroyFns = destroyFns;

var Modal =
/*#__PURE__*/
function (_ViewComponent) {
  (0, _inherits2["default"])(Modal, _ViewComponent);

  function Modal() {
    var _this;

    (0, _classCallCheck2["default"])(this, Modal);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Modal).apply(this, arguments));
    _this.moveEvent = new _EventManager["default"](typeof window === 'undefined' ? undefined : document);
    _this.okCancelEvent = new _EventManager["default"]();

    _this.saveCancelRef = function (node) {
      return _this.cancelButton = node;
    };

    _this.handleKeyDown = function (e) {
      var _assertThisInitialize = (0, _assertThisInitialized2["default"])(_this),
          cancelButton = _assertThisInitialize.cancelButton;

      if (cancelButton && !cancelButton.isDisabled() && e.keyCode === _KeyCode["default"].ESC) {
        cancelButton.handleClickWait(e);
      }
    };

    _this.registerOk = function (ok) {
      _this.okCancelEvent.removeEventListener('ok');

      _this.okCancelEvent.addEventListener('ok', ok);
    };

    _this.registerCancel = function (cancel) {
      _this.okCancelEvent.removeEventListener('cancel');

      _this.okCancelEvent.addEventListener('cancel', cancel);
    };

    _this.getDefaultFooter = function (okBtn, cancelBtn) {
      var _this$props = _this.props,
          okCancel = _this$props.okCancel,
          _this$props$okFirst = _this$props.okFirst,
          okFirst = _this$props$okFirst === void 0 ? (0, _configure.getConfig)('modalOkFirst') : _this$props$okFirst,
          drawer = _this$props.drawer;
      var buttons = [okBtn];

      if (okCancel) {
        if (okFirst || drawer) {
          buttons.push(cancelBtn);
        } else {
          buttons.unshift(cancelBtn);
        }
      }

      return _react["default"].createElement("div", null, buttons);
    };

    return _this;
  }

  (0, _createClass2["default"])(Modal, [{
    key: "getOtherProps",
    value: function getOtherProps() {
      var otherProps = (0, _omit["default"])((0, _get2["default"])((0, _getPrototypeOf2["default"])(Modal.prototype), "getOtherProps", this).call(this), ['closable', 'movable', 'maskClosable', 'maskStyle', 'mask', 'maskClassName', 'keyboardClosable', 'fullScreen', 'title', 'footer', 'close', 'update', 'okText', 'cancelText', 'okCancel', 'onClose', 'onOk', 'onCancel', 'destroyOnClose', 'drawer', 'afterClose', 'okProps', 'cancelProps', 'border', 'okFirst', 'drawerTransitionName']);

      if (this.props.keyboardClosable) {
        otherProps.autoFocus = true;
        otherProps.tabIndex = -1;
        otherProps.onKeyDown = this.handleKeyDown;
      }

      return otherProps;
    }
  }, {
    key: "getClassName",
    value: function getClassName() {
      var _get$call;

      var prefixCls = this.prefixCls,
          _this$props2 = this.props,
          _this$props2$style = _this$props2.style,
          style = _this$props2$style === void 0 ? {} : _this$props2$style,
          fullScreen = _this$props2.fullScreen,
          drawer = _this$props2.drawer,
          _this$props2$border = _this$props2.border,
          border = _this$props2$border === void 0 ? (0, _configure.getConfig)('modalSectionBorder') : _this$props2$border;
      return (0, _get2["default"])((0, _getPrototypeOf2["default"])(Modal.prototype), "getClassName", this).call(this, (_get$call = {}, (0, _defineProperty2["default"])(_get$call, "".concat(prefixCls, "-center"), !drawer && !('left' in style || 'right' in style) && !this.offset), (0, _defineProperty2["default"])(_get$call, "".concat(prefixCls, "-fullscreen"), fullScreen), (0, _defineProperty2["default"])(_get$call, "".concat(prefixCls, "-drawer"), drawer), (0, _defineProperty2["default"])(_get$call, "".concat(prefixCls, "-border"), border), _get$call));
    }
  }, {
    key: "render",
    value: function render() {
      var prefixCls = this.prefixCls;
      var header = this.getHeader();
      var body = this.getBody();
      var footer = this.getFooter();
      return _react["default"].createElement("div", (0, _extends2["default"])({}, this.getMergedProps()), _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-content")
      }, header, body, footer));
    }
  }, {
    key: "componentWillUpdate",
    value: function componentWillUpdate(_ref) {
      var _this2 = this;

      var hidden = _ref.hidden;

      if (hidden === false && hidden !== this.props.hidden) {
        (0, _defer["default"])(function () {
          return _this2.focus();
        });
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.moveEvent.clear();
      this.okCancelEvent.clear();
    }
  }, {
    key: "handleHeaderMouseDown",
    value: function handleHeaderMouseDown(downEvent) {
      var _this3 = this;

      var element = this.element;

      if (element) {
        var prefixCls = this.prefixCls;
        var clientX = downEvent.clientX,
            clientY = downEvent.clientY;
        var offsetLeft = element.offsetLeft,
            offsetTop = element.offsetTop;
        this.moveEvent.addEventListener('mousemove', function (moveEvent) {
          var moveX = moveEvent.clientX,
              moveY = moveEvent.clientY;
          (0, _componentClasses["default"])(element).remove("".concat(prefixCls, "-center"));
          var left = (0, _UnitConvertor.pxToRem)(Math.max(offsetLeft + moveX - clientX, 0));
          var top = (0, _UnitConvertor.pxToRem)(Math.max(offsetTop + moveY - clientY, 0));
          _this3.offset = [left, top];
          (0, _extends2["default"])(element.style, {
            left: left,
            top: top
          });
        }).addEventListener('mouseup', function () {
          _this3.moveEvent.clear();
        });
      }
    }
  }, {
    key: "handleOk",
    value: function () {
      var _handleOk = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee() {
        var _this$props$onOk, onOk, promise, _ref2, _ref3, ret1, ret2;

        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _this$props$onOk = this.props.onOk, onOk = _this$props$onOk === void 0 ? _noop["default"] : _this$props$onOk;
                promise = Promise.all([onOk(), this.okCancelEvent.fireEvent('ok')]);
                _context.prev = 2;
                _context.next = 5;
                return promise;

              case 5:
                _ref2 = _context.sent;
                _ref3 = (0, _slicedToArray2["default"])(_ref2, 2);
                ret1 = _ref3[0];
                ret2 = _ref3[1];

                if (ret1 !== false && ret2) {
                  this.close();
                }

                _context.next = 16;
                break;

              case 12:
                _context.prev = 12;
                _context.t0 = _context["catch"](2);

                if (!(_context.t0 instanceof _DataSetRequestError["default"])) {
                  _message["default"].error((0, _exception["default"])(_context.t0));
                }

                throw _context.t0;

              case 16:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[2, 12]]);
      }));

      function handleOk() {
        return _handleOk.apply(this, arguments);
      }

      return handleOk;
    }()
  }, {
    key: "handleCancel",
    value: function () {
      var _handleCancel = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee2() {
        var _this$props$onCancel, onCancel, promise, _ref4, _ref5, ret1, ret2;

        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _this$props$onCancel = this.props.onCancel, onCancel = _this$props$onCancel === void 0 ? _noop["default"] : _this$props$onCancel;
                promise = Promise.all([onCancel(), this.okCancelEvent.fireEvent('cancel')]);
                _context2.prev = 2;
                _context2.next = 5;
                return promise;

              case 5:
                _ref4 = _context2.sent;
                _ref5 = (0, _slicedToArray2["default"])(_ref4, 2);
                ret1 = _ref5[0];
                ret2 = _ref5[1];

                if (ret1 !== false && ret2) {
                  this.close();
                }

                _context2.next = 16;
                break;

              case 12:
                _context2.prev = 12;
                _context2.t0 = _context2["catch"](2);

                if (!(_context2.t0 instanceof _DataSetRequestError["default"])) {
                  _message["default"].error((0, _exception["default"])(_context2.t0));
                }

                throw _context2.t0;

              case 16:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this, [[2, 12]]);
      }));

      function handleCancel() {
        return _handleCancel.apply(this, arguments);
      }

      return handleCancel;
    }()
  }, {
    key: "getTitle",
    value: function getTitle() {
      var title = this.props.title,
          prefixCls = this.prefixCls;

      if (title) {
        return _react["default"].createElement("div", {
          className: "".concat(prefixCls, "-title")
        }, title);
      }
    }
  }, {
    key: "getHeader",
    value: function getHeader() {
      var prefixCls = this.prefixCls,
          _this$props3 = this.props,
          closable = _this$props3.closable,
          movable = _this$props3.movable,
          fullScreen = _this$props3.fullScreen,
          drawer = _this$props3.drawer;
      var title = this.getTitle();
      var buttons = this.getHeaderButtons();

      if (title || closable || movable) {
        var headerProps = {
          className: (0, _classnames["default"])("".concat(prefixCls, "-header"), (0, _defineProperty2["default"])({}, "".concat(prefixCls, "-movable"), movable && !fullScreen && !drawer))
        };

        if (movable && !fullScreen && !drawer) {
          headerProps.onMouseDown = this.handleHeaderMouseDown;
        }

        return _react["default"].createElement("div", (0, _extends2["default"])({}, headerProps), title, buttons);
      }
    }
  }, {
    key: "getHeaderButtons",
    value: function getHeaderButtons() {
      var prefixCls = this.prefixCls;
      var closeButton = this.getCloseButton();

      if (closeButton) {
        return _react["default"].createElement("div", {
          className: "".concat(prefixCls, "-header-buttons")
        }, closeButton);
      }
    }
  }, {
    key: "getCloseButton",
    value: function getCloseButton() {
      var prefixCls = this.prefixCls,
          closable = this.props.closable;

      if (closable) {
        return _react["default"].createElement("button", {
          type: "button",
          className: "".concat(prefixCls, "-header-button"),
          onClick: this.close
        }, _react["default"].createElement(_icon["default"], {
          type: "close"
        }));
      }
    }
  }, {
    key: "renderChildren",
    value: function renderChildren(children) {
      if (children) {
        var prefixCls = this.prefixCls,
            props = this.props;
        var _props$close = props.close,
            close = _props$close === void 0 ? _noop["default"] : _props$close,
            _props$update = props.update,
            update = _props$update === void 0 ? _noop["default"] : _props$update;
        var modal = {
          close: close,
          update: update,
          props: props,
          handleOk: this.registerOk,
          handleCancel: this.registerCancel
        };
        return _react["default"].createElement("div", {
          className: "".concat(prefixCls, "-body")
        }, (0, _react.isValidElement)(children) ? (0, _react.cloneElement)(children, {
          modal: modal
        }) : children);
      }
    }
  }, {
    key: "getBody",
    value: function getBody() {
      var children = this.props.children;
      return this.renderChildren(typeof children === 'function' ? (0, _AsyncComponent["default"])(children) : children);
    }
  }, {
    key: "getFooter",
    value: function getFooter() {
      var _this$props4 = this.props,
          okProps = _this$props4.okProps,
          cancelProps = _this$props4.cancelProps,
          drawer = _this$props4.drawer,
          _this$props4$okText = _this$props4.okText,
          okText = _this$props4$okText === void 0 ? (0, _localeContext.$l)('Modal', 'ok') : _this$props4$okText,
          _this$props4$cancelTe = _this$props4.cancelText,
          cancelText = _this$props4$cancelTe === void 0 ? (0, _localeContext.$l)('Modal', 'cancel') : _this$props4$cancelTe,
          _this$props4$footer = _this$props4.footer,
          footer = _this$props4$footer === void 0 ? this.getDefaultFooter : _this$props4$footer;
      var funcType = drawer ? "raised"
      /* raised */
      : (0, _configure.getConfig)('buttonFuncType');

      var okBtn = _react["default"].createElement(_Button["default"], (0, _extends2["default"])({
        key: "ok",
        funcType: funcType,
        color: "primary"
        /* primary */
        ,
        onClick: this.handleOk
      }, okProps), okText);

      var cancelBtn = _react["default"].createElement(_Button["default"], (0, _extends2["default"])({
        key: "cancel",
        ref: this.saveCancelRef,
        funcType: funcType,
        onClick: this.handleCancel
      }, cancelProps), cancelText);

      if (typeof footer === 'function') {
        return this.getWrappedFooter(footer(okBtn, cancelBtn));
      }

      if (!(0, _isEmpty["default"])(footer, true)) {
        return this.getWrappedFooter(footer);
      }
    }
  }, {
    key: "getWrappedFooter",
    value: function getWrappedFooter(footer) {
      var prefixCls = this.prefixCls;
      var drawer = this.props.drawer;
      var className = (0, _classnames["default"])("".concat(prefixCls, "-footer"), (0, _defineProperty2["default"])({}, "".concat(prefixCls, "-footer-drawer"), !!drawer));
      return _react["default"].createElement("div", {
        className: className
      }, footer);
    }
  }, {
    key: "close",
    value: function close() {
      var _this$props$close = this.props.close,
          close = _this$props$close === void 0 ? _noop["default"] : _this$props$close;
      close();
    }
  }]);
  return Modal;
}(_ViewComponent2["default"]);

exports["default"] = Modal;
Modal.displayName = 'Modal';
Modal.propTypes = (0, _objectSpread2["default"])({}, _ViewComponent2["default"].propTypes, {
  closable: _propTypes["default"].bool,
  movable: _propTypes["default"].bool,
  fullScreen: _propTypes["default"].bool,
  maskClosable: _propTypes["default"].bool,
  maskStyle: _propTypes["default"].object,
  mask: _propTypes["default"].bool,
  maskClassName: _propTypes["default"].string,
  keyboardClosable: _propTypes["default"].bool,
  footer: _propTypes["default"].oneOfType([_propTypes["default"].func, _propTypes["default"].node, _propTypes["default"].bool]),
  destroyOnClose: _propTypes["default"].bool,
  okText: _propTypes["default"].node,
  cancelText: _propTypes["default"].node,
  okProps: _propTypes["default"].object,
  cancelProps: _propTypes["default"].object,
  onClose: _propTypes["default"].func,
  onOk: _propTypes["default"].func,
  onCancel: _propTypes["default"].func,
  afterClose: _propTypes["default"].func,
  okCancel: _propTypes["default"].bool,
  drawer: _propTypes["default"].bool,
  // title: PropTypes.node,
  // 此处原本允许title传入node，但是类型为PropTypes.node时无法正确继承ViewComponent
  // 父类中的title指的是HTML元素的title属性，此处title指modal标题，产生歧义，暂时设置为string
  // TODO: 添加modalTitle属性替代此处的title
  title: _propTypes["default"].string,
  okFirst: _propTypes["default"].bool
});
Modal.defaultProps = {
  suffixCls: _utils.suffixCls,
  closable: false,
  movable: true,
  maskClosable: false,
  mask: true,
  keyboardClosable: true,
  okCancel: true,
  destroyOnClose: true,
  fullScreen: false,
  drawer: false,
  autoFocus: true
};
(0, _tslib.__decorate)([_autobind["default"]], Modal.prototype, "handleHeaderMouseDown", null);
(0, _tslib.__decorate)([_autobind["default"]], Modal.prototype, "handleOk", null);
(0, _tslib.__decorate)([_autobind["default"]], Modal.prototype, "handleCancel", null);
(0, _tslib.__decorate)([_autobind["default"]], Modal.prototype, "close", null);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby9tb2RhbC9Nb2RhbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRU8sSUFBTSxVQUFVLEdBQXNCLEVBQXRDOzs7SUErQmMsSzs7Ozs7QUFBckIsbUJBQUE7QUFBQTs7QUFBQTs7QUErREUsVUFBQSxTQUFBLEdBQTBCLElBQUksd0JBQUosQ0FBaUIsT0FBTyxNQUFQLEtBQWtCLFdBQWxCLEdBQWdDLFNBQWhDLEdBQTRDLFFBQTdELENBQTFCO0FBRUEsVUFBQSxhQUFBLEdBQThCLElBQUksd0JBQUosRUFBOUI7O0FBTUEsVUFBQSxhQUFBLEdBQWdCLFVBQUEsSUFBSTtBQUFBLGFBQUssTUFBSyxZQUFMLEdBQW9CLElBQXpCO0FBQUEsS0FBcEI7O0FBRUEsVUFBQSxhQUFBLEdBQWdCLFVBQUEsQ0FBQyxFQUFHO0FBQUE7QUFBQSxVQUNWLFlBRFUseUJBQ1YsWUFEVTs7QUFFbEIsVUFBSSxZQUFZLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBYixFQUFqQixJQUE4QyxDQUFDLENBQUMsT0FBRixLQUFjLG9CQUFRLEdBQXhFLEVBQTZFO0FBQzNFLFFBQUEsWUFBWSxDQUFDLGVBQWIsQ0FBNkIsQ0FBN0I7QUFDRDtBQUNGLEtBTEQ7O0FBME1BLFVBQUEsVUFBQSxHQUFhLFVBQUEsRUFBRSxFQUFHO0FBQ2hCLFlBQUssYUFBTCxDQUFtQixtQkFBbkIsQ0FBdUMsSUFBdkM7O0FBQ0EsWUFBSyxhQUFMLENBQW1CLGdCQUFuQixDQUFvQyxJQUFwQyxFQUEw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LEVBQUEsWUFBWSxFQUFFLEtBSk07QUFLcEIsRUFBQSxJQUFJLEVBQUUsSUFMYztBQU1wQixFQUFBLGdCQUFnQixFQUFFLElBTkU7QUFPcEIsRUFBQSxRQUFRLEVBQUUsSUFQVTtBQVFwQixFQUFBLGNBQWMsRUFBRSxJQVJJO0FBU3BCLEVBQUEsVUFBVSxFQUFFLEtBVFE7QUFVcEIsRUFBQSxNQUFNLEVBQUUsS0FWWTtBQVdwQixFQUFBLFNBQVMsRUFBRTtBQVhTLENBQWY7QUErSFAsdUJBQUEsQ0FEQyxvQkFDRCxDQUFBLEUsZUFBQSxFLHVCQUFBLEVBc0JDLElBdEJEO0FBeUJBLHVCQUFBLENBREMsb0JBQ0QsQ0FBQSxFLGVBQUEsRSxVQUFBLEVBY0MsSUFkRDtBQWlCQSx1QkFBQSxDQURDLG9CQUNELENBQUEsRSxlQUFBLEUsY0FBQSxFQWNDLElBZEQ7QUFxTEEsdUJBQUEsQ0FEQyxvQkFDRCxDQUFBLEUsZUFBQSxFLE9BQUEsRUFHQyxJQUhEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IGNsb25lRWxlbWVudCwgaXNWYWxpZEVsZW1lbnQsIEtleSwgUmVhY3ROb2RlLCBDU1NQcm9wZXJ0aWVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBvbWl0IGZyb20gJ2xvZGFzaC9vbWl0JztcbmltcG9ydCBkZWZlciBmcm9tICdsb2Rhc2gvZGVmZXInO1xuaW1wb3J0IG5vb3AgZnJvbSAnbG9kYXNoL25vb3AnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgY2xhc3NlcyBmcm9tICdjb21wb25lbnQtY2xhc3Nlcyc7XG5pbXBvcnQgeyBweFRvUmVtIH0gZnJvbSAnY2hvZXJvZG9uLXVpL2xpYi9fdXRpbC9Vbml0Q29udmVydG9yJztcbmltcG9ydCBLZXlDb2RlIGZyb20gJ2Nob2Vyb2Rvbi11aS9saWIvX3V0aWwvS2V5Q29kZSc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICdjaG9lcm9kb24tdWkvbGliL2NvbmZpZ3VyZSc7XG5pbXBvcnQgVmlld0NvbXBvbmVudCwgeyBWaWV3Q29tcG9uZW50UHJvcHMgfSBmcm9tICcuLi9jb3JlL1ZpZXdDb21wb25lbnQnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnLi4vX3V0aWwvYXV0b2JpbmQnO1xuaW1wb3J0IEJ1dHRvbiwgeyBCdXR0b25Qcm9wcyB9IGZyb20gJy4uL2J1dHRvbi9CdXR0b24nO1xuaW1wb3J0IEV2ZW50TWFuYWdlciBmcm9tICcuLi9fdXRpbC9FdmVudE1hbmFnZXInO1xuaW1wb3J0IGlzRW1wdHkgZnJvbSAnLi4vX3V0aWwvaXNFbXB0eSc7XG5pbXBvcnQgeyBCdXR0b25Db2xvciwgRnVuY1R5cGUgfSBmcm9tICcuLi9idXR0b24vZW51bSc7XG5pbXBvcnQgYXN5bmNDb21wb25lbnQsIHsgQXN5bmNDbXBMb2FkaW5nRnVuY3Rpb24gfSBmcm9tICcuLi9fdXRpbC9Bc3luY0NvbXBvbmVudCc7XG5pbXBvcnQgbWVzc2FnZSBmcm9tICcuLi9tZXNzYWdlJztcbmltcG9ydCBleGNlcHRpb24gZnJvbSAnLi4vX3V0aWwvZXhjZXB0aW9uJztcbmltcG9ydCB7ICRsIH0gZnJvbSAnLi4vbG9jYWxlLWNvbnRleHQnO1xuaW1wb3J0IERhdGFTZXRSZXF1ZXN0RXJyb3IgZnJvbSAnLi4vZGF0YS1zZXQvRGF0YVNldFJlcXVlc3RFcnJvcic7XG5pbXBvcnQgeyBzdWZmaXhDbHMgfSBmcm9tICcuL3V0aWxzJztcblxuZXhwb3J0IGNvbnN0IGRlc3Ryb3lGbnM6IEFycmF5PCgpID0+IHZvaWQ+ID0gW107XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kYWxQcm9wcyBleHRlbmRzIFZpZXdDb21wb25lbnRQcm9wcyB7XG4gIGNsb3NhYmxlPzogYm9vbGVhbjtcbiAgbW92YWJsZT86IGJvb2xlYW47XG4gIGZ1bGxTY3JlZW4/OiBib29sZWFuO1xuICBtYXNrQ2xvc2FibGU/OiBib29sZWFuO1xuICBtYXNrU3R5bGU/OiBDU1NQcm9wZXJ0aWVzO1xuICBtYXNrPzogYm9vbGVhbixcbiAgbWFza0NsYXNzTmFtZT86IHN0cmluZyxcbiAga2V5Ym9hcmRDbG9zYWJsZT86IGJvb2xlYW47XG4gIGZvb3Rlcj86ICgob2tCdG46IFJlYWN0Tm9kZSwgY2FuY2VsQnRuOiBSZWFjdE5vZGUpID0+IFJlYWN0Tm9kZSkgfCBSZWFjdE5vZGUgfCBib29sZWFuO1xuICBkZXN0cm95T25DbG9zZT86IGJvb2xlYW47XG4gIG9rVGV4dD86IFJlYWN0Tm9kZTtcbiAgY2FuY2VsVGV4dD86IFJlYWN0Tm9kZTtcbiAgb2tQcm9wcz86IEJ1dHRvblByb3BzO1xuICBjYW5jZWxQcm9wcz86IEJ1dHRvblByb3BzO1xuICBvbkNsb3NlPzogKCkgPT4gUHJvbWlzZTxib29sZWFuIHwgdW5kZWZpbmVkPjtcbiAgb25Paz86ICgpID0+IFByb21pc2U8Ym9vbGVhbiB8IHVuZGVmaW5lZD47XG4gIG9uQ2FuY2VsPzogKCkgPT4gUHJvbWlzZTxib29sZWFuIHwgdW5kZWZpbmVkPjtcbiAgYWZ0ZXJDbG9zZT86ICgpID0+IHZvaWQ7XG4gIGNsb3NlPzogKCkgPT4gdm9pZDtcbiAgdXBkYXRlPzogKHByb3BzPzogTW9kYWxQcm9wcykgPT4gdm9pZDtcbiAgb2tDYW5jZWw/OiBib29sZWFuO1xuICBkcmF3ZXI/OiBib29sZWFuO1xuICBkcmF3ZXJUcmFuc2l0aW9uTmFtZT86IHN0cmluZztcbiAga2V5PzogS2V5O1xuICBib3JkZXI/OiBib29sZWFuO1xuICBva0ZpcnN0PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWwgZXh0ZW5kcyBWaWV3Q29tcG9uZW50PE1vZGFsUHJvcHM+IHtcbiAgc3RhdGljIGRpc3BsYXlOYW1lID0gJ01vZGFsJztcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC4uLlZpZXdDb21wb25lbnQucHJvcFR5cGVzLFxuICAgIGNsb3NhYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBtb3ZhYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBmdWxsU2NyZWVuOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBtYXNrQ2xvc2FibGU6IFByb3BUeXBlcy5ib29sLFxuICAgIG1hc2tTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtYXNrOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBtYXNrQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGtleWJvYXJkQ2xvc2FibGU6IFByb3BUeXBlcy5ib29sLFxuICAgIGZvb3RlcjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmZ1bmMsIFByb3BUeXBlcy5ub2RlLCBQcm9wVHlwZXMuYm9vbF0pLFxuICAgIGRlc3Ryb3lPbkNsb3NlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBva1RleHQ6IFByb3BUeXBlcy5ub2RlLFxuICAgIGNhbmNlbFRleHQ6IFByb3BUeXBlcy5ub2RlLFxuICAgIG9rUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgY2FuY2VsUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgb25DbG9zZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25PazogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DYW5jZWw6IFByb3BUeXBlcy5mdW5jLFxuICAgIGFmdGVyQ2xvc2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9rQ2FuY2VsOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBkcmF3ZXI6IFByb3BUeXBlcy5ib29sLFxuICAgIC8vIHRpdGxlOiBQcm9wVHlwZXMubm9kZSxcbiAgICAvLyDmraTlpITljp/mnKzlhYHorrh0aXRsZeS8oOWFpW5vZGXvvIzkvYbmmK/nsbvlnovkuLpQcm9wVHlwZXMubm9kZeaXtuaXoOazleato+ehrue7p+aJv1ZpZXdDb21wb25lbnRcbiAgICAvLyDniLbnsbvkuK3nmoR0aXRsZeaMh+eahOaYr0hUTUzlhYPntKDnmoR0aXRsZeWxnuaAp++8jOatpOWkhHRpdGxl5oyHbW9kYWzmoIfpopjvvIzkuqfnlJ/mrafkuYnvvIzmmoLml7borr7nva7kuLpzdHJpbmdcbiAgICAvLyBUT0RPOiDmt7vliqBtb2RhbFRpdGxl5bGe5oCn5pu/5Luj5q2k5aSE55qEdGl0bGVcbiAgICB0aXRsZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBva0ZpcnN0OiBQcm9wVHlwZXMuYm9vbCxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHN1ZmZpeENscyxcbiAgICBjbG9zYWJsZTogZmFsc2UsXG4gICAgbW92YWJsZTogdHJ1ZSxcbiAgICBtYXNrQ2xvc2FibGU6IGZhbHNlLFxuICAgIG1hc2s6IHRydWUsXG4gICAga2V5Ym9hcmRDbG9zYWJsZTogdHJ1ZSxcbiAgICBva0NhbmNlbDogdHJ1ZSxcbiAgICBkZXN0cm95T25DbG9zZTogdHJ1ZSxcbiAgICBmdWxsU2NyZWVuOiBmYWxzZSxcbiAgICBkcmF3ZXI6IGZhbHNlLFxuICAgIGF1dG9Gb2N1czogdHJ1ZSxcbiAgfTtcblxuICBzdGF0aWMga2V5O1xuXG4gIHN0YXRpYyBvcGVuO1xuXG4gIHN0YXRpYyBjb25maXJtO1xuXG4gIHN0YXRpYyBpbmZvO1xuXG4gIHN0YXRpYyBzdWNjZXNzO1xuXG4gIHN0YXRpYyBlcnJvcjtcblxuICBzdGF0aWMgd2FybmluZztcblxuICBzdGF0aWMgZGVzdHJveUFsbDogKCkgPT4gdm9pZDtcblxuICBtb3ZlRXZlbnQ6IEV2ZW50TWFuYWdlciA9IG5ldyBFdmVudE1hbmFnZXIodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgPyB1bmRlZmluZWQgOiBkb2N1bWVudCk7XG5cbiAgb2tDYW5jZWxFdmVudDogRXZlbnRNYW5hZ2VyID0gbmV3IEV2ZW50TWFuYWdlcigpO1xuXG4gIG9mZnNldD86IFtudW1iZXIgfCBzdHJpbmcgfCB1bmRlZmluZWQsIG51bWJlciB8IHN0cmluZyB8IHVuZGVmaW5lZF07XG5cbiAgY2FuY2VsQnV0dG9uOiBCdXR0b24gfCBudWxsO1xuXG4gIHNhdmVDYW5jZWxSZWYgPSBub2RlID0+ICh0aGlzLmNhbmNlbEJ1dHRvbiA9IG5vZGUpO1xuXG4gIGhhbmRsZUtleURvd24gPSBlID0+IHtcbiAgICBjb25zdCB7IGNhbmNlbEJ1dHRvbiB9ID0gdGhpcztcbiAgICBpZiAoY2FuY2VsQnV0dG9uICYmICFjYW5jZWxCdXR0b24uaXNEaXNhYmxlZCgpICYmIGUua2V5Q29kZSA9PT0gS2V5Q29kZS5FU0MpIHtcbiAgICAgIGNhbmNlbEJ1dHRvbi5oYW5kbGVDbGlja1dhaXQoZSk7XG4gICAgfVxuICB9O1xuXG4gIGdldE90aGVyUHJvcHMoKSB7XG4gICAgY29uc3Qgb3RoZXJQcm9wcyA9IG9taXQoc3VwZXIuZ2V0T3RoZXJQcm9wcygpLCBbXG4gICAgICAnY2xvc2FibGUnLFxuICAgICAgJ21vdmFibGUnLFxuICAgICAgJ21hc2tDbG9zYWJsZScsXG4gICAgICAnbWFza1N0eWxlJyxcbiAgICAgICdtYXNrJyxcbiAgICAgICdtYXNrQ2xhc3NOYW1lJyxcbiAgICAgICdrZXlib2FyZENsb3NhYmxlJyxcbiAgICAgICdmdWxsU2NyZWVuJyxcbiAgICAgICd0aXRsZScsXG4gICAgICAnZm9vdGVyJyxcbiAgICAgICdjbG9zZScsXG4gICAgICAndXBkYXRlJyxcbiAgICAgICdva1RleHQnLFxuICAgICAgJ2NhbmNlbFRleHQnLFxuICAgICAgJ29rQ2FuY2VsJyxcbiAgICAgICdvbkNsb3NlJyxcbiAgICAgICdvbk9rJyxcbiAgICAgICdvbkNhbmNlbCcsXG4gICAgICAnZGVzdHJveU9uQ2xvc2UnLFxuICAgICAgJ2RyYXdlcicsXG4gICAgICAnYWZ0ZXJDbG9zZScsXG4gICAgICAnb2tQcm9wcycsXG4gICAgICAnY2FuY2VsUHJvcHMnLFxuICAgICAgJ2JvcmRlcicsXG4gICAgICAnb2tGaXJzdCcsXG4gICAgICAnZHJhd2VyVHJhbnNpdGlvbk5hbWUnLFxuICAgIF0pO1xuICAgIGlmICh0aGlzLnByb3BzLmtleWJvYXJkQ2xvc2FibGUpIHtcbiAgICAgIG90aGVyUHJvcHMuYXV0b0ZvY3VzID0gdHJ1ZTtcbiAgICAgIG90aGVyUHJvcHMudGFiSW5kZXggPSAtMTtcbiAgICAgIG90aGVyUHJvcHMub25LZXlEb3duID0gdGhpcy5oYW5kbGVLZXlEb3duO1xuICAgIH1cblxuICAgIHJldHVybiBvdGhlclByb3BzO1xuICB9XG5cbiAgZ2V0Q2xhc3NOYW1lKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgcHJvcHM6IHsgc3R5bGUgPSB7fSwgZnVsbFNjcmVlbiwgZHJhd2VyLCBib3JkZXIgPSBnZXRDb25maWcoJ21vZGFsU2VjdGlvbkJvcmRlcicpIH0sXG4gICAgfSA9IHRoaXM7XG5cbiAgICByZXR1cm4gc3VwZXIuZ2V0Q2xhc3NOYW1lKHtcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWNlbnRlcmBdOiAhZHJhd2VyICYmICEoJ2xlZnQnIGluIHN0eWxlIHx8ICdyaWdodCcgaW4gc3R5bGUpICYmICF0aGlzLm9mZnNldCxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWZ1bGxzY3JlZW5gXTogZnVsbFNjcmVlbixcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWRyYXdlcmBdOiBkcmF3ZXIsXG4gICAgICBbYCR7cHJlZml4Q2xzfS1ib3JkZXJgXTogYm9yZGVyLFxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzIH0gPSB0aGlzO1xuICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuZ2V0SGVhZGVyKCk7XG4gICAgY29uc3QgYm9keSA9IHRoaXMuZ2V0Qm9keSgpO1xuICAgIGNvbnN0IGZvb3RlciA9IHRoaXMuZ2V0Rm9vdGVyKCk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgey4uLnRoaXMuZ2V0TWVyZ2VkUHJvcHMoKX0+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWNvbnRlbnRgfT5cbiAgICAgICAgICB7aGVhZGVyfVxuICAgICAgICAgIHtib2R5fVxuICAgICAgICAgIHtmb290ZXJ9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVcGRhdGUoeyBoaWRkZW4gfSkge1xuICAgIGlmIChoaWRkZW4gPT09IGZhbHNlICYmIGhpZGRlbiAhPT0gdGhpcy5wcm9wcy5oaWRkZW4pIHtcbiAgICAgIGRlZmVyKCgpID0+IHRoaXMuZm9jdXMoKSk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5tb3ZlRXZlbnQuY2xlYXIoKTtcbiAgICB0aGlzLm9rQ2FuY2VsRXZlbnQuY2xlYXIoKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVIZWFkZXJNb3VzZURvd24oZG93bkV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgY29uc3QgeyBlbGVtZW50IH0gPSB0aGlzO1xuICAgIGlmIChlbGVtZW50KSB7XG4gICAgICBjb25zdCB7IHByZWZpeENscyB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHsgY2xpZW50WCwgY2xpZW50WSB9ID0gZG93bkV2ZW50O1xuICAgICAgY29uc3QgeyBvZmZzZXRMZWZ0LCBvZmZzZXRUb3AgfSA9IGVsZW1lbnQ7XG4gICAgICB0aGlzLm1vdmVFdmVudFxuICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgKG1vdmVFdmVudDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgY2xpZW50WDogbW92ZVgsIGNsaWVudFk6IG1vdmVZIH0gPSBtb3ZlRXZlbnQ7XG4gICAgICAgICAgY2xhc3NlcyhlbGVtZW50KS5yZW1vdmUoYCR7cHJlZml4Q2xzfS1jZW50ZXJgKTtcbiAgICAgICAgICBjb25zdCBsZWZ0ID0gcHhUb1JlbShNYXRoLm1heChvZmZzZXRMZWZ0ICsgbW92ZVggLSBjbGllbnRYLCAwKSk7XG4gICAgICAgICAgY29uc3QgdG9wID0gcHhUb1JlbShNYXRoLm1heChvZmZzZXRUb3AgKyBtb3ZlWSAtIGNsaWVudFksIDApKTtcbiAgICAgICAgICB0aGlzLm9mZnNldCA9IFtsZWZ0LCB0b3BdO1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24oZWxlbWVudC5zdHlsZSwge1xuICAgICAgICAgICAgbGVmdCxcbiAgICAgICAgICAgIHRvcCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5tb3ZlRXZlbnQuY2xlYXIoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGFzeW5jIGhhbmRsZU9rKCkge1xuICAgIGNvbnN0IHsgb25PayA9IG5vb3AgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcHJvbWlzZSA9IFByb21pc2UuYWxsKFtvbk9rKCksIHRoaXMub2tDYW5jZWxFdmVudC5maXJlRXZlbnQoJ29rJyldKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgW3JldDEsIHJldDJdID0gYXdhaXQgcHJvbWlzZTtcbiAgICAgIGlmIChyZXQxICE9PSBmYWxzZSAmJiByZXQyKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoIShlIGluc3RhbmNlb2YgRGF0YVNldFJlcXVlc3RFcnJvcikpIHtcbiAgICAgICAgbWVzc2FnZS5lcnJvcihleGNlcHRpb24oZSkpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgYXN5bmMgaGFuZGxlQ2FuY2VsKCkge1xuICAgIGNvbnN0IHsgb25DYW5jZWwgPSBub29wIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHByb21pc2UgPSBQcm9taXNlLmFsbChbb25DYW5jZWwoKSwgdGhpcy5va0NhbmNlbEV2ZW50LmZpcmVFdmVudCgnY2FuY2VsJyldKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgW3JldDEsIHJldDJdID0gYXdhaXQgcHJvbWlzZTtcbiAgICAgIGlmIChyZXQxICE9PSBmYWxzZSAmJiByZXQyKSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoIShlIGluc3RhbmNlb2YgRGF0YVNldFJlcXVlc3RFcnJvcikpIHtcbiAgICAgICAgbWVzc2FnZS5lcnJvcihleGNlcHRpb24oZSkpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH1cblxuICBnZXRUaXRsZSgpOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHtcbiAgICAgIHByb3BzOiB7IHRpdGxlIH0sXG4gICAgICBwcmVmaXhDbHMsXG4gICAgfSA9IHRoaXM7XG4gICAgaWYgKHRpdGxlKSB7XG4gICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdGl0bGVgfT57dGl0bGV9PC9kaXY+O1xuICAgIH1cbiAgfVxuXG4gIGdldEhlYWRlcigpOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENscyxcbiAgICAgIHByb3BzOiB7IGNsb3NhYmxlLCBtb3ZhYmxlLCBmdWxsU2NyZWVuLCBkcmF3ZXIgfSxcbiAgICB9ID0gdGhpcztcbiAgICBjb25zdCB0aXRsZSA9IHRoaXMuZ2V0VGl0bGUoKTtcbiAgICBjb25zdCBidXR0b25zID0gdGhpcy5nZXRIZWFkZXJCdXR0b25zKCk7XG4gICAgaWYgKHRpdGxlIHx8IGNsb3NhYmxlIHx8IG1vdmFibGUpIHtcbiAgICAgIGNvbnN0IGhlYWRlclByb3BzOiBhbnkgPSB7XG4gICAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyhgJHtwcmVmaXhDbHN9LWhlYWRlcmAsIHtcbiAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1tb3ZhYmxlYF06IG1vdmFibGUgJiYgIWZ1bGxTY3JlZW4gJiYgIWRyYXdlcixcbiAgICAgICAgfSksXG4gICAgICB9O1xuICAgICAgaWYgKG1vdmFibGUgJiYgIWZ1bGxTY3JlZW4gJiYgIWRyYXdlcikge1xuICAgICAgICBoZWFkZXJQcm9wcy5vbk1vdXNlRG93biA9IHRoaXMuaGFuZGxlSGVhZGVyTW91c2VEb3duO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiB7Li4uaGVhZGVyUHJvcHN9PlxuICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgICB7YnV0dG9uc31cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGdldEhlYWRlckJ1dHRvbnMoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7IHByZWZpeENscyB9ID0gdGhpcztcbiAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IHRoaXMuZ2V0Q2xvc2VCdXR0b24oKTtcbiAgICBpZiAoY2xvc2VCdXR0b24pIHtcbiAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1oZWFkZXItYnV0dG9uc2B9PntjbG9zZUJ1dHRvbn08L2Rpdj47XG4gICAgfVxuICB9XG5cbiAgZ2V0Q2xvc2VCdXR0b24oKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBwcm9wczogeyBjbG9zYWJsZSB9LFxuICAgIH0gPSB0aGlzO1xuICAgIGlmIChjbG9zYWJsZSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWhlYWRlci1idXR0b25gfSBvbkNsaWNrPXt0aGlzLmNsb3NlfT5cbiAgICAgICAgICA8SWNvbiB0eXBlPVwiY2xvc2VcIiAvPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXJPayA9IG9rID0+IHtcbiAgICB0aGlzLm9rQ2FuY2VsRXZlbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignb2snKTtcbiAgICB0aGlzLm9rQ2FuY2VsRXZlbnQuYWRkRXZlbnRMaXN0ZW5lcignb2snLCBvayk7XG4gIH07XG5cbiAgcmVnaXN0ZXJDYW5jZWwgPSBjYW5jZWwgPT4ge1xuICAgIHRoaXMub2tDYW5jZWxFdmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjYW5jZWwnKTtcbiAgICB0aGlzLm9rQ2FuY2VsRXZlbnQuYWRkRXZlbnRMaXN0ZW5lcignY2FuY2VsJywgY2FuY2VsKTtcbiAgfTtcblxuICByZW5kZXJDaGlsZHJlbihjaGlsZHJlbjogUmVhY3ROb2RlKTogUmVhY3ROb2RlIHtcbiAgICBpZiAoY2hpbGRyZW4pIHtcbiAgICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBwcm9wcyB9ID0gdGhpcztcbiAgICAgIGNvbnN0IHsgY2xvc2UgPSBub29wLCB1cGRhdGUgPSBub29wIH0gPSBwcm9wcztcbiAgICAgIGNvbnN0IG1vZGFsID0ge1xuICAgICAgICBjbG9zZSxcbiAgICAgICAgdXBkYXRlLFxuICAgICAgICBwcm9wcyxcbiAgICAgICAgaGFuZGxlT2s6IHRoaXMucmVnaXN0ZXJPayxcbiAgICAgICAgaGFuZGxlQ2FuY2VsOiB0aGlzLnJlZ2lzdGVyQ2FuY2VsLFxuICAgICAgfTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWJvZHlgfT5cbiAgICAgICAgICB7aXNWYWxpZEVsZW1lbnQoY2hpbGRyZW4pID8gY2xvbmVFbGVtZW50PGFueT4oY2hpbGRyZW4sIHsgbW9kYWwgfSkgOiBjaGlsZHJlbn1cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGdldEJvZHkoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7IGNoaWxkcmVuIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiB0aGlzLnJlbmRlckNoaWxkcmVuKFxuICAgICAgdHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nXG4gICAgICAgID8gYXN5bmNDb21wb25lbnQoY2hpbGRyZW4gYXMgQXN5bmNDbXBMb2FkaW5nRnVuY3Rpb24pXG4gICAgICAgIDogY2hpbGRyZW4sXG4gICAgKTtcbiAgfVxuXG4gIGdldEZvb3RlcigpOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHtcbiAgICAgIG9rUHJvcHMsXG4gICAgICBjYW5jZWxQcm9wcyxcbiAgICAgIGRyYXdlcixcbiAgICAgIG9rVGV4dCA9ICRsKCdNb2RhbCcsICdvaycpLFxuICAgICAgY2FuY2VsVGV4dCA9ICRsKCdNb2RhbCcsICdjYW5jZWwnKSxcbiAgICAgIGZvb3RlciA9IHRoaXMuZ2V0RGVmYXVsdEZvb3RlcixcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBmdW5jVHlwZTogRnVuY1R5cGUgfCB1bmRlZmluZWQgPSBkcmF3ZXJcbiAgICAgID8gRnVuY1R5cGUucmFpc2VkXG4gICAgICA6IChnZXRDb25maWcoJ2J1dHRvbkZ1bmNUeXBlJykgYXMgRnVuY1R5cGUpO1xuXG4gICAgY29uc3Qgb2tCdG4gPSAoXG4gICAgICA8QnV0dG9uXG4gICAgICAgIGtleT1cIm9rXCJcbiAgICAgICAgZnVuY1R5cGU9e2Z1bmNUeXBlfVxuICAgICAgICBjb2xvcj17QnV0dG9uQ29sb3IucHJpbWFyeX1cbiAgICAgICAgb25DbGljaz17dGhpcy5oYW5kbGVPa31cbiAgICAgICAgey4uLm9rUHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtva1RleHR9XG4gICAgICA8L0J1dHRvbj5cbiAgICApO1xuICAgIGNvbnN0IGNhbmNlbEJ0biA9IChcbiAgICAgIDxCdXR0b25cbiAgICAgICAga2V5PVwiY2FuY2VsXCJcbiAgICAgICAgcmVmPXt0aGlzLnNhdmVDYW5jZWxSZWZ9XG4gICAgICAgIGZ1bmNUeXBlPXtmdW5jVHlwZX1cbiAgICAgICAgb25DbGljaz17dGhpcy5oYW5kbGVDYW5jZWx9XG4gICAgICAgIHsuLi5jYW5jZWxQcm9wc31cbiAgICAgID5cbiAgICAgICAge2NhbmNlbFRleHR9XG4gICAgICA8L0J1dHRvbj5cbiAgICApO1xuXG4gICAgaWYgKHR5cGVvZiBmb290ZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFdyYXBwZWRGb290ZXIoZm9vdGVyKG9rQnRuLCBjYW5jZWxCdG4pKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzRW1wdHkoZm9vdGVyLCB0cnVlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0V3JhcHBlZEZvb3Rlcihmb290ZXIpO1xuICAgIH1cbiAgfVxuXG4gIGdldFdyYXBwZWRGb290ZXIoZm9vdGVyOiBSZWFjdE5vZGUpIHtcbiAgICBjb25zdCB7IHByZWZpeENscyB9ID0gdGhpcztcblxuICAgIGNvbnN0IHsgZHJhd2VyIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NOYW1lcyhgJHtwcmVmaXhDbHN9LWZvb3RlcmAsIHtcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWZvb3Rlci1kcmF3ZXJgXTogISFkcmF3ZXIsXG4gICAgfSk7XG4gICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWV9Pntmb290ZXJ9PC9kaXY+O1xuICB9XG5cbiAgZ2V0RGVmYXVsdEZvb3RlciA9IChva0J0bjogUmVhY3ROb2RlLCBjYW5jZWxCdG46IFJlYWN0Tm9kZSkgPT4ge1xuICAgIGNvbnN0IHsgb2tDYW5jZWwsIG9rRmlyc3QgPSBnZXRDb25maWcoJ21vZGFsT2tGaXJzdCcpLCBkcmF3ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgYnV0dG9ucyA9IFtva0J0bl07XG4gICAgaWYgKG9rQ2FuY2VsKSB7XG4gICAgICBpZiAob2tGaXJzdCB8fCBkcmF3ZXIpIHtcbiAgICAgICAgYnV0dG9ucy5wdXNoKGNhbmNlbEJ0bik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBidXR0b25zLnVuc2hpZnQoY2FuY2VsQnRuKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIDxkaXY+e2J1dHRvbnN9PC9kaXY+O1xuICB9O1xuXG4gIEBhdXRvYmluZFxuICBjbG9zZSgpIHtcbiAgICBjb25zdCB7IGNsb3NlID0gbm9vcCB9ID0gdGhpcy5wcm9wcztcbiAgICBjbG9zZSgpO1xuICB9XG59XG4iXX0=