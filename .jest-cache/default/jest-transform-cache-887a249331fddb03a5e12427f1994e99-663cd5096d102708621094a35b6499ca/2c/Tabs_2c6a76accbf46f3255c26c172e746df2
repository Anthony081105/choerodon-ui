1b0075bbf873c0c1b2c0849b907a55b9
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _classnames2 = _interopRequireDefault(require("classnames"));

var _KeyCode = _interopRequireDefault(require("./KeyCode"));

var _TabPane = _interopRequireDefault(require("./TabPane"));

var _utils = require("./utils");

function getDefaultActiveKey(props) {
  var activeKey;

  _react.Children.forEach(props.children, function (child, index) {
    if (child && !activeKey && !child.props.disabled) {
      activeKey = (0, _utils.generateKey)(child.key, index);
    }
  });

  return activeKey;
}

function activeKeyIsValid(props, key) {
  var keys = _react.Children.map(props.children, function (child, index) {
    return child && (0, _utils.generateKey)(child.key, index);
  });

  return keys.indexOf(key) >= 0;
}

var Tabs =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Tabs, _Component);

  function Tabs(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Tabs);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Tabs).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onTabClick", function (activeKey) {
      if (_this.tabBar.props.onTabClick) {
        _this.tabBar.props.onTabClick(activeKey);
      }

      _this.setActiveKey(activeKey);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onNavKeyDown", function (e) {
      var eventKeyCode = e.keyCode;

      if (eventKeyCode === _KeyCode["default"].RIGHT || eventKeyCode === _KeyCode["default"].DOWN) {
        e.preventDefault();

        var nextKey = _this.getNextActiveKey(true);

        _this.onTabClick(nextKey);
      } else if (eventKeyCode === _KeyCode["default"].LEFT || eventKeyCode === _KeyCode["default"].UP) {
        e.preventDefault();

        var previousKey = _this.getNextActiveKey(false);

        _this.onTabClick(previousKey);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setActiveKey", function (activeKey) {
      if (_this.state.activeKey !== activeKey) {
        if (!('activeKey' in _this.props)) {
          _this.setState({
            activeKey: activeKey
          });
        }

        _this.props.onChange(activeKey);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getNextActiveKey", function (next) {
      var activeKey = _this.state.activeKey;
      var children = [];

      _react.Children.forEach(_this.props.children, function (c) {
        if (c && !c.props.disabled) {
          if (next) {
            children.push(c);
          } else {
            children.unshift(c);
          }
        }
      });

      var length = children.length;
      var ret = length && (0, _utils.generateKey)(children[0].key, 0);
      children.forEach(function (child, i) {
        if ((0, _utils.generateKey)(child.key, i) === activeKey) {
          if (i === length - 1) {
            ret = (0, _utils.generateKey)(children[0].key, 0);
          } else {
            ret = (0, _utils.generateKey)(children[i + 1].key, i + 1);
          }
        }
      });
      return ret;
    });

    var _activeKey;

    if ('activeKey' in props) {
      _activeKey = props.activeKey;
    } else if ('defaultActiveKey' in props) {
      _activeKey = props.defaultActiveKey;
    } else {
      _activeKey = getDefaultActiveKey(props);
    }

    _this.state = {
      activeKey: _activeKey
    };
    return _this;
  }

  (0, _createClass2["default"])(Tabs, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('activeKey' in nextProps) {
        this.setState({
          activeKey: nextProps.activeKey
        });
      } else if (!activeKeyIsValid(nextProps, this.state.activeKey)) {
        this.setState({
          activeKey: getDefaultActiveKey(nextProps)
        });
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _classnames;

      var props = this.props;
      var prefixCls = props.prefixCls,
          tabBarPosition = props.tabBarPosition,
          className = props.className,
          renderTabContent = props.renderTabContent,
          renderTabBar = props.renderTabBar,
          destroyInactiveTabPane = props.destroyInactiveTabPane,
          restProps = (0, _objectWithoutProperties2["default"])(props, ["prefixCls", "tabBarPosition", "className", "renderTabContent", "renderTabBar", "destroyInactiveTabPane"]);
      var cls = (0, _classnames2["default"])((_classnames = {}, (0, _defineProperty2["default"])(_classnames, prefixCls, 1), (0, _defineProperty2["default"])(_classnames, "".concat(prefixCls, "-").concat(tabBarPosition), 1), (0, _defineProperty2["default"])(_classnames, className, !!className), _classnames));
      this.tabBar = renderTabBar();
      var contents = [(0, _react.cloneElement)(this.tabBar, {
        prefixCls: prefixCls,
        key: 'tabBar',
        onKeyDown: this.onNavKeyDown,
        tabBarPosition: tabBarPosition,
        onTabClick: this.onTabClick,
        panels: props.children,
        activeKey: this.state.activeKey
      }), (0, _react.cloneElement)(renderTabContent(), {
        prefixCls: prefixCls,
        tabBarPosition: tabBarPosition,
        activeKey: this.state.activeKey,
        destroyInactiveTabPane: destroyInactiveTabPane,
        children: props.children,
        onChange: this.setActiveKey,
        key: 'tabContent'
      })];

      if (tabBarPosition === 'bottom') {
        contents.reverse();
      }

      return _react["default"].createElement("div", (0, _extends2["default"])({
        className: cls,
        style: props.style
      }, (0, _utils.getDataAttr)(restProps)), contents);
    }
  }]);
  return Tabs;
}(_react.Component);

exports["default"] = Tabs;
(0, _defineProperty2["default"])(Tabs, "propTypes", {
  destroyInactiveTabPane: _propTypes["default"].bool,
  renderTabBar: _propTypes["default"].func.isRequired,
  renderTabContent: _propTypes["default"].func.isRequired,
  onChange: _propTypes["default"].func,
  children: _propTypes["default"].any,
  prefixCls: _propTypes["default"].string,
  className: _propTypes["default"].string,
  tabBarPosition: _propTypes["default"].string,
  style: _propTypes["default"].object,
  activeKey: _propTypes["default"].string,
  defaultActiveKey: _propTypes["default"].string
});
(0, _defineProperty2["default"])(Tabs, "defaultProps", {
  prefixCls: 'rc-tabs',
  destroyInactiveTabPane: false,
  onChange: _noop["default"],
  tabBarPosition: 'top',
  style: {}
});
(0, _defineProperty2["default"])(Tabs, "TabPane", _TabPane["default"]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRhYnMuanN4Il0sIm5hbWVzIjpbImdldERlZmF1bHRBY3RpdmVLZXkiLCJwcm9wcyIsImFjdGl2ZUtleSIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImNoaWxkcmVuIiwiY2hpbGQiLCJpbmRleCIsImRpc2FibGVkIiwia2V5IiwiYWN0aXZlS2V5SXNWYWxpZCIsImtleXMiLCJtYXAiLCJpbmRleE9mIiwiVGFicyIsInRhYkJhciIsIm9uVGFiQ2xpY2siLCJzZXRBY3RpdmVLZXkiLCJlIiwiZXZlbnRLZXlDb2RlIiwia2V5Q29kZSIsIktleUNvZGUiLCJSSUdIVCIsIkRPV04iLCJwcmV2ZW50RGVmYXVsdCIsIm5leHRLZXkiLCJnZXROZXh0QWN0aXZlS2V5IiwiTEVGVCIsIlVQIiwicHJldmlvdXNLZXkiLCJzdGF0ZSIsInNldFN0YXRlIiwib25DaGFuZ2UiLCJuZXh0IiwiYyIsInB1c2giLCJ1bnNoaWZ0IiwibGVuZ3RoIiwicmV0IiwiaSIsImRlZmF1bHRBY3RpdmVLZXkiLCJuZXh0UHJvcHMiLCJwcmVmaXhDbHMiLCJ0YWJCYXJQb3NpdGlvbiIsImNsYXNzTmFtZSIsInJlbmRlclRhYkNvbnRlbnQiLCJyZW5kZXJUYWJCYXIiLCJkZXN0cm95SW5hY3RpdmVUYWJQYW5lIiwicmVzdFByb3BzIiwiY2xzIiwiY29udGVudHMiLCJvbktleURvd24iLCJvbk5hdktleURvd24iLCJwYW5lbHMiLCJyZXZlcnNlIiwic3R5bGUiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJib29sIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJhbnkiLCJzdHJpbmciLCJvYmplY3QiLCJub29wIiwiVGFiUGFuZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxTQUFTQSxtQkFBVCxDQUE2QkMsS0FBN0IsRUFBb0M7QUFDbEMsTUFBSUMsU0FBSjs7QUFDQUMsa0JBQVNDLE9BQVQsQ0FBaUJILEtBQUssQ0FBQ0ksUUFBdkIsRUFBaUMsVUFBQ0MsS0FBRCxFQUFRQyxLQUFSLEVBQWtCO0FBQ2pELFFBQUlELEtBQUssSUFBSSxDQUFDSixTQUFWLElBQXVCLENBQUNJLEtBQUssQ0FBQ0wsS0FBTixDQUFZTyxRQUF4QyxFQUFrRDtBQUNoRE4sTUFBQUEsU0FBUyxHQUFHLHdCQUFZSSxLQUFLLENBQUNHLEdBQWxCLEVBQXVCRixLQUF2QixDQUFaO0FBQ0Q7QUFDRixHQUpEOztBQUtBLFNBQU9MLFNBQVA7QUFDRDs7QUFFRCxTQUFTUSxnQkFBVCxDQUEwQlQsS0FBMUIsRUFBaUNRLEdBQWpDLEVBQXNDO0FBQ3BDLE1BQU1FLElBQUksR0FBR1IsZ0JBQVNTLEdBQVQsQ0FDWFgsS0FBSyxDQUFDSSxRQURLLEVBRVgsVUFBQ0MsS0FBRCxFQUFRQyxLQUFSO0FBQUEsV0FBa0JELEtBQUssSUFBSSx3QkFBWUEsS0FBSyxDQUFDRyxHQUFsQixFQUF1QkYsS0FBdkIsQ0FBM0I7QUFBQSxHQUZXLENBQWI7O0FBSUEsU0FBT0ksSUFBSSxDQUFDRSxPQUFMLENBQWFKLEdBQWIsS0FBcUIsQ0FBNUI7QUFDRDs7SUFFb0JLLEk7Ozs7O0FBeUJuQixnQkFBWWIsS0FBWixFQUFtQjtBQUFBOztBQUFBO0FBQ2pCLGdIQUFNQSxLQUFOO0FBRGlCLG1HQTZCTixVQUFBQyxTQUFTLEVBQUk7QUFDeEIsVUFBSSxNQUFLYSxNQUFMLENBQVlkLEtBQVosQ0FBa0JlLFVBQXRCLEVBQWtDO0FBQ2hDLGNBQUtELE1BQUwsQ0FBWWQsS0FBWixDQUFrQmUsVUFBbEIsQ0FBNkJkLFNBQTdCO0FBQ0Q7O0FBQ0QsWUFBS2UsWUFBTCxDQUFrQmYsU0FBbEI7QUFDRCxLQWxDa0I7QUFBQSxxR0FvQ0osVUFBQWdCLENBQUMsRUFBSTtBQUNsQixVQUFNQyxZQUFZLEdBQUdELENBQUMsQ0FBQ0UsT0FBdkI7O0FBQ0EsVUFBSUQsWUFBWSxLQUFLRSxvQkFBUUMsS0FBekIsSUFBa0NILFlBQVksS0FBS0Usb0JBQVFFLElBQS9ELEVBQXFFO0FBQ25FTCxRQUFBQSxDQUFDLENBQUNNLGNBQUY7O0FBQ0EsWUFBTUMsT0FBTyxHQUFHLE1BQUtDLGdCQUFMLENBQXNCLElBQXRCLENBQWhCOztBQUNBLGNBQUtWLFVBQUwsQ0FBZ0JTLE9BQWhCO0FBQ0QsT0FKRCxNQUlPLElBQUlOLFlBQVksS0FBS0Usb0JBQVFNLElBQXpCLElBQWlDUixZQUFZLEtBQUtFLG9CQUFRTyxFQUE5RCxFQUFrRTtBQUN2RVYsUUFBQUEsQ0FBQyxDQUFDTSxjQUFGOztBQUNBLFlBQU1LLFdBQVcsR0FBRyxNQUFLSCxnQkFBTCxDQUFzQixLQUF0QixDQUFwQjs7QUFDQSxjQUFLVixVQUFMLENBQWdCYSxXQUFoQjtBQUNEO0FBQ0YsS0EvQ2tCO0FBQUEscUdBaURKLFVBQUEzQixTQUFTLEVBQUk7QUFDMUIsVUFBSSxNQUFLNEIsS0FBTCxDQUFXNUIsU0FBWCxLQUF5QkEsU0FBN0IsRUFBd0M7QUFDdEMsWUFBSSxFQUFFLGVBQWUsTUFBS0QsS0FBdEIsQ0FBSixFQUFrQztBQUNoQyxnQkFBSzhCLFFBQUwsQ0FBYztBQUNaN0IsWUFBQUEsU0FBUyxFQUFUQTtBQURZLFdBQWQ7QUFHRDs7QUFDRCxjQUFLRCxLQUFMLENBQVcrQixRQUFYLENBQW9COUIsU0FBcEI7QUFDRDtBQUNGLEtBMURrQjtBQUFBLHlHQTREQSxVQUFBK0IsSUFBSSxFQUFJO0FBQ3pCLFVBQU0vQixTQUFTLEdBQUcsTUFBSzRCLEtBQUwsQ0FBVzVCLFNBQTdCO0FBQ0EsVUFBTUcsUUFBUSxHQUFHLEVBQWpCOztBQUNBRixzQkFBU0MsT0FBVCxDQUFpQixNQUFLSCxLQUFMLENBQVdJLFFBQTVCLEVBQXNDLFVBQUE2QixDQUFDLEVBQUk7QUFDekMsWUFBSUEsQ0FBQyxJQUFJLENBQUNBLENBQUMsQ0FBQ2pDLEtBQUYsQ0FBUU8sUUFBbEIsRUFBNEI7QUFDMUIsY0FBSXlCLElBQUosRUFBVTtBQUNSNUIsWUFBQUEsUUFBUSxDQUFDOEIsSUFBVCxDQUFjRCxDQUFkO0FBQ0QsV0FGRCxNQUVPO0FBQ0w3QixZQUFBQSxRQUFRLENBQUMrQixPQUFULENBQWlCRixDQUFqQjtBQUNEO0FBQ0Y7QUFDRixPQVJEOztBQVNBLFVBQU1HLE1BQU0sR0FBR2hDLFFBQVEsQ0FBQ2dDLE1BQXhCO0FBQ0EsVUFBSUMsR0FBRyxHQUFHRCxNQUFNLElBQUksd0JBQVloQyxRQUFRLENBQUMsQ0FBRCxDQUFSLENBQVlJLEdBQXhCLEVBQTZCLENBQTdCLENBQXBCO0FBQ0FKLE1BQUFBLFFBQVEsQ0FBQ0QsT0FBVCxDQUFpQixVQUFDRSxLQUFELEVBQVFpQyxDQUFSLEVBQWM7QUFDN0IsWUFBSSx3QkFBWWpDLEtBQUssQ0FBQ0csR0FBbEIsRUFBdUI4QixDQUF2QixNQUE4QnJDLFNBQWxDLEVBQTZDO0FBQzNDLGNBQUlxQyxDQUFDLEtBQUtGLE1BQU0sR0FBRyxDQUFuQixFQUFzQjtBQUNwQkMsWUFBQUEsR0FBRyxHQUFHLHdCQUFZakMsUUFBUSxDQUFDLENBQUQsQ0FBUixDQUFZSSxHQUF4QixFQUE2QixDQUE3QixDQUFOO0FBQ0QsV0FGRCxNQUVPO0FBQ0w2QixZQUFBQSxHQUFHLEdBQUcsd0JBQVlqQyxRQUFRLENBQUNrQyxDQUFDLEdBQUcsQ0FBTCxDQUFSLENBQWdCOUIsR0FBNUIsRUFBaUM4QixDQUFDLEdBQUcsQ0FBckMsQ0FBTjtBQUNEO0FBQ0Y7QUFDRixPQVJEO0FBU0EsYUFBT0QsR0FBUDtBQUNELEtBcEZrQjs7QUFHakIsUUFBSXBDLFVBQUo7O0FBQ0EsUUFBSSxlQUFlRCxLQUFuQixFQUEwQjtBQUN4QkMsTUFBQUEsVUFBUyxHQUFHRCxLQUFLLENBQUNDLFNBQWxCO0FBQ0QsS0FGRCxNQUVPLElBQUksc0JBQXNCRCxLQUExQixFQUFpQztBQUN0Q0MsTUFBQUEsVUFBUyxHQUFHRCxLQUFLLENBQUN1QyxnQkFBbEI7QUFDRCxLQUZNLE1BRUE7QUFDTHRDLE1BQUFBLFVBQVMsR0FBR0YsbUJBQW1CLENBQUNDLEtBQUQsQ0FBL0I7QUFDRDs7QUFFRCxVQUFLNkIsS0FBTCxHQUFhO0FBQ1g1QixNQUFBQSxTQUFTLEVBQVRBO0FBRFcsS0FBYjtBQVppQjtBQWVsQjs7Ozs4Q0FFeUJ1QyxTLEVBQVc7QUFDbkMsVUFBSSxlQUFlQSxTQUFuQixFQUE4QjtBQUM1QixhQUFLVixRQUFMLENBQWM7QUFDWjdCLFVBQUFBLFNBQVMsRUFBRXVDLFNBQVMsQ0FBQ3ZDO0FBRFQsU0FBZDtBQUdELE9BSkQsTUFJTyxJQUFJLENBQUNRLGdCQUFnQixDQUFDK0IsU0FBRCxFQUFZLEtBQUtYLEtBQUwsQ0FBVzVCLFNBQXZCLENBQXJCLEVBQXdEO0FBQzdELGFBQUs2QixRQUFMLENBQWM7QUFDWjdCLFVBQUFBLFNBQVMsRUFBRUYsbUJBQW1CLENBQUN5QyxTQUFEO0FBRGxCLFNBQWQ7QUFHRDtBQUNGOzs7NkJBMkRRO0FBQUE7O0FBQ1AsVUFBTXhDLEtBQUssR0FBRyxLQUFLQSxLQUFuQjtBQURPLFVBR0x5QyxTQUhLLEdBVUh6QyxLQVZHLENBR0x5QyxTQUhLO0FBQUEsVUFJTEMsY0FKSyxHQVVIMUMsS0FWRyxDQUlMMEMsY0FKSztBQUFBLFVBS0xDLFNBTEssR0FVSDNDLEtBVkcsQ0FLTDJDLFNBTEs7QUFBQSxVQU1MQyxnQkFOSyxHQVVINUMsS0FWRyxDQU1MNEMsZ0JBTks7QUFBQSxVQU9MQyxZQVBLLEdBVUg3QyxLQVZHLENBT0w2QyxZQVBLO0FBQUEsVUFRTEMsc0JBUkssR0FVSDlDLEtBVkcsQ0FRTDhDLHNCQVJLO0FBQUEsVUFTRkMsU0FURSw2Q0FVSC9DLEtBVkc7QUFXUCxVQUFNZ0QsR0FBRyxHQUFHLDhGQUNUUCxTQURTLEVBQ0csQ0FESCwyREFFTkEsU0FGTSxjQUVPQyxjQUZQLEdBRTBCLENBRjFCLGlEQUdUQyxTQUhTLEVBR0csQ0FBQyxDQUFDQSxTQUhMLGdCQUFaO0FBTUEsV0FBSzdCLE1BQUwsR0FBYytCLFlBQVksRUFBMUI7QUFDQSxVQUFNSSxRQUFRLEdBQUcsQ0FDZix5QkFBYSxLQUFLbkMsTUFBbEIsRUFBMEI7QUFDeEIyQixRQUFBQSxTQUFTLEVBQVRBLFNBRHdCO0FBRXhCakMsUUFBQUEsR0FBRyxFQUFFLFFBRm1CO0FBR3hCMEMsUUFBQUEsU0FBUyxFQUFFLEtBQUtDLFlBSFE7QUFJeEJULFFBQUFBLGNBQWMsRUFBZEEsY0FKd0I7QUFLeEIzQixRQUFBQSxVQUFVLEVBQUUsS0FBS0EsVUFMTztBQU14QnFDLFFBQUFBLE1BQU0sRUFBRXBELEtBQUssQ0FBQ0ksUUFOVTtBQU94QkgsUUFBQUEsU0FBUyxFQUFFLEtBQUs0QixLQUFMLENBQVc1QjtBQVBFLE9BQTFCLENBRGUsRUFVZix5QkFBYTJDLGdCQUFnQixFQUE3QixFQUFpQztBQUMvQkgsUUFBQUEsU0FBUyxFQUFUQSxTQUQrQjtBQUUvQkMsUUFBQUEsY0FBYyxFQUFkQSxjQUYrQjtBQUcvQnpDLFFBQUFBLFNBQVMsRUFBRSxLQUFLNEIsS0FBTCxDQUFXNUIsU0FIUztBQUkvQjZDLFFBQUFBLHNCQUFzQixFQUF0QkEsc0JBSitCO0FBSy9CMUMsUUFBQUEsUUFBUSxFQUFFSixLQUFLLENBQUNJLFFBTGU7QUFNL0IyQixRQUFBQSxRQUFRLEVBQUUsS0FBS2YsWUFOZ0I7QUFPL0JSLFFBQUFBLEdBQUcsRUFBRTtBQVAwQixPQUFqQyxDQVZlLENBQWpCOztBQW9CQSxVQUFJa0MsY0FBYyxLQUFLLFFBQXZCLEVBQWlDO0FBQy9CTyxRQUFBQSxRQUFRLENBQUNJLE9BQVQ7QUFDRDs7QUFDRCxhQUNFO0FBQUssUUFBQSxTQUFTLEVBQUVMLEdBQWhCO0FBQXFCLFFBQUEsS0FBSyxFQUFFaEQsS0FBSyxDQUFDc0Q7QUFBbEMsU0FBNkMsd0JBQVlQLFNBQVosQ0FBN0MsR0FDR0UsUUFESCxDQURGO0FBS0Q7OztFQTdKK0JNLGdCOzs7aUNBQWIxQyxJLGVBQ0E7QUFDakJpQyxFQUFBQSxzQkFBc0IsRUFBRVUsc0JBQVVDLElBRGpCO0FBRWpCWixFQUFBQSxZQUFZLEVBQUVXLHNCQUFVRSxJQUFWLENBQWVDLFVBRlo7QUFHakJmLEVBQUFBLGdCQUFnQixFQUFFWSxzQkFBVUUsSUFBVixDQUFlQyxVQUhoQjtBQUlqQjVCLEVBQUFBLFFBQVEsRUFBRXlCLHNCQUFVRSxJQUpIO0FBS2pCdEQsRUFBQUEsUUFBUSxFQUFFb0Qsc0JBQVVJLEdBTEg7QUFNakJuQixFQUFBQSxTQUFTLEVBQUVlLHNCQUFVSyxNQU5KO0FBT2pCbEIsRUFBQUEsU0FBUyxFQUFFYSxzQkFBVUssTUFQSjtBQVFqQm5CLEVBQUFBLGNBQWMsRUFBRWMsc0JBQVVLLE1BUlQ7QUFTakJQLEVBQUFBLEtBQUssRUFBRUUsc0JBQVVNLE1BVEE7QUFVakI3RCxFQUFBQSxTQUFTLEVBQUV1RCxzQkFBVUssTUFWSjtBQVdqQnRCLEVBQUFBLGdCQUFnQixFQUFFaUIsc0JBQVVLO0FBWFgsQztpQ0FEQWhELEksa0JBZUc7QUFDcEI0QixFQUFBQSxTQUFTLEVBQUUsU0FEUztBQUVwQkssRUFBQUEsc0JBQXNCLEVBQUUsS0FGSjtBQUdwQmYsRUFBQUEsUUFBUSxFQUFFZ0MsZ0JBSFU7QUFJcEJyQixFQUFBQSxjQUFjLEVBQUUsS0FKSTtBQUtwQlksRUFBQUEsS0FBSyxFQUFFO0FBTGEsQztpQ0FmSHpDLEksYUF1QkZtRCxtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDaGlsZHJlbiwgY2xvbmVFbGVtZW50LCBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IG5vb3AgZnJvbSAnbG9kYXNoL25vb3AnO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgS2V5Q29kZSBmcm9tICcuL0tleUNvZGUnO1xuaW1wb3J0IFRhYlBhbmUgZnJvbSAnLi9UYWJQYW5lJztcbmltcG9ydCB7IGdlbmVyYXRlS2V5LCBnZXREYXRhQXR0ciB9IGZyb20gJy4vdXRpbHMnO1xuXG5mdW5jdGlvbiBnZXREZWZhdWx0QWN0aXZlS2V5KHByb3BzKSB7XG4gIGxldCBhY3RpdmVLZXk7XG4gIENoaWxkcmVuLmZvckVhY2gocHJvcHMuY2hpbGRyZW4sIChjaGlsZCwgaW5kZXgpID0+IHtcbiAgICBpZiAoY2hpbGQgJiYgIWFjdGl2ZUtleSAmJiAhY2hpbGQucHJvcHMuZGlzYWJsZWQpIHtcbiAgICAgIGFjdGl2ZUtleSA9IGdlbmVyYXRlS2V5KGNoaWxkLmtleSwgaW5kZXgpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBhY3RpdmVLZXk7XG59XG5cbmZ1bmN0aW9uIGFjdGl2ZUtleUlzVmFsaWQocHJvcHMsIGtleSkge1xuICBjb25zdCBrZXlzID0gQ2hpbGRyZW4ubWFwKFxuICAgIHByb3BzLmNoaWxkcmVuLFxuICAgIChjaGlsZCwgaW5kZXgpID0+IGNoaWxkICYmIGdlbmVyYXRlS2V5KGNoaWxkLmtleSwgaW5kZXgpLFxuICApO1xuICByZXR1cm4ga2V5cy5pbmRleE9mKGtleSkgPj0gMDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGFicyBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZGVzdHJveUluYWN0aXZlVGFiUGFuZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgcmVuZGVyVGFiQmFyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHJlbmRlclRhYkNvbnRlbnQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55LFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGFiQmFyUG9zaXRpb246IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgYWN0aXZlS2V5OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGRlZmF1bHRBY3RpdmVLZXk6IFByb3BUeXBlcy5zdHJpbmcsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBwcmVmaXhDbHM6ICdyYy10YWJzJyxcbiAgICBkZXN0cm95SW5hY3RpdmVUYWJQYW5lOiBmYWxzZSxcbiAgICBvbkNoYW5nZTogbm9vcCxcbiAgICB0YWJCYXJQb3NpdGlvbjogJ3RvcCcsXG4gICAgc3R5bGU6IHt9LFxuICB9O1xuXG4gIHN0YXRpYyBUYWJQYW5lID0gVGFiUGFuZTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIGxldCBhY3RpdmVLZXk7XG4gICAgaWYgKCdhY3RpdmVLZXknIGluIHByb3BzKSB7XG4gICAgICBhY3RpdmVLZXkgPSBwcm9wcy5hY3RpdmVLZXk7XG4gICAgfSBlbHNlIGlmICgnZGVmYXVsdEFjdGl2ZUtleScgaW4gcHJvcHMpIHtcbiAgICAgIGFjdGl2ZUtleSA9IHByb3BzLmRlZmF1bHRBY3RpdmVLZXk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjdGl2ZUtleSA9IGdldERlZmF1bHRBY3RpdmVLZXkocHJvcHMpO1xuICAgIH1cblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBhY3RpdmVLZXksXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKCdhY3RpdmVLZXknIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGFjdGl2ZUtleTogbmV4dFByb3BzLmFjdGl2ZUtleSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoIWFjdGl2ZUtleUlzVmFsaWQobmV4dFByb3BzLCB0aGlzLnN0YXRlLmFjdGl2ZUtleSkpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBhY3RpdmVLZXk6IGdldERlZmF1bHRBY3RpdmVLZXkobmV4dFByb3BzKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIG9uVGFiQ2xpY2sgPSBhY3RpdmVLZXkgPT4ge1xuICAgIGlmICh0aGlzLnRhYkJhci5wcm9wcy5vblRhYkNsaWNrKSB7XG4gICAgICB0aGlzLnRhYkJhci5wcm9wcy5vblRhYkNsaWNrKGFjdGl2ZUtleSk7XG4gICAgfVxuICAgIHRoaXMuc2V0QWN0aXZlS2V5KGFjdGl2ZUtleSk7XG4gIH07XG5cbiAgb25OYXZLZXlEb3duID0gZSA9PiB7XG4gICAgY29uc3QgZXZlbnRLZXlDb2RlID0gZS5rZXlDb2RlO1xuICAgIGlmIChldmVudEtleUNvZGUgPT09IEtleUNvZGUuUklHSFQgfHwgZXZlbnRLZXlDb2RlID09PSBLZXlDb2RlLkRPV04pIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IG5leHRLZXkgPSB0aGlzLmdldE5leHRBY3RpdmVLZXkodHJ1ZSk7XG4gICAgICB0aGlzLm9uVGFiQ2xpY2sobmV4dEtleSk7XG4gICAgfSBlbHNlIGlmIChldmVudEtleUNvZGUgPT09IEtleUNvZGUuTEVGVCB8fCBldmVudEtleUNvZGUgPT09IEtleUNvZGUuVVApIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHByZXZpb3VzS2V5ID0gdGhpcy5nZXROZXh0QWN0aXZlS2V5KGZhbHNlKTtcbiAgICAgIHRoaXMub25UYWJDbGljayhwcmV2aW91c0tleSk7XG4gICAgfVxuICB9O1xuXG4gIHNldEFjdGl2ZUtleSA9IGFjdGl2ZUtleSA9PiB7XG4gICAgaWYgKHRoaXMuc3RhdGUuYWN0aXZlS2V5ICE9PSBhY3RpdmVLZXkpIHtcbiAgICAgIGlmICghKCdhY3RpdmVLZXknIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGFjdGl2ZUtleSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKGFjdGl2ZUtleSk7XG4gICAgfVxuICB9O1xuXG4gIGdldE5leHRBY3RpdmVLZXkgPSBuZXh0ID0+IHtcbiAgICBjb25zdCBhY3RpdmVLZXkgPSB0aGlzLnN0YXRlLmFjdGl2ZUtleTtcbiAgICBjb25zdCBjaGlsZHJlbiA9IFtdO1xuICAgIENoaWxkcmVuLmZvckVhY2godGhpcy5wcm9wcy5jaGlsZHJlbiwgYyA9PiB7XG4gICAgICBpZiAoYyAmJiAhYy5wcm9wcy5kaXNhYmxlZCkge1xuICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgIGNoaWxkcmVuLnB1c2goYyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hpbGRyZW4udW5zaGlmdChjKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IGxlbmd0aCA9IGNoaWxkcmVuLmxlbmd0aDtcbiAgICBsZXQgcmV0ID0gbGVuZ3RoICYmIGdlbmVyYXRlS2V5KGNoaWxkcmVuWzBdLmtleSwgMCk7XG4gICAgY2hpbGRyZW4uZm9yRWFjaCgoY2hpbGQsIGkpID0+IHtcbiAgICAgIGlmIChnZW5lcmF0ZUtleShjaGlsZC5rZXksIGkpID09PSBhY3RpdmVLZXkpIHtcbiAgICAgICAgaWYgKGkgPT09IGxlbmd0aCAtIDEpIHtcbiAgICAgICAgICByZXQgPSBnZW5lcmF0ZUtleShjaGlsZHJlblswXS5rZXksIDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldCA9IGdlbmVyYXRlS2V5KGNoaWxkcmVuW2kgKyAxXS5rZXksIGkgKyAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXQ7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICB0YWJCYXJQb3NpdGlvbixcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIHJlbmRlclRhYkNvbnRlbnQsXG4gICAgICByZW5kZXJUYWJCYXIsXG4gICAgICBkZXN0cm95SW5hY3RpdmVUYWJQYW5lLFxuICAgICAgLi4ucmVzdFByb3BzXG4gICAgfSA9IHByb3BzO1xuICAgIGNvbnN0IGNscyA9IGNsYXNzbmFtZXMoe1xuICAgICAgW3ByZWZpeENsc106IDEsXG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke3RhYkJhclBvc2l0aW9ufWBdOiAxLFxuICAgICAgW2NsYXNzTmFtZV06ICEhY2xhc3NOYW1lLFxuICAgIH0pO1xuXG4gICAgdGhpcy50YWJCYXIgPSByZW5kZXJUYWJCYXIoKTtcbiAgICBjb25zdCBjb250ZW50cyA9IFtcbiAgICAgIGNsb25lRWxlbWVudCh0aGlzLnRhYkJhciwge1xuICAgICAgICBwcmVmaXhDbHMsXG4gICAgICAgIGtleTogJ3RhYkJhcicsXG4gICAgICAgIG9uS2V5RG93bjogdGhpcy5vbk5hdktleURvd24sXG4gICAgICAgIHRhYkJhclBvc2l0aW9uLFxuICAgICAgICBvblRhYkNsaWNrOiB0aGlzLm9uVGFiQ2xpY2ssXG4gICAgICAgIHBhbmVsczogcHJvcHMuY2hpbGRyZW4sXG4gICAgICAgIGFjdGl2ZUtleTogdGhpcy5zdGF0ZS5hY3RpdmVLZXksXG4gICAgICB9KSxcbiAgICAgIGNsb25lRWxlbWVudChyZW5kZXJUYWJDb250ZW50KCksIHtcbiAgICAgICAgcHJlZml4Q2xzLFxuICAgICAgICB0YWJCYXJQb3NpdGlvbixcbiAgICAgICAgYWN0aXZlS2V5OiB0aGlzLnN0YXRlLmFjdGl2ZUtleSxcbiAgICAgICAgZGVzdHJveUluYWN0aXZlVGFiUGFuZSxcbiAgICAgICAgY2hpbGRyZW46IHByb3BzLmNoaWxkcmVuLFxuICAgICAgICBvbkNoYW5nZTogdGhpcy5zZXRBY3RpdmVLZXksXG4gICAgICAgIGtleTogJ3RhYkNvbnRlbnQnLFxuICAgICAgfSksXG4gICAgXTtcbiAgICBpZiAodGFiQmFyUG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgICBjb250ZW50cy5yZXZlcnNlKCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17Y2xzfSBzdHlsZT17cHJvcHMuc3R5bGV9IHsuLi5nZXREYXRhQXR0cihyZXN0UHJvcHMpfT5cbiAgICAgICAge2NvbnRlbnRzfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl19