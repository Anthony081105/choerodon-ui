{"version":3,"sources":["uploadlist.test.js"],"names":["delay","timeout","Promise","resolve","setTimeout","fileList","uid","name","status","url","thumbUrl","describe","it","wrapper","forEach","file","i","linkNode","find","at","imgNode","expect","prop","toBe","list","length","simulate","update","hostNodes","done","onChange","render","toMatchSnapshot","successRequest","target","files","filename","errorRequest","handleChange","jest","fn","state","mock","calls","toHaveLength","errors","TestForm","validateFields","props","form","err","getFieldDecorator","handleSubmit","valuePropname","getValueFromEvent","e","rules","required","validator","rule","value","callback","React","Component","App","Form","create","toEqual","message","field","toBeNull","handlePreview","toHaveBeenCalledWith","handleRemove","newFileList","newFile","originFileObj","File","push","setState","not"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { mount } from 'enzyme';\nimport Upload from '..';\nimport Form from '../../form';\nimport { errorRequest, successRequest } from './requests';\n\nconst delay = timeout => new Promise(resolve => setTimeout(resolve, timeout));\n\nconst fileList = [\n  {\n    uid: -1,\n    name: 'xxx.png',\n    status: 'done',\n    url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\n    thumbUrl: 'https://zos.alipayobjects.com/rmsportal/IQKRngzUuFzJzGzRJXUs.png',\n  },\n  {\n    uid: -2,\n    name: 'yyy.png',\n    status: 'done',\n    url: 'https://zos.alipayobjects.com/rmsportal/IQKRngzUuFzJzGzRJXUs.png',\n    thumbUrl: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\n  },\n];\n\ndescribe('Upload List', () => {\n  it('should use file.thumbUrl for <img /> in priority', () => {\n    const wrapper = mount(\n      <Upload defaultFileList={fileList} listType=\"picture\">\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    fileList.forEach((file, i) => {\n      const linkNode = wrapper.find('.c7n-upload-list-item-thumbnail').at(i);\n      const imgNode = wrapper.find('.c7n-upload-list-item-thumbnail img').at(i);\n      expect(linkNode.prop('href')).toBe(file.url);\n      expect(imgNode.prop('src')).toBe(file.thumbUrl);\n    });\n  });\n\n  it('should remove correct item when uid is 0', async () => {\n    const list = [\n      {\n        uid: 0,\n        name: 'xxx.png',\n        status: 'done',\n        url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\n        thumbUrl: 'https://zos.alipayobjects.com/rmsportal/IQKRngzUuFzJzGzRJXUs.png',\n      },\n      {\n        uid: 1,\n        name: 'xxx.png',\n        status: 'done',\n        url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\n        thumbUrl: 'https://zos.alipayobjects.com/rmsportal/IQKRngzUuFzJzGzRJXUs.png',\n      },\n    ];\n    const wrapper = mount(\n      <Upload defaultFileList={list}>\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    expect(wrapper.find('.c7n-upload-list-item').length).toBe(2);\n    wrapper\n      .find('.c7n-upload-list-item')\n      .at(0)\n      .find('.icon-close')\n      .simulate('click');\n    await delay(400);\n    wrapper.update();\n    expect(wrapper.find('.c7n-upload-list-item').hostNodes().length).toBe(1);\n  });\n\n  it('should be uploading when upload a file', done => {\n    let wrapper;\n    const onChange = ({ file }) => {\n      if (file.status === 'uploading') {\n        expect(wrapper.render()).toMatchSnapshot();\n      }\n      if (file.status === 'done') {\n        expect(wrapper.render()).toMatchSnapshot();\n        done();\n      }\n    };\n    wrapper = mount(\n      <Upload\n        action=\"http://jsonplaceholder.typicode.com/posts/\"\n        onChange={onChange}\n        customRequest={successRequest}\n      >\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    wrapper.find('input').simulate('change', {\n      target: {\n        files: [{ filename: 'foo.png' }],\n      },\n    });\n  });\n\n  it('handle error', done => {\n    let wrapper;\n    const onChange = ({ file }) => {\n      if (file.status !== 'uploading') {\n        expect(wrapper.render()).toMatchSnapshot();\n        done();\n      }\n    };\n    wrapper = mount(\n      <Upload\n        action=\"http://jsonplaceholder.typicode.com/posts/\"\n        onChange={onChange}\n        customRequest={errorRequest}\n      >\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    wrapper.find('input').simulate('change', {\n      target: {\n        files: [{ filename: 'foo.png' }],\n      },\n    });\n  });\n\n  it('does concat filelist when beforeUpload returns false', () => {\n    const handleChange = jest.fn();\n    const wrapper = mount(\n      <Upload\n        listType=\"picture\"\n        defaultFileList={fileList}\n        onChange={handleChange}\n        beforeUpload={() => false}\n      >\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n\n    wrapper.find('input').simulate('change', {\n      target: {\n        files: [{ filename: 'foo.png' }],\n      },\n    });\n\n    expect(wrapper.state().fileList.length).toBe(fileList.length + 1);\n    expect(handleChange.mock.calls[0][0].fileList).toHaveLength(3);\n  });\n\n  it('work with form validation', () => {\n    let errors;\n    class TestForm extends React.Component {\n      handleSubmit = () => {\n        const {\n          form: { validateFields },\n        } = this.props;\n        validateFields(err => {\n          errors = err;\n        });\n      };\n\n      render() {\n        const {\n          form: { getFieldDecorator },\n        } = this.props;\n\n        return (\n          <Form onSubmit={this.handleSubmit}>\n            <Form.Item>\n              {getFieldDecorator('file', {\n                valuePropname: 'fileList',\n                getValueFromEvent: e => e.fileList,\n                rules: [\n                  {\n                    required: true,\n                    validator: (rule, value, callback) => {\n                      if (!value || value.length === 0) {\n                        callback('file required');\n                      } else {\n                        callback();\n                      }\n                    },\n                  },\n                ],\n              })(\n                <Upload beforeUpload={() => false}>\n                  <button type=\"button\">upload</button>\n                </Upload>,\n              )}\n            </Form.Item>\n          </Form>\n        );\n      }\n    }\n\n    const App = Form.create()(TestForm);\n    const wrapper = mount(<App />);\n    wrapper.find(Form).simulate('submit');\n    expect(errors.file.errors).toEqual([{ message: 'file required', field: 'file' }]);\n\n    wrapper.find('input').simulate('change', {\n      target: {\n        files: [{ filename: 'foo.png' }],\n      },\n    });\n    wrapper.find(Form).simulate('submit');\n    expect(errors).toBeNull();\n  });\n\n  it('should support onPreview', () => {\n    const handlePreview = jest.fn();\n    const wrapper = mount(\n      <Upload listType=\"picture-card\" defaultFileList={fileList} onPreview={handlePreview}>\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    wrapper\n      .find('.icon-visibility')\n      .at(0)\n      .simulate('click');\n    expect(handlePreview).toHaveBeenCalledWith(fileList[0]);\n    wrapper\n      .find('.icon-visibility')\n      .at(1)\n      .simulate('click');\n    expect(handlePreview).toHaveBeenCalledWith(fileList[1]);\n  });\n\n  it('should support onRemove', async () => {\n    const handleRemove = jest.fn();\n    const handleChange = jest.fn();\n    const wrapper = mount(\n      <Upload\n        listType=\"picture-card\"\n        defaultFileList={fileList}\n        onRemove={handleRemove}\n        onChange={handleChange}\n      >\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    wrapper\n      .find('.icon-delete')\n      .at(0)\n      .simulate('click');\n    expect(handleRemove).toHaveBeenCalledWith(fileList[0]);\n    wrapper\n      .find('.icon-delete')\n      .at(1)\n      .simulate('click');\n    expect(handleRemove).toHaveBeenCalledWith(fileList[1]);\n    await delay(0);\n    expect(handleChange.mock.calls.length).toBe(2);\n  });\n\n  it('should generate thumbUrl from file', async () => {\n    const handlePreview = jest.fn();\n    const newFileList = [...fileList];\n    const newFile = { ...fileList[0], uid: -3, originFileObj: new File([], 'xxx.png') };\n    delete newFile.thumbUrl;\n    newFileList.push(newFile);\n    const wrapper = mount(\n      <Upload listType=\"picture-card\" defaultFileList={newFileList} onPreview={handlePreview}>\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    wrapper.setState({});\n    await delay(20);\n    expect(wrapper.state().fileList[2].thumbUrl).not.toBe('');\n  });\n\n  it('should non-image format file preview', () => {\n    const list = [\n      {\n        ...fileList[0],\n        uid: -3,\n        url: 'https://cdn.xxx.com/aaa.zip',\n        thumbUrl: 'data:application/zip;base64,UEsDBAoAAAAAADYZYkwAAAAAAAAAAAAAAAAdAAk',\n        originFileObj: new File([], 'aaa.zip'),\n      },\n    ];\n\n    const wrapper = mount(\n      <Upload listType=\"picture\" defaultFileList={list}>\n        <button type=\"button\">upload</button>\n      </Upload>,\n    );\n    expect(wrapper.render()).toMatchSnapshot();\n  });\n});\n"]}