3700fdff2829a855c31a583e31e73236
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _createReactClass = _interopRequireDefault(require("create-react-class"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _KeyCode = _interopRequireDefault(require("../../_util/KeyCode"));

var _DateTable = _interopRequireDefault(require("./date/DateTable"));

var _CalendarHeader = _interopRequireDefault(require("./calendar/CalendarHeader"));

var _CalendarFooter = _interopRequireDefault(require("./calendar/CalendarFooter"));

var _CalendarMixin = _interopRequireDefault(require("./mixin/CalendarMixin"));

var _CommonMixin = _interopRequireDefault(require("./mixin/CommonMixin"));

var _DateInput = _interopRequireDefault(require("./date/DateInput"));

var _util = require("./util");

function goStartMonth() {
  var next = this.state.value.clone();
  next.startOf('month');
  this.setValue(next);
}

function goEndMonth() {
  var next = this.state.value.clone();
  next.endOf('month');
  this.setValue(next);
}

function goTime(direction, unit) {
  var next = this.state.value.clone();
  next.add(direction, unit);
  this.setValue(next);
}

function goMonth(direction) {
  return goTime.call(this, direction, 'months');
}

function goYear(direction) {
  return goTime.call(this, direction, 'years');
}

function goWeek(direction) {
  return goTime.call(this, direction, 'weeks');
}

function goDay(direction) {
  return goTime.call(this, direction, 'days');
}

var Calendar = (0, _createReactClass["default"])({
  displayName: "Calendar",
  propTypes: {
    prefixCls: _propTypes["default"].string,
    className: _propTypes["default"].string,
    style: _propTypes["default"].object,
    defaultValue: _propTypes["default"].object,
    value: _propTypes["default"].object,
    selectedValue: _propTypes["default"].object,
    mode: _propTypes["default"].oneOf(['time', 'date', 'month', 'year', 'decade']),
    locale: _propTypes["default"].object,
    showDateInput: _propTypes["default"].bool,
    showWeekNumber: _propTypes["default"].bool,
    showToday: _propTypes["default"].bool,
    showOk: _propTypes["default"].bool,
    onSelect: _propTypes["default"].func,
    onOk: _propTypes["default"].func,
    onKeyDown: _propTypes["default"].func,
    timePicker: _propTypes["default"].element,
    dateInputPlaceholder: _propTypes["default"].any,
    onClear: _propTypes["default"].func,
    onChange: _propTypes["default"].func,
    onPanelChange: _propTypes["default"].func,
    disabledDate: _propTypes["default"].func,
    disabledTime: _propTypes["default"].any,
    renderFooter: _propTypes["default"].func,
    renderSidebar: _propTypes["default"].func
  },
  mixins: [_CommonMixin["default"], _CalendarMixin["default"]],
  getDefaultProps: function getDefaultProps() {
    return {
      showToday: true,
      showDateInput: true,
      timePicker: null,
      onOk: _noop["default"],
      onPanelChange: _noop["default"]
    };
  },
  getInitialState: function getInitialState() {
    return {
      mode: this.props.mode || 'date'
    };
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    if ('mode' in nextProps && this.state.mode !== nextProps.mode) {
      this.setState({
        mode: nextProps.mode
      });
    }
  },
  onKeyDown: function onKeyDown(event) {
    if (event.target.nodeName.toLowerCase() === 'input') {
      return undefined;
    }

    var keyCode = event.keyCode; // mac

    var ctrlKey = event.ctrlKey || event.metaKey;
    var disabledDate = this.props.disabledDate;
    var value = this.state.value;

    switch (keyCode) {
      case _KeyCode["default"].DOWN:
        goWeek.call(this, 1);
        event.preventDefault();
        return 1;

      case _KeyCode["default"].UP:
        goWeek.call(this, -1);
        event.preventDefault();
        return 1;

      case _KeyCode["default"].LEFT:
        if (ctrlKey) {
          goYear.call(this, -1);
        } else {
          goDay.call(this, -1);
        }

        event.preventDefault();
        return 1;

      case _KeyCode["default"].RIGHT:
        if (ctrlKey) {
          goYear.call(this, 1);
        } else {
          goDay.call(this, 1);
        }

        event.preventDefault();
        return 1;

      case _KeyCode["default"].HOME:
        goStartMonth.call(this);
        event.preventDefault();
        return 1;

      case _KeyCode["default"].END:
        goEndMonth.call(this);
        event.preventDefault();
        return 1;

      case _KeyCode["default"].PAGE_DOWN:
        goMonth.call(this, 1);
        event.preventDefault();
        return 1;

      case _KeyCode["default"].PAGE_UP:
        goMonth.call(this, -1);
        event.preventDefault();
        return 1;

      case _KeyCode["default"].ENTER:
        if (!disabledDate || !disabledDate(value)) {
          this.onSelect(value, {
            source: 'keyboard'
          });
        }

        event.preventDefault();
        return 1;

      default:
        this.props.onKeyDown(event);
        return 1;
    }
  },
  onClear: function onClear() {
    this.onSelect(null);
    this.props.onClear();
  },
  onOk: function onOk() {
    var selectedValue = this.state.selectedValue;

    if (this.isAllowedDate(selectedValue)) {
      this.props.onOk(selectedValue);
    }
  },
  onDateInputChange: function onDateInputChange(value) {
    this.onSelect(value, {
      source: 'dateInput'
    });
  },
  onDateTableSelect: function onDateTableSelect(value) {
    var timePicker = this.props.timePicker;
    var selectedValue = this.state.selectedValue;

    if (!selectedValue && timePicker) {
      var timePickerDefaultValue = timePicker.props.defaultValue;

      if (timePickerDefaultValue) {
        (0, _util.syncTime)(timePickerDefaultValue, value);
      }
    }

    this.onSelect(value);
  },
  onToday: function onToday() {
    var value = this.state.value;
    var now = (0, _util.getTodayTime)(value);
    this.onSelect(now, {
      source: 'todayButton'
    });
  },
  onPanelChange: function onPanelChange(value, mode) {
    var props = this.props,
        state = this.state;

    if (!('mode' in props)) {
      this.setState({
        mode: mode
      });
    }

    props.onPanelChange(value || state.value, mode);
  },
  getRootDOMNode: function getRootDOMNode() {
    return _reactDom["default"].findDOMNode(this);
  },
  openTimePicker: function openTimePicker() {
    this.onPanelChange(null, 'time');
  },
  closeTimePicker: function closeTimePicker() {
    this.onPanelChange(null, 'date');
  },
  render: function render() {
    var props = this.props,
        state = this.state;
    var locale = props.locale,
        prefixCls = props.prefixCls,
        disabledDate = props.disabledDate,
        dateInputPlaceholder = props.dateInputPlaceholder,
        timePicker = props.timePicker,
        disabledTime = props.disabledTime;
    var value = state.value,
        selectedValue = state.selectedValue,
        mode = state.mode;
    var showTimePicker = mode === 'time';
    var disabledTimeConfig = showTimePicker && disabledTime && timePicker ? (0, _util.getTimeConfig)(selectedValue, disabledTime) : null;
    var timePickerEle = null;

    if (timePicker && showTimePicker) {
      var timePickerProps = (0, _objectSpread2["default"])({
        showHour: true,
        showSecond: true,
        showMinute: true
      }, timePicker.props, {}, disabledTimeConfig, {
        onChange: this.onDateInputChange,
        value: selectedValue,
        disabledTime: disabledTime
      });

      if (timePicker.props.defaultValue !== undefined) {
        timePickerProps.defaultOpenValue = timePicker.props.defaultValue;
      }

      timePickerEle = (0, _react.cloneElement)(timePicker, timePickerProps);
    }

    var dateInputElement = props.showDateInput ? _react["default"].createElement(_DateInput["default"], {
      format: this.getFormat(),
      key: "date-input",
      value: value,
      locale: locale,
      placeholder: dateInputPlaceholder,
      showClear: true,
      disabledTime: disabledTime,
      disabledDate: disabledDate,
      onClear: this.onClear,
      prefixCls: prefixCls,
      selectedValue: selectedValue,
      onChange: this.onDateInputChange
    }) : null;
    var children = [props.renderSidebar(), _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-panel"),
      key: "panel"
    }, dateInputElement, _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-date-panel")
    }, _react["default"].createElement(_CalendarHeader["default"], {
      locale: locale,
      mode: mode,
      value: value,
      onValueChange: this.setValue,
      onPanelChange: this.onPanelChange,
      showTimePicker: showTimePicker,
      prefixCls: prefixCls
    }), timePicker && showTimePicker ? _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-time-picker")
    }, _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-time-picker-panel")
    }, timePickerEle)) : null, _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-body")
    }, _react["default"].createElement(_DateTable["default"], {
      locale: locale,
      value: value,
      selectedValue: selectedValue,
      prefixCls: prefixCls,
      dateRender: props.dateRender,
      onSelect: this.onDateTableSelect,
      disabledDate: disabledDate,
      showWeekNumber: props.showWeekNumber
    })), _react["default"].createElement(_CalendarFooter["default"], {
      showOk: props.showOk,
      renderFooter: props.renderFooter,
      locale: locale,
      prefixCls: prefixCls,
      showToday: props.showToday,
      disabledTime: disabledTime,
      showTimePicker: showTimePicker,
      showDateInput: props.showDateInput,
      timePicker: timePicker,
      selectedValue: selectedValue,
      value: value,
      disabledDate: disabledDate,
      okDisabled: !this.isAllowedDate(selectedValue),
      onOk: this.onOk,
      onSelect: this.onSelect,
      onToday: this.onToday,
      onOpenTimePicker: this.openTimePicker,
      onCloseTimePicker: this.closeTimePicker
    })))];
    return this.renderRoot({
      children: children,
      className: props.showWeekNumber ? "".concat(prefixCls, "-week-number") : ''
    });
  }
});
var _default = Calendar;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbGVuZGFyLmpzeCJdLCJuYW1lcyI6WyJnb1N0YXJ0TW9udGgiLCJuZXh0Iiwic3RhdGUiLCJ2YWx1ZSIsImNsb25lIiwic3RhcnRPZiIsInNldFZhbHVlIiwiZ29FbmRNb250aCIsImVuZE9mIiwiZ29UaW1lIiwiZGlyZWN0aW9uIiwidW5pdCIsImFkZCIsImdvTW9udGgiLCJjYWxsIiwiZ29ZZWFyIiwiZ29XZWVrIiwiZ29EYXkiLCJDYWxlbmRhciIsInByb3BUeXBlcyIsInByZWZpeENscyIsIlByb3BUeXBlcyIsInN0cmluZyIsImNsYXNzTmFtZSIsInN0eWxlIiwib2JqZWN0IiwiZGVmYXVsdFZhbHVlIiwic2VsZWN0ZWRWYWx1ZSIsIm1vZGUiLCJvbmVPZiIsImxvY2FsZSIsInNob3dEYXRlSW5wdXQiLCJib29sIiwic2hvd1dlZWtOdW1iZXIiLCJzaG93VG9kYXkiLCJzaG93T2siLCJvblNlbGVjdCIsImZ1bmMiLCJvbk9rIiwib25LZXlEb3duIiwidGltZVBpY2tlciIsImVsZW1lbnQiLCJkYXRlSW5wdXRQbGFjZWhvbGRlciIsImFueSIsIm9uQ2xlYXIiLCJvbkNoYW5nZSIsIm9uUGFuZWxDaGFuZ2UiLCJkaXNhYmxlZERhdGUiLCJkaXNhYmxlZFRpbWUiLCJyZW5kZXJGb290ZXIiLCJyZW5kZXJTaWRlYmFyIiwibWl4aW5zIiwiQ29tbW9uTWl4aW4iLCJDYWxlbmRhck1peGluIiwiZ2V0RGVmYXVsdFByb3BzIiwibm9vcCIsImdldEluaXRpYWxTdGF0ZSIsInByb3BzIiwiY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5leHRQcm9wcyIsInNldFN0YXRlIiwiZXZlbnQiLCJ0YXJnZXQiLCJub2RlTmFtZSIsInRvTG93ZXJDYXNlIiwidW5kZWZpbmVkIiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5IiwiS2V5Q29kZSIsIkRPV04iLCJwcmV2ZW50RGVmYXVsdCIsIlVQIiwiTEVGVCIsIlJJR0hUIiwiSE9NRSIsIkVORCIsIlBBR0VfRE9XTiIsIlBBR0VfVVAiLCJFTlRFUiIsInNvdXJjZSIsImlzQWxsb3dlZERhdGUiLCJvbkRhdGVJbnB1dENoYW5nZSIsIm9uRGF0ZVRhYmxlU2VsZWN0IiwidGltZVBpY2tlckRlZmF1bHRWYWx1ZSIsIm9uVG9kYXkiLCJub3ciLCJnZXRSb290RE9NTm9kZSIsIlJlYWN0RE9NIiwiZmluZERPTU5vZGUiLCJvcGVuVGltZVBpY2tlciIsImNsb3NlVGltZVBpY2tlciIsInJlbmRlciIsInNob3dUaW1lUGlja2VyIiwiZGlzYWJsZWRUaW1lQ29uZmlnIiwidGltZVBpY2tlckVsZSIsInRpbWVQaWNrZXJQcm9wcyIsInNob3dIb3VyIiwic2hvd1NlY29uZCIsInNob3dNaW51dGUiLCJkZWZhdWx0T3BlblZhbHVlIiwiZGF0ZUlucHV0RWxlbWVudCIsImdldEZvcm1hdCIsImNoaWxkcmVuIiwiZGF0ZVJlbmRlciIsInJlbmRlclJvb3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxTQUFTQSxZQUFULEdBQXdCO0FBQ3RCLE1BQU1DLElBQUksR0FBRyxLQUFLQyxLQUFMLENBQVdDLEtBQVgsQ0FBaUJDLEtBQWpCLEVBQWI7QUFDQUgsRUFBQUEsSUFBSSxDQUFDSSxPQUFMLENBQWEsT0FBYjtBQUNBLE9BQUtDLFFBQUwsQ0FBY0wsSUFBZDtBQUNEOztBQUVELFNBQVNNLFVBQVQsR0FBc0I7QUFDcEIsTUFBTU4sSUFBSSxHQUFHLEtBQUtDLEtBQUwsQ0FBV0MsS0FBWCxDQUFpQkMsS0FBakIsRUFBYjtBQUNBSCxFQUFBQSxJQUFJLENBQUNPLEtBQUwsQ0FBVyxPQUFYO0FBQ0EsT0FBS0YsUUFBTCxDQUFjTCxJQUFkO0FBQ0Q7O0FBRUQsU0FBU1EsTUFBVCxDQUFnQkMsU0FBaEIsRUFBMkJDLElBQTNCLEVBQWlDO0FBQy9CLE1BQU1WLElBQUksR0FBRyxLQUFLQyxLQUFMLENBQVdDLEtBQVgsQ0FBaUJDLEtBQWpCLEVBQWI7QUFDQUgsRUFBQUEsSUFBSSxDQUFDVyxHQUFMLENBQVNGLFNBQVQsRUFBb0JDLElBQXBCO0FBQ0EsT0FBS0wsUUFBTCxDQUFjTCxJQUFkO0FBQ0Q7O0FBRUQsU0FBU1ksT0FBVCxDQUFpQkgsU0FBakIsRUFBNEI7QUFDMUIsU0FBT0QsTUFBTSxDQUFDSyxJQUFQLENBQVksSUFBWixFQUFrQkosU0FBbEIsRUFBNkIsUUFBN0IsQ0FBUDtBQUNEOztBQUVELFNBQVNLLE1BQVQsQ0FBZ0JMLFNBQWhCLEVBQTJCO0FBQ3pCLFNBQU9ELE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLElBQVosRUFBa0JKLFNBQWxCLEVBQTZCLE9BQTdCLENBQVA7QUFDRDs7QUFFRCxTQUFTTSxNQUFULENBQWdCTixTQUFoQixFQUEyQjtBQUN6QixTQUFPRCxNQUFNLENBQUNLLElBQVAsQ0FBWSxJQUFaLEVBQWtCSixTQUFsQixFQUE2QixPQUE3QixDQUFQO0FBQ0Q7O0FBRUQsU0FBU08sS0FBVCxDQUFlUCxTQUFmLEVBQTBCO0FBQ3hCLFNBQU9ELE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLElBQVosRUFBa0JKLFNBQWxCLEVBQTZCLE1BQTdCLENBQVA7QUFDRDs7QUFFRCxJQUFNUSxRQUFRLEdBQUcsa0NBQWlCO0FBQUE7QUFDaENDLEVBQUFBLFNBQVMsRUFBRTtBQUNUQyxJQUFBQSxTQUFTLEVBQUVDLHNCQUFVQyxNQURaO0FBRVRDLElBQUFBLFNBQVMsRUFBRUYsc0JBQVVDLE1BRlo7QUFHVEUsSUFBQUEsS0FBSyxFQUFFSCxzQkFBVUksTUFIUjtBQUlUQyxJQUFBQSxZQUFZLEVBQUVMLHNCQUFVSSxNQUpmO0FBS1R0QixJQUFBQSxLQUFLLEVBQUVrQixzQkFBVUksTUFMUjtBQU1URSxJQUFBQSxhQUFhLEVBQUVOLHNCQUFVSSxNQU5oQjtBQU9URyxJQUFBQSxJQUFJLEVBQUVQLHNCQUFVUSxLQUFWLENBQWdCLENBQUMsTUFBRCxFQUFTLE1BQVQsRUFBaUIsT0FBakIsRUFBMEIsTUFBMUIsRUFBa0MsUUFBbEMsQ0FBaEIsQ0FQRztBQVFUQyxJQUFBQSxNQUFNLEVBQUVULHNCQUFVSSxNQVJUO0FBU1RNLElBQUFBLGFBQWEsRUFBRVYsc0JBQVVXLElBVGhCO0FBVVRDLElBQUFBLGNBQWMsRUFBRVosc0JBQVVXLElBVmpCO0FBV1RFLElBQUFBLFNBQVMsRUFBRWIsc0JBQVVXLElBWFo7QUFZVEcsSUFBQUEsTUFBTSxFQUFFZCxzQkFBVVcsSUFaVDtBQWFUSSxJQUFBQSxRQUFRLEVBQUVmLHNCQUFVZ0IsSUFiWDtBQWNUQyxJQUFBQSxJQUFJLEVBQUVqQixzQkFBVWdCLElBZFA7QUFlVEUsSUFBQUEsU0FBUyxFQUFFbEIsc0JBQVVnQixJQWZaO0FBZ0JURyxJQUFBQSxVQUFVLEVBQUVuQixzQkFBVW9CLE9BaEJiO0FBaUJUQyxJQUFBQSxvQkFBb0IsRUFBRXJCLHNCQUFVc0IsR0FqQnZCO0FBa0JUQyxJQUFBQSxPQUFPLEVBQUV2QixzQkFBVWdCLElBbEJWO0FBbUJUUSxJQUFBQSxRQUFRLEVBQUV4QixzQkFBVWdCLElBbkJYO0FBb0JUUyxJQUFBQSxhQUFhLEVBQUV6QixzQkFBVWdCLElBcEJoQjtBQXFCVFUsSUFBQUEsWUFBWSxFQUFFMUIsc0JBQVVnQixJQXJCZjtBQXNCVFcsSUFBQUEsWUFBWSxFQUFFM0Isc0JBQVVzQixHQXRCZjtBQXVCVE0sSUFBQUEsWUFBWSxFQUFFNUIsc0JBQVVnQixJQXZCZjtBQXdCVGEsSUFBQUEsYUFBYSxFQUFFN0Isc0JBQVVnQjtBQXhCaEIsR0FEcUI7QUE0QmhDYyxFQUFBQSxNQUFNLEVBQUUsQ0FBQ0MsdUJBQUQsRUFBY0MseUJBQWQsQ0E1QndCO0FBOEJoQ0MsRUFBQUEsZUE5QmdDLDZCQThCZDtBQUNoQixXQUFPO0FBQ0xwQixNQUFBQSxTQUFTLEVBQUUsSUFETjtBQUVMSCxNQUFBQSxhQUFhLEVBQUUsSUFGVjtBQUdMUyxNQUFBQSxVQUFVLEVBQUUsSUFIUDtBQUlMRixNQUFBQSxJQUFJLEVBQUVpQixnQkFKRDtBQUtMVCxNQUFBQSxhQUFhLEVBQUVTO0FBTFYsS0FBUDtBQU9ELEdBdEMrQjtBQXVDaENDLEVBQUFBLGVBdkNnQyw2QkF1Q2Q7QUFDaEIsV0FBTztBQUNMNUIsTUFBQUEsSUFBSSxFQUFFLEtBQUs2QixLQUFMLENBQVc3QixJQUFYLElBQW1CO0FBRHBCLEtBQVA7QUFHRCxHQTNDK0I7QUE0Q2hDOEIsRUFBQUEseUJBNUNnQyxxQ0E0Q05DLFNBNUNNLEVBNENLO0FBQ25DLFFBQUksVUFBVUEsU0FBVixJQUF1QixLQUFLekQsS0FBTCxDQUFXMEIsSUFBWCxLQUFvQitCLFNBQVMsQ0FBQy9CLElBQXpELEVBQStEO0FBQzdELFdBQUtnQyxRQUFMLENBQWM7QUFBRWhDLFFBQUFBLElBQUksRUFBRStCLFNBQVMsQ0FBQy9CO0FBQWxCLE9BQWQ7QUFDRDtBQUNGLEdBaEQrQjtBQWlEaENXLEVBQUFBLFNBakRnQyxxQkFpRHRCc0IsS0FqRHNCLEVBaURmO0FBQ2YsUUFBSUEsS0FBSyxDQUFDQyxNQUFOLENBQWFDLFFBQWIsQ0FBc0JDLFdBQXRCLE9BQXdDLE9BQTVDLEVBQXFEO0FBQ25ELGFBQU9DLFNBQVA7QUFDRDs7QUFDRCxRQUFNQyxPQUFPLEdBQUdMLEtBQUssQ0FBQ0ssT0FBdEIsQ0FKZSxDQUtmOztBQUNBLFFBQU1DLE9BQU8sR0FBR04sS0FBSyxDQUFDTSxPQUFOLElBQWlCTixLQUFLLENBQUNPLE9BQXZDO0FBTmUsUUFPUHJCLFlBUE8sR0FPVSxLQUFLVSxLQVBmLENBT1BWLFlBUE87QUFBQSxRQVFQNUMsS0FSTyxHQVFHLEtBQUtELEtBUlIsQ0FRUEMsS0FSTzs7QUFTZixZQUFRK0QsT0FBUjtBQUNFLFdBQUtHLG9CQUFRQyxJQUFiO0FBQ0V0RCxRQUFBQSxNQUFNLENBQUNGLElBQVAsQ0FBWSxJQUFaLEVBQWtCLENBQWxCO0FBQ0ErQyxRQUFBQSxLQUFLLENBQUNVLGNBQU47QUFDQSxlQUFPLENBQVA7O0FBQ0YsV0FBS0Ysb0JBQVFHLEVBQWI7QUFDRXhELFFBQUFBLE1BQU0sQ0FBQ0YsSUFBUCxDQUFZLElBQVosRUFBa0IsQ0FBQyxDQUFuQjtBQUNBK0MsUUFBQUEsS0FBSyxDQUFDVSxjQUFOO0FBQ0EsZUFBTyxDQUFQOztBQUNGLFdBQUtGLG9CQUFRSSxJQUFiO0FBQ0UsWUFBSU4sT0FBSixFQUFhO0FBQ1hwRCxVQUFBQSxNQUFNLENBQUNELElBQVAsQ0FBWSxJQUFaLEVBQWtCLENBQUMsQ0FBbkI7QUFDRCxTQUZELE1BRU87QUFDTEcsVUFBQUEsS0FBSyxDQUFDSCxJQUFOLENBQVcsSUFBWCxFQUFpQixDQUFDLENBQWxCO0FBQ0Q7O0FBQ0QrQyxRQUFBQSxLQUFLLENBQUNVLGNBQU47QUFDQSxlQUFPLENBQVA7O0FBQ0YsV0FBS0Ysb0JBQVFLLEtBQWI7QUFDRSxZQUFJUCxPQUFKLEVBQWE7QUFDWHBELFVBQUFBLE1BQU0sQ0FBQ0QsSUFBUCxDQUFZLElBQVosRUFBa0IsQ0FBbEI7QUFDRCxTQUZELE1BRU87QUFDTEcsVUFBQUEsS0FBSyxDQUFDSCxJQUFOLENBQVcsSUFBWCxFQUFpQixDQUFqQjtBQUNEOztBQUNEK0MsUUFBQUEsS0FBSyxDQUFDVSxjQUFOO0FBQ0EsZUFBTyxDQUFQOztBQUNGLFdBQUtGLG9CQUFRTSxJQUFiO0FBQ0UzRSxRQUFBQSxZQUFZLENBQUNjLElBQWIsQ0FBa0IsSUFBbEI7QUFDQStDLFFBQUFBLEtBQUssQ0FBQ1UsY0FBTjtBQUNBLGVBQU8sQ0FBUDs7QUFDRixXQUFLRixvQkFBUU8sR0FBYjtBQUNFckUsUUFBQUEsVUFBVSxDQUFDTyxJQUFYLENBQWdCLElBQWhCO0FBQ0ErQyxRQUFBQSxLQUFLLENBQUNVLGNBQU47QUFDQSxlQUFPLENBQVA7O0FBQ0YsV0FBS0Ysb0JBQVFRLFNBQWI7QUFDRWhFLFFBQUFBLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLElBQWIsRUFBbUIsQ0FBbkI7QUFDQStDLFFBQUFBLEtBQUssQ0FBQ1UsY0FBTjtBQUNBLGVBQU8sQ0FBUDs7QUFDRixXQUFLRixvQkFBUVMsT0FBYjtBQUNFakUsUUFBQUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsSUFBYixFQUFtQixDQUFDLENBQXBCO0FBQ0ErQyxRQUFBQSxLQUFLLENBQUNVLGNBQU47QUFDQSxlQUFPLENBQVA7O0FBQ0YsV0FBS0Ysb0JBQVFVLEtBQWI7QUFDRSxZQUFJLENBQUNoQyxZQUFELElBQWlCLENBQUNBLFlBQVksQ0FBQzVDLEtBQUQsQ0FBbEMsRUFBMkM7QUFDekMsZUFBS2lDLFFBQUwsQ0FBY2pDLEtBQWQsRUFBcUI7QUFDbkI2RSxZQUFBQSxNQUFNLEVBQUU7QUFEVyxXQUFyQjtBQUdEOztBQUNEbkIsUUFBQUEsS0FBSyxDQUFDVSxjQUFOO0FBQ0EsZUFBTyxDQUFQOztBQUNGO0FBQ0UsYUFBS2QsS0FBTCxDQUFXbEIsU0FBWCxDQUFxQnNCLEtBQXJCO0FBQ0EsZUFBTyxDQUFQO0FBbkRKO0FBcURELEdBL0crQjtBQWlIaENqQixFQUFBQSxPQWpIZ0MscUJBaUh0QjtBQUNSLFNBQUtSLFFBQUwsQ0FBYyxJQUFkO0FBQ0EsU0FBS3FCLEtBQUwsQ0FBV2IsT0FBWDtBQUNELEdBcEgrQjtBQXNIaENOLEVBQUFBLElBdEhnQyxrQkFzSHpCO0FBQUEsUUFDR1gsYUFESCxHQUNxQixLQUFLekIsS0FEMUIsQ0FDR3lCLGFBREg7O0FBRUwsUUFBSSxLQUFLc0QsYUFBTCxDQUFtQnRELGFBQW5CLENBQUosRUFBdUM7QUFDckMsV0FBSzhCLEtBQUwsQ0FBV25CLElBQVgsQ0FBZ0JYLGFBQWhCO0FBQ0Q7QUFDRixHQTNIK0I7QUE2SGhDdUQsRUFBQUEsaUJBN0hnQyw2QkE2SGQvRSxLQTdIYyxFQTZIUDtBQUN2QixTQUFLaUMsUUFBTCxDQUFjakMsS0FBZCxFQUFxQjtBQUNuQjZFLE1BQUFBLE1BQU0sRUFBRTtBQURXLEtBQXJCO0FBR0QsR0FqSStCO0FBa0loQ0csRUFBQUEsaUJBbElnQyw2QkFrSWRoRixLQWxJYyxFQWtJUDtBQUFBLFFBQ2ZxQyxVQURlLEdBQ0EsS0FBS2lCLEtBREwsQ0FDZmpCLFVBRGU7QUFBQSxRQUVmYixhQUZlLEdBRUcsS0FBS3pCLEtBRlIsQ0FFZnlCLGFBRmU7O0FBR3ZCLFFBQUksQ0FBQ0EsYUFBRCxJQUFrQmEsVUFBdEIsRUFBa0M7QUFDaEMsVUFBTTRDLHNCQUFzQixHQUFHNUMsVUFBVSxDQUFDaUIsS0FBWCxDQUFpQi9CLFlBQWhEOztBQUNBLFVBQUkwRCxzQkFBSixFQUE0QjtBQUMxQiw0QkFBU0Esc0JBQVQsRUFBaUNqRixLQUFqQztBQUNEO0FBQ0Y7O0FBQ0QsU0FBS2lDLFFBQUwsQ0FBY2pDLEtBQWQ7QUFDRCxHQTVJK0I7QUE2SWhDa0YsRUFBQUEsT0E3SWdDLHFCQTZJdEI7QUFBQSxRQUNBbEYsS0FEQSxHQUNVLEtBQUtELEtBRGYsQ0FDQUMsS0FEQTtBQUVSLFFBQU1tRixHQUFHLEdBQUcsd0JBQWFuRixLQUFiLENBQVo7QUFDQSxTQUFLaUMsUUFBTCxDQUFja0QsR0FBZCxFQUFtQjtBQUNqQk4sTUFBQUEsTUFBTSxFQUFFO0FBRFMsS0FBbkI7QUFHRCxHQW5KK0I7QUFvSmhDbEMsRUFBQUEsYUFwSmdDLHlCQW9KbEIzQyxLQXBKa0IsRUFvSlh5QixJQXBKVyxFQW9KTDtBQUFBLFFBQ2pCNkIsS0FEaUIsR0FDQSxJQURBLENBQ2pCQSxLQURpQjtBQUFBLFFBQ1Z2RCxLQURVLEdBQ0EsSUFEQSxDQUNWQSxLQURVOztBQUV6QixRQUFJLEVBQUUsVUFBVXVELEtBQVosQ0FBSixFQUF3QjtBQUN0QixXQUFLRyxRQUFMLENBQWM7QUFBRWhDLFFBQUFBLElBQUksRUFBSkE7QUFBRixPQUFkO0FBQ0Q7O0FBQ0Q2QixJQUFBQSxLQUFLLENBQUNYLGFBQU4sQ0FBb0IzQyxLQUFLLElBQUlELEtBQUssQ0FBQ0MsS0FBbkMsRUFBMEN5QixJQUExQztBQUNELEdBMUorQjtBQTJKaEMyRCxFQUFBQSxjQTNKZ0MsNEJBMkpmO0FBQ2YsV0FBT0MscUJBQVNDLFdBQVQsQ0FBcUIsSUFBckIsQ0FBUDtBQUNELEdBN0orQjtBQThKaENDLEVBQUFBLGNBOUpnQyw0QkE4SmY7QUFDZixTQUFLNUMsYUFBTCxDQUFtQixJQUFuQixFQUF5QixNQUF6QjtBQUNELEdBaEsrQjtBQWlLaEM2QyxFQUFBQSxlQWpLZ0MsNkJBaUtkO0FBQ2hCLFNBQUs3QyxhQUFMLENBQW1CLElBQW5CLEVBQXlCLE1BQXpCO0FBQ0QsR0FuSytCO0FBb0toQzhDLEVBQUFBLE1BcEtnQyxvQkFvS3ZCO0FBQUEsUUFDQ25DLEtBREQsR0FDa0IsSUFEbEIsQ0FDQ0EsS0FERDtBQUFBLFFBQ1F2RCxLQURSLEdBQ2tCLElBRGxCLENBQ1FBLEtBRFI7QUFBQSxRQUdMNEIsTUFISyxHQU1IMkIsS0FORyxDQUdMM0IsTUFISztBQUFBLFFBR0dWLFNBSEgsR0FNSHFDLEtBTkcsQ0FHR3JDLFNBSEg7QUFBQSxRQUdjMkIsWUFIZCxHQU1IVSxLQU5HLENBR2NWLFlBSGQ7QUFBQSxRQUlMTCxvQkFKSyxHQU1IZSxLQU5HLENBSUxmLG9CQUpLO0FBQUEsUUFJaUJGLFVBSmpCLEdBTUhpQixLQU5HLENBSWlCakIsVUFKakI7QUFBQSxRQUtMUSxZQUxLLEdBTUhTLEtBTkcsQ0FLTFQsWUFMSztBQUFBLFFBT0M3QyxLQVBELEdBT2dDRCxLQVBoQyxDQU9DQyxLQVBEO0FBQUEsUUFPUXdCLGFBUFIsR0FPZ0N6QixLQVBoQyxDQU9ReUIsYUFQUjtBQUFBLFFBT3VCQyxJQVB2QixHQU9nQzFCLEtBUGhDLENBT3VCMEIsSUFQdkI7QUFRUCxRQUFNaUUsY0FBYyxHQUFHakUsSUFBSSxLQUFLLE1BQWhDO0FBQ0EsUUFBTWtFLGtCQUFrQixHQUFHRCxjQUFjLElBQUk3QyxZQUFsQixJQUFrQ1IsVUFBbEMsR0FDekIseUJBQWNiLGFBQWQsRUFBNkJxQixZQUE3QixDQUR5QixHQUNvQixJQUQvQztBQUdBLFFBQUkrQyxhQUFhLEdBQUcsSUFBcEI7O0FBRUEsUUFBSXZELFVBQVUsSUFBSXFELGNBQWxCLEVBQWtDO0FBQ2hDLFVBQU1HLGVBQWU7QUFDbkJDLFFBQUFBLFFBQVEsRUFBRSxJQURTO0FBRW5CQyxRQUFBQSxVQUFVLEVBQUUsSUFGTztBQUduQkMsUUFBQUEsVUFBVSxFQUFFO0FBSE8sU0FJaEIzRCxVQUFVLENBQUNpQixLQUpLLE1BS2hCcUMsa0JBTGdCO0FBTW5CakQsUUFBQUEsUUFBUSxFQUFFLEtBQUtxQyxpQkFOSTtBQU9uQi9FLFFBQUFBLEtBQUssRUFBRXdCLGFBUFk7QUFRbkJxQixRQUFBQSxZQUFZLEVBQVpBO0FBUm1CLFFBQXJCOztBQVdBLFVBQUlSLFVBQVUsQ0FBQ2lCLEtBQVgsQ0FBaUIvQixZQUFqQixLQUFrQ3VDLFNBQXRDLEVBQWlEO0FBQy9DK0IsUUFBQUEsZUFBZSxDQUFDSSxnQkFBaEIsR0FBbUM1RCxVQUFVLENBQUNpQixLQUFYLENBQWlCL0IsWUFBcEQ7QUFDRDs7QUFFRHFFLE1BQUFBLGFBQWEsR0FBRyx5QkFBYXZELFVBQWIsRUFBeUJ3RCxlQUF6QixDQUFoQjtBQUNEOztBQUVELFFBQU1LLGdCQUFnQixHQUFHNUMsS0FBSyxDQUFDMUIsYUFBTixHQUN2QixnQ0FBQyxxQkFBRDtBQUNFLE1BQUEsTUFBTSxFQUFFLEtBQUt1RSxTQUFMLEVBRFY7QUFFRSxNQUFBLEdBQUcsRUFBQyxZQUZOO0FBR0UsTUFBQSxLQUFLLEVBQUVuRyxLQUhUO0FBSUUsTUFBQSxNQUFNLEVBQUUyQixNQUpWO0FBS0UsTUFBQSxXQUFXLEVBQUVZLG9CQUxmO0FBTUUsTUFBQSxTQUFTLE1BTlg7QUFPRSxNQUFBLFlBQVksRUFBRU0sWUFQaEI7QUFRRSxNQUFBLFlBQVksRUFBRUQsWUFSaEI7QUFTRSxNQUFBLE9BQU8sRUFBRSxLQUFLSCxPQVRoQjtBQVVFLE1BQUEsU0FBUyxFQUFFeEIsU0FWYjtBQVdFLE1BQUEsYUFBYSxFQUFFTyxhQVhqQjtBQVlFLE1BQUEsUUFBUSxFQUFFLEtBQUt1RDtBQVpqQixNQUR1QixHQWVyQixJQWZKO0FBZ0JBLFFBQU1xQixRQUFRLEdBQUcsQ0FDZjlDLEtBQUssQ0FBQ1AsYUFBTixFQURlLEVBRWQ7QUFBSyxNQUFBLFNBQVMsWUFBSzlCLFNBQUwsV0FBZDtBQUFzQyxNQUFBLEdBQUcsRUFBQztBQUExQyxPQUNFaUYsZ0JBREYsRUFFQztBQUFLLE1BQUEsU0FBUyxZQUFLakYsU0FBTDtBQUFkLE9BQ0UsZ0NBQUMsMEJBQUQ7QUFDRSxNQUFBLE1BQU0sRUFBRVUsTUFEVjtBQUVFLE1BQUEsSUFBSSxFQUFFRixJQUZSO0FBR0UsTUFBQSxLQUFLLEVBQUV6QixLQUhUO0FBSUUsTUFBQSxhQUFhLEVBQUUsS0FBS0csUUFKdEI7QUFLRSxNQUFBLGFBQWEsRUFBRSxLQUFLd0MsYUFMdEI7QUFNRSxNQUFBLGNBQWMsRUFBRStDLGNBTmxCO0FBT0UsTUFBQSxTQUFTLEVBQUV6RTtBQVBiLE1BREYsRUFVR29CLFVBQVUsSUFBSXFELGNBQWQsR0FDRTtBQUFLLE1BQUEsU0FBUyxZQUFLekUsU0FBTDtBQUFkLE9BQ0M7QUFBSyxNQUFBLFNBQVMsWUFBS0EsU0FBTDtBQUFkLE9BQ0cyRSxhQURILENBREQsQ0FERixHQU1HLElBaEJOLEVBaUJFO0FBQUssTUFBQSxTQUFTLFlBQUszRSxTQUFMO0FBQWQsT0FDRSxnQ0FBQyxxQkFBRDtBQUNFLE1BQUEsTUFBTSxFQUFFVSxNQURWO0FBRUUsTUFBQSxLQUFLLEVBQUUzQixLQUZUO0FBR0UsTUFBQSxhQUFhLEVBQUV3QixhQUhqQjtBQUlFLE1BQUEsU0FBUyxFQUFFUCxTQUpiO0FBS0UsTUFBQSxVQUFVLEVBQUVxQyxLQUFLLENBQUMrQyxVQUxwQjtBQU1FLE1BQUEsUUFBUSxFQUFFLEtBQUtyQixpQkFOakI7QUFPRSxNQUFBLFlBQVksRUFBRXBDLFlBUGhCO0FBUUUsTUFBQSxjQUFjLEVBQUVVLEtBQUssQ0FBQ3hCO0FBUnhCLE1BREYsQ0FqQkYsRUE4QkUsZ0NBQUMsMEJBQUQ7QUFDRSxNQUFBLE1BQU0sRUFBRXdCLEtBQUssQ0FBQ3RCLE1BRGhCO0FBRUUsTUFBQSxZQUFZLEVBQUVzQixLQUFLLENBQUNSLFlBRnRCO0FBR0UsTUFBQSxNQUFNLEVBQUVuQixNQUhWO0FBSUUsTUFBQSxTQUFTLEVBQUVWLFNBSmI7QUFLRSxNQUFBLFNBQVMsRUFBRXFDLEtBQUssQ0FBQ3ZCLFNBTG5CO0FBTUUsTUFBQSxZQUFZLEVBQUVjLFlBTmhCO0FBT0UsTUFBQSxjQUFjLEVBQUU2QyxjQVBsQjtBQVFFLE1BQUEsYUFBYSxFQUFFcEMsS0FBSyxDQUFDMUIsYUFSdkI7QUFTRSxNQUFBLFVBQVUsRUFBRVMsVUFUZDtBQVVFLE1BQUEsYUFBYSxFQUFFYixhQVZqQjtBQVdFLE1BQUEsS0FBSyxFQUFFeEIsS0FYVDtBQVlFLE1BQUEsWUFBWSxFQUFFNEMsWUFaaEI7QUFhRSxNQUFBLFVBQVUsRUFBRSxDQUFDLEtBQUtrQyxhQUFMLENBQW1CdEQsYUFBbkIsQ0FiZjtBQWNFLE1BQUEsSUFBSSxFQUFFLEtBQUtXLElBZGI7QUFlRSxNQUFBLFFBQVEsRUFBRSxLQUFLRixRQWZqQjtBQWdCRSxNQUFBLE9BQU8sRUFBRSxLQUFLaUQsT0FoQmhCO0FBaUJFLE1BQUEsZ0JBQWdCLEVBQUUsS0FBS0ssY0FqQnpCO0FBa0JFLE1BQUEsaUJBQWlCLEVBQUUsS0FBS0M7QUFsQjFCLE1BOUJGLENBRkQsQ0FGYyxDQUFqQjtBQTBEQSxXQUFPLEtBQUtjLFVBQUwsQ0FBZ0I7QUFDckJGLE1BQUFBLFFBQVEsRUFBUkEsUUFEcUI7QUFFckJoRixNQUFBQSxTQUFTLEVBQUVrQyxLQUFLLENBQUN4QixjQUFOLGFBQTBCYixTQUExQixvQkFBb0Q7QUFGMUMsS0FBaEIsQ0FBUDtBQUlEO0FBblIrQixDQUFqQixDQUFqQjtlQXNSZUYsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBjbG9uZUVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBjcmVhdGVSZWFjdENsYXNzIGZyb20gJ2NyZWF0ZS1yZWFjdC1jbGFzcyc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IG5vb3AgZnJvbSAnbG9kYXNoL25vb3AnO1xuaW1wb3J0IEtleUNvZGUgZnJvbSAnLi4vLi4vX3V0aWwvS2V5Q29kZSc7XG5pbXBvcnQgRGF0ZVRhYmxlIGZyb20gJy4vZGF0ZS9EYXRlVGFibGUnO1xuaW1wb3J0IENhbGVuZGFySGVhZGVyIGZyb20gJy4vY2FsZW5kYXIvQ2FsZW5kYXJIZWFkZXInO1xuaW1wb3J0IENhbGVuZGFyRm9vdGVyIGZyb20gJy4vY2FsZW5kYXIvQ2FsZW5kYXJGb290ZXInO1xuaW1wb3J0IENhbGVuZGFyTWl4aW4gZnJvbSAnLi9taXhpbi9DYWxlbmRhck1peGluJztcbmltcG9ydCBDb21tb25NaXhpbiBmcm9tICcuL21peGluL0NvbW1vbk1peGluJztcbmltcG9ydCBEYXRlSW5wdXQgZnJvbSAnLi9kYXRlL0RhdGVJbnB1dCc7XG5pbXBvcnQgeyBnZXRUaW1lQ29uZmlnLCBnZXRUb2RheVRpbWUsIHN5bmNUaW1lIH0gZnJvbSAnLi91dGlsJztcblxuZnVuY3Rpb24gZ29TdGFydE1vbnRoKCkge1xuICBjb25zdCBuZXh0ID0gdGhpcy5zdGF0ZS52YWx1ZS5jbG9uZSgpO1xuICBuZXh0LnN0YXJ0T2YoJ21vbnRoJyk7XG4gIHRoaXMuc2V0VmFsdWUobmV4dCk7XG59XG5cbmZ1bmN0aW9uIGdvRW5kTW9udGgoKSB7XG4gIGNvbnN0IG5leHQgPSB0aGlzLnN0YXRlLnZhbHVlLmNsb25lKCk7XG4gIG5leHQuZW5kT2YoJ21vbnRoJyk7XG4gIHRoaXMuc2V0VmFsdWUobmV4dCk7XG59XG5cbmZ1bmN0aW9uIGdvVGltZShkaXJlY3Rpb24sIHVuaXQpIHtcbiAgY29uc3QgbmV4dCA9IHRoaXMuc3RhdGUudmFsdWUuY2xvbmUoKTtcbiAgbmV4dC5hZGQoZGlyZWN0aW9uLCB1bml0KTtcbiAgdGhpcy5zZXRWYWx1ZShuZXh0KTtcbn1cblxuZnVuY3Rpb24gZ29Nb250aChkaXJlY3Rpb24pIHtcbiAgcmV0dXJuIGdvVGltZS5jYWxsKHRoaXMsIGRpcmVjdGlvbiwgJ21vbnRocycpO1xufVxuXG5mdW5jdGlvbiBnb1llYXIoZGlyZWN0aW9uKSB7XG4gIHJldHVybiBnb1RpbWUuY2FsbCh0aGlzLCBkaXJlY3Rpb24sICd5ZWFycycpO1xufVxuXG5mdW5jdGlvbiBnb1dlZWsoZGlyZWN0aW9uKSB7XG4gIHJldHVybiBnb1RpbWUuY2FsbCh0aGlzLCBkaXJlY3Rpb24sICd3ZWVrcycpO1xufVxuXG5mdW5jdGlvbiBnb0RheShkaXJlY3Rpb24pIHtcbiAgcmV0dXJuIGdvVGltZS5jYWxsKHRoaXMsIGRpcmVjdGlvbiwgJ2RheXMnKTtcbn1cblxuY29uc3QgQ2FsZW5kYXIgPSBjcmVhdGVSZWFjdENsYXNzKHtcbiAgcHJvcFR5cGVzOiB7XG4gICAgcHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBzdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBkZWZhdWx0VmFsdWU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgdmFsdWU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgc2VsZWN0ZWRWYWx1ZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtb2RlOiBQcm9wVHlwZXMub25lT2YoWyd0aW1lJywgJ2RhdGUnLCAnbW9udGgnLCAneWVhcicsICdkZWNhZGUnXSksXG4gICAgbG9jYWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHNob3dEYXRlSW5wdXQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHNob3dXZWVrTnVtYmVyOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBzaG93VG9kYXk6IFByb3BUeXBlcy5ib29sLFxuICAgIHNob3dPazogUHJvcFR5cGVzLmJvb2wsXG4gICAgb25TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uT2s6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uS2V5RG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgdGltZVBpY2tlcjogUHJvcFR5cGVzLmVsZW1lbnQsXG4gICAgZGF0ZUlucHV0UGxhY2Vob2xkZXI6IFByb3BUeXBlcy5hbnksXG4gICAgb25DbGVhcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uUGFuZWxDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIGRpc2FibGVkRGF0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZGlzYWJsZWRUaW1lOiBQcm9wVHlwZXMuYW55LFxuICAgIHJlbmRlckZvb3RlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgcmVuZGVyU2lkZWJhcjogUHJvcFR5cGVzLmZ1bmMsXG4gIH0sXG5cbiAgbWl4aW5zOiBbQ29tbW9uTWl4aW4sIENhbGVuZGFyTWl4aW5dLFxuXG4gIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2hvd1RvZGF5OiB0cnVlLFxuICAgICAgc2hvd0RhdGVJbnB1dDogdHJ1ZSxcbiAgICAgIHRpbWVQaWNrZXI6IG51bGwsXG4gICAgICBvbk9rOiBub29wLFxuICAgICAgb25QYW5lbENoYW5nZTogbm9vcCxcbiAgICB9O1xuICB9LFxuICBnZXRJbml0aWFsU3RhdGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1vZGU6IHRoaXMucHJvcHMubW9kZSB8fCAnZGF0ZScsXG4gICAgfTtcbiAgfSxcbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAoJ21vZGUnIGluIG5leHRQcm9wcyAmJiB0aGlzLnN0YXRlLm1vZGUgIT09IG5leHRQcm9wcy5tb2RlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgbW9kZTogbmV4dFByb3BzLm1vZGUgfSk7XG4gICAgfVxuICB9LFxuICBvbktleURvd24oZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGNvbnN0IGtleUNvZGUgPSBldmVudC5rZXlDb2RlO1xuICAgIC8vIG1hY1xuICAgIGNvbnN0IGN0cmxLZXkgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7XG4gICAgY29uc3QgeyBkaXNhYmxlZERhdGUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBzd2l0Y2ggKGtleUNvZGUpIHtcbiAgICAgIGNhc2UgS2V5Q29kZS5ET1dOOlxuICAgICAgICBnb1dlZWsuY2FsbCh0aGlzLCAxKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICBjYXNlIEtleUNvZGUuVVA6XG4gICAgICAgIGdvV2Vlay5jYWxsKHRoaXMsIC0xKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICBjYXNlIEtleUNvZGUuTEVGVDpcbiAgICAgICAgaWYgKGN0cmxLZXkpIHtcbiAgICAgICAgICBnb1llYXIuY2FsbCh0aGlzLCAtMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ29EYXkuY2FsbCh0aGlzLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICBjYXNlIEtleUNvZGUuUklHSFQ6XG4gICAgICAgIGlmIChjdHJsS2V5KSB7XG4gICAgICAgICAgZ29ZZWFyLmNhbGwodGhpcywgMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ29EYXkuY2FsbCh0aGlzLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIGNhc2UgS2V5Q29kZS5IT01FOlxuICAgICAgICBnb1N0YXJ0TW9udGguY2FsbCh0aGlzKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICBjYXNlIEtleUNvZGUuRU5EOlxuICAgICAgICBnb0VuZE1vbnRoLmNhbGwodGhpcyk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgY2FzZSBLZXlDb2RlLlBBR0VfRE9XTjpcbiAgICAgICAgZ29Nb250aC5jYWxsKHRoaXMsIDEpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIGNhc2UgS2V5Q29kZS5QQUdFX1VQOlxuICAgICAgICBnb01vbnRoLmNhbGwodGhpcywgLTEpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIGNhc2UgS2V5Q29kZS5FTlRFUjpcbiAgICAgICAgaWYgKCFkaXNhYmxlZERhdGUgfHwgIWRpc2FibGVkRGF0ZSh2YWx1ZSkpIHtcbiAgICAgICAgICB0aGlzLm9uU2VsZWN0KHZhbHVlLCB7XG4gICAgICAgICAgICBzb3VyY2U6ICdrZXlib2FyZCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLnByb3BzLm9uS2V5RG93bihldmVudCk7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgfSxcblxuICBvbkNsZWFyKCkge1xuICAgIHRoaXMub25TZWxlY3QobnVsbCk7XG4gICAgdGhpcy5wcm9wcy5vbkNsZWFyKCk7XG4gIH0sXG5cbiAgb25PaygpIHtcbiAgICBjb25zdCB7IHNlbGVjdGVkVmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKHRoaXMuaXNBbGxvd2VkRGF0ZShzZWxlY3RlZFZhbHVlKSkge1xuICAgICAgdGhpcy5wcm9wcy5vbk9rKHNlbGVjdGVkVmFsdWUpO1xuICAgIH1cbiAgfSxcblxuICBvbkRhdGVJbnB1dENoYW5nZSh2YWx1ZSkge1xuICAgIHRoaXMub25TZWxlY3QodmFsdWUsIHtcbiAgICAgIHNvdXJjZTogJ2RhdGVJbnB1dCcsXG4gICAgfSk7XG4gIH0sXG4gIG9uRGF0ZVRhYmxlU2VsZWN0KHZhbHVlKSB7XG4gICAgY29uc3QgeyB0aW1lUGlja2VyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgc2VsZWN0ZWRWYWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoIXNlbGVjdGVkVmFsdWUgJiYgdGltZVBpY2tlcikge1xuICAgICAgY29uc3QgdGltZVBpY2tlckRlZmF1bHRWYWx1ZSA9IHRpbWVQaWNrZXIucHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgICAgaWYgKHRpbWVQaWNrZXJEZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgc3luY1RpbWUodGltZVBpY2tlckRlZmF1bHRWYWx1ZSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm9uU2VsZWN0KHZhbHVlKTtcbiAgfSxcbiAgb25Ub2RheSgpIHtcbiAgICBjb25zdCB7IHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IG5vdyA9IGdldFRvZGF5VGltZSh2YWx1ZSk7XG4gICAgdGhpcy5vblNlbGVjdChub3csIHtcbiAgICAgIHNvdXJjZTogJ3RvZGF5QnV0dG9uJyxcbiAgICB9KTtcbiAgfSxcbiAgb25QYW5lbENoYW5nZSh2YWx1ZSwgbW9kZSkge1xuICAgIGNvbnN0IHsgcHJvcHMsIHN0YXRlIH0gPSB0aGlzO1xuICAgIGlmICghKCdtb2RlJyBpbiBwcm9wcykpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBtb2RlIH0pO1xuICAgIH1cbiAgICBwcm9wcy5vblBhbmVsQ2hhbmdlKHZhbHVlIHx8IHN0YXRlLnZhbHVlLCBtb2RlKTtcbiAgfSxcbiAgZ2V0Um9vdERPTU5vZGUoKSB7XG4gICAgcmV0dXJuIFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpO1xuICB9LFxuICBvcGVuVGltZVBpY2tlcigpIHtcbiAgICB0aGlzLm9uUGFuZWxDaGFuZ2UobnVsbCwgJ3RpbWUnKTtcbiAgfSxcbiAgY2xvc2VUaW1lUGlja2VyKCkge1xuICAgIHRoaXMub25QYW5lbENoYW5nZShudWxsLCAnZGF0ZScpO1xuICB9LFxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcm9wcywgc3RhdGUgfSA9IHRoaXM7XG4gICAgY29uc3Qge1xuICAgICAgbG9jYWxlLCBwcmVmaXhDbHMsIGRpc2FibGVkRGF0ZSxcbiAgICAgIGRhdGVJbnB1dFBsYWNlaG9sZGVyLCB0aW1lUGlja2VyLFxuICAgICAgZGlzYWJsZWRUaW1lLFxuICAgIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHZhbHVlLCBzZWxlY3RlZFZhbHVlLCBtb2RlIH0gPSBzdGF0ZTtcbiAgICBjb25zdCBzaG93VGltZVBpY2tlciA9IG1vZGUgPT09ICd0aW1lJztcbiAgICBjb25zdCBkaXNhYmxlZFRpbWVDb25maWcgPSBzaG93VGltZVBpY2tlciAmJiBkaXNhYmxlZFRpbWUgJiYgdGltZVBpY2tlciA/XG4gICAgICBnZXRUaW1lQ29uZmlnKHNlbGVjdGVkVmFsdWUsIGRpc2FibGVkVGltZSkgOiBudWxsO1xuXG4gICAgbGV0IHRpbWVQaWNrZXJFbGUgPSBudWxsO1xuXG4gICAgaWYgKHRpbWVQaWNrZXIgJiYgc2hvd1RpbWVQaWNrZXIpIHtcbiAgICAgIGNvbnN0IHRpbWVQaWNrZXJQcm9wcyA9IHtcbiAgICAgICAgc2hvd0hvdXI6IHRydWUsXG4gICAgICAgIHNob3dTZWNvbmQ6IHRydWUsXG4gICAgICAgIHNob3dNaW51dGU6IHRydWUsXG4gICAgICAgIC4uLnRpbWVQaWNrZXIucHJvcHMsXG4gICAgICAgIC4uLmRpc2FibGVkVGltZUNvbmZpZyxcbiAgICAgICAgb25DaGFuZ2U6IHRoaXMub25EYXRlSW5wdXRDaGFuZ2UsXG4gICAgICAgIHZhbHVlOiBzZWxlY3RlZFZhbHVlLFxuICAgICAgICBkaXNhYmxlZFRpbWUsXG4gICAgICB9O1xuXG4gICAgICBpZiAodGltZVBpY2tlci5wcm9wcy5kZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aW1lUGlja2VyUHJvcHMuZGVmYXVsdE9wZW5WYWx1ZSA9IHRpbWVQaWNrZXIucHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgICAgfVxuXG4gICAgICB0aW1lUGlja2VyRWxlID0gY2xvbmVFbGVtZW50KHRpbWVQaWNrZXIsIHRpbWVQaWNrZXJQcm9wcyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0ZUlucHV0RWxlbWVudCA9IHByb3BzLnNob3dEYXRlSW5wdXQgPyAoXG4gICAgICA8RGF0ZUlucHV0XG4gICAgICAgIGZvcm1hdD17dGhpcy5nZXRGb3JtYXQoKX1cbiAgICAgICAga2V5PVwiZGF0ZS1pbnB1dFwiXG4gICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgbG9jYWxlPXtsb2NhbGV9XG4gICAgICAgIHBsYWNlaG9sZGVyPXtkYXRlSW5wdXRQbGFjZWhvbGRlcn1cbiAgICAgICAgc2hvd0NsZWFyXG4gICAgICAgIGRpc2FibGVkVGltZT17ZGlzYWJsZWRUaW1lfVxuICAgICAgICBkaXNhYmxlZERhdGU9e2Rpc2FibGVkRGF0ZX1cbiAgICAgICAgb25DbGVhcj17dGhpcy5vbkNsZWFyfVxuICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgc2VsZWN0ZWRWYWx1ZT17c2VsZWN0ZWRWYWx1ZX1cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMub25EYXRlSW5wdXRDaGFuZ2V9XG4gICAgICAvPlxuICAgICkgOiBudWxsO1xuICAgIGNvbnN0IGNoaWxkcmVuID0gW1xuICAgICAgcHJvcHMucmVuZGVyU2lkZWJhcigpLFxuICAgICAgKDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXBhbmVsYH0ga2V5PVwicGFuZWxcIj5cbiAgICAgICAge2RhdGVJbnB1dEVsZW1lbnR9XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWRhdGUtcGFuZWxgfT5cbiAgICAgICAgICA8Q2FsZW5kYXJIZWFkZXJcbiAgICAgICAgICAgIGxvY2FsZT17bG9jYWxlfVxuICAgICAgICAgICAgbW9kZT17bW9kZX1cbiAgICAgICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e3RoaXMuc2V0VmFsdWV9XG4gICAgICAgICAgICBvblBhbmVsQ2hhbmdlPXt0aGlzLm9uUGFuZWxDaGFuZ2V9XG4gICAgICAgICAgICBzaG93VGltZVBpY2tlcj17c2hvd1RpbWVQaWNrZXJ9XG4gICAgICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgICAvPlxuICAgICAgICAgIHt0aW1lUGlja2VyICYmIHNob3dUaW1lUGlja2VyID9cbiAgICAgICAgICAgICg8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10aW1lLXBpY2tlcmB9PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10aW1lLXBpY2tlci1wYW5lbGB9PlxuICAgICAgICAgICAgICAgIHt0aW1lUGlja2VyRWxlIH1cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj4pXG4gICAgICAgICAgICA6IG51bGx9XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tYm9keWB9PlxuICAgICAgICAgICAgPERhdGVUYWJsZVxuICAgICAgICAgICAgICBsb2NhbGU9e2xvY2FsZX1cbiAgICAgICAgICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlPXtzZWxlY3RlZFZhbHVlfVxuICAgICAgICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgICAgICAgZGF0ZVJlbmRlcj17cHJvcHMuZGF0ZVJlbmRlcn1cbiAgICAgICAgICAgICAgb25TZWxlY3Q9e3RoaXMub25EYXRlVGFibGVTZWxlY3R9XG4gICAgICAgICAgICAgIGRpc2FibGVkRGF0ZT17ZGlzYWJsZWREYXRlfVxuICAgICAgICAgICAgICBzaG93V2Vla051bWJlcj17cHJvcHMuc2hvd1dlZWtOdW1iZXJ9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPENhbGVuZGFyRm9vdGVyXG4gICAgICAgICAgICBzaG93T2s9e3Byb3BzLnNob3dPa31cbiAgICAgICAgICAgIHJlbmRlckZvb3Rlcj17cHJvcHMucmVuZGVyRm9vdGVyfVxuICAgICAgICAgICAgbG9jYWxlPXtsb2NhbGV9XG4gICAgICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgICAgIHNob3dUb2RheT17cHJvcHMuc2hvd1RvZGF5fVxuICAgICAgICAgICAgZGlzYWJsZWRUaW1lPXtkaXNhYmxlZFRpbWV9XG4gICAgICAgICAgICBzaG93VGltZVBpY2tlcj17c2hvd1RpbWVQaWNrZXJ9XG4gICAgICAgICAgICBzaG93RGF0ZUlucHV0PXtwcm9wcy5zaG93RGF0ZUlucHV0fVxuICAgICAgICAgICAgdGltZVBpY2tlcj17dGltZVBpY2tlcn1cbiAgICAgICAgICAgIHNlbGVjdGVkVmFsdWU9e3NlbGVjdGVkVmFsdWV9XG4gICAgICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgICAgICBkaXNhYmxlZERhdGU9e2Rpc2FibGVkRGF0ZX1cbiAgICAgICAgICAgIG9rRGlzYWJsZWQ9eyF0aGlzLmlzQWxsb3dlZERhdGUoc2VsZWN0ZWRWYWx1ZSl9XG4gICAgICAgICAgICBvbk9rPXt0aGlzLm9uT2t9XG4gICAgICAgICAgICBvblNlbGVjdD17dGhpcy5vblNlbGVjdH1cbiAgICAgICAgICAgIG9uVG9kYXk9e3RoaXMub25Ub2RheX1cbiAgICAgICAgICAgIG9uT3BlblRpbWVQaWNrZXI9e3RoaXMub3BlblRpbWVQaWNrZXJ9XG4gICAgICAgICAgICBvbkNsb3NlVGltZVBpY2tlcj17dGhpcy5jbG9zZVRpbWVQaWNrZXJ9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj4pLFxuICAgIF07XG5cbiAgICByZXR1cm4gdGhpcy5yZW5kZXJSb290KHtcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgY2xhc3NOYW1lOiBwcm9wcy5zaG93V2Vla051bWJlciA/IGAke3ByZWZpeENsc30td2Vlay1udW1iZXJgIDogJycsXG4gICAgfSk7XG4gIH0sXG59KTtcblxuZXhwb3J0IGRlZmF1bHQgQ2FsZW5kYXI7XG4iXX0=