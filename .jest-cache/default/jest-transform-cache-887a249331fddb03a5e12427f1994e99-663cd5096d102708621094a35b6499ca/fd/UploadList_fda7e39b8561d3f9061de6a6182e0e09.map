{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components/upload/UploadList.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { Component, CSSProperties, SyntheticEvent } from 'react';\nimport classNames from 'classnames';\nimport Icon from '../icon';\nimport Tooltip from '../tooltip';\nimport Progress from '../progress';\nimport { UploadFile, UploadListProps } from './interface';\nimport Animate from '../animate';\nimport { ProgressType } from '../progress/enum';\nimport { getPrefixCls } from '../configure';\nimport { previewImage } from './utils';\n\nconst isImageUrl = (url: string): boolean => {\n  return /^data:image\\//.test(url) || /\\.(webp|svg|png|gif|jpg|jpeg)$/.test(url);\n};\n\nexport default class UploadList extends Component<UploadListProps, any> {\n  static displayName = 'UploadList';\n\n  static defaultProps = {\n    listType: 'text', // or picture\n    progressAttr: {\n      strokeWidth: 2,\n      showInfo: false,\n    },\n    previewFile: previewImage,\n    showRemoveIcon: true,\n    showPreviewIcon: true,\n  };\n\n  handleClose = (file: UploadFile) => {\n    const { onRemove } = this.props;\n    if (onRemove) {\n      onRemove(file);\n    }\n  };\n\n  handlePreview = (file: UploadFile, e: SyntheticEvent<HTMLElement>) => {\n    const { onPreview } = this.props;\n    if (!onPreview) {\n      return;\n    }\n    e.preventDefault();\n    return onPreview(file);\n  };\n\n  componentDidUpdate() {\n    const { listType, items, previewFile } = this.props;\n    if (listType !== 'picture' && listType !== 'picture-card') {\n      return;\n    }\n    (items || []).forEach(file => {\n      if (\n        typeof document === 'undefined' ||\n        typeof window === 'undefined' ||\n        !(window as any).FileReader ||\n        !(window as any).File ||\n        !(file.originFileObj instanceof File || file.originFileObj instanceof Blob) ||\n        file.thumbUrl !== undefined\n      ) {\n        return;\n      }\n      file.thumbUrl = '';\n      if (previewFile) {\n        previewFile(file.originFileObj as File).then((previewDataUrl: string) => {\n          // Need append '' to avoid dead loop\n          file.thumbUrl = previewDataUrl || '';\n          this.forceUpdate();\n        });\n      }\n    });\n  }\n\n  render() {\n    const {\n      prefixCls: customizePrefixCls,\n      items = [],\n      listType,\n      showPreviewIcon,\n      showRemoveIcon,\n      locale,\n    } = this.props;\n    const prefixCls = getPrefixCls('upload', customizePrefixCls);\n    const list = items.map(file => {\n      let progress;\n      let icon = <Icon type={file.status === 'uploading' ? 'loading' : 'attach_file'} />;\n\n      if (listType === 'picture' || listType === 'picture-card') {\n        if (listType === 'picture-card' && file.status === 'uploading') {\n          icon = <div className={`${prefixCls}-list-item-uploading-text`}>{locale.uploading}</div>;\n        } else if (!file.thumbUrl && !file.url) {\n          icon = <Icon className={`${prefixCls}-list-item-thumbnail`} type=\"picture\" />;\n        } else {\n          const thumbnail = isImageUrl((file.thumbUrl || file.url) as string) ? (\n            <img src={file.thumbUrl || file.url} alt={file.name} />\n          ) : (\n            <Icon type=\"file\" style={{ fontSize: 48, color: 'rgba(0,0,0,0.5)' }} />\n          );\n          icon = (\n            <a\n              className={`${prefixCls}-list-item-thumbnail`}\n              onClick={e => this.handlePreview(file, e)}\n              href={file.url || file.thumbUrl}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              {thumbnail}\n            </a>\n          );\n        }\n      }\n\n      if (file.status === 'uploading') {\n        const { progressAttr } = this.props;\n        // show loading icon if upload progress listener is disabled\n        const loadingProgress =\n          'percent' in file ? (\n            <Progress type={ProgressType.line} {...progressAttr} percent={file.percent} />\n          ) : null;\n\n        progress = (\n          <div className={`${prefixCls}-list-item-progress`} key=\"progress\">\n            {loadingProgress}\n          </div>\n        );\n      }\n      const infoUploadingClass = classNames({\n        [`${prefixCls}-list-item`]: true,\n        [`${prefixCls}-list-item-${file.status}`]: true,\n      });\n      const preview = file.url ? (\n        <a\n          {...file.linkProps}\n          href={file.url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className={`${prefixCls}-list-item-name`}\n          onClick={e => this.handlePreview(file, e)}\n          title={file.name}\n        >\n          {file.name}\n        </a>\n      ) : (\n        <span\n          className={`${prefixCls}-list-item-name`}\n          onClick={e => this.handlePreview(file, e)}\n          title={file.name}\n        >\n          {file.name}\n        </span>\n      );\n      const style =\n        file.url || file.thumbUrl\n          ? undefined\n          : ({\n              pointerEvents: 'none',\n              opacity: 0.5,\n            } as CSSProperties);\n      const previewIcon = showPreviewIcon ? (\n        <a\n          href={file.url || file.thumbUrl}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          style={style}\n          onClick={e => this.handlePreview(file, e)}\n          title={locale.previewFile}\n        >\n          <Icon type=\"visibility\" />\n        </a>\n      ) : null;\n      const removeIcon = showRemoveIcon ? (\n        <Icon type=\"delete\" title={locale.removeFile} onClick={() => this.handleClose(file)} />\n      ) : null;\n      const removeIconCross = showRemoveIcon ? (\n        <Icon type=\"close\" title={locale.removeFile} onClick={() => this.handleClose(file)} />\n      ) : null;\n      const actions =\n        listType === 'picture-card' && file.status !== 'uploading' ? (\n          <span className={`${prefixCls}-list-item-actions`}>\n            {previewIcon}\n            {removeIcon}\n          </span>\n        ) : (\n          removeIconCross\n        );\n      let message;\n      if (file.response && typeof file.response === 'string') {\n        message = file.response;\n      } else {\n        message = (file.error && file.error.statusText) || locale.uploadError;\n      }\n      const iconAndPreview =\n        file.status === 'error' ? (\n          <Tooltip title={message}>\n            {icon}\n            {preview}\n          </Tooltip>\n        ) : (\n          <span>\n            {icon}\n            {preview}\n          </span>\n        );\n\n      return (\n        <div className={infoUploadingClass} key={file.uid}>\n          <div className={`${prefixCls}-list-item-info`}>{iconAndPreview}</div>\n          {actions}\n          <Animate transitionName=\"fade\" component=\"\">\n            {progress}\n          </Animate>\n        </div>\n      );\n    });\n    const listClassNames = classNames({\n      [`${prefixCls}-list`]: true,\n      [`${prefixCls}-list-${listType}`]: true,\n    });\n    const animationDirection = listType === 'picture-card' ? 'animate-inline' : 'animate';\n    return (\n      <Animate\n        transitionName={`${prefixCls}-${animationDirection}`}\n        component=\"div\"\n        className={listClassNames}\n      >\n        {list}\n      </Animate>\n    );\n  }\n}\n"]}