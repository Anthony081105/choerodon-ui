0bfa96b7d84e16f116adb84185503d42
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = require("react-dom");

var _classnames = _interopRequireDefault(require("classnames"));

var _icon = _interopRequireDefault(require("../icon"));

var _warning = _interopRequireDefault(require("../_util/warning"));

var _isFlexSupported = _interopRequireDefault(require("../_util/isFlexSupported"));

var _tabs = _interopRequireWildcard(require("../rc-components/tabs"));

var _ScrollableInkTabBar = _interopRequireDefault(require("../rc-components/tabs/ScrollableInkTabBar"));

var _utils = require("../rc-components/tabs/utils");

var _configure = require("../configure");

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Tabs =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Tabs, _Component);

  var _super = _createSuper(Tabs);

  function Tabs() {
    var _this;

    (0, _classCallCheck2["default"])(this, Tabs);
    _this = _super.apply(this, arguments);

    _this.createNewTab = function (targetKey) {
      var onEdit = _this.props.onEdit;

      if (onEdit) {
        onEdit(targetKey, 'add');
      }
    };

    _this.removeTab = function (targetKey, e) {
      e.stopPropagation();

      if (!targetKey) {
        return;
      }

      var onEdit = _this.props.onEdit;

      if (onEdit) {
        onEdit(targetKey, 'remove');
      }
    };

    _this.handleChange = function (activeKey) {
      var onChange = _this.props.onChange;

      if (onChange) {
        onChange(activeKey);
      }
    };

    return _this;
  }

  (0, _createClass2["default"])(Tabs, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var NO_FLEX = ' no-flex';
      var tabNode = (0, _reactDom.findDOMNode)(this);

      if (tabNode && !(0, _isFlexSupported["default"])() && tabNode.className.indexOf(NO_FLEX) === -1) {
        tabNode.className += NO_FLEX;
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _classNames,
          _this2 = this;

      var _this$props = this.props,
          customizePrefixCls = _this$props.prefixCls,
          _this$props$className = _this$props.className,
          className = _this$props$className === void 0 ? '' : _this$props$className,
          size = _this$props.size,
          _this$props$type = _this$props.type,
          type = _this$props$type === void 0 ? "line" : _this$props$type,
          tabPosition = _this$props.tabPosition,
          children = _this$props.children,
          tabBarStyle = _this$props.tabBarStyle,
          hideAdd = _this$props.hideAdd,
          onTabClick = _this$props.onTabClick,
          onPrevClick = _this$props.onPrevClick,
          onNextClick = _this$props.onNextClick,
          _this$props$animated = _this$props.animated,
          animated = _this$props$animated === void 0 ? true : _this$props$animated,
          tabBarGutter = _this$props.tabBarGutter;
      var tabBarExtraContent = this.props.tabBarExtraContent;
      var prefixCls = (0, _configure.getPrefixCls)('tabs', customizePrefixCls);
      var inkBarAnimated = (0, _typeof2["default"])(animated) === 'object' ? animated.inkBar : animated;
      var tabPaneAnimated = (0, _typeof2["default"])(animated) === 'object' ? animated.tabPane : animated; // card tabs should not have animation

      if (type !== "line"
      /* line */
      ) {
          tabPaneAnimated = 'animated' in this.props ? tabPaneAnimated : false;
        }

      var isCard = type === "card"
      /* card */
      || type === "editable-card"
      /* 'editable-card' */
      ;
      (0, _warning["default"])(!(isCard && (size === "small"
      /* small */
      || size === "large"
      /* large */
      )), "Tabs[type=card|editable-card] doesn't have small or large size, it's by designed.");
      var cls = (0, _classnames["default"])(className, "".concat(prefixCls, "-").concat(type), (_classNames = {}, (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-vertical"), tabPosition === "left"
      /* left */
      || tabPosition === "right"), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-").concat(size), !!size), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-card"), isCard), (0, _defineProperty2["default"])(_classNames, "".concat(prefixCls, "-no-animation"), !tabPaneAnimated), _classNames)); // only card type tabs can be added and closed

      var childrenWithClose = [];

      if (type === "editable-card"
      /* 'editable-card' */
      ) {
          childrenWithClose = [];

          _react.Children.forEach(children, function (child, index) {
            var closable = child.props.closable;
            closable = typeof closable === 'undefined' ? true : closable;
            var closeIcon = closable ? _react["default"].createElement(_icon["default"], {
              type: "close",
              onClick: function onClick(e) {
                return _this2.removeTab(child.key, e);
              }
            }) : null;
            childrenWithClose.push((0, _react.cloneElement)(child, {
              tab: _react["default"].createElement("div", {
                className: closable ? undefined : "".concat(prefixCls, "-tab-unclosable")
              }, child.props.tab, closeIcon),
              key: (0, _utils.generateKey)(child.key, index)
            }));
          }); // Add new tab handler


          if (!hideAdd) {
            tabBarExtraContent = _react["default"].createElement("span", null, _react["default"].createElement(_icon["default"], {
              type: "plus",
              className: "".concat(prefixCls, "-new-tab"),
              onClick: this.createNewTab
            }), tabBarExtraContent);
          }
        }

      tabBarExtraContent = tabBarExtraContent ? _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-extra-content")
      }, tabBarExtraContent) : null;

      var renderTabBar = function renderTabBar() {
        return _react["default"].createElement(_ScrollableInkTabBar["default"], {
          inkBarAnimated: inkBarAnimated,
          extraContent: tabBarExtraContent,
          onTabClick: onTabClick,
          onPrevClick: onPrevClick,
          onNextClick: onNextClick,
          style: tabBarStyle,
          tabBarGutter: tabBarGutter
        });
      };

      return _react["default"].createElement(_tabs["default"], (0, _extends2["default"])({}, this.props, {
        prefixCls: prefixCls,
        className: cls,
        tabBarPosition: tabPosition,
        renderTabBar: renderTabBar,
        renderTabContent: function renderTabContent() {
          return _react["default"].createElement(_tabs.TabContent, {
            animated: tabPaneAnimated,
            animatedWithMargin: true
          });
        },
        onChange: this.handleChange
      }), childrenWithClose.length > 0 ? childrenWithClose : children);
    }
  }]);
  return Tabs;
}(_react.Component);

exports["default"] = Tabs;
Tabs.displayName = 'Tabs';
Tabs.TabPane = _tabs.TabPane;
Tabs.defaultProps = {
  hideAdd: false
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRhYnMvaW5kZXguanMiXSwibmFtZXMiOlsiVGFicyIsIkNvbXBvbmVudCIsIm9uRWRpdCIsImUiLCJvbkNoYW5nZSIsIk5PX0ZMRVgiLCJ0YWJOb2RlIiwiY3VzdG9taXplUHJlZml4Q2xzIiwiY2xhc3NOYW1lIiwic2l6ZSIsInR5cGUiLCJ0YWJQb3NpdGlvbiIsImNoaWxkcmVuIiwidGFiQmFyU3R5bGUiLCJoaWRlQWRkIiwib25UYWJDbGljayIsIm9uUHJldkNsaWNrIiwib25OZXh0Q2xpY2siLCJhbmltYXRlZCIsInRhYkJhckd1dHRlciIsInRhYkJhckV4dHJhQ29udGVudCIsInByZWZpeENscyIsImlua0JhckFuaW1hdGVkIiwidGFiUGFuZUFuaW1hdGVkIiwiaXNDYXJkIiwiY2xzIiwiY2hpbGRyZW5XaXRoQ2xvc2UiLCJDaGlsZHJlbiIsImNsb3NhYmxlIiwiY2hpbGQiLCJjbG9zZUljb24iLCJJY29uIiwib25DbGljayIsInRhYiIsImtleSIsImNyZWF0ZU5ld1RhYiIsInJlbmRlclRhYkJhciIsIlNjcm9sbGFibGVJbmtUYWJCYXIiLCJleHRyYUNvbnRlbnQiLCJzdHlsZSIsIlJjVGFicyIsInRhYkJhclBvc2l0aW9uIiwicmVuZGVyVGFiQ29udGVudCIsIlRhYkNvbnRlbnQiLCJhbmltYXRlZFdpdGhNYXJnaW4iLCJoYW5kbGVDaGFuZ2UiLCJUYWJQYW5lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLE1BQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFNBQUEsR0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBOztBQUNBLElBQUEsV0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsS0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFB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QUE0QixDQUFBLEdBQUEsU0FBQSxDQUFBLFNBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBa0IsS0FBbEIsS0FBQSxFQUE4QjtBQUFFbkIsUUFBQUEsU0FBUyxFQUFYLFNBQUE7QUFBd0JiLFFBQUFBLFNBQVMsRUFBakMsR0FBQTtBQUF3Q2lDLFFBQUFBLGNBQWMsRUFBdEQsV0FBQTtBQUFxRUwsUUFBQUEsWUFBWSxFQUFqRixZQUFBO0FBQWlHTSxRQUFBQSxnQkFBZ0IsRUFBRSxTQUFBLGdCQUFBLEdBQUE7QUFBQSxpQkFBTSxNQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsYUFBQSxDQUFvQkMsS0FBQUEsQ0FBcEIsVUFBQSxFQUFnQztBQUFFekIsWUFBQUEsUUFBUSxFQUFWLGVBQUE7QUFBNkIwQixZQUFBQSxrQkFBa0IsRUFBRTtBQUFqRCxXQUFoQyxDQUFOO0FBQW5ILFNBQUE7QUFBbU54QyxRQUFBQSxRQUFRLEVBQUUsS0FBS3lDO0FBQWxPLE9BQTlCLENBQTVCLEVBQTZTbkIsaUJBQWlCLENBQWpCQSxNQUFBQSxHQUFBQSxDQUFBQSxHQUFBQSxpQkFBQUEsR0FBclQsUUFBUSxDQUFSO0FBQ0g7OztFQTVFNkJ6QixNQUFBQSxDQUFBQSxTOzs7QUE4RWxDRCxJQUFJLENBQUpBLFdBQUFBLEdBQUFBLE1BQUFBO0FBQ0FBLElBQUksQ0FBSkEsT0FBQUEsR0FBZThDLEtBQUFBLENBQWY5QyxPQUFBQTtBQUNBQSxJQUFJLENBQUpBLFlBQUFBLEdBQW9CO0FBQ2hCYyxFQUFBQSxPQUFPLEVBQUU7QUFETyxDQUFwQmQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ2hpbGRyZW4sIGNsb25lRWxlbWVudCwgQ29tcG9uZW50LCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGZpbmRET01Ob2RlIH0gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgd2FybmluZyBmcm9tICcuLi9fdXRpbC93YXJuaW5nJztcbmltcG9ydCBpc0ZsZXhTdXBwb3J0ZWQgZnJvbSAnLi4vX3V0aWwvaXNGbGV4U3VwcG9ydGVkJztcbmltcG9ydCBSY1RhYnMsIHsgVGFiQ29udGVudCwgVGFiUGFuZSB9IGZyb20gJy4uL3JjLWNvbXBvbmVudHMvdGFicyc7XG5pbXBvcnQgU2Nyb2xsYWJsZUlua1RhYkJhciBmcm9tICcuLi9yYy1jb21wb25lbnRzL3RhYnMvU2Nyb2xsYWJsZUlua1RhYkJhcic7XG5pbXBvcnQgeyBnZW5lcmF0ZUtleSB9IGZyb20gJy4uL3JjLWNvbXBvbmVudHMvdGFicy91dGlscyc7XG5pbXBvcnQgeyBnZXRQcmVmaXhDbHMgfSBmcm9tICcuLi9jb25maWd1cmUnO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGFicyBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMuY3JlYXRlTmV3VGFiID0gdGFyZ2V0S2V5ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgb25FZGl0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICAgICAgaWYgKG9uRWRpdCkge1xuICAgICAgICAgICAgICAgIG9uRWRpdCh0YXJnZXRLZXksICdhZGQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5yZW1vdmVUYWIgPSAodGFyZ2V0S2V5LCBlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgaWYgKCF0YXJnZXRLZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IG9uRWRpdCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgICAgIGlmIChvbkVkaXQpIHtcbiAgICAgICAgICAgICAgICBvbkVkaXQodGFyZ2V0S2V5LCAncmVtb3ZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlID0gKGFjdGl2ZUtleSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgICAgIGlmIChvbkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIG9uQ2hhbmdlKGFjdGl2ZUtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCBOT19GTEVYID0gJyBuby1mbGV4JztcbiAgICAgICAgY29uc3QgdGFiTm9kZSA9IGZpbmRET01Ob2RlKHRoaXMpO1xuICAgICAgICBpZiAodGFiTm9kZSAmJiAhaXNGbGV4U3VwcG9ydGVkKCkgJiYgdGFiTm9kZS5jbGFzc05hbWUuaW5kZXhPZihOT19GTEVYKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRhYk5vZGUuY2xhc3NOYW1lICs9IE5PX0ZMRVg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHByZWZpeENsczogY3VzdG9taXplUHJlZml4Q2xzLCBjbGFzc05hbWUgPSAnJywgc2l6ZSwgdHlwZSA9IFwibGluZVwiIC8qIGxpbmUgKi8sIHRhYlBvc2l0aW9uLCBjaGlsZHJlbiwgdGFiQmFyU3R5bGUsIGhpZGVBZGQsIG9uVGFiQ2xpY2ssIG9uUHJldkNsaWNrLCBvbk5leHRDbGljaywgYW5pbWF0ZWQgPSB0cnVlLCB0YWJCYXJHdXR0ZXIsIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBsZXQgeyB0YWJCYXJFeHRyYUNvbnRlbnQgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHByZWZpeENscyA9IGdldFByZWZpeENscygndGFicycsIGN1c3RvbWl6ZVByZWZpeENscyk7XG4gICAgICAgIGNvbnN0IGlua0JhckFuaW1hdGVkID0gdHlwZW9mIGFuaW1hdGVkID09PSAnb2JqZWN0JyA/IGFuaW1hdGVkLmlua0JhciA6IGFuaW1hdGVkO1xuICAgICAgICBsZXQgdGFiUGFuZUFuaW1hdGVkID0gdHlwZW9mIGFuaW1hdGVkID09PSAnb2JqZWN0JyA/IGFuaW1hdGVkLnRhYlBhbmUgOiBhbmltYXRlZDtcbiAgICAgICAgLy8gY2FyZCB0YWJzIHNob3VsZCBub3QgaGF2ZSBhbmltYXRpb25cbiAgICAgICAgaWYgKHR5cGUgIT09IFwibGluZVwiIC8qIGxpbmUgKi8pIHtcbiAgICAgICAgICAgIHRhYlBhbmVBbmltYXRlZCA9ICdhbmltYXRlZCcgaW4gdGhpcy5wcm9wcyA/IHRhYlBhbmVBbmltYXRlZCA6IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzQ2FyZCA9IHR5cGUgPT09IFwiY2FyZFwiIC8qIGNhcmQgKi8gfHwgdHlwZSA9PT0gXCJlZGl0YWJsZS1jYXJkXCIgLyogJ2VkaXRhYmxlLWNhcmQnICovO1xuICAgICAgICB3YXJuaW5nKCEoaXNDYXJkICYmIChzaXplID09PSBcInNtYWxsXCIgLyogc21hbGwgKi8gfHwgc2l6ZSA9PT0gXCJsYXJnZVwiIC8qIGxhcmdlICovKSksIFwiVGFic1t0eXBlPWNhcmR8ZWRpdGFibGUtY2FyZF0gZG9lc24ndCBoYXZlIHNtYWxsIG9yIGxhcmdlIHNpemUsIGl0J3MgYnkgZGVzaWduZWQuXCIpO1xuICAgICAgICBjb25zdCBjbHMgPSBjbGFzc05hbWVzKGNsYXNzTmFtZSwgYCR7cHJlZml4Q2xzfS0ke3R5cGV9YCwge1xuICAgICAgICAgICAgW2Ake3ByZWZpeENsc30tdmVydGljYWxgXTogdGFiUG9zaXRpb24gPT09IFwibGVmdFwiIC8qIGxlZnQgKi8gfHwgdGFiUG9zaXRpb24gPT09IFwicmlnaHRcIiAvKiByaWdodCAqLyxcbiAgICAgICAgICAgIFtgJHtwcmVmaXhDbHN9LSR7c2l6ZX1gXTogISFzaXplLFxuICAgICAgICAgICAgW2Ake3ByZWZpeENsc30tY2FyZGBdOiBpc0NhcmQsXG4gICAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1uby1hbmltYXRpb25gXTogIXRhYlBhbmVBbmltYXRlZCxcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIG9ubHkgY2FyZCB0eXBlIHRhYnMgY2FuIGJlIGFkZGVkIGFuZCBjbG9zZWRcbiAgICAgICAgbGV0IGNoaWxkcmVuV2l0aENsb3NlID0gW107XG4gICAgICAgIGlmICh0eXBlID09PSBcImVkaXRhYmxlLWNhcmRcIiAvKiAnZWRpdGFibGUtY2FyZCcgKi8pIHtcbiAgICAgICAgICAgIGNoaWxkcmVuV2l0aENsb3NlID0gW107XG4gICAgICAgICAgICBDaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoY2hpbGQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGNsb3NhYmxlID0gY2hpbGQucHJvcHMuY2xvc2FibGU7XG4gICAgICAgICAgICAgICAgY2xvc2FibGUgPSB0eXBlb2YgY2xvc2FibGUgPT09ICd1bmRlZmluZWQnID8gdHJ1ZSA6IGNsb3NhYmxlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsb3NlSWNvbiA9IGNsb3NhYmxlID8gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbiwgeyB0eXBlOiBcImNsb3NlXCIsIG9uQ2xpY2s6IGUgPT4gdGhpcy5yZW1vdmVUYWIoY2hpbGQua2V5LCBlKSB9KSkgOiBudWxsO1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuV2l0aENsb3NlLnB1c2goY2xvbmVFbGVtZW50KGNoaWxkLCB7XG4gICAgICAgICAgICAgICAgICAgIHRhYjogKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IGNsb3NhYmxlID8gdW5kZWZpbmVkIDogYCR7cHJlZml4Q2xzfS10YWItdW5jbG9zYWJsZWAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnByb3BzLnRhYixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlSWNvbikpLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IGdlbmVyYXRlS2V5KGNoaWxkLmtleSwgaW5kZXgpLFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gQWRkIG5ldyB0YWIgaGFuZGxlclxuICAgICAgICAgICAgaWYgKCFoaWRlQWRkKSB7XG4gICAgICAgICAgICAgICAgdGFiQmFyRXh0cmFDb250ZW50ID0gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIG51bGwsXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbiwgeyB0eXBlOiBcInBsdXNcIiwgY2xhc3NOYW1lOiBgJHtwcmVmaXhDbHN9LW5ldy10YWJgLCBvbkNsaWNrOiB0aGlzLmNyZWF0ZU5ld1RhYiB9KSxcbiAgICAgICAgICAgICAgICAgICAgdGFiQmFyRXh0cmFDb250ZW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGFiQmFyRXh0cmFDb250ZW50ID0gdGFiQmFyRXh0cmFDb250ZW50ID8gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IGAke3ByZWZpeENsc30tZXh0cmEtY29udGVudGAgfSwgdGFiQmFyRXh0cmFDb250ZW50KSkgOiBudWxsO1xuICAgICAgICBjb25zdCByZW5kZXJUYWJCYXIgPSAoKSA9PiAoUmVhY3QuY3JlYXRlRWxlbWVudChTY3JvbGxhYmxlSW5rVGFiQmFyLCB7IGlua0JhckFuaW1hdGVkOiBpbmtCYXJBbmltYXRlZCwgZXh0cmFDb250ZW50OiB0YWJCYXJFeHRyYUNvbnRlbnQsIG9uVGFiQ2xpY2s6IG9uVGFiQ2xpY2ssIG9uUHJldkNsaWNrOiBvblByZXZDbGljaywgb25OZXh0Q2xpY2s6IG9uTmV4dENsaWNrLCBzdHlsZTogdGFiQmFyU3R5bGUsIHRhYkJhckd1dHRlcjogdGFiQmFyR3V0dGVyIH0pKTtcbiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFJjVGFicywgT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5wcm9wcywgeyBwcmVmaXhDbHM6IHByZWZpeENscywgY2xhc3NOYW1lOiBjbHMsIHRhYkJhclBvc2l0aW9uOiB0YWJQb3NpdGlvbiwgcmVuZGVyVGFiQmFyOiByZW5kZXJUYWJCYXIsIHJlbmRlclRhYkNvbnRlbnQ6ICgpID0+IFJlYWN0LmNyZWF0ZUVsZW1lbnQoVGFiQ29udGVudCwgeyBhbmltYXRlZDogdGFiUGFuZUFuaW1hdGVkLCBhbmltYXRlZFdpdGhNYXJnaW46IHRydWUgfSksIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUNoYW5nZSB9KSwgY2hpbGRyZW5XaXRoQ2xvc2UubGVuZ3RoID4gMCA/IGNoaWxkcmVuV2l0aENsb3NlIDogY2hpbGRyZW4pKTtcbiAgICB9XG59XG5UYWJzLmRpc3BsYXlOYW1lID0gJ1RhYnMnO1xuVGFicy5UYWJQYW5lID0gVGFiUGFuZTtcblRhYnMuZGVmYXVsdFByb3BzID0ge1xuICAgIGhpZGVBZGQ6IGZhbHNlLFxufTtcbiJdfQ==