421408003d6f6a58d0a8af6ba2d3c45e
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireDefault(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _createReactClass = _interopRequireDefault(require("create-react-class"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _moment = _interopRequireDefault(require("moment"));

var DateInput = (0, _createReactClass["default"])({
  displayName: "DateInput",
  propTypes: {
    prefixCls: _propTypes["default"].string,
    timePicker: _propTypes["default"].object,
    value: _propTypes["default"].object,
    disabledTime: _propTypes["default"].any,
    format: _propTypes["default"].string,
    locale: _propTypes["default"].object,
    disabledDate: _propTypes["default"].func,
    onChange: _propTypes["default"].func,
    onClear: _propTypes["default"].func,
    placeholder: _propTypes["default"].string,
    onSelect: _propTypes["default"].func,
    selectedValue: _propTypes["default"].object
  },
  getInitialState: function getInitialState() {
    var selectedValue = this.props.selectedValue;
    return {
      str: selectedValue && selectedValue.format(this.props.format) || '',
      invalid: false
    };
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    this.cachedSelectionStart = this.dateInputInstance.selectionStart;
    this.cachedSelectionEnd = this.dateInputInstance.selectionEnd; // when popup show, click body will call this, bug!

    var selectedValue = nextProps.selectedValue;
    this.setState({
      str: selectedValue && selectedValue.format(nextProps.format) || '',
      invalid: false
    });
  },
  componentDidUpdate: function componentDidUpdate() {
    if (!this.state.invalid) {
      this.dateInputInstance.setSelectionRange(this.cachedSelectionStart, this.cachedSelectionEnd);
    }
  },
  onInputChange: function onInputChange(event) {
    var str = event.target.value;
    this.setState({
      str: str
    });
    var value;
    var _this$props = this.props,
        disabledDate = _this$props.disabledDate,
        format = _this$props.format,
        onChange = _this$props.onChange;

    if (str) {
      var parsed = (0, _moment["default"])(str, format, true);

      if (!parsed.isValid()) {
        this.setState({
          invalid: true
        });
        return;
      }

      value = this.props.value.clone();
      value.year(parsed.year()).month(parsed.month()).date(parsed.date()).hour(parsed.hour()).minute(parsed.minute()).second(parsed.second());

      if (value && (!disabledDate || !disabledDate(value))) {
        var originalValue = this.props.selectedValue;

        if (originalValue && value) {
          if (!originalValue.isSame(value)) {
            onChange(value);
          }
        } else if (originalValue !== value) {
          onChange(value);
        }
      } else {
        this.setState({
          invalid: true
        });
        return;
      }
    } else {
      onChange(null);
    }

    this.setState({
      invalid: false
    });
  },
  onClear: function onClear() {
    this.setState({
      str: ''
    });
    this.props.onClear(null);
  },
  getRootDOMNode: function getRootDOMNode() {
    return _reactDom["default"].findDOMNode(this);
  },
  focus: function focus() {
    if (this.dateInputInstance) {
      this.dateInputInstance.focus();
    }
  },
  saveDateInput: function saveDateInput(dateInput) {
    this.dateInputInstance = dateInput;
  },
  render: function render() {
    var props = this.props;
    var _this$state = this.state,
        invalid = _this$state.invalid,
        str = _this$state.str;
    var locale = props.locale,
        prefixCls = props.prefixCls,
        placeholder = props.placeholder;
    var invalidClass = invalid ? "".concat(prefixCls, "-input-invalid") : '';
    return _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-input-wrap")
    }, _react["default"].createElement("div", {
      className: "".concat(prefixCls, "-date-input-wrap")
    }, _react["default"].createElement("input", {
      ref: this.saveDateInput,
      className: "".concat(prefixCls, "-input ").concat(invalidClass),
      value: str,
      disabled: props.disabled,
      placeholder: placeholder,
      onChange: this.onInputChange
    })), props.showClear ? _react["default"].createElement("a", {
      className: "".concat(prefixCls, "-clear-btn"),
      role: "button",
      title: locale.clear,
      onClick: this.onClear
    }) : null);
  }
});
var _default = DateInput;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGVJbnB1dC5qc3giXSwibmFtZXMiOlsiRGF0ZUlucHV0IiwicHJvcFR5cGVzIiwicHJlZml4Q2xzIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwidGltZVBpY2tlciIsIm9iamVjdCIsInZhbHVlIiwiZGlzYWJsZWRUaW1lIiwiYW55IiwiZm9ybWF0IiwibG9jYWxlIiwiZGlzYWJsZWREYXRlIiwiZnVuYyIsIm9uQ2hhbmdlIiwib25DbGVhciIsInBsYWNlaG9sZGVyIiwib25TZWxlY3QiLCJzZWxlY3RlZFZhbHVlIiwiZ2V0SW5pdGlhbFN0YXRlIiwicHJvcHMiLCJzdHIiLCJpbnZhbGlkIiwiY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5leHRQcm9wcyIsImNhY2hlZFNlbGVjdGlvblN0YXJ0IiwiZGF0ZUlucHV0SW5zdGFuY2UiLCJzZWxlY3Rpb25TdGFydCIsImNhY2hlZFNlbGVjdGlvbkVuZCIsInNlbGVjdGlvbkVuZCIsInNldFN0YXRlIiwiY29tcG9uZW50RGlkVXBkYXRlIiwic3RhdGUiLCJzZXRTZWxlY3Rpb25SYW5nZSIsIm9uSW5wdXRDaGFuZ2UiLCJldmVudCIsInRhcmdldCIsInBhcnNlZCIsImlzVmFsaWQiLCJjbG9uZSIsInllYXIiLCJtb250aCIsImRhdGUiLCJob3VyIiwibWludXRlIiwic2Vjb25kIiwib3JpZ2luYWxWYWx1ZSIsImlzU2FtZSIsImdldFJvb3RET01Ob2RlIiwiUmVhY3RET00iLCJmaW5kRE9NTm9kZSIsImZvY3VzIiwic2F2ZURhdGVJbnB1dCIsImRhdGVJbnB1dCIsInJlbmRlciIsImludmFsaWRDbGFzcyIsImRpc2FibGVkIiwic2hvd0NsZWFyIiwiY2xlYXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQU1BLFNBQVMsR0FBRyxrQ0FBaUI7QUFBQTtBQUNqQ0MsRUFBQUEsU0FBUyxFQUFFO0FBQ1RDLElBQUFBLFNBQVMsRUFBRUMsc0JBQVVDLE1BRFo7QUFFVEMsSUFBQUEsVUFBVSxFQUFFRixzQkFBVUcsTUFGYjtBQUdUQyxJQUFBQSxLQUFLLEVBQUVKLHNCQUFVRyxNQUhSO0FBSVRFLElBQUFBLFlBQVksRUFBRUwsc0JBQVVNLEdBSmY7QUFLVEMsSUFBQUEsTUFBTSxFQUFFUCxzQkFBVUMsTUFMVDtBQU1UTyxJQUFBQSxNQUFNLEVBQUVSLHNCQUFVRyxNQU5UO0FBT1RNLElBQUFBLFlBQVksRUFBRVQsc0JBQVVVLElBUGY7QUFRVEMsSUFBQUEsUUFBUSxFQUFFWCxzQkFBVVUsSUFSWDtBQVNURSxJQUFBQSxPQUFPLEVBQUVaLHNCQUFVVSxJQVRWO0FBVVRHLElBQUFBLFdBQVcsRUFBRWIsc0JBQVVDLE1BVmQ7QUFXVGEsSUFBQUEsUUFBUSxFQUFFZCxzQkFBVVUsSUFYWDtBQVlUSyxJQUFBQSxhQUFhLEVBQUVmLHNCQUFVRztBQVpoQixHQURzQjtBQWdCakNhLEVBQUFBLGVBaEJpQyw2QkFnQmY7QUFDaEIsUUFBTUQsYUFBYSxHQUFHLEtBQUtFLEtBQUwsQ0FBV0YsYUFBakM7QUFDQSxXQUFPO0FBQ0xHLE1BQUFBLEdBQUcsRUFBRUgsYUFBYSxJQUFJQSxhQUFhLENBQUNSLE1BQWQsQ0FBcUIsS0FBS1UsS0FBTCxDQUFXVixNQUFoQyxDQUFqQixJQUE0RCxFQUQ1RDtBQUVMWSxNQUFBQSxPQUFPLEVBQUU7QUFGSixLQUFQO0FBSUQsR0F0QmdDO0FBd0JqQ0MsRUFBQUEseUJBeEJpQyxxQ0F3QlBDLFNBeEJPLEVBd0JJO0FBQ25DLFNBQUtDLG9CQUFMLEdBQTRCLEtBQUtDLGlCQUFMLENBQXVCQyxjQUFuRDtBQUNBLFNBQUtDLGtCQUFMLEdBQTBCLEtBQUtGLGlCQUFMLENBQXVCRyxZQUFqRCxDQUZtQyxDQUduQzs7QUFDQSxRQUFNWCxhQUFhLEdBQUdNLFNBQVMsQ0FBQ04sYUFBaEM7QUFDQSxTQUFLWSxRQUFMLENBQWM7QUFDWlQsTUFBQUEsR0FBRyxFQUFFSCxhQUFhLElBQUlBLGFBQWEsQ0FBQ1IsTUFBZCxDQUFxQmMsU0FBUyxDQUFDZCxNQUEvQixDQUFqQixJQUEyRCxFQURwRDtBQUVaWSxNQUFBQSxPQUFPLEVBQUU7QUFGRyxLQUFkO0FBSUQsR0FqQ2dDO0FBbUNqQ1MsRUFBQUEsa0JBbkNpQyxnQ0FtQ1o7QUFDbkIsUUFBSSxDQUFDLEtBQUtDLEtBQUwsQ0FBV1YsT0FBaEIsRUFBeUI7QUFDdkIsV0FBS0ksaUJBQUwsQ0FBdUJPLGlCQUF2QixDQUF5QyxLQUFLUixvQkFBOUMsRUFBb0UsS0FBS0csa0JBQXpFO0FBQ0Q7QUFDRixHQXZDZ0M7QUF5Q2pDTSxFQUFBQSxhQXpDaUMseUJBeUNuQkMsS0F6Q21CLEVBeUNaO0FBQ25CLFFBQU1kLEdBQUcsR0FBR2MsS0FBSyxDQUFDQyxNQUFOLENBQWE3QixLQUF6QjtBQUNBLFNBQUt1QixRQUFMLENBQWM7QUFDWlQsTUFBQUEsR0FBRyxFQUFIQTtBQURZLEtBQWQ7QUFHQSxRQUFJZCxLQUFKO0FBTG1CLHNCQU13QixLQUFLYSxLQU43QjtBQUFBLFFBTVhSLFlBTlcsZUFNWEEsWUFOVztBQUFBLFFBTUdGLE1BTkgsZUFNR0EsTUFOSDtBQUFBLFFBTVdJLFFBTlgsZUFNV0EsUUFOWDs7QUFPbkIsUUFBSU8sR0FBSixFQUFTO0FBQ1AsVUFBTWdCLE1BQU0sR0FBRyx3QkFBT2hCLEdBQVAsRUFBWVgsTUFBWixFQUFvQixJQUFwQixDQUFmOztBQUNBLFVBQUksQ0FBQzJCLE1BQU0sQ0FBQ0MsT0FBUCxFQUFMLEVBQXVCO0FBQ3JCLGFBQUtSLFFBQUwsQ0FBYztBQUNaUixVQUFBQSxPQUFPLEVBQUU7QUFERyxTQUFkO0FBR0E7QUFDRDs7QUFDRGYsTUFBQUEsS0FBSyxHQUFHLEtBQUthLEtBQUwsQ0FBV2IsS0FBWCxDQUFpQmdDLEtBQWpCLEVBQVI7QUFDQWhDLE1BQUFBLEtBQUssQ0FDRmlDLElBREgsQ0FDUUgsTUFBTSxDQUFDRyxJQUFQLEVBRFIsRUFFR0MsS0FGSCxDQUVTSixNQUFNLENBQUNJLEtBQVAsRUFGVCxFQUdHQyxJQUhILENBR1FMLE1BQU0sQ0FBQ0ssSUFBUCxFQUhSLEVBSUdDLElBSkgsQ0FJUU4sTUFBTSxDQUFDTSxJQUFQLEVBSlIsRUFLR0MsTUFMSCxDQUtVUCxNQUFNLENBQUNPLE1BQVAsRUFMVixFQU1HQyxNQU5ILENBTVVSLE1BQU0sQ0FBQ1EsTUFBUCxFQU5WOztBQVFBLFVBQUl0QyxLQUFLLEtBQUssQ0FBQ0ssWUFBRCxJQUFpQixDQUFDQSxZQUFZLENBQUNMLEtBQUQsQ0FBbkMsQ0FBVCxFQUFzRDtBQUNwRCxZQUFNdUMsYUFBYSxHQUFHLEtBQUsxQixLQUFMLENBQVdGLGFBQWpDOztBQUNBLFlBQUk0QixhQUFhLElBQUl2QyxLQUFyQixFQUE0QjtBQUMxQixjQUFJLENBQUN1QyxhQUFhLENBQUNDLE1BQWQsQ0FBcUJ4QyxLQUFyQixDQUFMLEVBQWtDO0FBQ2hDTyxZQUFBQSxRQUFRLENBQUNQLEtBQUQsQ0FBUjtBQUNEO0FBQ0YsU0FKRCxNQUlPLElBQUl1QyxhQUFhLEtBQUt2QyxLQUF0QixFQUE2QjtBQUNsQ08sVUFBQUEsUUFBUSxDQUFDUCxLQUFELENBQVI7QUFDRDtBQUNGLE9BVEQsTUFTTztBQUNMLGFBQUt1QixRQUFMLENBQWM7QUFDWlIsVUFBQUEsT0FBTyxFQUFFO0FBREcsU0FBZDtBQUdBO0FBQ0Q7QUFDRixLQWhDRCxNQWdDTztBQUNMUixNQUFBQSxRQUFRLENBQUMsSUFBRCxDQUFSO0FBQ0Q7O0FBQ0QsU0FBS2dCLFFBQUwsQ0FBYztBQUNaUixNQUFBQSxPQUFPLEVBQUU7QUFERyxLQUFkO0FBR0QsR0F0RmdDO0FBd0ZqQ1AsRUFBQUEsT0F4RmlDLHFCQXdGdkI7QUFDUixTQUFLZSxRQUFMLENBQWM7QUFDWlQsTUFBQUEsR0FBRyxFQUFFO0FBRE8sS0FBZDtBQUdBLFNBQUtELEtBQUwsQ0FBV0wsT0FBWCxDQUFtQixJQUFuQjtBQUNELEdBN0ZnQztBQStGakNpQyxFQUFBQSxjQS9GaUMsNEJBK0ZoQjtBQUNmLFdBQU9DLHFCQUFTQyxXQUFULENBQXFCLElBQXJCLENBQVA7QUFDRCxHQWpHZ0M7QUFtR2pDQyxFQUFBQSxLQW5HaUMsbUJBbUd6QjtBQUNOLFFBQUksS0FBS3pCLGlCQUFULEVBQTRCO0FBQzFCLFdBQUtBLGlCQUFMLENBQXVCeUIsS0FBdkI7QUFDRDtBQUNGLEdBdkdnQztBQXlHakNDLEVBQUFBLGFBekdpQyx5QkF5R25CQyxTQXpHbUIsRUF5R1I7QUFDdkIsU0FBSzNCLGlCQUFMLEdBQXlCMkIsU0FBekI7QUFDRCxHQTNHZ0M7QUE2R2pDQyxFQUFBQSxNQTdHaUMsb0JBNkd4QjtBQUNQLFFBQU1sQyxLQUFLLEdBQUcsS0FBS0EsS0FBbkI7QUFETyxzQkFFa0IsS0FBS1ksS0FGdkI7QUFBQSxRQUVDVixPQUZELGVBRUNBLE9BRkQ7QUFBQSxRQUVVRCxHQUZWLGVBRVVBLEdBRlY7QUFBQSxRQUdDVixNQUhELEdBR29DUyxLQUhwQyxDQUdDVCxNQUhEO0FBQUEsUUFHU1QsU0FIVCxHQUdvQ2tCLEtBSHBDLENBR1NsQixTQUhUO0FBQUEsUUFHb0JjLFdBSHBCLEdBR29DSSxLQUhwQyxDQUdvQkosV0FIcEI7QUFJUCxRQUFNdUMsWUFBWSxHQUFHakMsT0FBTyxhQUFNcEIsU0FBTixzQkFBa0MsRUFBOUQ7QUFDQSxXQUFRO0FBQUssTUFBQSxTQUFTLFlBQUtBLFNBQUw7QUFBZCxPQUNOO0FBQUssTUFBQSxTQUFTLFlBQUtBLFNBQUw7QUFBZCxPQUNFO0FBQ0UsTUFBQSxHQUFHLEVBQUUsS0FBS2tELGFBRFo7QUFFRSxNQUFBLFNBQVMsWUFBS2xELFNBQUwsb0JBQXdCcUQsWUFBeEIsQ0FGWDtBQUdFLE1BQUEsS0FBSyxFQUFFbEMsR0FIVDtBQUlFLE1BQUEsUUFBUSxFQUFFRCxLQUFLLENBQUNvQyxRQUpsQjtBQUtFLE1BQUEsV0FBVyxFQUFFeEMsV0FMZjtBQU1FLE1BQUEsUUFBUSxFQUFFLEtBQUtrQjtBQU5qQixNQURGLENBRE0sRUFXTGQsS0FBSyxDQUFDcUMsU0FBTixHQUFrQjtBQUNqQixNQUFBLFNBQVMsWUFBS3ZELFNBQUwsZUFEUTtBQUVqQixNQUFBLElBQUksRUFBQyxRQUZZO0FBR2pCLE1BQUEsS0FBSyxFQUFFUyxNQUFNLENBQUMrQyxLQUhHO0FBSWpCLE1BQUEsT0FBTyxFQUFFLEtBQUszQztBQUpHLE1BQWxCLEdBS0ksSUFoQkMsQ0FBUjtBQWtCRDtBQXBJZ0MsQ0FBakIsQ0FBbEI7ZUF1SWVmLFMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgY3JlYXRlUmVhY3RDbGFzcyBmcm9tICdjcmVhdGUtcmVhY3QtY2xhc3MnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcblxuY29uc3QgRGF0ZUlucHV0ID0gY3JlYXRlUmVhY3RDbGFzcyh7XG4gIHByb3BUeXBlczoge1xuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICB0aW1lUGlja2VyOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHZhbHVlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRpc2FibGVkVGltZTogUHJvcFR5cGVzLmFueSxcbiAgICBmb3JtYXQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgbG9jYWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGRpc2FibGVkRGF0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQ2xlYXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIHBsYWNlaG9sZGVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9uU2VsZWN0OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzZWxlY3RlZFZhbHVlOiBQcm9wVHlwZXMub2JqZWN0LFxuICB9LFxuXG4gIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICBjb25zdCBzZWxlY3RlZFZhbHVlID0gdGhpcy5wcm9wcy5zZWxlY3RlZFZhbHVlO1xuICAgIHJldHVybiB7XG4gICAgICBzdHI6IHNlbGVjdGVkVmFsdWUgJiYgc2VsZWN0ZWRWYWx1ZS5mb3JtYXQodGhpcy5wcm9wcy5mb3JtYXQpIHx8ICcnLFxuICAgICAgaW52YWxpZDogZmFsc2UsXG4gICAgfTtcbiAgfSxcblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIHRoaXMuY2FjaGVkU2VsZWN0aW9uU3RhcnQgPSB0aGlzLmRhdGVJbnB1dEluc3RhbmNlLnNlbGVjdGlvblN0YXJ0O1xuICAgIHRoaXMuY2FjaGVkU2VsZWN0aW9uRW5kID0gdGhpcy5kYXRlSW5wdXRJbnN0YW5jZS5zZWxlY3Rpb25FbmQ7XG4gICAgLy8gd2hlbiBwb3B1cCBzaG93LCBjbGljayBib2R5IHdpbGwgY2FsbCB0aGlzLCBidWchXG4gICAgY29uc3Qgc2VsZWN0ZWRWYWx1ZSA9IG5leHRQcm9wcy5zZWxlY3RlZFZhbHVlO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc3RyOiBzZWxlY3RlZFZhbHVlICYmIHNlbGVjdGVkVmFsdWUuZm9ybWF0KG5leHRQcm9wcy5mb3JtYXQpIHx8ICcnLFxuICAgICAgaW52YWxpZDogZmFsc2UsXG4gICAgfSk7XG4gIH0sXG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIGlmICghdGhpcy5zdGF0ZS5pbnZhbGlkKSB7XG4gICAgICB0aGlzLmRhdGVJbnB1dEluc3RhbmNlLnNldFNlbGVjdGlvblJhbmdlKHRoaXMuY2FjaGVkU2VsZWN0aW9uU3RhcnQsIHRoaXMuY2FjaGVkU2VsZWN0aW9uRW5kKTtcbiAgICB9XG4gIH0sXG5cbiAgb25JbnB1dENoYW5nZShldmVudCkge1xuICAgIGNvbnN0IHN0ciA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHN0cixcbiAgICB9KTtcbiAgICBsZXQgdmFsdWU7XG4gICAgY29uc3QgeyBkaXNhYmxlZERhdGUsIGZvcm1hdCwgb25DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKHN0cikge1xuICAgICAgY29uc3QgcGFyc2VkID0gbW9tZW50KHN0ciwgZm9ybWF0LCB0cnVlKTtcbiAgICAgIGlmICghcGFyc2VkLmlzVmFsaWQoKSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBpbnZhbGlkOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFsdWUgPSB0aGlzLnByb3BzLnZhbHVlLmNsb25lKCk7XG4gICAgICB2YWx1ZVxuICAgICAgICAueWVhcihwYXJzZWQueWVhcigpKVxuICAgICAgICAubW9udGgocGFyc2VkLm1vbnRoKCkpXG4gICAgICAgIC5kYXRlKHBhcnNlZC5kYXRlKCkpXG4gICAgICAgIC5ob3VyKHBhcnNlZC5ob3VyKCkpXG4gICAgICAgIC5taW51dGUocGFyc2VkLm1pbnV0ZSgpKVxuICAgICAgICAuc2Vjb25kKHBhcnNlZC5zZWNvbmQoKSk7XG5cbiAgICAgIGlmICh2YWx1ZSAmJiAoIWRpc2FibGVkRGF0ZSB8fCAhZGlzYWJsZWREYXRlKHZhbHVlKSkpIHtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxWYWx1ZSA9IHRoaXMucHJvcHMuc2VsZWN0ZWRWYWx1ZTtcbiAgICAgICAgaWYgKG9yaWdpbmFsVmFsdWUgJiYgdmFsdWUpIHtcbiAgICAgICAgICBpZiAoIW9yaWdpbmFsVmFsdWUuaXNTYW1lKHZhbHVlKSkge1xuICAgICAgICAgICAgb25DaGFuZ2UodmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChvcmlnaW5hbFZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICAgIG9uQ2hhbmdlKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgaW52YWxpZDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgb25DaGFuZ2UobnVsbCk7XG4gICAgfVxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgaW52YWxpZDogZmFsc2UsXG4gICAgfSk7XG4gIH0sXG5cbiAgb25DbGVhcigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHN0cjogJycsXG4gICAgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkNsZWFyKG51bGwpO1xuICB9LFxuXG4gIGdldFJvb3RET01Ob2RlKCkge1xuICAgIHJldHVybiBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKTtcbiAgfSxcblxuICBmb2N1cygpIHtcbiAgICBpZiAodGhpcy5kYXRlSW5wdXRJbnN0YW5jZSkge1xuICAgICAgdGhpcy5kYXRlSW5wdXRJbnN0YW5jZS5mb2N1cygpO1xuICAgIH1cbiAgfSxcblxuICBzYXZlRGF0ZUlucHV0KGRhdGVJbnB1dCkge1xuICAgIHRoaXMuZGF0ZUlucHV0SW5zdGFuY2UgPSBkYXRlSW5wdXQ7XG4gIH0sXG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGludmFsaWQsIHN0ciB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IGxvY2FsZSwgcHJlZml4Q2xzLCBwbGFjZWhvbGRlciB9ID0gcHJvcHM7XG4gICAgY29uc3QgaW52YWxpZENsYXNzID0gaW52YWxpZCA/IGAke3ByZWZpeENsc30taW5wdXQtaW52YWxpZGAgOiAnJztcbiAgICByZXR1cm4gKDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWlucHV0LXdyYXBgfT5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWRhdGUtaW5wdXQtd3JhcGB9PlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICByZWY9e3RoaXMuc2F2ZURhdGVJbnB1dH1cbiAgICAgICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taW5wdXQgJHtpbnZhbGlkQ2xhc3N9YH1cbiAgICAgICAgICB2YWx1ZT17c3RyfVxuICAgICAgICAgIGRpc2FibGVkPXtwcm9wcy5kaXNhYmxlZH1cbiAgICAgICAgICBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9XG4gICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25JbnB1dENoYW5nZX1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAge3Byb3BzLnNob3dDbGVhciA/IDxhXG4gICAgICAgIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1jbGVhci1idG5gfVxuICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgdGl0bGU9e2xvY2FsZS5jbGVhcn1cbiAgICAgICAgb25DbGljaz17dGhpcy5vbkNsZWFyfVxuICAgICAgLz4gOiBudWxsfVxuICAgIDwvZGl2Pik7XG4gIH0sXG59KTtcblxuZXhwb3J0IGRlZmF1bHQgRGF0ZUlucHV0O1xuIl19