ca6e011fc98ccf45beaa6187a0dc0bf6
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _noop = _interopRequireDefault(require("lodash/noop"));

var _SubPopupMenu = _interopRequireWildcard(require("./SubPopupMenu"));

var Menu =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Menu, _Component);

  function Menu(_props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Menu);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Menu).call(this, _props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "isRootMenu", true);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onSelect", function (selectInfo) {
      var props = _this.props;

      if (props.selectable) {
        // root menu
        var selectedKeys = _this.store.getState().selectedKeys;

        var selectedKey = selectInfo.key;

        if (props.multiple) {
          selectedKeys = selectedKeys.concat([selectedKey]);
        } else {
          selectedKeys = [selectedKey];
        }

        if (!('selectedKeys' in props)) {
          _this.store.setState({
            selectedKeys: selectedKeys
          });
        }

        props.onSelect((0, _objectSpread2["default"])({}, selectInfo, {
          selectedKeys: selectedKeys
        }));
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onClick", function (e) {
      _this.props.onClick(e);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onKeyDown", function (e, callback) {
      return _this.innerMenu.getWrappedInstance().onKeyDown(e, callback);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onOpenChange", function (event) {
      var props = _this.props;

      var openKeys = _this.store.getState().openKeys.concat();

      var changed = false;

      var processSingle = function processSingle(e) {
        var oneChanged = false;

        if (e.open) {
          oneChanged = openKeys.indexOf(e.key) === -1;

          if (oneChanged) {
            openKeys.push(e.key);
          }
        } else {
          var index = openKeys.indexOf(e.key);
          oneChanged = index !== -1;

          if (oneChanged) {
            openKeys.splice(index, 1);
          }
        }

        changed = changed || oneChanged;
      };

      if (Array.isArray(event)) {
        // batch change call
        event.forEach(processSingle);
      } else {
        processSingle(event);
      }

      if (changed) {
        if (!('openKeys' in _this.props)) {
          _this.store.setState({
            openKeys: openKeys
          });
        }

        props.onOpenChange(openKeys);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onDeselect", function (selectInfo) {
      var props = _this.props;

      if (props.selectable) {
        var selectedKeys = _this.store.getState().selectedKeys.concat();

        var selectedKey = selectInfo.key;
        var index = selectedKeys.indexOf(selectedKey);

        if (index !== -1) {
          selectedKeys.splice(index, 1);
        }

        if (!('selectedKeys' in props)) {
          _this.store.setState({
            selectedKeys: selectedKeys
          });
        }

        props.onDeselect((0, _objectSpread2["default"])({}, selectInfo, {
          selectedKeys: selectedKeys
        }));
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setInnerMenu", function (node) {
      _this.innerMenu = node;
    });
    var _selectedKeys = _props.defaultSelectedKeys;
    var _openKeys = _props.defaultOpenKeys;

    if ('selectedKeys' in _props) {
      _selectedKeys = _props.selectedKeys || [];
    }

    if ('openKeys' in _props) {
      _openKeys = _props.openKeys || [];
    }

    _this.store = (0, _miniStore.create)({
      selectedKeys: _selectedKeys,
      openKeys: _openKeys,
      activeKey: {
        '0-menu-': (0, _SubPopupMenu.getActiveKey)(_props, _props.activeKey)
      }
    });
    return _this;
  }

  (0, _createClass2["default"])(Menu, [{
    key: "updateMiniStore",
    value: function updateMiniStore() {
      if ('selectedKeys' in this.props) {
        this.store.setState({
          selectedKeys: this.props.selectedKeys || []
        });
      }

      if ('openKeys' in this.props) {
        this.store.setState({
          openKeys: this.props.openKeys || []
        });
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.updateMiniStore();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.updateMiniStore();
    }
  }, {
    key: "step",
    value: function step(direction) {
      return this.innerMenu.getWrappedInstance().step(direction);
    }
  }, {
    key: "getStore",
    value: function getStore() {
      var store = this.store || this.props.store;
      return store;
    }
  }, {
    key: "getEventKey",
    value: function getEventKey() {
      return this.props.eventKey || '0-menu-';
    }
  }, {
    key: "getOpenTransitionName",
    value: function getOpenTransitionName() {
      var props = this.props;
      var transitionName = props.openTransitionName;
      var animationName = props.openAnimation;

      if (!transitionName && typeof animationName === 'string') {
        transitionName = "".concat(props.prefixCls, "-open-").concat(animationName);
      }

      return transitionName;
    }
  }, {
    key: "isInlineMode",
    value: function isInlineMode() {
      return this.props.mode === 'inline';
    }
  }, {
    key: "lastOpenSubMenu",
    value: function lastOpenSubMenu() {
      var lastOpen = [];

      var _this$store$getState = this.store.getState(),
          openKeys = _this$store$getState.openKeys;

      if (openKeys.length) {
        lastOpen = this.getFlatInstanceArray().filter(function (c) {
          return c && openKeys.indexOf(c.props.eventKey) !== -1;
        });
      }

      return lastOpen[0];
    }
  }, {
    key: "renderMenuItem",
    value: function renderMenuItem(c, i, subIndex, subMenuKey) {
      if (!c) {
        return null;
      }

      var state = this.store.getState();
      var extraProps = {
        openKeys: state.openKeys,
        selectedKeys: state.selectedKeys,
        triggerSubMenuAction: this.props.triggerSubMenuAction,
        subMenuKey: subMenuKey
      };
      return this.renderCommonMenuItem(c, i, subIndex, extraProps);
    }
  }, {
    key: "render",
    value: function render() {
      var props = (0, _objectSpread2["default"])({}, this.props);
      props.className += " ".concat(props.prefixCls, "-root");
      props = (0, _objectSpread2["default"])({}, props, {
        onClick: this.onClick,
        onOpenChange: this.onOpenChange,
        onDeselect: this.onDeselect,
        onSelect: this.onSelect,
        parentMenu: this
      }); // delete props.openAnimation;
      // delete props.openTransitionName;

      return _react["default"].createElement(_miniStore.Provider, {
        store: this.store
      }, _react["default"].createElement(_SubPopupMenu["default"], (0, _extends2["default"])({}, props, {
        ref: this.setInnerMenu
      }), this.props.children));
    }
  }]);
  return Menu;
}(_react.Component);

exports["default"] = Menu;
(0, _defineProperty2["default"])(Menu, "displayName", 'Menu');
(0, _defineProperty2["default"])(Menu, "propTypes", {
  defaultSelectedKeys: _propTypes["default"].arrayOf(_propTypes["default"].string),
  selectedKeys: _propTypes["default"].arrayOf(_propTypes["default"].string),
  defaultOpenKeys: _propTypes["default"].arrayOf(_propTypes["default"].string),
  openKeys: _propTypes["default"].arrayOf(_propTypes["default"].string),
  mode: _propTypes["default"].oneOf(['horizontal', 'vertical', 'vertical-left', 'vertical-right', 'inline']),
  getPopupContainer: _propTypes["default"].func,
  onClick: _propTypes["default"].func,
  onSelect: _propTypes["default"].func,
  onDeselect: _propTypes["default"].func,
  onDestroy: _propTypes["default"].func,
  openTransitionName: _propTypes["default"].string,
  openAnimation: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].object]),
  subMenuOpenDelay: _propTypes["default"].number,
  subMenuCloseDelay: _propTypes["default"].number,
  forceSubMenuRender: _propTypes["default"].bool,
  triggerSubMenuAction: _propTypes["default"].string,
  level: _propTypes["default"].number,
  selectable: _propTypes["default"].bool,
  multiple: _propTypes["default"].bool,
  children: _propTypes["default"].any,
  focusable: _propTypes["default"].bool,
  style: _propTypes["default"].object,
  defaultActiveFirst: _propTypes["default"].bool,
  visible: _propTypes["default"].bool,
  activeKey: _propTypes["default"].string
});
(0, _defineProperty2["default"])(Menu, "defaultProps", {
  prefixCls: 'rc-menu',
  className: '',
  mode: 'vertical',
  level: 1,
  inlineIndent: 24,
  visible: true,
  focusable: true,
  style: {},
  selectable: true,
  onClick: _noop["default"],
  onSelect: _noop["default"],
  onOpenChange: _noop["default"],
  onDeselect: _noop["default"],
  defaultSelectedKeys: [],
  defaultOpenKeys: [],
  subMenuOpenDelay: 0.1,
  subMenuCloseDelay: 0.1,
  triggerSubMenuAction: 'hover'
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lbnUvTWVudS5qc3giXSwibmFtZXMiOlsiTWVudSIsIkNvbXBvbmVudCIsImRlZmF1bHRTZWxlY3RlZEtleXMiLCJQcm9wVHlwZXMiLCJzZWxlY3RlZEtleXMiLCJkZWZhdWx0T3BlbktleXMiLCJvcGVuS2V5cyIsIm1vZGUiLCJnZXRQb3B1cENvbnRhaW5lciIsIm9uQ2xpY2siLCJvblNlbGVjdCIsIm9uRGVzZWxlY3QiLCJvbkRlc3Ryb3kiLCJvcGVuVHJhbnNpdGlvbk5hbWUiLCJvcGVuQW5pbWF0aW9uIiwic3ViTWVudU9wZW5EZWxheSIsInN1Yk1lbnVDbG9zZURlbGF5IiwiZm9yY2VTdWJNZW51UmVuZGVyIiwidHJpZ2dlclN1Yk1lbnVBY3Rpb24iLCJsZXZlbCIsInNlbGVjdGFibGUiLCJtdWx0aXBsZSIsImNoaWxkcmVuIiwiZm9jdXNhYmxlIiwic3R5bGUiLCJkZWZhdWx0QWN0aXZlRmlyc3QiLCJ2aXNpYmxlIiwiYWN0aXZlS2V5Iiwic3RyaW5nIiwicHJlZml4Q2xzIiwiY2xhc3NOYW1lIiwiaW5saW5lSW5kZW50Iiwibm9vcCIsIm9uT3BlbkNoYW5nZSIsInByb3BzIiwic2VsZWN0ZWRLZXkiLCJzZWxlY3RJbmZvIiwiZGlyZWN0aW9uIiwiY2hhbmdlZCIsInByb2Nlc3NTaW5nbGUiLCJvbmVDaGFuZ2VkIiwiZSIsImluZGV4IiwiQXJyYXkiLCJldmVudCIsInN0b3JlIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb25OYW1lIiwibGFzdE9wZW4iLCJjIiwiaSIsInN1YkluZGV4Iiwic3ViTWVudUtleSIsInN0YXRlIiwiZXh0cmFQcm9wcyIsInBhcmVudE1lbnUiLCJzZXRJbm5lck1lbnUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENB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QVlwQkMsRUFBQUEsWUFBWSxFQUFFRCxLQUFBQSxDQVpNLFNBWU5BLENBWk07QUFhcEJyQixFQUFBQSxVQUFVLEVBQUVxQixLQUFBQSxDQWJRLFNBYVJBLENBYlE7QUFjcEI5QixFQUFBQSxtQkFBbUIsRUFkQyxFQUFBO0FBZXBCRyxFQUFBQSxlQUFlLEVBZkssRUFBQTtBQWdCcEJVLEVBQUFBLGdCQUFnQixFQWhCSSxHQUFBO0FBaUJwQkMsRUFBQUEsaUJBQWlCLEVBakJHLEdBQUE7QUFrQnBCRSxFQUFBQSxvQkFBb0IsRUFBRTtBQWxCRixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBjcmVhdGUsIFByb3ZpZGVyIH0gZnJvbSAnbWluaS1zdG9yZSc7XG5pbXBvcnQgbm9vcCBmcm9tICdsb2Rhc2gvbm9vcCc7XG5pbXBvcnQgU3ViUG9wdXBNZW51LCB7IGdldEFjdGl2ZUtleSB9IGZyb20gJy4vU3ViUG9wdXBNZW51JztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVudSBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdNZW51JztcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGRlZmF1bHRTZWxlY3RlZEtleXM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLFxuICAgIHNlbGVjdGVkS2V5czogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZyksXG4gICAgZGVmYXVsdE9wZW5LZXlzOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc3RyaW5nKSxcbiAgICBvcGVuS2V5czogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnN0cmluZyksXG4gICAgbW9kZTogUHJvcFR5cGVzLm9uZU9mKFsnaG9yaXpvbnRhbCcsICd2ZXJ0aWNhbCcsICd2ZXJ0aWNhbC1sZWZ0JywgJ3ZlcnRpY2FsLXJpZ2h0JywgJ2lubGluZSddKSxcbiAgICBnZXRQb3B1cENvbnRhaW5lcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DbGljazogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uRGVzZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uRGVzdHJveTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb3BlblRyYW5zaXRpb25OYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9wZW5BbmltYXRpb246IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5zdHJpbmcsIFByb3BUeXBlcy5vYmplY3RdKSxcbiAgICBzdWJNZW51T3BlbkRlbGF5OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHN1Yk1lbnVDbG9zZURlbGF5OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGZvcmNlU3ViTWVudVJlbmRlcjogUHJvcFR5cGVzLmJvb2wsXG4gICAgdHJpZ2dlclN1Yk1lbnVBY3Rpb246IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgbGV2ZWw6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgc2VsZWN0YWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgbXVsdGlwbGU6IFByb3BUeXBlcy5ib29sLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55LFxuICAgIGZvY3VzYWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZGVmYXVsdEFjdGl2ZUZpcnN0OiBQcm9wVHlwZXMuYm9vbCxcbiAgICB2aXNpYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBhY3RpdmVLZXk6IFByb3BUeXBlcy5zdHJpbmcsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBwcmVmaXhDbHM6ICdyYy1tZW51JyxcbiAgICBjbGFzc05hbWU6ICcnLFxuICAgIG1vZGU6ICd2ZXJ0aWNhbCcsXG4gICAgbGV2ZWw6IDEsXG4gICAgaW5saW5lSW5kZW50OiAyNCxcbiAgICB2aXNpYmxlOiB0cnVlLFxuICAgIGZvY3VzYWJsZTogdHJ1ZSxcbiAgICBzdHlsZToge30sXG4gICAgc2VsZWN0YWJsZTogdHJ1ZSxcbiAgICBvbkNsaWNrOiBub29wLFxuICAgIG9uU2VsZWN0OiBub29wLFxuICAgIG9uT3BlbkNoYW5nZTogbm9vcCxcbiAgICBvbkRlc2VsZWN0OiBub29wLFxuICAgIGRlZmF1bHRTZWxlY3RlZEtleXM6IFtdLFxuICAgIGRlZmF1bHRPcGVuS2V5czogW10sXG4gICAgc3ViTWVudU9wZW5EZWxheTogMC4xLFxuICAgIHN1Yk1lbnVDbG9zZURlbGF5OiAwLjEsXG4gICAgdHJpZ2dlclN1Yk1lbnVBY3Rpb246ICdob3ZlcicsXG4gIH07XG5cbiAgaXNSb290TWVudSA9IHRydWU7XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgbGV0IHNlbGVjdGVkS2V5cyA9IHByb3BzLmRlZmF1bHRTZWxlY3RlZEtleXM7XG4gICAgbGV0IG9wZW5LZXlzID0gcHJvcHMuZGVmYXVsdE9wZW5LZXlzO1xuICAgIGlmICgnc2VsZWN0ZWRLZXlzJyBpbiBwcm9wcykge1xuICAgICAgc2VsZWN0ZWRLZXlzID0gcHJvcHMuc2VsZWN0ZWRLZXlzIHx8IFtdO1xuICAgIH1cbiAgICBpZiAoJ29wZW5LZXlzJyBpbiBwcm9wcykge1xuICAgICAgb3BlbktleXMgPSBwcm9wcy5vcGVuS2V5cyB8fCBbXTtcbiAgICB9XG5cbiAgICB0aGlzLnN0b3JlID0gY3JlYXRlKHtcbiAgICAgIHNlbGVjdGVkS2V5cyxcbiAgICAgIG9wZW5LZXlzLFxuICAgICAgYWN0aXZlS2V5OiB7ICcwLW1lbnUtJzogZ2V0QWN0aXZlS2V5KHByb3BzLCBwcm9wcy5hY3RpdmVLZXkpIH0sXG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGVNaW5pU3RvcmUoKSB7XG4gICAgaWYgKCdzZWxlY3RlZEtleXMnIGluIHRoaXMucHJvcHMpIHtcbiAgICAgIHRoaXMuc3RvcmUuc2V0U3RhdGUoe1xuICAgICAgICBzZWxlY3RlZEtleXM6IHRoaXMucHJvcHMuc2VsZWN0ZWRLZXlzIHx8IFtdLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICgnb3BlbktleXMnIGluIHRoaXMucHJvcHMpIHtcbiAgICAgIHRoaXMuc3RvcmUuc2V0U3RhdGUoe1xuICAgICAgICBvcGVuS2V5czogdGhpcy5wcm9wcy5vcGVuS2V5cyB8fCBbXSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMudXBkYXRlTWluaVN0b3JlKCk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgdGhpcy51cGRhdGVNaW5pU3RvcmUoKTtcbiAgfVxuXG4gIG9uU2VsZWN0ID0gc2VsZWN0SW5mbyA9PiB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGlmIChwcm9wcy5zZWxlY3RhYmxlKSB7XG4gICAgICAvLyByb290IG1lbnVcbiAgICAgIGxldCBzZWxlY3RlZEtleXMgPSB0aGlzLnN0b3JlLmdldFN0YXRlKCkuc2VsZWN0ZWRLZXlzO1xuICAgICAgY29uc3Qgc2VsZWN0ZWRLZXkgPSBzZWxlY3RJbmZvLmtleTtcbiAgICAgIGlmIChwcm9wcy5tdWx0aXBsZSkge1xuICAgICAgICBzZWxlY3RlZEtleXMgPSBzZWxlY3RlZEtleXMuY29uY2F0KFtzZWxlY3RlZEtleV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZWN0ZWRLZXlzID0gW3NlbGVjdGVkS2V5XTtcbiAgICAgIH1cbiAgICAgIGlmICghKCdzZWxlY3RlZEtleXMnIGluIHByb3BzKSkge1xuICAgICAgICB0aGlzLnN0b3JlLnNldFN0YXRlKHtcbiAgICAgICAgICBzZWxlY3RlZEtleXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcHJvcHMub25TZWxlY3Qoe1xuICAgICAgICAuLi5zZWxlY3RJbmZvLFxuICAgICAgICBzZWxlY3RlZEtleXMsXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgc3RlcChkaXJlY3Rpb24pIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lck1lbnUuZ2V0V3JhcHBlZEluc3RhbmNlKCkuc3RlcChkaXJlY3Rpb24pO1xuICB9XG5cbiAgb25DbGljayA9IGUgPT4ge1xuICAgIHRoaXMucHJvcHMub25DbGljayhlKTtcbiAgfTtcblxuICBvbktleURvd24gPSAoZSwgY2FsbGJhY2spID0+IHtcbiAgICByZXR1cm4gdGhpcy5pbm5lck1lbnUuZ2V0V3JhcHBlZEluc3RhbmNlKCkub25LZXlEb3duKGUsIGNhbGxiYWNrKTtcbiAgfTtcblxuICBvbk9wZW5DaGFuZ2UgPSBldmVudCA9PiB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9wZW5LZXlzID0gdGhpcy5zdG9yZS5nZXRTdGF0ZSgpLm9wZW5LZXlzLmNvbmNhdCgpO1xuICAgIGxldCBjaGFuZ2VkID0gZmFsc2U7XG4gICAgY29uc3QgcHJvY2Vzc1NpbmdsZSA9IGUgPT4ge1xuICAgICAgbGV0IG9uZUNoYW5nZWQgPSBmYWxzZTtcbiAgICAgIGlmIChlLm9wZW4pIHtcbiAgICAgICAgb25lQ2hhbmdlZCA9IG9wZW5LZXlzLmluZGV4T2YoZS5rZXkpID09PSAtMTtcbiAgICAgICAgaWYgKG9uZUNoYW5nZWQpIHtcbiAgICAgICAgICBvcGVuS2V5cy5wdXNoKGUua2V5KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBvcGVuS2V5cy5pbmRleE9mKGUua2V5KTtcbiAgICAgICAgb25lQ2hhbmdlZCA9IGluZGV4ICE9PSAtMTtcbiAgICAgICAgaWYgKG9uZUNoYW5nZWQpIHtcbiAgICAgICAgICBvcGVuS2V5cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjaGFuZ2VkID0gY2hhbmdlZCB8fCBvbmVDaGFuZ2VkO1xuICAgIH07XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7XG4gICAgICAvLyBiYXRjaCBjaGFuZ2UgY2FsbFxuICAgICAgZXZlbnQuZm9yRWFjaChwcm9jZXNzU2luZ2xlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvY2Vzc1NpbmdsZShldmVudCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VkKSB7XG4gICAgICBpZiAoISgnb3BlbktleXMnIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc2V0U3RhdGUoeyBvcGVuS2V5cyB9KTtcbiAgICAgIH1cbiAgICAgIHByb3BzLm9uT3BlbkNoYW5nZShvcGVuS2V5cyk7XG4gICAgfVxuICB9O1xuXG4gIG9uRGVzZWxlY3QgPSBzZWxlY3RJbmZvID0+IHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgaWYgKHByb3BzLnNlbGVjdGFibGUpIHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkS2V5cyA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKS5zZWxlY3RlZEtleXMuY29uY2F0KCk7XG4gICAgICBjb25zdCBzZWxlY3RlZEtleSA9IHNlbGVjdEluZm8ua2V5O1xuICAgICAgY29uc3QgaW5kZXggPSBzZWxlY3RlZEtleXMuaW5kZXhPZihzZWxlY3RlZEtleSk7XG4gICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgIHNlbGVjdGVkS2V5cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgfVxuICAgICAgaWYgKCEoJ3NlbGVjdGVkS2V5cycgaW4gcHJvcHMpKSB7XG4gICAgICAgIHRoaXMuc3RvcmUuc2V0U3RhdGUoe1xuICAgICAgICAgIHNlbGVjdGVkS2V5cyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBwcm9wcy5vbkRlc2VsZWN0KHtcbiAgICAgICAgLi4uc2VsZWN0SW5mbyxcbiAgICAgICAgc2VsZWN0ZWRLZXlzLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIHNldElubmVyTWVudSA9IG5vZGUgPT4ge1xuICAgIHRoaXMuaW5uZXJNZW51ID0gbm9kZTtcbiAgfTtcblxuICBnZXRTdG9yZSgpIHtcbiAgICBjb25zdCBzdG9yZSA9IHRoaXMuc3RvcmUgfHwgdGhpcy5wcm9wcy5zdG9yZTtcblxuICAgIHJldHVybiBzdG9yZTtcbiAgfVxuXG4gIGdldEV2ZW50S2V5KCkge1xuICAgIHJldHVybiB0aGlzLnByb3BzLmV2ZW50S2V5IHx8ICcwLW1lbnUtJztcbiAgfVxuXG4gIGdldE9wZW5UcmFuc2l0aW9uTmFtZSgpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgbGV0IHRyYW5zaXRpb25OYW1lID0gcHJvcHMub3BlblRyYW5zaXRpb25OYW1lO1xuICAgIGNvbnN0IGFuaW1hdGlvbk5hbWUgPSBwcm9wcy5vcGVuQW5pbWF0aW9uO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgdHlwZW9mIGFuaW1hdGlvbk5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3Byb3BzLnByZWZpeENsc30tb3Blbi0ke2FuaW1hdGlvbk5hbWV9YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9XG5cbiAgaXNJbmxpbmVNb2RlKCkge1xuICAgIHJldHVybiB0aGlzLnByb3BzLm1vZGUgPT09ICdpbmxpbmUnO1xuICB9XG5cbiAgbGFzdE9wZW5TdWJNZW51KCkge1xuICAgIGxldCBsYXN0T3BlbiA9IFtdO1xuICAgIGNvbnN0IHsgb3BlbktleXMgfSA9IHRoaXMuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBpZiAob3BlbktleXMubGVuZ3RoKSB7XG4gICAgICBsYXN0T3BlbiA9IHRoaXMuZ2V0RmxhdEluc3RhbmNlQXJyYXkoKS5maWx0ZXIoYyA9PiB7XG4gICAgICAgIHJldHVybiBjICYmIG9wZW5LZXlzLmluZGV4T2YoYy5wcm9wcy5ldmVudEtleSkgIT09IC0xO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBsYXN0T3BlblswXTtcbiAgfVxuXG4gIHJlbmRlck1lbnVJdGVtKGMsIGksIHN1YkluZGV4LCBzdWJNZW51S2V5KSB7XG4gICAgaWYgKCFjKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgc3RhdGUgPSB0aGlzLnN0b3JlLmdldFN0YXRlKCk7XG4gICAgY29uc3QgZXh0cmFQcm9wcyA9IHtcbiAgICAgIG9wZW5LZXlzOiBzdGF0ZS5vcGVuS2V5cyxcbiAgICAgIHNlbGVjdGVkS2V5czogc3RhdGUuc2VsZWN0ZWRLZXlzLFxuICAgICAgdHJpZ2dlclN1Yk1lbnVBY3Rpb246IHRoaXMucHJvcHMudHJpZ2dlclN1Yk1lbnVBY3Rpb24sXG4gICAgICBzdWJNZW51S2V5LFxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyQ29tbW9uTWVudUl0ZW0oYywgaSwgc3ViSW5kZXgsIGV4dHJhUHJvcHMpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGxldCBwcm9wcyA9IHsgLi4udGhpcy5wcm9wcyB9O1xuICAgIHByb3BzLmNsYXNzTmFtZSArPSBgICR7cHJvcHMucHJlZml4Q2xzfS1yb290YDtcbiAgICBwcm9wcyA9IHtcbiAgICAgIC4uLnByb3BzLFxuICAgICAgb25DbGljazogdGhpcy5vbkNsaWNrLFxuICAgICAgb25PcGVuQ2hhbmdlOiB0aGlzLm9uT3BlbkNoYW5nZSxcbiAgICAgIG9uRGVzZWxlY3Q6IHRoaXMub25EZXNlbGVjdCxcbiAgICAgIG9uU2VsZWN0OiB0aGlzLm9uU2VsZWN0LFxuICAgICAgcGFyZW50TWVudTogdGhpcyxcbiAgICB9O1xuXG4gICAgLy8gZGVsZXRlIHByb3BzLm9wZW5BbmltYXRpb247XG4gICAgLy8gZGVsZXRlIHByb3BzLm9wZW5UcmFuc2l0aW9uTmFtZTtcbiAgICByZXR1cm4gKFxuICAgICAgPFByb3ZpZGVyIHN0b3JlPXt0aGlzLnN0b3JlfT5cbiAgICAgICAgPFN1YlBvcHVwTWVudSB7Li4ucHJvcHN9IHJlZj17dGhpcy5zZXRJbm5lck1lbnV9PlxuICAgICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgICA8L1N1YlBvcHVwTWVudT5cbiAgICAgIDwvUHJvdmlkZXI+XG4gICAgKTtcbiAgfVxufVxuIl19