a6442be3fd20e0110518ffd31b699b79
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _createReactClass = _interopRequireDefault(require("create-react-class"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _DateConstants = _interopRequireDefault(require("./DateConstants"));

var _util = require("../util/");

function isSameDay(one, two) {
  return one && two && one.isSame(two, 'day');
}

function beforeCurrentMonthYear(current, today) {
  if (current.year() < today.year()) {
    return 1;
  }

  return current.year() === today.year() && current.month() < today.month();
}

function afterCurrentMonthYear(current, today) {
  if (current.year() > today.year()) {
    return 1;
  }

  return current.year() === today.year() && current.month() > today.month();
}

function getIdFromDate(date) {
  return "rc-calendar-".concat(date.year(), "-").concat(date.month(), "-").concat(date.date());
}

var DateTBody = (0, _createReactClass["default"])({
  displayName: "DateTBody",
  propTypes: {
    contentRender: _propTypes["default"].func,
    dateRender: _propTypes["default"].func,
    disabledDate: _propTypes["default"].func,
    prefixCls: _propTypes["default"].string,
    selectedValue: _propTypes["default"].oneOfType([_propTypes["default"].object, _propTypes["default"].arrayOf(_propTypes["default"].object)]),
    value: _propTypes["default"].object,
    hoverValue: _propTypes["default"].any,
    showWeekNumber: _propTypes["default"].bool
  },
  getDefaultProps: function getDefaultProps() {
    return {
      hoverValue: []
    };
  },
  render: function render() {
    var props = this.props;
    var contentRender = props.contentRender,
        prefixCls = props.prefixCls,
        selectedValue = props.selectedValue,
        value = props.value,
        showWeekNumber = props.showWeekNumber,
        dateRender = props.dateRender,
        disabledDate = props.disabledDate,
        hoverValue = props.hoverValue;
    var iIndex;
    var jIndex;
    var current;
    var dateTable = [];
    var today = (0, _util.getTodayTime)(value);
    var cellClass = "".concat(prefixCls, "-cell");
    var weekNumberCellClass = "".concat(prefixCls, "-week-number-cell");
    var dateClass = "".concat(prefixCls, "-date");
    var todayClass = "".concat(prefixCls, "-today");
    var selectedClass = "".concat(prefixCls, "-selected-day");
    var selectedDateClass = "".concat(prefixCls, "-selected-date"); // do not move with mouse operation

    var selectedStartDateClass = "".concat(prefixCls, "-selected-start-date");
    var selectedEndDateClass = "".concat(prefixCls, "-selected-end-date");
    var inRangeClass = "".concat(prefixCls, "-in-range-cell");
    var lastMonthDayClass = "".concat(prefixCls, "-last-month-cell");
    var nextMonthDayClass = "".concat(prefixCls, "-next-month-btn-day");
    var disabledClass = "".concat(prefixCls, "-disabled-cell");
    var firstDisableClass = "".concat(prefixCls, "-disabled-cell-first-of-row");
    var lastDisableClass = "".concat(prefixCls, "-disabled-cell-last-of-row");
    var lastDayOfMonthClass = "".concat(prefixCls, "-last-day-of-month");
    var month1 = value.clone();
    month1.date(1);
    var day = month1.day();
    var lastMonthDiffDay = (day + 7 - value.localeData().firstDayOfWeek()) % 7; // calculate last month

    var lastMonth1 = month1.clone();
    lastMonth1.add(0 - lastMonthDiffDay, 'days');
    var passed = 0;

    for (iIndex = 0; iIndex < _DateConstants["default"].DATE_ROW_COUNT; iIndex++) {
      for (jIndex = 0; jIndex < _DateConstants["default"].DATE_COL_COUNT; jIndex++) {
        current = lastMonth1;

        if (passed) {
          current = current.clone();
          current.add(passed, 'days');
        }

        dateTable.push(current);
        passed++;
      }
    }

    var tableHtml = [];
    passed = 0;

    for (iIndex = 0; iIndex < _DateConstants["default"].DATE_ROW_COUNT; iIndex++) {
      var _cx;

      var isCurrentWeek = void 0;
      var weekNumberCell = void 0;
      var isActiveWeek = false;
      var dateCells = [];

      if (showWeekNumber) {
        weekNumberCell = _react["default"].createElement("td", {
          key: dateTable[passed].week(),
          role: "gridcell",
          className: weekNumberCellClass
        }, dateTable[passed].week());
      }

      for (jIndex = 0; jIndex < _DateConstants["default"].DATE_COL_COUNT; jIndex++) {
        var next = null;
        var last = null;
        current = dateTable[passed];

        if (jIndex < _DateConstants["default"].DATE_COL_COUNT - 1) {
          next = dateTable[passed + 1];
        }

        if (jIndex > 0) {
          last = dateTable[passed - 1];
        }

        var cls = cellClass;
        var disabled = false;
        var selected = false;

        if (isSameDay(current, today)) {
          cls += " ".concat(todayClass);
          isCurrentWeek = true;
        }

        var isBeforeCurrentMonthYear = beforeCurrentMonthYear(current, value);
        var isAfterCurrentMonthYear = afterCurrentMonthYear(current, value);

        if (selectedValue && Array.isArray(selectedValue)) {
          var rangeValue = hoverValue.length ? hoverValue : selectedValue;

          if (!isBeforeCurrentMonthYear && !isAfterCurrentMonthYear) {
            var startValue = rangeValue[0];
            var endValue = rangeValue[1];

            if (startValue) {
              if (isSameDay(current, startValue)) {
                selected = true;
                isActiveWeek = true;
                cls += " ".concat(selectedStartDateClass);
              }
            }

            if (startValue && endValue) {
              if (isSameDay(current, endValue)) {
                selected = true;
                isActiveWeek = true;
                cls += " ".concat(selectedEndDateClass);
              } else if (current.isAfter(startValue, 'day') && current.isBefore(endValue, 'day')) {
                cls += " ".concat(inRangeClass);
              }
            }
          }
        } else if (isSameDay(current, value)) {
          // keyboard change value, highlight works
          selected = true;
          isActiveWeek = true;
        }

        if (isSameDay(current, selectedValue)) {
          cls += " ".concat(selectedDateClass);
        }

        if (isBeforeCurrentMonthYear) {
          cls += " ".concat(lastMonthDayClass);
        }

        if (isAfterCurrentMonthYear) {
          cls += " ".concat(nextMonthDayClass);
        }

        if (current.clone().endOf('month').date() === current.date()) {
          cls += " ".concat(lastDayOfMonthClass);
        }

        if (disabledDate) {
          if (disabledDate(current, value)) {
            disabled = true;

            if (!last || !disabledDate(last, value)) {
              cls += " ".concat(firstDisableClass);
            }

            if (!next || !disabledDate(next, value)) {
              cls += " ".concat(lastDisableClass);
            }
          }
        }

        if (selected) {
          cls += " ".concat(selectedClass);
        }

        if (disabled) {
          cls += " ".concat(disabledClass);
        }

        var dateHtml = void 0;

        if (dateRender) {
          dateHtml = dateRender(current, value);
        } else {
          var content = contentRender ? contentRender(current, value) : current.date();
          dateHtml = _react["default"].createElement("div", {
            key: getIdFromDate(current),
            className: dateClass,
            "aria-selected": selected,
            "aria-disabled": disabled
          }, content);
        }

        dateCells.push(_react["default"].createElement("td", {
          key: passed,
          onClick: disabled ? undefined : props.onSelect.bind(null, current),
          onMouseEnter: disabled ? undefined : props.onDayHover && props.onDayHover.bind(null, current) || undefined,
          role: "gridcell",
          title: (0, _util.getTitleString)(current),
          className: cls
        }, dateHtml));
        passed++;
      }

      tableHtml.push(_react["default"].createElement("tr", {
        key: iIndex,
        role: "row",
        className: (0, _classnames["default"])((_cx = {}, (0, _defineProperty2["default"])(_cx, "".concat(prefixCls, "-current-week"), isCurrentWeek), (0, _defineProperty2["default"])(_cx, "".concat(prefixCls, "-active-week"), isActiveWeek), _cx))
      }, weekNumberCell, dateCells));
    }

    return _react["default"].createElement("tbody", {
      className: "".concat(prefixCls, "-tbody")
    }, tableHtml);
  }
});
var _default = DateTBody;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRhdGVUQm9keS5qc3giXSwibmFtZXMiOlsiaXNTYW1lRGF5Iiwib25lIiwidHdvIiwiaXNTYW1lIiwiYmVmb3JlQ3VycmVudE1vbnRoWWVhciIsImN1cnJlbnQiLCJ0b2RheSIsInllYXIiLCJtb250aCIsImFmdGVyQ3VycmVudE1vbnRoWWVhciIsImdldElkRnJvbURhdGUiLCJkYXRlIiwiRGF0ZVRCb2R5IiwicHJvcFR5cGVzIiwiY29udGVudFJlbmRlciIsIlByb3BUeXBlcyIsImZ1bmMiLCJkYXRlUmVuZGVyIiwiZGlzYWJsZWREYXRlIiwicHJlZml4Q2xzIiwic3RyaW5nIiwic2VsZWN0ZWRWYWx1ZSIsIm9uZU9mVHlwZSIsIm9iamVjdCIsImFycmF5T2YiLCJ2YWx1ZSIsImhvdmVyVmFsdWUiLCJhbnkiLCJzaG93V2Vla051bWJlciIsImJvb2wiLCJnZXREZWZhdWx0UHJvcHMiLCJyZW5kZXIiLCJwcm9wcyIsImlJbmRleCIsImpJbmRleCIsImRhdGVUYWJsZSIsImNlbGxDbGFzcyIsIndlZWtOdW1iZXJDZWxsQ2xhc3MiLCJkYXRlQ2xhc3MiLCJ0b2RheUNsYXNzIiwic2VsZWN0ZWRDbGFzcyIsInNlbGVjdGVkRGF0ZUNsYXNzIiwic2VsZWN0ZWRTdGFydERhdGVDbGFzcyIsInNlbGVjdGVkRW5kRGF0ZUNsYXNzIiwiaW5SYW5nZUNsYXNzIiwibGFzdE1vbnRoRGF5Q2xhc3MiLCJuZXh0TW9udGhEYXlDbGFzcyIsImRpc2FibGVkQ2xhc3MiLCJmaXJzdERpc2FibGVDbGFzcyIsImxhc3REaXNhYmxlQ2xhc3MiLCJsYXN0RGF5T2ZNb250aENsYXNzIiwibW9udGgxIiwiY2xvbmUiLCJkYXkiLCJsYXN0TW9udGhEaWZmRGF5IiwibG9jYWxlRGF0YSIsImZpcnN0RGF5T2ZXZWVrIiwibGFzdE1vbnRoMSIsImFkZCIsInBhc3NlZCIsIkRhdGVDb25zdGFudHMiLCJEQVRFX1JPV19DT1VOVCIsIkRBVEVfQ09MX0NPVU5UIiwicHVzaCIsInRhYmxlSHRtbCIsImlzQ3VycmVudFdlZWsiLCJ3ZWVrTnVtYmVyQ2VsbCIsImlzQWN0aXZlV2VlayIsImRhdGVDZWxscyIsIndlZWsiLCJuZXh0IiwibGFzdCIsImNscyIsImRpc2FibGVkIiwic2VsZWN0ZWQiLCJpc0JlZm9yZUN1cnJlbnRNb250aFllYXIiLCJpc0FmdGVyQ3VycmVudE1vbnRoWWVhciIsIkFycmF5IiwiaXNBcnJheSIsInJhbmdlVmFsdWUiLCJsZW5ndGgiLCJzdGFydFZhbHVlIiwiZW5kVmFsdWUiLCJpc0FmdGVyIiwiaXNCZWZvcmUiLCJlbmRPZiIsImRhdGVIdG1sIiwiY29udGVudCIsInVuZGVmaW5lZCIsIm9uU2VsZWN0IiwiYmluZCIsIm9uRGF5SG92ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsU0FBU0EsU0FBVCxDQUFtQkMsR0FBbkIsRUFBd0JDLEdBQXhCLEVBQTZCO0FBQzNCLFNBQU9ELEdBQUcsSUFBSUMsR0FBUCxJQUFjRCxHQUFHLENBQUNFLE1BQUosQ0FBV0QsR0FBWCxFQUFnQixLQUFoQixDQUFyQjtBQUNEOztBQUVELFNBQVNFLHNCQUFULENBQWdDQyxPQUFoQyxFQUF5Q0MsS0FBekMsRUFBZ0Q7QUFDOUMsTUFBSUQsT0FBTyxDQUFDRSxJQUFSLEtBQWlCRCxLQUFLLENBQUNDLElBQU4sRUFBckIsRUFBbUM7QUFDakMsV0FBTyxDQUFQO0FBQ0Q7O0FBQ0QsU0FBT0YsT0FBTyxDQUFDRSxJQUFSLE9BQW1CRCxLQUFLLENBQUNDLElBQU4sRUFBbkIsSUFDTEYsT0FBTyxDQUFDRyxLQUFSLEtBQWtCRixLQUFLLENBQUNFLEtBQU4sRUFEcEI7QUFFRDs7QUFFRCxTQUFTQyxxQkFBVCxDQUErQkosT0FBL0IsRUFBd0NDLEtBQXhDLEVBQStDO0FBQzdDLE1BQUlELE9BQU8sQ0FBQ0UsSUFBUixLQUFpQkQsS0FBSyxDQUFDQyxJQUFOLEVBQXJCLEVBQW1DO0FBQ2pDLFdBQU8sQ0FBUDtBQUNEOztBQUNE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Q0FOVDtBQU1rQyxVQUFBLFNBQVMsRUFBRW1FO0FBTjdDLFdBUUdjLFFBUkgsQ0FERjtBQVlBM0IsUUFBQUEsTUFBTTtBQUNQOztBQUdESyxNQUFBQSxTQUFTLENBQUNELElBQVYsQ0FDRTtBQUNFLFFBQUEsR0FBRyxFQUFFOUIsTUFEUDtBQUVFLFFBQUEsSUFBSSxFQUFDLEtBRlA7QUFHRSxRQUFBLFNBQVMsRUFBRSx1RkFDTGQsU0FESyxvQkFDc0I4QyxhQUR0QixtREFFTDlDLFNBRkssbUJBRXFCZ0QsWUFGckI7QUFIYixTQVFHRCxjQVJILEVBU0dFLFNBVEgsQ0FERjtBQVlEOztBQUNELFdBQVE7QUFBTyxNQUFBLFNBQVMsWUFBS2pELFNBQUw7QUFBaEIsT0FDTDZDLFNBREssQ0FBUjtBQUdEO0FBNU5nQyxDQUFqQixDQUFsQjtlQStOZXBELFMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IGNyZWF0ZVJlYWN0Q2xhc3MgZnJvbSAnY3JlYXRlLXJlYWN0LWNsYXNzJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgRGF0ZUNvbnN0YW50cyBmcm9tICcuL0RhdGVDb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0VGl0bGVTdHJpbmcsIGdldFRvZGF5VGltZSB9IGZyb20gJy4uL3V0aWwvJztcblxuZnVuY3Rpb24gaXNTYW1lRGF5KG9uZSwgdHdvKSB7XG4gIHJldHVybiBvbmUgJiYgdHdvICYmIG9uZS5pc1NhbWUodHdvLCAnZGF5Jyk7XG59XG5cbmZ1bmN0aW9uIGJlZm9yZUN1cnJlbnRNb250aFllYXIoY3VycmVudCwgdG9kYXkpIHtcbiAgaWYgKGN1cnJlbnQueWVhcigpIDwgdG9kYXkueWVhcigpKSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cbiAgcmV0dXJuIGN1cnJlbnQueWVhcigpID09PSB0b2RheS55ZWFyKCkgJiZcbiAgICBjdXJyZW50Lm1vbnRoKCkgPCB0b2RheS5tb250aCgpO1xufVxuXG5mdW5jdGlvbiBhZnRlckN1cnJlbnRNb250aFllYXIoY3VycmVudCwgdG9kYXkpIHtcbiAgaWYgKGN1cnJlbnQueWVhcigpID4gdG9kYXkueWVhcigpKSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cbiAgcmV0dXJuIGN1cnJlbnQueWVhcigpID09PSB0b2RheS55ZWFyKCkgJiZcbiAgICBjdXJyZW50Lm1vbnRoKCkgPiB0b2RheS5tb250aCgpO1xufVxuXG5mdW5jdGlvbiBnZXRJZEZyb21EYXRlKGRhdGUpIHtcbiAgcmV0dXJuIGByYy1jYWxlbmRhci0ke2RhdGUueWVhcigpfS0ke2RhdGUubW9udGgoKX0tJHtkYXRlLmRhdGUoKX1gO1xufVxuXG5jb25zdCBEYXRlVEJvZHkgPSBjcmVhdGVSZWFjdENsYXNzKHtcbiAgcHJvcFR5cGVzOiB7XG4gICAgY29udGVudFJlbmRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZGF0ZVJlbmRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgZGlzYWJsZWREYXRlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgc2VsZWN0ZWRWYWx1ZTogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm9iamVjdCwgUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCldKSxcbiAgICB2YWx1ZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBob3ZlclZhbHVlOiBQcm9wVHlwZXMuYW55LFxuICAgIHNob3dXZWVrTnVtYmVyOiBQcm9wVHlwZXMuYm9vbCxcbiAgfSxcblxuICBnZXREZWZhdWx0UHJvcHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGhvdmVyVmFsdWU6IFtdLFxuICAgIH07XG4gIH0sXG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7XG4gICAgICBjb250ZW50UmVuZGVyLCBwcmVmaXhDbHMsIHNlbGVjdGVkVmFsdWUsIHZhbHVlLFxuICAgICAgc2hvd1dlZWtOdW1iZXIsIGRhdGVSZW5kZXIsIGRpc2FibGVkRGF0ZSxcbiAgICAgIGhvdmVyVmFsdWUsXG4gICAgfSA9IHByb3BzO1xuICAgIGxldCBpSW5kZXg7XG4gICAgbGV0IGpJbmRleDtcbiAgICBsZXQgY3VycmVudDtcbiAgICBjb25zdCBkYXRlVGFibGUgPSBbXTtcbiAgICBjb25zdCB0b2RheSA9IGdldFRvZGF5VGltZSh2YWx1ZSk7XG4gICAgY29uc3QgY2VsbENsYXNzID0gYCR7cHJlZml4Q2xzfS1jZWxsYDtcbiAgICBjb25zdCB3ZWVrTnVtYmVyQ2VsbENsYXNzID0gYCR7cHJlZml4Q2xzfS13ZWVrLW51bWJlci1jZWxsYDtcbiAgICBjb25zdCBkYXRlQ2xhc3MgPSBgJHtwcmVmaXhDbHN9LWRhdGVgO1xuICAgIGNvbnN0IHRvZGF5Q2xhc3MgPSBgJHtwcmVmaXhDbHN9LXRvZGF5YDtcbiAgICBjb25zdCBzZWxlY3RlZENsYXNzID0gYCR7cHJlZml4Q2xzfS1zZWxlY3RlZC1kYXlgO1xuICAgIGNvbnN0IHNlbGVjdGVkRGF0ZUNsYXNzID0gYCR7cHJlZml4Q2xzfS1zZWxlY3RlZC1kYXRlYDsgIC8vIGRvIG5vdCBtb3ZlIHdpdGggbW91c2Ugb3BlcmF0aW9uXG4gICAgY29uc3Qgc2VsZWN0ZWRTdGFydERhdGVDbGFzcyA9IGAke3ByZWZpeENsc30tc2VsZWN0ZWQtc3RhcnQtZGF0ZWA7XG4gICAgY29uc3Qgc2VsZWN0ZWRFbmREYXRlQ2xhc3MgPSBgJHtwcmVmaXhDbHN9LXNlbGVjdGVkLWVuZC1kYXRlYDtcbiAgICBjb25zdCBpblJhbmdlQ2xhc3MgPSBgJHtwcmVmaXhDbHN9LWluLXJhbmdlLWNlbGxgO1xuICAgIGNvbnN0IGxhc3RNb250aERheUNsYXNzID0gYCR7cHJlZml4Q2xzfS1sYXN0LW1vbnRoLWNlbGxgO1xuICAgIGNvbnN0IG5leHRNb250aERheUNsYXNzID0gYCR7cHJlZml4Q2xzfS1uZXh0LW1vbnRoLWJ0bi1kYXlgO1xuICAgIGNvbnN0IGRpc2FibGVkQ2xhc3MgPSBgJHtwcmVmaXhDbHN9LWRpc2FibGVkLWNlbGxgO1xuICAgIGNvbnN0IGZpcnN0RGlzYWJsZUNsYXNzID0gYCR7cHJlZml4Q2xzfS1kaXNhYmxlZC1jZWxsLWZpcnN0LW9mLXJvd2A7XG4gICAgY29uc3QgbGFzdERpc2FibGVDbGFzcyA9IGAke3ByZWZpeENsc30tZGlzYWJsZWQtY2VsbC1sYXN0LW9mLXJvd2A7XG4gICAgY29uc3QgbGFzdERheU9mTW9udGhDbGFzcyA9IGAke3ByZWZpeENsc30tbGFzdC1kYXktb2YtbW9udGhgO1xuICAgIGNvbnN0IG1vbnRoMSA9IHZhbHVlLmNsb25lKCk7XG4gICAgbW9udGgxLmRhdGUoMSk7XG4gICAgY29uc3QgZGF5ID0gbW9udGgxLmRheSgpO1xuICAgIGNvbnN0IGxhc3RNb250aERpZmZEYXkgPSAoZGF5ICsgNyAtIHZhbHVlLmxvY2FsZURhdGEoKS5maXJzdERheU9mV2VlaygpKSAlIDc7XG4gICAgLy8gY2FsY3VsYXRlIGxhc3QgbW9udGhcbiAgICBjb25zdCBsYXN0TW9udGgxID0gbW9udGgxLmNsb25lKCk7XG4gICAgbGFzdE1vbnRoMS5hZGQoMCAtIGxhc3RNb250aERpZmZEYXksICdkYXlzJyk7XG4gICAgbGV0IHBhc3NlZCA9IDA7XG4gICAgZm9yIChpSW5kZXggPSAwOyBpSW5kZXggPCBEYXRlQ29uc3RhbnRzLkRBVEVfUk9XX0NPVU5UOyBpSW5kZXgrKykge1xuICAgICAgZm9yIChqSW5kZXggPSAwOyBqSW5kZXggPCBEYXRlQ29uc3RhbnRzLkRBVEVfQ09MX0NPVU5UOyBqSW5kZXgrKykge1xuICAgICAgICBjdXJyZW50ID0gbGFzdE1vbnRoMTtcbiAgICAgICAgaWYgKHBhc3NlZCkge1xuICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50LmNsb25lKCk7XG4gICAgICAgICAgY3VycmVudC5hZGQocGFzc2VkLCAnZGF5cycpO1xuICAgICAgICB9XG4gICAgICAgIGRhdGVUYWJsZS5wdXNoKGN1cnJlbnQpO1xuICAgICAgICBwYXNzZWQrKztcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgdGFibGVIdG1sID0gW107XG4gICAgcGFzc2VkID0gMDtcblxuICAgIGZvciAoaUluZGV4ID0gMDsgaUluZGV4IDwgRGF0ZUNvbnN0YW50cy5EQVRFX1JPV19DT1VOVDsgaUluZGV4KyspIHtcbiAgICAgIGxldCBpc0N1cnJlbnRXZWVrO1xuICAgICAgbGV0IHdlZWtOdW1iZXJDZWxsO1xuICAgICAgbGV0IGlzQWN0aXZlV2VlayA9IGZhbHNlO1xuICAgICAgY29uc3QgZGF0ZUNlbGxzID0gW107XG4gICAgICBpZiAoc2hvd1dlZWtOdW1iZXIpIHtcbiAgICAgICAgd2Vla051bWJlckNlbGwgPSAoXG4gICAgICAgICAgPHRkXG4gICAgICAgICAgICBrZXk9e2RhdGVUYWJsZVtwYXNzZWRdLndlZWsoKX1cbiAgICAgICAgICAgIHJvbGU9XCJncmlkY2VsbFwiXG4gICAgICAgICAgICBjbGFzc05hbWU9e3dlZWtOdW1iZXJDZWxsQ2xhc3N9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2RhdGVUYWJsZVtwYXNzZWRdLndlZWsoKX1cbiAgICAgICAgICA8L3RkPlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgZm9yIChqSW5kZXggPSAwOyBqSW5kZXggPCBEYXRlQ29uc3RhbnRzLkRBVEVfQ09MX0NPVU5UOyBqSW5kZXgrKykge1xuICAgICAgICBsZXQgbmV4dCA9IG51bGw7XG4gICAgICAgIGxldCBsYXN0ID0gbnVsbDtcbiAgICAgICAgY3VycmVudCA9IGRhdGVUYWJsZVtwYXNzZWRdO1xuICAgICAgICBpZiAoakluZGV4IDwgRGF0ZUNvbnN0YW50cy5EQVRFX0NPTF9DT1VOVCAtIDEpIHtcbiAgICAgICAgICBuZXh0ID0gZGF0ZVRhYmxlW3Bhc3NlZCArIDFdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChqSW5kZXggPiAwKSB7XG4gICAgICAgICAgbGFzdCA9IGRhdGVUYWJsZVtwYXNzZWQgLSAxXTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY2xzID0gY2VsbENsYXNzO1xuICAgICAgICBsZXQgZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgbGV0IHNlbGVjdGVkID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGlzU2FtZURheShjdXJyZW50LCB0b2RheSkpIHtcbiAgICAgICAgICBjbHMgKz0gYCAke3RvZGF5Q2xhc3N9YDtcbiAgICAgICAgICBpc0N1cnJlbnRXZWVrID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGlzQmVmb3JlQ3VycmVudE1vbnRoWWVhciA9IGJlZm9yZUN1cnJlbnRNb250aFllYXIoY3VycmVudCwgdmFsdWUpO1xuICAgICAgICBjb25zdCBpc0FmdGVyQ3VycmVudE1vbnRoWWVhciA9IGFmdGVyQ3VycmVudE1vbnRoWWVhcihjdXJyZW50LCB2YWx1ZSk7XG5cbiAgICAgICAgaWYgKHNlbGVjdGVkVmFsdWUgJiYgQXJyYXkuaXNBcnJheShzZWxlY3RlZFZhbHVlKSkge1xuICAgICAgICAgIGNvbnN0IHJhbmdlVmFsdWUgPSBob3ZlclZhbHVlLmxlbmd0aCA/IGhvdmVyVmFsdWUgOiBzZWxlY3RlZFZhbHVlO1xuICAgICAgICAgIGlmICghaXNCZWZvcmVDdXJyZW50TW9udGhZZWFyICYmICFpc0FmdGVyQ3VycmVudE1vbnRoWWVhcikge1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRWYWx1ZSA9IHJhbmdlVmFsdWVbMF07XG4gICAgICAgICAgICBjb25zdCBlbmRWYWx1ZSA9IHJhbmdlVmFsdWVbMV07XG4gICAgICAgICAgICBpZiAoc3RhcnRWYWx1ZSkge1xuICAgICAgICAgICAgICBpZiAoaXNTYW1lRGF5KGN1cnJlbnQsIHN0YXJ0VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQWN0aXZlV2VlayA9IHRydWU7XG4gICAgICAgICAgICAgICAgY2xzICs9IGAgJHtzZWxlY3RlZFN0YXJ0RGF0ZUNsYXNzfWA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGFydFZhbHVlICYmIGVuZFZhbHVlKSB7XG4gICAgICAgICAgICAgIGlmIChpc1NhbWVEYXkoY3VycmVudCwgZW5kVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlzQWN0aXZlV2VlayA9IHRydWU7XG4gICAgICAgICAgICAgICAgY2xzICs9IGAgJHtzZWxlY3RlZEVuZERhdGVDbGFzc31gO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnQuaXNBZnRlcihzdGFydFZhbHVlLCAnZGF5JykgJiZcbiAgICAgICAgICAgICAgICBjdXJyZW50LmlzQmVmb3JlKGVuZFZhbHVlLCAnZGF5JykpIHtcbiAgICAgICAgICAgICAgICBjbHMgKz0gYCAke2luUmFuZ2VDbGFzc31gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGlzU2FtZURheShjdXJyZW50LCB2YWx1ZSkpIHtcbiAgICAgICAgICAvLyBrZXlib2FyZCBjaGFuZ2UgdmFsdWUsIGhpZ2hsaWdodCB3b3Jrc1xuICAgICAgICAgIHNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICBpc0FjdGl2ZVdlZWsgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzU2FtZURheShjdXJyZW50LCBzZWxlY3RlZFZhbHVlKSkge1xuICAgICAgICAgIGNscyArPSBgICR7c2VsZWN0ZWREYXRlQ2xhc3N9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0JlZm9yZUN1cnJlbnRNb250aFllYXIpIHtcbiAgICAgICAgICBjbHMgKz0gYCAke2xhc3RNb250aERheUNsYXNzfWA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNBZnRlckN1cnJlbnRNb250aFllYXIpIHtcbiAgICAgICAgICBjbHMgKz0gYCAke25leHRNb250aERheUNsYXNzfWA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3VycmVudC5jbG9uZSgpLmVuZE9mKCdtb250aCcpLmRhdGUoKSA9PT0gY3VycmVudC5kYXRlKCkpIHtcbiAgICAgICAgICBjbHMgKz0gYCAke2xhc3REYXlPZk1vbnRoQ2xhc3N9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkaXNhYmxlZERhdGUpIHtcbiAgICAgICAgICBpZiAoZGlzYWJsZWREYXRlKGN1cnJlbnQsIHZhbHVlKSkge1xuICAgICAgICAgICAgZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgICAgICAgICBpZiAoIWxhc3QgfHwgIWRpc2FibGVkRGF0ZShsYXN0LCB2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgY2xzICs9IGAgJHtmaXJzdERpc2FibGVDbGFzc31gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIW5leHQgfHwgIWRpc2FibGVkRGF0ZShuZXh0LCB2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgY2xzICs9IGAgJHtsYXN0RGlzYWJsZUNsYXNzfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgY2xzICs9IGAgJHtzZWxlY3RlZENsYXNzfWA7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgICAgICBjbHMgKz0gYCAke2Rpc2FibGVkQ2xhc3N9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBkYXRlSHRtbDtcbiAgICAgICAgaWYgKGRhdGVSZW5kZXIpIHtcbiAgICAgICAgICBkYXRlSHRtbCA9IGRhdGVSZW5kZXIoY3VycmVudCwgdmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBjb250ZW50UmVuZGVyID8gY29udGVudFJlbmRlcihjdXJyZW50LCB2YWx1ZSkgOiBjdXJyZW50LmRhdGUoKTtcbiAgICAgICAgICBkYXRlSHRtbCA9IChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAga2V5PXtnZXRJZEZyb21EYXRlKGN1cnJlbnQpfVxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2RhdGVDbGFzc31cbiAgICAgICAgICAgICAgYXJpYS1zZWxlY3RlZD17c2VsZWN0ZWR9XG4gICAgICAgICAgICAgIGFyaWEtZGlzYWJsZWQ9e2Rpc2FibGVkfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7Y29udGVudH1cbiAgICAgICAgICAgIDwvZGl2Pik7XG4gICAgICAgIH1cblxuICAgICAgICBkYXRlQ2VsbHMucHVzaChcbiAgICAgICAgICA8dGRcbiAgICAgICAgICAgIGtleT17cGFzc2VkfVxuICAgICAgICAgICAgb25DbGljaz17ZGlzYWJsZWQgPyB1bmRlZmluZWQgOiBwcm9wcy5vblNlbGVjdC5iaW5kKG51bGwsIGN1cnJlbnQpfVxuICAgICAgICAgICAgb25Nb3VzZUVudGVyPXtkaXNhYmxlZCA/XG4gICAgICAgICAgICAgIHVuZGVmaW5lZCA6IHByb3BzLm9uRGF5SG92ZXIgJiYgcHJvcHMub25EYXlIb3Zlci5iaW5kKG51bGwsIGN1cnJlbnQpIHx8IHVuZGVmaW5lZH1cbiAgICAgICAgICAgIHJvbGU9XCJncmlkY2VsbFwiXG4gICAgICAgICAgICB0aXRsZT17Z2V0VGl0bGVTdHJpbmcoY3VycmVudCl9IGNsYXNzTmFtZT17Y2xzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtkYXRlSHRtbH1cbiAgICAgICAgICA8L3RkPik7XG5cbiAgICAgICAgcGFzc2VkKys7XG4gICAgICB9XG5cblxuICAgICAgdGFibGVIdG1sLnB1c2goXG4gICAgICAgIDx0clxuICAgICAgICAgIGtleT17aUluZGV4fVxuICAgICAgICAgIHJvbGU9XCJyb3dcIlxuICAgICAgICAgIGNsYXNzTmFtZT17Y3goe1xuICAgICAgICAgICAgW2Ake3ByZWZpeENsc30tY3VycmVudC13ZWVrYF06IGlzQ3VycmVudFdlZWssXG4gICAgICAgICAgICBbYCR7cHJlZml4Q2xzfS1hY3RpdmUtd2Vla2BdOiBpc0FjdGl2ZVdlZWssXG4gICAgICAgICAgfSl9XG4gICAgICAgID5cbiAgICAgICAgICB7d2Vla051bWJlckNlbGx9XG4gICAgICAgICAge2RhdGVDZWxsc31cbiAgICAgICAgPC90cj4pO1xuICAgIH1cbiAgICByZXR1cm4gKDx0Ym9keSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdGJvZHlgfT5cbiAgICAgIHt0YWJsZUh0bWx9XG4gICAgPC90Ym9keT4pO1xuICB9LFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IERhdGVUQm9keTtcbiJdfQ==