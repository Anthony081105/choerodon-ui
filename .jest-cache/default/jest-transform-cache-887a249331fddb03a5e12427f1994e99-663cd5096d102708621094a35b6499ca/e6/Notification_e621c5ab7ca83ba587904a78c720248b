b516e9559cd10ced2d8ede47149b4e41
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _animate = _interopRequireDefault(require("../../animate"));

var _createChainedFunction = _interopRequireDefault(require("../util/createChainedFunction"));

var _classnames = _interopRequireDefault(require("classnames"));

var _Notice = _interopRequireDefault(require("./Notice"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var seed = 0;
var now = Date.now();

function getUuid() {
  return "rcNotification_".concat(now, "_").concat(seed++);
}

var Notification =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Notification, _Component);

  var _super = _createSuper(Notification);

  function Notification() {
    var _this;

    (0, _classCallCheck2["default"])(this, Notification);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      notices: []
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "add", function (notice) {
      var key = notice.key = notice.key || getUuid();

      _this.setState(function (previousState) {
        var notices = previousState.notices;

        if (!notices.filter(function (v) {
          return v.key === key;
        }).length) {
          return {
            notices: notices.concat(notice)
          };
        }
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "remove", function (key) {
      _this.setState(function (previousState) {
        return {
          notices: previousState.notices.filter(function (notice) {
            return notice.key !== key;
          })
        };
      });
    });
    return _this;
  }

  (0, _createClass2["default"])(Notification, [{
    key: "getTransitionName",
    value: function getTransitionName() {
      var props = this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(props.animation);
      }

      return transitionName;
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this,
          _className;

      var props = this.props;
      var noticeNodes = this.state.notices.map(function (notice) {
        var onClose = (0, _createChainedFunction["default"])(_this2.remove.bind(_this2, notice.key), notice.onClose);
        return _react["default"].createElement(_Notice["default"], (0, _extends2["default"])({
          prefixCls: props.prefixCls
        }, notice, {
          onClose: onClose,
          closeIcon: props.closeIcon
        }), notice.content);
      });
      var className = (_className = {}, (0, _defineProperty2["default"])(_className, props.prefixCls, 1), (0, _defineProperty2["default"])(_className, props.className, !!props.className), _className);
      return _react["default"].createElement("div", {
        className: (0, _classnames["default"])(className),
        style: props.style
      }, _react["default"].createElement(_animate["default"], {
        transitionName: this.getTransitionName()
      }, noticeNodes));
    }
  }]);
  return Notification;
}(_react.Component);

exports["default"] = Notification;
(0, _defineProperty2["default"])(Notification, "propTypes", {
  prefixCls: _propTypes["default"].string,
  transitionName: _propTypes["default"].string,
  animation: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].object]),
  style: _propTypes["default"].object,
  closeIcon: _propTypes["default"].node
});
(0, _defineProperty2["default"])(Notification, "defaultProps", {
  prefixCls: 'rc-notification',
  animation: 'fade',
  style: {
    top: 65,
    left: '50%'
  }
});
(0, _defineProperty2["default"])(Notification, "newInstance", function newNotificationInstance(properties, callback) {
  var _ref = properties || {},
      getContainer = _ref.getContainer,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["getContainer"]);

  var div = document.createElement('div');

  if (getContainer) {
    var root = getContainer();
    root.appendChild(div);
  } else {
    document.body.appendChild(div);
  }

  var called = false;

  function ref(notification) {
    if (called) {
      return;
    }

    called = true;
    callback({
      notice: function notice(noticeProps) {
        notification.add(noticeProps);
      },
      removeNotice: function removeNotice(key) {
        notification.remove(key);
      },
      component: notification,
      destroy: function destroy() {
        _reactDom["default"].unmountComponentAtNode(div);

        div.parentNode.removeChild(div);
      }
    });
  }

  _reactDom["default"].render(_react["default"].createElement(Notification, (0, _extends2["default"])({}, props, {
    ref: ref
  })), div);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5vdGlmaWNhdGlvbi5qc3giXSwibmFtZXMiOlsic2VlZCIsIm5vdyIsIkRhdGUiLCJnZXRVdWlkIiwiTm90aWZpY2F0aW9uIiwibm90aWNlcyIsIm5vdGljZSIsImtleSIsInNldFN0YXRlIiwicHJldmlvdXNTdGF0ZSIsImZpbHRlciIsInYiLCJsZW5ndGgiLCJjb25jYXQiLCJwcm9wcyIsInRyYW5zaXRpb25OYW1lIiwiYW5pbWF0aW9uIiwicHJlZml4Q2xzIiwibm90aWNlTm9kZXMiLCJzdGF0ZSIsIm1hcCIsIm9uQ2xvc2UiLCJyZW1vdmUiLCJiaW5kIiwiY2xvc2VJY29uIiwiY29udGVudCIsImNsYXNzTmFtZSIsInN0eWxlIiwiZ2V0VHJhbnNpdGlvbk5hbWUiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJvbmVPZlR5cGUiLCJvYmplY3QiLCJub2RlIiwidG9wIiwibGVmdCIsIm5ld05vdGlmaWNhdGlvbkluc3RhbmNlIiwicHJvcGVydGllcyIsImNhbGxiYWNrIiwiZ2V0Q29udGFpbmVyIiwiZGl2IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwicm9vdCIsImFwcGVuZENoaWxkIiwiYm9keSIsImNhbGxlZCIsInJlZiIsIm5vdGlmaWNhdGlvbiIsIm5vdGljZVByb3BzIiwiYWRkIiwicmVtb3ZlTm90aWNlIiwiY29tcG9uZW50IiwiZGVzdHJveSIsIlJlYWN0RE9NIiwidW5tb3VudENvbXBvbmVudEF0Tm9kZSIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInJlbmRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQUlBLElBQUksR0FBRyxDQUFYO0FBQ0EsSUFBTUMsR0FBRyxHQUFHQyxJQUFJLENBQUNELEdBQUwsRUFBWjs7QUFFQSxTQUFTRSxP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QUFJUEUsTUFBQUEsWUFKTyx3QkFJTTdDLEdBSk4sRUFJVztBQUNoQjBDLFFBQUFBLFlBQVksQ0FBQzNCLE1BQWIsQ0FBb0JmLEdBQXBCO0FBQ0QsT0FOTTtBQU9QOEMsTUFBQUEsU0FBUyxFQUFFSixZQVBKO0FBUVBLLE1BQUFBLE9BUk8scUJBUUc7QUFDUkMsNkJBQVNDLHNCQUFULENBQWdDZixHQUFoQzs7QUFDQUEsUUFBQUEsR0FBRyxDQUFDZ0IsVUFBSixDQUFlQyxXQUFmLENBQTJCakIsR0FBM0I7QUFDRDtBQVhNLEtBQUQsQ0FBUjtBQWFEOztBQUVEYyx1QkFBU0ksTUFBVCxDQUFnQixnQ0FBQyxZQUFELGdDQUFrQjdDLEtBQWxCO0FBQXlCLElBQUEsR0FBRyxFQUFFa0M7QUFBOUIsS0FBaEIsRUFBdURQLEdBQXZEO0FBQ0QsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgQW5pbWF0ZSBmcm9tICcuLi8uLi9hbmltYXRlJztcbmltcG9ydCBjcmVhdGVDaGFpbmVkRnVuY3Rpb24gZnJvbSAnLi4vdXRpbC9jcmVhdGVDaGFpbmVkRnVuY3Rpb24nO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgTm90aWNlIGZyb20gJy4vTm90aWNlJztcblxubGV0IHNlZWQgPSAwO1xuY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuZnVuY3Rpb24gZ2V0VXVpZCgpIHtcbiAgcmV0dXJuIGByY05vdGlmaWNhdGlvbl8ke25vd31fJHtzZWVkKyt9YDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTm90aWZpY2F0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdHJhbnNpdGlvbk5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgYW5pbWF0aW9uOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMub2JqZWN0XSksXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgY2xvc2VJY29uOiBQcm9wVHlwZXMubm9kZSxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHByZWZpeENsczogJ3JjLW5vdGlmaWNhdGlvbicsXG4gICAgYW5pbWF0aW9uOiAnZmFkZScsXG4gICAgc3R5bGU6IHtcbiAgICAgIHRvcDogNjUsXG4gICAgICBsZWZ0OiAnNTAlJyxcbiAgICB9LFxuICB9O1xuXG4gIHN0YXRpYyBuZXdJbnN0YW5jZSA9IGZ1bmN0aW9uIG5ld05vdGlmaWNhdGlvbkluc3RhbmNlKHByb3BlcnRpZXMsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgeyBnZXRDb250YWluZXIsIC4uLnByb3BzIH0gPSBwcm9wZXJ0aWVzIHx8IHt9O1xuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGlmIChnZXRDb250YWluZXIpIHtcbiAgICAgIGNvbnN0IHJvb3QgPSBnZXRDb250YWluZXIoKTtcbiAgICAgIHJvb3QuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpO1xuICAgIH1cbiAgICBsZXQgY2FsbGVkID0gZmFsc2U7XG5cbiAgICBmdW5jdGlvbiByZWYobm90aWZpY2F0aW9uKSB7XG4gICAgICBpZiAoY2FsbGVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhbGxlZCA9IHRydWU7XG4gICAgICBjYWxsYmFjayh7XG4gICAgICAgIG5vdGljZShub3RpY2VQcm9wcykge1xuICAgICAgICAgIG5vdGlmaWNhdGlvbi5hZGQobm90aWNlUHJvcHMpO1xuICAgICAgICB9LFxuICAgICAgICByZW1vdmVOb3RpY2Uoa2V5KSB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uLnJlbW92ZShrZXkpO1xuICAgICAgICB9LFxuICAgICAgICBjb21wb25lbnQ6IG5vdGlmaWNhdGlvbixcbiAgICAgICAgZGVzdHJveSgpIHtcbiAgICAgICAgICBSZWFjdERPTS51bm1vdW50Q29tcG9uZW50QXROb2RlKGRpdik7XG4gICAgICAgICAgZGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZGl2KTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIFJlYWN0RE9NLnJlbmRlcig8Tm90aWZpY2F0aW9uIHsuLi5wcm9wc30gcmVmPXtyZWZ9IC8+LCBkaXYpO1xuICB9O1xuXG4gIHN0YXRlID0ge1xuICAgIG5vdGljZXM6IFtdLFxuICB9O1xuXG4gIGdldFRyYW5zaXRpb25OYW1lKCkge1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBsZXQgdHJhbnNpdGlvbk5hbWUgPSBwcm9wcy50cmFuc2l0aW9uTmFtZTtcbiAgICBpZiAoIXRyYW5zaXRpb25OYW1lICYmIHByb3BzLmFuaW1hdGlvbikge1xuICAgICAgdHJhbnNpdGlvbk5hbWUgPSBgJHtwcm9wcy5wcmVmaXhDbHN9LSR7cHJvcHMuYW5pbWF0aW9ufWA7XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2l0aW9uTmFtZTtcbiAgfVxuXG4gIGFkZCA9IG5vdGljZSA9PiB7XG4gICAgY29uc3Qga2V5ID0gKG5vdGljZS5rZXkgPSBub3RpY2Uua2V5IHx8IGdldFV1aWQoKSk7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIGNvbnN0IG5vdGljZXMgPSBwcmV2aW91c1N0YXRlLm5vdGljZXM7XG4gICAgICBpZiAoIW5vdGljZXMuZmlsdGVyKHYgPT4gdi5rZXkgPT09IGtleSkubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbm90aWNlczogbm90aWNlcy5jb25jYXQobm90aWNlKSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZW1vdmUgPSBrZXkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUocHJldmlvdXNTdGF0ZSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBub3RpY2VzOiBwcmV2aW91c1N0YXRlLm5vdGljZXMuZmlsdGVyKG5vdGljZSA9PiBub3RpY2Uua2V5ICE9PSBrZXkpLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG5vdGljZU5vZGVzID0gdGhpcy5zdGF0ZS5ub3RpY2VzLm1hcChub3RpY2UgPT4ge1xuICAgICAgY29uc3Qgb25DbG9zZSA9IGNyZWF0ZUNoYWluZWRGdW5jdGlvbih0aGlzLnJlbW92ZS5iaW5kKHRoaXMsIG5vdGljZS5rZXkpLCBub3RpY2Uub25DbG9zZSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Tm90aWNlXG4gICAgICAgICAgcHJlZml4Q2xzPXtwcm9wcy5wcmVmaXhDbHN9XG4gICAgICAgICAgey4uLm5vdGljZX1cbiAgICAgICAgICBvbkNsb3NlPXtvbkNsb3NlfVxuICAgICAgICAgIGNsb3NlSWNvbj17cHJvcHMuY2xvc2VJY29ufVxuICAgICAgICA+XG4gICAgICAgICAge25vdGljZS5jb250ZW50fVxuICAgICAgICA8L05vdGljZT5cbiAgICAgICk7XG4gICAgfSk7XG4gICAgY29uc3QgY2xhc3NOYW1lID0ge1xuICAgICAgW3Byb3BzLnByZWZpeENsc106IDEsXG4gICAgICBbcHJvcHMuY2xhc3NOYW1lXTogISFwcm9wcy5jbGFzc05hbWUsXG4gICAgfTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzbmFtZXMoY2xhc3NOYW1lKX0gc3R5bGU9e3Byb3BzLnN0eWxlfT5cbiAgICAgICAgPEFuaW1hdGUgdHJhbnNpdGlvbk5hbWU9e3RoaXMuZ2V0VHJhbnNpdGlvbk5hbWUoKX0+e25vdGljZU5vZGVzfTwvQW5pbWF0ZT5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cbiJdfQ==