b503a8356846a0f150300ffc7f55e595
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _arrayTreeFilter = _interopRequireDefault(require("array-tree-filter"));

var _reactDom = require("react-dom");

var _en_US = _interopRequireDefault(require("./locale/en_US"));

var _isFunction = _interopRequireDefault(require("lodash/isFunction"));

var _icon = _interopRequireDefault(require("../../icon"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Menus =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Menus, _Component);

  var _super = _createSuper(Menus);

  function Menus(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Menus);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveMenuItem", function (index) {
      return function (node) {
        _this.menuItems[index] = node;
      };
    });
    _this.menuItems = {};
    return _this;
  }

  (0, _createClass2["default"])(Menus, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.scrollActiveItemToView();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (!prevProps.visible && this.props.visible) {
        this.scrollActiveItemToView();
      }
    }
    /**
     * render th li list
     * @param {*} option
     * @param {*} menuIndex
     */

  }, {
    key: "getOption",
    value: function getOption(option, menuIndex) {
      var _this$props = this.props,
          prefixCls = _this$props.prefixCls,
          expandTrigger = _this$props.expandTrigger,
          singleMenuItemStyle = _this$props.singleMenuItemStyle;
      var onSelect = this.props.onSelect.bind(this, option, menuIndex, false);
      var expandProps = {
        onClick: onSelect
      };
      var hasChildren = option.children && option.children.length > 0;
      var menuItemCls = "".concat(prefixCls, "-menu-item"); // TODO: add item style

      if (expandTrigger === 'hover' && hasChildren) {
        expandProps = {
          onMouseEnter: this.delayOnSelect.bind(this, onSelect),
          onMouseLeave: this.delayOnSelect.bind(this),
          onClick: onSelect
        };
      }

      if (this.isActiveOption(option, menuIndex)) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-active");
        expandProps.ref = this.saveMenuItem(menuIndex);
      }

      if (option.disabled) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-disabled");
      }

      if (option.loading) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-loading");
      }

      var title = '';

      if (option.title) {
        title = option.title;
      } else if (typeof option.label === 'string') {
        title = option.label;
      }

      return _react["default"].createElement("li", (0, _extends2["default"])({
        key: option.key || option.value,
        className: menuItemCls,
        title: title,
        style: singleMenuItemStyle
      }, expandProps), option.label);
    }
    /**
     *  be active value is a array of items
     * @param string[] values
     */

  }, {
    key: "getActiveOptions",
    value: function getActiveOptions(values) {
      var activeValue = values || this.props.activeValue;
      var options = this.props.options;
      return (0, _arrayTreeFilter["default"])(options, function (o, level) {
        return o.value === activeValue[level];
      });
    }
  }, {
    key: "getShowOptions",
    value: function getShowOptions() {
      var options = this.props.options;
      var result = this.getActiveOptions().map(function (activeOption) {
        return activeOption.children;
      }).filter(function (activeOption) {
        return !!activeOption;
      });
      result.unshift(options);
      return result;
    }
  }, {
    key: "delayOnSelect",
    value: function delayOnSelect(onSelect) {
      var _this2 = this;

      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      if (this.delayTimer) {
        clearTimeout(this.delayTimer);
        this.delayTimer = null;
      }

      if (typeof onSelect === 'function') {
        this.delayTimer = setTimeout(function () {
          onSelect(args);
          _this2.delayTimer = null;
        }, 150);
      }
    }
  }, {
    key: "scrollActiveItemToView",
    value: function scrollActiveItemToView() {
      // scroll into view
      var optionsLength = this.getShowOptions().length;

      for (var i = 0; i < optionsLength; i++) {
        var itemComponent = this.menuItems[i];

        if (itemComponent) {
          var target = (0, _reactDom.findDOMNode)(itemComponent);
          target.parentNode.scrollTop = target.offsetTop;
        }
      }
    }
  }, {
    key: "isActiveOption",
    value: function isActiveOption(option, menuIndex) {
      var _this$props$activeVal = this.props.activeValue,
          activeValue = _this$props$activeVal === void 0 ? [] : _this$props$activeVal;
      return activeValue[menuIndex] === option.value;
    }
  }, {
    key: "getTabItem",

    /**
     * render th li list
     * @param {*} option
     * @param {*} menuIndex
     */
    value: function getTabItem(option, menuIndex) {
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          singleMenuItemRender = _this$props2.singleMenuItemRender;
      var onSelect = this.props.onSelect.bind(this, option, menuIndex, true);
      var expandProps = {
        onClick: onSelect
      };
      var menuItemCls = "".concat(prefixCls, "-menu-tab-item");
      var label = option.label;

      if ((0, _isFunction["default"])(singleMenuItemRender)) {
        label = singleMenuItemItem(option.label);
      }

      return _react["default"].createElement("span", (0, _extends2["default"])({
        key: option.key || option.value,
        className: menuItemCls
      }, expandProps), label, _react["default"].createElement(_icon["default"], {
        type: "arrow_drop_down"
      }));
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;

      var _this$props3 = this.props,
          prefixCls = _this$props3.prefixCls,
          dropdownMenuColumnStyle = _this$props3.dropdownMenuColumnStyle,
          isTabSelected = _this$props3.isTabSelected,
          locale = _this$props3.locale,
          singleMenuStyle = _this$props3.singleMenuStyle,
          singlePleaseRender = _this$props3.singlePleaseRender;
      var showOptions = this.getShowOptions();
      var showOptionsIndex = showOptions.length - 1;
      var activeOptions = this.getActiveOptions();
      var dropdownMenuColumnStyleSingle = (0, _objectSpread2["default"])({}, dropdownMenuColumnStyle, {}, singleMenuStyle);
      var tabItemRender = activeOptions.map(function (item, indexItem) {
        return _this3.getTabItem(item, indexItem);
      });
      var tabItemRenderResult;

      if (showOptions && activeOptions && !isTabSelected && showOptions.length > activeOptions.length) {
        var pleaseRenderProps = {
          key: "please_check",
          className: "".concat(prefixCls, "-menu-tab-item ").concat(prefixCls, "-menu-tab-please"),
          text: locale.pleaseSelect
        };

        if ((0, _isFunction["default"])(singlePleaseRender)) {
          tabItemRenderResult = singlePleaseRender(pleaseRenderProps);
        } else {
          var pleaseItem = _react["default"].createElement("span", pleaseRenderProps, pleaseRenderProps.text, _react["default"].createElement(_icon["default"], {
            type: "arrow_drop_down"
          }));

          tabItemRenderResult = tabItemRender.length > 0 ? [].concat((0, _toConsumableArray2["default"])(tabItemRender), [pleaseItem]) : pleaseItem;
        }
      }

      if (isTabSelected) {
        showOptionsIndex = activeOptions.length - 1 < 0 ? 0 : activeOptions.length - 1;
      }

      return _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-mode-single ")
      }, _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-menu-tab")
      }, tabItemRenderResult || tabItemRender), _react["default"].createElement("ul", {
        className: "".concat(prefixCls, "-menu ").concat(prefixCls, "-menu-single "),
        key: showOptionsIndex,
        style: dropdownMenuColumnStyleSingle
      }, showOptions[showOptionsIndex].map(function (option) {
        return _this3.getOption(option, showOptionsIndex);
      })));
    }
  }]);
  return Menus;
}(_react.Component);

exports["default"] = Menus;
(0, _defineProperty2["default"])(Menus, "defaultProps", {
  options: [],
  value: [],
  activeValue: [],
  onSelect: function onSelect() {},
  prefixCls: 'rc-cascader-menus',
  visible: false,
  expandTrigger: 'click',
  isTabSelected: false,
  locale: _en_US["default"],
  singleMenuStyle: {
    width: '3rem'
  },
  singleMenuItemStyle: {
    minWidth: '1rem'
  }
});
(0, _defineProperty2["default"])(Menus, "propTypes", {
  // 选择的值
  value: _propTypes["default"].array,
  // 当前激活的值
  activeValue: _propTypes["default"].array,
  // 可选内容
  options: _propTypes["default"].array.isRequired,
  // 注入样式开头
  prefixCls: _propTypes["default"].string,
  // 触发展开事件
  expandTrigger: _propTypes["default"].string,
  // 被选择后触发
  onSelect: _propTypes["default"].func,
  // 是否可见
  visible: _propTypes["default"].bool,
  // 下拉列表的样式配置
  dropdownMenuColumnStyle: _propTypes["default"].object,
  // 标识是由于tab select 触发的事件
  isTabSelected: _propTypes["default"].bool,
  locale: _propTypes["default"].object,
  singleMenuStyle: _propTypes["default"].object,
  singleMenuItemStyle: _propTypes["default"].object,
  singlePleaseRender: _propTypes["default"].func,
  singleMenuItemRender: _propTypes["default"].func
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhc2NhZGVyL01lbnVzU2luZ2xlLmpzeCJdLCJuYW1lcyI6WyJNZW51cyIsIkNvbXBvbmVudCIsIm9wdGlvbnMiLCJ2YWx1ZSIsImFjdGl2ZVZhbHVlIiwib25TZWxlY3QiLCJwcmVmaXhDbHMiLCJ2aXNpYmxlIiwiZXhwYW5kVHJpZ2dlciIsImlzVGFiU2VsZWN0ZWQiLCJsb2NhbGUiLCJMb2NhbGUiLCJzaW5nbGVNZW51U3R5bGUiLCJ3aWR0aCIsInNpbmdsZU1lbnVJdGVtU3R5bGUiLCJtaW5XaWR0aCIsIlByb3BUeXBlcyIsImRyb3Bkb3duTWVudUNvbHVtblN0eWxlIiwic2luZ2xlUGxlYXNlUmVuZGVyIiwic2luZ2xlTWVudUl0ZW1SZW5kZXIiLCJmdW5jIiwicHJldlByb3BzIiwib3B0aW9uIiwibWVudUluZGV4IiwiZXhwYW5kUHJvcHMiLCJvbkNsaWNrIiwiaGFzQ2hpbGRyZW4iLCJtZW51SXRlbUNscyIsIm9uTW91c2VFbnRlciIsIm9uTW91c2VMZWF2ZSIsInRpdGxlIiwidmFsdWVzIiwibyIsInJlc3VsdCIsImFjdGl2ZU9wdGlvbiIsImFyZ3MiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0Iiwib3B0aW9uc0xlbmd0aCIsImkiLCJpdGVtQ29tcG9uZW50IiwidGFyZ2V0IiwibGFiZWwiLCJzaW5nbGVNZW51SXRlbUl0ZW0iLCJzaG93T3B0aW9ucyIsInNob3dPcHRpb25zSW5kZXgiLCJhY3RpdmVPcHRpb25zIiwiZHJvcGRvd25NZW51Q29sdW1uU3R5bGVTaW5nbGUiLCJ0YWJJdGVtUmVuZGVyIiwicGxlYXNlUmVuZGVyUHJvcHMiLCJrZXkiLCJjbGFzc05hbWUiLCJ0ZXh0IiwicGxlYXNlU2VsZWN0IiwidGFiSXRlbVJlbmRlclJlc3VsdCIsInBsZWFzZUl0ZW0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLE1BQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEs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QSxDQUFBQSxDQVZFLE1BQUE7QUFXakI7QUFDQVgsRUFBQUEsUUFBUSxFQUFFVyxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQVpPLElBQUE7QUFhakI7QUFDQVQsRUFBQUEsT0FBTyxFQUFFUyxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQWRRLElBQUE7QUFlakI7QUFDQUMsRUFBQUEsdUJBQXVCLEVBQUVELFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBaEJSLE1BQUE7QUFpQmpCO0FBQ0FQLEVBQUFBLGFBQWEsRUFBRU8sVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FsQkUsSUFBQTtBQW1CakJOLEVBQUFBLE1BQU0sRUFBRU0sVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FuQlMsTUFBQTtBQW9CakJKLEVBQUFBLGVBQWUsRUFBRUksVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FwQkEsTUFBQTtBQXFCakJGLEVBQUFBLG1CQUFtQixFQUFFRSxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQXJCSixNQUFBO0FBc0JqQkUsRUFBQUEsa0JBQWtCLEVBQUVGLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBdEJILElBQUE7QUF1QmpCRyxFQUFBQSxvQkFBb0IsRUFBRUgsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBVUk7QUF2QmYsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGFycmF5VHJlZUZpbHRlciBmcm9tICdhcnJheS10cmVlLWZpbHRlcic7XG5pbXBvcnQgeyBmaW5kRE9NTm9kZSB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgTG9jYWxlIGZyb20gJy4vbG9jYWxlL2VuX1VTJztcbmltcG9ydCBpc0Z1bmN0aW9uIGZyb20gJ2xvZGFzaC9pc0Z1bmN0aW9uJztcbmltcG9ydCBJY29uIGZyb20gJy4uLy4uL2ljb24nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNZW51cyBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgb3B0aW9uczogW10sXG4gICAgdmFsdWU6IFtdLFxuICAgIGFjdGl2ZVZhbHVlOiBbXSxcbiAgICBvblNlbGVjdCgpIHtcbiAgICB9LFxuICAgIHByZWZpeENsczogJ3JjLWNhc2NhZGVyLW1lbnVzJyxcbiAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICBleHBhbmRUcmlnZ2VyOiAnY2xpY2snLFxuICAgIGlzVGFiU2VsZWN0ZWQ6IGZhbHNlLFxuICAgIGxvY2FsZTogTG9jYWxlLFxuICAgIHNpbmdsZU1lbnVTdHlsZTogeyB3aWR0aDonM3JlbSd9LFxuICAgIHNpbmdsZU1lbnVJdGVtU3R5bGU6IHsgbWluV2lkdGg6ICcxcmVtJ30sXG4gIH07XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyDpgInmi6nnmoTlgLxcbiAgICB2YWx1ZTogUHJvcFR5cGVzLmFycmF5LFxuICAgIC8vIOW9k+WJjea/gOa0u+eahOWAvFxuICAgIGFjdGl2ZVZhbHVlOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgLy8g5Y+v6YCJ5YaF5a65XG4gICAgb3B0aW9uczogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG4gICAgLy8g5rOo5YWl5qC35byP5byA5aS0XG4gICAgcHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIC8vIOinpuWPkeWxleW8gOS6i+S7tlxuICAgIGV4cGFuZFRyaWdnZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgLy8g6KKr6YCJ5oup5ZCO6Kem5Y+RXG4gICAgb25TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICAgIC8vIOaYr+WQpuWPr+ingVxuICAgIHZpc2libGU6IFByb3BUeXBlcy5ib29sLFxuICAgIC8vIOS4i+aLieWIl+ihqOeahOagt+W8j+mFjee9rlxuICAgIGRyb3Bkb3duTWVudUNvbHVtblN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIC8vIOagh+ivhuaYr+eUseS6jnRhYiBzZWxlY3Qg6Kem5Y+R55qE5LqL5Lu2XG4gICAgaXNUYWJTZWxlY3RlZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgbG9jYWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHNpbmdsZU1lbnVTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBzaW5nbGVNZW51SXRlbVN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHNpbmdsZVBsZWFzZVJlbmRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2luZ2xlTWVudUl0ZW1SZW5kZXI6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5tZW51SXRlbXMgPSB7fTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuc2Nyb2xsQWN0aXZlSXRlbVRvVmlldygpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIGlmICghcHJldlByb3BzLnZpc2libGUgJiYgdGhpcy5wcm9wcy52aXNpYmxlKSB7XG4gICAgICB0aGlzLnNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXcoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogcmVuZGVyIHRoIGxpIGxpc3RcbiAgICogQHBhcmFtIHsqfSBvcHRpb25cbiAgICogQHBhcmFtIHsqfSBtZW51SW5kZXhcbiAgICovXG4gIGdldE9wdGlvbihvcHRpb24sIG1lbnVJbmRleCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBleHBhbmRUcmlnZ2VyLCBzaW5nbGVNZW51SXRlbVN0eWxlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9uU2VsZWN0ID0gdGhpcy5wcm9wcy5vblNlbGVjdC5iaW5kKHRoaXMsIG9wdGlvbiwgbWVudUluZGV4LCBmYWxzZSk7XG4gICAgbGV0IGV4cGFuZFByb3BzID0ge1xuICAgICAgb25DbGljazogb25TZWxlY3QsXG4gICAgfTtcbiAgICBjb25zdCBoYXNDaGlsZHJlbiA9IG9wdGlvbi5jaGlsZHJlbiAmJiBvcHRpb24uY2hpbGRyZW4ubGVuZ3RoID4gMDtcbiAgICBsZXQgbWVudUl0ZW1DbHMgPSBgJHtwcmVmaXhDbHN9LW1lbnUtaXRlbWA7XG4gICAgLy8gVE9ETzogYWRkIGl0ZW0gc3R5bGVcbiAgICBpZiAoZXhwYW5kVHJpZ2dlciA9PT0gJ2hvdmVyJyAmJiBoYXNDaGlsZHJlbikge1xuICAgICAgZXhwYW5kUHJvcHMgPSB7XG4gICAgICAgIG9uTW91c2VFbnRlcjogdGhpcy5kZWxheU9uU2VsZWN0LmJpbmQodGhpcywgb25TZWxlY3QpLFxuICAgICAgICBvbk1vdXNlTGVhdmU6IHRoaXMuZGVsYXlPblNlbGVjdC5iaW5kKHRoaXMpLFxuICAgICAgICBvbkNsaWNrOiBvblNlbGVjdCxcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQWN0aXZlT3B0aW9uKG9wdGlvbiwgbWVudUluZGV4KSkge1xuICAgICAgbWVudUl0ZW1DbHMgKz0gYCAke3ByZWZpeENsc30tbWVudS1pdGVtLWFjdGl2ZWA7XG4gICAgICBleHBhbmRQcm9wcy5yZWYgPSB0aGlzLnNhdmVNZW51SXRlbShtZW51SW5kZXgpO1xuICAgIH1cbiAgICBpZiAob3B0aW9uLmRpc2FibGVkKSB7XG4gICAgICBtZW51SXRlbUNscyArPSBgICR7cHJlZml4Q2xzfS1tZW51LWl0ZW0tZGlzYWJsZWRgO1xuICAgIH1cbiAgICBpZiAob3B0aW9uLmxvYWRpbmcpIHtcbiAgICAgIG1lbnVJdGVtQ2xzICs9IGAgJHtwcmVmaXhDbHN9LW1lbnUtaXRlbS1sb2FkaW5nYDtcbiAgICB9XG4gICAgbGV0IHRpdGxlID0gJyc7XG4gICAgaWYgKG9wdGlvbi50aXRsZSkge1xuICAgICAgdGl0bGUgPSBvcHRpb24udGl0bGU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9uLmxhYmVsID09PSAnc3RyaW5nJykge1xuICAgICAgdGl0bGUgPSBvcHRpb24ubGFiZWw7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8bGlcbiAgICAgICAga2V5PXtvcHRpb24ua2V5IHx8IG9wdGlvbi52YWx1ZX1cbiAgICAgICAgY2xhc3NOYW1lPXttZW51SXRlbUNsc31cbiAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICBzdHlsZT17c2luZ2xlTWVudUl0ZW1TdHlsZX1cbiAgICAgICAgey4uLmV4cGFuZFByb3BzfVxuICAgICAgPlxuICAgICAgICB7b3B0aW9uLmxhYmVsfVxuICAgICAgPC9saT5cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqICBiZSBhY3RpdmUgdmFsdWUgaXMgYSBhcnJheSBvZiBpdGVtc1xuICAgKiBAcGFyYW0gc3RyaW5nW10gdmFsdWVzXG4gICAqL1xuICBnZXRBY3RpdmVPcHRpb25zKHZhbHVlcykge1xuICAgIGNvbnN0IGFjdGl2ZVZhbHVlID0gdmFsdWVzIHx8IHRoaXMucHJvcHMuYWN0aXZlVmFsdWU7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMucHJvcHMub3B0aW9ucztcbiAgICByZXR1cm4gYXJyYXlUcmVlRmlsdGVyKG9wdGlvbnMsIChvLCBsZXZlbCkgPT4gby52YWx1ZSA9PT0gYWN0aXZlVmFsdWVbbGV2ZWxdKTtcbiAgfVxuXG4gIGdldFNob3dPcHRpb25zKCkge1xuICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLmdldEFjdGl2ZU9wdGlvbnMoKVxuICAgICAgLm1hcChhY3RpdmVPcHRpb24gPT4gYWN0aXZlT3B0aW9uLmNoaWxkcmVuKVxuICAgICAgLmZpbHRlcihhY3RpdmVPcHRpb24gPT4gISFhY3RpdmVPcHRpb24pO1xuICAgIHJlc3VsdC51bnNoaWZ0KG9wdGlvbnMpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBkZWxheU9uU2VsZWN0KG9uU2VsZWN0LCAuLi5hcmdzKSB7XG4gICAgaWYgKHRoaXMuZGVsYXlUaW1lcikge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lcik7XG4gICAgICB0aGlzLmRlbGF5VGltZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9uU2VsZWN0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLmRlbGF5VGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgb25TZWxlY3QoYXJncyk7XG4gICAgICAgIHRoaXMuZGVsYXlUaW1lciA9IG51bGw7XG4gICAgICB9LCAxNTApO1xuICAgIH1cbiAgfVxuXG4gIHNjcm9sbEFjdGl2ZUl0ZW1Ub1ZpZXcoKSB7XG4gICAgLy8gc2Nyb2xsIGludG8gdmlld1xuICAgIGNvbnN0IG9wdGlvbnNMZW5ndGggPSB0aGlzLmdldFNob3dPcHRpb25zKCkubGVuZ3RoO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9uc0xlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBpdGVtQ29tcG9uZW50ID0gdGhpcy5tZW51SXRlbXNbaV07XG4gICAgICBpZiAoaXRlbUNvbXBvbmVudCkge1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBmaW5kRE9NTm9kZShpdGVtQ29tcG9uZW50KTtcbiAgICAgICAgdGFyZ2V0LnBhcmVudE5vZGUuc2Nyb2xsVG9wID0gdGFyZ2V0Lm9mZnNldFRvcDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpc0FjdGl2ZU9wdGlvbihvcHRpb24sIG1lbnVJbmRleCkge1xuICAgIGNvbnN0IHsgYWN0aXZlVmFsdWUgPSBbXSB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gYWN0aXZlVmFsdWVbbWVudUluZGV4XSA9PT0gb3B0aW9uLnZhbHVlO1xuICB9XG5cbiAgc2F2ZU1lbnVJdGVtID0gKGluZGV4KSA9PiAobm9kZSkgPT4ge1xuICAgIHRoaXMubWVudUl0ZW1zW2luZGV4XSA9IG5vZGU7XG4gIH07XG5cbiAgLyoqXG4gICAqIHJlbmRlciB0aCBsaSBsaXN0XG4gICAqIEBwYXJhbSB7Kn0gb3B0aW9uXG4gICAqIEBwYXJhbSB7Kn0gbWVudUluZGV4XG4gICAqL1xuICBnZXRUYWJJdGVtKG9wdGlvbiwgbWVudUluZGV4KSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIHNpbmdsZU1lbnVJdGVtUmVuZGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9uU2VsZWN0ID0gdGhpcy5wcm9wcy5vblNlbGVjdC5iaW5kKHRoaXMsIG9wdGlvbiwgbWVudUluZGV4LCB0cnVlKTtcbiAgICBsZXQgZXhwYW5kUHJvcHMgPSB7XG4gICAgICBvbkNsaWNrOiBvblNlbGVjdCxcbiAgICB9O1xuICAgIGxldCBtZW51SXRlbUNscyA9IGAke3ByZWZpeENsc30tbWVudS10YWItaXRlbWA7XG4gICAgbGV0IGxhYmVsID0gb3B0aW9uLmxhYmVsXG4gICAgaWYoaXNGdW5jdGlvbihzaW5nbGVNZW51SXRlbVJlbmRlcikpe1xuICAgICAgbGFiZWwgPSBzaW5nbGVNZW51SXRlbUl0ZW0ob3B0aW9uLmxhYmVsKVxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPHNwYW5cbiAgICAgICAga2V5PXtvcHRpb24ua2V5IHx8IG9wdGlvbi52YWx1ZX1cbiAgICAgICAgY2xhc3NOYW1lPXttZW51SXRlbUNsc31cbiAgICAgICAgey4uLmV4cGFuZFByb3BzfVxuICAgICAgPlxuICAgICAgICB7bGFiZWx9XG4gICAgICAgIDxJY29uIHR5cGU9XCJhcnJvd19kcm9wX2Rvd25cIiAvPlxuICAgICAgPC9zcGFuPlxuICAgICk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIGRyb3Bkb3duTWVudUNvbHVtblN0eWxlLCBpc1RhYlNlbGVjdGVkLCBsb2NhbGUsIHNpbmdsZU1lbnVTdHlsZSwgc2luZ2xlUGxlYXNlUmVuZGVyIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHNob3dPcHRpb25zID0gdGhpcy5nZXRTaG93T3B0aW9ucygpXG4gICAgbGV0IHNob3dPcHRpb25zSW5kZXggPSBzaG93T3B0aW9ucy5sZW5ndGggLSAxXG4gICAgY29uc3QgYWN0aXZlT3B0aW9ucyA9IHRoaXMuZ2V0QWN0aXZlT3B0aW9ucygpXG4gICAgY29uc3QgZHJvcGRvd25NZW51Q29sdW1uU3R5bGVTaW5nbGUgPSB7Li4uZHJvcGRvd25NZW51Q29sdW1uU3R5bGUsLi4uc2luZ2xlTWVudVN0eWxlfVxuICAgIGNvbnN0IHRhYkl0ZW1SZW5kZXIgPSBhY3RpdmVPcHRpb25zLm1hcCgoaXRlbSxpbmRleEl0ZW0pID0+ICh0aGlzLmdldFRhYkl0ZW0oaXRlbSxpbmRleEl0ZW0pKSlcbiAgICBsZXQgdGFiSXRlbVJlbmRlclJlc3VsdCBcbiAgICBpZihzaG93T3B0aW9ucyAmJiBhY3RpdmVPcHRpb25zICYmICFpc1RhYlNlbGVjdGVkICYmIHNob3dPcHRpb25zLmxlbmd0aCA+IGFjdGl2ZU9wdGlvbnMubGVuZ3RoKXtcbiAgICAgICBjb25zdCBwbGVhc2VSZW5kZXJQcm9wcyA9IHtcbiAgICAgICAga2V5OlwicGxlYXNlX2NoZWNrXCIgLFxuICAgICAgICBjbGFzc05hbWU6IGAke3ByZWZpeENsc30tbWVudS10YWItaXRlbSAke3ByZWZpeENsc30tbWVudS10YWItcGxlYXNlYCxcbiAgICAgICAgdGV4dDpsb2NhbGUucGxlYXNlU2VsZWN0XG4gICAgICAgfVxuICAgICAgIGlmKGlzRnVuY3Rpb24oc2luZ2xlUGxlYXNlUmVuZGVyKSl7XG4gICAgICAgIHRhYkl0ZW1SZW5kZXJSZXN1bHQgPSBzaW5nbGVQbGVhc2VSZW5kZXIocGxlYXNlUmVuZGVyUHJvcHMpXG4gICAgICAgfWVsc2V7XG4gICAgICAgIGNvbnN0IHBsZWFzZUl0ZW0gPSAoICAgIFxuICAgICAgICAgICAgPHNwYW4gey4uLnBsZWFzZVJlbmRlclByb3BzfT5cbiAgICAgICAgICAgICAge3BsZWFzZVJlbmRlclByb3BzLnRleHR9XG4gICAgICAgICAgICAgIDxJY29uIHR5cGU9XCJhcnJvd19kcm9wX2Rvd25cIiAvPlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICApXG4gICAgICAgIHRhYkl0ZW1SZW5kZXJSZXN1bHQgPSB0YWJJdGVtUmVuZGVyLmxlbmd0aCA+IDAgPyBbLi4udGFiSXRlbVJlbmRlcixwbGVhc2VJdGVtXSA6IHBsZWFzZUl0ZW07XG4gICAgICAgfVxuICAgIH1cbiAgICBpZihpc1RhYlNlbGVjdGVkKXtcbiAgICAgIHNob3dPcHRpb25zSW5kZXggPSBhY3RpdmVPcHRpb25zLmxlbmd0aCAtIDEgPCAwID8gMCA6IGFjdGl2ZU9wdGlvbnMubGVuZ3RoIC0gMVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1tb2RlLXNpbmdsZSBgfT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tbWVudS10YWJgfT5cbiAgICAgICAgICB7dGFiSXRlbVJlbmRlclJlc3VsdCB8fCB0YWJJdGVtUmVuZGVyIH1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDx1bCBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tbWVudSAke3ByZWZpeENsc30tbWVudS1zaW5nbGUgYH0ga2V5PXtzaG93T3B0aW9uc0luZGV4fSBzdHlsZT17ZHJvcGRvd25NZW51Q29sdW1uU3R5bGVTaW5nbGV9PlxuICAgICAgICAgICAge3Nob3dPcHRpb25zW3Nob3dPcHRpb25zSW5kZXhdLm1hcChvcHRpb24gPT4gdGhpcy5nZXRPcHRpb24ob3B0aW9uLCBzaG93T3B0aW9uc0luZGV4KSl9XG4gICAgICAgIDwvdWw+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG4iXX0=