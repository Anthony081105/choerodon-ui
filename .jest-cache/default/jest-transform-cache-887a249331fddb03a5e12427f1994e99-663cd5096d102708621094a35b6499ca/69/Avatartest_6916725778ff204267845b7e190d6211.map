{"version":3,"sources":["Avatar.test.js"],"names":["describe","it","wrapper","children","find","expect","length","toBe","div","global","document","createElement","body","appendChild","attachTo","instance","setScale","jest","fn","setState","scale","simulate","text","toHaveBeenCalled","querySelector","style","transform","toContain","detach","removeChild","LOAD_FAILURE_SRC","LOAD_SUCCESS_SRC","Foo","src","state","handleImgError","React","Component","Avatar","isImgExist","getAttribute"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { mount } from 'enzyme';\nimport Avatar from '..';\n\ndescribe('Avatar Render', () => {\n  it('Render long string correctly', () => {\n    const wrapper = mount(<Avatar>TestString</Avatar>);\n    const children = wrapper.find('.c7n-avatar-string');\n    expect(children.length).toBe(1);\n  });\n\n  it('should render fallback string correctly', () => {\n    const div = global.document.createElement('div');\n    global.document.body.appendChild(div);\n\n    const wrapper = mount(<Avatar src=\"http://error.url\">Fallback</Avatar>, { attachTo: div });\n    wrapper.instance().setScale = jest.fn(() => wrapper.instance().setState({ scale: 0.5 }));\n\n    wrapper.find('img').simulate('error');\n\n    const children = wrapper.find('.c7n-avatar-string');\n    expect(children.length).toBe(1);\n    expect(children.text()).toBe('Fallback');\n    expect(wrapper.instance().setScale).toHaveBeenCalled();\n    expect(div.querySelector('.c7n-avatar-string').style.transform).toContain('scale(0.5)');\n\n    wrapper.detach();\n    global.document.body.removeChild(div);\n  });\n\n  it('should handle onError correctly', () => {\n    const LOAD_FAILURE_SRC = 'http://error.url';\n    const LOAD_SUCCESS_SRC = 'https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png';\n\n    const div = global.document.createElement('div');\n    global.document.body.appendChild(div);\n\n    class Foo extends React.Component {\n      state = {\n        src: LOAD_FAILURE_SRC,\n      };\n\n      handleImgError = () => {\n        this.setState({\n          src: LOAD_SUCCESS_SRC,\n        });\n        return false;\n      };\n\n      render() {\n        const { src } = this.state;\n        return <Avatar src={src} onError={this.handleImgError} />;\n      }\n    }\n\n    const wrapper = mount(<Foo />, { attachTo: div });\n    // mock img load Error, since jsdom do not load resource by default\n    // https://github.com/jsdom/jsdom/issues/1816\n    wrapper.find('img').simulate('error');\n\n    expect(wrapper.find(Avatar).instance().state.isImgExist).toBe(true);\n    expect(div.querySelector('img').getAttribute('src')).toBe(LOAD_SUCCESS_SRC);\n\n    wrapper.detach();\n    global.document.body.removeChild(div);\n  });\n});\n"]}