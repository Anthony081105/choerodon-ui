5252233363320e0997cae19b3a279414
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getValuePropValue = getValuePropValue;
exports.getPropValue = getPropValue;
exports.isMultiple = isMultiple;
exports.isTags = isTags;
exports.isCombobox = isCombobox;
exports.isMultipleOrTags = isMultipleOrTags;
exports.isMultipleOrTagsOrCombobox = isMultipleOrTagsOrCombobox;
exports.isSingleMode = isSingleMode;
exports.toArray = toArray;
exports.getMapKey = getMapKey;
exports.preventDefaultEvent = preventDefaultEvent;
exports.findIndexInValueBySingleValue = findIndexInValueBySingleValue;
exports.getLabelFromPropsValue = getLabelFromPropsValue;
exports.getSelectKeys = getSelectKeys;
exports.findFirstMenuItem = findFirstMenuItem;
exports.includesSeparators = includesSeparators;
exports.splitBySeparators = splitBySeparators;
exports.defaultFilterFn = defaultFilterFn;
exports.validateOptionValue = validateOptionValue;
exports.saveRef = saveRef;
exports.UNSELECTABLE_ATTRIBUTE = exports.UNSELECTABLE_STYLE = void 0;

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _react = require("react");

function getValuePropValue(child) {
  var props = child.props;

  if ('value' in props) {
    return props.value;
  }

  if (child.key) {
    return child.key;
  }

  if (child.type && child.type.isSelectOptGroup && props.label) {
    return props.label;
  }

  throw new Error("Need at least a key or a value or a label (only for OptGroup) for ".concat(child));
}

function getPropValue(child, prop) {
  if (prop === 'value') {
    return getValuePropValue(child);
  }

  return child.props[prop];
}

function isMultiple(props) {
  return props.multiple;
}

function isTags(props) {
  return props.tags;
}

function isCombobox(props) {
  return props.combobox;
}

function isMultipleOrTags(props) {
  return props.multiple || props.tags;
}

function isMultipleOrTagsOrCombobox(props) {
  return isMultipleOrTags(props) || isCombobox(props);
}

function isSingleMode(props) {
  return !isMultipleOrTagsOrCombobox(props);
}

function toArray(value) {
  var ret = value;

  if (value === undefined) {
    ret = [];
  } else if (!Array.isArray(value)) {
    ret = [value];
  }

  return ret;
}

function getMapKey(value) {
  return "".concat((0, _typeof2["default"])(value), "-").concat(value);
}

function preventDefaultEvent(e) {
  e.preventDefault();
}

function findIndexInValueBySingleValue(value, singleValue) {
  var index = -1;

  for (var i = 0; i < value.length; i++) {
    if (value[i] === singleValue) {
      index = i;
      break;
    }
  }

  return index;
}

function getLabelFromPropsValue(value, key) {
  var label;
  value = toArray(value);

  for (var i = 0; i < value.length; i++) {
    if (value[i].key === key) {
      label = value[i].label;
      break;
    }
  }

  return label;
}

function getSelectKeys(menuItems, value) {
  if (value === null || value === undefined) {
    return [];
  }

  var selectedKeys = [];

  _react.Children.forEach(menuItems, function (item) {
    if (item.type.isMenuItemGroup) {
      selectedKeys = selectedKeys.concat(getSelectKeys(item.props.children, value));
    } else {
      var itemValue = getValuePropValue(item);
      var itemKey = item.key;

      if (findIndexInValueBySingleValue(value, itemValue) !== -1 && itemKey) {
        selectedKeys.push(itemKey);
      }
    }
  });

  return selectedKeys;
}

var UNSELECTABLE_STYLE = {
  userSelect: 'none',
  WebkitUserSelect: 'none'
};
exports.UNSELECTABLE_STYLE = UNSELECTABLE_STYLE;
var UNSELECTABLE_ATTRIBUTE = {
  unselectable: 'unselectable'
};
exports.UNSELECTABLE_ATTRIBUTE = UNSELECTABLE_ATTRIBUTE;

function findFirstMenuItem(children) {
  for (var i = 0; i < children.length; i++) {
    var child = children[i];

    if (child.type.isMenuItemGroup) {
      var found = findFirstMenuItem(child.props.children);

      if (found) {
        return found;
      }
    } else if (!child.props.disabled) {
      return child;
    }
  }

  return null;
}

function includesSeparators(string, separators) {
  for (var i = 0; i < separators.length; ++i) {
    if (string.lastIndexOf(separators[i]) > 0) {
      return true;
    }
  }

  return false;
}

function splitBySeparators(string, separators) {
  var reg = new RegExp("[".concat(separators.join(), "]"));
  return string.split(reg).filter(function (token) {
    return token;
  });
}

function defaultFilterFn(input, child) {
  if (child.props.disabled) {
    return false;
  }

  var value = toArray(getPropValue(child, this.props.optionFilterProp)).join('');
  return value.toLowerCase().indexOf(input.toLowerCase()) > -1;
}

function validateOptionValue(value, props) {
  if (isSingleMode(props) || isMultiple(props)) {
    return;
  }

  if (typeof value !== 'string') {
    throw new Error("Invalid `value` of type `".concat((0, _typeof2["default"])(value), "` supplied to Option, ") + "expected `string` when `tags/combobox` is `true`.");
  }
}

function saveRef(instance, name) {
  return function (node) {
    instance[name] = node;
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwuanN4Il0sIm5hbWVzIjpbImdldFZhbHVlUHJvcFZhbHVlIiwiY2hpbGQiLCJwcm9wcyIsInZhbHVlIiwia2V5IiwidHlwZSIsImlzU2VsZWN0T3B0R3JvdXAiLCJsYWJlbCIsIkVycm9yIiwiZ2V0UHJvcFZhbHVlIiwicHJvcCIsImlzTXVsdGlwbGUiLCJtdWx0aXBsZSIsImlzVGFncyIsInRhZ3MiLCJpc0NvbWJvYm94IiwiY29tYm9ib3giLCJpc011bHRpcGxlT3JUYWdzIiwiaXNNdWx0aXBsZU9yVGFnc09yQ29tYm9ib3giLCJpc1NpbmdsZU1vZGUiLCJ0b0FycmF5IiwicmV0IiwidW5kZWZpbmVkIiwiQXJyYXkiLCJpc0FycmF5IiwiZ2V0TWFwS2V5IiwicHJldmVudERlZmF1bHRFdmVudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImZpbmRJbmRleEluVmFsdWVCeVNpbmdsZVZhbHVlIiwic2luZ2xlVmFsdWUiLCJpbmRleCIsImkiLCJsZW5ndGgiLCJnZXRMYWJlbEZyb21Qcm9wc1ZhbHVlIiwiZ2V0U2VsZWN0S2V5cyIsIm1lbnVJdGVtcyIsInNlbGVjdGVkS2V5cyIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsIml0ZW0iLCJpc01lbnVJdGVtR3JvdXAiLCJjb25jYXQiLCJjaGlsZHJlbiIsIml0ZW1WYWx1ZSIsIml0ZW1LZXkiLCJwdXNoIiwiVU5TRUxFQ1RBQkxFX1NUWUxFIiwidXNlclNlbGVjdCIsIldlYmtpdFVzZXJTZWxlY3QiLCJVTlNFTEVDVEFCTEVfQVRUUklCVVRFIiwidW5zZWxlY3RhYmxlIiwiZmluZEZpcnN0TWVudUl0ZW0iLCJmb3VuZCIsImRpc2FibGVkIiwiaW5jbHVkZXNTZXBhcmF0b3JzIiwic3RyaW5nIiwic2VwYXJhdG9ycyIsImxhc3RJbmRleE9mIiwic3BsaXRCeVNlcGFyYXRvcnMiLCJyZWciLCJSZWdFeHAiLCJqb2luIiwic3BsaXQiLCJmaWx0ZXIiLCJ0b2tlbiIsImRlZmF1bHRGaWx0ZXJGbiIsImlucHV0Iiwib3B0aW9uRmlsdGVyUHJvcCIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsInZhbGlkYXRlT3B0aW9uVmFsdWUiLCJzYXZlUmVmIiwiaW5zdGFuY2UiLCJuYW1lIiwibm9kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVPLFNBQVNBLGlCQUFULENBQTJCQyxLQUEzQixFQUFrQztBQUN2QyxNQUFNQyxLQUFLLEdBQUdELEtBQUssQ0FBQ0MsS0FBcEI7O0FBQ0EsTUFBSSxXQUFXQSxLQUFmLEVBQXNCO0FBQ3BCLFdBQU9BLEtBQUssQ0FBQ0MsS0FBYjtBQUNEOztBQUNELE1BQUlGLEtBQUssQ0FBQ0csR0FBVixFQUFlO0FBQ2IsV0FBT0gsS0FBSyxDQUFDRyxHQUFiO0FBQ0Q7O0FBQ0QsTUFBSUgsS0FBSyxDQUFDSSxJQUFOLElBQWNKLEtBQUssQ0FBQ0ksSUFBTixDQUFXQyxnQkFBekIsSUFBNkNKLEtBQUssQ0FBQ0ssS0FBdkQsRUFBOEQ7QUFDNUQsV0FBT0wsS0FBSyxDQUFDSyxLQUFiO0FBQ0Q7O0FBQ0QsUUFBTSxJQUFJQyxLQUFKLDZFQUNpRVAsS0FEakUsRUFBTjtBQUdEOztBQUVNLFNBQVNRLFlBQVQsQ0FBc0JSLEtBQXRCLEVBQTZCUyxJQUE3QixFQUFtQztBQUN4QyxNQUFJQSxJQUFJLEtBQUssT0FBYixFQUFzQjtBQUNwQixXQUFPVixpQkFBaUIsQ0FBQ0MsS0FBRCxDQUF4QjtBQUNEOztBQUNELFNBQU9BLEtBQUssQ0FBQ0MsS0FBTixDQUFZUSxJQUFaLENBQVA7QUFDRDs7QUFFTSxTQUFTQyxVQUFULENBQW9CVCxLQUFwQixFQUEyQjtBQUNoQyxTQUFPQSxLQUFLLENBQUNVLFFBQWI7QUFDRDs7QUFFTSxTQUFTQyxNQUFULENBQWdCWCxLQUFoQixFQUF1QjtBQUM1QixTQUFPQSxLQUFLLENBQUNZLElBQWI7QUFDRDs7QUFFTSxTQUFTQyxVQUFULENBQW9CYixLQUFwQixFQUEyQjtBQUNoQyxTQUFPQSxLQUFLLENBQUNjLFFBQWI7QUFD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QjtBQUM3QixVQUFNLElBQUlLLEtBQUosQ0FDSiw0REFBc0NMLEtBQXRDLGtGQURJLENBQU47QUFJRDtBQUNGOztBQUVNLFNBQVNxRSxPQUFULENBQWlCQyxRQUFqQixFQUEyQkMsSUFBM0IsRUFBaUM7QUFDdEMsU0FBTyxVQUFDQyxJQUFELEVBQVU7QUFDZkYsSUFBQUEsUUFBUSxDQUFDQyxJQUFELENBQVIsR0FBaUJDLElBQWpCO0FBQ0QsR0FGRDtBQUdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hpbGRyZW4gfSBmcm9tICdyZWFjdCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRWYWx1ZVByb3BWYWx1ZShjaGlsZCkge1xuICBjb25zdCBwcm9wcyA9IGNoaWxkLnByb3BzO1xuICBpZiAoJ3ZhbHVlJyBpbiBwcm9wcykge1xuICAgIHJldHVybiBwcm9wcy52YWx1ZTtcbiAgfVxuICBpZiAoY2hpbGQua2V5KSB7XG4gICAgcmV0dXJuIGNoaWxkLmtleTtcbiAgfVxuICBpZiAoY2hpbGQudHlwZSAmJiBjaGlsZC50eXBlLmlzU2VsZWN0T3B0R3JvdXAgJiYgcHJvcHMubGFiZWwpIHtcbiAgICByZXR1cm4gcHJvcHMubGFiZWw7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKFxuICAgIGBOZWVkIGF0IGxlYXN0IGEga2V5IG9yIGEgdmFsdWUgb3IgYSBsYWJlbCAob25seSBmb3IgT3B0R3JvdXApIGZvciAke2NoaWxkfWAsXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQcm9wVmFsdWUoY2hpbGQsIHByb3ApIHtcbiAgaWYgKHByb3AgPT09ICd2YWx1ZScpIHtcbiAgICByZXR1cm4gZ2V0VmFsdWVQcm9wVmFsdWUoY2hpbGQpO1xuICB9XG4gIHJldHVybiBjaGlsZC5wcm9wc1twcm9wXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzTXVsdGlwbGUocHJvcHMpIHtcbiAgcmV0dXJuIHByb3BzLm11bHRpcGxlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNUYWdzKHByb3BzKSB7XG4gIHJldHVybiBwcm9wcy50YWdzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNDb21ib2JveChwcm9wcykge1xuICByZXR1cm4gcHJvcHMuY29tYm9ib3g7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc011bHRpcGxlT3JUYWdzKHByb3BzKSB7XG4gIHJldHVybiBwcm9wcy5tdWx0aXBsZSB8fCBwcm9wcy50YWdzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNNdWx0aXBsZU9yVGFnc09yQ29tYm9ib3gocHJvcHMpIHtcbiAgcmV0dXJuIGlzTXVsdGlwbGVPclRhZ3MocHJvcHMpIHx8IGlzQ29tYm9ib3gocHJvcHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTaW5nbGVNb2RlKHByb3BzKSB7XG4gIHJldHVybiAhaXNNdWx0aXBsZU9yVGFnc09yQ29tYm9ib3gocHJvcHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9BcnJheSh2YWx1ZSkge1xuICBsZXQgcmV0ID0gdmFsdWU7XG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0ID0gW107XG4gIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0ID0gW3ZhbHVlXTtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWFwS2V5KHZhbHVlKSB7XG4gIHJldHVybiBgJHt0eXBlb2YgdmFsdWV9LSR7dmFsdWV9YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0RXZlbnQoZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kSW5kZXhJblZhbHVlQnlTaW5nbGVWYWx1ZSh2YWx1ZSwgc2luZ2xlVmFsdWUpIHtcbiAgbGV0IGluZGV4ID0gLTE7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodmFsdWVbaV0gPT09IHNpbmdsZVZhbHVlKSB7XG4gICAgICBpbmRleCA9IGk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGluZGV4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TGFiZWxGcm9tUHJvcHNWYWx1ZSh2YWx1ZSwga2V5KSB7XG4gIGxldCBsYWJlbDtcbiAgdmFsdWUgPSB0b0FycmF5KHZhbHVlKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB2YWx1ZS5sZW5ndGg7IGkrKykge1xuICAgIGlmICh2YWx1ZVtpXS5rZXkgPT09IGtleSkge1xuICAgICAgbGFiZWwgPSB2YWx1ZVtpXS5sYWJlbDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGFiZWw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZWxlY3RLZXlzKG1lbnVJdGVtcywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgbGV0IHNlbGVjdGVkS2V5cyA9IFtdO1xuICBDaGlsZHJlbi5mb3JFYWNoKG1lbnVJdGVtcywgaXRlbSA9PiB7XG4gICAgaWYgKGl0ZW0udHlwZS5pc01lbnVJdGVtR3JvdXApIHtcbiAgICAgIHNlbGVjdGVkS2V5cyA9IHNlbGVjdGVkS2V5cy5jb25jYXQoXG4gICAgICAgIGdldFNlbGVjdEtleXMoaXRlbS5wcm9wcy5jaGlsZHJlbiwgdmFsdWUpLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaXRlbVZhbHVlID0gZ2V0VmFsdWVQcm9wVmFsdWUoaXRlbSk7XG4gICAgICBjb25zdCBpdGVtS2V5ID0gaXRlbS5rZXk7XG4gICAgICBpZiAoZmluZEluZGV4SW5WYWx1ZUJ5U2luZ2xlVmFsdWUodmFsdWUsIGl0ZW1WYWx1ZSkgIT09IC0xICYmIGl0ZW1LZXkpIHtcbiAgICAgICAgc2VsZWN0ZWRLZXlzLnB1c2goaXRlbUtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHNlbGVjdGVkS2V5cztcbn1cblxuZXhwb3J0IGNvbnN0IFVOU0VMRUNUQUJMRV9TVFlMRSA9IHtcbiAgdXNlclNlbGVjdDogJ25vbmUnLFxuICBXZWJraXRVc2VyU2VsZWN0OiAnbm9uZScsXG59O1xuXG5leHBvcnQgY29uc3QgVU5TRUxFQ1RBQkxFX0FUVFJJQlVURSA9IHtcbiAgdW5zZWxlY3RhYmxlOiAndW5zZWxlY3RhYmxlJyxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kRmlyc3RNZW51SXRlbShjaGlsZHJlbikge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTtcbiAgICBpZiAoY2hpbGQudHlwZS5pc01lbnVJdGVtR3JvdXApIHtcbiAgICAgIGNvbnN0IGZvdW5kID0gZmluZEZpcnN0TWVudUl0ZW0oY2hpbGQucHJvcHMuY2hpbGRyZW4pO1xuICAgICAgaWYgKGZvdW5kKSB7XG4gICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFjaGlsZC5wcm9wcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuIGNoaWxkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluY2x1ZGVzU2VwYXJhdG9ycyhzdHJpbmcsIHNlcGFyYXRvcnMpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXBhcmF0b3JzLmxlbmd0aDsgKytpKSB7XG4gICAgaWYgKHN0cmluZy5sYXN0SW5kZXhPZihzZXBhcmF0b3JzW2ldKSA+IDApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzcGxpdEJ5U2VwYXJhdG9ycyhzdHJpbmcsIHNlcGFyYXRvcnMpIHtcbiAgY29uc3QgcmVnID0gbmV3IFJlZ0V4cChgWyR7c2VwYXJhdG9ycy5qb2luKCl9XWApO1xuICByZXR1cm4gc3RyaW5nLnNwbGl0KHJlZykuZmlsdGVyKHRva2VuID0+IHRva2VuKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlZmF1bHRGaWx0ZXJGbihpbnB1dCwgY2hpbGQpIHtcbiAgaWYgKGNoaWxkLnByb3BzLmRpc2FibGVkKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHZhbHVlID0gdG9BcnJheShnZXRQcm9wVmFsdWUoY2hpbGQsIHRoaXMucHJvcHMub3B0aW9uRmlsdGVyUHJvcCkpLmpvaW4oJycpO1xuICByZXR1cm4gKFxuICAgIHZhbHVlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihpbnB1dC50b0xvd2VyQ2FzZSgpKSA+IC0xXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZU9wdGlvblZhbHVlKHZhbHVlLCBwcm9wcykge1xuICBpZiAoaXNTaW5nbGVNb2RlKHByb3BzKSB8fCBpc011bHRpcGxlKHByb3BzKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBJbnZhbGlkIFxcYHZhbHVlXFxgIG9mIHR5cGUgXFxgJHt0eXBlb2YgdmFsdWV9XFxgIHN1cHBsaWVkIHRvIE9wdGlvbiwgYCArXG4gICAgICBgZXhwZWN0ZWQgXFxgc3RyaW5nXFxgIHdoZW4gXFxgdGFncy9jb21ib2JveFxcYCBpcyBcXGB0cnVlXFxgLmAsXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2F2ZVJlZihpbnN0YW5jZSwgbmFtZSkge1xuICByZXR1cm4gKG5vZGUpID0+IHtcbiAgICBpbnN0YW5jZVtuYW1lXSA9IG5vZGU7XG4gIH07XG59XG4iXX0=