26e08463ffb6be4b105e06942fa78f92
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _createReactClass = _interopRequireDefault(require("create-react-class"));

var _KeyCode = _interopRequireDefault(require("../../_util/KeyCode"));

var _classnames = _interopRequireDefault(require("classnames"));

var _miniStore = require("mini-store");

var _noop = _interopRequireDefault(require("lodash/noop"));

var _Checkbox = _interopRequireDefault(require("../../checkbox/Checkbox"));

var _ripple = _interopRequireDefault(require("../../ripple"));

/* eslint react/no-is-mounted:0 */
var MenuItem = (0, _createReactClass["default"])({
  displayName: 'MenuItem',
  propTypes: {
    rootPrefixCls: _propTypes["default"].string,
    eventKey: _propTypes["default"].string,
    active: _propTypes["default"].bool,
    children: _propTypes["default"].any,
    selectedKeys: _propTypes["default"].array,
    disabled: _propTypes["default"].bool,
    title: _propTypes["default"].string,
    onItemHover: _propTypes["default"].func,
    onSelect: _propTypes["default"].func,
    onClick: _propTypes["default"].func,
    onDeselect: _propTypes["default"].func,
    parentMenu: _propTypes["default"].object,
    onDestroy: _propTypes["default"].func,
    onMouseEnter: _propTypes["default"].func,
    onMouseLeave: _propTypes["default"].func,
    onMouseDown: _propTypes["default"].func
  },
  getDefaultProps: function getDefaultProps() {
    return {
      onSelect: _noop["default"],
      onMouseEnter: _noop["default"],
      onMouseLeave: _noop["default"],
      onMouseDown: _noop["default"]
    };
  },
  componentWillUnmount: function componentWillUnmount() {
    var props = this.props;

    if (props.onDestroy) {
      props.onDestroy(props.eventKey);
    }
  },
  componentDidMount: function componentDidMount() {
    // invoke customized ref to expose component to mixin
    if (this.props.manualRef) {
      this.props.manualRef(this);
    }
  },
  componentDidUpdate: function componentDidUpdate() {
    // invoke customized ref to expose component to mixin
    if (this.props.manualRef) {
      this.props.manualRef(this);
    }
  },
  onKeyDown: function onKeyDown(e) {
    var keyCode = e.keyCode;

    if (keyCode === _KeyCode["default"].ENTER) {
      this.onClick(e);
      return true;
    }
  },
  onMouseLeave: function onMouseLeave(e) {
    var _this$props = this.props,
        eventKey = _this$props.eventKey,
        onItemHover = _this$props.onItemHover,
        onMouseLeave = _this$props.onMouseLeave;
    onItemHover({
      key: eventKey,
      hover: false
    });
    onMouseLeave({
      key: eventKey,
      domEvent: e
    });
  },
  onMouseEnter: function onMouseEnter(e) {
    var _this$props2 = this.props,
        eventKey = _this$props2.eventKey,
        onItemHover = _this$props2.onItemHover,
        onMouseEnter = _this$props2.onMouseEnter;
    onItemHover({
      key: eventKey,
      hover: true
    });
    onMouseEnter({
      key: eventKey,
      domEvent: e
    });
  },
  onClick: function onClick(e) {
    var _this$props3 = this.props,
        eventKey = _this$props3.eventKey,
        multiple = _this$props3.multiple,
        onClick = _this$props3.onClick,
        onSelect = _this$props3.onSelect,
        onDeselect = _this$props3.onDeselect,
        isSelected = _this$props3.isSelected;
    var info = {
      key: eventKey,
      keyPath: [eventKey],
      item: this,
      domEvent: e
    };
    onClick(info);

    if (multiple) {
      if (isSelected) {
        onDeselect(info);
      } else {
        onSelect(info);
      }
    } else if (!isSelected) {
      onSelect(info);
    }
  },
  getPrefixCls: function getPrefixCls() {
    return "".concat(this.props.rootPrefixCls, "-item");
  },
  getActiveClassName: function getActiveClassName() {
    return "".concat(this.getPrefixCls(), "-active");
  },
  getSelectedClassName: function getSelectedClassName() {
    return "".concat(this.getPrefixCls(), "-selected");
  },
  getDisabledClassName: function getDisabledClassName() {
    return "".concat(this.getPrefixCls(), "-disabled");
  },
  render: function render() {
    var _classNames;

    var props = this.props;
    var className = (0, _classnames["default"])(this.getPrefixCls(), props.className, (_classNames = {}, (0, _defineProperty2["default"])(_classNames, this.getActiveClassName(), !props.disabled && props.active), (0, _defineProperty2["default"])(_classNames, this.getSelectedClassName(), props.isSelected), (0, _defineProperty2["default"])(_classNames, this.getDisabledClassName(), props.disabled), _classNames));
    var attrs = (0, _objectSpread2["default"])({}, props.attribute, {
      title: props.title,
      className: className,
      role: 'menuitem',
      'aria-selected': props.isSelected,
      'aria-disabled': props.disabled
    });
    var mouseEvent = {};

    if (!props.disabled) {
      mouseEvent = {
        onClick: this.onClick,
        onMouseLeave: this.onMouseLeave,
        onMouseEnter: this.onMouseEnter,
        onMouseDown: this.props.onMouseDown
      };
    }

    var style = (0, _objectSpread2["default"])({}, props.style);

    if (props.mode === 'inline') {
      style.paddingLeft = props.inlineIndent * props.level;
    }

    var notFound = props.eventKey === 'NOT_FOUND';
    var checkbox = props.multiple && !notFound ? _react["default"].createElement(_Checkbox["default"], {
      disabled: props.disabled,
      checked: props.isSelected,
      tabIndex: -1
    }) : null;
    return _react["default"].createElement(_ripple["default"], {
      disabled: props.disabled
    }, _react["default"].createElement("li", (0, _extends2["default"])({}, attrs, mouseEvent, {
      style: style
    }), checkbox, props.children));
  }
});
MenuItem.isMenuItem = 1;

var _default = (0, _miniStore.connect)(function (_ref, _ref2) {
  var activeKey = _ref.activeKey,
      selectedKeys = _ref.selectedKeys;
  var eventKey = _ref2.eventKey,
      subMenuKey = _ref2.subMenuKey;
  return {
    active: activeKey[subMenuKey] === eventKey,
    isSelected: selectedKeys.indexOf(eventKey) !== -1
  };
})(MenuItem);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lbnVJdGVtLmpzeCJdLCJuYW1lcyI6WyJNZW51SXRlbSIsImRpc3BsYXlOYW1lIiwicHJvcFR5cGVzIiwicm9vdFByZWZpeENscyIsIlByb3BUeXBlcyIsInN0cmluZyIsImV2ZW50S2V5IiwiYWN0aXZlIiwiYm9vbCIsImNoaWxkcmVuIiwiYW55Iiwic2VsZWN0ZWRLZXlzIiwiYXJyYXkiLCJkaXNhYmxlZCIsInRpdGxlIiwib25JdGVtSG92ZXIiLCJmdW5jIiwib25TZWxlY3QiLCJvbkNsaWNrIiwib25EZXNlbGVjdCIsInBhcmVudE1lbnUiLCJvYmplY3QiLCJvbkRlc3Ryb3kiLCJvbk1vdXNlRW50ZXIiLCJvbk1vdXNlTGVhdmUiLCJvbk1vdXNlRG93biIsImdldERlZmF1bHRQcm9wcyIsIm5vb3AiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInByb3BzIiwiY29tcG9uZW50RGlkTW91bnQiLCJtYW51YWxSZWYiLCJjb21wb25lbnREaWRVcGRhdGUiLCJvbktleURvd24iLCJlIiwia2V5Q29kZSIsIktleUNvZGUiLCJFTlRFUiIsImtleSIsImhvdmVyIiwiZG9tRXZlbnQiLCJtdWx0aXBsZSIsImlzU2VsZWN0ZWQiLCJpbmZvIiwia2V5UGF0aCIsIml0ZW0iLCJnZXRQcmVmaXhDbHMiLCJnZXRBY3RpdmVDbGFzc05hbWUiLCJnZXRTZWxlY3RlZENsYXNzTmFtZSIsImdldERpc2FibGVkQ2xhc3NOYW1lIiwicmVuZGVyIiwiY2xhc3NOYW1lIiwiYXR0cnMiLCJhdHRyaWJ1dGUiLCJyb2xlIiwibW91c2VFdmVudCIsInN0eWxlIiwibW9kZSIsInBhZGRpbmdMZWZ0IiwiaW5saW5lSW5kZW50IiwibGV2ZWwiLCJub3RGb3VuZCIsImNoZWNrYm94IiwiaXNNZW51SXRlbSIsImFjdGl2ZUtleSIsInN1Yk1lbnVLZXkiLCJpbmRleE9mIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFD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Q0FBakI7QUF3S0FULFFBQVEsQ0FBQytELFVBQVQsR0FBc0IsQ0FBdEI7O2VBRWUsd0JBQVE7QUFBQSxNQUFHQyxTQUFILFFBQUdBLFNBQUg7QUFBQSxNQUFjckQsWUFBZCxRQUFjQSxZQUFkO0FBQUEsTUFBZ0NMLFFBQWhDLFNBQWdDQSxRQUFoQztBQUFBLE1BQTBDMkQsVUFBMUMsU0FBMENBLFVBQTFDO0FBQUEsU0FBNEQ7QUFDakYxRCxJQUFBQSxNQUFNLEVBQUV5RCxTQUFTLENBQUNDLFVBQUQsQ0FBVCxLQUEwQjNELFFBRCtDO0FBRWpGb0MsSUFBQUEsVUFBVSxFQUFFL0IsWUFBWSxDQUFDdUQsT0FBYixDQUFxQjVELFFBQXJCLE1BQW1DLENBQUM7QUFGaUMsR0FBNUQ7QUFBQSxDQUFSLEVBR1hOLFFBSFcsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGNyZWF0ZVJlYWN0Q2xhc3MgZnJvbSAnY3JlYXRlLXJlYWN0LWNsYXNzJztcbmltcG9ydCBLZXlDb2RlIGZyb20gJy4uLy4uL191dGlsL0tleUNvZGUnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAnbWluaS1zdG9yZSc7XG5pbXBvcnQgbm9vcCBmcm9tICdsb2Rhc2gvbm9vcCc7XG5pbXBvcnQgQ2hlY2tib3ggZnJvbSAnLi4vLi4vY2hlY2tib3gvQ2hlY2tib3gnO1xuaW1wb3J0IFJpcHBsZSBmcm9tICcuLi8uLi9yaXBwbGUnO1xuLyogZXNsaW50IHJlYWN0L25vLWlzLW1vdW50ZWQ6MCAqL1xuXG5jb25zdCBNZW51SXRlbSA9IGNyZWF0ZVJlYWN0Q2xhc3Moe1xuICBkaXNwbGF5TmFtZTogJ01lbnVJdGVtJyxcblxuICBwcm9wVHlwZXM6IHtcbiAgICByb290UHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGV2ZW50S2V5OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGFjdGl2ZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gICAgc2VsZWN0ZWRLZXlzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHRpdGxlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9uSXRlbUhvdmVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvblNlbGVjdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25DbGljazogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25EZXNlbGVjdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgcGFyZW50TWVudTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBvbkRlc3Ryb3k6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uTW91c2VFbnRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Nb3VzZUxlYXZlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbk1vdXNlRG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gIH0sXG5cbiAgZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBvblNlbGVjdDogbm9vcCxcbiAgICAgIG9uTW91c2VFbnRlcjogbm9vcCxcbiAgICAgIG9uTW91c2VMZWF2ZTogbm9vcCxcbiAgICAgIG9uTW91c2VEb3duOiBub29wLFxuICAgIH07XG4gIH0sXG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGlmIChwcm9wcy5vbkRlc3Ryb3kpIHtcbiAgICAgIHByb3BzLm9uRGVzdHJveShwcm9wcy5ldmVudEtleSk7XG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIC8vIGludm9rZSBjdXN0b21pemVkIHJlZiB0byBleHBvc2UgY29tcG9uZW50IHRvIG1peGluXG4gICAgaWYgKHRoaXMucHJvcHMubWFudWFsUmVmKSB7XG4gICAgICB0aGlzLnByb3BzLm1hbnVhbFJlZih0aGlzKTtcbiAgICB9XG4gIH0sXG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIC8vIGludm9rZSBjdXN0b21pemVkIHJlZiB0byBleHBvc2UgY29tcG9uZW50IHRvIG1peGluXG4gICAgaWYgKHRoaXMucHJvcHMubWFudWFsUmVmKSB7XG4gICAgICB0aGlzLnByb3BzLm1hbnVhbFJlZih0aGlzKTtcbiAgICB9XG4gIH0sXG5cbiAgb25LZXlEb3duKGUpIHtcbiAgICBjb25zdCBrZXlDb2RlID0gZS5rZXlDb2RlO1xuICAgIGlmIChrZXlDb2RlID09PSBLZXlDb2RlLkVOVEVSKSB7XG4gICAgICB0aGlzLm9uQ2xpY2soZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0sXG5cbiAgb25Nb3VzZUxlYXZlKGUpIHtcbiAgICBjb25zdCB7IGV2ZW50S2V5LCBvbkl0ZW1Ib3Zlciwgb25Nb3VzZUxlYXZlIH0gPSB0aGlzLnByb3BzO1xuICAgIG9uSXRlbUhvdmVyKHtcbiAgICAgIGtleTogZXZlbnRLZXksXG4gICAgICBob3ZlcjogZmFsc2UsXG4gICAgfSk7XG4gICAgb25Nb3VzZUxlYXZlKHtcbiAgICAgIGtleTogZXZlbnRLZXksXG4gICAgICBkb21FdmVudDogZSxcbiAgICB9KTtcbiAgfSxcblxuICBvbk1vdXNlRW50ZXIoZSkge1xuICAgIGNvbnN0IHsgZXZlbnRLZXksIG9uSXRlbUhvdmVyLCBvbk1vdXNlRW50ZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgb25JdGVtSG92ZXIoe1xuICAgICAga2V5OiBldmVudEtleSxcbiAgICAgIGhvdmVyOiB0cnVlLFxuICAgIH0pO1xuICAgIG9uTW91c2VFbnRlcih7XG4gICAgICBrZXk6IGV2ZW50S2V5LFxuICAgICAgZG9tRXZlbnQ6IGUsXG4gICAgfSk7XG4gIH0sXG5cbiAgb25DbGljayhlKSB7XG4gICAgY29uc3QgeyBldmVudEtleSwgbXVsdGlwbGUsIG9uQ2xpY2ssIG9uU2VsZWN0LCBvbkRlc2VsZWN0LCBpc1NlbGVjdGVkIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGluZm8gPSB7XG4gICAgICBrZXk6IGV2ZW50S2V5LFxuICAgICAga2V5UGF0aDogW2V2ZW50S2V5XSxcbiAgICAgIGl0ZW06IHRoaXMsXG4gICAgICBkb21FdmVudDogZSxcbiAgICB9O1xuICAgIG9uQ2xpY2soaW5mbyk7XG4gICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICBpZiAoaXNTZWxlY3RlZCkge1xuICAgICAgICBvbkRlc2VsZWN0KGluZm8pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb25TZWxlY3QoaW5mbyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghaXNTZWxlY3RlZCkge1xuICAgICAgb25TZWxlY3QoaW5mbyk7XG4gICAgfVxuICB9LFxuXG4gIGdldFByZWZpeENscygpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5wcm9wcy5yb290UHJlZml4Q2xzfS1pdGVtYDtcbiAgfSxcblxuICBnZXRBY3RpdmVDbGFzc05hbWUoKSB7XG4gICAgcmV0dXJuIGAke3RoaXMuZ2V0UHJlZml4Q2xzKCl9LWFjdGl2ZWA7XG4gIH0sXG5cbiAgZ2V0U2VsZWN0ZWRDbGFzc05hbWUoKSB7XG4gICAgcmV0dXJuIGAke3RoaXMuZ2V0UHJlZml4Q2xzKCl9LXNlbGVjdGVkYDtcbiAgfSxcblxuICBnZXREaXNhYmxlZENsYXNzTmFtZSgpIHtcbiAgICByZXR1cm4gYCR7dGhpcy5nZXRQcmVmaXhDbHMoKX0tZGlzYWJsZWRgO1xuICB9LFxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NOYW1lcyh0aGlzLmdldFByZWZpeENscygpLCBwcm9wcy5jbGFzc05hbWUsIHtcbiAgICAgIFt0aGlzLmdldEFjdGl2ZUNsYXNzTmFtZSgpXTogIXByb3BzLmRpc2FibGVkICYmIHByb3BzLmFjdGl2ZSxcbiAgICAgIFt0aGlzLmdldFNlbGVjdGVkQ2xhc3NOYW1lKCldOiBwcm9wcy5pc1NlbGVjdGVkLFxuICAgICAgW3RoaXMuZ2V0RGlzYWJsZWRDbGFzc05hbWUoKV06IHByb3BzLmRpc2FibGVkLFxuICAgIH0pO1xuICAgIGNvbnN0IGF0dHJzID0ge1xuICAgICAgLi4ucHJvcHMuYXR0cmlidXRlLFxuICAgICAgdGl0bGU6IHByb3BzLnRpdGxlLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgcm9sZTogJ21lbnVpdGVtJyxcbiAgICAgICdhcmlhLXNlbGVjdGVkJzogcHJvcHMuaXNTZWxlY3RlZCxcbiAgICAgICdhcmlhLWRpc2FibGVkJzogcHJvcHMuZGlzYWJsZWQsXG4gICAgfTtcbiAgICBsZXQgbW91c2VFdmVudCA9IHt9O1xuICAgIGlmICghcHJvcHMuZGlzYWJsZWQpIHtcbiAgICAgIG1vdXNlRXZlbnQgPSB7XG4gICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGljayxcbiAgICAgICAgb25Nb3VzZUxlYXZlOiB0aGlzLm9uTW91c2VMZWF2ZSxcbiAgICAgICAgb25Nb3VzZUVudGVyOiB0aGlzLm9uTW91c2VFbnRlcixcbiAgICAgICAgb25Nb3VzZURvd246IHRoaXMucHJvcHMub25Nb3VzZURvd24sXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBzdHlsZSA9IHtcbiAgICAgIC4uLnByb3BzLnN0eWxlLFxuICAgIH07XG4gICAgaWYgKHByb3BzLm1vZGUgPT09ICdpbmxpbmUnKSB7XG4gICAgICBzdHlsZS5wYWRkaW5nTGVmdCA9IHByb3BzLmlubGluZUluZGVudCAqIHByb3BzLmxldmVsO1xuICAgIH1cblxuICAgIGNvbnN0IG5vdEZvdW5kID0gcHJvcHMuZXZlbnRLZXkgPT09ICdOT1RfRk9VTkQnO1xuICAgIGNvbnN0IGNoZWNrYm94ID0gcHJvcHMubXVsdGlwbGUgJiYgIW5vdEZvdW5kID8gPENoZWNrYm94IGRpc2FibGVkPXtwcm9wcy5kaXNhYmxlZH0gY2hlY2tlZD17cHJvcHMuaXNTZWxlY3RlZH0gdGFiSW5kZXg9ey0xfSAvPiA6IG51bGw7XG4gICAgcmV0dXJuIChcbiAgICAgIDxSaXBwbGUgZGlzYWJsZWQ9e3Byb3BzLmRpc2FibGVkfT5cbiAgICAgICAgPGxpXG4gICAgICAgICAgey4uLmF0dHJzfVxuICAgICAgICAgIHsuLi5tb3VzZUV2ZW50fVxuICAgICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgICAgPlxuICAgICAgICAgIHtjaGVja2JveH1cbiAgICAgICAgICB7cHJvcHMuY2hpbGRyZW59XG4gICAgICAgIDwvbGk+XG4gICAgICA8L1JpcHBsZT5cbiAgICApO1xuICB9LFxufSk7XG5cbk1lbnVJdGVtLmlzTWVudUl0ZW0gPSAxO1xuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KCh7IGFjdGl2ZUtleSwgc2VsZWN0ZWRLZXlzIH0sIHsgZXZlbnRLZXksIHN1Yk1lbnVLZXkgfSkgPT4gKHtcbiAgYWN0aXZlOiBhY3RpdmVLZXlbc3ViTWVudUtleV0gPT09IGV2ZW50S2V5LFxuICBpc1NlbGVjdGVkOiBzZWxlY3RlZEtleXMuaW5kZXhPZihldmVudEtleSkgIT09IC0xLFxufSkpKE1lbnVJdGVtKTtcbiJdfQ==