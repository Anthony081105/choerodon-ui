{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components/_util/resizeObserver.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;IAWM,mB;;;;;AAAN,iCAAA;AAAA;;AAAA;;AAKE,UAAA,cAAA,GAAwC,IAAxC;AAEA,UAAA,KAAA,GAAgB,CAAhB;AAEA,UAAA,MAAA,GAAiB,CAAjB;;AA2BA,UAAA,QAAA,GAAmC,UAAC,OAAD,EAAmC;AAAA,wBACnC,MAAK,KAD8B;AAAA,UAC5D,QAD4D,eAC5D,QAD4D;AAAA,UAClD,UADkD,eAClD,UADkD;AAAA,sBAMhE,OAAO,CAAC,CAAD,CANyD;AAAA,UAIlE,MAJkE,aAIlE,MAJkE;AAAA,4CAKlE,WALkE;AAAA,UAKnD,KALmD,yBAKnD,KALmD;AAAA,UAK5C,MAL4C,yBAK5C,MAL4C;AAQpE;;;AAGA;;AAEA,UAAM,UAAU,GAAG,IAAI,CAAC,KAAL,CAAW,KAAX,CAAnB;AACA,UAAM,WAAW,GAAG,IAAI,CAAC,KAAL,CAAW,MAAX,CAApB;;AAEA,UACG,MAAK,KAAL,KAAe,UAAf,IAA6B,CAAC,OAAD,EAAU,MAAV,EAAkB,QAAlB,CAA2B,UAA3B,CAA9B,IACC,MAAK,MAAL,KAAgB,WAAhB,IAA+B,CAAC,QAAD,EAAW,MAAX,EAAmB,QAAnB,CAA4B,UAA5B,CAFlC,EAGE;AACA,cAAK,KAAL,GAAa,UAAb;AACA,cAAK,MAAL,GAAc,WAAd;;AAEA,YAAI,QAAJ,EAAc;AACZ,UAAA,QAAQ,CAAC,UAAD,EAAa,WAAb,EAA0B,MAA1B,CAAR;AACD;AACF;AACF,KA3BD;;AApCF;AA4EC;;;;wCAjEkB;AACf,WAAK,kBAAL;AACD;;;yCAEiB;AAChB,WAAK,kBAAL;AACD;;;2CAEmB;AAClB,WAAK,eAAL;AACD;;;yCAEiB;AAAA,UACR,QADQ,GACK,KAAK,KADV,CACR,QADQ;AAEhB,UAAM,OAAO,GAAG,2BAAY,IAAZ,CAAhB;;AACA,UAAI,CAAC,KAAK,cAAN,IAAwB,CAAC,QAAzB,IAAqC,OAAzC,EAAkD;AAChD;AACA,aAAK,cAAL,GAAsB,IAAI,kCAAJ,CAAmB,KAAK,QAAxB,CAAtB;AACA,aAAK,cAAL,CAAoB,OAApB,CAA4B,OAA5B;AACD,OAJD,MAIO,IAAI,QAAJ,EAAc;AACnB;AACA,aAAK,eAAL;AACD;AACF;;;sCA+Bc;AACb,UAAI,KAAK,cAAT,EAAyB;AACvB,aAAK,cAAL,CAAoB,UAApB;AACA,aAAK,cAAL,GAAsB,IAAtB;AACD;AACF;;;6BAEK;AAAA,iCACwB,KAAK,KAD7B,CACI,QADJ;AAAA,UACI,QADJ,qCACe,IADf;AAEJ,aAAO,QAAP;AACD;;;EA3E+B,oB;;AACzB,mBAAA,CAAA,YAAA,GAAe;AACpB,EAAA,UAAU,EAAE;AADQ,CAAf;eA6EM,mB","sourcesContent":["import { PureComponent, ReactNode } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport ResizeObserver from 'resize-observer-polyfill';\n\ntype DomElement = Element | null;\n\ninterface ResizeObserverProps {\n  children?: ReactNode;\n  disabled?: boolean;\n  onResize?: (width: number, height: number, target: DomElement) => void;\n  resizeProp?: 'width' | 'height' | 'both';\n}\n\nclass ReactResizeObserver extends PureComponent<ResizeObserverProps> {\n  static defaultProps = {\n    resizeProp: 'both',\n  };\n\n  resizeObserver: ResizeObserver | null = null;\n\n  width: number = 0;\n\n  height: number = 0;\n\n  componentDidMount() {\n    this.onComponentUpdated();\n  }\n\n  componentDidUpdate() {\n    this.onComponentUpdated();\n  }\n\n  componentWillUnmount() {\n    this.destroyObserver();\n  }\n\n  onComponentUpdated() {\n    const { disabled } = this.props;\n    const element = findDOMNode(this) as DomElement;\n    if (!this.resizeObserver && !disabled && element) {\n      // Add resize observer\n      this.resizeObserver = new ResizeObserver(this.onResize);\n      this.resizeObserver.observe(element);\n    } else if (disabled) {\n      // Remove resize observer\n      this.destroyObserver();\n    }\n  }\n\n  onResize: ResizeObserverCallback = (entries: ResizeObserverEntry[]) => {\n    const { onResize, resizeProp } = this.props;\n\n    const {\n      target,\n      contentRect: { width, height },\n    } = entries[0];\n\n    /**\n     * getBoundingClientRect return wrong size in transform case.\n     */\n    // const { width, height } = target.getBoundingClientRect();\n\n    const fixedWidth = Math.floor(width);\n    const fixedHeight = Math.floor(height);\n\n    if (\n      (this.width !== fixedWidth && ['width', 'both'].includes(resizeProp!)) ||\n      (this.height !== fixedHeight && ['height', 'both'].includes(resizeProp!))\n    ) {\n      this.width = fixedWidth;\n      this.height = fixedHeight;\n\n      if (onResize) {\n        onResize(fixedWidth, fixedHeight, target);\n      }\n    }\n  };\n\n  destroyObserver() {\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n  }\n\n  render() {\n    const { children = null } = this.props;\n    return children;\n  }\n}\n\nexport default ReactResizeObserver;\n"]}