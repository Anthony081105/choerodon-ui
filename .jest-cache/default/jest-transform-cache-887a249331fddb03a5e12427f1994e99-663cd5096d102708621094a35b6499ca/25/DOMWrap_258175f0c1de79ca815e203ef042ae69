c2cbe4ea3c0799fab276b26d56fcf6c2
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _resizeObserverPolyfill = _interopRequireDefault(require("resize-observer-polyfill"));

var _SubMenu = _interopRequireDefault(require("./SubMenu"));

var _util = require("./util");

var canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);
var MENUITEM_OVERFLOWED_CLASSNAME = 'menuitem-overflowed'; // Fix ssr

if (canUseDOM) {
  require('mutationobserver-shim');
}

var DOMWrap =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(DOMWrap, _Component);

  function DOMWrap() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, DOMWrap);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(DOMWrap)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      lastVisibleIndex: undefined
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getMenuItemNodes", function () {
      var prefixCls = _this.props.prefixCls;

      var ul = _reactDom["default"].findDOMNode((0, _assertThisInitialized2["default"])(_this));

      if (!ul) {
        return [];
      } // filter out all overflowed indicator placeholder


      return [].slice.call(ul.children).filter(function (node) {
        return node.className.split(' ').indexOf("".concat(prefixCls, "-overflowed-submenu")) < 0;
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getOverflowedSubMenuItem", function (keyPrefix, overflowedItems, renderPlaceholder) {
      var _this$props = _this.props,
          overflowedIndicator = _this$props.overflowedIndicator,
          level = _this$props.level,
          mode = _this$props.mode,
          prefixCls = _this$props.prefixCls,
          theme = _this$props.theme,
          propStyle = _this$props.style;

      if (level !== 1 || mode !== 'horizontal') {
        return null;
      } // put all the overflowed item inside a submenu
      // with a title of overflow indicator ('...')


      var copy = _this.props.children[0];
      var _copy$props = copy.props,
          throwAway = _copy$props.children,
          title = _copy$props.title,
          eventKey = _copy$props.eventKey,
          rest = (0, _objectWithoutProperties2["default"])(_copy$props, ["children", "title", "eventKey"]);
      var style = (0, _objectSpread2["default"])({}, propStyle);
      var key = "".concat(keyPrefix, "-overflowed-indicator");

      if (overflowedItems.length === 0 && renderPlaceholder !== true) {
        style = (0, _objectSpread2["default"])({}, style, {
          display: 'none'
        });
      } else if (renderPlaceholder) {
        style = (0, _objectSpread2["default"])({}, style, {
          visibility: 'hidden',
          // prevent from taking normal dom space
          position: 'absolute'
        });
        key = "".concat(key, "-placeholder");
      }

      var popupClassName = theme ? "".concat(prefixCls, "-").concat(theme) : '';
      var props = {};

      _util.menuAllProps.forEach(function (k) {
        if (rest[k] !== undefined) {
          props[k] = rest[k];
        }
      });

      return _react["default"].createElement(_SubMenu["default"], (0, _extends2["default"])({
        title: overflowedIndicator,
        className: "".concat(prefixCls, "-overflowed-submenu"),
        popupClassName: popupClassName
      }, props, {
        key: key,
        eventKey: "".concat(keyPrefix, "-overflowed-indicator"),
        disabled: false,
        style: style
      }), overflowedItems);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setChildrenWidthAndResize", function () {
      if (_this.props.mode !== 'horizontal') {
        return;
      }

      var ul = _reactDom["default"].findDOMNode((0, _assertThisInitialized2["default"])(_this));

      if (!ul) {
        return;
      }

      var ulChildrenNodes = ul.children;

      if (!ulChildrenNodes || ulChildrenNodes.length === 0) {
        return;
      }

      var lastOverflowedIndicatorPlaceholder = ul.children[ulChildrenNodes.length - 1]; // need last overflowed indicator for calculating length;

      (0, _util.setStyle)(lastOverflowedIndicatorPlaceholder, 'display', 'inline-block');

      var menuItemNodes = _this.getMenuItemNodes(); // reset display attribute for all hidden elements caused by overflow to calculate updated width
      // and then reset to original state after width calculation


      var overflowedItems = menuItemNodes.filter(function (c) {
        return c.className.split(' ').indexOf(MENUITEM_OVERFLOWED_CLASSNAME) >= 0;
      });
      overflowedItems.forEach(function (c) {
        (0, _util.setStyle)(c, 'display', 'inline-block');
      });
      _this.menuItemSizes = menuItemNodes.map(function (c) {
        return (0, _util.getWidth)(c);
      });
      overflowedItems.forEach(function (c) {
        (0, _util.setStyle)(c, 'display', 'none');
      });
      _this.overflowedIndicatorWidth = (0, _util.getWidth)(ul.children[ul.children.length - 1]);
      _this.originalTotalWidth = _this.menuItemSizes.reduce(function (acc, cur) {
        return acc + cur;
      }, 0);

      _this.handleResize(); // prevent the overflowed indicator from taking space;


      (0, _util.setStyle)(lastOverflowedIndicatorPlaceholder, 'display', 'none');
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "resizeObserver", null);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "mutationObserver", null);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "originalTotalWidth", 0);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "overflowedItems", []);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "menuItemSizes", []);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleResize", function () {
      if (_this.props.mode !== 'horizontal') {
        return;
      }

      var ul = _reactDom["default"].findDOMNode((0, _assertThisInitialized2["default"])(_this));

      if (!ul) {
        return;
      }

      var width = (0, _util.getWidth)(ul);
      _this.overflowedItems = [];
      var currentSumWidth = 0; // index for last visible child in horizontal mode

      var lastVisibleIndex = undefined;

      if (_this.originalTotalWidth > width) {
        lastVisibleIndex = -1;

        _this.menuItemSizes.forEach(function (liWidth) {
          currentSumWidth += liWidth;

          if (currentSumWidth + _this.overflowedIndicatorWidth <= width) {
            lastVisibleIndex++;
          }
        });
      }

      _this.setState({
        lastVisibleIndex: lastVisibleIndex
      });
    });
    return _this;
  }

  (0, _createClass2["default"])(DOMWrap, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this2 = this;

      this.setChildrenWidthAndResize();

      if (this.props.level === 1 && this.props.mode === 'horizontal') {
        var menuUl = _reactDom["default"].findDOMNode(this);

        if (!menuUl) {
          return;
        }

        this.resizeObserver = new _resizeObserverPolyfill["default"](function (entries) {
          entries.forEach(_this2.setChildrenWidthAndResize);
        });
        [].slice.call(menuUl.children).concat(menuUl).forEach(function (el) {
          _this2.resizeObserver.observe(el);
        });

        if (typeof MutationObserver !== 'undefined') {
          this.mutationObserver = new MutationObserver(function () {
            _this2.resizeObserver.disconnect();

            [].slice.call(menuUl.children).concat(menuUl).forEach(function (el) {
              _this2.resizeObserver.observe(el);
            });

            _this2.setChildrenWidthAndResize();
          });
          this.mutationObserver.observe(menuUl, {
            attributes: false,
            childList: true,
            subTree: false
          });
        }
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (this.resizeObserver) {
        this.resizeObserver.disconnect();
      }

      if (this.mutationObserver) {
        this.resizeObserver.disconnect();
      }
    } // get all valid menuItem nodes

  }, {
    key: "renderChildren",
    value: function renderChildren(children) {
      var _this3 = this; // need to take care of overflowed items in horizontal mode


      var lastVisibleIndex = this.state.lastVisibleIndex;
      return (children || []).reduce(function (acc, childNode, index) {
        var item = childNode;

        if (_this3.props.mode === 'horizontal') {
          var overflowed = _this3.getOverflowedSubMenuItem(childNode.props.eventKey, []);

          if (lastVisibleIndex !== undefined && _this3.props.className.indexOf("".concat(_this3.props.prefixCls, "-root")) !== -1) {
            if (index > lastVisibleIndex) {
              item = (0, _react.cloneElement)(childNode, // 这里修改 eventKey 是为了防止隐藏状态下还会触发 openkeys 事件
              {
                style: {
                  display: 'none'
                },
                eventKey: "".concat(childNode.props.eventKey, "-hidden"),
                className: "".concat(childNode.className, " ").concat(MENUITEM_OVERFLOWED_CLASSNAME)
              });
            }

            if (index === lastVisibleIndex + 1) {
              _this3.overflowedItems = children.slice(lastVisibleIndex + 1).map(function (c) {
                return (0, _react.cloneElement)(c, // children[index].key will become '.$key' in clone by default,
                // we have to overwrite with the correct key explicitly
                {
                  key: c.props.eventKey,
                  mode: 'vertical-left'
                });
              });
              overflowed = _this3.getOverflowedSubMenuItem(childNode.props.eventKey, _this3.overflowedItems);
            }
          }

          var ret = [].concat((0, _toConsumableArray2["default"])(acc), [overflowed, item]);

          if (index === children.length - 1) {
            // need a placeholder for calculating overflowed indicator width
            ret.push(_this3.getOverflowedSubMenuItem(childNode.props.eventKey, [], true));
          }

          return ret;
        }

        return [].concat((0, _toConsumableArray2["default"])(acc), [item]);
      }, []);
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          hiddenClassName = _this$props2.hiddenClassName,
          hidden = _this$props2.hidden,
          prefixCls = _this$props2.prefixCls,
          overflowedIndicator = _this$props2.overflowedIndicator,
          mode = _this$props2.mode,
          level = _this$props2.level,
          Tag = _this$props2.tag,
          children = _this$props2.children,
          theme = _this$props2.theme,
          rest = (0, _objectWithoutProperties2["default"])(_this$props2, ["hiddenClassName", "hidden", "prefixCls", "overflowedIndicator", "mode", "level", "tag", "children", "theme"]);

      if (hidden) {
        rest.className += " ".concat(hiddenClassName);
      }

      return _react["default"].createElement(Tag, rest, this.renderChildren(this.props.children));
    }
  }]);
  return DOMWrap;
}(_react.Component);

exports["default"] = DOMWrap;
(0, _defineProperty2["default"])(DOMWrap, "propTypes", {
  className: _propTypes["default"].string,
  children: _propTypes["default"].node,
  mode: _propTypes["default"].oneOf(['horizontal', 'vertical', 'vertical-left', 'vertical-right', 'inline']),
  prefixCls: _propTypes["default"].string,
  level: _propTypes["default"].number,
  theme: _propTypes["default"].string,
  overflowedIndicator: _propTypes["default"].node,
  hidden: _propTypes["default"].bool,
  hiddenClassName: _propTypes["default"].string,
  tag: _propTypes["default"].string,
  style: _propTypes["default"].object
});
(0, _defineProperty2["default"])(DOMWrap, "defaultProps", {
  tag: 'div',
  className: ''
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lbnUvRE9NV3JhcC5qc3giXSwibmFtZXMiOlsiY2FuVXNlRE9NIiwid2luZG93IiwiTUVOVUlURU1fT1ZFUkZMT1dFRF9DTEFTU05BTUUiLCJyZXF1aXJlIiwiRE9NV3JhcCIsIkNvbXBvbmVudCIsImNsYXNzTmFtZSIsIlByb3BUeXBlcyIsImNoaWxkcmVuIiwibW9kZSIsInByZWZpeENscyIsImxldmVsIiwidGhlbWUiLCJvdmVyZmxvd2VkSW5kaWNhdG9yIiwiaGlkZGVuIiwiaGlkZGVuQ2xhc3NOYW1lIiwidGFnIiwic3R5bGUiLCJvYmplY3QiLCJsYXN0VmlzaWJsZUluZGV4IiwidW5kZWZpbmVkIiwibWVudVVsIiwiUmVhY3RET00iLCJSZXNpemVPYnNlcnZlciIsImVudHJpZXMiLCJhdHRyaWJ1dGVzIiwiY2hpbGRMaXN0Iiwic3ViVHJlZSIsInVsIiwibm9kZSIsInByb3BTdHlsZSIsImNvcHkiLCJ0aHJvd0F3YXkiLCJ0aXRsZSIsImV2ZW50S2V5IiwicmVzdCIsImtleSIsIm92ZXJmbG93ZWRJdGVtcyIsInJlbmRlclBsYWNlaG9sZGVyIiwiZGlzcGxheSIsInZpc2liaWxpdHkiLCJwb3NpdGlvbiIsInBvcHVwQ2xhc3NOYW1lIiwicHJvcHMiLCJtZW51QWxsUHJvcHMiLCJ1bENoaWxkcmVuTm9kZXMiLCJsYXN0T3ZlcmZsb3dlZEluZGljYXRvclBsYWNlaG9sZGVyIiwibWVudUl0ZW1Ob2RlcyIsImMiLCJhY2MiLCJ3aWR0aCIsImN1cnJlbnRTdW1XaWR0aCIsIml0ZW0iLCJvdmVyZmxvd2VkIiwiY2hpbGROb2RlIiwiaW5kZXgiLCJyZXQiLCJUYWciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztB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LENBRE0sTUFBQTtBQUVqQkMsRUFBQUEsUUFBUSxFQUFFRCxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUZPLElBQUE7QUFHakJFLEVBQUFBLElBQUksRUFBRUYsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBQUEsS0FBQUEsQ0FBZ0IsQ0FBQSxZQUFBLEVBQUEsVUFBQSxFQUFBLGVBQUEsRUFBQSxnQkFBQSxFQUhMLFFBR0ssQ0FBaEJBLENBSFc7QUFJakJHLEVBQUFBLFNBQVMsRUFBRUgsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FKTSxNQUFBO0FBS2pCSSxFQUFBQSxLQUFLLEVBQUVKLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBTFUsTUFBQTtBQU1qQkssRUFBQUEsS0FBSyxFQUFFTCxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQU5VLE1BQUE7QUFPakJNLEVBQUFBLG1CQUFtQixFQUFFTixVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQVBKLElBQUE7QUFRakJPLEVBQUFBLE1BQU0sRUFBRVAsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FSUyxJQUFBO0FBU2pCUSxFQUFBQSxlQUFlLEVBQUVSLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBVEEsTUFBQTtBQVVqQlMsRUFBQUEsR0FBRyxFQUFFVCxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQVZZLE1BQUE7QUFXakJVLEVBQUFBLEtBQUssRUFBRVYsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBVVc7QUFYQSxDO2lDQURBZCxPLGtCQWVHO0FBQ3BCWSxFQUFBQSxHQUFHLEVBRGlCLEtBQUE7QUFFcEJWLEVBQUFBLFNBQVMsRUFBRTtBQUZTLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgY2xvbmVFbGVtZW50LCBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVzaXplT2JzZXJ2ZXIgZnJvbSAncmVzaXplLW9ic2VydmVyLXBvbHlmaWxsJztcbmltcG9ydCBTdWJNZW51IGZyb20gJy4vU3ViTWVudSc7XG5pbXBvcnQgeyBnZXRXaWR0aCwgbWVudUFsbFByb3BzLCBzZXRTdHlsZSB9IGZyb20gJy4vdXRpbCc7XG5cbmNvbnN0IGNhblVzZURPTSA9ICEhKFxuICB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJlxuICB3aW5kb3cuZG9jdW1lbnQgJiZcbiAgd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnRcbik7XG5cbmNvbnN0IE1FTlVJVEVNX09WRVJGTE9XRURfQ0xBU1NOQU1FID0gJ21lbnVpdGVtLW92ZXJmbG93ZWQnO1xuXG4vLyBGaXggc3NyXG5pZiAoY2FuVXNlRE9NKSB7XG4gIHJlcXVpcmUoJ211dGF0aW9ub2JzZXJ2ZXItc2hpbScpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBET01XcmFwIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuICAgIG1vZGU6IFByb3BUeXBlcy5vbmVPZihbJ2hvcml6b250YWwnLCAndmVydGljYWwnLCAndmVydGljYWwtbGVmdCcsICd2ZXJ0aWNhbC1yaWdodCcsICdpbmxpbmUnXSksXG4gICAgcHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGxldmVsOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHRoZW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG92ZXJmbG93ZWRJbmRpY2F0b3I6IFByb3BUeXBlcy5ub2RlLFxuICAgIGhpZGRlbjogUHJvcFR5cGVzLmJvb2wsXG4gICAgaGlkZGVuQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHRhZzogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBzdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHRhZzogJ2RpdicsXG4gICAgY2xhc3NOYW1lOiAnJyxcbiAgfTtcblxuICBzdGF0ZSA9IHtcbiAgICBsYXN0VmlzaWJsZUluZGV4OiB1bmRlZmluZWQsXG4gIH07XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5zZXRDaGlsZHJlbldpZHRoQW5kUmVzaXplKCk7XG4gICAgaWYgKHRoaXMucHJvcHMubGV2ZWwgPT09IDEgJiYgdGhpcy5wcm9wcy5tb2RlID09PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgIGNvbnN0IG1lbnVVbCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMpO1xuICAgICAgaWYgKCFtZW51VWwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5yZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcihlbnRyaWVzID0+IHtcbiAgICAgICAgZW50cmllcy5mb3JFYWNoKHRoaXMuc2V0Q2hpbGRyZW5XaWR0aEFuZFJlc2l6ZSk7XG4gICAgICB9KTtcblxuICAgICAgW10uc2xpY2VcbiAgICAgICAgLmNhbGwobWVudVVsLmNoaWxkcmVuKVxuICAgICAgICAuY29uY2F0KG1lbnVVbClcbiAgICAgICAgLmZvckVhY2goZWwgPT4ge1xuICAgICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShlbCk7XG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAodHlwZW9mIE11dGF0aW9uT2JzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICBbXS5zbGljZVxuICAgICAgICAgICAgLmNhbGwobWVudVVsLmNoaWxkcmVuKVxuICAgICAgICAgICAgLmNvbmNhdChtZW51VWwpXG4gICAgICAgICAgICAuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShlbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB0aGlzLnNldENoaWxkcmVuV2lkdGhBbmRSZXNpemUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubXV0YXRpb25PYnNlcnZlci5vYnNlcnZlKG1lbnVVbCwge1xuICAgICAgICAgIGF0dHJpYnV0ZXM6IGZhbHNlLFxuICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgICBzdWJUcmVlOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgaWYgKHRoaXMucmVzaXplT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMucmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5tdXRhdGlvbk9ic2VydmVyKSB7XG4gICAgICB0aGlzLnJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG4gIH1cblxuICAvLyBnZXQgYWxsIHZhbGlkIG1lbnVJdGVtIG5vZGVzXG4gIGdldE1lbnVJdGVtTm9kZXMgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgdWwgPSBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKTtcbiAgICBpZiAoIXVsKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgLy8gZmlsdGVyIG91dCBhbGwgb3ZlcmZsb3dlZCBpbmRpY2F0b3IgcGxhY2Vob2xkZXJcbiAgICByZXR1cm4gW10uc2xpY2UuY2FsbCh1bC5jaGlsZHJlbikuZmlsdGVyKG5vZGUgPT4ge1xuICAgICAgcmV0dXJuIG5vZGUuY2xhc3NOYW1lLnNwbGl0KCcgJykuaW5kZXhPZihgJHtwcmVmaXhDbHN9LW92ZXJmbG93ZWQtc3VibWVudWApIDwgMDtcbiAgICB9KTtcbiAgfTtcblxuICBnZXRPdmVyZmxvd2VkU3ViTWVudUl0ZW0gPSAoa2V5UHJlZml4LCBvdmVyZmxvd2VkSXRlbXMsIHJlbmRlclBsYWNlaG9sZGVyKSA9PiB7XG4gICAgY29uc3QgeyBvdmVyZmxvd2VkSW5kaWNhdG9yLCBsZXZlbCwgbW9kZSwgcHJlZml4Q2xzLCB0aGVtZSwgc3R5bGU6IHByb3BTdHlsZSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobGV2ZWwgIT09IDEgfHwgbW9kZSAhPT0gJ2hvcml6b250YWwnKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLy8gcHV0IGFsbCB0aGUgb3ZlcmZsb3dlZCBpdGVtIGluc2lkZSBhIHN1Ym1lbnVcbiAgICAvLyB3aXRoIGEgdGl0bGUgb2Ygb3ZlcmZsb3cgaW5kaWNhdG9yICgnLi4uJylcbiAgICBjb25zdCBjb3B5ID0gdGhpcy5wcm9wcy5jaGlsZHJlblswXTtcbiAgICBjb25zdCB7IGNoaWxkcmVuOiB0aHJvd0F3YXksIHRpdGxlLCBldmVudEtleSwgLi4ucmVzdCB9ID0gY29weS5wcm9wcztcblxuICAgIGxldCBzdHlsZSA9IHsgLi4ucHJvcFN0eWxlIH07XG4gICAgbGV0IGtleSA9IGAke2tleVByZWZpeH0tb3ZlcmZsb3dlZC1pbmRpY2F0b3JgO1xuXG4gICAgaWYgKG92ZXJmbG93ZWRJdGVtcy5sZW5ndGggPT09IDAgJiYgcmVuZGVyUGxhY2Vob2xkZXIgIT09IHRydWUpIHtcbiAgICAgIHN0eWxlID0ge1xuICAgICAgICAuLi5zdHlsZSxcbiAgICAgICAgZGlzcGxheTogJ25vbmUnLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHJlbmRlclBsYWNlaG9sZGVyKSB7XG4gICAgICBzdHlsZSA9IHtcbiAgICAgICAgLi4uc3R5bGUsXG4gICAgICAgIHZpc2liaWxpdHk6ICdoaWRkZW4nLFxuICAgICAgICAvLyBwcmV2ZW50IGZyb20gdGFraW5nIG5vcm1hbCBkb20gc3BhY2VcbiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICB9O1xuICAgICAga2V5ID0gYCR7a2V5fS1wbGFjZWhvbGRlcmA7XG4gICAgfVxuXG4gICAgY29uc3QgcG9wdXBDbGFzc05hbWUgPSB0aGVtZSA/IGAke3ByZWZpeENsc30tJHt0aGVtZX1gIDogJyc7XG4gICAgY29uc3QgcHJvcHMgPSB7fTtcbiAgICBtZW51QWxsUHJvcHMuZm9yRWFjaChrID0+IHtcbiAgICAgIGlmIChyZXN0W2tdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcHNba10gPSByZXN0W2tdO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxTdWJNZW51XG4gICAgICAgIHRpdGxlPXtvdmVyZmxvd2VkSW5kaWNhdG9yfVxuICAgICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tb3ZlcmZsb3dlZC1zdWJtZW51YH1cbiAgICAgICAgcG9wdXBDbGFzc05hbWU9e3BvcHVwQ2xhc3NOYW1lfVxuICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgIGtleT17a2V5fVxuICAgICAgICBldmVudEtleT17YCR7a2V5UHJlZml4fS1vdmVyZmxvd2VkLWluZGljYXRvcmB9XG4gICAgICAgIGRpc2FibGVkPXtmYWxzZX1cbiAgICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgPlxuICAgICAgICB7b3ZlcmZsb3dlZEl0ZW1zfVxuICAgICAgPC9TdWJNZW51PlxuICAgICk7XG4gIH07XG5cbiAgLy8gbWVtb3JpemUgcmVuZGVyZWQgbWVudVNpemVcbiAgc2V0Q2hpbGRyZW5XaWR0aEFuZFJlc2l6ZSA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5wcm9wcy5tb2RlICE9PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdWwgPSBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKTtcblxuICAgIGlmICghdWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB1bENoaWxkcmVuTm9kZXMgPSB1bC5jaGlsZHJlbjtcblxuICAgIGlmICghdWxDaGlsZHJlbk5vZGVzIHx8IHVsQ2hpbGRyZW5Ob2Rlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsYXN0T3ZlcmZsb3dlZEluZGljYXRvclBsYWNlaG9sZGVyID0gdWwuY2hpbGRyZW5bdWxDaGlsZHJlbk5vZGVzLmxlbmd0aCAtIDFdO1xuXG4gICAgLy8gbmVlZCBsYXN0IG92ZXJmbG93ZWQgaW5kaWNhdG9yIGZvciBjYWxjdWxhdGluZyBsZW5ndGg7XG4gICAgc2V0U3R5bGUobGFzdE92ZXJmbG93ZWRJbmRpY2F0b3JQbGFjZWhvbGRlciwgJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7XG5cbiAgICBjb25zdCBtZW51SXRlbU5vZGVzID0gdGhpcy5nZXRNZW51SXRlbU5vZGVzKCk7XG5cbiAgICAvLyByZXNldCBkaXNwbGF5IGF0dHJpYnV0ZSBmb3IgYWxsIGhpZGRlbiBlbGVtZW50cyBjYXVzZWQgYnkgb3ZlcmZsb3cgdG8gY2FsY3VsYXRlIHVwZGF0ZWQgd2lkdGhcbiAgICAvLyBhbmQgdGhlbiByZXNldCB0byBvcmlnaW5hbCBzdGF0ZSBhZnRlciB3aWR0aCBjYWxjdWxhdGlvblxuXG4gICAgY29uc3Qgb3ZlcmZsb3dlZEl0ZW1zID0gbWVudUl0ZW1Ob2Rlcy5maWx0ZXIoXG4gICAgICBjID0+IGMuY2xhc3NOYW1lLnNwbGl0KCcgJykuaW5kZXhPZihNRU5VSVRFTV9PVkVSRkxPV0VEX0NMQVNTTkFNRSkgPj0gMCxcbiAgICApO1xuXG4gICAgb3ZlcmZsb3dlZEl0ZW1zLmZvckVhY2goYyA9PiB7XG4gICAgICBzZXRTdHlsZShjLCAnZGlzcGxheScsICdpbmxpbmUtYmxvY2snKTtcbiAgICB9KTtcblxuICAgIHRoaXMubWVudUl0ZW1TaXplcyA9IG1lbnVJdGVtTm9kZXMubWFwKGMgPT4gZ2V0V2lkdGgoYykpO1xuXG4gICAgb3ZlcmZsb3dlZEl0ZW1zLmZvckVhY2goYyA9PiB7XG4gICAgICBzZXRTdHlsZShjLCAnZGlzcGxheScsICdub25lJyk7XG4gICAgfSk7XG4gICAgdGhpcy5vdmVyZmxvd2VkSW5kaWNhdG9yV2lkdGggPSBnZXRXaWR0aCh1bC5jaGlsZHJlblt1bC5jaGlsZHJlbi5sZW5ndGggLSAxXSk7XG4gICAgdGhpcy5vcmlnaW5hbFRvdGFsV2lkdGggPSB0aGlzLm1lbnVJdGVtU2l6ZXMucmVkdWNlKChhY2MsIGN1cikgPT4gYWNjICsgY3VyLCAwKTtcbiAgICB0aGlzLmhhbmRsZVJlc2l6ZSgpO1xuICAgIC8vIHByZXZlbnQgdGhlIG92ZXJmbG93ZWQgaW5kaWNhdG9yIGZyb20gdGFraW5nIHNwYWNlO1xuICAgIHNldFN0eWxlKGxhc3RPdmVyZmxvd2VkSW5kaWNhdG9yUGxhY2Vob2xkZXIsICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgfTtcblxuICByZXNpemVPYnNlcnZlciA9IG51bGw7XG4gIG11dGF0aW9uT2JzZXJ2ZXIgPSBudWxsO1xuXG4gIC8vIG9yaWdpbmFsIHNjcm9sbCBzaXplIG9mIHRoZSBsaXN0XG4gIG9yaWdpbmFsVG90YWxXaWR0aCA9IDA7XG5cbiAgLy8gY29weSBvZiBvdmVyZmxvd2VkIGl0ZW1zXG4gIG92ZXJmbG93ZWRJdGVtcyA9IFtdO1xuXG4gIC8vIGNhY2hlIGl0ZW0gb2YgdGhlIG9yaWdpbmFsIGl0ZW1zIChzbyB3ZSBjYW4gdHJhY2sgdGhlIHNpemUgYW5kIG9yZGVyKVxuICBtZW51SXRlbVNpemVzID0gW107XG5cbiAgaGFuZGxlUmVzaXplID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLm1vZGUgIT09ICdob3Jpem9udGFsJykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHVsID0gUmVhY3RET00uZmluZERPTU5vZGUodGhpcyk7XG4gICAgaWYgKCF1bCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB3aWR0aCA9IGdldFdpZHRoKHVsKTtcblxuICAgIHRoaXMub3ZlcmZsb3dlZEl0ZW1zID0gW107XG4gICAgbGV0IGN1cnJlbnRTdW1XaWR0aCA9IDA7XG5cbiAgICAvLyBpbmRleCBmb3IgbGFzdCB2aXNpYmxlIGNoaWxkIGluIGhvcml6b250YWwgbW9kZVxuICAgIGxldCBsYXN0VmlzaWJsZUluZGV4ID0gdW5kZWZpbmVkO1xuXG4gICAgaWYgKHRoaXMub3JpZ2luYWxUb3RhbFdpZHRoID4gd2lkdGgpIHtcbiAgICAgIGxhc3RWaXNpYmxlSW5kZXggPSAtMTtcblxuICAgICAgdGhpcy5tZW51SXRlbVNpemVzLmZvckVhY2gobGlXaWR0aCA9PiB7XG4gICAgICAgIGN1cnJlbnRTdW1XaWR0aCArPSBsaVdpZHRoO1xuICAgICAgICBpZiAoY3VycmVudFN1bVdpZHRoICsgdGhpcy5vdmVyZmxvd2VkSW5kaWNhdG9yV2lkdGggPD0gd2lkdGgpIHtcbiAgICAgICAgICBsYXN0VmlzaWJsZUluZGV4Kys7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuc2V0U3RhdGUoeyBsYXN0VmlzaWJsZUluZGV4IH0pO1xuICB9O1xuXG4gIHJlbmRlckNoaWxkcmVuKGNoaWxkcmVuKSB7XG4gICAgLy8gbmVlZCB0byB0YWtlIGNhcmUgb2Ygb3ZlcmZsb3dlZCBpdGVtcyBpbiBob3Jpem9udGFsIG1vZGVcbiAgICBjb25zdCB7IGxhc3RWaXNpYmxlSW5kZXggfSA9IHRoaXMuc3RhdGU7XG4gICAgcmV0dXJuIChjaGlsZHJlbiB8fCBbXSkucmVkdWNlKChhY2MsIGNoaWxkTm9kZSwgaW5kZXgpID0+IHtcbiAgICAgIGxldCBpdGVtID0gY2hpbGROb2RlO1xuICAgICAgaWYgKHRoaXMucHJvcHMubW9kZSA9PT0gJ2hvcml6b250YWwnKSB7XG4gICAgICAgIGxldCBvdmVyZmxvd2VkID0gdGhpcy5nZXRPdmVyZmxvd2VkU3ViTWVudUl0ZW0oY2hpbGROb2RlLnByb3BzLmV2ZW50S2V5LCBbXSk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBsYXN0VmlzaWJsZUluZGV4ICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICB0aGlzLnByb3BzLmNsYXNzTmFtZS5pbmRleE9mKGAke3RoaXMucHJvcHMucHJlZml4Q2xzfS1yb290YCkgIT09IC0xXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChpbmRleCA+IGxhc3RWaXNpYmxlSW5kZXgpIHtcbiAgICAgICAgICAgIGl0ZW0gPSBjbG9uZUVsZW1lbnQoXG4gICAgICAgICAgICAgIGNoaWxkTm9kZSxcbiAgICAgICAgICAgICAgLy8g6L+Z6YeM5L+u5pS5IGV2ZW50S2V5IOaYr+S4uuS6humYsuatoumakOiXj+eKtuaAgeS4i+i/mOS8muinpuWPkSBvcGVua2V5cyDkuovku7ZcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0eWxlOiB7IGRpc3BsYXk6ICdub25lJyB9LFxuICAgICAgICAgICAgICAgIGV2ZW50S2V5OiBgJHtjaGlsZE5vZGUucHJvcHMuZXZlbnRLZXl9LWhpZGRlbmAsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBgJHtjaGlsZE5vZGUuY2xhc3NOYW1lfSAke01FTlVJVEVNX09WRVJGTE9XRURfQ0xBU1NOQU1FfWAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaW5kZXggPT09IGxhc3RWaXNpYmxlSW5kZXggKyAxKSB7XG4gICAgICAgICAgICB0aGlzLm92ZXJmbG93ZWRJdGVtcyA9IGNoaWxkcmVuLnNsaWNlKGxhc3RWaXNpYmxlSW5kZXggKyAxKS5tYXAoYyA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQoXG4gICAgICAgICAgICAgICAgYyxcbiAgICAgICAgICAgICAgICAvLyBjaGlsZHJlbltpbmRleF0ua2V5IHdpbGwgYmVjb21lICcuJGtleScgaW4gY2xvbmUgYnkgZGVmYXVsdCxcbiAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIHRvIG92ZXJ3cml0ZSB3aXRoIHRoZSBjb3JyZWN0IGtleSBleHBsaWNpdGx5XG4gICAgICAgICAgICAgICAgeyBrZXk6IGMucHJvcHMuZXZlbnRLZXksIG1vZGU6ICd2ZXJ0aWNhbC1sZWZ0JyB9LFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG92ZXJmbG93ZWQgPSB0aGlzLmdldE92ZXJmbG93ZWRTdWJNZW51SXRlbShcbiAgICAgICAgICAgICAgY2hpbGROb2RlLnByb3BzLmV2ZW50S2V5LFxuICAgICAgICAgICAgICB0aGlzLm92ZXJmbG93ZWRJdGVtcyxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmV0ID0gWy4uLmFjYywgb3ZlcmZsb3dlZCwgaXRlbV07XG5cbiAgICAgICAgaWYgKGluZGV4ID09PSBjaGlsZHJlbi5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgLy8gbmVlZCBhIHBsYWNlaG9sZGVyIGZvciBjYWxjdWxhdGluZyBvdmVyZmxvd2VkIGluZGljYXRvciB3aWR0aFxuICAgICAgICAgIHJldC5wdXNoKHRoaXMuZ2V0T3ZlcmZsb3dlZFN1Yk1lbnVJdGVtKGNoaWxkTm9kZS5wcm9wcy5ldmVudEtleSwgW10sIHRydWUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfVxuICAgICAgcmV0dXJuIFsuLi5hY2MsIGl0ZW1dO1xuICAgIH0sIFtdKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBoaWRkZW5DbGFzc05hbWUsXG4gICAgICBoaWRkZW4sXG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBvdmVyZmxvd2VkSW5kaWNhdG9yLFxuICAgICAgbW9kZSxcbiAgICAgIGxldmVsLFxuICAgICAgdGFnOiBUYWcsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIHRoZW1lLFxuICAgICAgLi4ucmVzdFxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGhpZGRlbikge1xuICAgICAgcmVzdC5jbGFzc05hbWUgKz0gYCAke2hpZGRlbkNsYXNzTmFtZX1gO1xuICAgIH1cblxuICAgIHJldHVybiA8VGFnIHsuLi5yZXN0fT57dGhpcy5yZW5kZXJDaGlsZHJlbih0aGlzLnByb3BzLmNoaWxkcmVuKX08L1RhZz47XG4gIH1cbn1cbiJdfQ==