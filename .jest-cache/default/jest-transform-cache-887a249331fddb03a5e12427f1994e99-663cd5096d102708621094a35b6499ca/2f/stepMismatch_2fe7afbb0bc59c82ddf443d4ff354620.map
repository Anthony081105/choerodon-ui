{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components-pro/validator/rules/stepMismatch.tsx"],"names":[],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;AAEA,SAAS,cAAT,CAAwB,KAAxB,EAA+B,IAA/B,EAAqC,GAArC,EAA0C,GAA1C,EAA+C,KAA/C,EAAoD;AAClD,MAAI,KAAJ,EAAW;AACT,QAAI,cAAJ;AACA,8BAAa,KAAb,EAAoB,KAApB,EAA2B,KAA3B,CAAiC,UAAA,IAAI,EAAG;AACtC,UAAI,CAAC,yBAAQ,IAAR,CAAL,EAAoB;AAClB,QAAA,cAAc,GAAG,8BAAkB,sBAAS,IAAT,IAAiB,IAAjB,GAAwB,MAAM,CAAC,IAAD,CAAhD,EAAwD,IAAxD,EAA8D,GAA9D,EAAmE,GAAnE,CAAjB;AACD;;AACD,aAAO,CAAC,cAAR;AACD,KALD;AAMA,WAAO,cAAP;AACD;;AACD,MAAI,CAAC,yBAAQ,KAAR,CAAL,EAAqB;AACnB,WAAO,8BAAkB,sBAAS,KAAT,IAAkB,KAAlB,GAA0B,MAAM,CAAC,KAAD,CAAlD,EAA2D,IAA3D,EAAiE,GAAjE,EAAsE,GAAtE,CAAP;AACD;AACF;;AAEa,SAAU,YAAV,CAAuB,KAAvB,EAAmC,KAAnC,EAAwD;AAAA,MAC5D,IAD4D,GACgB,KADhB,CAC5D,IAD4D;AAAA,MACtD,GADsD,GACgB,KADhB,CACtD,GADsD;AAAA,MACjD,GADiD,GACgB,KADhB,CACjD,GADiD;AAAA,MAC5C,yBAD4C,GACgB,KADhB,CAC5C,yBAD4C;AAAA,MACjB,KADiB,GACgB,KADhB,CACjB,KADiB;AAAA,MACV,MADU,GACgB,KADhB,CACV,MADU;AAAA,MACF,aADE,GACgB,KADhB,CACF,aADE;;AAEpE,MAAI,IAAI,KAAK,SAAT,IAAsB,aAAa,KAAK,KAA5C,EAAmD;AACjD,QAAM,cAAc,GAAG,cAAc,CAAC,KAAD,EAAQ,IAAR,EAAc,GAAd,EAAmB,GAAnB,EAAwB,KAAxB,CAArC;;AACA,QAAI,cAAc,KAAK,SAAvB,EAAkC;AAAA,4DACR,cADQ;AAAA,UACzB,MADyB;AAAA,UACjB,KADiB;;AAEhC,UAAM,gBAAgB,GAAG;AACvB,WAAG,sBAAS,MAAT,IAAmB,MAAM,CAAC,MAAP,CAAc,MAAd,CAAnB,GAA2C,MADvB;AAEvB,WAAG,sBAAS,KAAT,IAAkB,KAAK,CAAC,MAAN,CAAa,MAAb,CAAlB,GAAyC;AAFrB,OAAzB;AAIA,UAAM,QAAQ,GAAG,cAAc,CAAC,MAAf,KAA0B,CAA1B,GAA8B,qBAA9B,GAAsD,cAAvE;AACA,UAAM,GAAG,GAAG,cAAc,CAAC,MAAf,KAA0B,CAA1B,GAA8B,uBAA9B,GAAwD,eAApE;AAPgC,kCAQiC,yBARjC,CAQvB,QARuB;AAAA,UAQZ,iBARY,sCAQQ,uBAAG,WAAH,EAAgB,GAAhB,CARR;AAShC,aAAO,IAAI,4BAAJ,CAAqB;AAC1B,QAAA,iBAAiB,EAAE,qCAAoB,iBAApB,EAAuC,gBAAvC,CADO;AAE1B,QAAA,gBAAgB,EAAhB,gBAF0B;AAG1B,QAAA,KAAK,EAAE,sBAAS,KAAT,IAAkB,KAAK,CAAC,MAAN,CAAa,MAAb,CAAlB,GAAyC,KAHtB;AAI1B,QAAA,QAAQ,EAAR;AAJ0B,OAArB,CAAP;AAMD;AACF;;AACD,SAAO,IAAP;AACD","sourcesContent":["import { isMoment } from 'moment';\nimport isEmpty from '../../_util/isEmpty';\nimport ValidationResult from '../ValidationResult';\nimport { $l } from '../../locale-context';\nimport { getNearStepValues } from '../../number-field/utils';\nimport { methodReturn, ValidatorProps } from '.';\nimport formatReactTemplate from '../../formatter/formatReactTemplate';\nimport { toRangeValue } from '../../field/utils';\n\nfunction isStepMismatch(value, step, min, max, range) {\n  if (range) {\n    let nearStepValues;\n    toRangeValue(value, range).every(item => {\n      if (!isEmpty(item)) {\n        nearStepValues = getNearStepValues(isMoment(item) ? item : Number(item), step, min, max);\n      }\n      return !nearStepValues;\n    });\n    return nearStepValues;\n  }\n  if (!isEmpty(value)) {\n    return getNearStepValues(isMoment(value) ? value : Number(value), step, min, max);\n  }\n}\n\nexport default function stepMismatch(value: any, props: ValidatorProps): methodReturn {\n  const { step, min, max, defaultValidationMessages, range, format, nonStrictStep } = props;\n  if (step !== undefined && nonStrictStep === false) {\n    const nearStepValues = isStepMismatch(value, step, min, max, range);\n    if (nearStepValues !== undefined) {\n      const [before, after] = nearStepValues;\n      const injectionOptions = {\n        0: isMoment(before) ? before.format(format) : before,\n        1: isMoment(after) ? after.format(format) : after,\n      };\n      const ruleName = nearStepValues.length === 2 ? 'stepMismatchBetween' : 'stepMismatch';\n      const key = nearStepValues.length === 2 ? 'step_mismatch_between' : 'step_mismatch';\n      const { [ruleName]: validationMessage = $l('Validator', key) } = defaultValidationMessages;\n      return new ValidationResult({\n        validationMessage: formatReactTemplate(validationMessage, injectionOptions),\n        injectionOptions,\n        value: isMoment(value) ? value.format(format) : value,\n        ruleName,\n      });\n    }\n  }\n  return true;\n}\n"]}