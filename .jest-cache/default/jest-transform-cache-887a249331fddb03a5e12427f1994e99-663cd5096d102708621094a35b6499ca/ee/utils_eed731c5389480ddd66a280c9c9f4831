70589928f1e75a9557cb9994f3a7a263
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.T = T;
exports.fileToObject = fileToObject;
exports.genPercentAdd = genPercentAdd;
exports.getFileItem = getFileItem;
exports.removeFileItem = removeFileItem;
exports.previewImage = previewImage;

function T() {
  return true;
} // Fix IE file.status problem
// via coping a new Object


function fileToObject(file) {
  return {
    lastModified: file.lastModified,
    lastModifiedDate: file.lastModifiedDate,
    name: file.filename || file.name,
    size: file.size,
    type: file.type,
    uid: file.uid,
    response: file.response,
    error: file.error,
    percent: 0,
    originFileObj: file
  };
}
/**
 * 生成Progress percent: 0.1 -> 0.98
 *   - for ie
 */


function genPercentAdd() {
  var k = 0.1;
  var i = 0.01;
  var end = 0.98;
  return function (s) {
    var start = s;

    if (start >= end) {
      return start;
    }

    start += k;
    k -= i;

    if (k < 0.001) {
      k = 0.001;
    }

    return start * 100;
  };
}

function getFileItem(file, fileList) {
  var matchKey = file.uid !== undefined ? 'uid' : 'name';
  return fileList.filter(function (item) {
    return item[matchKey] === file[matchKey];
  })[0];
}

function removeFileItem(file, fileList) {
  var matchKey = file.uid !== undefined ? 'uid' : 'name';
  var removed = fileList.filter(function (item) {
    return item[matchKey] !== file[matchKey];
  });

  if (removed.length === fileList.length) {
    return null;
  }

  return removed;
}

var isImageFileType = function isImageFileType(type) {
  return type.indexOf('image/') === 0;
};

var MEASURE_SIZE = 200;

function previewImage(file) {
  return new Promise(function (resolve) {
    if (!file.type || !isImageFileType(file.type)) {
      resolve('');
      return;
    }

    var canvas = document.createElement('canvas');
    canvas.width = MEASURE_SIZE;
    canvas.height = MEASURE_SIZE;
    canvas.style.cssText = "position: fixed; left: 0; top: 0; width: ".concat(MEASURE_SIZE, "px; height: ").concat(MEASURE_SIZE, "px; z-index: 9999; display: none;");
    document.body.appendChild(canvas);
    var ctx = canvas.getContext('2d');
    var img = new Image();

    img.onload = function () {
      var width = img.width,
          height = img.height;
      var drawWidth = MEASURE_SIZE;
      var drawHeight = MEASURE_SIZE;
      var offsetX = 0;
      var offsetY = 0;

      if (width < height) {
        drawHeight = height * (MEASURE_SIZE / width);
        offsetY = -(drawHeight - drawWidth) / 2;
      } else {
        drawWidth = width * (MEASURE_SIZE / height);
        offsetX = -(drawWidth - drawHeight) / 2;
      }

      ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight);
      var dataURL = canvas.toDataURL();
      document.body.removeChild(canvas);
      resolve(dataURL);
    };

    img.src = window.URL.createObjectURL(file);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVwbG9hZC91dGlscy5qcyJdLCJuYW1lcyI6WyJsYXN0TW9kaWZpZWQiLCJmaWxlIiwibGFzdE1vZGlmaWVkRGF0ZSIsIm5hbWUiLCJzaXplIiwidHlwZSIsInVpZCIsInJlc3BvbnNlIiwiZXJyb3IiLCJwZXJjZW50Iiwib3JpZ2luRmlsZU9iaiIsImsiLCJpIiwiZW5kIiwic3RhcnQiLCJtYXRjaEtleSIsIml0ZW0iLCJyZW1vdmVkIiwiZmlsZUxpc3QiLCJpc0ltYWdlRmlsZVR5cGUiLCJNRUFTVVJFX1NJWkUiLCJyZXNvbHZlIiwiY2FudmFzIiwiZG9jdW1lbnQiLCJjdHgiLCJpbWciLCJ3aWR0aCIsImhlaWdodCIsImRyYXdXaWR0aCIsImRyYXdIZWlnaHQiLCJvZmZzZXRYIiwib2Zmc2V0WSIsImRhdGFVUkwiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFPLFNBQUEsQ0FBQSxHQUFhO0FBQ2hCLFNBQUEsSUFBQTtFQUVKO0FBQ0E7OztBQUNPLFNBQUEsWUFBQSxDQUFBLElBQUEsRUFBNEI7QUFDL0IsU0FBTztBQUNIQSxJQUFBQSxZQUFZLEVBQUVDLElBQUksQ0FEZixZQUFBO0FBRUhDLElBQUFBLGdCQUFnQixFQUFFRCxJQUFJLENBRm5CLGdCQUFBO0FBR0hFLElBQUFBLElBQUksRUFBRUYsSUFBSSxDQUFKQSxRQUFBQSxJQUFpQkEsSUFBSSxDQUh4QixJQUFBO0FBSUhHLElBQUFBLElBQUksRUFBRUgsSUFBSSxDQUpQLElBQUE7QUFLSEksSUFBQUEsSUFBSSxFQUFFSixJQUFJLENBTFAsSUFBQTtBQU1ISyxJQUFBQSxHQUFHLEVBQUVMLElBQUksQ0FOTixHQUFBO0FBT0hNLElBQUFBLFFBQVEsRUFBRU4sSUFBSSxDQVBYLFFBQUE7QUFRSE8sSUFBQUEsS0FBSyxFQUFFUCxJQUFJLENBUlIsS0FBQTtBQVNIUSxJQUFBQSxPQUFPLEVBVEosQ0FBQTtBQVVIQyxJQUFBQSxhQUFhLEVBQUVUO0FBVlosR0FBUDtBQVlIO0FBQ0Q7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R0FDV0QsR0FEWCxDQUFBLEtBQUE7QUFBQSxVQUNBRSxNQURBLEdBQ1dGLEdBRFgsQ0FBQSxNQUFBO0FBRWYsVUFBSUcsU0FBUyxHQUFiLFlBQUE7QUFDQSxVQUFJQyxVQUFVLEdBQWQsWUFBQTtBQUNBLFVBQUlDLE9BQU8sR0FBWCxDQUFBO0FBQ0EsVUFBSUMsT0FBTyxHQUFYLENBQUE7O0FBQ0EsVUFBSUwsS0FBSyxHQUFULE1BQUEsRUFBb0I7QUFDaEJHLFFBQUFBLFVBQVUsR0FBR0YsTUFBTSxJQUFJUCxZQUFZLEdBQW5DUyxLQUFtQixDQUFuQkE7QUFDQUUsUUFBQUEsT0FBTyxHQUFHLEVBQUVGLFVBQVUsR0FBWixTQUFBLElBQVZFLENBQUFBO0FBRkosT0FBQSxNQUlLO0FBQ0RILFFBQUFBLFNBQVMsR0FBR0YsS0FBSyxJQUFJTixZQUFZLEdBQWpDUSxNQUFpQixDQUFqQkE7QUFDQUUsUUFBQUEsT0FBTyxHQUFHLEVBQUVGLFNBQVMsR0FBWCxVQUFBLElBQVZFLENBQUFBO0FBQ0g7O0FBQ0ROLE1BQUFBLEdBQUcsQ0FBSEEsU0FBQUEsQ0FBQUEsR0FBQUEsRUFBQUEsT0FBQUEsRUFBQUEsT0FBQUEsRUFBQUEsU0FBQUEsRUFBQUEsVUFBQUE7QUFDQSxVQUFNUSxPQUFPLEdBQUdWLE1BQU0sQ0FBdEIsU0FBZ0JBLEVBQWhCO0FBQ0FDLE1BQUFBLFFBQVEsQ0FBUkEsSUFBQUEsQ0FBQUEsV0FBQUEsQ0FBQUEsTUFBQUE7QUFDQUYsTUFBQUEsT0FBTyxDQUFQQSxPQUFPLENBQVBBO0FBakJKSSxLQUFBQTs7QUFtQkFBLElBQUFBLEdBQUcsQ0FBSEEsR0FBQUEsR0FBVVEsTUFBTSxDQUFOQSxHQUFBQSxDQUFBQSxlQUFBQSxDQUFWUixJQUFVUSxDQUFWUjtBQS9CSixHQUFPLENBQVA7QUFpQ0giLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gVCgpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8vIEZpeCBJRSBmaWxlLnN0YXR1cyBwcm9ibGVtXG4vLyB2aWEgY29waW5nIGEgbmV3IE9iamVjdFxuZXhwb3J0IGZ1bmN0aW9uIGZpbGVUb09iamVjdChmaWxlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlLmxhc3RNb2RpZmllZCxcbiAgICAgICAgbGFzdE1vZGlmaWVkRGF0ZTogZmlsZS5sYXN0TW9kaWZpZWREYXRlLFxuICAgICAgICBuYW1lOiBmaWxlLmZpbGVuYW1lIHx8IGZpbGUubmFtZSxcbiAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgIHVpZDogZmlsZS51aWQsXG4gICAgICAgIHJlc3BvbnNlOiBmaWxlLnJlc3BvbnNlLFxuICAgICAgICBlcnJvcjogZmlsZS5lcnJvcixcbiAgICAgICAgcGVyY2VudDogMCxcbiAgICAgICAgb3JpZ2luRmlsZU9iajogZmlsZSxcbiAgICB9O1xufVxuLyoqXG4gKiDnlJ/miJBQcm9ncmVzcyBwZXJjZW50OiAwLjEgLT4gMC45OFxuICogICAtIGZvciBpZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuUGVyY2VudEFkZCgpIHtcbiAgICBsZXQgayA9IDAuMTtcbiAgICBjb25zdCBpID0gMC4wMTtcbiAgICBjb25zdCBlbmQgPSAwLjk4O1xuICAgIHJldHVybiBmdW5jdGlvbiAocykge1xuICAgICAgICBsZXQgc3RhcnQgPSBzO1xuICAgICAgICBpZiAoc3RhcnQgPj0gZW5kKSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhcnQ7XG4gICAgICAgIH1cbiAgICAgICAgc3RhcnQgKz0gaztcbiAgICAgICAgayAtPSBpO1xuICAgICAgICBpZiAoayA8IDAuMDAxKSB7XG4gICAgICAgICAgICBrID0gMC4wMDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXJ0ICogMTAwO1xuICAgIH07XG59XG5leHBvcnQgZnVuY3Rpb24gZ2V0RmlsZUl0ZW0oZmlsZSwgZmlsZUxpc3QpIHtcbiAgICBjb25zdCBtYXRjaEtleSA9IGZpbGUudWlkICE9PSB1bmRlZmluZWQgPyAndWlkJyA6ICduYW1lJztcbiAgICByZXR1cm4gZmlsZUxpc3QuZmlsdGVyKGl0ZW0gPT4gaXRlbVttYXRjaEtleV0gPT09IGZpbGVbbWF0Y2hLZXldKVswXTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVGaWxlSXRlbShmaWxlLCBmaWxlTGlzdCkge1xuICAgIGNvbnN0IG1hdGNoS2V5ID0gZmlsZS51aWQgIT09IHVuZGVmaW5lZCA/ICd1aWQnIDogJ25hbWUnO1xuICAgIGNvbnN0IHJlbW92ZWQgPSBmaWxlTGlzdC5maWx0ZXIoaXRlbSA9PiBpdGVtW21hdGNoS2V5XSAhPT0gZmlsZVttYXRjaEtleV0pO1xuICAgIGlmIChyZW1vdmVkLmxlbmd0aCA9PT0gZmlsZUxpc3QubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcmVtb3ZlZDtcbn1cbmNvbnN0IGlzSW1hZ2VGaWxlVHlwZSA9ICh0eXBlKSA9PiB0eXBlLmluZGV4T2YoJ2ltYWdlLycpID09PSAwO1xuY29uc3QgTUVBU1VSRV9TSVpFID0gMjAwO1xuZXhwb3J0IGZ1bmN0aW9uIHByZXZpZXdJbWFnZShmaWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBpZiAoIWZpbGUudHlwZSB8fCAhaXNJbWFnZUZpbGVUeXBlKGZpbGUudHlwZSkpIHtcbiAgICAgICAgICAgIHJlc29sdmUoJycpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICBjYW52YXMud2lkdGggPSBNRUFTVVJFX1NJWkU7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBNRUFTVVJFX1NJWkU7XG4gICAgICAgIGNhbnZhcy5zdHlsZS5jc3NUZXh0ID0gYHBvc2l0aW9uOiBmaXhlZDsgbGVmdDogMDsgdG9wOiAwOyB3aWR0aDogJHtNRUFTVVJFX1NJWkV9cHg7IGhlaWdodDogJHtNRUFTVVJFX1NJWkV9cHg7IHotaW5kZXg6IDk5OTk7IGRpc3BsYXk6IG5vbmU7YDtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjYW52YXMpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGltZztcbiAgICAgICAgICAgIGxldCBkcmF3V2lkdGggPSBNRUFTVVJFX1NJWkU7XG4gICAgICAgICAgICBsZXQgZHJhd0hlaWdodCA9IE1FQVNVUkVfU0laRTtcbiAgICAgICAgICAgIGxldCBvZmZzZXRYID0gMDtcbiAgICAgICAgICAgIGxldCBvZmZzZXRZID0gMDtcbiAgICAgICAgICAgIGlmICh3aWR0aCA8IGhlaWdodCkge1xuICAgICAgICAgICAgICAgIGRyYXdIZWlnaHQgPSBoZWlnaHQgKiAoTUVBU1VSRV9TSVpFIC8gd2lkdGgpO1xuICAgICAgICAgICAgICAgIG9mZnNldFkgPSAtKGRyYXdIZWlnaHQgLSBkcmF3V2lkdGgpIC8gMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRyYXdXaWR0aCA9IHdpZHRoICogKE1FQVNVUkVfU0laRSAvIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgb2Zmc2V0WCA9IC0oZHJhd1dpZHRoIC0gZHJhd0hlaWdodCkgLyAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIG9mZnNldFgsIG9mZnNldFksIGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7XG4gICAgICAgICAgICBjb25zdCBkYXRhVVJMID0gY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChjYW52YXMpO1xuICAgICAgICAgICAgcmVzb2x2ZShkYXRhVVJMKTtcbiAgICAgICAgfTtcbiAgICAgICAgaW1nLnNyYyA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpO1xuICAgIH0pO1xufVxuIl19