0d0cd306e7544f7af135d516a3cad171
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _KeyCode = _interopRequireDefault(require("../../_util/KeyCode"));

var _util = require("./util");

var _Star = _interopRequireDefault(require("./Star"));

var Rate =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Rate, _Component);

  function Rate(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Rate);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Rate).call(this, props));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onHover", function (event, index) {
      var hoverValue = _this.getStarValue(index, event.pageX);

      var cleanedValue = _this.state.cleanedValue;

      if (hoverValue !== cleanedValue) {
        _this.setState({
          hoverValue: hoverValue,
          cleanedValue: null
        });
      }

      _this.props.onHoverChange(hoverValue);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onMouseLeave", function () {
      _this.setState({
        hoverValue: undefined,
        cleanedValue: null
      });

      _this.props.onHoverChange(undefined);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onClick", function (event, index) {
      var value = _this.getStarValue(index, event.pageX);

      var isReset = false;

      if (_this.props.allowClear) {
        isReset = value === _this.state.value;
      }

      _this.onMouseLeave(true);

      _this.changeValue(isReset ? 0 : value);

      _this.setState({
        cleanedValue: isReset ? value : null
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onFocus", function () {
      var onFocus = _this.props.onFocus;

      _this.setState({
        focused: true
      });

      if (onFocus) {
        onFocus();
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onBlur", function () {
      var onBlur = _this.props.onBlur;

      _this.setState({
        focused: false
      });

      if (onBlur) {
        onBlur();
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onKeyDown", function (event) {
      var keyCode = event.keyCode;
      var _this$props = _this.props,
          count = _this$props.count,
          allowHalf = _this$props.allowHalf,
          onKeyDown = _this$props.onKeyDown;
      var value = _this.state.value;

      if (keyCode === _KeyCode["default"].RIGHT && value < count) {
        if (allowHalf) {
          value += 0.5;
        } else {
          value += 1;
        }

        _this.changeValue(value);

        event.preventDefault();
      } else if (keyCode === _KeyCode["default"].LEFT && value > 0) {
        if (allowHalf) {
          value -= 0.5;
        } else {
          value -= 1;
        }

        _this.changeValue(value);

        event.preventDefault();
      }

      if (onKeyDown) {
        onKeyDown(event);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveRef", function (index) {
      return function (node) {
        _this.stars[index] = node;
      };
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveRate", function (node) {
      _this.rate = node;
    });
    var _value = props.value;

    if (_value === undefined) {
      _value = props.defaultValue;
    }

    _this.stars = {};
    _this.state = {
      value: _value,
      focused: false,
      cleanedValue: null
    };
    return _this;
  }

  (0, _createClass2["default"])(Rate, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.props.autoFocus && !this.props.disabled) {
        this.focus();
      }
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('value' in nextProps) {
        var value = nextProps.value;

        if (value === undefined) {
          value = nextProps.defaultValue;
        }

        this.setState({
          value: value
        });
      }
    }
  }, {
    key: "getStarDOM",
    value: function getStarDOM(index) {
      return _reactDom["default"].findDOMNode(this.stars[index]);
    }
  }, {
    key: "getStarValue",
    value: function getStarValue(index, x) {
      var value = index + 1;

      if (this.props.allowHalf) {
        var starEle = this.getStarDOM(index);
        var leftDis = (0, _util.getOffsetLeft)(starEle);
        var width = starEle.clientWidth;

        if (x - leftDis < width / 2) {
          value -= 0.5;
        }
      }

      return value;
    }
  }, {
    key: "focus",
    value: function focus() {
      if (!this.props.disabled) {
        this.rate.focus();
      }
    }
  }, {
    key: "blur",
    value: function blur() {
      if (!this.props.disabled) {
        this.rate.focus();
      }
    }
  }, {
    key: "changeValue",
    value: function changeValue(value) {
      if (!('value' in this.props)) {
        this.setState({
          value: value
        });
      }

      this.props.onChange(value);
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          count = _this$props2.count,
          allowHalf = _this$props2.allowHalf,
          style = _this$props2.style,
          prefixCls = _this$props2.prefixCls,
          disabled = _this$props2.disabled,
          className = _this$props2.className,
          character = _this$props2.character,
          tabIndex = _this$props2.tabIndex;
      var _this$state = this.state,
          value = _this$state.value,
          hoverValue = _this$state.hoverValue,
          focused = _this$state.focused;
      var stars = [];
      var disabledClass = disabled ? "".concat(prefixCls, "-disabled") : '';

      for (var index = 0; index < count; index++) {
        stars.push(_react["default"].createElement(_Star["default"], {
          ref: this.saveRef(index),
          index: index,
          disabled: disabled,
          prefixCls: "".concat(prefixCls, "-star"),
          allowHalf: allowHalf,
          value: hoverValue === undefined ? value : hoverValue,
          onClick: this.onClick,
          onHover: this.onHover,
          key: index,
          character: character,
          focused: focused
        }));
      }

      return _react["default"].createElement("ul", {
        className: (0, _classnames["default"])(prefixCls, disabledClass, className),
        style: style,
        onMouseLeave: disabled ? null : this.onMouseLeave,
        tabIndex: disabled ? -1 : tabIndex,
        onFocus: disabled ? null : this.onFocus,
        onBlur: disabled ? null : this.onBlur,
        onKeyDown: disabled ? null : this.onKeyDown,
        ref: this.saveRate
      }, stars);
    }
  }]);
  return Rate;
}(_react.Component);

exports["default"] = Rate;
(0, _defineProperty2["default"])(Rate, "propTypes", {
  disabled: _propTypes["default"].bool,
  value: _propTypes["default"].number,
  defaultValue: _propTypes["default"].number,
  count: _propTypes["default"].number,
  allowHalf: _propTypes["default"].bool,
  allowClear: _propTypes["default"].bool,
  style: _propTypes["default"].object,
  prefixCls: _propTypes["default"].string,
  onChange: _propTypes["default"].func,
  onHoverChange: _propTypes["default"].func,
  className: _propTypes["default"].string,
  character: _propTypes["default"].node,
  tabIndex: _propTypes["default"].number,
  onFocus: _propTypes["default"].func,
  onBlur: _propTypes["default"].func,
  onKeyDown: _propTypes["default"].func,
  autoFocus: _propTypes["default"].bool
});
(0, _defineProperty2["default"])(Rate, "defaultProps", {
  defaultValue: 0,
  count: 5,
  allowHalf: false,
  allowClear: true,
  style: {},
  prefixCls: 'rc-rate',
  onChange: _noop["default"],
  character: 'â˜…',
  onHoverChange: _noop["default"],
  tabIndex: 0
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJhdGUuanN4Il0sIm5hbWVzIjpbIlJhdGUiLCJwcm9wcyIsImV2ZW50IiwiaW5kZXgiLCJob3ZlclZhbHVlIiwiZ2V0U3RhclZhbHVlIiwicGFnZVgiLCJjbGVhbmVkVmFsdWUiLCJzdGF0ZSIsInNldFN0YXRlIiwib25Ib3ZlckNoYW5nZSIsInVuZGVmaW5lZCIsInZhbHVlIiwiaXNSZXNldCIsImFsbG93Q2xlYXIiLCJvbk1vdXNlTGVhdmUiLCJjaGFuZ2VWYWx1ZSIsIm9uRm9jdXMiLCJmb2N1c2VkIiwib25CbHVyIiwia2V5Q29kZSIsImNvdW50IiwiYWxsb3dIYWxmIiwib25LZXlEb3duIiwiS2V5Q29kZSIsIlJJR0hUIiwicHJldmVudERlZmF1bHQiLCJMRUZUIiwibm9kZSIsInN0YXJzIiwicmF0ZSIsImRlZmF1bHRWYWx1ZSIsImF1dG9Gb2N1cyIsImRpc2FibGVkIiwiZm9jdXMiLCJuZXh0UHJvcHMiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwieCIsInN0YXJFbGUiLCJnZXRTdGFyRE9NIiwibGVmdERpcyIsIndpZHRoIiwiY2xpZW50V2lkdGgiLCJvbkNoYW5nZSIsInN0eWxlIiwicHJlZml4Q2xzIiwiY2xhc3NOYW1lIiwiY2hhcmFjdGVyIiwidGFiSW5kZXgiLCJkaXNhYmxlZENsYXNzIiwicHVzaCIsInNhdmVSZWYiLCJvbkNsaWNrIiwib25Ib3ZlciIsInNhdmVSYXRlIiwiQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwiYm9vbCIsIm51bWJlciIsIm9iamVjdCIsInN0cmluZyIsImZ1bmMiLCJub29wIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0lBRXFCQSxJOzs7OztBQWtDbkIsZ0JBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTtBQUNqQixnSEFBTUEsS0FBTjtBQURpQixnR0FrQ1QsVUFBQ0MsS0FBRCxFQUFRQyxLQUFS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QVMsRUFBRVMsc0JBQVU3QixJQVpKO0FBYWpCcUIsRUFBQUEsUUFBUSxFQUFFUSxzQkFBVUUsTUFiSDtBQWNqQjFDLEVBQUFBLE9BQU8sRUFBRXdDLHNCQUFVSyxJQWRGO0FBZWpCM0MsRUFBQUEsTUFBTSxFQUFFc0Msc0JBQVVLLElBZkQ7QUFnQmpCdkMsRUFBQUEsU0FBUyxFQUFFa0Msc0JBQVVLLElBaEJKO0FBaUJqQjlCLEVBQUFBLFNBQVMsRUFBRXlCLHNCQUFVQztBQWpCSixDO2lDQURBMUQsSSxrQkFxQkc7QUFDcEIrQixFQUFBQSxZQUFZLEVBQUUsQ0FETTtBQUVwQlYsRUFBQUEsS0FBSyxFQUFFLENBRmE7QUFHcEJDLEVBQUFBLFNBQVMsRUFBRSxLQUhTO0FBSXBCUixFQUFBQSxVQUFVLEVBQUUsSUFKUTtBQUtwQitCLEVBQUFBLEtBQUssRUFBRSxFQUxhO0FBTXBCQyxFQUFBQSxTQUFTLEVBQUUsU0FOUztBQU9wQkYsRUFBQUEsUUFBUSxFQUFFbUIsZ0JBUFU7QUFRcEJmLEVBQUFBLFNBQVMsRUFBRSxHQVJTO0FBU3BCdEMsRUFBQUEsYUFBYSxFQUFFcUQsZ0JBVEs7QUFVcEJkLEVBQUFBLFFBQVEsRUFBRTtBQVZVLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgbm9vcCBmcm9tICdsb2Rhc2gvbm9vcCc7XG5pbXBvcnQgS2V5Q29kZSBmcm9tICcuLi8uLi9fdXRpbC9LZXlDb2RlJztcbmltcG9ydCB7IGdldE9mZnNldExlZnQgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IFN0YXIgZnJvbSAnLi9TdGFyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUmF0ZSBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHZhbHVlOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIGRlZmF1bHRWYWx1ZTogUHJvcFR5cGVzLm51bWJlcixcbiAgICBjb3VudDogUHJvcFR5cGVzLm51bWJlcixcbiAgICBhbGxvd0hhbGY6IFByb3BUeXBlcy5ib29sLFxuICAgIGFsbG93Q2xlYXI6IFByb3BUeXBlcy5ib29sLFxuICAgIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Ib3ZlckNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNoYXJhY3RlcjogUHJvcFR5cGVzLm5vZGUsXG4gICAgdGFiSW5kZXg6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgb25Gb2N1czogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25CbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbktleURvd246IFByb3BUeXBlcy5mdW5jLFxuICAgIGF1dG9Gb2N1czogUHJvcFR5cGVzLmJvb2wsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBkZWZhdWx0VmFsdWU6IDAsXG4gICAgY291bnQ6IDUsXG4gICAgYWxsb3dIYWxmOiBmYWxzZSxcbiAgICBhbGxvd0NsZWFyOiB0cnVlLFxuICAgIHN0eWxlOiB7fSxcbiAgICBwcmVmaXhDbHM6ICdyYy1yYXRlJyxcbiAgICBvbkNoYW5nZTogbm9vcCxcbiAgICBjaGFyYWN0ZXI6ICfimIUnLFxuICAgIG9uSG92ZXJDaGFuZ2U6IG5vb3AsXG4gICAgdGFiSW5kZXg6IDAsXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgbGV0IHZhbHVlID0gcHJvcHMudmFsdWU7XG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHZhbHVlID0gcHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgIH1cblxuICAgIHRoaXMuc3RhcnMgPSB7fTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB2YWx1ZSxcbiAgICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgICAgY2xlYW5lZFZhbHVlOiBudWxsLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5hdXRvRm9jdXMgJiYgIXRoaXMucHJvcHMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICgndmFsdWUnIGluIG5leHRQcm9wcykge1xuICAgICAgbGV0IHZhbHVlID0gbmV4dFByb3BzLnZhbHVlO1xuICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFsdWUgPSBuZXh0UHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHZhbHVlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgb25Ib3ZlciA9IChldmVudCwgaW5kZXgpID0+IHtcbiAgICBjb25zdCBob3ZlclZhbHVlID0gdGhpcy5nZXRTdGFyVmFsdWUoaW5kZXgsIGV2ZW50LnBhZ2VYKTtcbiAgICBjb25zdCB7IGNsZWFuZWRWYWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoaG92ZXJWYWx1ZSAhPT0gY2xlYW5lZFZhbHVlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgaG92ZXJWYWx1ZSxcbiAgICAgICAgY2xlYW5lZFZhbHVlOiBudWxsLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25Ib3ZlckNoYW5nZShob3ZlclZhbHVlKTtcbiAgfTtcblxuICBvbk1vdXNlTGVhdmUgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBob3ZlclZhbHVlOiB1bmRlZmluZWQsXG4gICAgICBjbGVhbmVkVmFsdWU6IG51bGwsXG4gICAgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkhvdmVyQ2hhbmdlKHVuZGVmaW5lZCk7XG4gIH07XG5cbiAgb25DbGljayA9IChldmVudCwgaW5kZXgpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0U3RhclZhbHVlKGluZGV4LCBldmVudC5wYWdlWCk7XG4gICAgbGV0IGlzUmVzZXQgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5wcm9wcy5hbGxvd0NsZWFyKSB7XG4gICAgICBpc1Jlc2V0ID0gdmFsdWUgPT09IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgfVxuICAgIHRoaXMub25Nb3VzZUxlYXZlKHRydWUpO1xuICAgIHRoaXMuY2hhbmdlVmFsdWUoaXNSZXNldCA/IDAgOiB2YWx1ZSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBjbGVhbmVkVmFsdWU6IGlzUmVzZXQgPyB2YWx1ZSA6IG51bGwsXG4gICAgfSk7XG4gIH07XG5cbiAgb25Gb2N1cyA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9uRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBmb2N1c2VkOiB0cnVlLFxuICAgIH0pO1xuICAgIGlmIChvbkZvY3VzKSB7XG4gICAgICBvbkZvY3VzKCk7XG4gICAgfVxuICB9O1xuXG4gIG9uQmx1ciA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9uQmx1ciB9ID0gdGhpcy5wcm9wcztcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgIH0pO1xuICAgIGlmIChvbkJsdXIpIHtcbiAgICAgIG9uQmx1cigpO1xuICAgIH1cbiAgfTtcblxuICBvbktleURvd24gPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCB7IGtleUNvZGUgfSA9IGV2ZW50O1xuICAgIGNvbnN0IHsgY291bnQsIGFsbG93SGFsZiwgb25LZXlEb3duIH0gPSB0aGlzLnByb3BzO1xuICAgIGxldCB7IHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmIChrZXlDb2RlID09PSBLZXlDb2RlLlJJR0hUICYmIHZhbHVlIDwgY291bnQpIHtcbiAgICAgIGlmIChhbGxvd0hhbGYpIHtcbiAgICAgICAgdmFsdWUgKz0gMC41O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgKz0gMTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2hhbmdlVmFsdWUodmFsdWUpO1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9IGVsc2UgaWYgKGtleUNvZGUgPT09IEtleUNvZGUuTEVGVCAmJiB2YWx1ZSA+IDApIHtcbiAgICAgIGlmIChhbGxvd0hhbGYpIHtcbiAgICAgICAgdmFsdWUgLT0gMC41O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgLT0gMTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2hhbmdlVmFsdWUodmFsdWUpO1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgaWYgKG9uS2V5RG93bikge1xuICAgICAgb25LZXlEb3duKGV2ZW50KTtcbiAgICB9XG4gIH07XG5cbiAgZ2V0U3RhckRPTShpbmRleCkge1xuICAgIHJldHVybiBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzLnN0YXJzW2luZGV4XSk7XG4gIH1cblxuICBnZXRTdGFyVmFsdWUoaW5kZXgsIHgpIHtcbiAgICBsZXQgdmFsdWUgPSBpbmRleCArIDE7XG4gICAgaWYgKHRoaXMucHJvcHMuYWxsb3dIYWxmKSB7XG4gICAgICBjb25zdCBzdGFyRWxlID0gdGhpcy5nZXRTdGFyRE9NKGluZGV4KTtcbiAgICAgIGNvbnN0IGxlZnREaXMgPSBnZXRPZmZzZXRMZWZ0KHN0YXJFbGUpO1xuICAgICAgY29uc3Qgd2lkdGggPSBzdGFyRWxlLmNsaWVudFdpZHRoO1xuICAgICAgaWYgKCh4IC0gbGVmdERpcykgPCB3aWR0aCAvIDIpIHtcbiAgICAgICAgdmFsdWUgLT0gMC41O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBmb2N1cygpIHtcbiAgICBpZiAoIXRoaXMucHJvcHMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMucmF0ZS5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIGJsdXIoKSB7XG4gICAgaWYgKCF0aGlzLnByb3BzLmRpc2FibGVkKSB7XG4gICAgICB0aGlzLnJhdGUuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBjaGFuZ2VWYWx1ZSh2YWx1ZSkge1xuICAgIGlmICghKCd2YWx1ZScgaW4gdGhpcy5wcm9wcykpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICB2YWx1ZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKHZhbHVlKTtcbiAgfVxuXG4gIHNhdmVSZWYgPSAoaW5kZXgpID0+IChub2RlKSA9PiB7XG4gICAgdGhpcy5zdGFyc1tpbmRleF0gPSBub2RlO1xuICB9O1xuXG4gIHNhdmVSYXRlID0gKG5vZGUpID0+IHtcbiAgICB0aGlzLnJhdGUgPSBub2RlO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjb3VudCxcbiAgICAgIGFsbG93SGFsZixcbiAgICAgIHN0eWxlLFxuICAgICAgcHJlZml4Q2xzLFxuICAgICAgZGlzYWJsZWQsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBjaGFyYWN0ZXIsXG4gICAgICB0YWJJbmRleCxcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IHZhbHVlLCBob3ZlclZhbHVlLCBmb2N1c2VkIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHN0YXJzID0gW107XG4gICAgY29uc3QgZGlzYWJsZWRDbGFzcyA9IGRpc2FibGVkID8gYCR7cHJlZml4Q2xzfS1kaXNhYmxlZGAgOiAnJztcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgY291bnQ7IGluZGV4KyspIHtcbiAgICAgIHN0YXJzLnB1c2goXG4gICAgICAgIDxTdGFyXG4gICAgICAgICAgcmVmPXt0aGlzLnNhdmVSZWYoaW5kZXgpfVxuICAgICAgICAgIGluZGV4PXtpbmRleH1cbiAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgICAgcHJlZml4Q2xzPXtgJHtwcmVmaXhDbHN9LXN0YXJgfVxuICAgICAgICAgIGFsbG93SGFsZj17YWxsb3dIYWxmfVxuICAgICAgICAgIHZhbHVlPXtob3ZlclZhbHVlID09PSB1bmRlZmluZWQgPyB2YWx1ZSA6IGhvdmVyVmFsdWV9XG4gICAgICAgICAgb25DbGljaz17dGhpcy5vbkNsaWNrfVxuICAgICAgICAgIG9uSG92ZXI9e3RoaXMub25Ib3Zlcn1cbiAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgIGNoYXJhY3Rlcj17Y2hhcmFjdGVyfVxuICAgICAgICAgIGZvY3VzZWQ9e2ZvY3VzZWR9XG4gICAgICAgIC8+LFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDx1bFxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMocHJlZml4Q2xzLCBkaXNhYmxlZENsYXNzLCBjbGFzc05hbWUpfVxuICAgICAgICBzdHlsZT17c3R5bGV9XG4gICAgICAgIG9uTW91c2VMZWF2ZT17ZGlzYWJsZWQgPyBudWxsIDogdGhpcy5vbk1vdXNlTGVhdmV9XG4gICAgICAgIHRhYkluZGV4PXtkaXNhYmxlZCA/IC0xIDogdGFiSW5kZXh9XG4gICAgICAgIG9uRm9jdXM9e2Rpc2FibGVkID8gbnVsbCA6IHRoaXMub25Gb2N1c31cbiAgICAgICAgb25CbHVyPXtkaXNhYmxlZCA/IG51bGwgOiB0aGlzLm9uQmx1cn1cbiAgICAgICAgb25LZXlEb3duPXtkaXNhYmxlZCA/IG51bGwgOiB0aGlzLm9uS2V5RG93bn1cbiAgICAgICAgcmVmPXt0aGlzLnNhdmVSYXRlfVxuICAgICAgPlxuICAgICAgICB7c3RhcnN9XG4gICAgICA8L3VsPlxuICAgICk7XG4gIH1cbn1cbiJdfQ==