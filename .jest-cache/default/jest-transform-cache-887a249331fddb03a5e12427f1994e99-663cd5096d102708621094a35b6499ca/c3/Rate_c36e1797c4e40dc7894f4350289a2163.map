{"version":3,"sources":["Rate.jsx"],"names":["Rate","props","event","index","hoverValue","getStarValue","pageX","cleanedValue","state","setState","onHoverChange","undefined","value","isReset","allowClear","onMouseLeave","changeValue","onFocus","focused","onBlur","keyCode","count","allowHalf","onKeyDown","KeyCode","RIGHT","preventDefault","LEFT","node","stars","rate","defaultValue","autoFocus","disabled","focus","nextProps","ReactDOM","findDOMNode","x","starEle","getStarDOM","leftDis","width","clientWidth","onChange","style","prefixCls","className","character","tabIndex","disabledClass","push","saveRef","onClick","onHover","saveRate","Component","PropTypes","bool","number","object","string","func","noop"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport noop from 'lodash/noop';\nimport KeyCode from '../../_util/KeyCode';\nimport { getOffsetLeft } from './util';\nimport Star from './Star';\n\nexport default class Rate extends Component {\n  static propTypes = {\n    disabled: PropTypes.bool,\n    value: PropTypes.number,\n    defaultValue: PropTypes.number,\n    count: PropTypes.number,\n    allowHalf: PropTypes.bool,\n    allowClear: PropTypes.bool,\n    style: PropTypes.object,\n    prefixCls: PropTypes.string,\n    onChange: PropTypes.func,\n    onHoverChange: PropTypes.func,\n    className: PropTypes.string,\n    character: PropTypes.node,\n    tabIndex: PropTypes.number,\n    onFocus: PropTypes.func,\n    onBlur: PropTypes.func,\n    onKeyDown: PropTypes.func,\n    autoFocus: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    defaultValue: 0,\n    count: 5,\n    allowHalf: false,\n    allowClear: true,\n    style: {},\n    prefixCls: 'rc-rate',\n    onChange: noop,\n    character: 'â˜…',\n    onHoverChange: noop,\n    tabIndex: 0,\n  };\n\n  constructor(props) {\n    super(props);\n    let value = props.value;\n    if (value === undefined) {\n      value = props.defaultValue;\n    }\n\n    this.stars = {};\n\n    this.state = {\n      value,\n      focused: false,\n      cleanedValue: null,\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.autoFocus && !this.props.disabled) {\n      this.focus();\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if ('value' in nextProps) {\n      let value = nextProps.value;\n      if (value === undefined) {\n        value = nextProps.defaultValue;\n      }\n      this.setState({\n        value,\n      });\n    }\n  }\n\n  onHover = (event, index) => {\n    const hoverValue = this.getStarValue(index, event.pageX);\n    const { cleanedValue } = this.state;\n    if (hoverValue !== cleanedValue) {\n      this.setState({\n        hoverValue,\n        cleanedValue: null,\n      });\n    }\n    this.props.onHoverChange(hoverValue);\n  };\n\n  onMouseLeave = () => {\n    this.setState({\n      hoverValue: undefined,\n      cleanedValue: null,\n    });\n    this.props.onHoverChange(undefined);\n  };\n\n  onClick = (event, index) => {\n    const value = this.getStarValue(index, event.pageX);\n    let isReset = false;\n    if (this.props.allowClear) {\n      isReset = value === this.state.value;\n    }\n    this.onMouseLeave(true);\n    this.changeValue(isReset ? 0 : value);\n    this.setState({\n      cleanedValue: isReset ? value : null,\n    });\n  };\n\n  onFocus = () => {\n    const { onFocus } = this.props;\n    this.setState({\n      focused: true,\n    });\n    if (onFocus) {\n      onFocus();\n    }\n  };\n\n  onBlur = () => {\n    const { onBlur } = this.props;\n    this.setState({\n      focused: false,\n    });\n    if (onBlur) {\n      onBlur();\n    }\n  };\n\n  onKeyDown = (event) => {\n    const { keyCode } = event;\n    const { count, allowHalf, onKeyDown } = this.props;\n    let { value } = this.state;\n    if (keyCode === KeyCode.RIGHT && value < count) {\n      if (allowHalf) {\n        value += 0.5;\n      } else {\n        value += 1;\n      }\n      this.changeValue(value);\n      event.preventDefault();\n    } else if (keyCode === KeyCode.LEFT && value > 0) {\n      if (allowHalf) {\n        value -= 0.5;\n      } else {\n        value -= 1;\n      }\n      this.changeValue(value);\n      event.preventDefault();\n    }\n    if (onKeyDown) {\n      onKeyDown(event);\n    }\n  };\n\n  getStarDOM(index) {\n    return ReactDOM.findDOMNode(this.stars[index]);\n  }\n\n  getStarValue(index, x) {\n    let value = index + 1;\n    if (this.props.allowHalf) {\n      const starEle = this.getStarDOM(index);\n      const leftDis = getOffsetLeft(starEle);\n      const width = starEle.clientWidth;\n      if ((x - leftDis) < width / 2) {\n        value -= 0.5;\n      }\n    }\n    return value;\n  }\n\n  focus() {\n    if (!this.props.disabled) {\n      this.rate.focus();\n    }\n  }\n\n  blur() {\n    if (!this.props.disabled) {\n      this.rate.focus();\n    }\n  }\n\n  changeValue(value) {\n    if (!('value' in this.props)) {\n      this.setState({\n        value,\n      });\n    }\n    this.props.onChange(value);\n  }\n\n  saveRef = (index) => (node) => {\n    this.stars[index] = node;\n  };\n\n  saveRate = (node) => {\n    this.rate = node;\n  };\n\n  render() {\n    const {\n      count,\n      allowHalf,\n      style,\n      prefixCls,\n      disabled,\n      className,\n      character,\n      tabIndex,\n    } = this.props;\n    const { value, hoverValue, focused } = this.state;\n    const stars = [];\n    const disabledClass = disabled ? `${prefixCls}-disabled` : '';\n    for (let index = 0; index < count; index++) {\n      stars.push(\n        <Star\n          ref={this.saveRef(index)}\n          index={index}\n          disabled={disabled}\n          prefixCls={`${prefixCls}-star`}\n          allowHalf={allowHalf}\n          value={hoverValue === undefined ? value : hoverValue}\n          onClick={this.onClick}\n          onHover={this.onHover}\n          key={index}\n          character={character}\n          focused={focused}\n        />,\n      );\n    }\n    return (\n      <ul\n        className={classNames(prefixCls, disabledClass, className)}\n        style={style}\n        onMouseLeave={disabled ? null : this.onMouseLeave}\n        tabIndex={disabled ? -1 : tabIndex}\n        onFocus={disabled ? null : this.onFocus}\n        onBlur={disabled ? null : this.onBlur}\n        onKeyDown={disabled ? null : this.onKeyDown}\n        ref={this.saveRate}\n      >\n        {stars}\n      </ul>\n    );\n  }\n}\n"]}