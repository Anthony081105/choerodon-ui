2e5521c6656c70c9e3f0d2cd9dc443e7
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _align = _interopRequireDefault(require("../../align"));

var _animate = _interopRequireDefault(require("../../animate"));

var _PopupInner = _interopRequireDefault(require("./PopupInner"));

var _LazyRenderBox = _interopRequireDefault(require("./LazyRenderBox"));

var _utils = require("./utils");

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Popup =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Popup, _Component);

  var _super = _createSuper(Popup);

  function Popup(_props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Popup);
    _this = _super.call(this, _props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onAlign", function (popupDomNode, align) {
      var props = _this.props;
      var currentAlignClassName = props.getClassNameFromAlign(align); // FIX: https://github.com/react-component/trigger/issues/56
      // FIX: https://github.com/react-component/tooltip/issues/79

      if (_this.currentAlignClassName !== currentAlignClassName) {
        _this.currentAlignClassName = currentAlignClassName;
        popupDomNode.className = _this.getClassName(currentAlignClassName);
      }

      props.onAlign(popupDomNode, align);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setStretchSize", function () {
      var _this$props = _this.props,
          stretch = _this$props.stretch,
          getRootDomNode = _this$props.getRootDomNode,
          visible = _this$props.visible;
      var _this$state = _this.state,
          stretchChecked = _this$state.stretchChecked,
          targetHeight = _this$state.targetHeight,
          targetWidth = _this$state.targetWidth;

      if (!stretch || !visible) {
        if (stretchChecked) {
          _this.setState({
            stretchChecked: false
          });
        }

        return;
      }

      var $ele = getRootDomNode();
      if (!$ele) return;
      var height = $ele.offsetHeight;
      var width = $ele.offsetWidth;

      if (targetHeight !== height || targetWidth !== width || !stretchChecked) {
        _this.setState({
          stretchChecked: true,
          targetHeight: height,
          targetWidth: width
        });
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getTarget", function () {
      return _this.props.getRootDomNode();
    });
    _this.state = {
      // Used for stretch
      stretchChecked: false,
      targetWidth: undefined,
      targetHeight: undefined
    };
    _this.savePopupRef = _utils.saveRef.bind((0, _assertThisInitialized2["default"])(_this), 'popupInstance');
    _this.saveAlignRef = _utils.saveRef.bind((0, _assertThisInitialized2["default"])(_this), 'alignInstance');
    return _this;
  }

  (0, _createClass2["default"])(Popup, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.rootNode = this.getPopupDomNode();
      this.setStretchSize();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.setStretchSize();
    }
  }, {
    key: "getPopupDomNode",
    value: function getPopupDomNode() {
      return _reactDom["default"].findDOMNode(this.popupInstance);
    }
  }, {
    key: "getMaskTransitionName",
    value: function getMaskTransitionName() {
      var props = this.props;
      var transitionName = props.maskTransitionName;
      var animation = props.maskAnimation;

      if (!transitionName && animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(animation);
      }

      return transitionName;
    }
  }, {
    key: "getTransitionName",
    value: function getTransitionName() {
      var props = this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(props.prefixCls, "-").concat(props.animation);
      }

      return transitionName;
    }
  }, {
    key: "getClassName",
    value: function getClassName(currentAlignClassName) {
      return "".concat(this.props.prefixCls, " ").concat(this.props.className, " ").concat(currentAlignClassName);
    }
  }, {
    key: "getPopupElement",
    value: function getPopupElement() {
      var savePopupRef = this.savePopupRef;
      var _this$state2 = this.state,
          stretchChecked = _this$state2.stretchChecked,
          targetHeight = _this$state2.targetHeight,
          targetWidth = _this$state2.targetWidth;
      var _this$props2 = this.props,
          align = _this$props2.align,
          visible = _this$props2.visible,
          prefixCls = _this$props2.prefixCls,
          style = _this$props2.style,
          getClassNameFromAlign = _this$props2.getClassNameFromAlign,
          destroyPopupOnHide = _this$props2.destroyPopupOnHide,
          stretch = _this$props2.stretch,
          children = _this$props2.children,
          onMouseEnter = _this$props2.onMouseEnter,
          onMouseLeave = _this$props2.onMouseLeave;
      var className = this.getClassName(this.currentAlignClassName || getClassNameFromAlign(align));
      var hiddenClassName = "".concat(prefixCls, "-hidden");

      if (!visible) {
        this.currentAlignClassName = null;
      }

      var sizeStyle = {};

      if (stretch) {
        if (stretchChecked) {
          // Stretch with target
          if (stretch.indexOf('height') !== -1) {
            sizeStyle.height = targetHeight;
          } else if (stretch.indexOf('minHeight') !== -1) {
            sizeStyle.minHeight = targetHeight;
          }

          if (stretch.indexOf('width') !== -1) {
            sizeStyle.width = targetWidth;
          } else if (stretch.indexOf('minWidth') !== -1) {
            sizeStyle.minWidth = targetWidth;
          }
        } else {
          // Do nothing when stretch not ready
          return null;
        }
      }

      var newStyle = (0, _objectSpread2["default"])({}, sizeStyle, {}, style, {}, this.getZIndexStyle());
      var popupInnerProps = {
        className: className,
        prefixCls: prefixCls,
        ref: savePopupRef,
        onMouseEnter: onMouseEnter,
        onMouseLeave: onMouseLeave,
        style: newStyle
      };

      if (destroyPopupOnHide) {
        return _react["default"].createElement(_animate["default"], {
          component: "",
          exclusive: true,
          transitionAppear: true,
          transitionName: this.getTransitionName()
        }, visible ? _react["default"].createElement(_align["default"], {
          target: this.getTarget,
          key: "popup",
          ref: this.saveAlignRef,
          monitorWindowResize: true,
          hidden: !visible,
          childrenProps: {
            hidden: 'hidden'
          },
          align: align,
          onAlign: this.onAlign
        }, _react["default"].createElement(_PopupInner["default"], popupInnerProps, children)) : null);
      }

      return _react["default"].createElement(_animate["default"], {
        component: "",
        exclusive: true,
        transitionAppear: true,
        transitionName: this.getTransitionName(),
        hiddenProp: "hidden"
      }, _react["default"].createElement(_align["default"], {
        target: this.getTarget,
        key: "popup",
        ref: this.saveAlignRef,
        monitorWindowResize: true,
        hidden: !visible,
        childrenProps: {
          hidden: 'hidden'
        },
        disabled: !visible,
        align: align,
        onAlign: this.onAlign
      }, _react["default"].createElement(_PopupInner["default"], (0, _extends2["default"])({
        hiddenClassName: hiddenClassName
      }, popupInnerProps), children)));
    }
  }, {
    key: "getZIndexStyle",
    value: function getZIndexStyle() {
      var style = {};
      var props = this.props;

      if (props.zIndex !== undefined) {
        style.zIndex = props.zIndex;
      }

      return style;
    }
  }, {
    key: "getMaskElement",
    value: function getMaskElement() {
      var props = this.props;
      var maskElement;

      if (props.mask) {
        var maskTransition = this.getMaskTransitionName();
        maskElement = _react["default"].createElement(_LazyRenderBox["default"], {
          style: this.getZIndexStyle(),
          key: "mask",
          className: "".concat(props.prefixCls, "-mask"),
          hiddenClassName: "".concat(props.prefixCls, "-mask-hidden"),
          hidden: !props.visible
        });

        if (maskTransition) {
          maskElement = _react["default"].createElement(_animate["default"], {
            key: "mask",
            hiddenProp: "hidden",
            transitionAppear: true,
            component: "",
            transitionName: maskTransition
          }, maskElement);
        }
      }

      return maskElement;
    }
  }, {
    key: "render",
    value: function render() {
      return _react["default"].createElement("div", null, this.getMaskElement(), this.getPopupElement());
    }
  }]);
  return Popup;
}(_react.Component);

(0, _defineProperty2["default"])(Popup, "propTypes", {
  visible: _propTypes["default"].bool,
  style: _propTypes["default"].object,
  getClassNameFromAlign: _propTypes["default"].func,
  onAlign: _propTypes["default"].func,
  getRootDomNode: _propTypes["default"].func,
  onMouseEnter: _propTypes["default"].func,
  align: _propTypes["default"].any,
  destroyPopupOnHide: _propTypes["default"].bool,
  className: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  onMouseLeave: _propTypes["default"].func,
  stretch: _propTypes["default"].string,
  children: _propTypes["default"].node
});
var _default = Popup;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyaWdnZXIvUG9wdXAuanN4Il0sIm5hbWVzIjpbIlBvcHVwIiwiQ29tcG9uZW50IiwidmlzaWJsZSIsIlByb3BUeXBlcyIsInN0eWxlIiwiZ2V0Q2xhc3NOYW1lRnJvbUFsaWduIiwib25BbGlnbiIsImdldFJvb3REb21Ob2RlIiwib25Nb3VzZUVudGVyIiwiYWxpZ24iLCJkZXN0cm95UG9wdXBPbkhpZGUiLCJjbGFzc05hbWUiLCJwcmVmaXhDbHMiLCJvbk1vdXNlTGVhdmUiLCJzdHJldGNoIiwiY2hpbGRyZW4iLCJub2RlIiwic3RyZXRjaENoZWNrZWQiLCJ0YXJnZXRXaWR0aCIsInRhcmdldEhlaWdodCIsInVuZGVmaW5lZCIsInNhdmVSZWYiLCJwcm9wcyIsImN1cnJlbnRBbGlnbkNsYXNzTmFtZSIsInBvcHVwRG9tTm9kZSIsIiRlbGUiLCJoZWlnaHQiLCJ3aWR0aCIsIlJlYWN0RE9NIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb24iLCJzYXZlUG9wdXBSZWYiLCJoaWRkZW5DbGFzc05hbWUiLCJzaXplU3R5bGUiLCJuZXdTdHlsZSIsInBvcHVwSW5uZXJQcm9wcyIsInJlZiIsImhpZGRlbiIsIm1hc2tUcmFuc2l0aW9uIiwibWFza0VsZW1lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxTQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxRQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsZUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFB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UUFBUSxFQUFFWixVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUFVYTtBQWJILEM7ZUE2UU5oQixLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBBbGlnbiBmcm9tICcuLi8uLi9hbGlnbic7XG5pbXBvcnQgQW5pbWF0ZSBmcm9tICcuLi8uLi9hbmltYXRlJztcbmltcG9ydCBQb3B1cElubmVyIGZyb20gJy4vUG9wdXBJbm5lcic7XG5pbXBvcnQgTGF6eVJlbmRlckJveCBmcm9tICcuL0xhenlSZW5kZXJCb3gnO1xuaW1wb3J0IHsgc2F2ZVJlZiB9IGZyb20gJy4vdXRpbHMnO1xuXG5jbGFzcyBQb3B1cCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgdmlzaWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZ2V0Q2xhc3NOYW1lRnJvbUFsaWduOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkFsaWduOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnZXRSb290RG9tTm9kZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Nb3VzZUVudGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBhbGlnbjogUHJvcFR5cGVzLmFueSxcbiAgICBkZXN0cm95UG9wdXBPbkhpZGU6IFByb3BUeXBlcy5ib29sLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgb25Nb3VzZUxlYXZlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzdHJldGNoOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAvLyBVc2VkIGZvciBzdHJldGNoXG4gICAgICBzdHJldGNoQ2hlY2tlZDogZmFsc2UsXG4gICAgICB0YXJnZXRXaWR0aDogdW5kZWZpbmVkLFxuICAgICAgdGFyZ2V0SGVpZ2h0OiB1bmRlZmluZWQsXG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZVBvcHVwUmVmID0gc2F2ZVJlZi5iaW5kKHRoaXMsICdwb3B1cEluc3RhbmNlJyk7XG4gICAgdGhpcy5zYXZlQWxpZ25SZWYgPSBzYXZlUmVmLmJpbmQodGhpcywgJ2FsaWduSW5zdGFuY2UnKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMucm9vdE5vZGUgPSB0aGlzLmdldFBvcHVwRG9tTm9kZSgpO1xuICAgIHRoaXMuc2V0U3RyZXRjaFNpemUoKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnNldFN0cmV0Y2hTaXplKCk7XG4gIH1cblxuICBvbkFsaWduID0gKHBvcHVwRG9tTm9kZSwgYWxpZ24pID0+IHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgY3VycmVudEFsaWduQ2xhc3NOYW1lID0gcHJvcHMuZ2V0Q2xhc3NOYW1lRnJvbUFsaWduKGFsaWduKTtcbiAgICAvLyBGSVg6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdC1jb21wb25lbnQvdHJpZ2dlci9pc3N1ZXMvNTZcbiAgICAvLyBGSVg6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdC1jb21wb25lbnQvdG9vbHRpcC9pc3N1ZXMvNzlcbiAgICBpZiAodGhpcy5jdXJyZW50QWxpZ25DbGFzc05hbWUgIT09IGN1cnJlbnRBbGlnbkNsYXNzTmFtZSkge1xuICAgICAgdGhpcy5jdXJyZW50QWxpZ25DbGFzc05hbWUgPSBjdXJyZW50QWxpZ25DbGFzc05hbWU7XG4gICAgICBwb3B1cERvbU5vZGUuY2xhc3NOYW1lID0gdGhpcy5nZXRDbGFzc05hbWUoY3VycmVudEFsaWduQ2xhc3NOYW1lKTtcbiAgICB9XG4gICAgcHJvcHMub25BbGlnbihwb3B1cERvbU5vZGUsIGFsaWduKTtcbiAgfTtcblxuICAvLyBSZWNvcmQgc2l6ZSBpZiBzdHJldGNoIG5lZWRlZFxuICBzZXRTdHJldGNoU2l6ZSA9ICgpID0+IHtcbiAgICBjb25zdCB7IHN0cmV0Y2gsIGdldFJvb3REb21Ob2RlLCB2aXNpYmxlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgc3RyZXRjaENoZWNrZWQsIHRhcmdldEhlaWdodCwgdGFyZ2V0V2lkdGggfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAoIXN0cmV0Y2ggfHwgIXZpc2libGUpIHtcbiAgICAgIGlmIChzdHJldGNoQ2hlY2tlZCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc3RyZXRjaENoZWNrZWQ6IGZhbHNlIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0ICRlbGUgPSBnZXRSb290RG9tTm9kZSgpO1xuICAgIGlmICghJGVsZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGVpZ2h0ID0gJGVsZS5vZmZzZXRIZWlnaHQ7XG4gICAgY29uc3Qgd2lkdGggPSAkZWxlLm9mZnNldFdpZHRoO1xuXG4gICAgaWYgKHRhcmdldEhlaWdodCAhPT0gaGVpZ2h0IHx8IHRhcmdldFdpZHRoICE9PSB3aWR0aCB8fCAhc3RyZXRjaENoZWNrZWQpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBzdHJldGNoQ2hlY2tlZDogdHJ1ZSxcbiAgICAgICAgdGFyZ2V0SGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHRhcmdldFdpZHRoOiB3aWR0aCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBnZXRQb3B1cERvbU5vZGUoKSB7XG4gICAgcmV0dXJuIFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMucG9wdXBJbnN0YW5jZSk7XG4gIH1cblxuICBnZXRUYXJnZXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMuZ2V0Um9vdERvbU5vZGUoKTtcbiAgfTtcblxuICBnZXRNYXNrVHJhbnNpdGlvbk5hbWUoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCB0cmFuc2l0aW9uTmFtZSA9IHByb3BzLm1hc2tUcmFuc2l0aW9uTmFtZTtcbiAgICBjb25zdCBhbmltYXRpb24gPSBwcm9wcy5tYXNrQW5pbWF0aW9uO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgYW5pbWF0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3Byb3BzLnByZWZpeENsc30tJHthbmltYXRpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9XG5cbiAgZ2V0VHJhbnNpdGlvbk5hbWUoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCB0cmFuc2l0aW9uTmFtZSA9IHByb3BzLnRyYW5zaXRpb25OYW1lO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgcHJvcHMuYW5pbWF0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3Byb3BzLnByZWZpeENsc30tJHtwcm9wcy5hbmltYXRpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9XG5cbiAgZ2V0Q2xhc3NOYW1lKGN1cnJlbnRBbGlnbkNsYXNzTmFtZSkge1xuICAgIHJldHVybiBgJHt0aGlzLnByb3BzLnByZWZpeENsc30gJHt0aGlzLnByb3BzLmNsYXNzTmFtZX0gJHtjdXJyZW50QWxpZ25DbGFzc05hbWV9YDtcbiAgfVxuXG4gIGdldFBvcHVwRWxlbWVudCgpIHtcbiAgICBjb25zdCB7IHNhdmVQb3B1cFJlZiB9ID0gdGhpcztcbiAgICBjb25zdCB7IHN0cmV0Y2hDaGVja2VkLCB0YXJnZXRIZWlnaHQsIHRhcmdldFdpZHRoIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHtcbiAgICAgIGFsaWduLCB2aXNpYmxlLFxuICAgICAgcHJlZml4Q2xzLCBzdHlsZSwgZ2V0Q2xhc3NOYW1lRnJvbUFsaWduLFxuICAgICAgZGVzdHJveVBvcHVwT25IaWRlLCBzdHJldGNoLCBjaGlsZHJlbixcbiAgICAgIG9uTW91c2VFbnRlciwgb25Nb3VzZUxlYXZlLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuZ2V0Q2xhc3NOYW1lKHRoaXMuY3VycmVudEFsaWduQ2xhc3NOYW1lIHx8XG4gICAgICBnZXRDbGFzc05hbWVGcm9tQWxpZ24oYWxpZ24pKTtcbiAgICBjb25zdCBoaWRkZW5DbGFzc05hbWUgPSBgJHtwcmVmaXhDbHN9LWhpZGRlbmA7XG5cbiAgICBpZiAoIXZpc2libGUpIHtcbiAgICAgIHRoaXMuY3VycmVudEFsaWduQ2xhc3NOYW1lID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBzaXplU3R5bGUgPSB7fTtcbiAgICBpZiAoc3RyZXRjaCkge1xuICAgICAgaWYgKHN0cmV0Y2hDaGVja2VkKSB7XG4gICAgICAgIC8vIFN0cmV0Y2ggd2l0aCB0YXJnZXRcbiAgICAgICAgaWYgKHN0cmV0Y2guaW5kZXhPZignaGVpZ2h0JykgIT09IC0xKSB7XG4gICAgICAgICAgc2l6ZVN0eWxlLmhlaWdodCA9IHRhcmdldEhlaWdodDtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJldGNoLmluZGV4T2YoJ21pbkhlaWdodCcpICE9PSAtMSkge1xuICAgICAgICAgIHNpemVTdHlsZS5taW5IZWlnaHQgPSB0YXJnZXRIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0cmV0Y2guaW5kZXhPZignd2lkdGgnKSAhPT0gLTEpIHtcbiAgICAgICAgICBzaXplU3R5bGUud2lkdGggPSB0YXJnZXRXaWR0aDtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJldGNoLmluZGV4T2YoJ21pbldpZHRoJykgIT09IC0xKSB7XG4gICAgICAgICAgc2l6ZVN0eWxlLm1pbldpZHRoID0gdGFyZ2V0V2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIERvIG5vdGhpbmcgd2hlbiBzdHJldGNoIG5vdCByZWFkeVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBuZXdTdHlsZSA9IHtcbiAgICAgIC4uLnNpemVTdHlsZSxcbiAgICAgIC4uLnN0eWxlLFxuICAgICAgLi4udGhpcy5nZXRaSW5kZXhTdHlsZSgpLFxuICAgIH07XG5cbiAgICBjb25zdCBwb3B1cElubmVyUHJvcHMgPSB7XG4gICAgICBjbGFzc05hbWUsXG4gICAgICBwcmVmaXhDbHMsXG4gICAgICByZWY6IHNhdmVQb3B1cFJlZixcbiAgICAgIG9uTW91c2VFbnRlcixcbiAgICAgIG9uTW91c2VMZWF2ZSxcbiAgICAgIHN0eWxlOiBuZXdTdHlsZSxcbiAgICB9O1xuICAgIGlmIChkZXN0cm95UG9wdXBPbkhpZGUpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxBbmltYXRlXG4gICAgICAgICAgY29tcG9uZW50PVwiXCJcbiAgICAgICAgICBleGNsdXNpdmVcbiAgICAgICAgICB0cmFuc2l0aW9uQXBwZWFyXG4gICAgICAgICAgdHJhbnNpdGlvbk5hbWU9e3RoaXMuZ2V0VHJhbnNpdGlvbk5hbWUoKX1cbiAgICAgICAgPlxuICAgICAgICAgIHt2aXNpYmxlID8gKFxuICAgICAgICAgICAgPEFsaWduXG4gICAgICAgICAgICAgIHRhcmdldD17dGhpcy5nZXRUYXJnZXR9XG4gICAgICAgICAgICAgIGtleT1cInBvcHVwXCJcbiAgICAgICAgICAgICAgcmVmPXt0aGlzLnNhdmVBbGlnblJlZn1cbiAgICAgICAgICAgICAgbW9uaXRvcldpbmRvd1Jlc2l6ZVxuICAgICAgICAgICAgICBoaWRkZW49eyF2aXNpYmxlfVxuICAgICAgICAgICAgICBjaGlsZHJlblByb3BzPXt7IGhpZGRlbjogJ2hpZGRlbicgfX1cbiAgICAgICAgICAgICAgYWxpZ249e2FsaWdufVxuICAgICAgICAgICAgICBvbkFsaWduPXt0aGlzLm9uQWxpZ259XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxQb3B1cElubmVyXG4gICAgICAgICAgICAgICAgey4uLnBvcHVwSW5uZXJQcm9wc31cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAgPC9Qb3B1cElubmVyPlxuICAgICAgICAgICAgPC9BbGlnbj5cbiAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgPC9BbmltYXRlPlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlXG4gICAgICAgIGNvbXBvbmVudD1cIlwiXG4gICAgICAgIGV4Y2x1c2l2ZVxuICAgICAgICB0cmFuc2l0aW9uQXBwZWFyXG4gICAgICAgIHRyYW5zaXRpb25OYW1lPXt0aGlzLmdldFRyYW5zaXRpb25OYW1lKCl9XG4gICAgICAgIGhpZGRlblByb3A9XCJoaWRkZW5cIlxuICAgICAgPlxuICAgICAgICA8QWxpZ25cbiAgICAgICAgICB0YXJnZXQ9e3RoaXMuZ2V0VGFyZ2V0fVxuICAgICAgICAgIGtleT1cInBvcHVwXCJcbiAgICAgICAgICByZWY9e3RoaXMuc2F2ZUFsaWduUmVmfVxuICAgICAgICAgIG1vbml0b3JXaW5kb3dSZXNpemVcbiAgICAgICAgICBoaWRkZW49eyF2aXNpYmxlfVxuICAgICAgICAgIGNoaWxkcmVuUHJvcHM9e3sgaGlkZGVuOiAnaGlkZGVuJyB9fVxuICAgICAgICAgIGRpc2FibGVkPXshdmlzaWJsZX1cbiAgICAgICAgICBhbGlnbj17YWxpZ259XG4gICAgICAgICAgb25BbGlnbj17dGhpcy5vbkFsaWdufVxuICAgICAgICA+XG4gICAgICAgICAgPFBvcHVwSW5uZXJcbiAgICAgICAgICAgIGhpZGRlbkNsYXNzTmFtZT17aGlkZGVuQ2xhc3NOYW1lfVxuICAgICAgICAgICAgey4uLnBvcHVwSW5uZXJQcm9wc31cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgPC9Qb3B1cElubmVyPlxuICAgICAgICA8L0FsaWduPlxuICAgICAgPC9BbmltYXRlPlxuICAgICk7XG4gIH1cblxuICBnZXRaSW5kZXhTdHlsZSgpIHtcbiAgICBjb25zdCBzdHlsZSA9IHt9O1xuICAgIGNvbnN0IHByb3BzID0gdGhpcy5wcm9wcztcbiAgICBpZiAocHJvcHMuekluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHN0eWxlLnpJbmRleCA9IHByb3BzLnpJbmRleDtcbiAgICB9XG4gICAgcmV0dXJuIHN0eWxlO1xuICB9XG5cbiAgZ2V0TWFza0VsZW1lbnQoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCBtYXNrRWxlbWVudDtcbiAgICBpZiAocHJvcHMubWFzaykge1xuICAgICAgY29uc3QgbWFza1RyYW5zaXRpb24gPSB0aGlzLmdldE1hc2tUcmFuc2l0aW9uTmFtZSgpO1xuICAgICAgbWFza0VsZW1lbnQgPSAoXG4gICAgICAgIDxMYXp5UmVuZGVyQm94XG4gICAgICAgICAgc3R5bGU9e3RoaXMuZ2V0WkluZGV4U3R5bGUoKX1cbiAgICAgICAgICBrZXk9XCJtYXNrXCJcbiAgICAgICAgICBjbGFzc05hbWU9e2Ake3Byb3BzLnByZWZpeENsc30tbWFza2B9XG4gICAgICAgICAgaGlkZGVuQ2xhc3NOYW1lPXtgJHtwcm9wcy5wcmVmaXhDbHN9LW1hc2staGlkZGVuYH1cbiAgICAgICAgICBoaWRkZW49eyFwcm9wcy52aXNpYmxlfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICAgIGlmIChtYXNrVHJhbnNpdGlvbikge1xuICAgICAgICBtYXNrRWxlbWVudCA9IChcbiAgICAgICAgICA8QW5pbWF0ZVxuICAgICAgICAgICAga2V5PVwibWFza1wiXG4gICAgICAgICAgICBoaWRkZW5Qcm9wPVwiaGlkZGVuXCJcbiAgICAgICAgICAgIHRyYW5zaXRpb25BcHBlYXJcbiAgICAgICAgICAgIGNvbXBvbmVudD1cIlwiXG4gICAgICAgICAgICB0cmFuc2l0aW9uTmFtZT17bWFza1RyYW5zaXRpb259XG4gICAgICAgICAgPlxuICAgICAgICAgICAge21hc2tFbGVtZW50fVxuICAgICAgICAgIDwvQW5pbWF0ZT5cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1hc2tFbGVtZW50O1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2PlxuICAgICAgICB7dGhpcy5nZXRNYXNrRWxlbWVudCgpfVxuICAgICAgICB7dGhpcy5nZXRQb3B1cEVsZW1lbnQoKX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXA7XG4iXX0=