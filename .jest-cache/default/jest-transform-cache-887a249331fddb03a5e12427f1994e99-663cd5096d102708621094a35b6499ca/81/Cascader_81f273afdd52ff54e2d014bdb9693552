27ce77793ec8f0bef0e2934c5dda9daa
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _arrayTreeFilter = _interopRequireDefault(require("array-tree-filter"));

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var _trigger = _interopRequireDefault(require("../trigger"));

var _icon = _interopRequireDefault(require("../../icon"));

var _Menus = _interopRequireDefault(require("./Menus"));

var _MenusSingle = _interopRequireDefault(require("./MenusSingle"));

var _KeyCode = _interopRequireDefault(require("../../_util/KeyCode"));

var _en_US = _interopRequireDefault(require("./locale/en_US"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var BUILT_IN_PLACEMENTS = {
  bottomLeft: {
    points: ['tl', 'bl'],
    offset: [0, 4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  topLeft: {
    points: ['bl', 'tl'],
    offset: [0, -4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  bottomRight: {
    points: ['tr', 'br'],
    offset: [0, 4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  topRight: {
    points: ['br', 'tr'],
    offset: [0, -4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  }
};

var Cascader =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Cascader, _Component);

  var _super = _createSuper(Cascader);

  function Cascader(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Cascader);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setPopupVisible", function (popupVisible) {
      if (!('popupVisible' in _this.props)) {
        _this.setState({
          popupVisible: popupVisible
        });
      } // sync activeValue with value when panel open


      if (popupVisible && !_this.state.visible) {
        _this.setState({
          activeValue: _this.state.value
        });
      }

      _this.props.onPopupVisibleChange(popupVisible);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleChange", function (options, setProps, e) {
      if (e.type !== 'keydown' || e.keyCode === _KeyCode["default"].ENTER) {
        _this.props.onChange(options.map(function (o) {
          return o.value;
        }), options);

        _this.setPopupVisible(setProps.visible);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handlePopupVisibleChange", function (popupVisible) {
      _this.setPopupVisible(popupVisible);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleMenuSelect", function (targetOption, menuIndex) {
      var isTabSelected = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
      var e = arguments.length > 3 ? arguments[3] : undefined;

      // Keep focused state for keyboard support
      var triggerNode = _this.trigger.getRootDomNode();

      if (triggerNode && triggerNode.focus) {
        triggerNode.focus();
      }

      var _this$props = _this.props,
          changeOnSelect = _this$props.changeOnSelect,
          loadData = _this$props.loadData,
          expandTrigger = _this$props.expandTrigger;

      if (!targetOption || targetOption.disabled) {
        return;
      }

      var activeValue = _this.state.activeValue;
      activeValue = activeValue.slice(0, menuIndex + 1);
      activeValue[menuIndex] = targetOption.value;

      var activeOptions = _this.getActiveOptions(activeValue);

      if (targetOption.isLeaf === false && !targetOption.children && loadData) {
        if (changeOnSelect) {
          _this.handleChange(activeOptions, {
            visible: true
          }, e);
        }

        _this.setState({
          activeValue: activeValue,
          isTabSelected: isTabSelected
        });

        loadData(activeOptions);
        return;
      }

      var newState = {};

      if (!targetOption.children || !targetOption.children.length) {
        _this.handleChange(activeOptions, {
          visible: false
        }, e); // set value to activeValue when select leaf option


        newState.value = activeValue; // add e.type judgement to prevent `onChange` being triggered by mouseEnter
      } else if (changeOnSelect && (e.type === 'click' || e.type === 'keydown')) {
        if (expandTrigger === 'hover') {
          _this.handleChange(activeOptions, {
            visible: false
          }, e);
        } else {
          _this.handleChange(activeOptions, {
            visible: true
          }, e);
        } // set value to activeValue on every select


        newState.value = activeValue;
      }

      newState.activeValue = activeValue; //  not change the value by keyboard

      if ('value' in _this.props || e.type === 'keydown' && e.keyCode !== _KeyCode["default"].ENTER) {
        delete newState.value;
      }

      newState.isTabSelected = isTabSelected;

      _this.setState(newState);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleKeyDown", function (e) {
      var children = _this.props.children; // Don't bind keyboard support when children specify the onKeyDown

      if (children && children.props.onKeyDown) {
        children.props.onKeyDown(e);
        return;
      }

      var activeValue = (0, _toConsumableArray2["default"])(_this.state.activeValue);
      var currentLevel = activeValue.length - 1 < 0 ? 0 : activeValue.length - 1;

      var currentOptions = _this.getCurrentLevelOptions();

      var currentIndex = currentOptions.map(function (o) {
        return o.value;
      }).indexOf(activeValue[currentLevel]);

      if (e.keyCode !== _KeyCode["default"].DOWN && e.keyCode !== _KeyCode["default"].UP && e.keyCode !== _KeyCode["default"].LEFT && e.keyCode !== _KeyCode["default"].RIGHT && e.keyCode !== _KeyCode["default"].ENTER && e.keyCode !== _KeyCode["default"].BACKSPACE && e.keyCode !== _KeyCode["default"].ESC) {
        return;
      } // Press any keys above to reopen menu


      if (!_this.state.popupVisible && e.keyCode !== _KeyCode["default"].BACKSPACE && e.keyCode !== _KeyCode["default"].LEFT && e.keyCode !== _KeyCode["default"].RIGHT && e.keyCode !== _KeyCode["default"].ESC) {
        _this.setPopupVisible(true);

        return;
      }

      if (e.keyCode === _KeyCode["default"].DOWN || e.keyCode === _KeyCode["default"].UP) {
        var nextIndex = currentIndex;

        if (nextIndex !== -1) {
          if (e.keyCode === _KeyCode["default"].DOWN) {
            nextIndex += 1;
            nextIndex = nextIndex >= currentOptions.length ? 0 : nextIndex;
          } else {
            nextIndex -= 1;
            nextIndex = nextIndex < 0 ? currentOptions.length - 1 : nextIndex;
          }
        } else {
          nextIndex = 0;
        }

        activeValue[currentLevel] = currentOptions[nextIndex].value;
      } else if (e.keyCode === _KeyCode["default"].LEFT || e.keyCode === _KeyCode["default"].BACKSPACE) {
        activeValue.splice(activeValue.length - 1, 1);
      } else if (e.keyCode === _KeyCode["default"].RIGHT) {
        if (currentOptions[currentIndex] && currentOptions[currentIndex].children) {
          activeValue.push(currentOptions[currentIndex].children[0].value);
        }
      } else if (e.keyCode === _KeyCode["default"].ESC) {
        _this.setPopupVisible(false);

        return;
      }

      if (!activeValue || activeValue.length === 0) {
        _this.setPopupVisible(false);
      }

      var activeOptions = _this.getActiveOptions(activeValue);

      var targetOption = activeOptions[activeOptions.length - 1];

      _this.handleMenuSelect(targetOption, activeOptions.length - 1, false, e);

      if (_this.props.onKeyDown) {
        _this.props.onKeyDown(e);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveTrigger", function (node) {
      _this.trigger = node;
    });
    var initialValue = [];

    if ('value' in props) {
      initialValue = props.value || [];
    } else if ('defaultValue' in props) {
      initialValue = props.defaultValue || [];
    }

    _this.state = {
      popupVisible: props.popupVisible,
      activeValue: initialValue,
      value: initialValue,
      isTabSelected: false
    };
    return _this;
  }

  (0, _createClass2["default"])(Cascader, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('value' in nextProps && !(0, _isEqual["default"])(this.props.value, nextProps.value)) {
        var newValues = {
          value: nextProps.value || [],
          activeValue: nextProps.value || []
        }; // allow activeValue diff from value

        if ('loadData' in nextProps) {
          delete newValues.activeValue;
        }

        this.setState(newValues);
      }

      if ('popupVisible' in nextProps) {
        this.setState({
          popupVisible: nextProps.popupVisible
        });
      }
    }
  }, {
    key: "getPopupDOMNode",
    value: function getPopupDOMNode() {
      return this.trigger.getPopupDomNode();
    }
  }, {
    key: "getCurrentLevelOptions",
    value: function getCurrentLevelOptions() {
      var options = this.props.options;
      var _this$state$activeVal = this.state.activeValue,
          activeValue = _this$state$activeVal === void 0 ? [] : _this$state$activeVal;
      var result = (0, _arrayTreeFilter["default"])(options, function (o, level) {
        return o.value === activeValue[level];
      });

      if (result[result.length - 2]) {
        return result[result.length - 2].children;
      }

      return (0, _toConsumableArray2["default"])(options).filter(function (o) {
        return !o.disabled;
      });
    }
  }, {
    key: "getActiveOptions",
    value: function getActiveOptions(activeValue) {
      return (0, _arrayTreeFilter["default"])(this.props.options, function (o, level) {
        return o.value === activeValue[level];
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          transitionName = _this$props2.transitionName,
          popupClassName = _this$props2.popupClassName,
          options = _this$props2.options,
          disabled = _this$props2.disabled,
          builtinPlacements = _this$props2.builtinPlacements,
          popupPlacement = _this$props2.popupPlacement,
          children = _this$props2.children,
          locale = _this$props2.locale,
          menuMode = _this$props2.menuMode,
          singleMenuStyle = _this$props2.singleMenuStyle,
          singleMenuItemStyle = _this$props2.singleMenuItemStyle,
          restProps = (0, _objectWithoutProperties2["default"])(_this$props2, ["prefixCls", "transitionName", "popupClassName", "options", "disabled", "builtinPlacements", "popupPlacement", "children", "locale", "menuMode", "singleMenuStyle", "singleMenuItemStyle"]); // Did not show popup when there is no options

      var menus = _react["default"].createElement("div", null);

      var emptyMenuClassName = '';

      if (options && options.length > 0) {
        if (menuMode === "multiple") {
          menus = _react["default"].createElement(_Menus["default"], (0, _extends2["default"])({}, this.props, {
            value: this.state.value,
            activeValue: this.state.activeValue,
            onSelect: this.handleMenuSelect,
            visible: this.state.popupVisible
          }));
        } else if (menuMode === "single") {
          menus = _react["default"].createElement(_MenusSingle["default"], (0, _extends2["default"])({}, this.props, {
            isTabSelected: this.state.isTabSelected,
            value: this.state.value,
            activeValue: this.state.activeValue,
            onSelect: this.handleMenuSelect,
            visible: this.state.popupVisible,
            locale: locale,
            singleMenuStyle: singleMenuStyle,
            singleMenuItemStyle: singleMenuItemStyle
          }));
        } else {
          throw new Error('please use correct mode for menu ex "single" and "multiple"');
        }
      } else {
        emptyMenuClassName = " ".concat(prefixCls, "-menus-empty");
      }

      return _react["default"].createElement(_trigger["default"], (0, _extends2["default"])({
        ref: this.saveTrigger
      }, restProps, {
        options: options,
        disabled: disabled,
        popupPlacement: popupPlacement,
        builtinPlacements: builtinPlacements,
        popupTransitionName: transitionName,
        action: disabled ? [] : ['click'],
        popupVisible: disabled ? false : this.state.popupVisible,
        onPopupVisibleChange: this.handlePopupVisibleChange,
        prefixCls: "".concat(prefixCls, "-menus"),
        popupClassName: popupClassName + emptyMenuClassName,
        popup: menus
      }), (0, _react.cloneElement)(children, {
        onKeyDown: this.handleKeyDown,
        tabIndex: disabled ? undefined : 0
      }));
    }
  }]);
  return Cascader;
}(_react.Component);

exports["default"] = Cascader;
(0, _defineProperty2["default"])(Cascader, "defaultProps", {
  options: [],
  onChange: function onChange() {},
  onPopupVisibleChange: function onPopupVisibleChange() {},
  disabled: false,
  transitionName: '',
  prefixCls: 'rc-cascader',
  popupClassName: '',
  popupPlacement: 'bottomLeft',
  builtinPlacements: BUILT_IN_PLACEMENTS,
  expandTrigger: 'click',
  expandIcon: _react["default"].createElement(_icon["default"], {
    type: "navigate_next"
  }),
  menuMode: 'multiple',
  locale: _en_US["default"]
});
(0, _defineProperty2["default"])(Cascader, "propTypes", {
  value: _propTypes["default"].array,
  defaultValue: _propTypes["default"].array,
  options: _propTypes["default"].array.isRequired,
  onChange: _propTypes["default"].func,
  onPopupVisibleChange: _propTypes["default"].func,
  popupVisible: _propTypes["default"].bool,
  disabled: _propTypes["default"].bool,
  transitionName: _propTypes["default"].string,
  popupClassName: _propTypes["default"].string,
  popupPlacement: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  dropdownMenuColumnStyle: _propTypes["default"].object,
  builtinPlacements: _propTypes["default"].object,
  loadData: _propTypes["default"].func,
  changeOnSelect: _propTypes["default"].bool,
  children: _propTypes["default"].node,
  onKeyDown: _propTypes["default"].func,
  expandTrigger: _propTypes["default"].string,
  expandIcon: _propTypes["default"].node,
  menuMode: _propTypes["default"].string,
  locale: _propTypes["default"].object,
  singleMenuStyle: _propTypes["default"].object,
  singleMenuItemStyle: _propTypes["default"].object,
  singlePleaseRender: _propTypes["default"].func,
  singleMenuItemRender: _propTypes["default"].func
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhc2NhZGVyLmpzeCJdLCJuYW1lcyI6WyJCVUlMVF9JTl9QTEFDRU1FTlRTIiwiYm90dG9tTGVmdCIsInBvaW50cyIsIm9mZnNldCIsIm92ZXJmbG93IiwiYWRqdXN0WCIsImFkanVzdFkiLCJ0b3BMZWZ0IiwiYm90dG9tUmlnaHQiLCJ0b3BSaWdodCIsIkNhc2NhZGVyIiwicHJvcHMiLCJwb3B1cFZpc2libGUiLCJzZXRTdGF0ZSIsInN0YXRlIiwidmlzaWJsZSIsImFjdGl2ZVZhbHVlIiwidmFsdWUiLCJvblBvcHVwVmlzaWJsZUNoYW5nZSIsIm9wdGlvbnMiLCJzZXRQcm9wcyIsImUiLCJ0eXBlIiwia2V5Q29kZSIsIktleUNvZGUiLCJFTlRFUiIsIm9uQ2hhbmdlIiwibWFwIiwibyIsInNldFBvcHVwVmlzaWJsZSIsInRhcmdldE9wdGlvbiIsIm1lbnVJbmRleCIsImlzVGFiU2VsZWN0ZWQiLCJ0cmlnZ2VyTm9kZSIsInRyaWdnZXIiLCJnZXRSb290RG9tTm9kZSIsImZvY3VzIiwiY2hhbmdlT25TZWxlY3QiLCJsb2FkRGF0YSIsImV4cGFuZFRyaWdnZXIiLCJkaXNhYmxlZCIsInNsaWNlIiwiYWN0aXZlT3B0aW9ucyIsImdldEFjdGl2ZU9wdGlvbnMiLCJpc0xlYWYiLCJjaGlsZHJlbiIsImhhbmRsZUNoYW5nZSIsIm5ld1N0YXRlIiwibGVuZ3RoIiwib25LZXlEb3duIiwiY3VycmVudExldmVsIiwiY3VycmVudE9wdGlvbnMiLCJnZXRDdXJyZW50TGV2ZWxPcHRpb25zIiwiY3VycmVudEluZGV4IiwiaW5kZXhPZiIsIkRPV04iLCJVUCIsIkxFRlQiLCJSSUdIVCIsIkJBQ0tTUEFDRSIsIkVTQyIsIm5leHRJbmRleCIsInNwbGljZSIsInB1c2giLCJoYW5kbGVNZW51U2VsZWN0Iiwibm9kZSIsImluaXRpYWxWYWx1ZSIsImRlZmF1bHRWYWx1ZSIsIm5leHRQcm9wcyIsIm5ld1ZhbHVlcyIsImdldFBvcHVwRG9tTm9kZSIsInJlc3VsdCIsImxldmVsIiwiZmlsdGVyIiwicHJlZml4Q2xzIiwidHJhbnNpdGlvbk5hbWUiLCJwb3B1cENsYXNzTmFtZSIsImJ1aWx0aW5QbGFjZW1lbnRzIiwicG9wdXBQbGFjZW1lbnQiLCJsb2NhbGUiLCJtZW51TW9kZSIsInNpbmdsZU1lbnVTdHlsZSIsInNpbmdsZU1lbnVJdGVtU3R5bGUiLCJyZXN0UHJvcHMiLCJtZW51cyIsImVtcHR5TWVudUNsYXNzTmFtZSIsIkVycm9yIiwic2F2ZVRyaWdnZXIiLCJoYW5kbGVQb3B1cFZpc2libGVDaGFuZ2UiLCJoYW5kbGVLZXlEb3duIiwidGFiSW5kZXgiLCJ1bmRlZmluZWQiLCJDb21wb25lbnQiLCJleHBhbmRJY29uIiwiTG9jYWxlIiwiUHJvcFR5cGVzIiwiYXJyYXkiLCJpc1JlcXVpcmVkIiwiZnVuYyIsImJvb2wiLCJzdHJpbmciLCJkcm9wZG93bk1lbnVDb2x1bW5TdHlsZSIsIm9iamVjdCIsInNpbmdsZVBsZWFzZVJlbmRlciIsInNpbmdsZU1lbnVJdGVtUmVuZGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxtQkFBbUIsR0FBRztBQUMxQkMsRUFBQUEsVUFBVSxFQUFFO0FBQ1ZDLElBQUFBLE1BQU0sRUFBRSxDQUFDLElBQUQsRUFBTyxJQUFQLENBREU7QUFFVkMsSUFBQUEsTUFBTSxFQUFFLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FGRTtBQUdWQyxJQUFBQSxRQUFRLEVBQUU7QUFDUkMsTUFBQUEsT0FBTyxFQUFFLENBREQ7QUFFUkMsTUFBQUEsT0FBTyxFQUFFO0FBRkQ7QUFIQSxHQURjO0FBUzFCQyxFQUFBQSxPQUFPLEVBQUU7QUFDUEwsSUFBQUEsTUFBTSxFQUFFLENBQUMsSUFBRCxFQUFPLElBQVAsQ0FERDtBQUVQQyxJQUFBQSxNQUFNLEVB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TyxNQXRCVjtBQXVCakJwQixFQUFBQSxtQkFBbUIsRUFBRWEsc0JBQVVPLE1BdkJkO0FBd0JqQkMsRUFBQUEsa0JBQWtCLEVBQUVSLHNCQUFVRyxJQXhCYjtBQXlCakJNLEVBQUFBLG9CQUFvQixFQUFFVCxzQkFBVUc7QUF6QmYsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBjbG9uZUVsZW1lbnQsIENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgYXJyYXlUcmVlRmlsdGVyIGZyb20gJ2FycmF5LXRyZWUtZmlsdGVyJztcbmltcG9ydCBpc0VxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcbmltcG9ydCBUcmlnZ2VyIGZyb20gJy4uL3RyaWdnZXInO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vLi4vaWNvbic7XG5pbXBvcnQgTWVudXMgZnJvbSAnLi9NZW51cyc7XG5pbXBvcnQgTWVudXNTaW5nbGUgZnJvbSAnLi9NZW51c1NpbmdsZSc7XG5pbXBvcnQgS2V5Q29kZSBmcm9tICcuLi8uLi9fdXRpbC9LZXlDb2RlJztcbmltcG9ydCBMb2NhbGUgZnJvbSAnLi9sb2NhbGUvZW5fVVMnO1xuXG5jb25zdCBCVUlMVF9JTl9QTEFDRU1FTlRTID0ge1xuICBib3R0b21MZWZ0OiB7XG4gICAgcG9pbnRzOiBbJ3RsJywgJ2JsJ10sXG4gICAgb2Zmc2V0OiBbMCwgNF0sXG4gICAgb3ZlcmZsb3c6IHtcbiAgICAgIGFkanVzdFg6IDEsXG4gICAgICBhZGp1c3RZOiAxLFxuICAgIH0sXG4gIH0sXG4gIHRvcExlZnQ6IHtcbiAgICBwb2ludHM6IFsnYmwnLCAndGwnXSxcbiAgICBvZmZzZXQ6IFswLCAtNF0sXG4gICAgb3ZlcmZsb3c6IHtcbiAgICAgIGFkanVzdFg6IDEsXG4gICAgICBhZGp1c3RZOiAxLFxuICAgIH0sXG4gIH0sXG4gIGJvdHRvbVJpZ2h0OiB7XG4gICAgcG9pbnRzOiBbJ3RyJywgJ2JyJ10sXG4gICAgb2Zmc2V0OiBbMCwgNF0sXG4gICAgb3ZlcmZsb3c6IHtcbiAgICAgIGFkanVzdFg6IDEsXG4gICAgICBhZGp1c3RZOiAxLFxuICAgIH0sXG4gIH0sXG4gIHRvcFJpZ2h0OiB7XG4gICAgcG9pbnRzOiBbJ2JyJywgJ3RyJ10sXG4gICAgb2Zmc2V0OiBbMCwgLTRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FzY2FkZXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIG9wdGlvbnM6IFtdLFxuICAgIG9uQ2hhbmdlKCkge30sXG4gICAgb25Qb3B1cFZpc2libGVDaGFuZ2UoKSB7fSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgdHJhbnNpdGlvbk5hbWU6ICcnLFxuICAgIHByZWZpeENsczogJ3JjLWNhc2NhZGVyJyxcbiAgICBwb3B1cENsYXNzTmFtZTogJycsXG4gICAgcG9wdXBQbGFjZW1lbnQ6ICdib3R0b21MZWZ0JyxcbiAgICBidWlsdGluUGxhY2VtZW50czogQlVJTFRfSU5fUExBQ0VNRU5UUyxcbiAgICBleHBhbmRUcmlnZ2VyOiAnY2xpY2snLFxuICAgIGV4cGFuZEljb246IDxJY29uIHR5cGU9XCJuYXZpZ2F0ZV9uZXh0XCIgLz4sXG4gICAgbWVudU1vZGU6J211bHRpcGxlJyxcbiAgICBsb2NhbGU6TG9jYWxlLFxuICB9O1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgdmFsdWU6IFByb3BUeXBlcy5hcnJheSxcbiAgICBkZWZhdWx0VmFsdWU6IFByb3BUeXBlcy5hcnJheSxcbiAgICBvcHRpb25zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Qb3B1cFZpc2libGVDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIHBvcHVwVmlzaWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHRyYW5zaXRpb25OYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHBvcHVwQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHBvcHVwUGxhY2VtZW50OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBkcm9wZG93bk1lbnVDb2x1bW5TdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBidWlsdGluUGxhY2VtZW50czogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBsb2FkRGF0YTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY2hhbmdlT25TZWxlY3Q6IFByb3BUeXBlcy5ib29sLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgICBvbktleURvd246IFByb3BUeXBlcy5mdW5jLFxuICAgIGV4cGFuZFRyaWdnZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZXhwYW5kSWNvbjogUHJvcFR5cGVzLm5vZGUsXG4gICAgbWVudU1vZGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgbG9jYWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHNpbmdsZU1lbnVTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBzaW5nbGVNZW51SXRlbVN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHNpbmdsZVBsZWFzZVJlbmRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2luZ2xlTWVudUl0ZW1SZW5kZXI6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGxldCBpbml0aWFsVmFsdWUgPSBbXTtcbiAgICBpZiAoJ3ZhbHVlJyBpbiBwcm9wcykge1xuICAgICAgaW5pdGlhbFZhbHVlID0gcHJvcHMudmFsdWUgfHwgW107XG4gICAgfSBlbHNlIGlmICgnZGVmYXVsdFZhbHVlJyBpbiBwcm9wcykge1xuICAgICAgaW5pdGlhbFZhbHVlID0gcHJvcHMuZGVmYXVsdFZhbHVlIHx8IFtdO1xuICAgIH1cblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBwb3B1cFZpc2libGU6IHByb3BzLnBvcHVwVmlzaWJsZSxcbiAgICAgIGFjdGl2ZVZhbHVlOiBpbml0aWFsVmFsdWUsXG4gICAgICB2YWx1ZTogaW5pdGlhbFZhbHVlLFxuICAgICAgaXNUYWJTZWxlY3RlZDogZmFsc2UsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKCd2YWx1ZScgaW4gbmV4dFByb3BzICYmICFpc0VxdWFsKHRoaXMucHJvcHMudmFsdWUsIG5leHRQcm9wcy52YWx1ZSkpIHtcbiAgICAgIGNvbnN0IG5ld1ZhbHVlcyA9IHtcbiAgICAgICAgdmFsdWU6IG5leHRQcm9wcy52YWx1ZSB8fCBbXSxcbiAgICAgICAgYWN0aXZlVmFsdWU6IG5leHRQcm9wcy52YWx1ZSB8fCBbXSxcbiAgICAgIH07XG4gICAgICAvLyBhbGxvdyBhY3RpdmVWYWx1ZSBkaWZmIGZyb20gdmFsdWVcbiAgICAgIGlmICgnbG9hZERhdGEnIGluIG5leHRQcm9wcykge1xuICAgICAgICBkZWxldGUgbmV3VmFsdWVzLmFjdGl2ZVZhbHVlO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRTdGF0ZShuZXdWYWx1ZXMpO1xuICAgIH1cbiAgICBpZiAoJ3BvcHVwVmlzaWJsZScgaW4gbmV4dFByb3BzKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgcG9wdXBWaXNpYmxlOiBuZXh0UHJvcHMucG9wdXBWaXNpYmxlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0UG9wdXBET01Ob2RlKCkge1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXIuZ2V0UG9wdXBEb21Ob2RlKCk7XG4gIH1cblxuICBnZXRDdXJyZW50TGV2ZWxPcHRpb25zKCkge1xuICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGFjdGl2ZVZhbHVlID0gW10gfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgcmVzdWx0ID0gYXJyYXlUcmVlRmlsdGVyKG9wdGlvbnMsIChvLCBsZXZlbCkgPT4gby52YWx1ZSA9PT0gYWN0aXZlVmFsdWVbbGV2ZWxdKTtcbiAgICBpZiAocmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAyXSkge1xuICAgICAgcmV0dXJuIHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMl0uY2hpbGRyZW47XG4gICAgfVxuICAgIHJldHVybiBbLi4ub3B0aW9uc10uZmlsdGVyKG8gPT4gIW8uZGlzYWJsZWQpO1xuICB9XG5cbiAgZ2V0QWN0aXZlT3B0aW9ucyhhY3RpdmVWYWx1ZSkge1xuICAgIHJldHVybiBhcnJheVRyZWVGaWx0ZXIodGhpcy5wcm9wcy5vcHRpb25zLCAobywgbGV2ZWwpID0+IG8udmFsdWUgPT09IGFjdGl2ZVZhbHVlW2xldmVsXSk7XG4gIH1cblxuICBzZXRQb3B1cFZpc2libGUgPSBwb3B1cFZpc2libGUgPT4ge1xuICAgIGlmICghKCdwb3B1cFZpc2libGUnIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgcG9wdXBWaXNpYmxlIH0pO1xuICAgIH1cbiAgICAvLyBzeW5jIGFjdGl2ZVZhbHVlIHdpdGggdmFsdWUgd2hlbiBwYW5lbCBvcGVuXG4gICAgaWYgKHBvcHVwVmlzaWJsZSAmJiAhdGhpcy5zdGF0ZS52aXNpYmxlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgYWN0aXZlVmFsdWU6IHRoaXMuc3RhdGUudmFsdWUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vblBvcHVwVmlzaWJsZUNoYW5nZShwb3B1cFZpc2libGUpO1xuICB9O1xuICBoYW5kbGVDaGFuZ2UgPSAob3B0aW9ucywgc2V0UHJvcHMsIGUpID0+IHtcbiAgICBpZiAoZS50eXBlICE9PSAna2V5ZG93bicgfHwgZS5rZXlDb2RlID09PSBLZXlDb2RlLkVOVEVSKSB7XG4gICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG9wdGlvbnMubWFwKG8gPT4gby52YWx1ZSksIG9wdGlvbnMpO1xuICAgICAgdGhpcy5zZXRQb3B1cFZpc2libGUoc2V0UHJvcHMudmlzaWJsZSk7XG4gICAgfVxuICB9O1xuICBoYW5kbGVQb3B1cFZpc2libGVDaGFuZ2UgPSBwb3B1cFZpc2libGUgPT4ge1xuICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKHBvcHVwVmlzaWJsZSk7XG4gIH07XG4gIGhhbmRsZU1lbnVTZWxlY3QgPSAodGFyZ2V0T3B0aW9uLCBtZW51SW5kZXgsaXNUYWJTZWxlY3RlZCA9IGZhbHNlLGUpID0+IHtcbiAgICAvLyBLZWVwIGZvY3VzZWQgc3RhdGUgZm9yIGtleWJvYXJkIHN1cHBvcnRcbiAgICBjb25zdCB0cmlnZ2VyTm9kZSA9IHRoaXMudHJpZ2dlci5nZXRSb290RG9tTm9kZSgpO1xuICAgIGlmICh0cmlnZ2VyTm9kZSAmJiB0cmlnZ2VyTm9kZS5mb2N1cykge1xuICAgICAgdHJpZ2dlck5vZGUuZm9jdXMoKTtcbiAgICB9XG4gICAgY29uc3QgeyBjaGFuZ2VPblNlbGVjdCwgbG9hZERhdGEsIGV4cGFuZFRyaWdnZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCF0YXJnZXRPcHRpb24gfHwgdGFyZ2V0T3B0aW9uLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCB7IGFjdGl2ZVZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGFjdGl2ZVZhbHVlID0gYWN0aXZlVmFsdWUuc2xpY2UoMCwgbWVudUluZGV4ICsgMSk7XG4gICAgYWN0aXZlVmFsdWVbbWVudUluZGV4XSA9IHRhcmdldE9wdGlvbi52YWx1ZTtcbiAgICBjb25zdCBhY3RpdmVPcHRpb25zID0gdGhpcy5nZXRBY3RpdmVPcHRpb25zKGFjdGl2ZVZhbHVlKTtcbiAgICBpZiAodGFyZ2V0T3B0aW9uLmlzTGVhZiA9PT0gZmFsc2UgJiYgIXRhcmdldE9wdGlvbi5jaGlsZHJlbiAmJiBsb2FkRGF0YSkge1xuICAgICAgaWYgKGNoYW5nZU9uU2VsZWN0KSB7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKGFjdGl2ZU9wdGlvbnMsIHsgdmlzaWJsZTogdHJ1ZSB9LCBlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBhY3RpdmVWYWx1ZSxpc1RhYlNlbGVjdGVkIH0pO1xuICAgICAgbG9hZERhdGEoYWN0aXZlT3B0aW9ucyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG5ld1N0YXRlID0ge307XG4gICAgaWYgKCF0YXJnZXRPcHRpb24uY2hpbGRyZW4gfHwgIXRhcmdldE9wdGlvbi5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKGFjdGl2ZU9wdGlvbnMsIHsgdmlzaWJsZTogZmFsc2UgfSwgZSk7XG4gICAgICAvLyBzZXQgdmFsdWUgdG8gYWN0aXZlVmFsdWUgd2hlbiBzZWxlY3QgbGVhZiBvcHRpb25cbiAgICAgIG5ld1N0YXRlLnZhbHVlID0gYWN0aXZlVmFsdWU7XG4gICAgICAvLyBhZGQgZS50eXBlIGp1ZGdlbWVudCB0byBwcmV2ZW50IGBvbkNoYW5nZWAgYmVpbmcgdHJpZ2dlcmVkIGJ5IG1vdXNlRW50ZXJcbiAgICB9IGVsc2UgaWYgKGNoYW5nZU9uU2VsZWN0ICYmIChlLnR5cGUgPT09ICdjbGljaycgfHwgZS50eXBlID09PSAna2V5ZG93bicpKSB7XG4gICAgICBpZiAoZXhwYW5kVHJpZ2dlciA9PT0gJ2hvdmVyJykge1xuICAgICAgICB0aGlzLmhhbmRsZUNoYW5nZShhY3RpdmVPcHRpb25zLCB7IHZpc2libGU6IGZhbHNlIH0sIGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoYWN0aXZlT3B0aW9ucywgeyB2aXNpYmxlOiB0cnVlIH0sIGUpO1xuICAgICAgfVxuICAgICAgLy8gc2V0IHZhbHVlIHRvIGFjdGl2ZVZhbHVlIG9uIGV2ZXJ5IHNlbGVjdFxuICAgICAgbmV3U3RhdGUudmFsdWUgPSBhY3RpdmVWYWx1ZTtcbiAgICB9XG4gICAgbmV3U3RhdGUuYWN0aXZlVmFsdWUgPSBhY3RpdmVWYWx1ZTtcbiAgICAvLyAgbm90IGNoYW5nZSB0aGUgdmFsdWUgYnkga2V5Ym9hcmRcbiAgICBpZiAoJ3ZhbHVlJyBpbiB0aGlzLnByb3BzIHx8IChlLnR5cGUgPT09ICdrZXlkb3duJyAmJiBlLmtleUNvZGUgIT09IEtleUNvZGUuRU5URVIpKSB7XG4gICAgICBkZWxldGUgbmV3U3RhdGUudmFsdWU7XG4gICAgfVxuICAgIG5ld1N0YXRlLmlzVGFiU2VsZWN0ZWQgPSBpc1RhYlNlbGVjdGVkXG4gICAgdGhpcy5zZXRTdGF0ZShuZXdTdGF0ZSk7XG4gIH07XG4gIGhhbmRsZUtleURvd24gPSBlID0+IHtcbiAgICBjb25zdCB7IGNoaWxkcmVuIH0gPSB0aGlzLnByb3BzO1xuICAgIC8vIERvbid0IGJpbmQga2V5Ym9hcmQgc3VwcG9ydCB3aGVuIGNoaWxkcmVuIHNwZWNpZnkgdGhlIG9uS2V5RG93blxuICAgIGlmIChjaGlsZHJlbiAmJiBjaGlsZHJlbi5wcm9wcy5vbktleURvd24pIHtcbiAgICAgIGNoaWxkcmVuLnByb3BzLm9uS2V5RG93bihlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYWN0aXZlVmFsdWUgPSBbLi4udGhpcy5zdGF0ZS5hY3RpdmVWYWx1ZV07XG4gICAgY29uc3QgY3VycmVudExldmVsID0gYWN0aXZlVmFsdWUubGVuZ3RoIC0gMSA8IDAgPyAwIDogYWN0aXZlVmFsdWUubGVuZ3RoIC0gMTtcbiAgICBjb25zdCBjdXJyZW50T3B0aW9ucyA9IHRoaXMuZ2V0Q3VycmVudExldmVsT3B0aW9ucygpO1xuICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IGN1cnJlbnRPcHRpb25zLm1hcChvID0+IG8udmFsdWUpLmluZGV4T2YoYWN0aXZlVmFsdWVbY3VycmVudExldmVsXSk7XG4gICAgaWYgKFxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkRPV04gJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5VUCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkxFRlQgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5SSUdIVCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkVOVEVSICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuQkFDS1NQQUNFICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuRVNDXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFByZXNzIGFueSBrZXlzIGFib3ZlIHRvIHJlb3BlbiBtZW51XG4gICAgaWYgKFxuICAgICAgIXRoaXMuc3RhdGUucG9wdXBWaXNpYmxlICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuQkFDS1NQQUNFICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuTEVGVCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLlJJR0hUICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuRVNDXG4gICAgKSB7XG4gICAgICB0aGlzLnNldFBvcHVwVmlzaWJsZSh0cnVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5ET1dOIHx8IGUua2V5Q29kZSA9PT0gS2V5Q29kZS5VUCkge1xuICAgICAgbGV0IG5leHRJbmRleCA9IGN1cnJlbnRJbmRleDtcbiAgICAgIGlmIChuZXh0SW5kZXggIT09IC0xKSB7XG4gICAgICAgIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuRE9XTikge1xuICAgICAgICAgIG5leHRJbmRleCArPSAxO1xuICAgICAgICAgIG5leHRJbmRleCA9IG5leHRJbmRleCA+PSBjdXJyZW50T3B0aW9ucy5sZW5ndGggPyAwIDogbmV4dEluZGV4O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5leHRJbmRleCAtPSAxO1xuICAgICAgICAgIG5leHRJbmRleCA9IG5leHRJbmRleCA8IDAgPyBjdXJyZW50T3B0aW9ucy5sZW5ndGggLSAxIDogbmV4dEluZGV4O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXh0SW5kZXggPSAwO1xuICAgICAgfVxuICAgICAgYWN0aXZlVmFsdWVbY3VycmVudExldmVsXSA9IGN1cnJlbnRPcHRpb25zW25leHRJbmRleF0udmFsdWU7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuTEVGVCB8fCBlLmtleUNvZGUgPT09IEtleUNvZGUuQkFDS1NQQUNFKSB7XG4gICAgICBhY3RpdmVWYWx1ZS5zcGxpY2UoYWN0aXZlVmFsdWUubGVuZ3RoIC0gMSwgMSk7XG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuUklHSFQpIHtcbiAgICAgIGlmIChjdXJyZW50T3B0aW9uc1tjdXJyZW50SW5kZXhdICYmIGN1cnJlbnRPcHRpb25zW2N1cnJlbnRJbmRleF0uY2hpbGRyZW4pIHtcbiAgICAgICAgYWN0aXZlVmFsdWUucHVzaChjdXJyZW50T3B0aW9uc1tjdXJyZW50SW5kZXhdLmNoaWxkcmVuWzBdLnZhbHVlKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5FU0MpIHtcbiAgICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKGZhbHNlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFhY3RpdmVWYWx1ZSB8fCBhY3RpdmVWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKGZhbHNlKTtcbiAgICB9XG4gICAgY29uc3QgYWN0aXZlT3B0aW9ucyA9IHRoaXMuZ2V0QWN0aXZlT3B0aW9ucyhhY3RpdmVWYWx1ZSk7XG4gICAgY29uc3QgdGFyZ2V0T3B0aW9uID0gYWN0aXZlT3B0aW9uc1thY3RpdmVPcHRpb25zLmxlbmd0aCAtIDFdO1xuICAgIHRoaXMuaGFuZGxlTWVudVNlbGVjdCh0YXJnZXRPcHRpb24sIGFjdGl2ZU9wdGlvbnMubGVuZ3RoIC0gMSwgZmFsc2UgLCBlKTtcblxuICAgIGlmICh0aGlzLnByb3BzLm9uS2V5RG93bikge1xuICAgICAgdGhpcy5wcm9wcy5vbktleURvd24oZSk7XG4gICAgfVxuICB9O1xuXG4gIHNhdmVUcmlnZ2VyID0gbm9kZSA9PiB7XG4gICAgdGhpcy50cmlnZ2VyID0gbm9kZTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgdHJhbnNpdGlvbk5hbWUsXG4gICAgICBwb3B1cENsYXNzTmFtZSxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIGJ1aWx0aW5QbGFjZW1lbnRzLFxuICAgICAgcG9wdXBQbGFjZW1lbnQsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIGxvY2FsZSxcbiAgICAgIG1lbnVNb2RlLFxuICAgICAgc2luZ2xlTWVudVN0eWxlLFxuICAgICAgc2luZ2xlTWVudUl0ZW1TdHlsZSxcbiAgICAgIC4uLnJlc3RQcm9wc1xuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIC8vIERpZCBub3Qgc2hvdyBwb3B1cCB3aGVuIHRoZXJlIGlzIG5vIG9wdGlvbnNcbiAgICBsZXQgbWVudXMgPSA8ZGl2IC8+O1xuICAgIGxldCBlbXB0eU1lbnVDbGFzc05hbWUgPSAnJztcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGlmKCBtZW51TW9kZSA9PT0gXCJtdWx0aXBsZVwiKSB7XG4gICAgICAgIG1lbnVzID0gKFxuICAgICAgICAgIDxNZW51c1xuICAgICAgICAgICAgey4uLnRoaXMucHJvcHN9XG4gICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS52YWx1ZX1cbiAgICAgICAgICAgIGFjdGl2ZVZhbHVlPXt0aGlzLnN0YXRlLmFjdGl2ZVZhbHVlfVxuICAgICAgICAgICAgb25TZWxlY3Q9e3RoaXMuaGFuZGxlTWVudVNlbGVjdH1cbiAgICAgICAgICAgIHZpc2libGU9e3RoaXMuc3RhdGUucG9wdXBWaXNpYmxlfVxuICAgICAgICAgIC8+KVxuICAgICAgfWVsc2UgaWYgKG1lbnVNb2RlID09PSBcInNpbmdsZVwiICl7XG4gICAgICAgIG1lbnVzID0gKFxuICAgICAgICAgIDxNZW51c1NpbmdsZVxuICAgICAgICAgICAgey4uLnRoaXMucHJvcHN9XG4gICAgICAgICAgICBpc1RhYlNlbGVjdGVkPXt0aGlzLnN0YXRlLmlzVGFiU2VsZWN0ZWR9XG4gICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS52YWx1ZX1cbiAgICAgICAgICAgIGFjdGl2ZVZhbHVlPXt0aGlzLnN0YXRlLmFjdGl2ZVZhbHVlfVxuICAgICAgICAgICAgb25TZWxlY3Q9e3RoaXMuaGFuZGxlTWVudVNlbGVjdH1cbiAgICAgICAgICAgIHZpc2libGU9e3RoaXMuc3RhdGUucG9wdXBWaXNpYmxlfVxuICAgICAgICAgICAgbG9jYWxlPXtsb2NhbGV9XG4gICAgICAgICAgICBzaW5nbGVNZW51U3R5bGU9e3NpbmdsZU1lbnVTdHlsZX1cbiAgICAgICAgICAgIHNpbmdsZU1lbnVJdGVtU3R5bGU9e3NpbmdsZU1lbnVJdGVtU3R5bGV9XG4gICAgICAgICAgLz4pXG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcigncGxlYXNlIHVzZSBjb3JyZWN0IG1vZGUgZm9yIG1lbnUgZXggXCJzaW5nbGVcIiBhbmQgXCJtdWx0aXBsZVwiJylcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZW1wdHlNZW51Q2xhc3NOYW1lID0gYCAke3ByZWZpeENsc30tbWVudXMtZW1wdHlgO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPFRyaWdnZXJcbiAgICAgICAgcmVmPXt0aGlzLnNhdmVUcmlnZ2VyfVxuICAgICAgICB7Li4ucmVzdFByb3BzfVxuICAgICAgICBvcHRpb25zPXtvcHRpb25zfVxuICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgIHBvcHVwUGxhY2VtZW50PXtwb3B1cFBsYWNlbWVudH1cbiAgICAgICAgYnVpbHRpblBsYWNlbWVudHM9e2J1aWx0aW5QbGFjZW1lbnRzfVxuICAgICAgICBwb3B1cFRyYW5zaXRpb25OYW1lPXt0cmFuc2l0aW9uTmFtZX1cbiAgICAgICAgYWN0aW9uPXtkaXNhYmxlZCA/IFtdIDogWydjbGljayddfVxuICAgICAgICBwb3B1cFZpc2libGU9e2Rpc2FibGVkID8gZmFsc2UgOiB0aGlzLnN0YXRlLnBvcHVwVmlzaWJsZX1cbiAgICAgICAgb25Qb3B1cFZpc2libGVDaGFuZ2U9e3RoaXMuaGFuZGxlUG9wdXBWaXNpYmxlQ2hhbmdlfVxuICAgICAgICBwcmVmaXhDbHM9e2Ake3ByZWZpeENsc30tbWVudXNgfVxuICAgICAgICBwb3B1cENsYXNzTmFtZT17cG9wdXBDbGFzc05hbWUgKyBlbXB0eU1lbnVDbGFzc05hbWV9XG4gICAgICAgIHBvcHVwPXttZW51c31cbiAgICAgID5cbiAgICAgICAge2Nsb25lRWxlbWVudChjaGlsZHJlbiwge1xuICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXlEb3duLFxuICAgICAgICAgIHRhYkluZGV4OiBkaXNhYmxlZCA/IHVuZGVmaW5lZCA6IDAsXG4gICAgICAgIH0pfVxuICAgICAgPC9UcmlnZ2VyPlxuICAgICk7XG4gIH1cbn1cbiJdfQ==