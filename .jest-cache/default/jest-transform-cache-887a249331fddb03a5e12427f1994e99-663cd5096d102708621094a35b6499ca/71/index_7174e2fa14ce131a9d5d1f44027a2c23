76a8bd1819215deb9626d993aa3af99a
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireDefault(require("react"));

var _noop = _interopRequireDefault(require("lodash/noop"));

var _isString = _interopRequireDefault(require("lodash/isString"));

var _icon = _interopRequireDefault(require("../icon"));

var _notification = _interopRequireDefault(require("../rc-components/notification"));

var _util = require("./util");

var _configure = require("../configure");

var defaultDuration = 3;
var defaultTop = 24;
var defaultBottom = 24;
var messageInstance;
var key = 1;
var customizePrefixCls;
var transitionName = 'move-up';
var defaultPlacement = 'leftBottom';
var getContainer;

function getCustomizePrefixCls() {
  return (0, _configure.getPrefixCls)('message', customizePrefixCls);
}

function getMessageInstance(placement, callback) {
  if (messageInstance) {
    callback(messageInstance);
    return;
  }

  _notification["default"].newInstance({
    prefixCls: getCustomizePrefixCls(),
    style: (0, _util.getPlacementStyle)(placement, defaultTop, defaultBottom),
    transitionName: (0, _util.getPlacementTransitionName)(placement, transitionName),
    getContainer: getContainer
  }, function (instance) {
    if (messageInstance) {
      callback(messageInstance);
      return;
    }

    messageInstance = instance;
    callback(instance);
  });
}

function notice(content) {
  var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultDuration;
  var type = arguments.length > 2 ? arguments[2] : undefined;
  var onClose = arguments.length > 3 ? arguments[3] : undefined;
  var placement = arguments.length > 4 ? arguments[4] : undefined;
  var iconType = {
    info: 'info',
    success: 'check_circle',
    error: 'error',
    warning: 'warning',
    loading: 'loading'
  }[type];

  if ((0, _isString["default"])(onClose)) {
    placement = onClose;
    onClose = _noop["default"];
  }

  if (typeof duration === 'function') {
    onClose = duration;
    duration = defaultDuration;
  } else if ((0, _isString["default"])(duration)) {
    placement = duration;
  }

  var target = key++;
  var prefixCls = getCustomizePrefixCls();
  getMessageInstance(placement || defaultPlacement, function (instance) {
    instance.notice({
      key: target,
      duration: duration,
      style: {},
      content: _react["default"].createElement("div", {
        className: "".concat(prefixCls, "-custom-content ").concat(prefixCls, "-").concat(type)
      }, _react["default"].createElement(_icon["default"], {
        type: iconType
      }), _react["default"].createElement("span", null, content)),
      onClose: onClose
    });
  });
  return function () {
    if (messageInstance) {
      messageInstance.removeNotice(target);
    }
  };
}

var _default = {
  info: function info(content, duration, onClose, placement) {
    return notice(content, duration, 'info', onClose, placement);
  },
  success: function success(content, duration, onClose, placement) {
    return notice(content, duration, 'success', onClose, placement);
  },
  error: function error(content, duration, onClose, placement) {
    return notice(content, duration, 'error', onClose, placement);
  },
  // Departed usage, please use warning()
  warn: function warn(content, duration, onClose, placement) {
    return notice(content, duration, 'warning', onClose, placement);
  },
  warning: function warning(content, duration, onClose, placement) {
    return notice(content, duration, 'warning', onClose, placement);
  },
  loading: function loading(content, duration, onClose, placement) {
    return notice(content, duration, 'loading', onClose, placement);
  },
  config: function config(options) {
    if (options.top !== undefined) {
      defaultTop = options.top;
      messageInstance = null; // delete messageInstance for new defaultTop
    }

    if (options.bottom !== undefined) {
      defaultBottom = options.bottom;
      messageInstance = null; // delete messageInstance for new defaultBottom
    }

    if (options.duration !== undefined) {
      defaultDuration = options.duration;
    }

    if (options.prefixCls !== undefined) {
      customizePrefixCls = options.prefixCls;
    }

    if (options.getContainer !== undefined) {
      getContainer = options.getContainer;
    }

    if (options.transitionName !== undefined) {
      transitionName = options.transitionName;
      messageInstance = null; // delete messageInstance for new transitionName
    }

    if (options.placement !== undefined) {
      defaultPlacement = options.placement;
    }
  },
  destroy: function destroy() {
    if (messageInstance) {
      messageInstance.destroy();
      messageInstance = null;
    }
  }
};
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lc3NhZ2UvaW5kZXguanMiXSwibmFtZXMiOlsiZGVmYXVsdER1cmF0aW9uIiwiZGVmYXVsdFRvcCIsImRlZmF1bHRCb3R0b20iLCJrZXkiLCJ0cmFuc2l0aW9uTmFtZSIsImRlZmF1bHRQbGFjZW1lbnQiLCJjYWxsYmFjayIsIk5vdGlmaWNhdGlvbiIsInByZWZpeENscyIsImdldEN1c3RvbWl6ZVByZWZpeENscyIsInN0eWxlIiwiZ2V0Q29udGFpbmVyIiwibWVzc2FnZUluc3RhbmNlIiwiZHVyYXRpb24iLCJ0eXBlIiwib25DbG9zZSIsInBsYWNlbWVudCIsImljb25UeXBlIiwiaW5mbyIsInN1Y2Nlc3MiLCJlcnJvciIsIndhcm5pbmciLCJsb2FkaW5nIiwibm9vcCIsInRhcmdldCIsImdldE1lc3NhZ2VJbnN0YW5jZSIsImluc3RhbmNlIiwiY29udGVudCIsImNsYXNzTmFtZSIsIkljb24iLCJSZWFjdCIsIm5vdGljZSIsIndhcm4iLCJjb25maWciLCJvcHRpb25zIiwiY3VzdG9taXplUHJlZml4Q2xzIiwiZGVzdHJveSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxLQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxTQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsaUJBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsS0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsYUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLCtCQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLEtBQUEsR0FBQSxPQUFBLENBQUEsUUFBQSxDQUFBOztBQUNBLElBQUEsVUFBQSxHQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUE7O0FBQ0EsSUFBSUEsZUFBZSxH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QUNIO0FBQ0o7QUFuRFUsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgbm9vcCBmcm9tICdsb2Rhc2gvbm9vcCc7XG5pbXBvcnQgaXNTdHJpbmcgZnJvbSAnbG9kYXNoL2lzU3RyaW5nJztcbmltcG9ydCBJY29uIGZyb20gJy4uL2ljb24nO1xuaW1wb3J0IE5vdGlmaWNhdGlvbiBmcm9tICcuLi9yYy1jb21wb25lbnRzL25vdGlmaWNhdGlvbic7XG5pbXBvcnQgeyBnZXRQbGFjZW1lbnRTdHlsZSwgZ2V0UGxhY2VtZW50VHJhbnNpdGlvbk5hbWUgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcbmxldCBkZWZhdWx0RHVyYXRpb24gPSAzO1xubGV0IGRlZmF1bHRUb3AgPSAyNDtcbmxldCBkZWZhdWx0Qm90dG9tID0gMjQ7XG5sZXQgbWVzc2FnZUluc3RhbmNlO1xubGV0IGtleSA9IDE7XG5sZXQgY3VzdG9taXplUHJlZml4Q2xzO1xubGV0IHRyYW5zaXRpb25OYW1lID0gJ21vdmUtdXAnO1xubGV0IGRlZmF1bHRQbGFjZW1lbnQgPSAnbGVmdEJvdHRvbSc7XG5sZXQgZ2V0Q29udGFpbmVyO1xuZnVuY3Rpb24gZ2V0Q3VzdG9taXplUHJlZml4Q2xzKCkge1xuICAgIHJldHVybiBnZXRQcmVmaXhDbHMoJ21lc3NhZ2UnLCBjdXN0b21pemVQcmVmaXhDbHMpO1xufVxuZnVuY3Rpb24gZ2V0TWVzc2FnZUluc3RhbmNlKHBsYWNlbWVudCwgY2FsbGJhY2spIHtcbiAgICBpZiAobWVzc2FnZUluc3RhbmNlKSB7XG4gICAgICAgIGNhbGxiYWNrKG1lc3NhZ2VJbnN0YW5jZSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgTm90aWZpY2F0aW9uLm5ld0luc3RhbmNlKHtcbiAgICAgICAgcHJlZml4Q2xzOiBnZXRDdXN0b21pemVQcmVmaXhDbHMoKSxcbiAgICAgICAgc3R5bGU6IGdldFBsYWNlbWVudFN0eWxlKHBsYWNlbWVudCwgZGVmYXVsdFRvcCwgZGVmYXVsdEJvdHRvbSksXG4gICAgICAgIHRyYW5zaXRpb25OYW1lOiBnZXRQbGFjZW1lbnRUcmFuc2l0aW9uTmFtZShwbGFjZW1lbnQsIHRyYW5zaXRpb25OYW1lKSxcbiAgICAgICAgZ2V0Q29udGFpbmVyLFxuICAgIH0sIChpbnN0YW5jZSkgPT4ge1xuICAgICAgICBpZiAobWVzc2FnZUluc3RhbmNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhtZXNzYWdlSW5zdGFuY2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IGluc3RhbmNlO1xuICAgICAgICBjYWxsYmFjayhpbnN0YW5jZSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBub3RpY2UoY29udGVudCwgZHVyYXRpb24gPSBkZWZhdWx0RHVyYXRpb24sIHR5cGUsIG9uQ2xvc2UsIHBsYWNlbWVudCkge1xuICAgIGNvbnN0IGljb25UeXBlID0ge1xuICAgICAgICBpbmZvOiAnaW5mbycsXG4gICAgICAgIHN1Y2Nlc3M6ICdjaGVja19jaXJjbGUnLFxuICAgICAgICBlcnJvcjogJ2Vycm9yJyxcbiAgICAgICAgd2FybmluZzogJ3dhcm5pbmcnLFxuICAgICAgICBsb2FkaW5nOiAnbG9hZGluZycsXG4gICAgfVt0eXBlXTtcbiAgICBpZiAoaXNTdHJpbmcob25DbG9zZSkpIHtcbiAgICAgICAgcGxhY2VtZW50ID0gb25DbG9zZTtcbiAgICAgICAgb25DbG9zZSA9IG5vb3A7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgZHVyYXRpb24gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgb25DbG9zZSA9IGR1cmF0aW9uO1xuICAgICAgICBkdXJhdGlvbiA9IGRlZmF1bHREdXJhdGlvbjtcbiAgICB9XG4gICAgZWxzZSBpZiAoaXNTdHJpbmcoZHVyYXRpb24pKSB7XG4gICAgICAgIHBsYWNlbWVudCA9IGR1cmF0aW9uO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXQgPSBrZXkrKztcbiAgICBjb25zdCBwcmVmaXhDbHMgPSBnZXRDdXN0b21pemVQcmVmaXhDbHMoKTtcbiAgICBnZXRNZXNzYWdlSW5zdGFuY2UocGxhY2VtZW50IHx8IGRlZmF1bHRQbGFjZW1lbnQsIGluc3RhbmNlID0+IHtcbiAgICAgICAgaW5zdGFuY2Uubm90aWNlKHtcbiAgICAgICAgICAgIGtleTogdGFyZ2V0LFxuICAgICAgICAgICAgZHVyYXRpb24sXG4gICAgICAgICAgICBzdHlsZToge30sXG4gICAgICAgICAgICBjb250ZW50OiAoUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogYCR7cHJlZml4Q2xzfS1jdXN0b20tY29udGVudCAke3ByZWZpeENsc30tJHt0eXBlfWAgfSxcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEljb24sIHsgdHlwZTogaWNvblR5cGUgfSksXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgbnVsbCwgY29udGVudCkpKSxcbiAgICAgICAgICAgIG9uQ2xvc2UsXG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGlmIChtZXNzYWdlSW5zdGFuY2UpIHtcbiAgICAgICAgICAgIG1lc3NhZ2VJbnN0YW5jZS5yZW1vdmVOb3RpY2UodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH07XG59XG5leHBvcnQgZGVmYXVsdCB7XG4gICAgaW5mbyhjb250ZW50LCBkdXJhdGlvbiwgb25DbG9zZSwgcGxhY2VtZW50KSB7XG4gICAgICAgIHJldHVybiBub3RpY2UoY29udGVudCwgZHVyYXRpb24sICdpbmZvJywgb25DbG9zZSwgcGxhY2VtZW50KTtcbiAgICB9LFxuICAgIHN1Y2Nlc3MoY29udGVudCwgZHVyYXRpb24sIG9uQ2xvc2UsIHBsYWNlbWVudCkge1xuICAgICAgICByZXR1cm4gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uLCAnc3VjY2VzcycsIG9uQ2xvc2UsIHBsYWNlbWVudCk7XG4gICAgfSxcbiAgICBlcnJvcihjb250ZW50LCBkdXJhdGlvbiwgb25DbG9zZSwgcGxhY2VtZW50KSB7XG4gICAgICAgIHJldHVybiBub3RpY2UoY29udGVudCwgZHVyYXRpb24sICdlcnJvcicsIG9uQ2xvc2UsIHBsYWNlbWVudCk7XG4gICAgfSxcbiAgICAvLyBEZXBhcnRlZCB1c2FnZSwgcGxlYXNlIHVzZSB3YXJuaW5nKClcbiAgICB3YXJuKGNvbnRlbnQsIGR1cmF0aW9uLCBvbkNsb3NlLCBwbGFjZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG5vdGljZShjb250ZW50LCBkdXJhdGlvbiwgJ3dhcm5pbmcnLCBvbkNsb3NlLCBwbGFjZW1lbnQpO1xuICAgIH0sXG4gICAgd2FybmluZyhjb250ZW50LCBkdXJhdGlvbiwgb25DbG9zZSwgcGxhY2VtZW50KSB7XG4gICAgICAgIHJldHVybiBub3RpY2UoY29udGVudCwgZHVyYXRpb24sICd3YXJuaW5nJywgb25DbG9zZSwgcGxhY2VtZW50KTtcbiAgICB9LFxuICAgIGxvYWRpbmcoY29udGVudCwgZHVyYXRpb24sIG9uQ2xvc2UsIHBsYWNlbWVudCkge1xuICAgICAgICByZXR1cm4gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uLCAnbG9hZGluZycsIG9uQ2xvc2UsIHBsYWNlbWVudCk7XG4gICAgfSxcbiAgICBjb25maWcob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZGVmYXVsdFRvcCA9IG9wdGlvbnMudG9wO1xuICAgICAgICAgICAgbWVzc2FnZUluc3RhbmNlID0gbnVsbDsgLy8gZGVsZXRlIG1lc3NhZ2VJbnN0YW5jZSBmb3IgbmV3IGRlZmF1bHRUb3BcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5ib3R0b20gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZGVmYXVsdEJvdHRvbSA9IG9wdGlvbnMuYm90dG9tO1xuICAgICAgICAgICAgbWVzc2FnZUluc3RhbmNlID0gbnVsbDsgLy8gZGVsZXRlIG1lc3NhZ2VJbnN0YW5jZSBmb3IgbmV3IGRlZmF1bHRCb3R0b21cbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5kdXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkZWZhdWx0RHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnByZWZpeENscyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjdXN0b21pemVQcmVmaXhDbHMgPSBvcHRpb25zLnByZWZpeENscztcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5nZXRDb250YWluZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZ2V0Q29udGFpbmVyID0gb3B0aW9ucy5nZXRDb250YWluZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMudHJhbnNpdGlvbk5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdHJhbnNpdGlvbk5hbWUgPSBvcHRpb25zLnRyYW5zaXRpb25OYW1lO1xuICAgICAgICAgICAgbWVzc2FnZUluc3RhbmNlID0gbnVsbDsgLy8gZGVsZXRlIG1lc3NhZ2VJbnN0YW5jZSBmb3IgbmV3IHRyYW5zaXRpb25OYW1lXG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMucGxhY2VtZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGRlZmF1bHRQbGFjZW1lbnQgPSBvcHRpb25zLnBsYWNlbWVudDtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgaWYgKG1lc3NhZ2VJbnN0YW5jZSkge1xuICAgICAgICAgICAgbWVzc2FnZUluc3RhbmNlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxufTtcbiJdfQ==