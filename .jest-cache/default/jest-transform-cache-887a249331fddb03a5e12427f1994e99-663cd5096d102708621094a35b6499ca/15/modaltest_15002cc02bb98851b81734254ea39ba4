cd21c1e4dc92777ed9615c79ae9a4356
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _react = _interopRequireDefault(require("react"));

var _ = _interopRequireDefault(require(".."));

describe('modal triggers callbacks correctly', function () {
  var errorSpy = jest.spyOn(console, 'error').mockImplementation(function () {});
  beforeEach(function () {
    jest.useFakeTimers();
  });
  afterEach(function () {
    errorSpy.mockReset();
    document.body.innerHTML = '';
    jest.useRealTimers();
  });
  afterAll(function () {
    errorSpy.mockRestore();
  });

  var _pro = function _pro(className) {
    return document.body.querySelectorAll(className);
  };

  function open(args) {
    _["default"].open((0, _objectSpread2["default"])({
      title: 'Modal Test',
      destroyOnClose: true,
      children: _react["default"].createElement("div", null, _react["default"].createElement("p", null, "Some contents..."), _react["default"].createElement("p", null, "Some contents..."), _react["default"].createElement("p", null, "Some contents..."))
    }, args));
  }

  it('should not render title when title not defined', function () {
    // first modal
    _["default"].confirm({
      children: 'test descriptions'
    });

    expect(_pro('.c7n-pro-modal-footer')).toHaveLength(1);
    expect(document.querySelector('.c7n-pro-confirm-title')).toBe(null);
  });
  it('should allow Modal without onCancel been set', function () {
    // second modal
    var key = _["default"].key();

    open({
      key: key
    });

    _pro('.c7n-pro-modal-footer')[1].querySelector('.c7n-pro-btn-default').click();

    expect(errorSpy).not.toHaveBeenCalled();
  });
  it('should allow Modal.comfirm without onOk been set', function () {
    // third modal
    var key = _["default"].key();

    open({
      key: key
    });

    _pro('.c7n-pro-modal-footer')[2].querySelector('.c7n-pro-btn-primary').click();

    expect(errorSpy).not.toHaveBeenCalled();
  });
  it('trigger onCancel once when click on cancel button', function () {
    var onCancel = jest.fn();
    var onOk = jest.fn();

    var key = _["default"].key(); // forth modal


    open({
      key: key,
      onCancel: onCancel,
      onOk: onOk
    });

    _pro('.c7n-pro-modal-footer')[3].querySelector('.c7n-pro-btn-default').click();

    expect(onCancel.mock.calls.length).toBe(1);
    expect(onOk.mock.calls.length).toBe(0);
  });
  it('trigger onOk once when click on ok button', function () {
    var onCancel = jest.fn();
    var onOk = jest.fn();

    var key = _["default"].key(); // fifth modal


    open({
      key: key,
      onCancel: onCancel,
      onOk: onOk
    });

    _pro('.c7n-pro-modal-footer')[4].querySelector('.c7n-pro-btn-primary').click();

    expect(onCancel.mock.calls.length).toBe(0);
    expect(onOk.mock.calls.length).toBe(1);
  });
  it('only ok when the okCancel false', function () {
    open({
      okCancel: false
    });
    expect(_pro('.c7n-pro-modal-footer')[5].querySelectorAll('.c7n-pro-btn')).toHaveLength(1);
    expect(_pro('.c7n-pro-modal-footer')[5].querySelectorAll('.c7n-pro-btn')[0].innerHTML).toContain('确定');
  });
  it('should render info modal correctly ', function () {
    ['success', 'warning', 'error'].forEach(function (type) {
      _["default"][type]({
        title: 'title',
        children: 'content'
      });

      expect(_pro(".c7n-pro-confirm-".concat(type))).toHaveLength(1);
    });
  });
  it('should has maskClassName when set maskClassName', function () {
    ['success', 'warning', 'error', 'open', 'confirm', 'info'].forEach(function (type) {
      var maskClassName = 'maskClassName';

      _["default"][type]({
        title: 'title',
        children: 'content',
        maskClassName: maskClassName
      });

      expect(_pro(".c7n-pro-mask.c7n-pro-mask-wrapper.".concat(maskClassName))).toHaveLength(1);
    });
  });
  it('should has maskStyle when set maskStyle', function () {
    ['success', 'warning', 'error', 'open', 'confirm', 'info'].forEach(function (type) {
      var maskStyle = {
        background: 'red'
      };

      _["default"][type]({
        title: 'title',
        children: 'content',
        maskStyle: maskStyle
      });

      expect(_pro(".c7n-pro-mask.c7n-pro-mask-wrapper")).toHaveLength(1);
      expect(_pro(".c7n-pro-mask.c7n-pro-mask-wrapper")[0].style.background).toBe('red');
    });
  });
  it('should not render mask when set mask to false', function () {
    ['success', 'warning', 'error', 'open', 'confirm', 'info'].forEach(function (type) {
      var mask = false;

      _["default"][type]({
        title: 'title',
        children: 'content',
        mask: mask
      });

      jest.runAllTimers();
      expect(_pro(".c7n-pro-mask.c7n-pro-mask-wrapper")).toHaveLength(0);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGFsLnRlc3QuanMiXSwibmFtZXMiOlsiZGVzY3JpYmUiLCJlcnJvclNweSIsImplc3QiLCJzcHlPbiIsImNvbnNvbGUiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJiZWZvcmVFYWNoIiwidXNlRmFrZVRpbWVycyIsImFmdGVyRWFjaCIsIm1vY2tSZXNldCIsImRvY3VtZW50IiwiYm9keSIsImlubmVySFRNTCIsInVzZVJlYWxUaW1lcnMiLCJhZnRlckFsbCIsIm1vY2tSZXN0b3JlIiwiX3BybyIsImNsYXNzTmFtZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcGVuIiwiYXJncyIsIk1vZGFsIiwidGl0bGUiLCJkZXN0cm95T25DbG9zZSIsImNoaWxkcmVuIiwiaXQiLCJjb25maXJtIiwiZXhwZWN0IiwidG9IYXZlTGVuZ3RoIiwicXVlcnlTZWxlY3RvciIsInRvQmUiLCJrZXkiLCJjbGljayIsIm5vdCIsInRvSGF2ZUJlZW5DYWxsZWQiLCJvbkNhbmNlbCIsImZuIiwib25PayIsIm1vY2siLCJjYWxscyIsImxlbmd0aCIsIm9rQ2FuY2VsIiwidG9Db250YWluIiwiZm9yRWFjaCIsInR5cGUiLCJtYXNrQ2xhc3NOYW1lIiwibWFza1N0eWxlIiwiYmFja2dyb3VuZCIsInN0eWxlIiwibWFzayIsInJ1bkFsbFRpbWVycyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUFBLFFBQVEsQ0FBQyxvQ0FBRCxFQUF1QyxZQUFNO0FBQ25ELE1BQU1DLFFBQVEsR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdDLE9BQVgsRUFBb0IsT0FBcEIsRUFBNkJDLGtCQUE3QixDQUFnRCxZQUFNLENBQUcsQ0FBekQsQ0FBakI7QUFFQUMsRUFBQUEsVUFBVSxDQUFDLFlBQU07QUFDZkosSUFBQUEsSUFBSSxDQUFDSyxhQUFMO0FBQ0QsR0FGUyxDQUFWO0FBSUFDLEVBQUFBLFNBQVMsQ0FBQyxZQUFNO0FBQ2RQLElBQUFBLFFBQVEsQ0FBQ1EsU0FBVDtBQUNBQyxJQUFB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QVpDLENBQUY7QUFjRCxDQXBLTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBNb2RhbCBmcm9tICcuLic7XG5cbmRlc2NyaWJlKCdtb2RhbCB0cmlnZ2VycyBjYWxsYmFja3MgY29ycmVjdGx5JywgKCkgPT4ge1xuICBjb25zdCBlcnJvclNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHsgfSk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgZXJyb3JTcHkubW9ja1Jlc2V0KCk7XG4gICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSAnJztcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoKCkgPT4ge1xuICAgIGVycm9yU3B5Lm1vY2tSZXN0b3JlKCk7XG4gIH0pO1xuXG4gIGNvbnN0IF9wcm8gPSBjbGFzc05hbWUgPT4ge1xuICAgIHJldHVybiBkb2N1bWVudC5ib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoY2xhc3NOYW1lKTtcbiAgfTtcblxuICBmdW5jdGlvbiBvcGVuIChhcmdzKSB7XG4gICAgTW9kYWwub3Blbih7XG4gICAgICB0aXRsZTogJ01vZGFsIFRlc3QnLFxuICAgICAgZGVzdHJveU9uQ2xvc2U6IHRydWUsXG4gICAgICBjaGlsZHJlbjogKFxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxwPlNvbWUgY29udGVudHMuLi48L3A+XG4gICAgICAgICAgPHA+U29tZSBjb250ZW50cy4uLjwvcD5cbiAgICAgICAgICA8cD5Tb21lIGNvbnRlbnRzLi4uPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICksXG4gICAgICAuLi5hcmdzLFxuICAgIH0pO1xuICB9XG5cbiAgaXQoJ3Nob3VsZCBub3QgcmVuZGVyIHRpdGxlIHdoZW4gdGl0bGUgbm90IGRlZmluZWQnLCAoKSA9PiB7XG4gICAgLy8gZmlyc3QgbW9kYWxcbiAgICBNb2RhbC5jb25maXJtKHtcbiAgICAgIGNoaWxkcmVuOiAndGVzdCBkZXNjcmlwdGlvbnMnLFxuICAgIH0pO1xuICAgIGV4cGVjdChfcHJvKCcuYzduLXByby1tb2RhbC1mb290ZXInKSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgIGV4cGVjdChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYzduLXByby1jb25maXJtLXRpdGxlJykpLnRvQmUobnVsbCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYWxsb3cgTW9kYWwgd2l0aG91dCBvbkNhbmNlbCBiZWVuIHNldCcsICgpID0+IHtcbiAgICAvLyBzZWNvbmQgbW9kYWxcbiAgICBjb25zdCBrZXkgPSBNb2RhbC5rZXkoKTtcbiAgICBvcGVuKHtcbiAgICAgIGtleSxcbiAgICB9KTtcbiAgICBfcHJvKCcuYzduLXByby1tb2RhbC1mb290ZXInKVsxXVxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5jN24tcHJvLWJ0bi1kZWZhdWx0JylcbiAgICAgIC5jbGljaygpO1xuICAgIGV4cGVjdChlcnJvclNweSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBhbGxvdyBNb2RhbC5jb21maXJtIHdpdGhvdXQgb25PayBiZWVuIHNldCcsICgpID0+IHtcbiAgICAvLyB0aGlyZCBtb2RhbFxuICAgIGNvbnN0IGtleSA9IE1vZGFsLmtleSgpO1xuICAgIG9wZW4oe1xuICAgICAga2V5LFxuICAgIH0pO1xuICAgIF9wcm8oJy5jN24tcHJvLW1vZGFsLWZvb3RlcicpWzJdXG4gICAgICAucXVlcnlTZWxlY3RvcignLmM3bi1wcm8tYnRuLXByaW1hcnknKVxuICAgICAgLmNsaWNrKCk7XG4gICAgZXhwZWN0KGVycm9yU3B5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgndHJpZ2dlciBvbkNhbmNlbCBvbmNlIHdoZW4gY2xpY2sgb24gY2FuY2VsIGJ1dHRvbicsICgpID0+IHtcbiAgICBjb25zdCBvbkNhbmNlbCA9IGplc3QuZm4oKTtcbiAgICBjb25zdCBvbk9rID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGtleSA9IE1vZGFsLmtleSgpO1xuICAgIC8vIGZvcnRoIG1vZGFsXG4gICAgb3Blbih7XG4gICAgICBrZXksXG4gICAgICBvbkNhbmNlbCxcbiAgICAgIG9uT2ssXG4gICAgfSk7XG4gICAgX3BybygnLmM3bi1wcm8tbW9kYWwtZm9vdGVyJylbM11cbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuYzduLXByby1idG4tZGVmYXVsdCcpXG4gICAgICAuY2xpY2soKTtcbiAgICBleHBlY3Qob25DYW5jZWwubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgZXhwZWN0KG9uT2subW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMCk7XG4gIH0pO1xuXG4gIGl0KCd0cmlnZ2VyIG9uT2sgb25jZSB3aGVuIGNsaWNrIG9uIG9rIGJ1dHRvbicsICgpID0+IHtcbiAgICBjb25zdCBvbkNhbmNlbCA9IGplc3QuZm4oKTtcbiAgICBjb25zdCBvbk9rID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGtleSA9IE1vZGFsLmtleSgpO1xuICAgIC8vIGZpZnRoIG1vZGFsXG4gICAgb3Blbih7XG4gICAgICBrZXksXG4gICAgICBvbkNhbmNlbCxcbiAgICAgIG9uT2ssXG4gICAgfSk7XG4gICAgX3BybygnLmM3bi1wcm8tbW9kYWwtZm9vdGVyJylbNF1cbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuYzduLXByby1idG4tcHJpbWFyeScpXG4gICAgICAuY2xpY2soKTtcbiAgICBleHBlY3Qob25DYW5jZWwubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgZXhwZWN0KG9uT2subW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIGl0KCdvbmx5IG9rIHdoZW4gdGhlIG9rQ2FuY2VsIGZhbHNlJywgKCkgPT4ge1xuICAgIG9wZW4oeyBva0NhbmNlbDogZmFsc2UgfSk7XG4gICAgZXhwZWN0KF9wcm8oJy5jN24tcHJvLW1vZGFsLWZvb3RlcicpWzVdLnF1ZXJ5U2VsZWN0b3JBbGwoJy5jN24tcHJvLWJ0bicpKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgZXhwZWN0KFxuICAgICAgX3BybygnLmM3bi1wcm8tbW9kYWwtZm9vdGVyJylbNV0ucXVlcnlTZWxlY3RvckFsbCgnLmM3bi1wcm8tYnRuJylbMF0uaW5uZXJIVE1MLFxuICAgICkudG9Db250YWluKCfnoa7lrponKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZW5kZXIgaW5mbyBtb2RhbCBjb3JyZWN0bHkgJywgKCkgPT4ge1xuICAgIFsnc3VjY2VzcycsICd3YXJuaW5nJywgJ2Vycm9yJ10uZm9yRWFjaCh0eXBlID0+IHtcbiAgICAgIE1vZGFsW3R5cGVdKHtcbiAgICAgICAgdGl0bGU6ICd0aXRsZScsXG4gICAgICAgIGNoaWxkcmVuOiAnY29udGVudCcsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChfcHJvKGAuYzduLXByby1jb25maXJtLSR7dHlwZX1gKSkudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGhhcyBtYXNrQ2xhc3NOYW1lIHdoZW4gc2V0IG1hc2tDbGFzc05hbWUnLCAoKSA9PiB7XG4gICAgWydzdWNjZXNzJywgJ3dhcm5pbmcnLCAnZXJyb3InLCAnb3BlbicsICdjb25maXJtJywgJ2luZm8nXS5mb3JFYWNoKHR5cGUgPT4ge1xuICAgICAgY29uc3QgbWFza0NsYXNzTmFtZSA9ICdtYXNrQ2xhc3NOYW1lJ1xuXG4gICAgICBNb2RhbFt0eXBlXSh7XG4gICAgICAgIHRpdGxlOiAndGl0bGUnLFxuICAgICAgICBjaGlsZHJlbjogJ2NvbnRlbnQnLFxuICAgICAgICBtYXNrQ2xhc3NOYW1lLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoX3BybyhgLmM3bi1wcm8tbWFzay5jN24tcHJvLW1hc2std3JhcHBlci4ke21hc2tDbGFzc05hbWV9YCkpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYXMgbWFza1N0eWxlIHdoZW4gc2V0IG1hc2tTdHlsZScsICgpID0+IHtcbiAgICBbJ3N1Y2Nlc3MnLCAnd2FybmluZycsICdlcnJvcicsICdvcGVuJywgJ2NvbmZpcm0nLCAnaW5mbyddLmZvckVhY2godHlwZSA9PiB7XG4gICAgICBjb25zdCBtYXNrU3R5bGUgPSB7XG4gICAgICAgIGJhY2tncm91bmQ6ICdyZWQnLFxuICAgICAgfVxuXG4gICAgICBNb2RhbFt0eXBlXSh7XG4gICAgICAgIHRpdGxlOiAndGl0bGUnLFxuICAgICAgICBjaGlsZHJlbjogJ2NvbnRlbnQnLFxuICAgICAgICBtYXNrU3R5bGUsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChfcHJvKGAuYzduLXByby1tYXNrLmM3bi1wcm8tbWFzay13cmFwcGVyYCkpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChfcHJvKGAuYzduLXByby1tYXNrLmM3bi1wcm8tbWFzay13cmFwcGVyYClbMF0uc3R5bGUuYmFja2dyb3VuZCkudG9CZSgncmVkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbm90IHJlbmRlciBtYXNrIHdoZW4gc2V0IG1hc2sgdG8gZmFsc2UnLCAoKSA9PiB7XG4gICAgWydzdWNjZXNzJywgJ3dhcm5pbmcnLCAnZXJyb3InLCAnb3BlbicsICdjb25maXJtJywgJ2luZm8nXS5mb3JFYWNoKHR5cGUgPT4ge1xuICAgICAgY29uc3QgbWFzayA9IGZhbHNlXG4gICAgICBNb2RhbFt0eXBlXSh7XG4gICAgICAgIHRpdGxlOiAndGl0bGUnLFxuICAgICAgICBjaGlsZHJlbjogJ2NvbnRlbnQnLFxuICAgICAgICBtYXNrLFxuICAgICAgfSk7XG4gICAgICBqZXN0LnJ1bkFsbFRpbWVycygpO1xuICAgICAgZXhwZWN0KF9wcm8oYC5jN24tcHJvLW1hc2suYzduLXByby1tYXNrLXdyYXBwZXJgKSkudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gIH0pO1xuXG59KTtcbiJdfQ==