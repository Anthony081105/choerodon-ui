1465f40b6634ca191ed5d129f5884036
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _TableRow = _interopRequireDefault(require("./TableRow"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var ExpandableTable =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(ExpandableTable, _Component);

  var _super = _createSuper(ExpandableTable);

  function ExpandableTable(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, ExpandableTable);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleExpandChange", function (expanded, record, event, rowKey) {
      var destroy = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;

      if (event) {
        event.preventDefault();
        event.stopPropagation();
      }

      var _this$props = _this.props,
          onExpandedRowsChange = _this$props.onExpandedRowsChange,
          onExpand = _this$props.onExpand;

      var _this$store$getState = _this.store.getState(),
          expandedRowKeys = _this$store$getState.expandedRowKeys;

      if (expanded) {
        // row was expaned
        expandedRowKeys = [].concat((0, _toConsumableArray2["default"])(expandedRowKeys), [rowKey]);
      } else {
        // row was collapse
        var expandedRowIndex = expandedRowKeys.indexOf(rowKey);

        if (expandedRowIndex !== -1) {
          expandedRowKeys.splice(expandedRowIndex, 1);
        }
      }

      if (!_this.props.expandedRowKeys) {
        _this.store.setState({
          expandedRowKeys: expandedRowKeys
        });
      }

      onExpandedRowsChange(expandedRowKeys);

      if (!destroy) {
        onExpand(expanded, record);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderExpandIndentCell", function (rows, fixed) {
      var _this$props2 = _this.props,
          prefixCls = _this$props2.prefixCls,
          expandIconAsCell = _this$props2.expandIconAsCell;

      if (!expandIconAsCell || fixed === 'right' || !rows.length) {
        return;
      }

      var iconColumn = {
        key: 'rc-table-expand-icon-cell',
        className: "".concat(prefixCls, "-expand-icon-th"),
        title: '',
        rowSpan: rows.length
      };
      rows[0].unshift((0, _objectSpread2["default"])({}, iconColumn, {
        column: iconColumn
      }));
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderRows", function (renderRows, rows, record, index, indent, fixed, parentKey, ancestorKeys) {
      var _this$props3 = _this.props,
          expandedRowClassName = _this$props3.expandedRowClassName,
          expandedRowRender = _this$props3.expandedRowRender,
          childrenColumnName = _this$props3.childrenColumnName;
      var childrenData = record[childrenColumnName];
      var nextAncestorKeys = [].concat((0, _toConsumableArray2["default"])(ancestorKeys), [parentKey]);
      var nextIndent = indent + 1;

      if (expandedRowRender) {
        rows.push(_this.renderExpandedRow(record, index, expandedRowRender, expandedRowClassName(record, index, indent), nextAncestorKeys, nextIndent, fixed));
      }

      if (childrenData) {
        rows.push.apply(rows, (0, _toConsumableArray2["default"])(renderRows(childrenData, nextIndent, nextAncestorKeys)));
      }
    });
    var data = props.data,
        _childrenColumnName = props.childrenColumnName,
        defaultExpandAllRows = props.defaultExpandAllRows,
        _expandedRowKeys = props.expandedRowKeys,
        defaultExpandedRowKeys = props.defaultExpandedRowKeys,
        getRowKey = props.getRowKey;
    var finnalExpandedRowKeys = [];

    var _rows = (0, _toConsumableArray2["default"])(data);

    if (defaultExpandAllRows) {
      for (var i = 0; i < _rows.length; i++) {
        var row = _rows[i];
        finnalExpandedRowKeys.push(getRowKey(row, i));
        _rows = _rows.concat(row[_childrenColumnName] || []);
      }
    } else {
      finnalExpandedRowKeys = _expandedRowKeys || defaultExpandedRowKeys;
    }

    _this.columnManager = props.columnManager;
    _this.store = props.store;

    _this.store.setState({
      expandedRowsHeight: {},
      expandedRowKeys: finnalExpandedRowKeys
    });

    return _this;
  }

  (0, _createClass2["default"])(ExpandableTable, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('expandedRowKeys' in nextProps) {
        this.store.setState({
          expandedRowKeys: nextProps.expandedRowKeys
        });
      }
    }
  }, {
    key: "renderExpandedRow",
    value: function renderExpandedRow(record, index, _render, className, ancestorKeys, indent, fixed) {
      var _this$props4 = this.props,
          prefixCls = _this$props4.prefixCls,
          expandIconAsCell = _this$props4.expandIconAsCell,
          indentSize = _this$props4.indentSize;
      var colCount;

      if (fixed === 'left') {
        colCount = this.columnManager.leftLeafColumns().length;
      } else if (fixed === 'right') {
        colCount = this.columnManager.rightLeafColumns().length;
      } else {
        colCount = this.columnManager.leafColumns().length;
      }

      var columns = [{
        key: 'extra-row',
        render: function render() {
          return {
            props: {
              colSpan: colCount
            },
            children: fixed !== 'right' ? _render(record, index, indent) : '&nbsp;'
          };
        }
      }];

      if (expandIconAsCell && fixed !== 'right') {
        columns.unshift({
          key: 'expand-icon-placeholder',
          render: function render() {
            return null;
          }
        });
      }

      var parentKey = ancestorKeys[ancestorKeys.length - 1];
      var rowKey = "".concat(parentKey, "-extra-row");
      var components = {
        body: {
          row: 'tr',
          cell: 'td'
        }
      };
      return _react["default"].createElement(_TableRow["default"], {
        key: rowKey,
        columns: columns,
        className: className,
        rowKey: rowKey,
        ancestorKeys: ancestorKeys,
        prefixCls: "".concat(prefixCls, "-expanded-row"),
        indentSize: indentSize,
        indent: indent,
        fixed: fixed,
        components: components,
        expandedRow: true
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props5 = this.props,
          data = _this$props5.data,
          childrenColumnName = _this$props5.childrenColumnName,
          children = _this$props5.children;
      var needIndentSpaced = data.some(function (record) {
        return record[childrenColumnName];
      });
      return children({
        props: this.props,
        needIndentSpaced: needIndentSpaced,
        renderRows: this.renderRows,
        handleExpandChange: this.handleExpandChange,
        renderExpandIndentCell: this.renderExpandIndentCell
      });
    }
  }]);
  return ExpandableTable;
}(_react.Component);

(0, _defineProperty2["default"])(ExpandableTable, "propTypes", {
  expandIconAsCell: _propTypes["default"].bool,
  expandedRowKeys: _propTypes["default"].array,
  expandedRowClassName: _propTypes["default"].func,
  defaultExpandAllRows: _propTypes["default"].bool,
  defaultExpandedRowKeys: _propTypes["default"].array,
  expandIconColumnIndex: _propTypes["default"].number,
  expandedRowRender: _propTypes["default"].func,
  childrenColumnName: _propTypes["default"].string,
  indentSize: _propTypes["default"].number,
  onExpand: _propTypes["default"].func,
  onExpandedRowsChange: _propTypes["default"].func,
  columnManager: _propTypes["default"].object.isRequired,
  store: _propTypes["default"].object.isRequired,
  prefixCls: _propTypes["default"].string.isRequired,
  data: _propTypes["default"].array,
  children: _propTypes["default"].func.isRequired
});
(0, _defineProperty2["default"])(ExpandableTable, "defaultProps", {
  expandIconAsCell: false,
  expandedRowClassName: function expandedRowClassName() {
    return '';
  },
  expandIconColumnIndex: 0,
  defaultExpandAllRows: false,
  defaultExpandedRowKeys: [],
  childrenColumnName: 'children',
  indentSize: 15,
  onExpand: function onExpand() {},
  onExpandedRowsChange: function onExpandedRowsChange() {}
});

var _default = (0, _miniStore.connect)()(ExpandableTable);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4cGFuZGFibGVUYWJsZS5qc3giXSwibmFtZXMiOlsiRXhwYW5kYWJsZVRhYmxlIiwicHJvcHMiLCJleHBhbmRlZCIsInJlY29yZCIsImV2ZW50Iiwicm93S2V5IiwiZGVzdHJveSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwib25FeHBhbmRlZFJvd3NDaGFuZ2UiLCJvbkV4cGFuZCIsInN0b3JlIiwiZ2V0U3RhdGUiLCJleHBhbmRlZFJvd0tleXMiLCJleHBhbmRlZFJvd0luZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsInNldFN0YXRlIiwicm93cyIsImZpeGVkIiwicHJlZml4Q2xzIiwiZXhwYW5kSWNvbkFzQ2VsbCIsImxlbmd0aCIsImljb25Db2x1bW4iLCJrZXkiLCJjbGFzc05hbWUiLCJ0aXRsZSIsInJvd1NwYW4iLCJ1bnNoaWZ0IiwiY29sdW1uIiwicmVuZGVyUm93cyIsImluZGV4IiwiaW5kZW50IiwicGFyZW50S2V5IiwiYW5jZXN0b3JLZXlzIiwiZXhwYW5kZWRSb3dDbGFzc05hbWUiLCJleHBhbmRlZFJvd1JlbmRlciIsImNoaWxkcmVuQ29sdW1uTmFtZSIsImNoaWxkcmVuRGF0YSIsIm5leHRBbmNlc3RvcktleXMiLCJuZXh0SW5kZW50IiwicHVzaCIsInJlbmRlckV4cGFuZGVkUm93IiwiZGF0YSIsImRlZmF1bHRFeHBhbmRBbGxSb3dzIiwiZGVmYXVsdEV4cGFuZGVkUm93S2V5cyIsImdldFJvd0tleSIsImZpbm5hbEV4cGFuZGVkUm93S2V5cyIsImkiLCJyb3ciLCJjb25jYXQiLCJjb2x1bW5NYW5hZ2VyIiwiZXhwYW5kZWRSb3dzSGVpZ2h0IiwibmV4dFByb3BzIiwicmVuZGVyIiwiaW5kZW50U2l6ZSIsImNvbENvdW50IiwibGVmdExlYWZDb2x1bW5zIiwicmlnaHRMZWFmQ29sdW1ucyIsImxlYWZDb2x1bW5zIiwiY29sdW1ucyIsImNvbFNwYW4iLCJjaGlsZHJlbiIsImNvbXBvbmVudHMiLCJib2R5IiwiY2VsbCIsIm5lZWRJbmRlbnRTcGFjZWQiLCJzb21lIiwiaGFuZGxlRXhwYW5kQ2hhbmdlIiwicmVuZGVyRXhwYW5kSW5kZW50Q2VsbCIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImJvb2wiLCJhcnJheSIsImZ1bmMiLCJleHBhbmRJY29uQ29sdW1uSW5kZXgiLCJudW1iZXIiLCJzdHJpbmciLCJvYmplY3QiLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBRU1BLGU7Ozs7Ozs7QUFrQ0osMkJBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTtBQUNqQiw4QkFBTUEsS0FBTjtBQURpQiwyR0EwQ0UsVUFBQ0MsUUFBRCxFQUFXQyxNQUFYLEVBQW1CQyxLQUFuQixFQUEwQkMsTUFBMUIsRUFBc0Q7QUFBQSxVQUFwQkMsT0FBb0IsdUVBQVYsS0FBVTs7QUFDekUsVUFBSUYsS0FBSixFQUFXO0FBQ1RBLFFBQUFBLEtBQUssQ0FBQ0csY0FBTjtBQUNBSCxRQUFBQSxLQUFLLENBQUNJLGVBQU47QUFDRDs7QUFKd0Usd0JBTTlCLE1BQUtQLEtBTnlCO0FBQUEsVUFNakVRLG9CQU5pRSxlQU1qRUEsb0JBTmlFO0FBQUEsVUFNM0NDLFFBTjJDLGVBTTNDQSxRQU4yQzs7QUFBQSxpQ0FPL0MsTUFBS0MsS0FBTCxDQUFXQyxRQUFYLEVBUCtDO0FBQUEsVUFPbkVDLGVBUG1FLHdCQU9uRUEsZUFQbUU7O0FBU3pFLFVBQUlYLFFBQUosRUFBYztBQUNaO0FBQ0FXLFFBQUFBLGVBQWUsaURBQU9BLGVBQVAsSUFBd0JSLE1BQXhCLEVBQWY7QUFDRCxPQUhELE1BR087QUFDTDtBQUNBLFlBQU1TLGdCQUFnQixHQUFHRCxlQUFlLENBQUNFLE9BQWhCLENBQXdCVixNQUF4QixDQUF6Qjs7QUFDQSxZQUFJUyxnQkFBZ0IsS0FBSyxDQUFDLENBQTFCLEVBQTZCO0FBQzNCRCxVQUFBQSxl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RUFBRSxVQU5BO0FBT3BCa0IsRUFBQUEsVUFBVSxFQUFFLEVBUFE7QUFRcEI3QyxFQUFBQSxRQVJvQixzQkFRVCxDQUNWLENBVG1CO0FBVXBCRCxFQUFBQSxvQkFWb0Isa0NBVUcsQ0FDdEI7QUFYbUIsQzs7ZUFzTVQsMEJBQVVULGVBQVYsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ21pbmktc3RvcmUnO1xuaW1wb3J0IFRhYmxlUm93IGZyb20gJy4vVGFibGVSb3cnO1xuXG5jbGFzcyBFeHBhbmRhYmxlVGFibGUgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGV4cGFuZEljb25Bc0NlbGw6IFByb3BUeXBlcy5ib29sLFxuICAgIGV4cGFuZGVkUm93S2V5czogUHJvcFR5cGVzLmFycmF5LFxuICAgIGV4cGFuZGVkUm93Q2xhc3NOYW1lOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBkZWZhdWx0RXhwYW5kQWxsUm93czogUHJvcFR5cGVzLmJvb2wsXG4gICAgZGVmYXVsdEV4cGFuZGVkUm93S2V5czogUHJvcFR5cGVzLmFycmF5LFxuICAgIGV4cGFuZEljb25Db2x1bW5JbmRleDogUHJvcFR5cGVzLm51bWJlcixcbiAgICBleHBhbmRlZFJvd1JlbmRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY2hpbGRyZW5Db2x1bW5OYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGluZGVudFNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgb25FeHBhbmQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uRXhwYW5kZWRSb3dzQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBjb2x1bW5NYW5hZ2VyOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgc3RvcmU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBkYXRhOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBleHBhbmRJY29uQXNDZWxsOiBmYWxzZSxcbiAgICBleHBhbmRlZFJvd0NsYXNzTmFtZTogKCkgPT4gJycsXG4gICAgZXhwYW5kSWNvbkNvbHVtbkluZGV4OiAwLFxuICAgIGRlZmF1bHRFeHBhbmRBbGxSb3dzOiBmYWxzZSxcbiAgICBkZWZhdWx0RXhwYW5kZWRSb3dLZXlzOiBbXSxcbiAgICBjaGlsZHJlbkNvbHVtbk5hbWU6ICdjaGlsZHJlbicsXG4gICAgaW5kZW50U2l6ZTogMTUsXG4gICAgb25FeHBhbmQoKSB7XG4gICAgfSxcbiAgICBvbkV4cGFuZGVkUm93c0NoYW5nZSgpIHtcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgY29uc3Qge1xuICAgICAgZGF0YSxcbiAgICAgIGNoaWxkcmVuQ29sdW1uTmFtZSxcbiAgICAgIGRlZmF1bHRFeHBhbmRBbGxSb3dzLFxuICAgICAgZXhwYW5kZWRSb3dLZXlzLFxuICAgICAgZGVmYXVsdEV4cGFuZGVkUm93S2V5cyxcbiAgICAgIGdldFJvd0tleSxcbiAgICB9ID0gcHJvcHM7XG5cbiAgICBsZXQgZmlubmFsRXhwYW5kZWRSb3dLZXlzID0gW107XG4gICAgbGV0IHJvd3MgPSBbLi4uZGF0YV07XG5cbiAgICBpZiAoZGVmYXVsdEV4cGFuZEFsbFJvd3MpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByb3cgPSByb3dzW2ldO1xuICAgICAgICBmaW5uYWxFeHBhbmRlZFJvd0tleXMucHVzaChnZXRSb3dLZXkocm93LCBpKSk7XG4gICAgICAgIHJvd3MgPSByb3dzLmNvbmNhdChyb3dbY2hpbGRyZW5Db2x1bW5OYW1lXSB8fCBbXSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZpbm5hbEV4cGFuZGVkUm93S2V5cyA9IGV4cGFuZGVkUm93S2V5cyB8fCBkZWZhdWx0RXhwYW5kZWRSb3dLZXlzO1xuICAgIH1cblxuICAgIHRoaXMuY29sdW1uTWFuYWdlciA9IHByb3BzLmNvbHVtbk1hbmFnZXI7XG4gICAgdGhpcy5zdG9yZSA9IHByb3BzLnN0b3JlO1xuXG4gICAgdGhpcy5zdG9yZS5zZXRTdGF0ZSh7XG4gICAgICBleHBhbmRlZFJvd3NIZWlnaHQ6IHt9LFxuICAgICAgZXhwYW5kZWRSb3dLZXlzOiBmaW5uYWxFeHBhbmRlZFJvd0tleXMsXG4gICAgfSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICgnZXhwYW5kZWRSb3dLZXlzJyBpbiBuZXh0UHJvcHMpIHtcbiAgICAgIHRoaXMuc3RvcmUuc2V0U3RhdGUoe1xuICAgICAgICBleHBhbmRlZFJvd0tleXM6IG5leHRQcm9wcy5leHBhbmRlZFJvd0tleXMsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVFeHBhbmRDaGFuZ2UgPSAoZXhwYW5kZWQsIHJlY29yZCwgZXZlbnQsIHJvd0tleSwgZGVzdHJveSA9IGZhbHNlKSA9PiB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBvbkV4cGFuZGVkUm93c0NoYW5nZSwgb25FeHBhbmQgfSA9IHRoaXMucHJvcHM7XG4gICAgbGV0IHsgZXhwYW5kZWRSb3dLZXlzIH0gPSB0aGlzLnN0b3JlLmdldFN0YXRlKCk7XG5cbiAgICBpZiAoZXhwYW5kZWQpIHtcbiAgICAgIC8vIHJvdyB3YXMgZXhwYW5lZFxuICAgICAgZXhwYW5kZWRSb3dLZXlzID0gWy4uLmV4cGFuZGVkUm93S2V5cywgcm93S2V5XTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gcm93IHdhcyBjb2xsYXBzZVxuICAgICAgY29uc3QgZXhwYW5kZWRSb3dJbmRleCA9IGV4cGFuZGVkUm93S2V5cy5pbmRleE9mKHJvd0tleSk7XG4gICAgICBpZiAoZXhwYW5kZWRSb3dJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgZXhwYW5kZWRSb3dLZXlzLnNwbGljZShleHBhbmRlZFJvd0luZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXRoaXMucHJvcHMuZXhwYW5kZWRSb3dLZXlzKSB7XG4gICAgICB0aGlzLnN0b3JlLnNldFN0YXRlKHsgZXhwYW5kZWRSb3dLZXlzIH0pO1xuICAgIH1cblxuICAgIG9uRXhwYW5kZWRSb3dzQ2hhbmdlKGV4cGFuZGVkUm93S2V5cyk7XG4gICAgaWYgKCFkZXN0cm95KSB7XG4gICAgICBvbkV4cGFuZChleHBhbmRlZCwgcmVjb3JkKTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyRXhwYW5kSW5kZW50Q2VsbCA9IChyb3dzLCBmaXhlZCkgPT4ge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBleHBhbmRJY29uQXNDZWxsIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghZXhwYW5kSWNvbkFzQ2VsbCB8fCBmaXhlZCA9PT0gJ3JpZ2h0JyB8fCAhcm93cy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpY29uQ29sdW1uID0ge1xuICAgICAga2V5OiAncmMtdGFibGUtZXhwYW5kLWljb24tY2VsbCcsXG4gICAgICBjbGFzc05hbWU6IGAke3ByZWZpeENsc30tZXhwYW5kLWljb24tdGhgLFxuICAgICAgdGl0bGU6ICcnLFxuICAgICAgcm93U3Bhbjogcm93cy5sZW5ndGgsXG4gICAgfTtcblxuICAgIHJvd3NbMF0udW5zaGlmdCh7IC4uLmljb25Db2x1bW4sIGNvbHVtbjogaWNvbkNvbHVtbiB9KTtcbiAgfTtcblxuICByZW5kZXJFeHBhbmRlZFJvdyhyZWNvcmQsIGluZGV4LCByZW5kZXIsIGNsYXNzTmFtZSwgYW5jZXN0b3JLZXlzLCBpbmRlbnQsIGZpeGVkKSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIGV4cGFuZEljb25Bc0NlbGwsIGluZGVudFNpemUgfSA9IHRoaXMucHJvcHM7XG4gICAgbGV0IGNvbENvdW50O1xuICAgIGlmIChmaXhlZCA9PT0gJ2xlZnQnKSB7XG4gICAgICBjb2xDb3VudCA9IHRoaXMuY29sdW1uTWFuYWdlci5sZWZ0TGVhZkNvbHVtbnMoKS5sZW5ndGg7XG4gICAgfSBlbHNlIGlmIChmaXhlZCA9PT0gJ3JpZ2h0Jykge1xuICAgICAgY29sQ291bnQgPSB0aGlzLmNvbHVtbk1hbmFnZXIucmlnaHRMZWFmQ29sdW1ucygpLmxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29sQ291bnQgPSB0aGlzLmNvbHVtbk1hbmFnZXIubGVhZkNvbHVtbnMoKS5sZW5ndGg7XG4gICAgfVxuICAgIGNvbnN0IGNvbHVtbnMgPSBbe1xuICAgICAga2V5OiAnZXh0cmEtcm93JyxcbiAgICAgIHJlbmRlcjogKCkgPT4gKHtcbiAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICBjb2xTcGFuOiBjb2xDb3VudCxcbiAgICAgICAgfSxcbiAgICAgICAgY2hpbGRyZW46IGZpeGVkICE9PSAncmlnaHQnID8gcmVuZGVyKHJlY29yZCwgaW5kZXgsIGluZGVudCkgOiAnJm5ic3A7JyxcbiAgICAgIH0pLFxuICAgIH1dO1xuICAgIGlmIChleHBhbmRJY29uQXNDZWxsICYmIGZpeGVkICE9PSAncmlnaHQnKSB7XG4gICAgICBjb2x1bW5zLnVuc2hpZnQoe1xuICAgICAgICBrZXk6ICdleHBhbmQtaWNvbi1wbGFjZWhvbGRlcicsXG4gICAgICAgIHJlbmRlcjogKCkgPT4gbnVsbCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBwYXJlbnRLZXkgPSBhbmNlc3RvcktleXNbYW5jZXN0b3JLZXlzLmxlbmd0aCAtIDFdO1xuICAgIGNvbnN0IHJvd0tleSA9IGAke3BhcmVudEtleX0tZXh0cmEtcm93YDtcbiAgICBjb25zdCBjb21wb25lbnRzID0ge1xuICAgICAgYm9keToge1xuICAgICAgICByb3c6ICd0cicsXG4gICAgICAgIGNlbGw6ICd0ZCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFRhYmxlUm93XG4gICAgICAgIGtleT17cm93S2V5fVxuICAgICAgICBjb2x1bW5zPXtjb2x1bW5zfVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cbiAgICAgICAgcm93S2V5PXtyb3dLZXl9XG4gICAgICAgIGFuY2VzdG9yS2V5cz17YW5jZXN0b3JLZXlzfVxuICAgICAgICBwcmVmaXhDbHM9e2Ake3ByZWZpeENsc30tZXhwYW5kZWQtcm93YH1cbiAgICAgICAgaW5kZW50U2l6ZT17aW5kZW50U2l6ZX1cbiAgICAgICAgaW5kZW50PXtpbmRlbnR9XG4gICAgICAgIGZpeGVkPXtmaXhlZH1cbiAgICAgICAgY29tcG9uZW50cz17Y29tcG9uZW50c31cbiAgICAgICAgZXhwYW5kZWRSb3dcbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclJvd3MgPSAocmVuZGVyUm93cywgcm93cywgcmVjb3JkLCBpbmRleCwgaW5kZW50LCBmaXhlZCwgcGFyZW50S2V5LCBhbmNlc3RvcktleXMpID0+IHtcbiAgICBjb25zdCB7IGV4cGFuZGVkUm93Q2xhc3NOYW1lLCBleHBhbmRlZFJvd1JlbmRlciwgY2hpbGRyZW5Db2x1bW5OYW1lIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGNoaWxkcmVuRGF0YSA9IHJlY29yZFtjaGlsZHJlbkNvbHVtbk5hbWVdO1xuICAgIGNvbnN0IG5leHRBbmNlc3RvcktleXMgPSBbLi4uYW5jZXN0b3JLZXlzLCBwYXJlbnRLZXldO1xuICAgIGNvbnN0IG5leHRJbmRlbnQgPSBpbmRlbnQgKyAxO1xuXG4gICAgaWYgKGV4cGFuZGVkUm93UmVuZGVyKSB7XG4gICAgICByb3dzLnB1c2goXG4gICAgICAgIHRoaXMucmVuZGVyRXhwYW5kZWRSb3coXG4gICAgICAgICAgcmVjb3JkLFxuICAgICAgICAgIGluZGV4LFxuICAgICAgICAgIGV4cGFuZGVkUm93UmVuZGVyLFxuICAgICAgICAgIGV4cGFuZGVkUm93Q2xhc3NOYW1lKHJlY29yZCwgaW5kZXgsIGluZGVudCksXG4gICAgICAgICAgbmV4dEFuY2VzdG9yS2V5cyxcbiAgICAgICAgICBuZXh0SW5kZW50LFxuICAgICAgICAgIGZpeGVkLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoY2hpbGRyZW5EYXRhKSB7XG4gICAgICByb3dzLnB1c2goXG4gICAgICAgIC4uLnJlbmRlclJvd3MoXG4gICAgICAgICAgY2hpbGRyZW5EYXRhLFxuICAgICAgICAgIG5leHRJbmRlbnQsXG4gICAgICAgICAgbmV4dEFuY2VzdG9yS2V5cyxcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgZGF0YSwgY2hpbGRyZW5Db2x1bW5OYW1lLCBjaGlsZHJlbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBuZWVkSW5kZW50U3BhY2VkID0gZGF0YS5zb21lKHJlY29yZCA9PiByZWNvcmRbY2hpbGRyZW5Db2x1bW5OYW1lXSk7XG5cbiAgICByZXR1cm4gY2hpbGRyZW4oe1xuICAgICAgcHJvcHM6IHRoaXMucHJvcHMsXG4gICAgICBuZWVkSW5kZW50U3BhY2VkLFxuICAgICAgcmVuZGVyUm93czogdGhpcy5yZW5kZXJSb3dzLFxuICAgICAgaGFuZGxlRXhwYW5kQ2hhbmdlOiB0aGlzLmhhbmRsZUV4cGFuZENoYW5nZSxcbiAgICAgIHJlbmRlckV4cGFuZEluZGVudENlbGw6IHRoaXMucmVuZGVyRXhwYW5kSW5kZW50Q2VsbCxcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KCkoRXhwYW5kYWJsZVRhYmxlKTtcbiJdfQ==