9bd35f68ec198a1e99cd573af9169672
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread4 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = require("react");

var _isObject = _interopRequireDefault(require("lodash/isObject"));

var _mobx = require("mobx");

var _mediaQueryListPolyfill = require("../_util/mediaQueryListPolyfill");

var _enum = require("./enum");

var _responsiveMap;

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var enquire;

if (typeof window !== 'undefined') {
  window.matchMedia = window.matchMedia || _mediaQueryListPolyfill.matchMediaPolifill; // eslint-disable-next-line global-require

  enquire = require('enquire.js');
}

var responsiveMap = (_responsiveMap = {}, (0, _defineProperty2["default"])(_responsiveMap, _enum.Breakpoint.xxl, '(min-width: 1600px)'), (0, _defineProperty2["default"])(_responsiveMap, _enum.Breakpoint.xl, '(min-width: 1200px)'), (0, _defineProperty2["default"])(_responsiveMap, _enum.Breakpoint.lg, '(min-width: 992px)'), (0, _defineProperty2["default"])(_responsiveMap, _enum.Breakpoint.md, '(min-width: 768px)'), (0, _defineProperty2["default"])(_responsiveMap, _enum.Breakpoint.sm, '(min-width: 576px)'), (0, _defineProperty2["default"])(_responsiveMap, _enum.Breakpoint.xs, '(max-width: 575px)'), _responsiveMap);
var responsiveArray = Object.keys(responsiveMap);

var Responsive =
/*#__PURE__*/
function (_PureComponent) {
  (0, _inherits2["default"])(Responsive, _PureComponent);

  var _super = _createSuper(Responsive);

  function Responsive() {
    var _this;

    (0, _classCallCheck2["default"])(this, Responsive);
    _this = _super.apply(this, arguments);
    _this.state = {
      breakpoints: {}
    };
    return _this;
  }

  (0, _createClass2["default"])(Responsive, [{
    key: "isDisabled",
    value: function isDisabled(props) {
      var disabled = props.disabled,
          items = props.items;

      if (!disabled && items) {
        return !items.some(_isObject["default"]);
      }

      return true;
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      if (!this.isDisabled(this.props)) {
        this.register();
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      var onChange = this.props.onChange;

      if (onChange) {
        onChange(this.getValues());
      }
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (this.isDisabled(this.props) && !this.isDisabled(nextProps)) {
        this.register();
      }

      if (!this.isDisabled(this.props) && this.isDisabled(nextProps)) {
        this.unregister();
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      if (!this.isDisabled(this.props)) {
        this.unregister();
      }
    }
  }, {
    key: "register",
    value: function register() {
      var _this2 = this;

      if (enquire) {
        responsiveArray.map(function (breakpoint) {
          return enquire.register(responsiveMap[breakpoint], {
            match: function match() {
              _this2.setState(function (prevState) {
                return {
                  breakpoints: (0, _objectSpread4["default"])({}, prevState.breakpoints, (0, _defineProperty2["default"])({}, breakpoint, true))
                };
              });
            },
            unmatch: function unmatch() {
              _this2.setState(function (prevState) {
                return {
                  breakpoints: (0, _objectSpread4["default"])({}, prevState.breakpoints, (0, _defineProperty2["default"])({}, breakpoint, false))
                };
              });
            },
            // Keep a empty destory to avoid triggering unmatch when unregister
            destroy: function destroy() {}
          });
        });
      }
    }
  }, {
    key: "unregister",
    value: function unregister() {
      Object.keys(responsiveMap).map(function (breakpoint) {
        return enquire.unregister(responsiveMap[breakpoint]);
      });
    }
  }, {
    key: "processValue",
    value: function processValue(value) {
      var breakpoints = this.state.breakpoints;

      if ((0, _mobx.isArrayLike)(value)) {
        return value.map(this.processValue, this);
      }

      if ((0, _isObject["default"])(value)) {
        for (var i = 0; i < responsiveArray.length; i++) {
          var breakpoint = responsiveArray[i];

          if (breakpoints[breakpoint] && value[breakpoint] !== undefined) {
            return value[breakpoint];
          }
        }

        return undefined;
      }

      return value;
    }
  }, {
    key: "getValues",
    value: function getValues() {
      var items = this.props.items;

      if (items) {
        return items.map(this.processValue, this);
      }

      return [];
    }
  }, {
    key: "render",
    value: function render() {
      var children = this.props.children;

      if (typeof children === 'function') {
        return children(this.getValues());
      }

      return children;
    }
  }]);
  return Responsive;
}(_react.PureComponent);

exports["default"] = Responsive;
Responsive.displayName = 'Responsive';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzL3Jlc3BvbnNpdmUvUmVzcG9uc2l2ZS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBSSxPQUFKOztBQUNBLElBQUksT0FBTyxNQUFQLEtBQWtCLFdBQXRCLEVBQW1DO0FBQ2pDLEVBQUEsTUFBTSxDQUFDLFVBQVAsR0FBb0IsTUFBTSxDQUFDLFVBQVAsSUFBcUIsMENBQXpDLENBRGlDLENBRWpDOztBQUNBLEVBQUEsT0FBTyxHQUFHLE9BQU8sQ0FBQyxZQUFELENBQWpCO0FBQ0Q7O0FBV0QsSUFBTSxhQUFhLDBFQUNoQixpQkFBVyxHQURLLEVBQ0MscUJBREQsb0RBRWhCLGlCQUFXLEVBRkssRUFFQSxxQkFGQSxvREFHaEIsaUJBQVcsRUFISyxFQUdBLG9CQUhBLG9EQUloQixpQkFBVyxFQUpLLEVBSUEsb0JBSkEsb0RBS2hCLGlCQUFXLEVBTEssRUFLQSxvQkFMQSxvREFNaEIsaUJBQVcsRUFOSyxFQU1BLG9CQU5BLGtCQUFuQjtBQVNBLElBQU0sZUFBZSxHQUFpQixNQUFNLENBQUMsSUFBUCxDQUFZLGFBQVosQ0FBdEM7O0lBZXFCLFU7Ozs7Ozs7QUFBckIsd0JBQUE7QUFBQTs7QUFBQTs7QUFHRSxVQUFBLEtBQUEsR0FBUTtBQUFFLE1BQUEsV0FBVyxFQUFFO0FBQWYsS0FBUjtBQUhGO0FBMEdDOzs7OytCQXJHWSxLLEVBQUs7QUFBQSxVQUNOLFFBRE0sR0FDYyxLQURkLENBQ04sUUFETTtBQUFBLFVBQ0ksS0FESixHQUNjLEtBRGQsQ0FDSSxLQURKOztBQUVkLFVBQUksQ0FBQyxRQUFELElBQWEsS0FBakIsRUFBd0I7QUFDdEIsZUFBTyxDQUFDLEtBQUssQ0FBQyxJQUFOLENBQVcsb0JB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QUFKLEVBQVc7QUFDVCxlQUFPLEtBQUssQ0FBQyxHQUFOLENBQVUsS0FBSyxZQUFmLEVBQTZCLElBQTdCLENBQVA7QUFDRDs7QUFDRCxhQUFPLEVBQVA7QUFDRDs7OzZCQUVLO0FBQUEsVUFDSSxRQURKLEdBQ2lCLEtBQUssS0FEdEIsQ0FDSSxRQURKOztBQUVKLFVBQUksT0FBTyxRQUFQLEtBQW9CLFVBQXhCLEVBQW9DO0FBQ2xDLGVBQVEsUUFBNkIsQ0FBQyxLQUFLLFNBQUwsRUFBRCxDQUFyQztBQUNEOztBQUNELGFBQU8sUUFBUDtBQUNEOzs7RUF6R3FDLG9COzs7QUFDL0IsVUFBQSxDQUFBLFdBQUEsR0FBYyxZQUFkIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHVyZUNvbXBvbmVudCwgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IGlzT2JqZWN0IGZyb20gJ2xvZGFzaC9pc09iamVjdCc7XG5pbXBvcnQgeyBpc0FycmF5TGlrZSB9IGZyb20gJ21vYngnO1xuaW1wb3J0IHsgbWF0Y2hNZWRpYVBvbGlmaWxsIH0gZnJvbSAnLi4vX3V0aWwvbWVkaWFRdWVyeUxpc3RQb2x5ZmlsbCc7XG5pbXBvcnQgeyBCcmVha3BvaW50IH0gZnJvbSAnLi9lbnVtJztcblxubGV0IGVucXVpcmU6IGFueTtcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICB3aW5kb3cubWF0Y2hNZWRpYSA9IHdpbmRvdy5tYXRjaE1lZGlhIHx8IG1hdGNoTWVkaWFQb2xpZmlsbDtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGdsb2JhbC1yZXF1aXJlXG4gIGVucXVpcmUgPSByZXF1aXJlKCdlbnF1aXJlLmpzJyk7XG59XG5cbmV4cG9ydCB0eXBlIEJyZWFrcG9pbnRNYXAgPSB7XG4gIFtCcmVha3BvaW50Lnh4bF0/OiBzdHJpbmc7XG4gIFtCcmVha3BvaW50LnhsXT86IHN0cmluZztcbiAgW0JyZWFrcG9pbnQubGddPzogc3RyaW5nO1xuICBbQnJlYWtwb2ludC5tZF0/OiBzdHJpbmc7XG4gIFtCcmVha3BvaW50LnNtXT86IHN0cmluZztcbiAgW0JyZWFrcG9pbnQueHNdPzogc3RyaW5nO1xufTtcblxuY29uc3QgcmVzcG9uc2l2ZU1hcDogQnJlYWtwb2ludE1hcCA9IHtcbiAgW0JyZWFrcG9pbnQueHhsXTogJyhtaW4td2lkdGg6IDE2MDBweCknLFxuICBbQnJlYWtwb2ludC54bF06ICcobWluLXdpZHRoOiAxMjAwcHgpJyxcbiAgW0JyZWFrcG9pbnQubGddOiAnKG1pbi13aWR0aDogOTkycHgpJyxcbiAgW0JyZWFrcG9pbnQubWRdOiAnKG1pbi13aWR0aDogNzY4cHgpJyxcbiAgW0JyZWFrcG9pbnQuc21dOiAnKG1pbi13aWR0aDogNTc2cHgpJyxcbiAgW0JyZWFrcG9pbnQueHNdOiAnKG1heC13aWR0aDogNTc1cHgpJyxcbn07XG5cbmNvbnN0IHJlc3BvbnNpdmVBcnJheTogQnJlYWtwb2ludFtdID0gT2JqZWN0LmtleXMocmVzcG9uc2l2ZU1hcCkgYXMgQnJlYWtwb2ludFtdO1xuXG5leHBvcnQgdHlwZSBDaGlsZHJlbkZ1bmN0aW9uID0gKGl0ZW1zOiBhbnlbXSkgPT4gUmVhY3ROb2RlO1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlc3BvbnNpdmVQcm9wcyB7XG4gIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgaXRlbXM/OiAoYW55IHwgQnJlYWtwb2ludE1hcClbXTtcbiAgY2hpbGRyZW4/OiBSZWFjdE5vZGUgfCBDaGlsZHJlbkZ1bmN0aW9uO1xuICBvbkNoYW5nZT86IChpdGVtczogYW55W10pID0+IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVzcG9uc2l2ZVN0YXRlIHtcbiAgYnJlYWtwb2ludHM6IEJyZWFrcG9pbnRNYXA7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJlc3BvbnNpdmUgZXh0ZW5kcyBQdXJlQ29tcG9uZW50PFJlc3BvbnNpdmVQcm9wcywgUmVzcG9uc2l2ZVN0YXRlPiB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdSZXNwb25zaXZlJztcblxuICBzdGF0ZSA9IHsgYnJlYWtwb2ludHM6IHt9IH07XG5cbiAgaXNEaXNhYmxlZChwcm9wcykge1xuICAgIGNvbnN0IHsgZGlzYWJsZWQsIGl0ZW1zIH0gPSBwcm9wcztcbiAgICBpZiAoIWRpc2FibGVkICYmIGl0ZW1zKSB7XG4gICAgICByZXR1cm4gIWl0ZW1zLnNvbWUoaXNPYmplY3QpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKHRoaXMucHJvcHMpKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyKCk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIGNvbnN0IHsgb25DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKG9uQ2hhbmdlKSB7XG4gICAgICBvbkNoYW5nZSh0aGlzLmdldFZhbHVlcygpKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICh0aGlzLmlzRGlzYWJsZWQodGhpcy5wcm9wcykgJiYgIXRoaXMuaXNEaXNhYmxlZChuZXh0UHJvcHMpKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyKCk7XG4gICAgfVxuICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKHRoaXMucHJvcHMpICYmIHRoaXMuaXNEaXNhYmxlZChuZXh0UHJvcHMpKSB7XG4gICAgICB0aGlzLnVucmVnaXN0ZXIoKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCh0aGlzLnByb3BzKSkge1xuICAgICAgdGhpcy51bnJlZ2lzdGVyKCk7XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXIoKSB7XG4gICAgaWYgKGVucXVpcmUpIHtcbiAgICAgIHJlc3BvbnNpdmVBcnJheS5tYXAoKGJyZWFrcG9pbnQ6IEJyZWFrcG9pbnQpID0+XG4gICAgICAgIGVucXVpcmUucmVnaXN0ZXIocmVzcG9uc2l2ZU1hcFticmVha3BvaW50XSwge1xuICAgICAgICAgIG1hdGNoOiAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgICAgICAgICBicmVha3BvaW50czoge1xuICAgICAgICAgICAgICAgIC4uLnByZXZTdGF0ZS5icmVha3BvaW50cyxcbiAgICAgICAgICAgICAgICBbYnJlYWtwb2ludF06IHRydWUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1bm1hdGNoOiAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgICAgICAgICBicmVha3BvaW50czoge1xuICAgICAgICAgICAgICAgIC4uLnByZXZTdGF0ZS5icmVha3BvaW50cyxcbiAgICAgICAgICAgICAgICBbYnJlYWtwb2ludF06IGZhbHNlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gS2VlcCBhIGVtcHR5IGRlc3RvcnkgdG8gYXZvaWQgdHJpZ2dlcmluZyB1bm1hdGNoIHdoZW4gdW5yZWdpc3RlclxuICAgICAgICAgIGRlc3Ryb3koKSB7fSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHVucmVnaXN0ZXIoKSB7XG4gICAgT2JqZWN0LmtleXMocmVzcG9uc2l2ZU1hcCkubWFwKChicmVha3BvaW50OiBCcmVha3BvaW50KSA9PlxuICAgICAgZW5xdWlyZS51bnJlZ2lzdGVyKHJlc3BvbnNpdmVNYXBbYnJlYWtwb2ludF0pLFxuICAgICk7XG4gIH1cblxuICBwcm9jZXNzVmFsdWUodmFsdWUpIHtcbiAgICBjb25zdCB7IGJyZWFrcG9pbnRzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmIChpc0FycmF5TGlrZSh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB2YWx1ZS5tYXAodGhpcy5wcm9jZXNzVmFsdWUsIHRoaXMpO1xuICAgIH1cbiAgICBpZiAoaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3BvbnNpdmVBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBicmVha3BvaW50OiBCcmVha3BvaW50ID0gcmVzcG9uc2l2ZUFycmF5W2ldO1xuICAgICAgICBpZiAoYnJlYWtwb2ludHNbYnJlYWtwb2ludF0gJiYgdmFsdWVbYnJlYWtwb2ludF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiB2YWx1ZVticmVha3BvaW50XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgZ2V0VmFsdWVzKCk6IGFueVtdIHtcbiAgICBjb25zdCB7IGl0ZW1zIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChpdGVtcykge1xuICAgICAgcmV0dXJuIGl0ZW1zLm1hcCh0aGlzLnByb2Nlc3NWYWx1ZSwgdGhpcyk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGNoaWxkcmVuIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICh0eXBlb2YgY2hpbGRyZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiAoY2hpbGRyZW4gYXMgQ2hpbGRyZW5GdW5jdGlvbikodGhpcy5nZXRWYWx1ZXMoKSk7XG4gICAgfVxuICAgIHJldHVybiBjaGlsZHJlbjtcbiAgfVxufVxuIl19