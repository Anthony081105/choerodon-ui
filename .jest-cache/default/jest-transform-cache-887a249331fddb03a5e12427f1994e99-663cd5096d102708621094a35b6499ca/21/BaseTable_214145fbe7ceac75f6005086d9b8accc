bf79669483942f3b60c96cee872ffbb4
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _ColGroup = _interopRequireDefault(require("./ColGroup"));

var _TableHeader = _interopRequireDefault(require("./TableHeader"));

var _TableFooter = _interopRequireDefault(require("./TableFooter"));

var _TableRow = _interopRequireDefault(require("./TableRow"));

var _ExpandableRow = _interopRequireDefault(require("./ExpandableRow"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var BaseTable =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(BaseTable, _Component);

  var _super = _createSuper(BaseTable);

  function BaseTable() {
    var _this;

    (0, _classCallCheck2["default"])(this, BaseTable);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleRowHover", function (isHover, key) {
      _this.props.store.setState({
        currentHoverKey: isHover ? key : null
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderRows", function (renderData, indent) {
      var ancestorKeys = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
      var table = _this.context.table;
      var columnManager = table.columnManager,
          components = table.components;
      var _table$props = table.props,
          prefixCls = _table$props.prefixCls,
          childrenColumnName = _table$props.childrenColumnName,
          rowClassName = _table$props.rowClassName,
          rowRef = _table$props.rowRef,
          onRowClick = _table$props.onRowClick,
          onRowDoubleClick = _table$props.onRowDoubleClick,
          onRowContextMenu = _table$props.onRowContextMenu,
          onRowMouseEnter = _table$props.onRowMouseEnter,
          onRowMouseLeave = _table$props.onRowMouseLeave,
          onRow = _table$props.onRow;
      var _this$props = _this.props,
          getRowKey = _this$props.getRowKey,
          fixed = _this$props.fixed,
          expander = _this$props.expander,
          isAnyColumnsFixed = _this$props.isAnyColumnsFixed;
      var rows = [];

      var _loop = function _loop(i) {
        var record = renderData[i];
        var key = getRowKey(record, i);
        var className = typeof rowClassName === 'string' ? rowClassName : rowClassName(record, i, indent);
        var onHoverProps = {};

        if (columnManager.isAnyColumnsFixed()) {
          onHoverProps.onHover = _this.handleRowHover;
        }

        var leafColumns = void 0;

        if (fixed === 'left') {
          leafColumns = columnManager.leftLeafColumns();
        } else if (fixed === 'right') {
          leafColumns = columnManager.rightLeafColumns();
        } else {
          leafColumns = columnManager.leafColumns();
        }

        var rowPrefixCls = "".concat(prefixCls, "-row");

        var row = _react["default"].createElement(_ExpandableRow["default"], (0, _extends2["default"])({}, expander.props, {
          fixed: fixed,
          index: i,
          prefixCls: rowPrefixCls,
          record: record,
          key: key,
          rowKey: key,
          onRowClick: onRowClick,
          needIndentSpaced: expander.needIndentSpaced,
          onExpandedChange: expander.handleExpandChange
        }), function (expandableRow) {
          return (// eslint-disable-line
            _react["default"].createElement(_TableRow["default"], (0, _extends2["default"])({
              fixed: fixed,
              indent: indent,
              className: className,
              record: record,
              index: i,
              prefixCls: rowPrefixCls,
              childrenColumnName: childrenColumnName,
              columns: leafColumns,
              onRow: onRow,
              onRowDoubleClick: onRowDoubleClick,
              onRowContextMenu: onRowContextMenu,
              onRowMouseEnter: onRowMouseEnter,
              onRowMouseLeave: onRowMouseLeave
            }, onHoverProps, {
              rowKey: key,
              ancestorKeys: ancestorKeys,
              ref: rowRef(record, i, indent),
              components: components,
              isAnyColumnsFixed: isAnyColumnsFixed
            }, expandableRow))
          );
        });

        rows.push(row);
        expander.renderRows(_this.renderRows, rows, record, i, indent, fixed, key, ancestorKeys);
      };

      for (var i = 0; i < renderData.length; i++) {
        _loop(i);
      }

      return rows;
    });
    return _this;
  }

  (0, _createClass2["default"])(BaseTable, [{
    key: "render",
    value: function render() {
      var table = this.context.table;
      var components = table.components;
      var _table$props2 = table.props,
          prefixCls = _table$props2.prefixCls,
          scroll = _table$props2.scroll,
          data = _table$props2.data,
          getBodyWrapper = _table$props2.getBodyWrapper;
      var _this$props2 = this.props,
          expander = _this$props2.expander,
          tableClassName = _this$props2.tableClassName,
          hasHead = _this$props2.hasHead,
          hasBody = _this$props2.hasBody,
          hasFoot = _this$props2.hasFoot,
          fixed = _this$props2.fixed,
          columns = _this$props2.columns;
      var tableStyle = {};

      if (!fixed && scroll.x) {
        // not set width, then use content fixed width
        if (scroll.x === true) {
          tableStyle.tableLayout = 'fixed';
        } else {
          tableStyle.width = scroll.x;
        }
      }

      var Table = hasBody ? components.table : 'table';
      var BodyWrapper = components.body.wrapper;
      var body;

      if (hasBody) {
        body = _react["default"].createElement(BodyWrapper, {
          className: "".concat(prefixCls, "-tbody")
        }, this.renderRows(data, 0));

        if (getBodyWrapper) {
          body = getBodyWrapper(body);
        }
      }

      return _react["default"].createElement(Table, {
        className: tableClassName,
        style: tableStyle,
        key: "table"
      }, _react["default"].createElement(_ColGroup["default"], {
        columns: columns,
        fixed: fixed
      }), hasHead && _react["default"].createElement(_TableHeader["default"], {
        expander: expander,
        columns: columns,
        fixed: fixed
      }), body, hasFoot && _react["default"].createElement(_TableFooter["default"], {
        onHover: this.handleRowHover,
        columns: columns,
        fixed: fixed
      }));
    }
  }]);
  return BaseTable;
}(_react.Component);

(0, _defineProperty2["default"])(BaseTable, "propTypes", {
  fixed: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].bool]),
  columns: _propTypes["default"].array.isRequired,
  tableClassName: _propTypes["default"].string.isRequired,
  hasHead: _propTypes["default"].bool.isRequired,
  hasBody: _propTypes["default"].bool.isRequired,
  hasFoot: _propTypes["default"].bool.isRequired,
  store: _propTypes["default"].object.isRequired,
  expander: _propTypes["default"].object.isRequired,
  getRowKey: _propTypes["default"].func,
  isAnyColumnsFixed: _propTypes["default"].bool
});
(0, _defineProperty2["default"])(BaseTable, "contextTypes", {
  table: _propTypes["default"].any
});

var _default = (0, _miniStore.connect)()(BaseTable);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJhc2VUYWJsZS5qc3giXSwibmFtZXMiOlsiQmFzZVRhYmxlIiwiaXNIb3ZlciIsImtleSIsInByb3BzIiwic3RvcmUiLCJzZXRTdGF0ZSIsImN1cnJlbnRIb3ZlcktleSIsInJlbmRlckRhdGEiLCJpbmRlbnQiLCJhbmNlc3RvcktleXMiLCJ0YWJsZSIsImNvbnRleHQiLCJjb2x1bW5NYW5hZ2VyIiwiY29tcG9uZW50cyIsInByZWZpeENscyIsImNoaWxkcmVuQ29sdW1uTmFtZSIsInJvd0NsYXNzTmFtZSIsInJvd1JlZiIsIm9uUm93Q2xpY2siLCJvblJvd0RvdWJsZUNsaWNrIiwib25Sb3dDb250ZXh0TWVudSIsIm9uUm93TW91c2VFbnRlciIsIm9uUm93TW91c2VMZWF2ZSIsIm9uUm93IiwiZ2V0Um93S2V5IiwiZml4ZWQiLCJleHBhbmRlciIsImlzQW55Q29sdW1uc0ZpeGVkIiwicm93cyIsImkiLCJyZWNvcmQiLCJjbGFzc05hbWUiLCJvbkhvdmVyUHJvcHMiLCJvbkhvdmVyIiwiaGFuZGxlUm93SG92ZXIiLCJsZWFmQ29sdW1ucyIsImxlZnRMZWFmQ29sdW1ucyIsInJpZ2h0TGVhZkNvbHVtbnMiLCJyb3dQcmVmaXhDbHMiLCJyb3ciLCJuZWVkSW5kZW50U3BhY2VkIiwiaGFuZGxlRXhwYW5kQ2hhbmdlIiwiZXhwYW5kYWJsZVJvdyIsInB1c2giLCJyZW5kZXJSb3dzIiwibGVuZ3RoIiwic2Nyb2xsIiwiZGF0YSIsImdldEJvZHlXcmFwcGVyIiwidGFibGVDbGFzc05hbWUiLCJoYXNIZWFkIiwiaGFzQm9keSIsImhhc0Zvb3QiLCJjb2x1bW5zIiwidGFibGVTdHlsZSIsIngiLCJ0YWJsZUxheW91dCIsIndpZHRoIiwiVGFibGUiLCJCb2R5V3JhcHBlciIsImJvZHkiLCJ3cmFwcGVyIiwiQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwib25lT2ZUeXBlIiwic3RyaW5nIiwiYm9vbCIsImFycmF5IiwiaXNSZXF1aXJlZCIsIm9iamVjdCIsImZ1bmMiLCJh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OztpQ0FBbEI5RCxTLGVBQ2U7QUFDakJ5QixFQUFBQSxLQUFLLEVBQUVzQyxzQkFBVUMsU0FBVixDQUFvQixDQUN6QkQsc0JBQVVFLE1BRGUsRUFFekJGLHNCQUFVRyxJQUZlLENBQXBCLENBRFU7QUFLakJiLEVBQUFBLE9BQU8sRUFBRVUsc0JBQVVJLEtBQVYsQ0FBZ0JDLFVBTFI7QUFNakJuQixFQUFBQSxjQUFjLEVBQUVjLHNCQUFVRSxNQUFWLENBQWlCRyxVQU5oQjtBQU9qQmxCLEVBQUFBLE9BQU8sRUFBRWEsc0JBQVVHLElBQVYsQ0FBZUUsVUFQUDtBQVFqQmpCLEVBQUFBLE9BQU8sRUFBRVksc0JBQVVHLElBQVYsQ0FBZUUsVUFSUDtBQVNqQmhCLEVBQUFBLE9BQU8sRUFBRVcsc0JBQVVHLElBQVYsQ0FBZUUsVUFUUDtBQVVqQmhFLEVBQUFBLEtBQUssRUFBRTJELHNCQUFVTSxNQUFWLENBQWlCRCxVQVZQO0FBV2pCMUMsRUFBQUEsUUFBUSxFQUFFcUMsc0JBQVVNLE1BQVYsQ0FBaUJELFVBWFY7QUFZakI1QyxFQUFBQSxTQUFTLEVBQUV1QyxzQkFBVU8sSUFaSjtBQWFqQjNDLEVBQUFBLGlCQUFpQixFQUFFb0Msc0JBQVVHO0FBYlosQztpQ0FEZmxFLFMsa0JBaUJrQjtBQUNwQlUsRUFBQUEsS0FBSyxFQUFFcUQsc0JBQVVRO0FBREcsQzs7ZUFzSlQsMEJBQVV2RSxTQUFWLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdtaW5pLXN0b3JlJztcbmltcG9ydCBDb2xHcm91cCBmcm9tICcuL0NvbEdyb3VwJztcbmltcG9ydCBUYWJsZUhlYWRlciBmcm9tICcuL1RhYmxlSGVhZGVyJztcbmltcG9ydCBUYWJsZUZvb3RlciBmcm9tICcuL1RhYmxlRm9vdGVyJztcbmltcG9ydCBUYWJsZVJvdyBmcm9tICcuL1RhYmxlUm93JztcbmltcG9ydCBFeHBhbmRhYmxlUm93IGZyb20gJy4vRXhwYW5kYWJsZVJvdyc7XG5cbmNsYXNzIEJhc2VUYWJsZSBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgZml4ZWQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIFByb3BUeXBlcy5ib29sLFxuICAgIF0pLFxuICAgIGNvbHVtbnM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkLFxuICAgIHRhYmxlQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgaGFzSGVhZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBoYXNCb2R5OiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIGhhc0Zvb3Q6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgc3RvcmU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBleHBhbmRlcjogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGdldFJvd0tleTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgaXNBbnlDb2x1bW5zRml4ZWQ6IFByb3BUeXBlcy5ib29sLFxuICB9O1xuXG4gIHN0YXRpYyBjb250ZXh0VHlwZXMgPSB7XG4gICAgdGFibGU6IFByb3BUeXBlcy5hbnksXG4gIH07XG5cbiAgaGFuZGxlUm93SG92ZXIgPSAoaXNIb3Zlciwga2V5KSA9PiB7XG4gICAgdGhpcy5wcm9wcy5zdG9yZS5zZXRTdGF0ZSh7XG4gICAgICBjdXJyZW50SG92ZXJLZXk6IGlzSG92ZXIgPyBrZXkgOiBudWxsLFxuICAgIH0pO1xuICB9O1xuXG4gIHJlbmRlclJvd3MgPSAocmVuZGVyRGF0YSwgaW5kZW50LCBhbmNlc3RvcktleXMgPSBbXSkgPT4ge1xuICAgIGNvbnN0IHsgdGFibGUgfSA9IHRoaXMuY29udGV4dDtcbiAgICBjb25zdCB7IGNvbHVtbk1hbmFnZXIsIGNvbXBvbmVudHMgfSA9IHRhYmxlO1xuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENscyxcbiAgICAgIGNoaWxkcmVuQ29sdW1uTmFtZSxcbiAgICAgIHJvd0NsYXNzTmFtZSxcbiAgICAgIHJvd1JlZixcbiAgICAgIG9uUm93Q2xpY2ssXG4gICAgICBvblJvd0RvdWJsZUNsaWNrLFxuICAgICAgb25Sb3dDb250ZXh0TWVudSxcbiAgICAgIG9uUm93TW91c2VFbnRlcixcbiAgICAgIG9uUm93TW91c2VMZWF2ZSxcbiAgICAgIG9uUm93LFxuICAgIH0gPSB0YWJsZS5wcm9wcztcbiAgICBjb25zdCB7IGdldFJvd0tleSwgZml4ZWQsIGV4cGFuZGVyLCBpc0FueUNvbHVtbnNGaXhlZCB9ID0gdGhpcy5wcm9wcztcblxuICAgIGNvbnN0IHJvd3MgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVuZGVyRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgcmVjb3JkID0gcmVuZGVyRGF0YVtpXTtcbiAgICAgIGNvbnN0IGtleSA9IGdldFJvd0tleShyZWNvcmQsIGkpO1xuICAgICAgY29uc3QgY2xhc3NOYW1lID0gdHlwZW9mIHJvd0NsYXNzTmFtZSA9PT0gJ3N0cmluZydcbiAgICAgICAgPyByb3dDbGFzc05hbWVcbiAgICAgICAgOiByb3dDbGFzc05hbWUocmVjb3JkLCBpLCBpbmRlbnQpO1xuXG4gICAgICBjb25zdCBvbkhvdmVyUHJvcHMgPSB7fTtcbiAgICAgIGlmIChjb2x1bW5NYW5hZ2VyLmlzQW55Q29sdW1uc0ZpeGVkKCkpIHtcbiAgICAgICAgb25Ib3ZlclByb3BzLm9uSG92ZXIgPSB0aGlzLmhhbmRsZVJvd0hvdmVyO1xuICAgICAgfVxuXG4gICAgICBsZXQgbGVhZkNvbHVtbnM7XG4gICAgICBpZiAoZml4ZWQgPT09ICdsZWZ0Jykge1xuICAgICAgICBsZWFmQ29sdW1ucyA9IGNvbHVtbk1hbmFnZXIubGVmdExlYWZDb2x1bW5zKCk7XG4gICAgICB9IGVsc2UgaWYgKGZpeGVkID09PSAncmlnaHQnKSB7XG4gICAgICAgIGxlYWZDb2x1bW5zID0gY29sdW1uTWFuYWdlci5yaWdodExlYWZDb2x1bW5zKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZWFmQ29sdW1ucyA9IGNvbHVtbk1hbmFnZXIubGVhZkNvbHVtbnMoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgcm93UHJlZml4Q2xzID0gYCR7cHJlZml4Q2xzfS1yb3dgO1xuXG4gICAgICBjb25zdCByb3cgPSAoXG4gICAgICAgIDxFeHBhbmRhYmxlUm93XG4gICAgICAgICAgey4uLmV4cGFuZGVyLnByb3BzfVxuICAgICAgICAgIGZpeGVkPXtmaXhlZH1cbiAgICAgICAgICBpbmRleD17aX1cbiAgICAgICAgICBwcmVmaXhDbHM9e3Jvd1ByZWZpeENsc31cbiAgICAgICAgICByZWNvcmQ9e3JlY29yZH1cbiAgICAgICAgICBrZXk9e2tleX1cbiAgICAgICAgICByb3dLZXk9e2tleX1cbiAgICAgICAgICBvblJvd0NsaWNrPXtvblJvd0NsaWNrfVxuICAgICAgICAgIG5lZWRJbmRlbnRTcGFjZWQ9e2V4cGFuZGVyLm5lZWRJbmRlbnRTcGFjZWR9XG4gICAgICAgICAgb25FeHBhbmRlZENoYW5nZT17ZXhwYW5kZXIuaGFuZGxlRXhwYW5kQ2hhbmdlfVxuICAgICAgICA+XG4gICAgICAgICAgeyhleHBhbmRhYmxlUm93KSA9PiAoIC8vIGVzbGludC1kaXNhYmxlLWxpbmVcbiAgICAgICAgICAgIDxUYWJsZVJvd1xuICAgICAgICAgICAgICBmaXhlZD17Zml4ZWR9XG4gICAgICAgICAgICAgIGluZGVudD17aW5kZW50fVxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cbiAgICAgICAgICAgICAgcmVjb3JkPXtyZWNvcmR9XG4gICAgICAgICAgICAgIGluZGV4PXtpfVxuICAgICAgICAgICAgICBwcmVmaXhDbHM9e3Jvd1ByZWZpeENsc31cbiAgICAgICAgICAgICAgY2hpbGRyZW5Db2x1bW5OYW1lPXtjaGlsZHJlbkNvbHVtbk5hbWV9XG4gICAgICAgICAgICAgIGNvbHVtbnM9e2xlYWZDb2x1bW5zfVxuICAgICAgICAgICAgICBvblJvdz17b25Sb3d9XG4gICAgICAgICAgICAgIG9uUm93RG91YmxlQ2xpY2s9e29uUm93RG91YmxlQ2xpY2t9XG4gICAgICAgICAgICAgIG9uUm93Q29udGV4dE1lbnU9e29uUm93Q29udGV4dE1lbnV9XG4gICAgICAgICAgICAgIG9uUm93TW91c2VFbnRlcj17b25Sb3dNb3VzZUVudGVyfVxuICAgICAgICAgICAgICBvblJvd01vdXNlTGVhdmU9e29uUm93TW91c2VMZWF2ZX1cbiAgICAgICAgICAgICAgey4uLm9uSG92ZXJQcm9wc31cbiAgICAgICAgICAgICAgcm93S2V5PXtrZXl9XG4gICAgICAgICAgICAgIGFuY2VzdG9yS2V5cz17YW5jZXN0b3JLZXlzfVxuICAgICAgICAgICAgICByZWY9e3Jvd1JlZihyZWNvcmQsIGksIGluZGVudCl9XG4gICAgICAgICAgICAgIGNvbXBvbmVudHM9e2NvbXBvbmVudHN9XG4gICAgICAgICAgICAgIGlzQW55Q29sdW1uc0ZpeGVkPXtpc0FueUNvbHVtbnNGaXhlZH1cbiAgICAgICAgICAgICAgey4uLmV4cGFuZGFibGVSb3d9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvRXhwYW5kYWJsZVJvdz5cbiAgICAgICk7XG5cbiAgICAgIHJvd3MucHVzaChyb3cpO1xuXG4gICAgICBleHBhbmRlci5yZW5kZXJSb3dzKFxuICAgICAgICB0aGlzLnJlbmRlclJvd3MsXG4gICAgICAgIHJvd3MsXG4gICAgICAgIHJlY29yZCxcbiAgICAgICAgaSxcbiAgICAgICAgaW5kZW50LFxuICAgICAgICBmaXhlZCxcbiAgICAgICAga2V5LFxuICAgICAgICBhbmNlc3RvcktleXMsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gcm93cztcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyB0YWJsZSB9ID0gdGhpcy5jb250ZXh0O1xuICAgIGNvbnN0IHsgY29tcG9uZW50cyB9ID0gdGFibGU7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIHNjcm9sbCwgZGF0YSwgZ2V0Qm9keVdyYXBwZXIgfSA9IHRhYmxlLnByb3BzO1xuICAgIGNvbnN0IHsgZXhwYW5kZXIsIHRhYmxlQ2xhc3NOYW1lLCBoYXNIZWFkLCBoYXNCb2R5LCBoYXNGb290LCBmaXhlZCwgY29sdW1ucyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB0YWJsZVN0eWxlID0ge307XG5cbiAgICBpZiAoIWZpeGVkICYmIHNjcm9sbC54KSB7XG4gICAgICAvLyBub3Qgc2V0IHdpZHRoLCB0aGVuIHVzZSBjb250ZW50IGZpeGVkIHdpZHRoXG4gICAgICBpZiAoc2Nyb2xsLnggPT09IHRydWUpIHtcbiAgICAgICAgdGFibGVTdHlsZS50YWJsZUxheW91dCA9ICdmaXhlZCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YWJsZVN0eWxlLndpZHRoID0gc2Nyb2xsLng7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgVGFibGUgPSBoYXNCb2R5ID8gY29tcG9uZW50cy50YWJsZSA6ICd0YWJsZSc7XG4gICAgY29uc3QgQm9keVdyYXBwZXIgPSBjb21wb25lbnRzLmJvZHkud3JhcHBlcjtcblxuICAgIGxldCBib2R5O1xuICAgIGlmIChoYXNCb2R5KSB7XG4gICAgICBib2R5ID0gKFxuICAgICAgICA8Qm9keVdyYXBwZXIgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXRib2R5YH0+XG4gICAgICAgICAge3RoaXMucmVuZGVyUm93cyhkYXRhLCAwKX1cbiAgICAgICAgPC9Cb2R5V3JhcHBlcj5cbiAgICAgICk7XG4gICAgICBpZiAoZ2V0Qm9keVdyYXBwZXIpIHtcbiAgICAgICAgYm9keSA9IGdldEJvZHlXcmFwcGVyKGJvZHkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8VGFibGUgY2xhc3NOYW1lPXt0YWJsZUNsYXNzTmFtZX0gc3R5bGU9e3RhYmxlU3R5bGV9IGtleT1cInRhYmxlXCI+XG4gICAgICAgIDxDb2xHcm91cCBjb2x1bW5zPXtjb2x1bW5zfSBmaXhlZD17Zml4ZWR9IC8+XG4gICAgICAgIHtoYXNIZWFkICYmIDxUYWJsZUhlYWRlciBleHBhbmRlcj17ZXhwYW5kZXJ9IGNvbHVtbnM9e2NvbHVtbnN9IGZpeGVkPXtmaXhlZH0gLz59XG4gICAgICAgIHtib2R5fVxuICAgICAgICB7aGFzRm9vdCAmJiA8VGFibGVGb290ZXIgb25Ib3Zlcj17dGhpcy5oYW5kbGVSb3dIb3Zlcn0gY29sdW1ucz17Y29sdW1uc30gZml4ZWQ9e2ZpeGVkfSAvPn1cbiAgICAgIDwvVGFibGU+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KCkoQmFzZVRhYmxlKTtcbiJdfQ==