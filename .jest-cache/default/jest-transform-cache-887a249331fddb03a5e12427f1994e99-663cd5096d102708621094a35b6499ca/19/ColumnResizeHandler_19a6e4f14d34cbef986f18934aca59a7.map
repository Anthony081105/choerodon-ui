{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components-pro/performance-table/ColumnResizeHandler.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport clamp from 'lodash/clamp';\nimport { DOMMouseMoveTracker } from 'dom-lib';\nimport { defaultClassPrefix, getUnhandledProps } from './utils';\nimport TableContext from './TableContext';\nimport { ColumnResizeHandlerProps } from './ColumnResizeHandler.d';\n\nclass ColumnResizeHandler extends React.Component<ColumnResizeHandlerProps> {\n  static contextType = TableContext;\n\n  static propTypes = {\n    height: PropTypes.number,\n    defaultColumnWidth: PropTypes.number,\n    columnLeft: PropTypes.number,\n    columnFixed: PropTypes.oneOfType([PropTypes.bool, PropTypes.oneOf(['left', 'right'])]),\n    className: PropTypes.string,\n    classPrefix: PropTypes.string,\n    style: PropTypes.object,\n    onColumnResizeStart: PropTypes.func,\n    onColumnResizeEnd: PropTypes.func,\n    onColumnResizeMove: PropTypes.func,\n  };\n  static defaultProps = {\n    classPrefix: defaultClassPrefix('performance-table-column-resize-spanner'),\n  };\n\n  columnWidth = 0;\n  cursorDelta = 0;\n  mouseMoveTracker;\n  isKeyDown: boolean;\n\n  constructor(props) {\n    super(props);\n    this.columnWidth = props.defaultColumnWidth || 0;\n  }\n\n  componentWillUnmount() {\n    if (this.mouseMoveTracker) {\n      this.mouseMoveTracker.releaseMouseMoves();\n      this.mouseMoveTracker = null;\n    }\n  }\n\n  onMove = (deltaX: number) => {\n    if (!this.isKeyDown) {\n      return;\n    }\n\n    const { onColumnResizeMove, defaultColumnWidth, columnLeft, columnFixed } = this.props;\n    const { rtl } = this.context;\n    this.cursorDelta += deltaX;\n\n    this.columnWidth = clamp(\n      // @ts-ignore\n      defaultColumnWidth + (rtl ? -this.cursorDelta : this.cursorDelta),\n      20,\n      20000,\n    );\n    onColumnResizeMove?.(this.columnWidth, columnLeft, columnFixed);\n  };\n  onColumnResizeEnd = () => {\n    this.isKeyDown = false;\n    this.props.onColumnResizeEnd?.(this.columnWidth, this.cursorDelta);\n    this.mouseMoveTracker?.releaseMouseMoves?.();\n    this.mouseMoveTracker = null;\n  };\n  onColumnResizeMouseDown = (event: React.MouseEvent) => {\n    this.mouseMoveTracker = this.getMouseMoveTracker();\n    this.mouseMoveTracker.captureMouseMoves(event);\n    this.isKeyDown = true;\n    this.cursorDelta = 0;\n\n    const client = {\n      clientX: event.clientX,\n      clientY: event.clientY,\n      preventDefault: Function(),\n    };\n\n    this.props.onColumnResizeStart?.(client);\n  };\n\n  getMouseMoveTracker() {\n    return (\n      this.mouseMoveTracker ||\n      new DOMMouseMoveTracker(this.onMove, this.onColumnResizeEnd, document.body)\n    );\n  }\n\n  render() {\n    const {\n      columnLeft = 0,\n      classPrefix,\n      height,\n      className,\n      style,\n      columnFixed,\n      ...rest\n    } = this.props;\n\n    if (columnFixed === 'right') {\n      return null;\n    }\n    const { rtl } = this.context;\n    const styles = {\n      [rtl ? 'right' : 'left']: this.columnWidth + columnLeft - 2,\n      height,\n      ...style,\n    };\n\n    const classes = classNames(classPrefix, className);\n    const unhandled = getUnhandledProps(ColumnResizeHandler, rest);\n\n    return (\n      <div\n        {...unhandled}\n        className={classes}\n        style={styles}\n        onMouseDown={this.onColumnResizeMouseDown}\n        role=\"button\"\n        tabIndex={-1}\n      />\n    );\n  }\n}\n\nexport default ColumnResizeHandler;\n"]}