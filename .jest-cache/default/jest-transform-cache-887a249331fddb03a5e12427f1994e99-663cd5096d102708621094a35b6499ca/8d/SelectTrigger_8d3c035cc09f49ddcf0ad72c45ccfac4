5b0b4a90bfefe2932ad31e69b8efb1ca
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _trigger = _interopRequireDefault(require("../trigger"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _DropdownMenu = _interopRequireDefault(require("./DropdownMenu"));

var _reactDom = _interopRequireDefault(require("react-dom"));

var _util = require("./util");

var _spin = _interopRequireDefault(require("../../spin"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

_trigger["default"].displayName = 'Trigger';
var BUILT_IN_PLACEMENTS = {
  bottomLeft: {
    points: ['tl', 'bl'],
    offset: [0, 4],
    overflow: {
      adjustX: 0,
      adjustY: 1
    }
  },
  topLeft: {
    points: ['bl', 'tl'],
    offset: [0, -4],
    overflow: {
      adjustX: 0,
      adjustY: 1
    }
  },
  bottomRight: {
    points: ['tr', 'br'],
    offset: [0, 4],
    overflow: {
      adjustX: 0,
      adjustY: 1
    }
  }
};

var SelectTrigger =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(SelectTrigger, _Component);

  var _super = _createSuper(SelectTrigger);

  function SelectTrigger() {
    var _this;

    (0, _classCallCheck2["default"])(this, SelectTrigger);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      dropdownWidth: null
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setDropdownWidth", function () {
      var width = _reactDom["default"].findDOMNode((0, _assertThisInitialized2["default"])(_this)).offsetWidth;

      if (width !== _this.state.dropdownWidth) {
        _this.setState({
          dropdownWidth: width
        });
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getInnerMenu", function () {
      return _this.dropdownMenuRef && _this.dropdownMenuRef.menuRef;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getFilterInput", function () {
      return _this.dropdownMenuRef && _this.dropdownMenuRef.filterRef;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getPopupDOMNode", function () {
      return _this.triggerRef.getPopupDomNode();
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getDropdownElement", function (newProps) {
      var props = _this.props;
      var loading = props.loading;

      if (typeof loading === 'boolean') {
        loading = {
          spinning: loading
        };
      }

      return _react["default"].createElement(_spin["default"], loading, _react["default"].createElement(_DropdownMenu["default"], (0, _extends2["default"])({
        ref: (0, _util.saveRef)((0, _assertThisInitialized2["default"])(_this), 'dropdownMenuRef')
      }, newProps, {
        prefixCls: _this.getDropdownPrefixCls(),
        onMenuSelect: props.onMenuSelect,
        onMenuDeselect: props.onMenuDeselect,
        onPopupScroll: props.onPopupScroll,
        onKeyDown: props.onKeyDown,
        value: props.value,
        placeholder: props.filterPlaceholder,
        checkAll: props.checkAll,
        backfillValue: props.backfillValue,
        firstActiveValue: props.firstActiveValue,
        defaultActiveFirstOption: props.defaultActiveFirstOption,
        dropdownMenuStyle: props.dropdownMenuStyle,
        onFilterChange: props.onFilterChange,
        footer: props.footer,
        onMouseDown: props.onDropdownMouseDown
      })));
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getDropdownTransitionName", function () {
      var props = _this.props;
      var transitionName = props.transitionName;

      if (!transitionName && props.animation) {
        transitionName = "".concat(_this.getDropdownPrefixCls(), "-").concat(props.animation);
      }

      return transitionName;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "getDropdownPrefixCls", function () {
      return "".concat(_this.props.prefixCls, "-dropdown");
    });
    return _this;
  }

  (0, _createClass2["default"])(SelectTrigger, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.setDropdownWidth();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this.setDropdownWidth();
    }
  }, {
    key: "render",
    value: function render() {
      var _popupClassName;

      var _this$props = this.props,
          onPopupFocus = _this$props.onPopupFocus,
          props = (0, _objectWithoutProperties2["default"])(_this$props, ["onPopupFocus"]);
      var multiple = props.multiple,
          visible = props.visible,
          inputValue = props.inputValue,
          dropdownAlign = props.dropdownAlign,
          disabled = props.disabled,
          showSearch = props.showSearch,
          dropdownClassName = props.dropdownClassName,
          dropdownStyle = props.dropdownStyle,
          dropdownMatchSelectWidth = props.dropdownMatchSelectWidth,
          filter = props.filter,
          filterValue = props.filterValue;
      var dropdownPrefixCls = this.getDropdownPrefixCls();
      var popupClassName = (_popupClassName = {}, (0, _defineProperty2["default"])(_popupClassName, dropdownClassName, !!dropdownClassName), (0, _defineProperty2["default"])(_popupClassName, "".concat(dropdownPrefixCls, "--").concat(multiple ? 'multiple' : 'single'), 1), _popupClassName);
      var popupElement = this.getDropdownElement({
        menuItems: props.options,
        onPopupFocus: onPopupFocus,
        multiple: multiple,
        inputValue: inputValue,
        visible: visible,
        filter: filter,
        filterValue: filterValue
      });
      var popupStyle = (0, _objectSpread2["default"])({}, dropdownStyle);
      var widthProp = dropdownMatchSelectWidth ? 'width' : 'minWidth';

      if (this.state.dropdownWidth && !popupStyle[widthProp]) {
        popupStyle[widthProp] = "".concat(this.state.dropdownWidth, "px");
      }

      return _react["default"].createElement(_trigger["default"], (0, _extends2["default"])({}, props, {
        action: disabled ? [] : ['click'],
        ref: (0, _util.saveRef)(this, 'triggerRef'),
        popupPlacement: props.popupPlacement,
        builtinPlacements: props.builtinPlacements || BUILT_IN_PLACEMENTS,
        prefixCls: dropdownPrefixCls,
        popupTransitionName: this.getDropdownTransitionName(),
        onPopupVisibleChange: props.onDropdownVisibleChange,
        popup: popupElement,
        popupAlign: dropdownAlign,
        popupVisible: visible,
        getPopupContainer: props.getPopupContainer,
        popupClassName: (0, _classnames["default"])(popupClassName),
        popupStyle: popupStyle
      }), props.children);
    }
  }]);
  return SelectTrigger;
}(_react.Component);

exports["default"] = SelectTrigger;
(0, _defineProperty2["default"])(SelectTrigger, "propTypes", {
  onPopupFocus: _propTypes["default"].func,
  onPopupScroll: _propTypes["default"].func,
  dropdownMatchSelectWidth: _propTypes["default"].bool,
  dropdownAlign: _propTypes["default"].object,
  visible: _propTypes["default"].bool,
  disabled: _propTypes["default"].bool,
  showSearch: _propTypes["default"].bool,
  dropdownClassName: _propTypes["default"].string,
  onDropdownMouseDown: _propTypes["default"].any,
  dropdownStyle: _propTypes["default"].any,
  multiple: _propTypes["default"].bool,
  inputValue: _propTypes["default"].string,
  filterOption: _propTypes["default"].any,
  options: _propTypes["default"].any,
  prefixCls: _propTypes["default"].string,
  popupClassName: _propTypes["default"].string,
  popupPlacement: _propTypes["default"].string,
  children: _propTypes["default"].any,
  filter: _propTypes["default"].bool,
  builtinPlacements: _propTypes["default"].any,
  getRootDomNode: _propTypes["default"].func,
  loading: _propTypes["default"].oneOfType([_propTypes["default"].bool, _propTypes["default"].object]),
  onKeyDown: _propTypes["default"].func
});
(0, _defineProperty2["default"])(SelectTrigger, "defaultProps", {
  popupPlacement: 'bottomLeft',
  loading: false
});
SelectTrigger.displayName = 'SelectTrigger';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNlbGVjdFRyaWdnZXIuanN4Il0sIm5hbWVzIjpbIlRyaWdnZXIiLCJkaXNwbGF5TmFtZSIsIkJVSUxUX0lOX1BMQUNFTUVOVFMiLCJib3R0b21MZWZ0IiwicG9pbnRzIiwib2Zmc2V0Iiwib3ZlcmZsb3ciLCJhZGp1c3RYIiwiYWRqdXN0WSIsInRvcExlZnQiLCJib3R0b21SaWdodCIsIlNlbGVjdFRyaWdnZXIiLCJkcm9wZG93bldpZHRoIiwid2lkdGgiLCJSZWFjdERPTSIsImZpbmRET01Ob2RlIiwib2Zmc2V0V2lkdGgiLCJzdGF0ZSIsInNldFN0YXRlIiwiZHJvcGRvd25NZW51UmVmIiwibWVudVJlZiIsImZpbHRlclJlZiIsInRyaWdnZXJSZWYiLCJnZXRQb3B1cERvbU5vZGUiLCJuZXdQcm9wcyIsInByb3BzIiwibG9hZGluZyIsInNwaW5uaW5nIiwiZ2V0RHJvcGRvd25QcmVmaXhDbHMiLCJvbk1lbnVTZWxlY3QiLCJvbk1lbnVEZXNlbGVjdCIsIm9uUG9wdXBTY3JvbGwiLCJvbktleURvd24iLCJ2YWx1ZSIsImZpbHRlclBsYWNlaG9sZGVyIiwiY2hlY2tBbGwiLCJiYWNrZmlsbFZhbHVlIiwiZmlyc3RBY3RpdmVWYWx1ZSIsImRlZmF1bHRBY3RpdmVGaXJzdE9wdGlvbiIsImRyb3Bkb3duTWVudVN0eWxlIiwib25GaWx0ZXJDaGFuZ2UiLCJmb290ZXIiLCJvbkRyb3Bkb3duTW91c2VEb3duIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb24iLCJwcmVmaXhDbHMiLCJzZXREcm9wZG93bldpZHRoIiwib25Qb3B1cEZvY3VzIiwibXVsdGlwbGUiLCJ2aXNpYmxlIiwiaW5wdXRWYWx1ZSIsImRyb3Bkb3duQWxpZ24iLCJkaXNhYmxlZCIsInNob3dTZWFyY2giLCJkcm9wZG93bkNsYXNzTmFtZSIsImRyb3Bkb3duU3R5bGUiLCJkcm9wZG93bk1hdGNoU2VsZWN0V2lkdGgiLCJmaWx0ZXIiLCJmaWx0ZXJWYWx1ZSIsImRyb3Bkb3duUHJlZml4Q2xzIiwicG9wdXBDbGFzc05hbWUiLCJwb3B1cEVsZW1lbnQiLCJnZXREcm9wZG93bkVsZW1lbnQiLCJtZW51SXRlbXMiLCJvcHRpb25zIiwicG9wdXBTdHlsZSIsIndpZHRoUHJvcCIsInBvcHVwUGxhY2VtZW50IiwiYnVpbHRpblBsYWNlbWVudHMiLCJnZXREcm9wZG93blRyYW5zaXRpb25OYW1lIiwib25Ecm9wZG93blZpc2libGVDaGFuZ2UiLCJnZXRQb3B1cENvbnRhaW5lciIsImNoaWxkcmVuIiwiQ29tcG9uZW50IiwiUHJvcFR5cGVzIiwiZnVuYyIsImJvb2wiLCJvYmplY3QiLCJzdHJpbmciLCJhbnkiLCJmaWx0ZXJPcHRpb24iLCJnZXRSb290RG9tTm9kZSIsIm9uZU9mVHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUFBLG9CQUFRQyxXQUFSLEdBQXNCLFNBQXRCO0FBRUEsSUFBTUMsbUJBQW1CLEdBQUc7QUFDMUJDLEVBQUFBLFVBQVUsRUFBRTtBQUNWQyxJQUFBQSxNQUFNLEVBQUUsQ0FBQyxJQUFELEVBQU8sSUFBUCxDQURFO0FBRVZDLElBQUFBLE1BQU0sRUFBRSxDQUFDLENBQUQsRUFBSSxDQUFKLENBRkU7QUFHVkMsSUFBQUEsUUFBUSxFQUFFO0FBQ1JDLE1BQUFBLE9BQU8sRUFBRSxDQUREO0FBRVJDLE1BQUFBLE9BQU8sRUFBRTtBQUZEO0FBSEEsR0FEYztBQVMxQkMsRUFBQUEsT0FBTyxFQUFFO0FBQ1BMLElBQUFBLE1BQU0sRUFBRSxDQUFDLElBQUQsRUFBTyxJQUFQLENBREQ7QUFFUEMsSUFBQUEsTUFBTSxFQUFFLENBQUMsQ0FBRCxFQUFJLENBQUMsQ0FBTCxDQUZEO0FBR1BDLElBQUFBLFFBQVEsRUFBRTtBQUNSQyxNQUFBQSxPQUFPLEVBQUUsQ0FERDtBQUVSQyxNQUFBQSxPQUFPLEVBQUU7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QXFCakJFLEVBQUFBLGNBQWMsRUFBRVAsc0JBQVVDLElBckJUO0FBc0JqQmpELEVBQUFBLE9BQU8sRUFBRWdELHNCQUFVUSxTQUFWLENBQW9CLENBQzNCUixzQkFBVUUsSUFEaUIsRUFFM0JGLHNCQUFVRyxNQUZpQixDQUFwQixDQXRCUTtBQTBCakI3QyxFQUFBQSxTQUFTLEVBQUUwQyxzQkFBVUM7QUExQkosQztpQ0FEQWhFLGEsa0JBOEJHO0FBQ3BCd0QsRUFBQUEsY0FBYyxFQUFFLFlBREk7QUFFcEJ6QyxFQUFBQSxPQUFPLEVBQUU7QUFGVyxDO0FBOEl4QmYsYUFBYSxDQUFDVixXQUFkLEdBQTRCLGVBQTVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRyaWdnZXIgZnJvbSAnLi4vdHJpZ2dlcic7XG5pbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IERyb3Bkb3duTWVudSBmcm9tICcuL0Ryb3Bkb3duTWVudSc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCB7IGlzU2luZ2xlTW9kZSwgc2F2ZVJlZiB9IGZyb20gJy4vdXRpbCc7XG5pbXBvcnQgU3BpbiBmcm9tICcuLi8uLi9zcGluJztcblxuVHJpZ2dlci5kaXNwbGF5TmFtZSA9ICdUcmlnZ2VyJztcblxuY29uc3QgQlVJTFRfSU5fUExBQ0VNRU5UUyA9IHtcbiAgYm90dG9tTGVmdDoge1xuICAgIHBvaW50czogWyd0bCcsICdibCddLFxuICAgIG9mZnNldDogWzAsIDRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAwLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICB0b3BMZWZ0OiB7XG4gICAgcG9pbnRzOiBbJ2JsJywgJ3RsJ10sXG4gICAgb2Zmc2V0OiBbMCwgLTRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAwLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICBib3R0b21SaWdodDoge1xuICAgIHBvaW50czogWyd0cicsICdiciddLFxuICAgIG9mZnNldDogWzAsIDRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAwLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VsZWN0VHJpZ2dlciBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgb25Qb3B1cEZvY3VzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvblBvcHVwU2Nyb2xsOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBkcm9wZG93bk1hdGNoU2VsZWN0V2lkdGg6IFByb3BUeXBlcy5ib29sLFxuICAgIGRyb3Bkb3duQWxpZ246IFByb3BUeXBlcy5vYmplY3QsXG4gICAgdmlzaWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHNob3dTZWFyY2g6IFByb3BUeXBlcy5ib29sLFxuICAgIGRyb3Bkb3duQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9uRHJvcGRvd25Nb3VzZURvd246IFByb3BUeXBlcy5hbnksXG4gICAgZHJvcGRvd25TdHlsZTogUHJvcFR5cGVzLmFueSxcbiAgICBtdWx0aXBsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgaW5wdXRWYWx1ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBmaWx0ZXJPcHRpb246IFByb3BUeXBlcy5hbnksXG4gICAgb3B0aW9uczogUHJvcFR5cGVzLmFueSxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgcG9wdXBDbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgcG9wdXBQbGFjZW1lbnQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gICAgZmlsdGVyOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBidWlsdGluUGxhY2VtZW50czogUHJvcFR5cGVzLmFueSxcbiAgICBnZXRSb290RG9tTm9kZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgbG9hZGluZzogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICBQcm9wVHlwZXMuYm9vbCxcbiAgICAgIFByb3BUeXBlcy5vYmplY3QsXG4gICAgXSksXG4gICAgb25LZXlEb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHBvcHVwUGxhY2VtZW50OiAnYm90dG9tTGVmdCcsXG4gICAgbG9hZGluZzogZmFsc2UsXG4gIH07XG5cbiAgc3RhdGUgPSB7XG4gICAgZHJvcGRvd25XaWR0aDogbnVsbCxcbiAgfTtcblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnNldERyb3Bkb3duV2lkdGgoKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnNldERyb3Bkb3duV2lkdGgoKTtcbiAgfVxuXG4gIHNldERyb3Bkb3duV2lkdGggPSAoKSA9PiB7XG4gICAgY29uc3Qgd2lkdGggPSBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKS5vZmZzZXRXaWR0aDtcbiAgICBpZiAod2lkdGggIT09IHRoaXMuc3RhdGUuZHJvcGRvd25XaWR0aCkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGRyb3Bkb3duV2lkdGg6IHdpZHRoIH0pO1xuICAgIH1cbiAgfTtcblxuICBnZXRJbm5lck1lbnUgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuZHJvcGRvd25NZW51UmVmICYmIHRoaXMuZHJvcGRvd25NZW51UmVmLm1lbnVSZWY7XG4gIH07XG5cbiAgZ2V0RmlsdGVySW5wdXQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuZHJvcGRvd25NZW51UmVmICYmIHRoaXMuZHJvcGRvd25NZW51UmVmLmZpbHRlclJlZjtcbiAgfVxuXG4gIGdldFBvcHVwRE9NTm9kZSA9ICgpID0+IHtcbiAgICByZXR1cm4gdGhpcy50cmlnZ2VyUmVmLmdldFBvcHVwRG9tTm9kZSgpO1xuICB9O1xuXG4gIGdldERyb3Bkb3duRWxlbWVudCA9IG5ld1Byb3BzID0+IHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgbGV0IGxvYWRpbmcgPSBwcm9wcy5sb2FkaW5nO1xuICAgIGlmICh0eXBlb2YgbG9hZGluZyA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBsb2FkaW5nID0ge1xuICAgICAgICBzcGlubmluZzogbG9hZGluZyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8U3BpbiB7Li4ubG9hZGluZ30+XG4gICAgICAgIDxEcm9wZG93bk1lbnVcbiAgICAgICAgICByZWY9e3NhdmVSZWYodGhpcywgJ2Ryb3Bkb3duTWVudVJlZicpfVxuICAgICAgICAgIHsuLi5uZXdQcm9wc31cbiAgICAgICAgICBwcmVmaXhDbHM9e3RoaXMuZ2V0RHJvcGRvd25QcmVmaXhDbHMoKX1cbiAgICAgICAgICBvbk1lbnVTZWxlY3Q9e3Byb3BzLm9uTWVudVNlbGVjdH1cbiAgICAgICAgICBvbk1lbnVEZXNlbGVjdD17cHJvcHMub25NZW51RGVzZWxlY3R9XG4gICAgICAgICAgb25Qb3B1cFNjcm9sbD17cHJvcHMub25Qb3B1cFNjcm9sbH1cbiAgICAgICAgICBvbktleURvd249e3Byb3BzLm9uS2V5RG93bn1cbiAgICAgICAgICB2YWx1ZT17cHJvcHMudmFsdWV9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9e3Byb3BzLmZpbHRlclBsYWNlaG9sZGVyfVxuICAgICAgICAgIGNoZWNrQWxsPXtwcm9wcy5jaGVja0FsbH1cbiAgICAgICAgICBiYWNrZmlsbFZhbHVlPXtwcm9wcy5iYWNrZmlsbFZhbHVlfVxuICAgICAgICAgIGZpcnN0QWN0aXZlVmFsdWU9e3Byb3BzLmZpcnN0QWN0aXZlVmFsdWV9XG4gICAgICAgICAgZGVmYXVsdEFjdGl2ZUZpcnN0T3B0aW9uPXtwcm9wcy5kZWZhdWx0QWN0aXZlRmlyc3RPcHRpb259XG4gICAgICAgICAgZHJvcGRvd25NZW51U3R5bGU9e3Byb3BzLmRyb3Bkb3duTWVudVN0eWxlfVxuICAgICAgICAgIG9uRmlsdGVyQ2hhbmdlPXtwcm9wcy5vbkZpbHRlckNoYW5nZX1cbiAgICAgICAgICBmb290ZXI9e3Byb3BzLmZvb3Rlcn1cbiAgICAgICAgICBvbk1vdXNlRG93bj17cHJvcHMub25Ecm9wZG93bk1vdXNlRG93bn1cbiAgICAgIC8+XG4gICAgICA8L1NwaW4+XG5cbiAgICApO1xuICB9O1xuXG4gIGdldERyb3Bkb3duVHJhbnNpdGlvbk5hbWUgPSAoKSA9PiB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGxldCB0cmFuc2l0aW9uTmFtZSA9IHByb3BzLnRyYW5zaXRpb25OYW1lO1xuICAgIGlmICghdHJhbnNpdGlvbk5hbWUgJiYgcHJvcHMuYW5pbWF0aW9uKSB7XG4gICAgICB0cmFuc2l0aW9uTmFtZSA9IGAke3RoaXMuZ2V0RHJvcGRvd25QcmVmaXhDbHMoKX0tJHtwcm9wcy5hbmltYXRpb259YDtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zaXRpb25OYW1lO1xuICB9O1xuXG4gIGdldERyb3Bkb3duUHJlZml4Q2xzID0gKCkgPT4ge1xuICAgIHJldHVybiBgJHt0aGlzLnByb3BzLnByZWZpeENsc30tZHJvcGRvd25gO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IG9uUG9wdXBGb2N1cywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qge1xuICAgICAgbXVsdGlwbGUsXG4gICAgICB2aXNpYmxlLFxuICAgICAgaW5wdXRWYWx1ZSxcbiAgICAgIGRyb3Bkb3duQWxpZ24sXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIHNob3dTZWFyY2gsXG4gICAgICBkcm9wZG93bkNsYXNzTmFtZSxcbiAgICAgIGRyb3Bkb3duU3R5bGUsXG4gICAgICBkcm9wZG93bk1hdGNoU2VsZWN0V2lkdGgsXG4gICAgICBmaWx0ZXIsXG4gICAgICBmaWx0ZXJWYWx1ZSxcbiAgICB9ID0gcHJvcHM7XG4gICAgY29uc3QgZHJvcGRvd25QcmVmaXhDbHMgPSB0aGlzLmdldERyb3Bkb3duUHJlZml4Q2xzKCk7XG4gICAgY29uc3QgcG9wdXBDbGFzc05hbWUgPSB7XG4gICAgICBbZHJvcGRvd25DbGFzc05hbWVdOiAhIWRyb3Bkb3duQ2xhc3NOYW1lLFxuICAgICAgW2Ake2Ryb3Bkb3duUHJlZml4Q2xzfS0tJHttdWx0aXBsZSA/ICdtdWx0aXBsZScgOiAnc2luZ2xlJ31gXTogMSxcbiAgICB9O1xuICAgIGNvbnN0IHBvcHVwRWxlbWVudCA9IHRoaXMuZ2V0RHJvcGRvd25FbGVtZW50KHtcbiAgICAgIG1lbnVJdGVtczogcHJvcHMub3B0aW9ucyxcbiAgICAgIG9uUG9wdXBGb2N1cyxcbiAgICAgIG11bHRpcGxlLFxuICAgICAgaW5wdXRWYWx1ZSxcbiAgICAgIHZpc2libGUsXG4gICAgICBmaWx0ZXIsXG4gICAgICBmaWx0ZXJWYWx1ZSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHBvcHVwU3R5bGUgPSB7IC4uLmRyb3Bkb3duU3R5bGUgfTtcbiAgICBjb25zdCB3aWR0aFByb3AgPSBkcm9wZG93bk1hdGNoU2VsZWN0V2lkdGggPyAnd2lkdGgnIDogJ21pbldpZHRoJztcbiAgICBpZiAodGhpcy5zdGF0ZS5kcm9wZG93bldpZHRoICYmICFwb3B1cFN0eWxlW3dpZHRoUHJvcF0pIHtcbiAgICAgIHBvcHVwU3R5bGVbd2lkdGhQcm9wXSA9IGAke3RoaXMuc3RhdGUuZHJvcGRvd25XaWR0aH1weGA7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxUcmlnZ2VyXG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgYWN0aW9uPXtkaXNhYmxlZCA/IFtdIDogWydjbGljayddfVxuICAgICAgICByZWY9e3NhdmVSZWYodGhpcywgJ3RyaWdnZXJSZWYnKX1cbiAgICAgICAgcG9wdXBQbGFjZW1lbnQ9e3Byb3BzLnBvcHVwUGxhY2VtZW50fVxuICAgICAgICBidWlsdGluUGxhY2VtZW50cz17cHJvcHMuYnVpbHRpblBsYWNlbWVudHMgfHwgQlVJTFRfSU5fUExBQ0VNRU5UU31cbiAgICAgICAgcHJlZml4Q2xzPXtkcm9wZG93blByZWZpeENsc31cbiAgICAgICAgcG9wdXBUcmFuc2l0aW9uTmFtZT17dGhpcy5nZXREcm9wZG93blRyYW5zaXRpb25OYW1lKCl9XG4gICAgICAgIG9uUG9wdXBWaXNpYmxlQ2hhbmdlPXtwcm9wcy5vbkRyb3Bkb3duVmlzaWJsZUNoYW5nZX1cbiAgICAgICAgcG9wdXA9e3BvcHVwRWxlbWVudH1cbiAgICAgICAgcG9wdXBBbGlnbj17ZHJvcGRvd25BbGlnbn1cbiAgICAgICAgcG9wdXBWaXNpYmxlPXt2aXNpYmxlfVxuICAgICAgICBnZXRQb3B1cENvbnRhaW5lcj17cHJvcHMuZ2V0UG9wdXBDb250YWluZXJ9XG4gICAgICAgIHBvcHVwQ2xhc3NOYW1lPXtjbGFzc25hbWVzKHBvcHVwQ2xhc3NOYW1lKX1cbiAgICAgICAgcG9wdXBTdHlsZT17cG9wdXBTdHlsZX1cbiAgICAgID5cbiAgICAgICAge3Byb3BzLmNoaWxkcmVufVxuICAgICAgPC9UcmlnZ2VyPlxuICAgICk7XG4gIH1cbn1cblxuU2VsZWN0VHJpZ2dlci5kaXNwbGF5TmFtZSA9ICdTZWxlY3RUcmlnZ2VyJztcbiJdfQ==