13386f7c6f4e74439013b5047d68d42d
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _arrayTreeFilter = _interopRequireDefault(require("array-tree-filter"));

var _isEqual = _interopRequireDefault(require("lodash/isEqual"));

var _trigger = _interopRequireDefault(require("../trigger"));

var _icon = _interopRequireDefault(require("../../icon"));

var _Menus = _interopRequireDefault(require("./Menus"));

var _KeyCode = _interopRequireDefault(require("../../_util/KeyCode"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var BUILT_IN_PLACEMENTS = {
  bottomLeft: {
    points: ['tl', 'bl'],
    offset: [0, 4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  topLeft: {
    points: ['bl', 'tl'],
    offset: [0, -4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  bottomRight: {
    points: ['tr', 'br'],
    offset: [0, 4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  },
  topRight: {
    points: ['br', 'tr'],
    offset: [0, -4],
    overflow: {
      adjustX: 1,
      adjustY: 1
    }
  }
};

var Cascader =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Cascader, _Component);

  var _super = _createSuper(Cascader);

  function Cascader(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Cascader);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "setPopupVisible", function (popupVisible) {
      if (!('popupVisible' in _this.props)) {
        _this.setState({
          popupVisible: popupVisible
        });
      } // sync activeValue with value when panel open


      if (popupVisible && !_this.state.visible) {
        _this.setState({
          activeValue: _this.state.value
        });
      }

      _this.props.onPopupVisibleChange(popupVisible);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleChange", function (options, setProps, e) {
      if (e.type !== 'keydown' || e.keyCode === _KeyCode["default"].ENTER) {
        _this.props.onChange(options.map(function (o) {
          return o.value;
        }), options);

        _this.setPopupVisible(setProps.visible);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handlePopupVisibleChange", function (popupVisible) {
      _this.setPopupVisible(popupVisible);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleMenuSelect", function (targetOption, menuIndex, e) {
      // Keep focused state for keyboard support
      var triggerNode = _this.trigger.getRootDomNode();

      if (triggerNode && triggerNode.focus) {
        triggerNode.focus();
      }

      var _this$props = _this.props,
          changeOnSelect = _this$props.changeOnSelect,
          loadData = _this$props.loadData,
          expandTrigger = _this$props.expandTrigger;

      if (!targetOption || targetOption.disabled) {
        return;
      }

      var activeValue = _this.state.activeValue;
      activeValue = activeValue.slice(0, menuIndex + 1);
      activeValue[menuIndex] = targetOption.value;

      var activeOptions = _this.getActiveOptions(activeValue);

      if (targetOption.isLeaf === false && !targetOption.children && loadData) {
        if (changeOnSelect) {
          _this.handleChange(activeOptions, {
            visible: true
          }, e);
        }

        _this.setState({
          activeValue: activeValue
        });

        loadData(activeOptions);
        return;
      }

      var newState = {};

      if (!targetOption.children || !targetOption.children.length) {
        _this.handleChange(activeOptions, {
          visible: false
        }, e); // set value to activeValue when select leaf option


        newState.value = activeValue; // add e.type judgement to prevent `onChange` being triggered by mouseEnter
      } else if (changeOnSelect && (e.type === 'click' || e.type === 'keydown')) {
        if (expandTrigger === 'hover') {
          _this.handleChange(activeOptions, {
            visible: false
          }, e);
        } else {
          _this.handleChange(activeOptions, {
            visible: true
          }, e);
        } // set value to activeValue on every select


        newState.value = activeValue;
      }

      newState.activeValue = activeValue; //  not change the value by keyboard

      if ('value' in _this.props || e.type === 'keydown' && e.keyCode !== _KeyCode["default"].ENTER) {
        delete newState.value;
      }

      _this.setState(newState);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleKeyDown", function (e) {
      var children = _this.props.children; // Don't bind keyboard support when children specify the onKeyDown

      if (children && children.props.onKeyDown) {
        children.props.onKeyDown(e);
        return;
      }

      var activeValue = (0, _toConsumableArray2["default"])(_this.state.activeValue);
      var currentLevel = activeValue.length - 1 < 0 ? 0 : activeValue.length - 1;

      var currentOptions = _this.getCurrentLevelOptions();

      var currentIndex = currentOptions.map(function (o) {
        return o.value;
      }).indexOf(activeValue[currentLevel]);

      if (e.keyCode !== _KeyCode["default"].DOWN && e.keyCode !== _KeyCode["default"].UP && e.keyCode !== _KeyCode["default"].LEFT && e.keyCode !== _KeyCode["default"].RIGHT && e.keyCode !== _KeyCode["default"].ENTER && e.keyCode !== _KeyCode["default"].BACKSPACE && e.keyCode !== _KeyCode["default"].ESC) {
        return;
      } // Press any keys above to reopen menu


      if (!_this.state.popupVisible && e.keyCode !== _KeyCode["default"].BACKSPACE && e.keyCode !== _KeyCode["default"].LEFT && e.keyCode !== _KeyCode["default"].RIGHT && e.keyCode !== _KeyCode["default"].ESC) {
        _this.setPopupVisible(true);

        return;
      }

      if (e.keyCode === _KeyCode["default"].DOWN || e.keyCode === _KeyCode["default"].UP) {
        var nextIndex = currentIndex;

        if (nextIndex !== -1) {
          if (e.keyCode === _KeyCode["default"].DOWN) {
            nextIndex += 1;
            nextIndex = nextIndex >= currentOptions.length ? 0 : nextIndex;
          } else {
            nextIndex -= 1;
            nextIndex = nextIndex < 0 ? currentOptions.length - 1 : nextIndex;
          }
        } else {
          nextIndex = 0;
        }

        activeValue[currentLevel] = currentOptions[nextIndex].value;
      } else if (e.keyCode === _KeyCode["default"].LEFT || e.keyCode === _KeyCode["default"].BACKSPACE) {
        activeValue.splice(activeValue.length - 1, 1);
      } else if (e.keyCode === _KeyCode["default"].RIGHT) {
        if (currentOptions[currentIndex] && currentOptions[currentIndex].children) {
          activeValue.push(currentOptions[currentIndex].children[0].value);
        }
      } else if (e.keyCode === _KeyCode["default"].ESC) {
        _this.setPopupVisible(false);

        return;
      }

      if (!activeValue || activeValue.length === 0) {
        _this.setPopupVisible(false);
      }

      var activeOptions = _this.getActiveOptions(activeValue);

      var targetOption = activeOptions[activeOptions.length - 1];

      _this.handleMenuSelect(targetOption, activeOptions.length - 1, e);

      if (_this.props.onKeyDown) {
        _this.props.onKeyDown(e);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveTrigger", function (node) {
      _this.trigger = node;
    });
    var initialValue = [];

    if ('value' in props) {
      initialValue = props.value || [];
    } else if ('defaultValue' in props) {
      initialValue = props.defaultValue || [];
    }

    _this.state = {
      popupVisible: props.popupVisible,
      activeValue: initialValue,
      value: initialValue
    };
    return _this;
  }

  (0, _createClass2["default"])(Cascader, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if ('value' in nextProps && !(0, _isEqual["default"])(this.props.value, nextProps.value)) {
        var newValues = {
          value: nextProps.value || [],
          activeValue: nextProps.value || []
        }; // allow activeValue diff from value

        if ('loadData' in nextProps) {
          delete newValues.activeValue;
        }

        this.setState(newValues);
      }

      if ('popupVisible' in nextProps) {
        this.setState({
          popupVisible: nextProps.popupVisible
        });
      }
    }
  }, {
    key: "getPopupDOMNode",
    value: function getPopupDOMNode() {
      return this.trigger.getPopupDomNode();
    }
  }, {
    key: "getCurrentLevelOptions",
    value: function getCurrentLevelOptions() {
      var options = this.props.options;
      var _this$state$activeVal = this.state.activeValue,
          activeValue = _this$state$activeVal === void 0 ? [] : _this$state$activeVal;
      var result = (0, _arrayTreeFilter["default"])(options, function (o, level) {
        return o.value === activeValue[level];
      });

      if (result[result.length - 2]) {
        return result[result.length - 2].children;
      }

      return (0, _toConsumableArray2["default"])(options).filter(function (o) {
        return !o.disabled;
      });
    }
  }, {
    key: "getActiveOptions",
    value: function getActiveOptions(activeValue) {
      return (0, _arrayTreeFilter["default"])(this.props.options, function (o, level) {
        return o.value === activeValue[level];
      });
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          transitionName = _this$props2.transitionName,
          popupClassName = _this$props2.popupClassName,
          options = _this$props2.options,
          disabled = _this$props2.disabled,
          builtinPlacements = _this$props2.builtinPlacements,
          popupPlacement = _this$props2.popupPlacement,
          children = _this$props2.children,
          restProps = (0, _objectWithoutProperties2["default"])(_this$props2, ["prefixCls", "transitionName", "popupClassName", "options", "disabled", "builtinPlacements", "popupPlacement", "children"]); // Did not show popup when there is no options

      var menus = _react["default"].createElement("div", null);

      var emptyMenuClassName = '';

      if (options && options.length > 0) {
        menus = _react["default"].createElement(_Menus["default"], (0, _extends2["default"])({}, this.props, {
          value: this.state.value,
          activeValue: this.state.activeValue,
          onSelect: this.handleMenuSelect,
          visible: this.state.popupVisible
        }));
      } else {
        emptyMenuClassName = " ".concat(prefixCls, "-menus-empty");
      }

      return _react["default"].createElement(_trigger["default"], (0, _extends2["default"])({
        ref: this.saveTrigger
      }, restProps, {
        options: options,
        disabled: disabled,
        popupPlacement: popupPlacement,
        builtinPlacements: builtinPlacements,
        popupTransitionName: transitionName,
        action: disabled ? [] : ['click'],
        popupVisible: disabled ? false : this.state.popupVisible,
        onPopupVisibleChange: this.handlePopupVisibleChange,
        prefixCls: "".concat(prefixCls, "-menus"),
        popupClassName: popupClassName + emptyMenuClassName,
        popup: menus
      }), (0, _react.cloneElement)(children, {
        onKeyDown: this.handleKeyDown,
        tabIndex: disabled ? undefined : 0
      }));
    }
  }]);
  return Cascader;
}(_react.Component);

exports["default"] = Cascader;
(0, _defineProperty2["default"])(Cascader, "defaultProps", {
  options: [],
  onChange: function onChange() {},
  onPopupVisibleChange: function onPopupVisibleChange() {},
  disabled: false,
  transitionName: '',
  prefixCls: 'rc-cascader',
  popupClassName: '',
  popupPlacement: 'bottomLeft',
  builtinPlacements: BUILT_IN_PLACEMENTS,
  expandTrigger: 'click',
  expandIcon: _react["default"].createElement(_icon["default"], {
    type: "navigate_next"
  })
});
(0, _defineProperty2["default"])(Cascader, "propTypes", {
  value: _propTypes["default"].array,
  defaultValue: _propTypes["default"].array,
  options: _propTypes["default"].array.isRequired,
  onChange: _propTypes["default"].func,
  onPopupVisibleChange: _propTypes["default"].func,
  popupVisible: _propTypes["default"].bool,
  disabled: _propTypes["default"].bool,
  transitionName: _propTypes["default"].string,
  popupClassName: _propTypes["default"].string,
  popupPlacement: _propTypes["default"].string,
  prefixCls: _propTypes["default"].string,
  dropdownMenuColumnStyle: _propTypes["default"].object,
  builtinPlacements: _propTypes["default"].object,
  loadData: _propTypes["default"].func,
  changeOnSelect: _propTypes["default"].bool,
  children: _propTypes["default"].node,
  onKeyDown: _propTypes["default"].func,
  expandTrigger: _propTypes["default"].string,
  expandIcon: _propTypes["default"].node
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhc2NhZGVyL0Nhc2NhZGVyLmpzeCJdLCJuYW1lcyI6WyJCVUlMVF9JTl9QTEFDRU1FTlRTIiwiYm90dG9tTGVmdCIsInBvaW50cyIsIm9mZnNldCIsIm92ZXJmbG93IiwiYWRqdXN0WCIsImFkanVzdFkiLCJ0b3BMZWZ0IiwiYm90dG9tUmlnaHQiLCJ0b3BSaWdodCIsIkNhc2NhZGVyIiwiQ29tcG9uZW50Iiwib3B0aW9ucyIsIm9uQ2hhbmdlIiwib25Qb3B1cFZpc2libGVDaGFuZ2UiLCJkaXNhYmxlZCIsInRyYW5zaXRpb25OYW1lIiwicHJlZml4Q2xzIiwicG9wdXBDbGFzc05hbWUiLCJwb3B1cFBsYWNlbWVudCIsImJ1aWx0aW5QbGFjZW1lbnRzIiwiZXhwYW5kVHJpZ2dlciIsImV4cGFuZEljb24iLCJ2YWx1ZSIsIlByb3BUeXBlcyIsImRlZmF1bHRWYWx1ZSIsInBvcHVwVmlzaWJsZSIsImRyb3Bkb3duTWVudUNvbHVtblN0eWxlIiwibG9hZERhdGEiLCJjaGFuZ2VPblNlbGVjdCIsImNoaWxkcmVuIiwib25LZXlEb3duIiwibm9kZSIsImluaXRpYWxWYWx1ZSIsInByb3BzIiwiYWN0aXZlVmFsdWUiLCJuZXh0UHJvcHMiLCJuZXdWYWx1ZXMiLCJyZXN1bHQiLCJvIiwiZSIsIktleUNvZGUiLCJzZXRQcm9wcyIsInRyaWdnZXJOb2RlIiwidGFyZ2V0T3B0aW9uIiwibWVudUluZGV4IiwiYWN0aXZlT3B0aW9ucyIsInZpc2libGUiLCJuZXdTdGF0ZSIsImN1cnJlbnRMZXZlbCIsImN1cnJlbnRPcHRpb25zIiwiY3VycmVudEluZGV4IiwibmV4dEluZGV4IiwicmVzdFByb3BzIiwibWVudXMiLCJlbXB0eU1lbnVDbGFzc05hbWUiLCJzYXZlVHJpZ2dlciIsInRhYkluZGV4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLENB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QUE7QUFhakJKLEVBQUFBLGlCQUFpQixFQUFFSSxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQWJGLE1BQUE7QUFjakJJLEVBQUFBLFFBQVEsRUFBRUosVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FkTyxJQUFBO0FBZWpCSyxFQUFBQSxjQUFjLEVBQUVMLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBZkMsSUFBQTtBQWdCakJNLEVBQUFBLFFBQVEsRUFBRU4sVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FoQk8sSUFBQTtBQWlCakJPLEVBQUFBLFNBQVMsRUFBRVAsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FqQk0sSUFBQTtBQWtCakJILEVBQUFBLGFBQWEsRUFBRUcsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FsQkUsTUFBQTtBQW1CakJGLEVBQUFBLFVBQVUsRUFBRUUsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FBVVE7QUFuQkwsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBjbG9uZUVsZW1lbnQsIENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgYXJyYXlUcmVlRmlsdGVyIGZyb20gJ2FycmF5LXRyZWUtZmlsdGVyJztcbmltcG9ydCBpc0VxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcbmltcG9ydCBUcmlnZ2VyIGZyb20gJy4uL3RyaWdnZXInO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vLi4vaWNvbic7XG5pbXBvcnQgTWVudXMgZnJvbSAnLi9NZW51cyc7XG5pbXBvcnQgS2V5Q29kZSBmcm9tICcuLi8uLi9fdXRpbC9LZXlDb2RlJztcblxuY29uc3QgQlVJTFRfSU5fUExBQ0VNRU5UUyA9IHtcbiAgYm90dG9tTGVmdDoge1xuICAgIHBvaW50czogWyd0bCcsICdibCddLFxuICAgIG9mZnNldDogWzAsIDRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICB0b3BMZWZ0OiB7XG4gICAgcG9pbnRzOiBbJ2JsJywgJ3RsJ10sXG4gICAgb2Zmc2V0OiBbMCwgLTRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICBib3R0b21SaWdodDoge1xuICAgIHBvaW50czogWyd0cicsICdiciddLFxuICAgIG9mZnNldDogWzAsIDRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxuICB0b3BSaWdodDoge1xuICAgIHBvaW50czogWydicicsICd0ciddLFxuICAgIG9mZnNldDogWzAsIC00XSxcbiAgICBvdmVyZmxvdzoge1xuICAgICAgYWRqdXN0WDogMSxcbiAgICAgIGFkanVzdFk6IDEsXG4gICAgfSxcbiAgfSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENhc2NhZGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBvcHRpb25zOiBbXSxcbiAgICBvbkNoYW5nZSgpIHt9LFxuICAgIG9uUG9wdXBWaXNpYmxlQ2hhbmdlKCkge30sXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIHRyYW5zaXRpb25OYW1lOiAnJyxcbiAgICBwcmVmaXhDbHM6ICdyYy1jYXNjYWRlcicsXG4gICAgcG9wdXBDbGFzc05hbWU6ICcnLFxuICAgIHBvcHVwUGxhY2VtZW50OiAnYm90dG9tTGVmdCcsXG4gICAgYnVpbHRpblBsYWNlbWVudHM6IEJVSUxUX0lOX1BMQUNFTUVOVFMsXG4gICAgZXhwYW5kVHJpZ2dlcjogJ2NsaWNrJyxcbiAgICBleHBhbmRJY29uOiA8SWNvbiB0eXBlPVwibmF2aWdhdGVfbmV4dFwiIC8+LFxuICB9O1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgdmFsdWU6IFByb3BUeXBlcy5hcnJheSxcbiAgICBkZWZhdWx0VmFsdWU6IFByb3BUeXBlcy5hcnJheSxcbiAgICBvcHRpb25zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Qb3B1cFZpc2libGVDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIHBvcHVwVmlzaWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHRyYW5zaXRpb25OYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHBvcHVwQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHBvcHVwUGxhY2VtZW50OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBkcm9wZG93bk1lbnVDb2x1bW5TdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBidWlsdGluUGxhY2VtZW50czogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBsb2FkRGF0YTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgY2hhbmdlT25TZWxlY3Q6IFByb3BUeXBlcy5ib29sLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgICBvbktleURvd246IFByb3BUeXBlcy5mdW5jLFxuICAgIGV4cGFuZFRyaWdnZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZXhwYW5kSWNvbjogUHJvcFR5cGVzLm5vZGUsXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgbGV0IGluaXRpYWxWYWx1ZSA9IFtdO1xuICAgIGlmICgndmFsdWUnIGluIHByb3BzKSB7XG4gICAgICBpbml0aWFsVmFsdWUgPSBwcm9wcy52YWx1ZSB8fCBbXTtcbiAgICB9IGVsc2UgaWYgKCdkZWZhdWx0VmFsdWUnIGluIHByb3BzKSB7XG4gICAgICBpbml0aWFsVmFsdWUgPSBwcm9wcy5kZWZhdWx0VmFsdWUgfHwgW107XG4gICAgfVxuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHBvcHVwVmlzaWJsZTogcHJvcHMucG9wdXBWaXNpYmxlLFxuICAgICAgYWN0aXZlVmFsdWU6IGluaXRpYWxWYWx1ZSxcbiAgICAgIHZhbHVlOiBpbml0aWFsVmFsdWUsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKCd2YWx1ZScgaW4gbmV4dFByb3BzICYmICFpc0VxdWFsKHRoaXMucHJvcHMudmFsdWUsIG5leHRQcm9wcy52YWx1ZSkpIHtcbiAgICAgIGNvbnN0IG5ld1ZhbHVlcyA9IHtcbiAgICAgICAgdmFsdWU6IG5leHRQcm9wcy52YWx1ZSB8fCBbXSxcbiAgICAgICAgYWN0aXZlVmFsdWU6IG5leHRQcm9wcy52YWx1ZSB8fCBbXSxcbiAgICAgIH07XG4gICAgICAvLyBhbGxvdyBhY3RpdmVWYWx1ZSBkaWZmIGZyb20gdmFsdWVcbiAgICAgIGlmICgnbG9hZERhdGEnIGluIG5leHRQcm9wcykge1xuICAgICAgICBkZWxldGUgbmV3VmFsdWVzLmFjdGl2ZVZhbHVlO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRTdGF0ZShuZXdWYWx1ZXMpO1xuICAgIH1cbiAgICBpZiAoJ3BvcHVwVmlzaWJsZScgaW4gbmV4dFByb3BzKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgcG9wdXBWaXNpYmxlOiBuZXh0UHJvcHMucG9wdXBWaXNpYmxlLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0UG9wdXBET01Ob2RlKCkge1xuICAgIHJldHVybiB0aGlzLnRyaWdnZXIuZ2V0UG9wdXBEb21Ob2RlKCk7XG4gIH1cblxuICBnZXRDdXJyZW50TGV2ZWxPcHRpb25zKCkge1xuICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGFjdGl2ZVZhbHVlID0gW10gfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgcmVzdWx0ID0gYXJyYXlUcmVlRmlsdGVyKG9wdGlvbnMsIChvLCBsZXZlbCkgPT4gby52YWx1ZSA9PT0gYWN0aXZlVmFsdWVbbGV2ZWxdKTtcbiAgICBpZiAocmVzdWx0W3Jlc3VsdC5sZW5ndGggLSAyXSkge1xuICAgICAgcmV0dXJuIHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMl0uY2hpbGRyZW47XG4gICAgfVxuICAgIHJldHVybiBbLi4ub3B0aW9uc10uZmlsdGVyKG8gPT4gIW8uZGlzYWJsZWQpO1xuICB9XG5cbiAgZ2V0QWN0aXZlT3B0aW9ucyhhY3RpdmVWYWx1ZSkge1xuICAgIHJldHVybiBhcnJheVRyZWVGaWx0ZXIodGhpcy5wcm9wcy5vcHRpb25zLCAobywgbGV2ZWwpID0+IG8udmFsdWUgPT09IGFjdGl2ZVZhbHVlW2xldmVsXSk7XG4gIH1cblxuICBzZXRQb3B1cFZpc2libGUgPSBwb3B1cFZpc2libGUgPT4ge1xuICAgIGlmICghKCdwb3B1cFZpc2libGUnIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgcG9wdXBWaXNpYmxlIH0pO1xuICAgIH1cbiAgICAvLyBzeW5jIGFjdGl2ZVZhbHVlIHdpdGggdmFsdWUgd2hlbiBwYW5lbCBvcGVuXG4gICAgaWYgKHBvcHVwVmlzaWJsZSAmJiAhdGhpcy5zdGF0ZS52aXNpYmxlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgYWN0aXZlVmFsdWU6IHRoaXMuc3RhdGUudmFsdWUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vblBvcHVwVmlzaWJsZUNoYW5nZShwb3B1cFZpc2libGUpO1xuICB9O1xuICBoYW5kbGVDaGFuZ2UgPSAob3B0aW9ucywgc2V0UHJvcHMsIGUpID0+IHtcbiAgICBpZiAoZS50eXBlICE9PSAna2V5ZG93bicgfHwgZS5rZXlDb2RlID09PSBLZXlDb2RlLkVOVEVSKSB7XG4gICAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKG9wdGlvbnMubWFwKG8gPT4gby52YWx1ZSksIG9wdGlvbnMpO1xuICAgICAgdGhpcy5zZXRQb3B1cFZpc2libGUoc2V0UHJvcHMudmlzaWJsZSk7XG4gICAgfVxuICB9O1xuICBoYW5kbGVQb3B1cFZpc2libGVDaGFuZ2UgPSBwb3B1cFZpc2libGUgPT4ge1xuICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKHBvcHVwVmlzaWJsZSk7XG4gIH07XG4gIGhhbmRsZU1lbnVTZWxlY3QgPSAodGFyZ2V0T3B0aW9uLCBtZW51SW5kZXgsIGUpID0+IHtcbiAgICAvLyBLZWVwIGZvY3VzZWQgc3RhdGUgZm9yIGtleWJvYXJkIHN1cHBvcnRcbiAgICBjb25zdCB0cmlnZ2VyTm9kZSA9IHRoaXMudHJpZ2dlci5nZXRSb290RG9tTm9kZSgpO1xuICAgIGlmICh0cmlnZ2VyTm9kZSAmJiB0cmlnZ2VyTm9kZS5mb2N1cykge1xuICAgICAgdHJpZ2dlck5vZGUuZm9jdXMoKTtcbiAgICB9XG4gICAgY29uc3QgeyBjaGFuZ2VPblNlbGVjdCwgbG9hZERhdGEsIGV4cGFuZFRyaWdnZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCF0YXJnZXRPcHRpb24gfHwgdGFyZ2V0T3B0aW9uLmRpc2FibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCB7IGFjdGl2ZVZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGFjdGl2ZVZhbHVlID0gYWN0aXZlVmFsdWUuc2xpY2UoMCwgbWVudUluZGV4ICsgMSk7XG4gICAgYWN0aXZlVmFsdWVbbWVudUluZGV4XSA9IHRhcmdldE9wdGlvbi52YWx1ZTtcbiAgICBjb25zdCBhY3RpdmVPcHRpb25zID0gdGhpcy5nZXRBY3RpdmVPcHRpb25zKGFjdGl2ZVZhbHVlKTtcbiAgICBpZiAodGFyZ2V0T3B0aW9uLmlzTGVhZiA9PT0gZmFsc2UgJiYgIXRhcmdldE9wdGlvbi5jaGlsZHJlbiAmJiBsb2FkRGF0YSkge1xuICAgICAgaWYgKGNoYW5nZU9uU2VsZWN0KSB7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKGFjdGl2ZU9wdGlvbnMsIHsgdmlzaWJsZTogdHJ1ZSB9LCBlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBhY3RpdmVWYWx1ZSB9KTtcbiAgICAgIGxvYWREYXRhKGFjdGl2ZU9wdGlvbnMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBuZXdTdGF0ZSA9IHt9O1xuICAgIGlmICghdGFyZ2V0T3B0aW9uLmNoaWxkcmVuIHx8ICF0YXJnZXRPcHRpb24uY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICB0aGlzLmhhbmRsZUNoYW5nZShhY3RpdmVPcHRpb25zLCB7IHZpc2libGU6IGZhbHNlIH0sIGUpO1xuICAgICAgLy8gc2V0IHZhbHVlIHRvIGFjdGl2ZVZhbHVlIHdoZW4gc2VsZWN0IGxlYWYgb3B0aW9uXG4gICAgICBuZXdTdGF0ZS52YWx1ZSA9IGFjdGl2ZVZhbHVlO1xuICAgICAgLy8gYWRkIGUudHlwZSBqdWRnZW1lbnQgdG8gcHJldmVudCBgb25DaGFuZ2VgIGJlaW5nIHRyaWdnZXJlZCBieSBtb3VzZUVudGVyXG4gICAgfSBlbHNlIGlmIChjaGFuZ2VPblNlbGVjdCAmJiAoZS50eXBlID09PSAnY2xpY2snIHx8IGUudHlwZSA9PT0gJ2tleWRvd24nKSkge1xuICAgICAgaWYgKGV4cGFuZFRyaWdnZXIgPT09ICdob3ZlcicpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVDaGFuZ2UoYWN0aXZlT3B0aW9ucywgeyB2aXNpYmxlOiBmYWxzZSB9LCBlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKGFjdGl2ZU9wdGlvbnMsIHsgdmlzaWJsZTogdHJ1ZSB9LCBlKTtcbiAgICAgIH1cbiAgICAgIC8vIHNldCB2YWx1ZSB0byBhY3RpdmVWYWx1ZSBvbiBldmVyeSBzZWxlY3RcbiAgICAgIG5ld1N0YXRlLnZhbHVlID0gYWN0aXZlVmFsdWU7XG4gICAgfVxuICAgIG5ld1N0YXRlLmFjdGl2ZVZhbHVlID0gYWN0aXZlVmFsdWU7XG4gICAgLy8gIG5vdCBjaGFuZ2UgdGhlIHZhbHVlIGJ5IGtleWJvYXJkXG4gICAgaWYgKCd2YWx1ZScgaW4gdGhpcy5wcm9wcyB8fCAoZS50eXBlID09PSAna2V5ZG93bicgJiYgZS5rZXlDb2RlICE9PSBLZXlDb2RlLkVOVEVSKSkge1xuICAgICAgZGVsZXRlIG5ld1N0YXRlLnZhbHVlO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKG5ld1N0YXRlKTtcbiAgfTtcbiAgaGFuZGxlS2V5RG93biA9IGUgPT4ge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHM7XG4gICAgLy8gRG9uJ3QgYmluZCBrZXlib2FyZCBzdXBwb3J0IHdoZW4gY2hpbGRyZW4gc3BlY2lmeSB0aGUgb25LZXlEb3duXG4gICAgaWYgKGNoaWxkcmVuICYmIGNoaWxkcmVuLnByb3BzLm9uS2V5RG93bikge1xuICAgICAgY2hpbGRyZW4ucHJvcHMub25LZXlEb3duKGUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBhY3RpdmVWYWx1ZSA9IFsuLi50aGlzLnN0YXRlLmFjdGl2ZVZhbHVlXTtcbiAgICBjb25zdCBjdXJyZW50TGV2ZWwgPSBhY3RpdmVWYWx1ZS5sZW5ndGggLSAxIDwgMCA/IDAgOiBhY3RpdmVWYWx1ZS5sZW5ndGggLSAxO1xuICAgIGNvbnN0IGN1cnJlbnRPcHRpb25zID0gdGhpcy5nZXRDdXJyZW50TGV2ZWxPcHRpb25zKCk7XG4gICAgY29uc3QgY3VycmVudEluZGV4ID0gY3VycmVudE9wdGlvbnMubWFwKG8gPT4gby52YWx1ZSkuaW5kZXhPZihhY3RpdmVWYWx1ZVtjdXJyZW50TGV2ZWxdKTtcbiAgICBpZiAoXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuRE9XTiAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLlVQICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuTEVGVCAmJlxuICAgICAgZS5rZXlDb2RlICE9PSBLZXlDb2RlLlJJR0hUICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuRU5URVIgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5CQUNLU1BBQ0UgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5FU0NcbiAgICApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gUHJlc3MgYW55IGtleXMgYWJvdmUgdG8gcmVvcGVuIG1lbnVcbiAgICBpZiAoXG4gICAgICAhdGhpcy5zdGF0ZS5wb3B1cFZpc2libGUgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5CQUNLU1BBQ0UgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5MRUZUICYmXG4gICAgICBlLmtleUNvZGUgIT09IEtleUNvZGUuUklHSFQgJiZcbiAgICAgIGUua2V5Q29kZSAhPT0gS2V5Q29kZS5FU0NcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0UG9wdXBWaXNpYmxlKHRydWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2RlLkRPV04gfHwgZS5rZXlDb2RlID09PSBLZXlDb2RlLlVQKSB7XG4gICAgICBsZXQgbmV4dEluZGV4ID0gY3VycmVudEluZGV4O1xuICAgICAgaWYgKG5leHRJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5ET1dOKSB7XG4gICAgICAgICAgbmV4dEluZGV4ICs9IDE7XG4gICAgICAgICAgbmV4dEluZGV4ID0gbmV4dEluZGV4ID49IGN1cnJlbnRPcHRpb25zLmxlbmd0aCA/IDAgOiBuZXh0SW5kZXg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV4dEluZGV4IC09IDE7XG4gICAgICAgICAgbmV4dEluZGV4ID0gbmV4dEluZGV4IDwgMCA/IGN1cnJlbnRPcHRpb25zLmxlbmd0aCAtIDEgOiBuZXh0SW5kZXg7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHRJbmRleCA9IDA7XG4gICAgICB9XG4gICAgICBhY3RpdmVWYWx1ZVtjdXJyZW50TGV2ZWxdID0gY3VycmVudE9wdGlvbnNbbmV4dEluZGV4XS52YWx1ZTtcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5MRUZUIHx8IGUua2V5Q29kZSA9PT0gS2V5Q29kZS5CQUNLU1BBQ0UpIHtcbiAgICAgIGFjdGl2ZVZhbHVlLnNwbGljZShhY3RpdmVWYWx1ZS5sZW5ndGggLSAxLCAxKTtcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5SSUdIVCkge1xuICAgICAgaWYgKGN1cnJlbnRPcHRpb25zW2N1cnJlbnRJbmRleF0gJiYgY3VycmVudE9wdGlvbnNbY3VycmVudEluZGV4XS5jaGlsZHJlbikge1xuICAgICAgICBhY3RpdmVWYWx1ZS5wdXNoKGN1cnJlbnRPcHRpb25zW2N1cnJlbnRJbmRleF0uY2hpbGRyZW5bMF0udmFsdWUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2RlLkVTQykge1xuICAgICAgdGhpcy5zZXRQb3B1cFZpc2libGUoZmFsc2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIWFjdGl2ZVZhbHVlIHx8IGFjdGl2ZVZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5zZXRQb3B1cFZpc2libGUoZmFsc2UpO1xuICAgIH1cbiAgICBjb25zdCBhY3RpdmVPcHRpb25zID0gdGhpcy5nZXRBY3RpdmVPcHRpb25zKGFjdGl2ZVZhbHVlKTtcbiAgICBjb25zdCB0YXJnZXRPcHRpb24gPSBhY3RpdmVPcHRpb25zW2FjdGl2ZU9wdGlvbnMubGVuZ3RoIC0gMV07XG4gICAgdGhpcy5oYW5kbGVNZW51U2VsZWN0KHRhcmdldE9wdGlvbiwgYWN0aXZlT3B0aW9ucy5sZW5ndGggLSAxLCBlKTtcblxuICAgIGlmICh0aGlzLnByb3BzLm9uS2V5RG93bikge1xuICAgICAgdGhpcy5wcm9wcy5vbktleURvd24oZSk7XG4gICAgfVxuICB9O1xuXG4gIHNhdmVUcmlnZ2VyID0gbm9kZSA9PiB7XG4gICAgdGhpcy50cmlnZ2VyID0gbm9kZTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgdHJhbnNpdGlvbk5hbWUsXG4gICAgICBwb3B1cENsYXNzTmFtZSxcbiAgICAgIG9wdGlvbnMsXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIGJ1aWx0aW5QbGFjZW1lbnRzLFxuICAgICAgcG9wdXBQbGFjZW1lbnQsXG4gICAgICBjaGlsZHJlbixcbiAgICAgIC4uLnJlc3RQcm9wc1xuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIC8vIERpZCBub3Qgc2hvdyBwb3B1cCB3aGVuIHRoZXJlIGlzIG5vIG9wdGlvbnNcbiAgICBsZXQgbWVudXMgPSA8ZGl2IC8+O1xuICAgIGxldCBlbXB0eU1lbnVDbGFzc05hbWUgPSAnJztcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIG1lbnVzID0gKFxuICAgICAgICA8TWVudXNcbiAgICAgICAgICB7Li4udGhpcy5wcm9wc31cbiAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS52YWx1ZX1cbiAgICAgICAgICBhY3RpdmVWYWx1ZT17dGhpcy5zdGF0ZS5hY3RpdmVWYWx1ZX1cbiAgICAgICAgICBvblNlbGVjdD17dGhpcy5oYW5kbGVNZW51U2VsZWN0fVxuICAgICAgICAgIHZpc2libGU9e3RoaXMuc3RhdGUucG9wdXBWaXNpYmxlfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZW1wdHlNZW51Q2xhc3NOYW1lID0gYCAke3ByZWZpeENsc30tbWVudXMtZW1wdHlgO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPFRyaWdnZXJcbiAgICAgICAgcmVmPXt0aGlzLnNhdmVUcmlnZ2VyfVxuICAgICAgICB7Li4ucmVzdFByb3BzfVxuICAgICAgICBvcHRpb25zPXtvcHRpb25zfVxuICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgIHBvcHVwUGxhY2VtZW50PXtwb3B1cFBsYWNlbWVudH1cbiAgICAgICAgYnVpbHRpblBsYWNlbWVudHM9e2J1aWx0aW5QbGFjZW1lbnRzfVxuICAgICAgICBwb3B1cFRyYW5zaXRpb25OYW1lPXt0cmFuc2l0aW9uTmFtZX1cbiAgICAgICAgYWN0aW9uPXtkaXNhYmxlZCA/IFtdIDogWydjbGljayddfVxuICAgICAgICBwb3B1cFZpc2libGU9e2Rpc2FibGVkID8gZmFsc2UgOiB0aGlzLnN0YXRlLnBvcHVwVmlzaWJsZX1cbiAgICAgICAgb25Qb3B1cFZpc2libGVDaGFuZ2U9e3RoaXMuaGFuZGxlUG9wdXBWaXNpYmxlQ2hhbmdlfVxuICAgICAgICBwcmVmaXhDbHM9e2Ake3ByZWZpeENsc30tbWVudXNgfVxuICAgICAgICBwb3B1cENsYXNzTmFtZT17cG9wdXBDbGFzc05hbWUgKyBlbXB0eU1lbnVDbGFzc05hbWV9XG4gICAgICAgIHBvcHVwPXttZW51c31cbiAgICAgID5cbiAgICAgICAge2Nsb25lRWxlbWVudChjaGlsZHJlbiwge1xuICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXlEb3duLFxuICAgICAgICAgIHRhYkluZGV4OiBkaXNhYmxlZCA/IHVuZGVmaW5lZCA6IDAsXG4gICAgICAgIH0pfVxuICAgICAgPC9UcmlnZ2VyPlxuICAgICk7XG4gIH1cbn1cbiJdfQ==