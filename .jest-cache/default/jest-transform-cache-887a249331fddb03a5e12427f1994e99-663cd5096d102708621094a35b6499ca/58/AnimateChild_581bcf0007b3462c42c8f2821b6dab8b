93ed708c196c4555abc19917f70359cc
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _react = require("react");

var _reactDom = require("react-dom");

var _omit = _interopRequireDefault(require("lodash/omit"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _cssAnimation = _interopRequireWildcard(require("css-animation"));

var _util = _interopRequireDefault(require("./util"));

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var transitionMap = {
  enter: 'transitionEnter',
  appear: 'transitionAppear',
  leave: 'transitionLeave'
};

var AnimateChild =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(AnimateChild, _Component);

  var _super = _createSuper(AnimateChild);

  function AnimateChild() {
    (0, _classCallCheck2["default"])(this, AnimateChild);
    return _super.apply(this, arguments);
  }

  (0, _createClass2["default"])(AnimateChild, [{
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.stop();
    }
  }, {
    key: "componentWillEnter",
    value: function componentWillEnter(done) {
      if (_util["default"].isEnterSupported(this.props)) {
        this.transition('enter', done);
      } else {
        done(this);
      }
    }
  }, {
    key: "componentWillAppear",
    value: function componentWillAppear(done) {
      if (_util["default"].isAppearSupported(this.props)) {
        this.transition('appear', done);
      } else {
        done(this);
      }
    }
  }, {
    key: "componentWillLeave",
    value: function componentWillLeave(done) {
      if (_util["default"].isLeaveSupported(this.props)) {
        this.transition('leave', done);
      } else {
        done(this);
      }
    }
  }, {
    key: "transition",
    value: function transition(animationType, finishCallback) {
      var _this = this;

      var node = (0, _reactDom.findDOMNode)(this);

      if (node) {
        var props = this.props;
        var transitionName = props.transitionName,
            _props$animation = props.animation,
            animation = _props$animation === void 0 ? {} : _props$animation;
        var nameIsObj = (0, _typeof2["default"])(transitionName) === 'object';
        this.stop();

        var end = function end() {
          _this.stopper = null;
          finishCallback(_this);
        };

        if ((_cssAnimation.isCssAnimationSupported || !animation[animationType]) && transitionName && props[transitionMap[animationType]]) {
          var name = nameIsObj ? transitionName[animationType] : "".concat(transitionName, "-").concat(animationType);
          var activeName = "".concat(name, "-active");

          if (nameIsObj && transitionName["".concat(animationType, "Active")]) {
            activeName = transitionName["".concat(animationType, "Active")];
          }

          this.stopper = (0, _cssAnimation["default"])(node, {
            name: name,
            active: activeName
          }, end);
        } else {
          this.stopper = animation[animationType](node, end);
        }
      }
    }
  }, {
    key: "stop",
    value: function stop() {
      var stopper = this.stopper;

      if (stopper) {
        this.stopper = null;
        stopper.stop();
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          children = _this$props.children,
          otherProps = (0, _objectWithoutProperties2["default"])(_this$props, ["children"]);

      if ((0, _react.isValidElement)(children)) {
        var props = (0, _omit["default"])(otherProps, ['animation', 'transitionName', 'transitionEnter', 'transitionAppear', 'transitionLeave']);
        var style = children.props.style;
        return (0, _react.cloneElement)(children, (0, _objectSpread2["default"])({}, props, {
          style: (0, _objectSpread2["default"])({}, props.style, {}, style)
        }));
      }

      return children;
    }
  }]);
  return AnimateChild;
}(_react.Component);

exports["default"] = AnimateChild;
AnimateChild.displayName = 'AnimateChild';
AnimateChild.propTypes = {
  children: _propTypes["default"].any,
  transitionName: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].object]),
  animation: _propTypes["default"].any
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuaW1hdGUvQW5pbWF0ZUNoaWxkLmpzIl0sIm5hbWVzIjpbInRyYW5zaXRpb25NYXAiLCJlbnRlciIsImFwcGVhciIsImxlYXZlIiwiQW5pbWF0ZUNoaWxkIiwiQ29tcG9uZW50IiwiZG9uZSIsImFuaW1VdGlsIiwiYW5pbWF0aW9uVHlwZSIsImZpbmlzaENhbGxiYWNrIiwibm9kZSIsInByb3BzIiwidHJhbnNpdGlvbk5hbWUiLCJhbmltYXRpb24iLCJuYW1lSXNPYmoiLCJlbmQiLCJpc0Nzc0FuaW1hdGlvblN1cHBvcnRlZCIsIm5hbWUiLCJhY3RpdmVOYW1lIiwiYWN0aXZlIiwic3RvcHBlciIsImNoaWxkcmVuIiwib3RoZXJQcm9wcyIsInN0eWxlIiwiUHJvcFR5cGVzIiwiYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLE1BQUEsR0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUE7O0FBQ0EsSUFBQSxLQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxVQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsWUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxhQUFBLEdBQUEsdUJBQUEsQ0FBQSxPQUFBLENBQUEsZUFBQSxDQUFBLENBQUE7O0FBQ0EsSUFBQSxLQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxDQUFBLENBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSxJQUFNQSxhQUFhLEdBQUc7QUFDbEJDLEVBQUFBLEtBQUssRUFEYSxpQkFBQTtBQUVsQkMsRUFBQUEsTUFBTSxFQUZZLGtCQUFBO0FBR2xCQyxFQUFBQSxLQUFLLEVBQUU7QUFIVyxDQUF0Qjs7SUFLcUJDLFk7Ozs7Ozs7Ozs7Ozs7OzJDQUNNO0FBQ25CLFdBQUEsSUFBQTtBQUNIOzs7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RUFBRUcsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FEVyxHQUFBO0FBRXJCWixFQUFBQSxjQUFjLEVBQUVZLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQUFBLFNBQUFBLENBQW9CLENBQUNBLFVBQUFBLENBQUFBLFNBQUFBLENBQUFBLENBQUQsTUFBQSxFQUFtQkEsVUFBQUEsQ0FBQUEsU0FBQUEsQ0FBQUEsQ0FGbEMsTUFFZSxDQUFwQkEsQ0FGSztBQUdyQlgsRUFBQUEsU0FBUyxFQUFFVyxVQUFBQSxDQUFBQSxTQUFBQSxDQUFBQSxDQUFVQztBQUhBLENBQXpCckIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjbG9uZUVsZW1lbnQsIENvbXBvbmVudCwgaXNWYWxpZEVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBmaW5kRE9NTm9kZSB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgb21pdCBmcm9tICdsb2Rhc2gvb21pdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGNzc0FuaW1hdGUsIHsgaXNDc3NBbmltYXRpb25TdXBwb3J0ZWQgfSBmcm9tICdjc3MtYW5pbWF0aW9uJztcbmltcG9ydCBhbmltVXRpbCBmcm9tICcuL3V0aWwnO1xuY29uc3QgdHJhbnNpdGlvbk1hcCA9IHtcbiAgICBlbnRlcjogJ3RyYW5zaXRpb25FbnRlcicsXG4gICAgYXBwZWFyOiAndHJhbnNpdGlvbkFwcGVhcicsXG4gICAgbGVhdmU6ICd0cmFuc2l0aW9uTGVhdmUnLFxufTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuaW1hdGVDaGlsZCBleHRlbmRzIENvbXBvbmVudCB7XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIHRoaXMuc3RvcCgpO1xuICAgIH1cbiAgICBjb21wb25lbnRXaWxsRW50ZXIoZG9uZSkge1xuICAgICAgICBpZiAoYW5pbVV0aWwuaXNFbnRlclN1cHBvcnRlZCh0aGlzLnByb3BzKSkge1xuICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uKCdlbnRlcicsIGRvbmUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZG9uZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsQXBwZWFyKGRvbmUpIHtcbiAgICAgICAgaWYgKGFuaW1VdGlsLmlzQXBwZWFyU3VwcG9ydGVkKHRoaXMucHJvcHMpKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb24oJ2FwcGVhcicsIGRvbmUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZG9uZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsTGVhdmUoZG9uZSkge1xuICAgICAgICBpZiAoYW5pbVV0aWwuaXNMZWF2ZVN1cHBvcnRlZCh0aGlzLnByb3BzKSkge1xuICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uKCdsZWF2ZScsIGRvbmUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZG9uZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0cmFuc2l0aW9uKGFuaW1hdGlvblR5cGUsIGZpbmlzaENhbGxiYWNrKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBmaW5kRE9NTm9kZSh0aGlzKTtcbiAgICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHRyYW5zaXRpb25OYW1lLCBhbmltYXRpb24gPSB7fSB9ID0gcHJvcHM7XG4gICAgICAgICAgICBjb25zdCBuYW1lSXNPYmogPSB0eXBlb2YgdHJhbnNpdGlvbk5hbWUgPT09ICdvYmplY3QnO1xuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdG9wcGVyID0gbnVsbDtcbiAgICAgICAgICAgICAgICBmaW5pc2hDYWxsYmFjayh0aGlzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoKGlzQ3NzQW5pbWF0aW9uU3VwcG9ydGVkIHx8ICFhbmltYXRpb25bYW5pbWF0aW9uVHlwZV0pICYmXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbk5hbWUgJiZcbiAgICAgICAgICAgICAgICBwcm9wc1t0cmFuc2l0aW9uTWFwW2FuaW1hdGlvblR5cGVdXSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBuYW1lSXNPYmpcbiAgICAgICAgICAgICAgICAgICAgPyB0cmFuc2l0aW9uTmFtZVthbmltYXRpb25UeXBlXVxuICAgICAgICAgICAgICAgICAgICA6IGAke3RyYW5zaXRpb25OYW1lfS0ke2FuaW1hdGlvblR5cGV9YDtcbiAgICAgICAgICAgICAgICBsZXQgYWN0aXZlTmFtZSA9IGAke25hbWV9LWFjdGl2ZWA7XG4gICAgICAgICAgICAgICAgaWYgKG5hbWVJc09iaiAmJiB0cmFuc2l0aW9uTmFtZVtgJHthbmltYXRpb25UeXBlfUFjdGl2ZWBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZU5hbWUgPSB0cmFuc2l0aW9uTmFtZVtgJHthbmltYXRpb25UeXBlfUFjdGl2ZWBdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BwZXIgPSBjc3NBbmltYXRlKG5vZGUsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBhY3RpdmVOYW1lLFxuICAgICAgICAgICAgICAgIH0sIGVuZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3BwZXIgPSBhbmltYXRpb25bYW5pbWF0aW9uVHlwZV0obm9kZSwgZW5kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzdG9wKCkge1xuICAgICAgICBjb25zdCB7IHN0b3BwZXIgfSA9IHRoaXM7XG4gICAgICAgIGlmIChzdG9wcGVyKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BwZXIgPSBudWxsO1xuICAgICAgICAgICAgc3RvcHBlci5zdG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGNoaWxkcmVuLCAuLi5vdGhlclByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoaXNWYWxpZEVsZW1lbnQoY2hpbGRyZW4pKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9wcyA9IG9taXQob3RoZXJQcm9wcywgW1xuICAgICAgICAgICAgICAgICdhbmltYXRpb24nLFxuICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uTmFtZScsXG4gICAgICAgICAgICAgICAgJ3RyYW5zaXRpb25FbnRlcicsXG4gICAgICAgICAgICAgICAgJ3RyYW5zaXRpb25BcHBlYXInLFxuICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uTGVhdmUnLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICBjb25zdCB7IHN0eWxlIH0gPSBjaGlsZHJlbi5wcm9wcztcbiAgICAgICAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHsgLi4ucHJvcHMsIHN0eWxlOiB7IC4uLnByb3BzLnN0eWxlLCAuLi5zdHlsZSB9IH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGlsZHJlbjtcbiAgICB9XG59XG5BbmltYXRlQ2hpbGQuZGlzcGxheU5hbWUgPSAnQW5pbWF0ZUNoaWxkJztcbkFuaW1hdGVDaGlsZC5wcm9wVHlwZXMgPSB7XG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gICAgdHJhbnNpdGlvbk5hbWU6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5zdHJpbmcsIFByb3BUeXBlcy5vYmplY3RdKSxcbiAgICBhbmltYXRpb246IFByb3BUeXBlcy5hbnksXG59O1xuIl19