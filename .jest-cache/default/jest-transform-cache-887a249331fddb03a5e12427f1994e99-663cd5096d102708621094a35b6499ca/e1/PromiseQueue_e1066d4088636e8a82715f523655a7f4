1f095c07d82637ee08c6ed90d1998550
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _tslib = require("tslib");

var _mobx = require("mobx");

var PromiseQueue =
/*#__PURE__*/
function () {
  function PromiseQueue() {
    var _this = this;

    (0, _classCallCheck2["default"])(this, PromiseQueue);
    this.queueing = false;
    (0, _mobx.runInAction)(function () {
      _this.queue = [];
    });
  }

  (0, _createClass2["default"])(PromiseQueue, [{
    key: "clear",
    value: function clear(promise) {
      if (!this.queueing) {
        var queue = this.queue;
        var index = queue.indexOf(promise);

        if (index !== -1) {
          queue.splice(index, 1);
        }
      }
    }
  }, {
    key: "add",
    value: function add(promise) {
      var _this2 = this;

      var queue = this.queue;
      queue.push(promise);
      return promise.then(function (value) {
        _this2.clear(promise);

        return value;
      })["catch"](function (error) {
        _this2.clear(promise);

        throw error;
      });
    }
  }, {
    key: "ready",
    value: function () {
      var _ready = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee() {
        var queue;
        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                this.queueing = true;
                queue = this.queue;

                if (!queue.length) {
                  _context.next = 6;
                  break;
                }

                _context.next = 5;
                return queue.pop();

              case 5:
                return _context.abrupt("return", this.ready());

              case 6:
                this.queueing = false;
                return _context.abrupt("return", Promise.resolve());

              case 8:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function ready() {
        return _ready.apply(this, arguments);
      }

      return ready;
    }()
  }, {
    key: "length",
    get: function get() {
      return this.queue.length;
    }
  }]);
  return PromiseQueue;
}();

exports["default"] = PromiseQueue;
(0, _tslib.__decorate)([_mobx.observable], PromiseQueue.prototype, "queue", void 0);
(0, _tslib.__decorate)([_mobx.action], PromiseQueue.prototype, "clear", null);
(0, _tslib.__decorate)([_mobx.action], PromiseQueue.prototype, "add", null);
(0, _tslib.__decorate)([_mobx.action], PromiseQueue.prototype, "ready", null);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby9fdXRpbC9Qcm9taXNlUXVldWUudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7SUFFcUIsWTs7O0FBU25CLDBCQUFBO0FBQUE7O0FBQUE7QUFOQSxTQUFBLFFBQUEsR0FBb0IsS0FBcEI7QUFPRSwyQkFBWSxZQUFLO0FBQ2YsTUFBQSxLQUFJLENBQUMsS0FBTCxHQUFhLEVBQWI7QUFDRCxLQUZEO0FBR0Q7Ozs7MEJBR0ssTyxFQUFPO0FBQ1gsVUFBSSxDQUFDLEtBQUssUUFBVixFQUFvQjtBQUFBLFlBQ1YsS0FEVSxHQUNBLElBREEsQ0FDVixLQURVO0FBRWxCLFlBQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFOLENBQWMsT0FBZCxDQUFkOztBQUNBLFlBQUksS0FBSyxLQUFLLENBQUMsQ0FBZixFQUFrQjtBQUNoQixVQUFBLEtBQUssQ0FBQyxNQUFOLENBQWEsS0FBYixFQUFvQixDQUFwQjtBQUNEO0FBQ0Y7QUFDRjs7O3dCQUdNLE8sRUFBbUI7QUFBQTs7QUFBQSxVQUNoQixLQURnQixHQUNOLElBRE0sQ0FDaEIsS0FEZ0I7QUFFeEIsTUFBQSxLQUFLLENBQUMsSUFBTixDQUFXLE9BQVg7QUFDQSxhQUFPLE9BQU8sQ0FDWCxJQURJLENBQ0MsVUFBQSxLQUFLLEVBQUc7QUFDWixRQUFBLE1BQUksQ0FBQyxLQUFMLENBQVcsT0FBWDs7QUFDQSxlQUFPLEtBQVA7QUFDRCxPQUpJLFdBS0UsVUFBQSxLQUFLLEVBQUc7QUFDYixRQUFBLE1BQUksQ0FBQyxLQUFMLENBQVcsT0FBWDs7QUFDQSxjQUFNLEtBQU47QUFDRCxPQVJJLENBQVA7QUFTRDs7Ozs7Ozs7Ozs7O0FBSUMscUJBQUssUUFBTCxHQUFnQixJQUFoQjtBQUNRLGdCQUFBLEssR0FBVSxJLENBQVYsSzs7cUJBQ0osS0FBSyxDQUFDLE07Ozs7Ozt1QkFDRixLQUFLLENBQUMsR0FBTixFOzs7aURBQ0MsS0FBSyxLQUFMLEU7OztBQUVULHFCQUFLLFFBQUwsR0FBZ0IsS0FBaEI7aURBQ08sT0FBTyxDQUFDLE9BQVIsRTs7Ozs7Ozs7Ozs7Ozs7Ozs7O3dCQTdDQztBQUNSLGFBQU8sS0FBSyxLQUFMLENBQVcsTUFBbEI7QUFDRDs7Ozs7O0FBTlcsdUJBQUEsQ0FBWCxnQkFBVyxDQUFBLEUsc0JBQUEsRSxPQUFBLEUsS0FBc0IsQ0FBdEI7QUFlWix1QkFBQSxDQURDLFlBQ0QsQ0FBQSxFLHNCQUFBLEUsT0FBQSxFQVFDLElBUkQ7QUFXQSx1QkFBQSxDQURDLFlBQ0QsQ0FBQSxFLHNCQUFBLEUsS0FBQSxFQVlDLElBWkQ7QUFlQSx1QkFBQSxDQURDLFlBQ0QsQ0FBQSxFLHNCQUFBLEUsT0FBQSxFQVNDLElBVEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhY3Rpb24sIG9ic2VydmFibGUsIHJ1bkluQWN0aW9uIH0gZnJvbSAnbW9ieCc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb21pc2VRdWV1ZSB7XG4gIEBvYnNlcnZhYmxlIHF1ZXVlOiBQcm9taXNlPGFueT5bXTtcblxuICBxdWV1ZWluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5xdWV1ZS5sZW5ndGg7XG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBydW5JbkFjdGlvbigoKSA9PiB7XG4gICAgICB0aGlzLnF1ZXVlID0gW107XG4gICAgfSk7XG4gIH1cblxuICBAYWN0aW9uXG4gIGNsZWFyKHByb21pc2UpIHtcbiAgICBpZiAoIXRoaXMucXVldWVpbmcpIHtcbiAgICAgIGNvbnN0IHsgcXVldWUgfSA9IHRoaXM7XG4gICAgICBjb25zdCBpbmRleCA9IHF1ZXVlLmluZGV4T2YocHJvbWlzZSk7XG4gICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgIHF1ZXVlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgQGFjdGlvblxuICBhZGQ8VD4ocHJvbWlzZTogUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHsgcXVldWUgfSA9IHRoaXM7XG4gICAgcXVldWUucHVzaChwcm9taXNlKTtcbiAgICByZXR1cm4gcHJvbWlzZVxuICAgICAgLnRoZW4odmFsdWUgPT4ge1xuICAgICAgICB0aGlzLmNsZWFyKHByb21pc2UpO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5jbGVhcihwcm9taXNlKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9KTtcbiAgfVxuXG4gIEBhY3Rpb25cbiAgYXN5bmMgcmVhZHkoKSB7XG4gICAgdGhpcy5xdWV1ZWluZyA9IHRydWU7XG4gICAgY29uc3QgeyBxdWV1ZSB9ID0gdGhpcztcbiAgICBpZiAocXVldWUubGVuZ3RoKSB7XG4gICAgICBhd2FpdCBxdWV1ZS5wb3AoKTtcbiAgICAgIHJldHVybiB0aGlzLnJlYWR5KCk7XG4gICAgfVxuICAgIHRoaXMucXVldWVpbmcgPSBmYWxzZTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH1cbn1cbiJdfQ==