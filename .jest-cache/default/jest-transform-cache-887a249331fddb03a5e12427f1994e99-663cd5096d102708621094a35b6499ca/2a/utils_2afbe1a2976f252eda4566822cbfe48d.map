{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components-pro/number-field/utils.tsx"],"names":[],"mappings":"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","sourcesContent":["import { isMoment, Moment, unitOfTime } from 'moment';\nimport isNumber from 'lodash/isNumber';\nimport defaultTo from 'lodash/defaultTo';\nimport { TimeStep } from '../date-picker/DatePicker';\nimport { TimeUnit } from '../date-picker/enum';\n\nexport const MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER || 2 ** 53 - 1;\n\nexport function getPrecision(value: number): number {\n  const valueString = value.toString();\n  if (valueString.indexOf('e-') >= 0) {\n    return parseInt(valueString.slice(valueString.indexOf('e-') + 2), 10);\n  }\n  if (valueString.indexOf('.') >= 0) {\n    return valueString.length - valueString.indexOf('.') - 1;\n  }\n  return 0;\n}\n\nfunction getMaxPrecision(value: number, step: number): number {\n  const stepPrecision = getPrecision(step);\n  const currentValuePrecision = getPrecision(value);\n  if (!value) {\n    return stepPrecision;\n  }\n  return Math.max(currentValuePrecision, stepPrecision);\n}\n\nfunction getPrecisionFactor(value: number, step: number): number {\n  return 10 ** getMaxPrecision(value, step);\n}\n\nfunction precisionFix(value: number, precisionFactor: number): number {\n  return Math.round(value * precisionFactor);\n}\n\nexport function plus(...values: number[]) {\n  if (values.length > 2) {\n    return plus(values.shift() as number, plus(...values));\n  }\n  if (values.length < 2) {\n    return values[0];\n  }\n  const v1 = values[0];\n  const v2 = values[1];\n  const precisionFactor = getPrecisionFactor(v1, v2);\n  return (precisionFix(v1, precisionFactor) + precisionFix(v2, precisionFactor)) / precisionFactor;\n}\n\nfunction getBeforeStepValue(value: number, minFactor: number, stepFactor: number): number {\n  return value - ((value - minFactor) % stepFactor);\n}\n\nfunction getNearStepMoments(\n  value: Moment,\n  step: number,\n  unit: unitOfTime.Base,\n): Moment[] | undefined {\n  const unitValue = value.get(unit);\n  const mod = unitValue % step;\n  if (mod !== 0) {\n    const before = unitValue - mod;\n    const after = before + step;\n    return [value.clone().set(unit, before), value.clone().set(unit, after)];\n  }\n}\n\nexport function getNearStepValues<T extends Moment | number>(\n  value: T,\n  step: number | TimeStep,\n  min?: number | Moment | null,\n  max?: number | Moment | null,\n): T[] | undefined {\n  if (isNumber(step)) {\n    if (isNumber(value)) {\n      min = defaultTo(Number(min), -MAX_SAFE_INTEGER);\n      max = defaultTo(Number(max), MAX_SAFE_INTEGER);\n      const precisionFactor = getPrecisionFactor(value, step);\n      const valueFactor = precisionFix(value, precisionFactor);\n      const minFactor = precisionFix(min, precisionFactor);\n      const minFactorBase = min === -MAX_SAFE_INTEGER ? 0 : minFactor;\n      const maxFactor = precisionFix(max, precisionFactor);\n      const stepFactor = precisionFix(step, precisionFactor);\n      let beforeStepFactor = getBeforeStepValue(valueFactor, minFactorBase, stepFactor);\n      if (beforeStepFactor === valueFactor) {\n        return undefined;\n      }\n      if (beforeStepFactor > maxFactor) {\n        beforeStepFactor = getBeforeStepValue(maxFactor, minFactorBase, stepFactor);\n      } else if (beforeStepFactor < minFactor) {\n        beforeStepFactor = minFactor;\n      }\n      const afterStepFactor = beforeStepFactor + stepFactor;\n      const values: number[] = [beforeStepFactor / precisionFactor];\n      if (afterStepFactor <= maxFactor) {\n        values.push(afterStepFactor / precisionFactor);\n      }\n      return values as T[];\n    }\n  } else if (isMoment(value)) {\n    const { hour, minute, second } = step;\n    if (second) {\n      return getNearStepMoments(value, second, TimeUnit.second) as T[];\n    }\n    if (minute) {\n      return getNearStepMoments(value, minute, TimeUnit.minute) as T[];\n    }\n    if (hour) {\n      return getNearStepMoments(value, hour, TimeUnit.hour) as T[];\n    }\n  }\n}\n"]}