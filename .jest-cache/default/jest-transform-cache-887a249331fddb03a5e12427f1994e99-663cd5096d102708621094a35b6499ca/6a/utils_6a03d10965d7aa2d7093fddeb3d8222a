533a214977133309346bb50672970be2
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.toArray = toArray;
exports.generateKey = generateKey;
exports.getActiveIndex = getActiveIndex;
exports.getActiveKey = getActiveKey;
exports.setTransform = setTransform;
exports.isTransformSupported = isTransformSupported;
exports.setTransition = setTransition;
exports.getTransformPropValue = getTransformPropValue;
exports.isVertical = isVertical;
exports.getTransformByIndex = getTransformByIndex;
exports.getMarginStyle = getMarginStyle;
exports.getStyle = getStyle;
exports.setPxStyle = setPxStyle;
exports.getDataAttr = getDataAttr;
exports.getLeft = getLeft;
exports.getTop = getTop;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = require("react");

var _isNil = _interopRequireDefault(require("lodash/isNil"));

function toArray(children) {
  var c = [];

  _react.Children.forEach(children, function (child) {
    if (child) {
      c.push(child);
    }
  });

  return c;
}

function generateKey(key, index) {
  return String((0, _isNil["default"])(key) ? index : key);
}

function getActiveIndex(children, activeKey) {
  var c = toArray(children);
  return c.findIndex(function (child, index) {
    return generateKey(child.key, index) === activeKey;
  });
}

function getActiveKey(children, index) {
  var c = toArray(children);
  return generateKey(c[index].key, index);
}

function setTransform(style, v) {
  style.transform = v;
  style.webkitTransform = v;
  style.mozTransform = v;
}

function isTransformSupported(style) {
  return 'transform' in style || 'webkitTransform' in style || 'MozTransform' in style;
}

function setTransition(style, v) {
  style.transition = v;
  style.webkitTransition = v;
  style.MozTransition = v;
}

function getTransformPropValue(v) {
  return {
    transform: v,
    WebkitTransform: v,
    MozTransform: v
  };
}

function isVertical(tabBarPosition) {
  return tabBarPosition === 'left' || tabBarPosition === 'right';
}

function getTransformByIndex(index, tabBarPosition) {
  var translate = isVertical(tabBarPosition) ? 'translateY' : 'translateX';
  return "".concat(translate, "(").concat(-index * 100, "%) translateZ(0)");
}

function getMarginStyle(index, tabBarPosition) {
  var marginDirection = isVertical(tabBarPosition) ? 'marginTop' : 'marginLeft';
  return (0, _defineProperty2["default"])({}, marginDirection, "".concat(-index * 100, "%"));
}

function getStyle(el, property) {
  return +getComputedStyle(el).getPropertyValue(property).replace('px', '');
}

function setPxStyle(el, value, vertical) {
  value = vertical ? "0px, ".concat(value, "px, 0px") : "".concat(value, "px, 0px, 0px");
  setTransform(el.style, "translate3d(".concat(value, ")"));
}

function getDataAttr(props) {
  return Object.keys(props).reduce(function (prev, key) {
    if (key.substr(0, 5) === 'aria-' || key.substr(0, 5) === 'data-' || key === 'role') {
      prev[key] = props[key];
    }

    return prev;
  }, {});
}

function toNum(style, property) {
  return +style.getPropertyValue(property).replace('px', '');
}

function getTypeValue(start, current, end, tabNode, wrapperNode) {
  var total = getStyle(wrapperNode, "padding-".concat(start));
  var childNodes = tabNode.parentNode.childNodes;
  Array.prototype.some.call(childNodes, function (node) {
    if (node !== tabNode) {
      // 此处对代码进行了修改 取自rc-tabs@9.4.2 这版本进行了计算方式的调整,避免了在类似modal等有动画的内容中使用的时候，计算出现错误的问题，因为在动画过程中的计算，会有一次Height width为0的情况
      // 在 9.4.2版本中 因为前几个版本的修改 refactor: rm mixin and react-create-class 
      // 对dom结构进行了调整 bar不与item在一个父元素中,因此有如下代码，在c7n中暂时不进行dom结构调整
      if (node.className.includes('ink-bar')) {
        return false;
      }

      var style = getComputedStyle(node);
      total += toNum(style, "margin-".concat(start));
      total += toNum(style, "margin-".concat(end));
      total += toNum(style, current);

      if (style.boxSizing === 'content-box') {
        total += toNum(style, "border-".concat(start, "-width")) + toNum(style, "padding-".concat(start)) + toNum(style, "border-".concat(end, "-width")) + toNum(style, "padding-".concat(end));
      }

      return false;
    }

    return true;
  });
  return total;
}

function getLeft(tabNode, wrapperNode) {
  return getTypeValue('left', 'width', 'right', tabNode, wrapperNode);
}

function getTop(tabNode, wrapperNode) {
  var top = getTypeValue('top', 'height', 'bottom', tabNode, wrapperNode);
  var height = getStyle(tabNode.parentNode, 'height');
  return top - height;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzeCJdLCJuYW1lcyI6WyJ0b0FycmF5IiwiY2hpbGRyZW4iLCJjIiwiQ2hpbGRyZW4iLCJmb3JFYWNoIiwiY2hpbGQiLCJwdXNoIiwiZ2VuZXJhdGVLZXkiLCJrZXkiLCJpbmRleCIsIlN0cmluZyIsImdldEFjdGl2ZUluZGV4IiwiYWN0aXZlS2V5IiwiZmluZEluZGV4IiwiZ2V0QWN0aXZlS2V5Iiwic2V0VHJhbnNmb3JtIiwic3R5bGUiLCJ2IiwidHJhbnNmb3JtIiwid2Via2l0VHJhbnNmb3JtIiwibW96VHJhbnNmb3JtIiwiaXNUcmFuc2Zvcm1TdXBwb3J0ZWQiLCJzZXRUcmFuc2l0aW9uIiwidHJhbnNpdGlvbiIsIndlYmtpdFRyYW5zaXRpb24iLCJNb3pUcmFuc2l0aW9uIiwiZ2V0VHJhbnNmb3JtUHJvcFZhbHVlIiwiV2Via2l0VHJhbnNmb3JtIiwiTW96VHJhbnNmb3JtIiwiaXNWZXJ0aWNhbCIsInRhYkJhclBvc2l0aW9uIiwiZ2V0VHJhbnNmb3JtQnlJbmRleCIsInRyYW5zbGF0ZSIsImdldE1hcmdpblN0eWxlIiwibWFyZ2luRGlyZWN0aW9uIiwiZ2V0U3R5bGUiLCJlbCIsInByb3BlcnR5IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImdldFByb3BlcnR5VmFsdWUiLCJyZXBsYWNlIiwic2V0UHhTdHlsZSIsInZhbHVlIiwidmVydGljYWwiLCJnZXREYXRhQXR0ciIsInByb3BzIiwiT2JqZWN0Iiwia2V5cyIsInJlZHVjZSIsInByZXYiLCJzdWJzdHIiLCJ0b051bSIsImdldFR5cGVWYWx1ZSIsInN0YXJ0IiwiY3VycmVudCIsImVuZCIsInRhYk5vZGUiLCJ3cmFwcGVyTm9kZSIsInRvdGFsIiwiY2hpbGROb2RlcyIsInBhcmVudE5vZGUiLCJBcnJheSIsInByb3RvdHlwZSIsInNvbWUiLCJjYWxsIiwibm9kZSIsImNsYXNzTmFtZSIsImluY2x1ZGVzIiwiYm94U2l6aW5nIiwiZ2V0TGVmdCIsImdldFRvcCIsInRvcCIsImhlaWdodCJd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QUFuQixFQUQ3QztBQUVEOztBQUNELGFBQU8sS0FBUDtBQUNEOztBQUNELFdBQU8sSUFBUDtBQUNELEdBcEJEO0FBc0JBLFNBQU9HLEtBQVA7QUFDRDs7QUFFTSxTQUFTVyxPQUFULENBQWtCYixPQUFsQixFQUEyQkMsV0FBM0IsRUFBd0M7QUFDN0MsU0FBT0wsWUFBWSxDQUFDLE1BQUQsRUFBUyxPQUFULEVBQWtCLE9BQWxCLEVBQTJCSSxPQUEzQixFQUFvQ0MsV0FBcEMsQ0FBbkI7QUFDRDs7QUFFTSxTQUFTYSxNQUFULENBQWlCZCxPQUFqQixFQUEwQkMsV0FBMUIsRUFBdUM7QUFDNUMsTUFBTWMsR0FBRyxHQUFHbkIsWUFBWSxDQUFDLEtBQUQsRUFBUSxRQUFSLEVBQWtCLFFBQWxCLEVBQTRCSSxPQUE1QixFQUFxQ0MsV0FBckMsQ0FBeEI7QUFDQSxNQUFNZSxNQUFNLEdBQUdyQyxRQUFRLENBQUNxQixPQUFPLENBQUNJLFVBQVQsRUFBcUIsUUFBckIsQ0FBdkI7QUFDQSxTQUFPVyxHQUFHLEdBQUdDLE1BQWI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoaWxkcmVuIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IGlzTmlsIGZyb20gJ2xvZGFzaC9pc05pbCc7XG5cbmV4cG9ydCBmdW5jdGlvbiB0b0FycmF5IChjaGlsZHJlbikge1xuICBjb25zdCBjID0gW107XG4gIENoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIGNoaWxkID0+IHtcbiAgICBpZiAoY2hpbGQpIHtcbiAgICAgIGMucHVzaChjaGlsZCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUtleSAoa2V5LCBpbmRleCkge1xuICByZXR1cm4gU3RyaW5nKGlzTmlsKGtleSkgPyBpbmRleCA6IGtleSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBY3RpdmVJbmRleCAoY2hpbGRyZW4sIGFjdGl2ZUtleSkge1xuICBjb25zdCBjID0gdG9BcnJheShjaGlsZHJlbik7XG4gIHJldHVybiBjLmZpbmRJbmRleCgoY2hpbGQsIGluZGV4KSA9PiBnZW5lcmF0ZUtleShjaGlsZC5rZXksIGluZGV4KSA9PT0gYWN0aXZlS2V5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFjdGl2ZUtleSAoY2hpbGRyZW4sIGluZGV4KSB7XG4gIGNvbnN0IGMgPSB0b0FycmF5KGNoaWxkcmVuKTtcbiAgcmV0dXJuIGdlbmVyYXRlS2V5KGNbaW5kZXhdLmtleSwgaW5kZXgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0VHJhbnNmb3JtIChzdHlsZSwgdikge1xuICBzdHlsZS50cmFuc2Zvcm0gPSB2O1xuICBzdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSB2O1xuICBzdHlsZS5tb3pUcmFuc2Zvcm0gPSB2O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQgKHN0eWxlKSB7XG4gIHJldHVybiAndHJhbnNmb3JtJyBpbiBzdHlsZSB8fFxuICAgICd3ZWJraXRUcmFuc2Zvcm0nIGluIHN0eWxlIHx8XG4gICAgJ01velRyYW5zZm9ybScgaW4gc3R5bGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRUcmFuc2l0aW9uIChzdHlsZSwgdikge1xuICBzdHlsZS50cmFuc2l0aW9uID0gdjtcbiAgc3R5bGUud2Via2l0VHJhbnNpdGlvbiA9IHY7XG4gIHN0eWxlLk1velRyYW5zaXRpb24gPSB2O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHJhbnNmb3JtUHJvcFZhbHVlICh2KSB7XG4gIHJldHVybiB7XG4gICAgdHJhbnNmb3JtOiB2LFxuICAgIFdlYmtpdFRyYW5zZm9ybTogdixcbiAgICBNb3pUcmFuc2Zvcm06IHYsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZlcnRpY2FsICh0YWJCYXJQb3NpdGlvbikge1xuICByZXR1cm4gdGFiQmFyUG9zaXRpb24gPT09ICdsZWZ0JyB8fCB0YWJCYXJQb3NpdGlvbiA9PT0gJ3JpZ2h0Jztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRyYW5zZm9ybUJ5SW5kZXggKGluZGV4LCB0YWJCYXJQb3NpdGlvbikge1xuICBjb25zdCB0cmFuc2xhdGUgPSBpc1ZlcnRpY2FsKHRhYkJhclBvc2l0aW9uKSA/ICd0cmFuc2xhdGVZJyA6ICd0cmFuc2xhdGVYJztcbiAgcmV0dXJuIGAke3RyYW5zbGF0ZX0oJHstaW5kZXggKiAxMDB9JSkgdHJhbnNsYXRlWigwKWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXJnaW5TdHlsZSAoaW5kZXgsIHRhYkJhclBvc2l0aW9uKSB7XG4gIGNvbnN0IG1hcmdpbkRpcmVjdGlvbiA9IGlzVmVydGljYWwodGFiQmFyUG9zaXRpb24pID8gJ21hcmdpblRvcCcgOiAnbWFyZ2luTGVmdCc7XG4gIHJldHVybiB7XG4gICAgW21hcmdpbkRpcmVjdGlvbl06IGAkey1pbmRleCAqIDEwMH0lYCxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFN0eWxlIChlbCwgcHJvcGVydHkpIHtcbiAgcmV0dXJuICtnZXRDb21wdXRlZFN0eWxlKGVsKS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5KS5yZXBsYWNlKCdweCcsICcnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldFB4U3R5bGUgKGVsLCB2YWx1ZSwgdmVydGljYWwpIHtcbiAgdmFsdWUgPSB2ZXJ0aWNhbCA/IGAwcHgsICR7dmFsdWV9cHgsIDBweGAgOiBgJHt2YWx1ZX1weCwgMHB4LCAwcHhgO1xuICBzZXRUcmFuc2Zvcm0oZWwuc3R5bGUsIGB0cmFuc2xhdGUzZCgke3ZhbHVlfSlgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERhdGFBdHRyIChwcm9wcykge1xuICByZXR1cm4gT2JqZWN0LmtleXMocHJvcHMpLnJlZHVjZSgocHJldiwga2V5KSA9PiB7XG4gICAgaWYgKGtleS5zdWJzdHIoMCwgNSkgPT09ICdhcmlhLScgfHwga2V5LnN1YnN0cigwLCA1KSA9PT0gJ2RhdGEtJyB8fCBrZXkgPT09ICdyb2xlJykge1xuICAgICAgcHJldltrZXldID0gcHJvcHNba2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIHByZXY7XG4gIH0sIHt9KTtcbn1cblxuZnVuY3Rpb24gdG9OdW0gKHN0eWxlLCBwcm9wZXJ0eSkge1xuICByZXR1cm4gK3N0eWxlLmdldFByb3BlcnR5VmFsdWUocHJvcGVydHkpLnJlcGxhY2UoJ3B4JywgJycpO1xufVxuXG5mdW5jdGlvbiBnZXRUeXBlVmFsdWUgKHN0YXJ0LCBjdXJyZW50LCBlbmQsIHRhYk5vZGUsIHdyYXBwZXJOb2RlKSB7XG4gIGxldCB0b3RhbCA9IGdldFN0eWxlKHdyYXBwZXJOb2RlLCBgcGFkZGluZy0ke3N0YXJ0fWApO1xuICBjb25zdCB7IGNoaWxkTm9kZXMgfSA9IHRhYk5vZGUucGFyZW50Tm9kZTtcbiAgQXJyYXkucHJvdG90eXBlLnNvbWUuY2FsbChjaGlsZE5vZGVzLCAobm9kZSkgPT4ge1xuICAgIGlmIChub2RlICE9PSB0YWJOb2RlKSB7XG4gICAgICAvLyDmraTlpITlr7nku6PnoIHov5vooYzkuobkv67mlLkg5Y+W6IeqcmMtdGFic0A5LjQuMiDov5nniYjmnKzov5vooYzkuoborqHnrpfmlrnlvI/nmoTosIPmlbQs6YG/5YWN5LqG5Zyo57G75Ly8bW9kYWznrYnmnInliqjnlLvnmoTlhoXlrrnkuK3kvb/nlKjnmoTml7blgJnvvIzorqHnrpflh7rnjrDplJnor6/nmoTpl67popjvvIzlm6DkuLrlnKjliqjnlLvov4fnqIvkuK3nmoTorqHnrpfvvIzkvJrmnInkuIDmrKFIZWlnaHQgd2lkdGjkuLow55qE5oOF5Ya1XG4gICAgICAvLyDlnKggOS40LjLniYjmnKzkuK0g5Zug5Li65YmN5Yeg5Liq54mI5pys55qE5L+u5pS5IHJlZmFjdG9yOiBybSBtaXhpbiBhbmQgcmVhY3QtY3JlYXRlLWNsYXNzIFxuICAgICAgLy8g5a+5ZG9t57uT5p6E6L+b6KGM5LqG6LCD5pW0IGJhcuS4jeS4jml0ZW3lnKjkuIDkuKrniLblhYPntKDkuK0s5Zug5q2k5pyJ5aaC5LiL5Luj56CB77yM5ZyoYzdu5Lit5pqC5pe25LiN6L+b6KGMZG9t57uT5p6E6LCD5pW0XG4gICAgICBpZiAobm9kZS5jbGFzc05hbWUuaW5jbHVkZXMoJ2luay1iYXInKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUobm9kZSk7XG4gICAgICB0b3RhbCArPSB0b051bShzdHlsZSwgYG1hcmdpbi0ke3N0YXJ0fWApO1xuICAgICAgdG90YWwgKz0gdG9OdW0oc3R5bGUsIGBtYXJnaW4tJHtlbmR9YCk7XG4gICAgICB0b3RhbCArPSB0b051bShzdHlsZSwgY3VycmVudCk7XG5cbiAgICAgIGlmIChzdHlsZS5ib3hTaXppbmcgPT09ICdjb250ZW50LWJveCcpIHtcbiAgICAgICAgdG90YWwgKz0gdG9OdW0oc3R5bGUsIGBib3JkZXItJHtzdGFydH0td2lkdGhgKSArIHRvTnVtKHN0eWxlLCBgcGFkZGluZy0ke3N0YXJ0fWApICtcbiAgICAgICAgICB0b051bShzdHlsZSwgYGJvcmRlci0ke2VuZH0td2lkdGhgKSArIHRvTnVtKHN0eWxlLCBgcGFkZGluZy0ke2VuZH1gKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pO1xuXG4gIHJldHVybiB0b3RhbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExlZnQgKHRhYk5vZGUsIHdyYXBwZXJOb2RlKSB7XG4gIHJldHVybiBnZXRUeXBlVmFsdWUoJ2xlZnQnLCAnd2lkdGgnLCAncmlnaHQnLCB0YWJOb2RlLCB3cmFwcGVyTm9kZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUb3AgKHRhYk5vZGUsIHdyYXBwZXJOb2RlKSB7XG4gIGNvbnN0IHRvcCA9IGdldFR5cGVWYWx1ZSgndG9wJywgJ2hlaWdodCcsICdib3R0b20nLCB0YWJOb2RlLCB3cmFwcGVyTm9kZSk7XG4gIGNvbnN0IGhlaWdodCA9IGdldFN0eWxlKHRhYk5vZGUucGFyZW50Tm9kZSwgJ2hlaWdodCcpO1xuICByZXR1cm4gdG9wIC0gaGVpZ2h0O1xufVxuIl19