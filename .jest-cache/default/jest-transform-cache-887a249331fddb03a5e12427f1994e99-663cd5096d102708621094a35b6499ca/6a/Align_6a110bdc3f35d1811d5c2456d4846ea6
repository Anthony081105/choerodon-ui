4e96d7c52d025ab682d329e1150b1305
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _react = require("react");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactDom = require("react-dom");

var _noop = _interopRequireDefault(require("lodash/noop"));

var _domAlign = _interopRequireDefault(require("dom-align"));

var _EventManager = _interopRequireDefault(require("../_util/EventManager"));

var _TaskRunner = _interopRequireDefault(require("../_util/TaskRunner"));

function isWindow(obj) {
  return obj != null && obj === obj.window;
}

var Align =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Align, _Component);

  function Align() {
    (0, _classCallCheck2["default"])(this, Align);
    return (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(Align).apply(this, arguments));
  }

  (0, _createClass2["default"])(Align, [{
    key: "forceAlign",
    value: function forceAlign() {
      var _this$props = this.props,
          hidden = _this$props.hidden,
          _this$props$onAlign = _this$props.onAlign,
          onAlign = _this$props$onAlign === void 0 ? _noop["default"] : _this$props$onAlign,
          _this$props$target = _this$props.target,
          target = _this$props$target === void 0 ? function () {
        return window;
      } : _this$props$target,
          align = _this$props.align;

      if (!hidden) {
        var source = (0, _reactDom.findDOMNode)(this);
        var ref = target();
        onAlign(source, (0, _domAlign["default"])(source, ref, align), ref);
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      var _this$props2 = this.props,
          hidden = _this$props2.hidden,
          monitorWindowResize = _this$props2.monitorWindowResize;
      this.forceAlign();

      if (!hidden && monitorWindowResize) {
        this.startMonitorWindowResize();
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var _this$props3 = this.props,
          hidden = _this$props3.hidden,
          align = _this$props3.align,
          _this$props3$target = _this$props3.target,
          target = _this$props3$target === void 0 ? function () {
        return window;
      } : _this$props3$target,
          monitorWindowResize = _this$props3.monitorWindowResize;
      var preHidden = prevProps.hidden,
          preAlign = prevProps.align,
          preTarget = prevProps.target;
      var reAlign = false;

      if (!hidden) {
        if (preHidden || preAlign !== align) {
          reAlign = true;
        } else {
          var lastTarget = preTarget();
          var currentTarget = target();

          if (isWindow(lastTarget) && isWindow(currentTarget)) {
            reAlign = false;
          } else if (lastTarget !== currentTarget) {
            reAlign = true;
          }
        }
      }

      if (reAlign) {
        this.forceAlign();
      }

      if (monitorWindowResize && !hidden) {
        this.startMonitorWindowResize();
      } else {
        this.stopMonitorWindowResize();
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.stopMonitorWindowResize();
    }
  }, {
    key: "startMonitorWindowResize",
    value: function startMonitorWindowResize() {
      var monitorBufferTime = this.props.monitorBufferTime;

      if (!this.resizeHandler) {
        this.resizeHandler = new _EventManager["default"](window);
        this.bufferMonitor = new _TaskRunner["default"]();
        this.resizeHandler.addEventListener('resize', this.bufferMonitor.delay.bind(this.bufferMonitor, monitorBufferTime, this.forceAlign.bind(this)));
      }
    }
  }, {
    key: "stopMonitorWindowResize",
    value: function stopMonitorWindowResize() {
      if (this.resizeHandler) {
        if (this.bufferMonitor) {
          this.bufferMonitor.cancel();
        }

        this.resizeHandler.clear();
        this.resizeHandler = null;
      }
    }
  }, {
    key: "render",
    value: function render() {
      var props = this.props;
      var childrenProps = props.childrenProps,
          children = props.children;

      if (childrenProps) {
        var newProps = {};
        Object.keys(childrenProps).forEach(function (prop) {
          if ({}.hasOwnProperty.call(childrenProps, prop)) {
            newProps[prop] = props[childrenProps[prop]];
          }
        });
        return (0, _react.cloneElement)(_react.Children.only(children), newProps);
      }

      return children;
    }
  }]);
  return Align;
}(_react.Component);

exports["default"] = Align;
Align.displayName = 'Align';
Align.propTypes = {
  childrenProps: _propTypes["default"].object,
  align: _propTypes["default"].object.isRequired,
  target: _propTypes["default"].func,
  onAlign: _propTypes["default"].func,
  monitorBufferTime: _propTypes["default"].number,
  monitorWindowResize: _propTypes["default"].bool,
  hidden: _propTypes["default"].bool,
  children: _propTypes["default"].any
};
Align.defaultProps = {
  monitorBufferTime: 50,
  monitorWindowResize: false,
  hidden: true
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsaWduL0FsaWduLmpzIl0sIm5hbWVzIjpbIm9iaiIsIkFsaWduIiwiQ29tcG9uZW50IiwiaGlkZGVuIiwib25BbGlnbiIsIm5vb3AiLCJ0YXJnZXQiLCJhbGlnbiIsInNvdXJjZSIsInJlZiIsIm1vbml0b3JXaW5kb3dSZXNpemUiLCJwcmV2UHJvcHMiLCJwcmVIaWRkZW4iLCJwcmVBbGlnbiIsInByZVRhcmdldCIsInJlQWxpZ24iLCJsYXN0VGFyZ2V0IiwiY3VycmVudFRhcmdldCIsImlzV2luZG93IiwibW9uaXRvckJ1ZmZlclRpbWUiLCJFdmVudE1hbmFnZXIiLCJUYXNrUnVubmVyIiwicHJvcHMiLCJjaGlsZHJlblByb3BzIiwiY2hpbGRyZW4iLCJuZXdQcm9wcyIsIk9iamVjdCIsIkNoaWxkcmVuIiwiUHJvcFR5cGVzIiwiYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQTs7QUFDQSxJQUFBLFVBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxZQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFNBQUEsR0FBQSxPQUFBLENBQUEsV0FBQSxDQUFBOztBQUNBLElBQUEsS0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsU0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsYUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLHVCQUFBLENBQUEsQ0FBQTs7QUFDQSxJQUFBLFdBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsQ0FBQSxxQkFBQSxDQUFBLENBQUE7O0FBQ0EsU0FBQSxRQUFBLENBQUEsR0FBQSxFQUF1QjtBQUNuQixTQUFPQSxHQUFHLElBQUhBLElBQUFBLElBQWVBLEdBQUcsS0FBS0EsR0FBRyxDQUFqQyxNQUFBO0FBQ0g7O0lBQ29CQyxLOzs7Ozs7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cG9uZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGZpbmRET01Ob2RlIH0gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCBub29wIGZyb20gJ2xvZGFzaC9ub29wJztcbmltcG9ydCBkb21BbGlnbiBmcm9tICdkb20tYWxpZ24nO1xuaW1wb3J0IEV2ZW50TWFuYWdlciBmcm9tICcuLi9fdXRpbC9FdmVudE1hbmFnZXInO1xuaW1wb3J0IFRhc2tSdW5uZXIgZnJvbSAnLi4vX3V0aWwvVGFza1J1bm5lcic7XG5mdW5jdGlvbiBpc1dpbmRvdyhvYmopIHtcbiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgb2JqID09PSBvYmoud2luZG93O1xufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWxpZ24gZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIGZvcmNlQWxpZ24oKSB7XG4gICAgICAgIGNvbnN0IHsgaGlkZGVuLCBvbkFsaWduID0gbm9vcCwgdGFyZ2V0ID0gKCkgPT4gd2luZG93LCBhbGlnbiB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFoaWRkZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IGZpbmRET01Ob2RlKHRoaXMpO1xuICAgICAgICAgICAgY29uc3QgcmVmID0gdGFyZ2V0KCk7XG4gICAgICAgICAgICBvbkFsaWduKHNvdXJjZSwgZG9tQWxpZ24oc291cmNlLCByZWYsIGFsaWduKSwgcmVmKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBoaWRkZW4sIG1vbml0b3JXaW5kb3dSZXNpemUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMuZm9yY2VBbGlnbigpO1xuICAgICAgICBpZiAoIWhpZGRlbiAmJiBtb25pdG9yV2luZG93UmVzaXplKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0TW9uaXRvcldpbmRvd1Jlc2l6ZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHtcbiAgICAgICAgY29uc3QgeyBoaWRkZW4sIGFsaWduLCB0YXJnZXQgPSAoKSA9PiB3aW5kb3csIG1vbml0b3JXaW5kb3dSZXNpemUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgaGlkZGVuOiBwcmVIaWRkZW4sIGFsaWduOiBwcmVBbGlnbiwgdGFyZ2V0OiBwcmVUYXJnZXQgfSA9IHByZXZQcm9wcztcbiAgICAgICAgbGV0IHJlQWxpZ24gPSBmYWxzZTtcbiAgICAgICAgaWYgKCFoaWRkZW4pIHtcbiAgICAgICAgICAgIGlmIChwcmVIaWRkZW4gfHwgcHJlQWxpZ24gIT09IGFsaWduKSB7XG4gICAgICAgICAgICAgICAgcmVBbGlnbiA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXN0VGFyZ2V0ID0gcHJlVGFyZ2V0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFRhcmdldCA9IHRhcmdldCgpO1xuICAgICAgICAgICAgICAgIGlmIChpc1dpbmRvdyhsYXN0VGFyZ2V0KSAmJiBpc1dpbmRvdyhjdXJyZW50VGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgICAgICByZUFsaWduID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxhc3RUYXJnZXQgIT09IGN1cnJlbnRUYXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVBbGlnbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChyZUFsaWduKSB7XG4gICAgICAgICAgICB0aGlzLmZvcmNlQWxpZ24oKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9uaXRvcldpbmRvd1Jlc2l6ZSAmJiAhaGlkZGVuKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0TW9uaXRvcldpbmRvd1Jlc2l6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdG9wTW9uaXRvcldpbmRvd1Jlc2l6ZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLnN0b3BNb25pdG9yV2luZG93UmVzaXplKCk7XG4gICAgfVxuICAgIHN0YXJ0TW9uaXRvcldpbmRvd1Jlc2l6ZSgpIHtcbiAgICAgICAgY29uc3QgeyBtb25pdG9yQnVmZmVyVGltZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCF0aGlzLnJlc2l6ZUhhbmRsZXIpIHtcbiAgICAgICAgICAgIHRoaXMucmVzaXplSGFuZGxlciA9IG5ldyBFdmVudE1hbmFnZXIod2luZG93KTtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyTW9uaXRvciA9IG5ldyBUYXNrUnVubmVyKCk7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZUhhbmRsZXIuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5idWZmZXJNb25pdG9yLmRlbGF5LmJpbmQodGhpcy5idWZmZXJNb25pdG9yLCBtb25pdG9yQnVmZmVyVGltZSwgdGhpcy5mb3JjZUFsaWduLmJpbmQodGhpcykpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdG9wTW9uaXRvcldpbmRvd1Jlc2l6ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzaXplSGFuZGxlcikge1xuICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyTW9uaXRvcikge1xuICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyTW9uaXRvci5jYW5jZWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzaXplSGFuZGxlci5jbGVhcigpO1xuICAgICAgICAgICAgdGhpcy5yZXNpemVIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW5Qcm9wcywgY2hpbGRyZW4gfSA9IHByb3BzO1xuICAgICAgICBpZiAoY2hpbGRyZW5Qcm9wcykge1xuICAgICAgICAgICAgY29uc3QgbmV3UHJvcHMgPSB7fTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGNoaWxkcmVuUHJvcHMpLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHt9Lmhhc093blByb3BlcnR5LmNhbGwoY2hpbGRyZW5Qcm9wcywgcHJvcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3UHJvcHNbcHJvcF0gPSBwcm9wc1tjaGlsZHJlblByb3BzW3Byb3BdXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBjbG9uZUVsZW1lbnQoQ2hpbGRyZW4ub25seShjaGlsZHJlbiksIG5ld1Byb3BzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hpbGRyZW47XG4gICAgfVxufVxuQWxpZ24uZGlzcGxheU5hbWUgPSAnQWxpZ24nO1xuQWxpZ24ucHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuUHJvcHM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgYWxpZ246IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB0YXJnZXQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQWxpZ246IFByb3BUeXBlcy5mdW5jLFxuICAgIG1vbml0b3JCdWZmZXJUaW1lOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIG1vbml0b3JXaW5kb3dSZXNpemU6IFByb3BUeXBlcy5ib29sLFxuICAgIGhpZGRlbjogUHJvcFR5cGVzLmJvb2wsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG59O1xuQWxpZ24uZGVmYXVsdFByb3BzID0ge1xuICAgIG1vbml0b3JCdWZmZXJUaW1lOiA1MCxcbiAgICBtb25pdG9yV2luZG93UmVzaXplOiBmYWxzZSxcbiAgICBoaWRkZW46IHRydWUsXG59O1xuIl19