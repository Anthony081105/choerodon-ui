cd76bd6605a9ff3a6323f05fcc486c92
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _arrayTreeFilter = _interopRequireDefault(require("array-tree-filter"));

var _reactDom = require("react-dom");

function _createSuper(Derived) {
  function isNativeReflectConstruct() {
    if (typeof Reflect === "undefined" || !Reflect.construct) return false;
    if (Reflect.construct.sham) return false;
    if (typeof Proxy === "function") return true;

    try {
      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));
      return true;
    } catch (e) {
      return false;
    }
  }

  return function () {
    var Super = (0, _getPrototypeOf2["default"])(Derived),
        result;

    if (isNativeReflectConstruct()) {
      var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor;
      result = Reflect.construct(Super, arguments, NewTarget);
    } else {
      result = Super.apply(this, arguments);
    }

    return (0, _possibleConstructorReturn2["default"])(this, result);
  };
}

var Menus =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(Menus, _Component);

  var _super = _createSuper(Menus);

  function Menus(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, Menus);
    _this = _super.call(this, props);
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "saveMenuItem", function (index) {
      return function (node) {
        _this.menuItems[index] = node;
      };
    });
    _this.menuItems = {};
    return _this;
  }

  (0, _createClass2["default"])(Menus, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this.scrollActiveItemToView();
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (!prevProps.visible && this.props.visible) {
        this.scrollActiveItemToView();
      }
    }
  }, {
    key: "getOption",
    value: function getOption(option, menuIndex) {
      var _this$props = this.props,
          prefixCls = _this$props.prefixCls,
          expandTrigger = _this$props.expandTrigger,
          expandIcon = _this$props.expandIcon;
      var onSelect = this.props.onSelect.bind(this, option, menuIndex);
      var expandProps = {
        onClick: onSelect
      };
      var menuItemCls = "".concat(prefixCls, "-menu-item");
      var expandIconNode = null;
      var hasChildren = option.children && option.children.length > 0;

      if (hasChildren || option.isLeaf === false) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-expand");
        expandIconNode = _react["default"].createElement("span", {
          className: "".concat(prefixCls, "-menu-item-expand-icon")
        }, expandIcon);
      }

      if (expandTrigger === 'hover' && hasChildren) {
        expandProps = {
          onMouseEnter: this.delayOnSelect.bind(this, onSelect),
          onMouseLeave: this.delayOnSelect.bind(this),
          onClick: onSelect
        };
      }

      if (this.isActiveOption(option, menuIndex)) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-active");
        expandProps.ref = this.saveMenuItem(menuIndex);
      }

      if (option.disabled) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-disabled");
      }

      if (option.loading) {
        menuItemCls += " ".concat(prefixCls, "-menu-item-loading");
      }

      var title = '';

      if (option.title) {
        title = option.title;
      } else if (typeof option.label === 'string') {
        title = option.label;
      }

      return _react["default"].createElement("li", (0, _extends2["default"])({
        key: option.key || option.value,
        className: menuItemCls,
        title: title
      }, expandProps), option.label, expandIconNode);
    }
  }, {
    key: "getActiveOptions",
    value: function getActiveOptions(values) {
      var activeValue = values || this.props.activeValue;
      var options = this.props.options;
      return (0, _arrayTreeFilter["default"])(options, function (o, level) {
        return o.value === activeValue[level];
      });
    }
  }, {
    key: "getShowOptions",
    value: function getShowOptions() {
      var options = this.props.options;
      var result = this.getActiveOptions().map(function (activeOption) {
        return activeOption.children;
      }).filter(function (activeOption) {
        return !!activeOption;
      });
      result.unshift(options);
      return result;
    }
  }, {
    key: "delayOnSelect",
    value: function delayOnSelect(onSelect) {
      var _this2 = this;

      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      if (this.delayTimer) {
        clearTimeout(this.delayTimer);
        this.delayTimer = null;
      }

      if (typeof onSelect === 'function') {
        this.delayTimer = setTimeout(function () {
          onSelect(args);
          _this2.delayTimer = null;
        }, 150);
      }
    }
  }, {
    key: "scrollActiveItemToView",
    value: function scrollActiveItemToView() {
      // scroll into view
      var optionsLength = this.getShowOptions().length;

      for (var i = 0; i < optionsLength; i++) {
        var itemComponent = this.menuItems[i];

        if (itemComponent) {
          var target = (0, _reactDom.findDOMNode)(itemComponent);
          target.parentNode.scrollTop = target.offsetTop;
        }
      }
    }
  }, {
    key: "isActiveOption",
    value: function isActiveOption(option, menuIndex) {
      var _this$props$activeVal = this.props.activeValue,
          activeValue = _this$props$activeVal === void 0 ? [] : _this$props$activeVal;
      return activeValue[menuIndex] === option.value;
    }
  }, {
    key: "render",
    value: function render() {
      var _this3 = this;

      var _this$props2 = this.props,
          prefixCls = _this$props2.prefixCls,
          dropdownMenuColumnStyle = _this$props2.dropdownMenuColumnStyle;
      return _react["default"].createElement("div", null, this.getShowOptions().map(function (options, menuIndex) {
        return _react["default"].createElement("ul", {
          className: "".concat(prefixCls, "-menu"),
          key: menuIndex,
          style: dropdownMenuColumnStyle
        }, options.map(function (option) {
          return _this3.getOption(option, menuIndex);
        }));
      }));
    }
  }]);
  return Menus;
}(_react.Component);

exports["default"] = Menus;
(0, _defineProperty2["default"])(Menus, "defaultProps", {
  options: [],
  value: [],
  activeValue: [],
  onSelect: function onSelect() {},
  prefixCls: 'rc-cascader-menus',
  visible: false,
  expandTrigger: 'click',
  expandIcon: '>'
});
(0, _defineProperty2["default"])(Menus, "propTypes", {
  value: _propTypes["default"].array,
  activeValue: _propTypes["default"].array,
  options: _propTypes["default"].array.isRequired,
  prefixCls: _propTypes["default"].string,
  expandTrigger: _propTypes["default"].string,
  onSelect: _propTypes["default"].func,
  visible: _propTypes["default"].bool,
  dropdownMenuColumnStyle: _propTypes["default"].object,
  expandIcon: _propTypes["default"].node
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lbnVzLmpzeCJdLCJuYW1lcyI6WyJNZW51cyIsInByb3BzIiwiaW5kZXgiLCJub2RlIiwibWVudUl0ZW1zIiwic2Nyb2xsQWN0aXZlSXRlbVRvVmlldyIsInByZXZQcm9wcyIsInZpc2libGUiLCJvcHRpb24iLCJtZW51SW5kZXgiLCJwcmVmaXhDbHMiLCJleHBhbmRUcmlnZ2VyIiwiZXhwYW5kSWNvbiIsIm9uU2VsZWN0IiwiYmluZCIsImV4cGFuZFByb3BzIiwib25DbGljayIsIm1lbnVJdGVtQ2xzIiwiZXhwYW5kSWNvbk5vZGUiLCJoYXNDaGlsZHJlbiIsImNoaWxkcmVuIiwibGVuZ3RoIiwiaXNMZWFmIiwib25Nb3VzZUVudGVyIiwiZGVsYXlPblNlbGVjdCIsIm9uTW91c2VMZWF2ZSIsImlzQWN0aXZlT3B0aW9uIiwicmVmIiwic2F2ZU1lbnVJdGVtIiwiZGlzYWJsZWQiLCJsb2FkaW5nIiwidGl0bGUiLCJsYWJlbCIsImtleSIsInZhbHVlIiwidmFsdWVzIiwiYWN0aXZlVmFsdWUiLCJvcHRpb25zIiwibyIsImxldmVsIiwicmVzdWx0IiwiZ2V0QWN0aXZlT3B0aW9ucyIsIm1hcCIsImFjdGl2ZU9wdGlvbiIsImZpbHRlciIsInVuc2hpZnQiLCJhcmdzIiwiZGVsYXlUaW1lciIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJvcHRpb25zTGVuZ3RoIiwiZ2V0U2hvd09wdGlvbnMiLCJpIiwiaXRlbUNvbXBvbmVudCIsInRhcmdldCIsInBhcmVudE5vZGUiLCJzY3JvbGxUb3AiLCJvZmZzZXRUb3AiLCJkcm9wZG93bk1lbnVDb2x1bW5TdHlsZSIsImdldE9wdGlvbiIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsImFycmF5IiwiaXNSZXF1aXJlZCIsInN0cmluZyIsImZ1bmMiLCJib29sIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7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LE9BQU8sQ0FBQ0ssR0FBUixDQUFZLFVBQUFsQyxNQUFNO0FBQUEsaUJBQUksTUFBSSxDQUFDbUQsU0FBTCxDQUFlbkQsTUFBZixFQUF1QkMsU0FBdkIsQ0FBSjtBQUFBLFNBQWxCLENBREgsQ0FEeUI7QUFBQSxPQUExQixDQURILENBREY7QUFTRDs7O0VBMUpnQ21ELGdCOzs7aUNBQWQ1RCxLLGtCQUNHO0FBQ3BCcUMsRUFBQUEsT0FBTyxFQUFFLEVBRFc7QUFFcEJILEVBQUFBLEtBQUssRUFBRSxFQUZhO0FBR3BCRSxFQUFBQSxXQUFXLEVBQUUsRUFITztBQUlwQnZCLEVBQUFBLFFBSm9CLHNCQUlULENBQ1YsQ0FMbUI7QUFNcEJILEVBQUFBLFNBQVMsRUFBRSxtQkFOUztBQU9wQkgsRUFBQUEsT0FBTyxFQUFFLEtBUFc7QUFRcEJJLEVBQUFBLGFBQWEsRUFBRSxPQVJLO0FBU3BCQyxFQUFBQSxVQUFVLEVBQUM7QUFUUyxDO2lDQURIWixLLGVBYUE7QUFDakJrQyxFQUFBQSxLQUFLLEVBQUUyQixzQkFBVUMsS0FEQTtBQUVqQjFCLEVBQUFBLFdBQVcsRUFBRXlCLHNCQUFVQyxLQUZOO0FBR2pCekIsRUFBQUEsT0FBTyxFQUFFd0Isc0JBQVVDLEtBQVYsQ0FBZ0JDLFVBSFI7QUFJakJyRCxFQUFBQSxTQUFTLEVBQUVtRCxzQkFBVUcsTUFKSjtBQUtqQnJELEVBQUFBLGFBQWEsRUFBRWtELHNCQUFVRyxNQUxSO0FBTWpCbkQsRUFBQUEsUUFBUSxFQUFFZ0Qsc0JBQVVJLElBTkg7QUFPakIxRCxFQUFBQSxPQUFPLEVBQUVzRCxzQkFBVUssSUFQRjtBQVFqQlIsRUFBQUEsdUJBQXVCLEVBQUVHLHNCQUFVTSxNQVJsQjtBQVNqQnZELEVBQUFBLFVBQVUsRUFBQ2lELHNCQUFVMUQ7QUFUSixDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgYXJyYXlUcmVlRmlsdGVyIGZyb20gJ2FycmF5LXRyZWUtZmlsdGVyJztcbmltcG9ydCB7IGZpbmRET01Ob2RlIH0gZnJvbSAncmVhY3QtZG9tJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVudXMgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIG9wdGlvbnM6IFtdLFxuICAgIHZhbHVlOiBbXSxcbiAgICBhY3RpdmVWYWx1ZTogW10sXG4gICAgb25TZWxlY3QoKSB7XG4gICAgfSxcbiAgICBwcmVmaXhDbHM6ICdyYy1jYXNjYWRlci1tZW51cycsXG4gICAgdmlzaWJsZTogZmFsc2UsXG4gICAgZXhwYW5kVHJpZ2dlcjogJ2NsaWNrJyxcbiAgICBleHBhbmRJY29uOic+JyxcbiAgfTtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHZhbHVlOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgYWN0aXZlVmFsdWU6IFByb3BUeXBlcy5hcnJheSxcbiAgICBvcHRpb25zOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZXhwYW5kVHJpZ2dlcjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBvblNlbGVjdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgdmlzaWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZHJvcGRvd25NZW51Q29sdW1uU3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZXhwYW5kSWNvbjpQcm9wVHlwZXMubm9kZSxcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICBcbiAgICB0aGlzLm1lbnVJdGVtcyA9IHt9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgdGhpcy5zY3JvbGxBY3RpdmVJdGVtVG9WaWV3KCk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKCFwcmV2UHJvcHMudmlzaWJsZSAmJiB0aGlzLnByb3BzLnZpc2libGUpIHtcbiAgICAgIHRoaXMuc2Nyb2xsQWN0aXZlSXRlbVRvVmlldygpO1xuICAgIH1cbiAgfVxuXG4gIGdldE9wdGlvbihvcHRpb24sIG1lbnVJbmRleCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBleHBhbmRUcmlnZ2VyLCBleHBhbmRJY29uIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG9uU2VsZWN0ID0gdGhpcy5wcm9wcy5vblNlbGVjdC5iaW5kKHRoaXMsIG9wdGlvbiwgbWVudUluZGV4KTtcbiAgICBsZXQgZXhwYW5kUHJvcHMgPSB7XG4gICAgICBvbkNsaWNrOiBvblNlbGVjdCxcbiAgICB9O1xuICAgIGxldCBtZW51SXRlbUNscyA9IGAke3ByZWZpeENsc30tbWVudS1pdGVtYDtcbiAgICBsZXQgZXhwYW5kSWNvbk5vZGUgPSBudWxsO1xuICAgIGNvbnN0IGhhc0NoaWxkcmVuID0gb3B0aW9uLmNoaWxkcmVuICYmIG9wdGlvbi5jaGlsZHJlbi5sZW5ndGggPiAwO1xuICAgIGlmIChoYXNDaGlsZHJlbiB8fCBvcHRpb24uaXNMZWFmID09PSBmYWxzZSkge1xuICAgICAgbWVudUl0ZW1DbHMgKz0gYCAke3ByZWZpeENsc30tbWVudS1pdGVtLWV4cGFuZGA7XG4gICAgICBleHBhbmRJY29uTm9kZSA9IChcbiAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LW1lbnUtaXRlbS1leHBhbmQtaWNvbmB9PlxuICAgICAgICAgIHtleHBhbmRJY29ufVxuICAgICAgICA8L3NwYW4+XG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoZXhwYW5kVHJpZ2dlciA9PT0gJ2hvdmVyJyAmJiBoYXNDaGlsZHJlbikge1xuICAgICAgZXhwYW5kUHJvcHMgPSB7XG4gICAgICAgIG9uTW91c2VFbnRlcjogdGhpcy5kZWxheU9uU2VsZWN0LmJpbmQodGhpcywgb25TZWxlY3QpLFxuICAgICAgICBvbk1vdXNlTGVhdmU6IHRoaXMuZGVsYXlPblNlbGVjdC5iaW5kKHRoaXMpLFxuICAgICAgICBvbkNsaWNrOiBvblNlbGVjdCxcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICh0aGlzLmlzQWN0aXZlT3B0aW9uKG9wdGlvbiwgbWVudUluZGV4KSkge1xuICAgICAgbWVudUl0ZW1DbHMgKz0gYCAke3ByZWZpeENsc30tbWVudS1pdGVtLWFjdGl2ZWA7XG4gICAgICBleHBhbmRQcm9wcy5yZWYgPSB0aGlzLnNhdmVNZW51SXRlbShtZW51SW5kZXgpO1xuICAgIH1cbiAgICBpZiAob3B0aW9uLmRpc2FibGVkKSB7XG4gICAgICBtZW51SXRlbUNscyArPSBgICR7cHJlZml4Q2xzfS1tZW51LWl0ZW0tZGlzYWJsZWRgO1xuICAgIH1cbiAgICBpZiAob3B0aW9uLmxvYWRpbmcpIHtcbiAgICAgIG1lbnVJdGVtQ2xzICs9IGAgJHtwcmVmaXhDbHN9LW1lbnUtaXRlbS1sb2FkaW5nYDtcbiAgICB9XG4gICAgbGV0IHRpdGxlID0gJyc7XG4gICAgaWYgKG9wdGlvbi50aXRsZSkge1xuICAgICAgdGl0bGUgPSBvcHRpb24udGl0bGU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9uLmxhYmVsID09PSAnc3RyaW5nJykge1xuICAgICAgdGl0bGUgPSBvcHRpb24ubGFiZWw7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8bGlcbiAgICAgICAga2V5PXtvcHRpb24ua2V5IHx8IG9wdGlvbi52YWx1ZX1cbiAgICAgICAgY2xhc3NOYW1lPXttZW51SXRlbUNsc31cbiAgICAgICAgdGl0bGU9e3RpdGxlfVxuICAgICAgICB7Li4uZXhwYW5kUHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtvcHRpb24ubGFiZWx9XG4gICAgICAgIHtleHBhbmRJY29uTm9kZX1cbiAgICAgIDwvbGk+XG4gICAgKTtcbiAgfVxuXG4gIGdldEFjdGl2ZU9wdGlvbnModmFsdWVzKSB7XG4gICAgY29uc3QgYWN0aXZlVmFsdWUgPSB2YWx1ZXMgfHwgdGhpcy5wcm9wcy5hY3RpdmVWYWx1ZTtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5wcm9wcy5vcHRpb25zO1xuICAgIHJldHVybiBhcnJheVRyZWVGaWx0ZXIob3B0aW9ucywgKG8sIGxldmVsKSA9PiBvLnZhbHVlID09PSBhY3RpdmVWYWx1ZVtsZXZlbF0pO1xuICB9XG5cbiAgZ2V0U2hvd09wdGlvbnMoKSB7XG4gICAgY29uc3QgeyBvcHRpb25zIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ2V0QWN0aXZlT3B0aW9ucygpXG4gICAgICAubWFwKGFjdGl2ZU9wdGlvbiA9PiBhY3RpdmVPcHRpb24uY2hpbGRyZW4pXG4gICAgICAuZmlsdGVyKGFjdGl2ZU9wdGlvbiA9PiAhIWFjdGl2ZU9wdGlvbik7XG4gICAgcmVzdWx0LnVuc2hpZnQob3B0aW9ucyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGRlbGF5T25TZWxlY3Qob25TZWxlY3QsIC4uLmFyZ3MpIHtcbiAgICBpZiAodGhpcy5kZWxheVRpbWVyKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVyKTtcbiAgICAgIHRoaXMuZGVsYXlUaW1lciA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygb25TZWxlY3QgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRoaXMuZGVsYXlUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBvblNlbGVjdChhcmdzKTtcbiAgICAgICAgdGhpcy5kZWxheVRpbWVyID0gbnVsbDtcbiAgICAgIH0sIDE1MCk7XG4gICAgfVxuICB9XG5cbiAgc2Nyb2xsQWN0aXZlSXRlbVRvVmlldygpIHtcbiAgICAvLyBzY3JvbGwgaW50byB2aWV3XG4gICAgY29uc3Qgb3B0aW9uc0xlbmd0aCA9IHRoaXMuZ2V0U2hvd09wdGlvbnMoKS5sZW5ndGg7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zTGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGl0ZW1Db21wb25lbnQgPSB0aGlzLm1lbnVJdGVtc1tpXTtcbiAgICAgIGlmIChpdGVtQ29tcG9uZW50KSB7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IGZpbmRET01Ob2RlKGl0ZW1Db21wb25lbnQpO1xuICAgICAgICB0YXJnZXQucGFyZW50Tm9kZS5zY3JvbGxUb3AgPSB0YXJnZXQub2Zmc2V0VG9wO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlzQWN0aXZlT3B0aW9uKG9wdGlvbiwgbWVudUluZGV4KSB7XG4gICAgY29uc3QgeyBhY3RpdmVWYWx1ZSA9IFtdIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiBhY3RpdmVWYWx1ZVttZW51SW5kZXhdID09PSBvcHRpb24udmFsdWU7XG4gIH1cblxuICBzYXZlTWVudUl0ZW0gPSAoaW5kZXgpID0+IChub2RlKSA9PiB7XG4gICAgdGhpcy5tZW51SXRlbXNbaW5kZXhdID0gbm9kZTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMsIGRyb3Bkb3duTWVudUNvbHVtblN0eWxlIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2PlxuICAgICAgICB7dGhpcy5nZXRTaG93T3B0aW9ucygpLm1hcCgob3B0aW9ucywgbWVudUluZGV4KSA9PlxuICAgICAgICAgIDx1bCBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tbWVudWB9IGtleT17bWVudUluZGV4fSBzdHlsZT17ZHJvcGRvd25NZW51Q29sdW1uU3R5bGV9PlxuICAgICAgICAgICAge29wdGlvbnMubWFwKG9wdGlvbiA9PiB0aGlzLmdldE9wdGlvbihvcHRpb24sIG1lbnVJbmRleCkpfVxuICAgICAgICAgIDwvdWw+LFxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl19