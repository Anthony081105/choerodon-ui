{"version":3,"sources":["/Users/huihuawk/Documents/opt/choerodon-ui/components-pro/performance-table/Scrollbar.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { DOMMouseMoveTracker, addStyle, getOffset } from 'dom-lib';\nimport { SCROLLBAR_MIN_WIDTH } from './constants';\nimport { defaultClassPrefix, getUnhandledProps, prefix } from './utils';\nimport TableContext from './TableContext';\nimport { ScrollbarProps } from './Scrollbar.d';\n\ntype Offset = {\n  top: number;\n  left: number;\n  height?: number;\n  width?: number;\n};\n\ntype State = {\n  barOffset: Offset;\n  handlePressed: boolean;\n};\n\nclass Scrollbar extends React.PureComponent<ScrollbarProps, State> {\n  static contextType = TableContext;\n  static propTypes = {\n    tableId: PropTypes.string,\n    vertical: PropTypes.bool,\n    length: PropTypes.number,\n    scrollLength: PropTypes.number,\n    className: PropTypes.string,\n    classPrefix: PropTypes.string,\n    onScroll: PropTypes.func,\n    onMouseDown: PropTypes.func,\n  };\n  static defaultProps = {\n    classPrefix: defaultClassPrefix('performance-table-scrollbar'),\n    scrollLength: 1,\n    length: 1,\n  };\n\n  scrollOffset = 0;\n  mouseMoveTracker = null;\n  handleRef: React.RefObject<HTMLDivElement>;\n  barRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: ScrollbarProps) {\n    super(props);\n    this.state = {\n      barOffset: {\n        top: 0,\n        left: 0,\n      },\n      handlePressed: false,\n    };\n    this.handleRef = React.createRef();\n    this.barRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.initBarOffset();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.vertical && this.props.scrollLength !== prevProps.scrollLength) {\n      this.initBarOffset();\n    } else if (!this.props.vertical && this.props.scrollLength !== prevProps.scrollLength) {\n      this.initBarOffset();\n    }\n  }\n\n  componentWillUnmount() {\n    this.releaseMouseMoves();\n  }\n\n  onWheelScroll(delta: number) {\n    const { length, scrollLength } = this.props;\n    const nextDelta = delta / (scrollLength / length);\n\n    this.updateScrollBarPosition(nextDelta);\n  }\n\n  getMouseMoveTracker() {\n    return (\n      this.mouseMoveTracker ||\n      new DOMMouseMoveTracker(this.handleDragMove, this.handleDragEnd, document.body)\n    );\n  }\n\n  initBarOffset() {\n    setTimeout(() => {\n      this.barRef.current &&\n      this.setState({\n        barOffset: getOffset(this.barRef.current),\n      });\n    }, 1);\n  }\n\n  handleMouseDown = (event: React.MouseEvent) => {\n    this.mouseMoveTracker = this.getMouseMoveTracker();\n    // @ts-ignore\n    this.mouseMoveTracker?.captureMouseMoves(event);\n    this.setState({ handlePressed: true });\n    this.props.onMouseDown?.(event);\n  };\n\n  handleDragEnd = () => {\n    this.releaseMouseMoves();\n    this.setState({ handlePressed: false });\n  };\n\n  handleScroll(delta: number, event: React.MouseEvent) {\n    const { length, scrollLength } = this.props;\n    const scrollDelta = delta * (scrollLength / length);\n\n    this.updateScrollBarPosition(delta);\n    this.props.onScroll?.(scrollDelta, event);\n  }\n\n  resetScrollBarPosition(forceDelta = 0) {\n    this.scrollOffset = 0;\n    this.updateScrollBarPosition(0, forceDelta);\n  }\n\n  updateScrollBarPosition(delta: number, forceDelta?: number) {\n    const { vertical, length, scrollLength } = this.props;\n    const { translateDOMPositionXY } = this.context;\n    const max =\n      scrollLength && length\n        ? length - Math.max((length / scrollLength) * length, SCROLLBAR_MIN_WIDTH + 2)\n        : 0;\n    const styles = {};\n\n    if (typeof forceDelta === 'undefined') {\n      this.scrollOffset += delta;\n      this.scrollOffset = Math.max(this.scrollOffset, 0);\n      this.scrollOffset = Math.min(this.scrollOffset, max);\n    } else {\n      this.scrollOffset = forceDelta || 0;\n    }\n\n    if (vertical) {\n      translateDOMPositionXY?.(styles, 0, this.scrollOffset);\n    } else {\n      translateDOMPositionXY?.(styles, this.scrollOffset, 0);\n    }\n\n    addStyle(this.handleRef.current, styles);\n  }\n\n  releaseMouseMoves() {\n    // @ts-ignore\n    this.mouseMoveTracker?.releaseMouseMoves?.();\n    this.mouseMoveTracker = null;\n  }\n\n  handleDragMove = (deltaX: number, deltaY: number, event: React.MouseEvent) => {\n    const { vertical } = this.props;\n\n    // @ts-ignore\n    if (!this.mouseMoveTracker || !this.mouseMoveTracker.isDragging()) {\n      return;\n    }\n\n    if (event?.buttons === 0 || window?.event?.['buttons'] === 0) {\n      this.releaseMouseMoves();\n      return;\n    }\n\n    this.handleScroll(vertical ? deltaY : deltaX, event);\n  };\n\n  /**\n   * 点击滚动条，然后滚动到指定位置\n   */\n  handleClick = (event: React.MouseEvent) => {\n    if (this.handleRef.current && this.handleRef.current?.contains(event.target as Node)) {\n      return;\n    }\n\n    const { vertical, length, scrollLength } = this.props;\n    const { barOffset } = this.state;\n    const offset = vertical ? event.pageY - barOffset.top : event.pageX - barOffset.left;\n\n    const handleWidth = (length / scrollLength) * length;\n    const delta = offset - handleWidth;\n\n    const nextDelta =\n      offset > this.scrollOffset ? delta - this.scrollOffset : offset - this.scrollOffset;\n    this.handleScroll(nextDelta, event);\n  };\n\n  render() {\n    const { vertical, length, scrollLength, classPrefix, className, tableId, ...rest } = this.props;\n    const { handlePressed } = this.state;\n    // @ts-ignore\n    const addPrefix = prefix(classPrefix);\n\n    const classes = classNames(classPrefix, className, {\n      [addPrefix('vertical')]: vertical,\n      [addPrefix('horizontal')]: !vertical,\n      [addPrefix('hide')]: scrollLength <= length,\n      [addPrefix('pressed')]: handlePressed,\n    });\n    const width = (length / scrollLength) * 100;\n    const styles: React.CSSProperties = {\n      [vertical ? 'height' : 'width']: `${width}%`,\n      [vertical ? 'minHeight' : 'minWidth']: SCROLLBAR_MIN_WIDTH,\n    };\n    const unhandled = getUnhandledProps(Scrollbar, rest);\n    const valuenow = (this.scrollOffset / length) * 100 + width;\n\n    return (\n      <div\n        role=\"scrollbar\"\n        aria-controls={tableId}\n        aria-valuemax=\"100\"\n        aria-valuemin=\"0\"\n        aria-valuenow={valuenow}\n        aria-orientation={vertical ? 'vertical' : 'horizontal'}\n        {...unhandled}\n        ref={this.barRef}\n        className={classes}\n        onClick={this.handleClick}\n      >\n        <div\n          ref={this.handleRef}\n          className={addPrefix('handle')}\n          style={styles}\n          onMouseDown={this.handleMouseDown}\n          role=\"button\"\n          tabIndex={-1}\n        />\n      </div>\n    );\n  }\n}\n\nexport default Scrollbar;\n"]}