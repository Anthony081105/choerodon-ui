8116b655b472dfe0ca3e14d09a22f77a
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _miniStore = require("mini-store");

var _ExpandIcon = _interopRequireDefault(require("./ExpandIcon"));

var ExpandableRow =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2["default"])(ExpandableRow, _Component);

  function ExpandableRow() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, ExpandableRow);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(ExpandableRow)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "hasExpandIcon", function (columnIndex) {
      var expandRowByClick = _this.props.expandRowByClick;
      return !_this.expandIconAsCell && !expandRowByClick && columnIndex === _this.expandIconColumnIndex;
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleExpandChange", function (record, event) {
      var _this$props = _this.props,
          onExpandedChange = _this$props.onExpandedChange,
          expanded = _this$props.expanded,
          rowKey = _this$props.rowKey;

      if (_this.expandable) {
        onExpandedChange(!expanded, record, event, rowKey);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleRowClick", function (record, index, event) {
      var _this$props2 = _this.props,
          expandRowByClick = _this$props2.expandRowByClick,
          onRowClick = _this$props2.onRowClick;

      if (expandRowByClick) {
        _this.handleExpandChange(record, event);
      }

      if (onRowClick) {
        onRowClick(record, index, event);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderExpandIcon", function () {
      var _this$props3 = _this.props,
          prefixCls = _this$props3.prefixCls,
          expanded = _this$props3.expanded,
          record = _this$props3.record,
          needIndentSpaced = _this$props3.needIndentSpaced;
      return _react["default"].createElement(_ExpandIcon["default"], {
        expandable: _this.expandable,
        prefixCls: prefixCls,
        onExpand: _this.handleExpandChange,
        needIndentSpaced: needIndentSpaced,
        expanded: expanded,
        record: record
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "renderExpandIconCell", function (cells) {
      if (!_this.expandIconAsCell) {
        return;
      }

      var prefixCls = _this.props.prefixCls;
      cells.push(_react["default"].createElement("td", {
        className: "".concat(prefixCls, "-expand-icon-cell"),
        key: "rc-table-expand-icon-cell"
      }, _this.renderExpandIcon()));
    });
    return _this;
  }

  (0, _createClass2["default"])(ExpandableRow, [{
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.handleDestroy();
    }
  }, {
    key: "handleDestroy",
    value: function handleDestroy() {
      var _this$props4 = this.props,
          onExpandedChange = _this$props4.onExpandedChange,
          rowKey = _this$props4.rowKey,
          record = _this$props4.record;

      if (this.expandable) {
        onExpandedChange(false, record, null, rowKey, true);
      }
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props5 = this.props,
          childrenColumnName = _this$props5.childrenColumnName,
          expandedRowRender = _this$props5.expandedRowRender,
          indentSize = _this$props5.indentSize,
          record = _this$props5.record,
          fixed = _this$props5.fixed;
      this.expandIconAsCell = fixed !== 'right' ? this.props.expandIconAsCell : false;
      this.expandIconColumnIndex = fixed !== 'right' ? this.props.expandIconColumnIndex : -1;
      var childrenData = record[childrenColumnName];
      this.expandable = !!(childrenData || expandedRowRender);
      var expandableRowProps = {
        indentSize: indentSize,
        onRowClick: this.handleRowClick,
        hasExpandIcon: this.hasExpandIcon,
        renderExpandIcon: this.renderExpandIcon,
        renderExpandIconCell: this.renderExpandIconCell
      };
      return this.props.children(expandableRowProps);
    }
  }]);
  return ExpandableRow;
}(_react.Component);

(0, _defineProperty2["default"])(ExpandableRow, "propTypes", {
  prefixCls: _propTypes["default"].string.isRequired,
  rowKey: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].number]).isRequired,
  fixed: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].bool]),
  record: _propTypes["default"].object.isRequired,
  indentSize: _propTypes["default"].number,
  needIndentSpaced: _propTypes["default"].bool.isRequired,
  expandRowByClick: _propTypes["default"].bool,
  expanded: _propTypes["default"].bool.isRequired,
  expandIconAsCell: _propTypes["default"].bool,
  expandIconColumnIndex: _propTypes["default"].number,
  childrenColumnName: _propTypes["default"].string,
  expandedRowRender: _propTypes["default"].func,
  onExpandedChange: _propTypes["default"].func.isRequired,
  onRowClick: _propTypes["default"].func,
  children: _propTypes["default"].func.isRequired
});

var _default = (0, _miniStore.connect)(function (_ref, _ref2) {
  var expandedRowKeys = _ref.expandedRowKeys;
  var rowKey = _ref2.rowKey;
  return {
    expanded: !!~expandedRowKeys.indexOf(rowKey)
  };
})(ExpandableRow);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4cGFuZGFibGVSb3cuanN4Il0sIm5hbWVzIjpbIkV4cGFuZGFibGVSb3ciLCJjb2x1bW5JbmRleCIsImV4cGFuZFJvd0J5Q2xpY2siLCJwcm9wcyIsImV4cGFuZEljb25Bc0NlbGwiLCJleHBhbmRJY29uQ29sdW1uSW5kZXgiLCJyZWNvcmQiLCJldmVudCIsIm9uRXhwYW5kZWRDaGFuZ2UiLCJleHBhbmRlZCIsInJvd0tleSIsImV4cGFuZGFibGUiLCJpbmRleCIsIm9uUm93Q2xpY2siLCJoYW5kbGVFeHBhbmRDaGFuZ2UiLCJwcmVmaXhDbHMiLCJuZWVkSW5kZW50U3BhY2VkIiwiY2VsbHMiLCJwdXNoIiwicmVuZGVyRXhwYW5kSWNvbiIsImhhbmRsZURlc3Ryb3kiLCJjaGlsZHJlbkNvbHVtbk5hbWUiLCJleHBhbmRlZFJvd1JlbmRlciIsImluZGVudFNpemUiLCJmaXhlZCIsImNoaWxkcmVuRGF0YSIsImV4cGFuZGFibGVSb3dQcm9wcyIsImhhbmRsZVJvd0NsaWNrIiwiaGFzRXhwYW5kSWNvbiIsInJlbmRlckV4cGFuZEljb25DZWxsIiwiY2hpbGRyZW4iLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwib25lT2ZUeXBlIiwibnVtYmVyIiwiYm9vbCIsIm9iamVjdCIsImZ1bmMiLCJleHBhbmRlZFJvd0tleXMiLCJpbmRleE9mIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0lBRU1BLGE7Ozs7Ozs7Ozs7Ozs7Ozs7O3NHQTZCWSxVQUFDQyxXQUFELEVBQWlCO0FBQUEsVUFDdkJDLGdCQUR1QixHQUNGLE1BQUtDLEtBREgsQ0FDdkJELGdCQUR1QjtBQUUvQixhQUFPLENBQUMsTUFBS0UsZ0JBQU4sSUFDTCxDQUFDRixnQkFESSxJQUVMRCxXQUFXLEtBQUssTUFBS0kscUJBRnZCO0FBR0QsSzsyR0FFb0IsVUFBQ0MsTUFBRCxFQUFTQyxLQUFULEVB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aEJoQjtBQWlCakJmLEVBQUFBLGtCQUFrQixFQUFFVyxzQkFBVUMsTUFqQmI7QUFrQmpCWCxFQUFBQSxpQkFBaUIsRUFBRVUsc0JBQVVPLElBbEJaO0FBbUJqQi9CLEVBQUFBLGdCQUFnQixFQUFFd0Isc0JBQVVPLElBQVYsQ0FBZUwsVUFuQmhCO0FBb0JqQnJCLEVBQUFBLFVBQVUsRUFBRW1CLHNCQUFVTyxJQXBCTDtBQXFCakJULEVBQUFBLFFBQVEsRUFBRUUsc0JBQVVPLElBQVYsQ0FBZUw7QUFyQlIsQzs7ZUFvSE4sd0JBQVE7QUFBQSxNQUFHTSxlQUFILFFBQUdBLGVBQUg7QUFBQSxNQUF3QjlCLE1BQXhCLFNBQXdCQSxNQUF4QjtBQUFBLFNBQXNDO0FBQzNERCxJQUFBQSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMrQixlQUFlLENBQUNDLE9BQWhCLENBQXdCL0IsTUFBeEI7QUFEOEMsR0FBdEM7QUFBQSxDQUFSLEVBRVhWLGFBRlcsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ21pbmktc3RvcmUnO1xuaW1wb3J0IEV4cGFuZEljb24gZnJvbSAnLi9FeHBhbmRJY29uJztcblxuY2xhc3MgRXhwYW5kYWJsZVJvdyBleHRlbmRzIENvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgcHJlZml4Q2xzOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgcm93S2V5OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICBQcm9wVHlwZXMubnVtYmVyLFxuICAgIF0pLmlzUmVxdWlyZWQsXG4gICAgZml4ZWQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIFByb3BUeXBlcy5ib29sLFxuICAgIF0pLFxuICAgIHJlY29yZDogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIGluZGVudFNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgbmVlZEluZGVudFNwYWNlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBleHBhbmRSb3dCeUNsaWNrOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBleHBhbmRlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBleHBhbmRJY29uQXNDZWxsOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBleHBhbmRJY29uQ29sdW1uSW5kZXg6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgY2hpbGRyZW5Db2x1bW5OYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGV4cGFuZGVkUm93UmVuZGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkV4cGFuZGVkQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uUm93Q2xpY2s6IFByb3BUeXBlcy5mdW5jLFxuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgdGhpcy5oYW5kbGVEZXN0cm95KCk7XG4gIH1cblxuICBoYXNFeHBhbmRJY29uID0gKGNvbHVtbkluZGV4KSA9PiB7XG4gICAgY29uc3QgeyBleHBhbmRSb3dCeUNsaWNrIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiAhdGhpcy5leHBhbmRJY29uQXNDZWxsICYmXG4gICAgICAhZXhwYW5kUm93QnlDbGljayAmJlxuICAgICAgY29sdW1uSW5kZXggPT09IHRoaXMuZXhwYW5kSWNvbkNvbHVtbkluZGV4O1xuICB9XG5cbiAgaGFuZGxlRXhwYW5kQ2hhbmdlID0gKHJlY29yZCwgZXZlbnQpID0+IHtcbiAgICBjb25zdCB7IG9uRXhwYW5kZWRDaGFuZ2UsIGV4cGFuZGVkLCByb3dLZXkgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKHRoaXMuZXhwYW5kYWJsZSkge1xuICAgICAgb25FeHBhbmRlZENoYW5nZSghZXhwYW5kZWQsIHJlY29yZCwgZXZlbnQsIHJvd0tleSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlRGVzdHJveSgpIHtcbiAgICBjb25zdCB7IG9uRXhwYW5kZWRDaGFuZ2UsIHJvd0tleSwgcmVjb3JkIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICh0aGlzLmV4cGFuZGFibGUpIHtcbiAgICAgIG9uRXhwYW5kZWRDaGFuZ2UoZmFsc2UsIHJlY29yZCwgbnVsbCwgcm93S2V5LCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVSb3dDbGljayA9IChyZWNvcmQsIGluZGV4LCBldmVudCkgPT4ge1xuICAgIGNvbnN0IHsgZXhwYW5kUm93QnlDbGljaywgb25Sb3dDbGljayB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoZXhwYW5kUm93QnlDbGljaykge1xuICAgICAgdGhpcy5oYW5kbGVFeHBhbmRDaGFuZ2UocmVjb3JkLCBldmVudCk7XG4gICAgfVxuICAgIGlmIChvblJvd0NsaWNrKSB7XG4gICAgICBvblJvd0NsaWNrKHJlY29yZCwgaW5kZXgsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICByZW5kZXJFeHBhbmRJY29uID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzLCBleHBhbmRlZCwgcmVjb3JkLCBuZWVkSW5kZW50U3BhY2VkIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxFeHBhbmRJY29uXG4gICAgICAgIGV4cGFuZGFibGU9e3RoaXMuZXhwYW5kYWJsZX1cbiAgICAgICAgcHJlZml4Q2xzPXtwcmVmaXhDbHN9XG4gICAgICAgIG9uRXhwYW5kPXt0aGlzLmhhbmRsZUV4cGFuZENoYW5nZX1cbiAgICAgICAgbmVlZEluZGVudFNwYWNlZD17bmVlZEluZGVudFNwYWNlZH1cbiAgICAgICAgZXhwYW5kZWQ9e2V4cGFuZGVkfVxuICAgICAgICByZWNvcmQ9e3JlY29yZH1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlckV4cGFuZEljb25DZWxsID0gKGNlbGxzKSA9PiB7XG4gICAgaWYgKCF0aGlzLmV4cGFuZEljb25Bc0NlbGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBwcmVmaXhDbHMgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjZWxscy5wdXNoKFxuICAgICAgPHRkXG4gICAgICAgIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1leHBhbmQtaWNvbi1jZWxsYH1cbiAgICAgICAga2V5PVwicmMtdGFibGUtZXhwYW5kLWljb24tY2VsbFwiXG4gICAgICA+XG4gICAgICAgIHt0aGlzLnJlbmRlckV4cGFuZEljb24oKX1cbiAgICAgIDwvdGQ+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjaGlsZHJlbkNvbHVtbk5hbWUsXG4gICAgICBleHBhbmRlZFJvd1JlbmRlcixcbiAgICAgIGluZGVudFNpemUsXG4gICAgICByZWNvcmQsXG4gICAgICBmaXhlZCxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIHRoaXMuZXhwYW5kSWNvbkFzQ2VsbCA9IGZpeGVkICE9PSAncmlnaHQnID8gdGhpcy5wcm9wcy5leHBhbmRJY29uQXNDZWxsIDogZmFsc2U7XG4gICAgdGhpcy5leHBhbmRJY29uQ29sdW1uSW5kZXggPSBmaXhlZCAhPT0gJ3JpZ2h0JyA/IHRoaXMucHJvcHMuZXhwYW5kSWNvbkNvbHVtbkluZGV4IDogLTE7XG4gICAgY29uc3QgY2hpbGRyZW5EYXRhID0gcmVjb3JkW2NoaWxkcmVuQ29sdW1uTmFtZV07XG4gICAgdGhpcy5leHBhbmRhYmxlID0gISEoY2hpbGRyZW5EYXRhIHx8IGV4cGFuZGVkUm93UmVuZGVyKTtcblxuICAgIGNvbnN0IGV4cGFuZGFibGVSb3dQcm9wcyA9IHtcbiAgICAgIGluZGVudFNpemUsXG4gICAgICBvblJvd0NsaWNrOiB0aGlzLmhhbmRsZVJvd0NsaWNrLFxuICAgICAgaGFzRXhwYW5kSWNvbjogdGhpcy5oYXNFeHBhbmRJY29uLFxuICAgICAgcmVuZGVyRXhwYW5kSWNvbjogdGhpcy5yZW5kZXJFeHBhbmRJY29uLFxuICAgICAgcmVuZGVyRXhwYW5kSWNvbkNlbGw6IHRoaXMucmVuZGVyRXhwYW5kSWNvbkNlbGwsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLnByb3BzLmNoaWxkcmVuKGV4cGFuZGFibGVSb3dQcm9wcyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY29ubmVjdCgoeyBleHBhbmRlZFJvd0tleXMgfSwgeyByb3dLZXkgfSkgPT4gKHtcbiAgZXhwYW5kZWQ6ICEhfmV4cGFuZGVkUm93S2V5cy5pbmRleE9mKHJvd0tleSksXG59KSkoRXhwYW5kYWJsZVJvdyk7XG4iXX0=