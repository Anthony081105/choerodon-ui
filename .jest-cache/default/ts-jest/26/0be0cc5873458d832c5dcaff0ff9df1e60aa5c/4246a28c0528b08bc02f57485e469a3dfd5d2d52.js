import React, { Component } from 'react';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import Icon from '../icon';
import { Circle } from '../rc-components/progress';
import Loading from './Loading';
import { getPrefixCls } from '../configure';
const statusColorMap = {
    normal: '#108ee9',
    exception: '#ff5500',
    success: '#87d068',
};
export default class Progress extends Component {
    render() {
        const props = this.props;
        const { prefixCls: customizePrefixCls, className, percent = 0, status, format, trailColor, size, successPercent, type, strokeWidth, strokeColor, width, showInfo, gapDegree = 0, gapPosition, ...restProps } = props;
        const prefixCls = getPrefixCls('progress', customizePrefixCls);
        const progressStatus = parseInt(successPercent ? successPercent.toString() : percent.toString(), 10) >= 100 &&
            !('status' in props)
            ? "success" /* success */
            : status || "normal" /* normal */;
        let progressInfo;
        let progress;
        const textFormatter = format || (percentNumber => `${percentNumber}%`);
        if (showInfo) {
            let text;
            const circleType = type === "circle" /* circle */ || type === "dashboard" /* dashboard */;
            if (progressStatus === "exception" /* exception */) {
                text = format ? textFormatter(percent) : React.createElement(Icon, { type: circleType ? 'close' : 'cancel' });
            }
            else if (progressStatus === "success" /* success */) {
                text = format ? (textFormatter(percent)) : (React.createElement(Icon, { type: circleType ? 'check' : 'check_circle' }));
            }
            else {
                text = textFormatter(percent);
            }
            progressInfo = React.createElement("span", { className: `${prefixCls}-text` }, text);
        }
        if (type === "line" /* line */) {
            const percentStyle = {
                width: `${percent}%`,
                height: strokeWidth || (size === "small" /* small */ ? 6 : 8),
                background: strokeColor,
            };
            const successPercentStyle = {
                width: `${successPercent}%`,
                height: strokeWidth || (size === "small" /* small */ ? 6 : 8),
            };
            const successSegment = successPercent !== undefined ? (React.createElement("div", { className: `${prefixCls}-success-bg`, style: successPercentStyle })) : null;
            progress = (React.createElement("div", null,
                React.createElement("div", { className: `${prefixCls}-outer` },
                    React.createElement("div", { className: `${prefixCls}-inner` },
                        React.createElement("div", { className: `${prefixCls}-bg`, style: percentStyle }),
                        successSegment)),
                progressInfo));
        }
        else if (type === "circle" /* circle */ || type === "dashboard" /* dashboard */) {
            const circleSize = width || 120;
            const circleStyle = {
                width: circleSize,
                height: circleSize,
                fontSize: circleSize * 0.15 + 6,
            };
            const circleWidth = strokeWidth || 6;
            const gapPos = gapPosition ||
                (type === "dashboard" /* dashboard */ && "bottom" /* bottom */) ||
                "top" /* top */;
            const gapDeg = gapDegree || (type === "dashboard" /* dashboard */ && 75);
            progress = (React.createElement("div", { className: `${prefixCls}-inner`, style: circleStyle },
                React.createElement(Circle, { percent: percent, strokeWidth: circleWidth, trailWidth: circleWidth, trailColor: trailColor, strokeColor: statusColorMap[progressStatus], prefixCls: prefixCls, gapDegree: gapDeg, gapPosition: gapPos }),
                progressInfo));
        }
        else if (type === "loading" /* loading */) {
            progress = (React.createElement("div", { className: `${prefixCls}-inner` },
                React.createElement(Loading, null)));
        }
        const classString = classNames(prefixCls, {
            [`${prefixCls}-${(type === "dashboard" /* dashboard */ && "circle" /* circle */) || type}`]: true,
            [`${prefixCls}-status-${progressStatus}`]: true,
            [`${prefixCls}-show-info`]: showInfo,
            [`${prefixCls}-${size}`]: size,
        }, className);
        return (React.createElement("div", Object.assign({}, restProps, { className: classString }), progress));
    }
}
Progress.displayName = 'Progress';
Progress.defaultProps = {
    type: "line" /* line */,
    percent: 0,
    showInfo: true,
    trailColor: '#f3f3f3',
    size: "default" /* default */,
};
Progress.propTypes = {
    status: PropTypes.oneOf([
        "normal" /* normal */,
        "exception" /* exception */,
        "active" /* active */,
        "success" /* success */,
    ]),
    type: PropTypes.oneOf([
        "line" /* line */,
        "circle" /* circle */,
        "dashboard" /* dashboard */,
        "loading" /* loading */,
    ]),
    showInfo: PropTypes.bool,
    percent: PropTypes.number,
    width: PropTypes.number,
    strokeWidth: PropTypes.number,
    strokeColor: PropTypes.string,
    trailColor: PropTypes.string,
    format: PropTypes.func,
    gapDegree: PropTypes.number,
    size: PropTypes.oneOf(["default" /* default */, "small" /* small */, "large" /* large */]),
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvcHJvZ3Jlc3MvcHJvZ3Jlc3MudHN4IiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFpQixNQUFNLE9BQU8sQ0FBQztBQUN4RCxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxVQUFVLE1BQU0sWUFBWSxDQUFDO0FBQ3BDLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDbkQsT0FBTyxPQUFPLE1BQU0sV0FBVyxDQUFDO0FBR2hDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFNUMsTUFBTSxjQUFjLEdBQUc7SUFDckIsTUFBTSxFQUFFLFNBQVM7SUFDakIsU0FBUyxFQUFFLFNBQVM7SUFDcEIsT0FBTyxFQUFFLFNBQVM7Q0FDbkIsQ0FBQztBQXFCRixNQUFNLENBQUMsT0FBTyxPQUFPLFFBQVMsU0FBUSxTQUE0QjtJQXlDaEUsTUFBTTtRQUNKLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDekIsTUFBTSxFQUNKLFNBQVMsRUFBRSxrQkFBa0IsRUFDN0IsU0FBUyxFQUNULE9BQU8sR0FBRyxDQUFDLEVBQ1gsTUFBTSxFQUNOLE1BQU0sRUFDTixVQUFVLEVBQ1YsSUFBSSxFQUNKLGNBQWMsRUFDZCxJQUFJLEVBQ0osV0FBVyxFQUNYLFdBQVcsRUFDWCxLQUFLLEVBQ0wsUUFBUSxFQUNSLFNBQVMsR0FBRyxDQUFDLEVBQ2IsV0FBVyxFQUNYLEdBQUcsU0FBUyxFQUNiLEdBQUcsS0FBSyxDQUFDO1FBQ1YsTUFBTSxTQUFTLEdBQUcsWUFBWSxDQUFDLFVBQVUsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQy9ELE1BQU0sY0FBYyxHQUNsQixRQUFRLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsUUFBUSxF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O1FBRUYsT0FBTyxDQUNMLDZDQUFTLFNBQVMsSUFBRSxTQUFTLEVBQUUsV0FBVyxLQUN2QyxRQUFRLENBQ0wsQ0FDUCxDQUFDO0lBQ0osQ0FBQzs7QUFwS00sb0JBQVcsR0FBRyxVQUFVLENBQUM7QUFRekIscUJBQVksR0FBRztJQUNwQixJQUFJLG1CQUFtQjtJQUN2QixPQUFPLEVBQUUsQ0FBQztJQUNWLFFBQVEsRUFBRSxJQUFJO0lBQ2QsVUFBVSxFQUFFLFNBQVM7SUFDckIsSUFBSSx5QkFBYztDQUNuQixDQUFDO0FBRUssa0JBQVMsR0FBRztJQUNqQixNQUFNLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQzs7Ozs7S0FLdkIsQ0FBQztJQUNGLElBQUksRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDOzs7OztLQUtyQixDQUFDO0lBQ0YsUUFBUSxFQUFFLFNBQVMsQ0FBQyxJQUFJO0lBQ3hCLE9BQU8sRUFBRSxTQUFTLENBQUMsTUFBTTtJQUN6QixLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU07SUFDdkIsV0FBVyxFQUFFLFNBQVMsQ0FBQyxNQUFNO0lBQzdCLFdBQVcsRUFBRSxTQUFTLENBQUMsTUFBTTtJQUM3QixVQUFVLEVBQUUsU0FBUyxDQUFDLE1BQU07SUFDNUIsTUFBTSxFQUFFLFNBQVMsQ0FBQyxJQUFJO0lBQ3RCLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtJQUMzQixJQUFJLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxtRUFBc0MsQ0FBQztDQUM5RCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzL3Byb2dyZXNzL3Byb2dyZXNzLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50LCBDU1NQcm9wZXJ0aWVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgeyBDaXJjbGUgfSBmcm9tICcuLi9yYy1jb21wb25lbnRzL3Byb2dyZXNzJztcbmltcG9ydCBMb2FkaW5nIGZyb20gJy4vTG9hZGluZyc7XG5pbXBvcnQgeyBTaXplIH0gZnJvbSAnLi4vX3V0aWwvZW51bSc7XG5pbXBvcnQgeyBQcm9ncmVzc1Bvc2l0aW9uLCBQcm9ncmVzc1N0YXR1cywgUHJvZ3Jlc3NUeXBlIH0gZnJvbSAnLi9lbnVtJztcbmltcG9ydCB7IGdldFByZWZpeENscyB9IGZyb20gJy4uL2NvbmZpZ3VyZSc7XG5cbmNvbnN0IHN0YXR1c0NvbG9yTWFwID0ge1xuICBub3JtYWw6ICcjMTA4ZWU5JyxcbiAgZXhjZXB0aW9uOiAnI2ZmNTUwMCcsXG4gIHN1Y2Nlc3M6ICcjODdkMDY4Jyxcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvZ3Jlc3NQcm9wcyB7XG4gIHByZWZpeENscz86IHN0cmluZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICB0eXBlPzogUHJvZ3Jlc3NUeXBlO1xuICBwZXJjZW50PzogbnVtYmVyO1xuICBzdWNjZXNzUGVyY2VudD86IG51bWJlcjtcbiAgZm9ybWF0PzogKHBlcmNlbnQ6IG51bWJlcikgPT4gc3RyaW5nO1xuICBzdGF0dXM/OiBQcm9ncmVzc1N0YXR1cztcbiAgc2hvd0luZm8/OiBib29sZWFuO1xuICBzdHJva2VXaWR0aD86IG51bWJlcjtcbiAgdHJhaWxDb2xvcj86IHN0cmluZztcbiAgc3Ryb2tlQ29sb3I/OiBzdHJpbmc7XG4gIHdpZHRoPzogbnVtYmVyO1xuICBzdHlsZT86IENTU1Byb3BlcnRpZXM7XG4gIGdhcERlZ3JlZT86IG51bWJlcjtcbiAgZ2FwUG9zaXRpb24/OiBQcm9ncmVzc1Bvc2l0aW9uO1xuICBzaXplPzogU2l6ZTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvZ3Jlc3MgZXh0ZW5kcyBDb21wb25lbnQ8UHJvZ3Jlc3NQcm9wcywge30+IHtcbiAgc3RhdGljIGRpc3BsYXlOYW1lID0gJ1Byb2dyZXNzJztcblxuICBzdGF0aWMgTGluZTogYW55O1xuXG4gIHN0YXRpYyBDaXJjbGU6IGFueTtcblxuICBzdGF0aWMgTG9hZGluZzogYW55O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdHlwZTogUHJvZ3Jlc3NUeXBlLmxpbmUsXG4gICAgcGVyY2VudDogMCxcbiAgICBzaG93SW5mbzogdHJ1ZSxcbiAgICB0cmFpbENvbG9yOiAnI2YzZjNmMycsXG4gICAgc2l6ZTogU2l6ZS5kZWZhdWx0LFxuICB9O1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgc3RhdHVzOiBQcm9wVHlwZXMub25lT2YoW1xuICAgICAgUHJvZ3Jlc3NTdGF0dXMubm9ybWFsLFxuICAgICAgUHJvZ3Jlc3NTdGF0dXMuZXhjZXB0aW9uLFxuICAgICAgUHJvZ3Jlc3NTdGF0dXMuYWN0aXZlLFxuICAgICAgUHJvZ3Jlc3NTdGF0dXMuc3VjY2VzcyxcbiAgICBdKSxcbiAgICB0eXBlOiBQcm9wVHlwZXMub25lT2YoW1xuICAgICAgUHJvZ3Jlc3NUeXBlLmxpbmUsXG4gICAgICBQcm9ncmVzc1R5cGUuY2lyY2xlLFxuICAgICAgUHJvZ3Jlc3NUeXBlLmRhc2hib2FyZCxcbiAgICAgIFByb2dyZXNzVHlwZS5sb2FkaW5nLFxuICAgIF0pLFxuICAgIHNob3dJbmZvOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBwZXJjZW50OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHdpZHRoOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHN0cm9rZVdpZHRoOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHN0cm9rZUNvbG9yOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHRyYWlsQ29sb3I6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgZm9ybWF0OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBnYXBEZWdyZWU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgc2l6ZTogUHJvcFR5cGVzLm9uZU9mKFtTaXplLmRlZmF1bHQsIFNpemUuc21hbGwsIFNpemUubGFyZ2VdKSxcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgcHJvcHMgPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENsczogY3VzdG9taXplUHJlZml4Q2xzLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgcGVyY2VudCA9IDAsXG4gICAgICBzdGF0dXMsXG4gICAgICBmb3JtYXQsXG4gICAgICB0cmFpbENvbG9yLFxuICAgICAgc2l6ZSxcbiAgICAgIHN1Y2Nlc3NQZXJjZW50LFxuICAgICAgdHlwZSxcbiAgICAgIHN0cm9rZVdpZHRoLFxuICAgICAgc3Ryb2tlQ29sb3IsXG4gICAgICB3aWR0aCxcbiAgICAgIHNob3dJbmZvLFxuICAgICAgZ2FwRGVncmVlID0gMCxcbiAgICAgIGdhcFBvc2l0aW9uLFxuICAgICAgLi4ucmVzdFByb3BzXG4gICAgfSA9IHByb3BzO1xuICAgIGNvbnN0IHByZWZpeENscyA9IGdldFByZWZpeENscygncHJvZ3Jlc3MnLCBjdXN0b21pemVQcmVmaXhDbHMpO1xuICAgIGNvbnN0IHByb2dyZXNzU3RhdHVzID1cbiAgICAgIHBhcnNlSW50KHN1Y2Nlc3NQZXJjZW50ID8gc3VjY2Vzc1BlcmNlbnQudG9TdHJpbmcoKSA6IHBlcmNlbnQudG9TdHJpbmcoKSwgMTApID49IDEwMCAmJlxuICAgICAgISgnc3RhdHVzJyBpbiBwcm9wcylcbiAgICAgICAgPyBQcm9ncmVzc1N0YXR1cy5zdWNjZXNzXG4gICAgICAgIDogc3RhdHVzIHx8IFByb2dyZXNzU3RhdHVzLm5vcm1hbDtcbiAgICBsZXQgcHJvZ3Jlc3NJbmZvO1xuICAgIGxldCBwcm9ncmVzcztcbiAgICBjb25zdCB0ZXh0Rm9ybWF0dGVyID0gZm9ybWF0IHx8IChwZXJjZW50TnVtYmVyID0+IGAke3BlcmNlbnROdW1iZXJ9JWApO1xuXG4gICAgaWYgKHNob3dJbmZvKSB7XG4gICAgICBsZXQgdGV4dDtcbiAgICAgIGNvbnN0IGNpcmNsZVR5cGUgPSB0eXBlID09PSBQcm9ncmVzc1R5cGUuY2lyY2xlIHx8IHR5cGUgPT09IFByb2dyZXNzVHlwZS5kYXNoYm9hcmQ7XG4gICAgICBpZiAocHJvZ3Jlc3NTdGF0dXMgPT09IFByb2dyZXNzU3RhdHVzLmV4Y2VwdGlvbikge1xuICAgICAgICB0ZXh0ID0gZm9ybWF0ID8gdGV4dEZvcm1hdHRlcihwZXJjZW50KSA6IDxJY29uIHR5cGU9e2NpcmNsZVR5cGUgPyAnY2xvc2UnIDogJ2NhbmNlbCd9IC8+O1xuICAgICAgfSBlbHNlIGlmIChwcm9ncmVzc1N0YXR1cyA9PT0gUHJvZ3Jlc3NTdGF0dXMuc3VjY2Vzcykge1xuICAgICAgICB0ZXh0ID0gZm9ybWF0ID8gKFxuICAgICAgICAgIHRleHRGb3JtYXR0ZXIocGVyY2VudClcbiAgICAgICAgKSA6IChcbiAgICAgICAgICA8SWNvbiB0eXBlPXtjaXJjbGVUeXBlID8gJ2NoZWNrJyA6ICdjaGVja19jaXJjbGUnfSAvPlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGV4dCA9IHRleHRGb3JtYXR0ZXIocGVyY2VudCk7XG4gICAgICB9XG4gICAgICBwcm9ncmVzc0luZm8gPSA8c3BhbiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdGV4dGB9Pnt0ZXh0fTwvc3Bhbj47XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT09IFByb2dyZXNzVHlwZS5saW5lKSB7XG4gICAgICBjb25zdCBwZXJjZW50U3R5bGUgPSB7XG4gICAgICAgIHdpZHRoOiBgJHtwZXJjZW50fSVgLFxuICAgICAgICBoZWlnaHQ6IHN0cm9rZVdpZHRoIHx8IChzaXplID09PSBTaXplLnNtYWxsID8gNiA6IDgpLFxuICAgICAgICBiYWNrZ3JvdW5kOiBzdHJva2VDb2xvcixcbiAgICAgIH07XG4gICAgICBjb25zdCBzdWNjZXNzUGVyY2VudFN0eWxlID0ge1xuICAgICAgICB3aWR0aDogYCR7c3VjY2Vzc1BlcmNlbnR9JWAsXG4gICAgICAgIGhlaWdodDogc3Ryb2tlV2lkdGggfHwgKHNpemUgPT09IFNpemUuc21hbGwgPyA2IDogOCksXG4gICAgICB9O1xuICAgICAgY29uc3Qgc3VjY2Vzc1NlZ21lbnQgPVxuICAgICAgICBzdWNjZXNzUGVyY2VudCAhPT0gdW5kZWZpbmVkID8gKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXN1Y2Nlc3MtYmdgfSBzdHlsZT17c3VjY2Vzc1BlcmNlbnRTdHlsZX0gLz5cbiAgICAgICAgKSA6IG51bGw7XG4gICAgICBwcm9ncmVzcyA9IChcbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1vdXRlcmB9PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taW5uZXJgfT5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tYmdgfSBzdHlsZT17cGVyY2VudFN0eWxlfSAvPlxuICAgICAgICAgICAgICB7c3VjY2Vzc1NlZ21lbnR9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICB7cHJvZ3Jlc3NJbmZvfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBQcm9ncmVzc1R5cGUuY2lyY2xlIHx8IHR5cGUgPT09IFByb2dyZXNzVHlwZS5kYXNoYm9hcmQpIHtcbiAgICAgIGNvbnN0IGNpcmNsZVNpemUgPSB3aWR0aCB8fCAxMjA7XG4gICAgICBjb25zdCBjaXJjbGVTdHlsZSA9IHtcbiAgICAgICAgd2lkdGg6IGNpcmNsZVNpemUsXG4gICAgICAgIGhlaWdodDogY2lyY2xlU2l6ZSxcbiAgICAgICAgZm9udFNpemU6IGNpcmNsZVNpemUgKiAwLjE1ICsgNixcbiAgICAgIH07XG4gICAgICBjb25zdCBjaXJjbGVXaWR0aCA9IHN0cm9rZVdpZHRoIHx8IDY7XG4gICAgICBjb25zdCBnYXBQb3MgPVxuICAgICAgICBnYXBQb3NpdGlvbiB8fFxuICAgICAgICAodHlwZSA9PT0gUHJvZ3Jlc3NUeXBlLmRhc2hib2FyZCAmJiBQcm9ncmVzc1Bvc2l0aW9uLmJvdHRvbSkgfHxcbiAgICAgICAgUHJvZ3Jlc3NQb3NpdGlvbi50b3A7XG4gICAgICBjb25zdCBnYXBEZWcgPSBnYXBEZWdyZWUgfHwgKHR5cGUgPT09IFByb2dyZXNzVHlwZS5kYXNoYm9hcmQgJiYgNzUpO1xuICAgICAgcHJvZ3Jlc3MgPSAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWlubmVyYH0gc3R5bGU9e2NpcmNsZVN0eWxlfT5cbiAgICAgICAgICA8Q2lyY2xlXG4gICAgICAgICAgICBwZXJjZW50PXtwZXJjZW50fVxuICAgICAgICAgICAgc3Ryb2tlV2lkdGg9e2NpcmNsZVdpZHRofVxuICAgICAgICAgICAgdHJhaWxXaWR0aD17Y2lyY2xlV2lkdGh9XG4gICAgICAgICAgICB0cmFpbENvbG9yPXt0cmFpbENvbG9yfVxuICAgICAgICAgICAgc3Ryb2tlQ29sb3I9eyhzdGF0dXNDb2xvck1hcCBhcyBhbnkpW3Byb2dyZXNzU3RhdHVzXX1cbiAgICAgICAgICAgIHByZWZpeENscz17cHJlZml4Q2xzfVxuICAgICAgICAgICAgZ2FwRGVncmVlPXtnYXBEZWd9XG4gICAgICAgICAgICBnYXBQb3NpdGlvbj17Z2FwUG9zfVxuICAgICAgICAgIC8+XG4gICAgICAgICAge3Byb2dyZXNzSW5mb31cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gUHJvZ3Jlc3NUeXBlLmxvYWRpbmcpIHtcbiAgICAgIHByb2dyZXNzID0gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1pbm5lcmB9PlxuICAgICAgICAgIDxMb2FkaW5nIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGFzc1N0cmluZyA9IGNsYXNzTmFtZXMoXG4gICAgICBwcmVmaXhDbHMsXG4gICAgICB7XG4gICAgICAgIFtgJHtwcmVmaXhDbHN9LSR7KHR5cGUgPT09IFByb2dyZXNzVHlwZS5kYXNoYm9hcmQgJiYgUHJvZ3Jlc3NUeXBlLmNpcmNsZSkgfHwgdHlwZX1gXTogdHJ1ZSxcbiAgICAgICAgW2Ake3ByZWZpeENsc30tc3RhdHVzLSR7cHJvZ3Jlc3NTdGF0dXN9YF06IHRydWUsXG4gICAgICAgIFtgJHtwcmVmaXhDbHN9LXNob3ctaW5mb2BdOiBzaG93SW5mbyxcbiAgICAgICAgW2Ake3ByZWZpeENsc30tJHtzaXplfWBdOiBzaXplLFxuICAgICAgfSxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgey4uLnJlc3RQcm9wc30gY2xhc3NOYW1lPXtjbGFzc1N0cmluZ30+XG4gICAgICAgIHtwcm9ncmVzc31cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==