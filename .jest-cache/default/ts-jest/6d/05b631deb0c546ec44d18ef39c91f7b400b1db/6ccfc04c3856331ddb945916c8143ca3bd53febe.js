import { __decorate } from "tslib";
import React from 'react';
import PropTypes from 'prop-types';
import { observer } from 'mobx-react';
import { computed, isArrayLike } from 'mobx';
import omit from 'lodash/omit';
import { Select } from '../select/Select';
import ObserverRadio from '../radio/Radio';
import ObserverCheckBox from '../check-box/CheckBox';
import autobind from '../_util/autobind';
import Option from '../option/Option';
import OptGroup from '../option/OptGroup';
import { $l } from '../locale-context';
const GroupIdGen = (function* (id) {
    while (true) {
        yield `__group-${id++}__`;
    }
})(1);
let SelectBox = class SelectBox extends Select {
    get defaultValidationMessages() {
        const label = this.getProp('label');
        return {
            valueMissing: $l('SelectBox', label ? 'value_missing' : 'value_missing_no_label', {
                label,
            }),
        };
    }
    get name() {
        return this.observableProps.name || GroupIdGen.next().value;
    }
    getOtherProps() {
        return omit(super.getOtherProps(), ['vertical']);
    }
    getClassName() {
        const { prefixCls, props: { vertical }, } = this;
        return super.getClassName({
            [`${prefixCls}-vertical`]: vertical,
        });
    }
    isEmpty() {
        return false;
    }
    renderWrapper() {
        const { options, textField, valueField } = this;
        const { autoFocus, mode, onOption } = this.props;
        const items = options.data.map((record, index) => {
            const optionProps = onOption({ dataSet: options, record });
            return this.renderItem({
                ...optionProps,
                key: index,
                dataSet: null,
                record: null,
                value: record.get(valueField),
                checked: this.isChecked(this.getValue(), record.get(valueField)),
                name: this.name,
                onChange: this.handleItemChange,
                children: record.get(textField),
                autoFocus: autoFocus && index === 0,
                readOnly: this.isReadOnly(),
                disabled: this.isDisabled() || (optionProps && optionProps.disabled),
                mode,
                noValidate: true,
                labelLayout: "none" /* none */,
            });
        });
        const { className } = this.getOtherProps();
        const Element = this.context.formNode ? 'div' : 'form';
        return (React.createElement("span", Object.assign({ key: "wrapper" }, this.getWrapperProps()),
            React.createElement(Element, { className: className }, items),
            this.renderFloatLabel()));
    }
    handleItemChange(value, oldValue) {
        if (this.multiple) {
            const values = this.getValues();
            if (!value) {
                values.splice(values.indexOf(oldValue), 1);
            }
            else {
                values.push(value);
            }
            this.setValue(values);
        }
        else {
            this.setValue(value);
        }
    }
    isChecked(value, checkedValue) {
        if (isArrayLike(value)) {
            return value.indexOf(checkedValue) !== -1;
        }
        return value === checkedValue;
    }
    renderItem(props) {
        if (this.multiple) {
            return React.createElement(ObserverCheckBox, Object.assign({}, props));
        }
        return React.createElement(ObserverRadio, Object.assign({}, props));
    }
};
SelectBox.displayName = 'SelectBox';
SelectBox.propTypes = {
    /**
     * 是否垂直显示
     */
    vertical: PropTypes.bool,
    ...Select.propTypes,
};
SelectBox.defaultProps = {
    ...Select.defaultProps,
    suffixCls: 'select-box',
    vertical: false,
};
SelectBox.Option = Option;
SelectBox.OptGroup = OptGroup;
__decorate([
    computed
], SelectBox.prototype, "defaultValidationMessages", null);
__decorate([
    computed
], SelectBox.prototype, "name", null);
__decorate([
    autobind
], SelectBox.prototype, "handleItemChange", null);
SelectBox = __decorate([
    observer
], SelectBox);
export default SelectBox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3NlbGVjdC1ib3gvU2VsZWN0Qm94LnRzeCIsIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUFvQixNQUFNLE9BQU8sQ0FBQztBQUN6QyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0QyxPQUFPLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxFQUFFLE1BQU0sRUFBZSxNQUFNLGtCQUFrQixDQUFDO0FBQ3ZELE9BQU8sYUFBYSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sZ0JBQWdCLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxRQUFRLE1BQU0sbUJBQW1CLENBQUM7QUFFekMsT0FBTyxNQUFNLE1BQU0sa0JBQWtCLENBQUM7QUFDdEMsT0FBTyxRQUFRLE1BQU0sb0JBQW9CLENBQUM7QUFFMUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBR3ZDLE1BQU0sVUFBVSxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUMsRUFBRTtJQUM5QixPQUFPLElBQUksRUFBRTtRQUNYLE1BQU0sV0FBVyxFQUFFLEVBQUUsSUFBSSxDQUFDO0tBQzNCO0FBQ0gsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFXTixJQUFxQixTQUFTLEdBQTlCLE1BQXFCLFNBQVUsU0FBUSxNQUFzQjtJQXNCM0QsSUFBSSx5QkFBeUI7UUFDM0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwQyxPQUFPO1lBQ0wsWUFBWSxFQUFFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixFQUFFO2dCQUNoRixLQUFLO2FBQ04sQ0FBQztTQUNILENBQUM7SUFDSixDQUFDO0lBR0QsSUFBSSxJQUFJO1FBQ04sT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDO0lBQzlELENBQUM7SUFFRCxhQUFhO1FBQ1gsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQsWUFBWTtRQUNWLE1BQU0sRUFDSixTQUFTLEVBQ1QsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLEdBQ3BCLEdBQUcsSUFBSSxDQUFDO1FBQ1QsT0FBTyxLQUFLLENBQUMsWUFBWSxDQUFDO1lBQ3hCLENBQUMsR0FBRyxTQUFTLFdBQVcsQ0FBQyxFQUFFLFFBQVE7U0FDcEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELE9BQU87UUFDTCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxhQUFhO1FBQ1gsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ2hELE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDakQsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDL0MsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzNELE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztnQkFDckIsR0FBRyxXQUFXO2dCQUNkLEdBQUcsRUFBRSxLQUFLO2dCQUNWLE9BQU8sRUFBRSxJQUFJO2dCQUNiLE1BQU0sRUFBRSxJQUFJO2dCQUNaLEtBQUssRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztnQkFDN0IsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ2hFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtnQkFDZixRQUFRLEVBQUUsSUFBSSxDQUFDLGdCQUFnQjtnQkFDL0IsUUFBUSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO2dCQUMvQixTQUFTLEVBQUUsU0FBUyxJQUFJLEtBQUssS0FBSyxDQUFDO2dCQUNuQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRTtnQkFDM0IsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFdBQVcsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDO2dCQUNwRSxJQUFJO2dCQUNKLFVBQVUsRUFBRSxJQUFJO2dCQUNoQixXQUFXLG1CQUFrQjthQUM5QixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDM0MsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ3ZELE9BQU8sQ0FDTCw0Q0FBTSxHQUFHLEVBQUMsU0FBUyxJQUFLLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDNUMsb0JBQUMsT0FBTyxJQUFDLFNBQVMsRUFBRSxTQUFTLElBQUcsS0FBSyxDQUFXO1lBQy9DLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUNuQixDQUNSLENBQUM7SUFDSixDQUFDO0lBR0QsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLFFBQVE7UUFDOUIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNoQyxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNWLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUM1QztpQkFBTTtnQkFDTCxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ3BCO1lBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN2QjthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUN0QjtJQUNILENBQUM7SUFFRCxTQUFTLENBQUMsS0FBSyxFQUFFLFlBQVk7UUFDM0IsSUFBSSxXQUFXLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdEIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQzNDO1FBQ0QsT0FBTyxLQUFLLEtBQUssWUFBWSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxVQUFVLENBQUMsS0FBSztRQUNkLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixPQUFPLG9CQUFDLGdCQUFnQixvQkFBSyxLQUFLLEVBQUksQ0FBQztTQUN4QztRQUNELE9BQU8sb0JBQUMsYUFBYSxvQkFBSyxLQUFLLEVBQUksQ0FBQztJQUN0QyxDQUFDO0NBQ0YsQ0FBQTtBQWxIUSxxQkFBVyxHQUFHLFdBQVcsQ0FBQztBQUUxQixtQkFBUyxHQUFHO0lBQ2pCOztPQUVHO0lBQ0gsUUFBUSxFQUFFLFNBQVMsQ0FBQyxJQUFJO0lBQ3hCLEdBQUcsTUFBTSxDQUFDLFNBQVM7Q0FDcEIsQ0FBQztBQUVLLHNCQUFZLEdBQUc7SUFDcEIsR0FBRyxNQUFNLENBQUMsWUFBWTtJQUN0QixTQUFTLEVBQUUsWUFBWTtJQUN2QixRQUFRLEVBQUUsS0FBSztDQUNoQixDQUFDO0FBRUssZ0JBQU0sR0FBRyxNQUFNLENBQUM7QUFFaEIsa0JBQVEsR0FBRyxRQUFRLENBQUM7QUFHM0I7SUFEQyxRQUFROzBEQVFSO0FBR0Q7SUFEQyxRQUFRO3FDQUdSO0FBc0REO0lBREMsUUFBUTtpREFhUjtBQXBHa0IsU0FBUztJQUQ3QixRQUFRO0dBQ1ksU0FBUyxDQW1IN0I7ZUFuSG9CLFNBQVMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3NlbGVjdC1ib3gvU2VsZWN0Qm94LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IG9ic2VydmVyIH0gZnJvbSAnbW9ieC1yZWFjdCc7XG5pbXBvcnQgeyBjb21wdXRlZCwgaXNBcnJheUxpa2UgfSBmcm9tICdtb2J4JztcbmltcG9ydCBvbWl0IGZyb20gJ2xvZGFzaC9vbWl0JztcbmltcG9ydCB7IFNlbGVjdCwgU2VsZWN0UHJvcHMgfSBmcm9tICcuLi9zZWxlY3QvU2VsZWN0JztcbmltcG9ydCBPYnNlcnZlclJhZGlvIGZyb20gJy4uL3JhZGlvL1JhZGlvJztcbmltcG9ydCBPYnNlcnZlckNoZWNrQm94IGZyb20gJy4uL2NoZWNrLWJveC9DaGVja0JveCc7XG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnLi4vX3V0aWwvYXV0b2JpbmQnO1xuaW1wb3J0IHsgVmFsaWRhdGlvbk1lc3NhZ2VzIH0gZnJvbSAnLi4vdmFsaWRhdG9yL1ZhbGlkYXRvcic7XG5pbXBvcnQgT3B0aW9uIGZyb20gJy4uL29wdGlvbi9PcHRpb24nO1xuaW1wb3J0IE9wdEdyb3VwIGZyb20gJy4uL29wdGlvbi9PcHRHcm91cCc7XG5pbXBvcnQgeyBWaWV3TW9kZSB9IGZyb20gJy4uL3JhZGlvL2VudW0nO1xuaW1wb3J0IHsgJGwgfSBmcm9tICcuLi9sb2NhbGUtY29udGV4dCc7XG5pbXBvcnQgeyBMYWJlbExheW91dCB9IGZyb20gJy4uL2Zvcm0vZW51bSc7XG5cbmNvbnN0IEdyb3VwSWRHZW4gPSAoZnVuY3Rpb24qKGlkKSB7XG4gIHdoaWxlICh0cnVlKSB7XG4gICAgeWllbGQgYF9fZ3JvdXAtJHtpZCsrfV9fYDtcbiAgfVxufSkoMSk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VsZWN0Qm94UHJvcHMgZXh0ZW5kcyBTZWxlY3RQcm9wcyB7XG4gIC8qKlxuICAgKiDmmK/lkKblnoLnm7TmmL7npLpcbiAgICovXG4gIHZlcnRpY2FsPzogYm9vbGVhbjtcbiAgbW9kZT86IFZpZXdNb2RlO1xufVxuXG5Ab2JzZXJ2ZXJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbGVjdEJveCBleHRlbmRzIFNlbGVjdDxTZWxlY3RCb3hQcm9wcz4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnU2VsZWN0Qm94JztcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIOaYr+WQpuWeguebtOaYvuekulxuICAgICAqL1xuICAgIHZlcnRpY2FsOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAuLi5TZWxlY3QucHJvcFR5cGVzLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgLi4uU2VsZWN0LmRlZmF1bHRQcm9wcyxcbiAgICBzdWZmaXhDbHM6ICdzZWxlY3QtYm94JyxcbiAgICB2ZXJ0aWNhbDogZmFsc2UsXG4gIH07XG5cbiAgc3RhdGljIE9wdGlvbiA9IE9wdGlvbjtcblxuICBzdGF0aWMgT3B0R3JvdXAgPSBPcHRHcm91cDtcblxuICBAY29tcHV0ZWRcbiAgZ2V0IGRlZmF1bHRWYWxpZGF0aW9uTWVzc2FnZXMoKTogVmFsaWRhdGlvbk1lc3NhZ2VzIHtcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0UHJvcCgnbGFiZWwnKTtcbiAgICByZXR1cm4ge1xuICAgICAgdmFsdWVNaXNzaW5nOiAkbCgnU2VsZWN0Qm94JywgbGFiZWwgPyAndmFsdWVfbWlzc2luZycgOiAndmFsdWVfbWlzc2luZ19ub19sYWJlbCcsIHtcbiAgICAgICAgbGFiZWwsXG4gICAgICB9KSxcbiAgICB9O1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBuYW1lKCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXMub2JzZXJ2YWJsZVByb3BzLm5hbWUgfHwgR3JvdXBJZEdlbi5uZXh0KCkudmFsdWU7XG4gIH1cblxuICBnZXRPdGhlclByb3BzKCkge1xuICAgIHJldHVybiBvbWl0KHN1cGVyLmdldE90aGVyUHJvcHMoKSwgWyd2ZXJ0aWNhbCddKTtcbiAgfVxuXG4gIGdldENsYXNzTmFtZSgpIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBwcm9wczogeyB2ZXJ0aWNhbCB9LFxuICAgIH0gPSB0aGlzO1xuICAgIHJldHVybiBzdXBlci5nZXRDbGFzc05hbWUoe1xuICAgICAgW2Ake3ByZWZpeENsc30tdmVydGljYWxgXTogdmVydGljYWwsXG4gICAgfSk7XG4gIH1cblxuICBpc0VtcHR5KCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJlbmRlcldyYXBwZXIoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7IG9wdGlvbnMsIHRleHRGaWVsZCwgdmFsdWVGaWVsZCB9ID0gdGhpcztcbiAgICBjb25zdCB7IGF1dG9Gb2N1cywgbW9kZSwgb25PcHRpb24gfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgaXRlbXMgPSBvcHRpb25zLmRhdGEubWFwKChyZWNvcmQsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBvcHRpb25Qcm9wcyA9IG9uT3B0aW9uKHsgZGF0YVNldDogb3B0aW9ucywgcmVjb3JkIH0pO1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVySXRlbSh7XG4gICAgICAgIC4uLm9wdGlvblByb3BzLFxuICAgICAgICBrZXk6IGluZGV4LFxuICAgICAgICBkYXRhU2V0OiBudWxsLFxuICAgICAgICByZWNvcmQ6IG51bGwsXG4gICAgICAgIHZhbHVlOiByZWNvcmQuZ2V0KHZhbHVlRmllbGQpLFxuICAgICAgICBjaGVja2VkOiB0aGlzLmlzQ2hlY2tlZCh0aGlzLmdldFZhbHVlKCksIHJlY29yZC5nZXQodmFsdWVGaWVsZCkpLFxuICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUl0ZW1DaGFuZ2UsXG4gICAgICAgIGNoaWxkcmVuOiByZWNvcmQuZ2V0KHRleHRGaWVsZCksXG4gICAgICAgIGF1dG9Gb2N1czogYXV0b0ZvY3VzICYmIGluZGV4ID09PSAwLFxuICAgICAgICByZWFkT25seTogdGhpcy5pc1JlYWRPbmx5KCksXG4gICAgICAgIGRpc2FibGVkOiB0aGlzLmlzRGlzYWJsZWQoKSB8fCAob3B0aW9uUHJvcHMgJiYgb3B0aW9uUHJvcHMuZGlzYWJsZWQpLFxuICAgICAgICBtb2RlLFxuICAgICAgICBub1ZhbGlkYXRlOiB0cnVlLFxuICAgICAgICBsYWJlbExheW91dDogTGFiZWxMYXlvdXQubm9uZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNvbnN0IHsgY2xhc3NOYW1lIH0gPSB0aGlzLmdldE90aGVyUHJvcHMoKTtcbiAgICBjb25zdCBFbGVtZW50ID0gdGhpcy5jb250ZXh0LmZvcm1Ob2RlID8gJ2RpdicgOiAnZm9ybSc7XG4gICAgcmV0dXJuIChcbiAgICAgIDxzcGFuIGtleT1cIndyYXBwZXJcIiB7Li4udGhpcy5nZXRXcmFwcGVyUHJvcHMoKX0+XG4gICAgICAgIDxFbGVtZW50IGNsYXNzTmFtZT17Y2xhc3NOYW1lfT57aXRlbXN9PC9FbGVtZW50PlxuICAgICAgICB7dGhpcy5yZW5kZXJGbG9hdExhYmVsKCl9XG4gICAgICA8L3NwYW4+XG4gICAgKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVJdGVtQ2hhbmdlKHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICBjb25zdCB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygpO1xuICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICB2YWx1ZXMuc3BsaWNlKHZhbHVlcy5pbmRleE9mKG9sZFZhbHVlKSwgMSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZXMucHVzaCh2YWx1ZSk7XG4gICAgICB9XG4gICAgICB0aGlzLnNldFZhbHVlKHZhbHVlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGlzQ2hlY2tlZCh2YWx1ZSwgY2hlY2tlZFZhbHVlKSB7XG4gICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHZhbHVlLmluZGV4T2YoY2hlY2tlZFZhbHVlKSAhPT0gLTE7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZSA9PT0gY2hlY2tlZFZhbHVlO1xuICB9XG5cbiAgcmVuZGVySXRlbShwcm9wcykge1xuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICByZXR1cm4gPE9ic2VydmVyQ2hlY2tCb3ggey4uLnByb3BzfSAvPjtcbiAgICB9XG4gICAgcmV0dXJuIDxPYnNlcnZlclJhZGlvIHsuLi5wcm9wc30gLz47XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==