import React, { Component, createElement } from 'react';
import omit from 'lodash/omit';
import classNames from 'classnames';
import { getPrefixCls } from '../configure';
function getNumberArray(num) {
    return num
        ? num
            .toString()
            .split('')
            .reverse()
            .map(i => Number(i))
        : [];
}
export default class ScrollNumber extends Component {
    constructor(props) {
        super(props);
        this.renderCurrentNumber = (num, i) => {
            const position = this.getPositionByNum(num, i);
            const { animateStarted } = this.state;
            const removeTransition = animateStarted || getNumberArray(this.lastCount)[i] === undefined;
            return createElement('span', {
                className: `${this.getPrefixCls()}-only`,
                style: {
                    transition: removeTransition && 'none',
                    msTransform: `translateY(${-position * 100}%)`,
                    WebkitTransform: `translateY(${-position * 100}%)`,
                    transform: `translateY(${-position * 100}%)`,
                },
                key: i,
            }, this.renderNumberList(position));
        };
        this.state = {
            animateStarted: true,
            count: props.count,
        };
    }
    getPositionByNum(num, i) {
        const { animateStarted, count } = this.state;
        if (animateStarted) {
            return 10 + num;
        }
        const currentDigit = getNumberArray(count)[i];
        const lastDigit = getNumberArray(this.lastCount)[i];
        // 同方向则在同一侧切换数字
        if (count > this.lastCount) {
            if (currentDigit >= lastDigit) {
                return 10 + num;
            }
            return 20 + num;
        }
        if (currentDigit <= lastDigit) {
            return 10 + num;
        }
        return num;
    }
    componentWillReceiveProps(nextProps) {
        if ('count' in nextProps) {
            const { count } = this.state;
            if (count === nextProps.count) {
                return;
            }
            this.lastCount = count;
            // 复原数字初始位置
            this.setState({
                animateStarted: true,
            }, () => {
                // 等待数字位置复原完毕
                // 开始设置完整的数字
                setTimeout(() => {
                    this.setState({
                        animateStarted: false,
                        count: nextProps.count,
                    }, () => {
                        const { onAnimated } = this.props;
                        if (onAnimated) {
                            onAnimated();
                        }
                    });
                }, 5);
            });
        }
    }
    getPrefixCls() {
        const { prefixCls } = this.props;
        return getPrefixCls('scroll-number', prefixCls);
    }
    renderNumberList(position) {
        const childrenToReturn = [];
        for (let i = 0; i < 30; i++) {
            const currentClassName = position === i ? 'current' : '';
            childrenToReturn.push(React.createElement("p", { key: i.toString(), className: currentClassName }, i % 10));
        }
        return childrenToReturn;
    }
    renderNumberElement() {
        const state = this.state;
        if (!state.count || isNaN(state.count)) {
            return state.count;
        }
        return getNumberArray(state.count)
            .map(this.renderCurrentNumber)
            .reverse();
    }
    render() {
        const { className, style, component = 'sup' } = this.props;
        const restProps = omit(this.props, ['count', 'onAnimated', 'component', 'prefixCls']);
        const newProps = {
            ...restProps,
            className: classNames(this.getPrefixCls(), className),
        };
        if (style && style.borderColor) {
            newProps.style.boxShadow = `0 0 0 1px ${style.borderColor} inset`;
        }
        return createElement(component, newProps, this.renderNumberElement());
    }
}
ScrollNumber.displayName = 'ScrollNumber';
ScrollNumber.defaultProps = {
    count: null,
    onAnimated() { },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvYmFkZ2UvU2Nyb2xsTnVtYmVyLnRzeCIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQStCLE1BQU0sT0FBTyxDQUFDO0FBQ3JGLE9BQU8sSUFBSSxNQUFNLGFBQWEsQ0FBQztBQUMvQixPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUU1QyxTQUFTLGNBQWMsQ0FBQyxHQUFnQztJQUN0RCxPQUFPLEdBQUc7UUFDUixDQUFDLENBQUMsR0FBRzthQUNBLFFBQVEsRUFBRTthQUNWLEtBQUssQ0FBQyxFQUFFLENBQUM7YUFDVCxPQUFPLEVBQUU7YUFDVCxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUNULENBQUM7QUFrQkQsTUFBTSxDQUFDLE9BQU8sT0FBTyxZQUFhLFNBQVEsU0FBK0M7SUFVdkYsWUFBWSxLQUF3QjtRQUNsQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUErRWYsd0JBQW1CLEdBQUcsQ0FBQyxHQUFXLEVBQUUsQ0FBUyxFQUFFLEVBQUU7WUFDL0MsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMvQyxNQUFNLEVBQUUsY0FBYyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN0QyxNQUFNLGdCQUFnQixHQUFHLGNBQWMsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQztZQUMzRixPQUFPLGFBQWEsQ0FDbEIsTUFBTSxFQUNOO2dCQUNFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUs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USxDQUFDO1NBQ3BFO1FBQ0QsT0FBTyxhQUFhLENBQUMsU0FBZ0IsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztJQUMvRSxDQUFDOztBQXJJTSx3QkFBVyxHQUFHLGNBQWMsQ0FBQztBQUU3Qix5QkFBWSxHQUFHO0lBQ3BCLEtBQUssRUFBRSxJQUFJO0lBQ1gsVUFBVSxLQUFJLENBQUM7Q0FDaEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy9iYWRnZS9TY3JvbGxOdW1iZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQsIGNyZWF0ZUVsZW1lbnQsIENTU1Byb3BlcnRpZXMsIFJlYWN0RWxlbWVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBvbWl0IGZyb20gJ2xvZGFzaC9vbWl0JztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcblxuZnVuY3Rpb24gZ2V0TnVtYmVyQXJyYXkobnVtOiBzdHJpbmcgfCBudW1iZXIgfCB1bmRlZmluZWQpIHtcbiAgcmV0dXJuIG51bVxuICAgID8gbnVtXG4gICAgICAgIC50b1N0cmluZygpXG4gICAgICAgIC5zcGxpdCgnJylcbiAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAubWFwKGkgPT4gTnVtYmVyKGkpKVxuICAgIDogW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Nyb2xsTnVtYmVyUHJvcHMge1xuICBwcmVmaXhDbHM/OiBzdHJpbmc7XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbiAgY291bnQ/OiBzdHJpbmcgfCBudW1iZXI7XG4gIGNvbXBvbmVudD86IHN0cmluZztcbiAgb25BbmltYXRlZD86IEZ1bmN0aW9uO1xuICBzdHlsZT86IENTU1Byb3BlcnRpZXM7XG4gIHRpdGxlPzogc3RyaW5nIHwgbnVtYmVyO1xuICBoaWRkZW4/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNjcm9sbE51bWJlclN0YXRlIHtcbiAgYW5pbWF0ZVN0YXJ0ZWQ/OiBib29sZWFuO1xuICBjb3VudD86IHN0cmluZyB8IG51bWJlcjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2Nyb2xsTnVtYmVyIGV4dGVuZHMgQ29tcG9uZW50PFNjcm9sbE51bWJlclByb3BzLCBTY3JvbGxOdW1iZXJTdGF0ZT4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnU2Nyb2xsTnVtYmVyJztcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGNvdW50OiBudWxsLFxuICAgIG9uQW5pbWF0ZWQoKSB7fSxcbiAgfTtcblxuICBsYXN0Q291bnQ6IGFueTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogU2Nyb2xsTnVtYmVyUHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGFuaW1hdGVTdGFydGVkOiB0cnVlLFxuICAgICAgY291bnQ6IHByb3BzLmNvdW50LFxuICAgIH07XG4gIH1cblxuICBnZXRQb3NpdGlvbkJ5TnVtKG51bTogbnVtYmVyLCBpOiBudW1iZXIpIHtcbiAgICBjb25zdCB7IGFuaW1hdGVTdGFydGVkLCBjb3VudCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoYW5pbWF0ZVN0YXJ0ZWQpIHtcbiAgICAgIHJldHVybiAxMCArIG51bTtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudERpZ2l0ID0gZ2V0TnVtYmVyQXJyYXkoY291bnQpW2ldO1xuICAgIGNvbnN0IGxhc3REaWdpdCA9IGdldE51bWJlckFycmF5KHRoaXMubGFzdENvdW50KVtpXTtcbiAgICAvLyDlkIzmlrnlkJHliJnlnKjlkIzkuIDkvqfliIfmjaLmlbDlrZdcbiAgICBpZiAoY291bnQhID4gdGhpcy5sYXN0Q291bnQpIHtcbiAgICAgIGlmIChjdXJyZW50RGlnaXQgPj0gbGFzdERpZ2l0KSB7XG4gICAgICAgIHJldHVybiAxMCArIG51bTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAyMCArIG51bTtcbiAgICB9XG4gICAgaWYgKGN1cnJlbnREaWdpdCA8PSBsYXN0RGlnaXQpIHtcbiAgICAgIHJldHVybiAxMCArIG51bTtcbiAgICB9XG4gICAgcmV0dXJuIG51bTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBTY3JvbGxOdW1iZXJQcm9wcykge1xuICAgIGlmICgnY291bnQnIGluIG5leHRQcm9wcykge1xuICAgICAgY29uc3QgeyBjb3VudCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgIGlmIChjb3VudCA9PT0gbmV4dFByb3BzLmNvdW50KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMubGFzdENvdW50ID0gY291bnQ7XG4gICAgICAvLyDlpI3ljp/mlbDlrZfliJ3lp4vkvY3nva5cbiAgICAgIHRoaXMuc2V0U3RhdGUoXG4gICAgICAgIHtcbiAgICAgICAgICBhbmltYXRlU3RhcnRlZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgKCkgPT4ge1xuICAgICAgICAgIC8vIOetieW+heaVsOWtl+S9jee9ruWkjeWOn+WujOavlVxuICAgICAgICAgIC8vIOW8gOWni+iuvue9ruWujOaVtOeahOaVsOWtl1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGFuaW1hdGVTdGFydGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjb3VudDogbmV4dFByb3BzLmNvdW50LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBvbkFuaW1hdGVkIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICAgICAgICAgIGlmIChvbkFuaW1hdGVkKSB7XG4gICAgICAgICAgICAgICAgICBvbkFuaW1hdGVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1KTtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZ2V0UHJlZml4Q2xzKCkge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiBnZXRQcmVmaXhDbHMoJ3Njcm9sbC1udW1iZXInLCBwcmVmaXhDbHMpO1xuICB9XG5cbiAgcmVuZGVyTnVtYmVyTGlzdChwb3NpdGlvbjogbnVtYmVyKSB7XG4gICAgY29uc3QgY2hpbGRyZW5Ub1JldHVybjogUmVhY3RFbGVtZW50PGFueT5bXSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzA7IGkrKykge1xuICAgICAgY29uc3QgY3VycmVudENsYXNzTmFtZSA9IHBvc2l0aW9uID09PSBpID8gJ2N1cnJlbnQnIDogJyc7XG4gICAgICBjaGlsZHJlblRvUmV0dXJuLnB1c2goXG4gICAgICAgIDxwIGtleT17aS50b1N0cmluZygpfSBjbGFzc05hbWU9e2N1cnJlbnRDbGFzc05hbWV9PlxuICAgICAgICAgIHtpICUgMTB9XG4gICAgICAgIDwvcD4sXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gY2hpbGRyZW5Ub1JldHVybjtcbiAgfVxuXG4gIHJlbmRlckN1cnJlbnROdW1iZXIgPSAobnVtOiBudW1iZXIsIGk6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5nZXRQb3NpdGlvbkJ5TnVtKG51bSwgaSk7XG4gICAgY29uc3QgeyBhbmltYXRlU3RhcnRlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCByZW1vdmVUcmFuc2l0aW9uID0gYW5pbWF0ZVN0YXJ0ZWQgfHwgZ2V0TnVtYmVyQXJyYXkodGhpcy5sYXN0Q291bnQpW2ldID09PSB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIGNyZWF0ZUVsZW1lbnQoXG4gICAgICAnc3BhbicsXG4gICAgICB7XG4gICAgICAgIGNsYXNzTmFtZTogYCR7dGhpcy5nZXRQcmVmaXhDbHMoKX0tb25seWAsXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgdHJhbnNpdGlvbjogcmVtb3ZlVHJhbnNpdGlvbiAmJiAnbm9uZScsXG4gICAgICAgICAgbXNUcmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7LXBvc2l0aW9uICogMTAwfSUpYCxcbiAgICAgICAgICBXZWJraXRUcmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7LXBvc2l0aW9uICogMTAwfSUpYCxcbiAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7LXBvc2l0aW9uICogMTAwfSUpYCxcbiAgICAgICAgfSxcbiAgICAgICAga2V5OiBpLFxuICAgICAgfSxcbiAgICAgIHRoaXMucmVuZGVyTnVtYmVyTGlzdChwb3NpdGlvbiksXG4gICAgKTtcbiAgfTtcblxuICByZW5kZXJOdW1iZXJFbGVtZW50KCkge1xuICAgIGNvbnN0IHN0YXRlID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoIXN0YXRlLmNvdW50IHx8IGlzTmFOKHN0YXRlLmNvdW50IGFzIG51bWJlcikpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5jb3VudDtcbiAgICB9XG4gICAgcmV0dXJuIGdldE51bWJlckFycmF5KHN0YXRlLmNvdW50KVxuICAgICAgLm1hcCh0aGlzLnJlbmRlckN1cnJlbnROdW1iZXIpXG4gICAgICAucmV2ZXJzZSgpO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgY2xhc3NOYW1lLCBzdHlsZSwgY29tcG9uZW50ID0gJ3N1cCcgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcmVzdFByb3BzID0gb21pdDxTY3JvbGxOdW1iZXJQcm9wcywgJ2NvdW50JyB8ICdvbkFuaW1hdGVkJyB8ICdjb21wb25lbnQnIHwgJ3ByZWZpeENscyc+KFxuICAgICAgdGhpcy5wcm9wcyxcbiAgICAgIFsnY291bnQnLCAnb25BbmltYXRlZCcsICdjb21wb25lbnQnLCAncHJlZml4Q2xzJ10sXG4gICAgKTtcbiAgICBjb25zdCBuZXdQcm9wcyA9IHtcbiAgICAgIC4uLnJlc3RQcm9wcyxcbiAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyh0aGlzLmdldFByZWZpeENscygpLCBjbGFzc05hbWUpLFxuICAgIH07XG4gICAgaWYgKHN0eWxlICYmIHN0eWxlLmJvcmRlckNvbG9yKSB7XG4gICAgICBuZXdQcm9wcy5zdHlsZSEuYm94U2hhZG93ID0gYDAgMCAwIDFweCAke3N0eWxlLmJvcmRlckNvbG9yfSBpbnNldGA7XG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVFbGVtZW50KGNvbXBvbmVudCBhcyBhbnksIG5ld1Byb3BzLCB0aGlzLnJlbmRlck51bWJlckVsZW1lbnQoKSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==