import React, { Component } from 'react';
import { findDOMNode } from 'react-dom';
import classNames from 'classnames';
import isNumber from 'lodash/isNumber';
import Icon from '../icon';
import { getPrefixCls } from '../configure';
export default class Avatar extends Component {
    constructor(props) {
        super(props);
        this.setScale = () => {
            const childrenNode = this.avatarChildren;
            if (childrenNode) {
                const childrenWidth = childrenNode.offsetWidth;
                const avatarNode = findDOMNode(this);
                const avatarWidth = avatarNode.getBoundingClientRect().width;
                // add 4px gap for each side to get better performance
                if (avatarWidth - 8 < childrenWidth) {
                    this.setState({
                        scale: (avatarWidth - 8) / childrenWidth,
                    });
                }
                else {
                    this.setState({
                        scale: 1,
                    });
                }
            }
        };
        this.handleImgLoadError = () => {
            const { onError } = this.props;
            const errorFlag = onError ? onError() : undefined;
            if (errorFlag !== false) {
                this.setState({ isImgExist: false });
            }
        };
        this.state = {
            scale: 1,
            isImgExist: true,
        };
    }
    componentDidMount() {
        this.setScale();
    }
    componentDidUpdate(prevProps, prevState) {
        const { children } = this.props;
        const { scale, isImgExist } = this.state;
        if (prevProps.children !== children ||
            (prevState.scale !== scale && scale === 1) ||
            prevState.isImgExist !== isImgExist) {
            this.setScale();
        }
    }
    render() {
        const { prefixCls: customizePrefixCls, shape, size, src, icon, className, alt, ...others } = this.props;
        const prefixCls = getPrefixCls('avatar', customizePrefixCls);
        const { isImgExist, scale } = this.state;
        const sizeCls = classNames({
            [`${prefixCls}-lg`]: size === "large" /* large */,
            [`${prefixCls}-sm`]: size === "small" /* small */,
        });
        const classString = classNames(prefixCls, className, sizeCls, {
            [`${prefixCls}-${shape}`]: shape,
            [`${prefixCls}-image`]: src && isImgExist,
            [`${prefixCls}-icon`]: icon,
        });
        const sizeStyle = isNumber(size)
            ? {
                width: size,
                height: size,
                lineHeight: `${size}px`,
                fontSize: icon ? size / 2 : 18,
            }
            : {};
        let { children } = this.props;
        if (src && isImgExist) {
            children = React.createElement("img", { src: src, onError: this.handleImgLoadError, alt: alt });
        }
        else if (icon) {
            children = React.createElement(Icon, { type: icon });
        }
        else {
            const childrenNode = this.avatarChildren;
            if (childrenNode || scale !== 1) {
                const transformString = `scale(${scale}) translateX(-50%)`;
                const childrenStyle = {
                    msTransform: transformString,
                    WebkitTransform: transformString,
                    transform: transformString,
                };
                const sizeChildrenStyle = isNumber(size)
                    ? {
                        lineHeight: `${size}px`,
                    }
                    : {};
                children = (React.createElement("span", { className: `${prefixCls}-string`, ref: span => (this.avatarChildren = span), style: { ...sizeChildrenStyle, ...childrenStyle } }, children));
            }
            else {
                children = (React.createElement("span", { className: `${prefixCls}-string`, ref: span => (this.avatarChildren = span) }, children));
            }
        }
        return (React.createElement("span", Object.assign({}, others, { style: { ...sizeStyle, ...others.style }, className: classString }), children));
    }
}
Avatar.displayName = 'Avatar';
Avatar.defaultProps = {
    shape: 'circle',
    size: "default" /* default */,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvYXZhdGFyL2luZGV4LnRzeCIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBaUIsTUFBTSxPQUFPLENBQUM7QUFDeEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN4QyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsT0FBTyxRQUFRLE1BQU0saUJBQWlCLENBQUM7QUFDdkMsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFDO0FBRTNCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxjQUFjLENBQUM7QUE2QjVDLE1BQU0sQ0FBQyxPQUFPLE9BQU8sTUFBTyxTQUFRLFNBQW1DO0lBVXJFLFlBQVksS0FBa0I7UUFDNUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBdUJmLGFBQVEsR0FBRyxHQUFHLEVBQUU7WUFDZCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ3pDLElBQUksWUFBWSxFQUFFO2dCQUNoQixNQUFNLGFBQWEsR0FBRyxZQUFZLENBQUMsV0FBVyxDQUFDO2dCQUMvQyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFZLENBQUM7Z0JBQ2hELE1BQU0sV0FBVyxHQUFHLFVBQVUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEtBQUssQ0FBQztnQkFDN0Qsc0RBQXNEO2dCQUN0RCxJQUFJLFdBQVcsR0FBRyxDQUFDLEdBQUcsYUFBYSxFQUFFO29CQUNuQyxJQUFJLENBQUMsUUFBUSxDQUFDO3dCQUNaLEtBQUssRUFBRSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxhQUFhO3FCQUN6QyxDQUFDLENBQUM7aUJBQ0o7cUJBQU07b0JBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQzt3QkFDWixLQUFLLEVBQUUsQ0FBQztxQkFDVCxDQUFDLENBQUM7aUJBQ0o7YUFDRjtRQUNILENBQUMsQ0FBQztR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UUFBUSxDQUNKLENBQ1IsQ0FBQztJQUNKLENBQUM7O0FBeElNLGtCQUFXLEdBQUcsUUFBUSxDQUFDO0FBRXZCLG1CQUFZLEdBQUc7SUFDcEIsS0FBSyxFQUFFLFFBQVE7SUFDZixJQUFJLHlCQUFjO0NBQ25CLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvYXZhdGFyL2luZGV4LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50LCBDU1NQcm9wZXJ0aWVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgZmluZERPTU5vZGUgfSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgaXNOdW1iZXIgZnJvbSAnbG9kYXNoL2lzTnVtYmVyJztcbmltcG9ydCBJY29uIGZyb20gJy4uL2ljb24nO1xuaW1wb3J0IHsgU2l6ZSB9IGZyb20gJy4uL191dGlsL2VudW0nO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcblxuZXhwb3J0IGludGVyZmFjZSBBdmF0YXJQcm9wcyB7XG4gIC8qKiBTaGFwZSBvZiBhdmF0YXIsIG9wdGlvbnM6YGNpcmNsZWAsIGBzcXVhcmVgICovXG4gIHNoYXBlPzogJ2NpcmNsZScgfCAnc3F1YXJlJztcbiAgLypcbiAgICogU2l6ZSBvZiBhdmF0YXIsIG9wdGlvbnM6IGBsYXJnZWAsIGBzbWFsbGAsIGBkZWZhdWx0YFxuICAgKiBvciBhIGN1c3RvbSBudW1iZXIgc2l6ZVxuICAgKiAqL1xuICBzaXplPzogU2l6ZSB8IG51bWJlcjtcbiAgLyoqIFNyYyBvZiBpbWFnZSBhdmF0YXIgKi9cbiAgc3JjPzogc3RyaW5nO1xuICAvKiogVHlwZSBvZiB0aGUgSWNvbiB0byBiZSB1c2VkIGluIGF2YXRhciAqL1xuICBpY29uPzogc3RyaW5nO1xuICBzdHlsZT86IENTU1Byb3BlcnRpZXM7XG4gIHByZWZpeENscz86IHN0cmluZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBjaGlsZHJlbj86IGFueTtcbiAgYWx0Pzogc3RyaW5nO1xuICAvKiBjYWxsYmFjayB3aGVuIGltZyBsb2FkIGVycm9yICovXG4gIC8qIHJldHVybiBmYWxzZSB0byBwcmV2ZW50IEF2YXRhciBzaG93IGRlZmF1bHQgZmFsbGJhY2sgYmVoYXZpb3IsIHRoZW4geW91IGNhbiBkbyBmYWxsYmFjayBieSB5b3VyIHNlbGYgKi9cbiAgb25FcnJvcj86ICgpID0+IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXZhdGFyU3RhdGUge1xuICBzY2FsZTogbnVtYmVyO1xuICBpc0ltZ0V4aXN0OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdmF0YXIgZXh0ZW5kcyBDb21wb25lbnQ8QXZhdGFyUHJvcHMsIEF2YXRhclN0YXRlPiB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdBdmF0YXInO1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgc2hhcGU6ICdjaXJjbGUnLFxuICAgIHNpemU6IFNpemUuZGVmYXVsdCxcbiAgfTtcblxuICBwcml2YXRlIGF2YXRhckNoaWxkcmVuOiBhbnk7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IEF2YXRhclByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBzY2FsZTogMSxcbiAgICAgIGlzSW1nRXhpc3Q6IHRydWUsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuc2V0U2NhbGUoKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IEF2YXRhclByb3BzLCBwcmV2U3RhdGU6IEF2YXRhclN0YXRlKSB7XG4gICAgY29uc3QgeyBjaGlsZHJlbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IHNjYWxlLCBpc0ltZ0V4aXN0IH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmIChcbiAgICAgIHByZXZQcm9wcy5jaGlsZHJlbiAhPT0gY2hpbGRyZW4gfHxcbiAgICAgIChwcmV2U3RhdGUuc2NhbGUgIT09IHNjYWxlICYmIHNjYWxlID09PSAxKSB8fFxuICAgICAgcHJldlN0YXRlLmlzSW1nRXhpc3QgIT09IGlzSW1nRXhpc3RcbiAgICApIHtcbiAgICAgIHRoaXMuc2V0U2NhbGUoKTtcbiAgICB9XG4gIH1cblxuICBzZXRTY2FsZSA9ICgpID0+IHtcbiAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSB0aGlzLmF2YXRhckNoaWxkcmVuO1xuICAgIGlmIChjaGlsZHJlbk5vZGUpIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuV2lkdGggPSBjaGlsZHJlbk5vZGUub2Zmc2V0V2lkdGg7XG4gICAgICBjb25zdCBhdmF0YXJOb2RlID0gZmluZERPTU5vZGUodGhpcykgYXMgRWxlbWVudDtcbiAgICAgIGNvbnN0IGF2YXRhcldpZHRoID0gYXZhdGFyTm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcbiAgICAgIC8vIGFkZCA0cHggZ2FwIGZvciBlYWNoIHNpZGUgdG8gZ2V0IGJldHRlciBwZXJmb3JtYW5jZVxuICAgICAgaWYgKGF2YXRhcldpZHRoIC0gOCA8IGNoaWxkcmVuV2lkdGgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgc2NhbGU6IChhdmF0YXJXaWR0aCAtIDgpIC8gY2hpbGRyZW5XaWR0aCxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICBzY2FsZTogMSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGhhbmRsZUltZ0xvYWRFcnJvciA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9uRXJyb3IgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgZXJyb3JGbGFnID0gb25FcnJvciA/IG9uRXJyb3IoKSA6IHVuZGVmaW5lZDtcbiAgICBpZiAoZXJyb3JGbGFnICE9PSBmYWxzZSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlzSW1nRXhpc3Q6IGZhbHNlIH0pO1xuICAgIH1cbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzOiBjdXN0b21pemVQcmVmaXhDbHMsXG4gICAgICBzaGFwZSxcbiAgICAgIHNpemUsXG4gICAgICBzcmMsXG4gICAgICBpY29uLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgYWx0LFxuICAgICAgLi4ub3RoZXJzXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcHJlZml4Q2xzID0gZ2V0UHJlZml4Q2xzKCdhdmF0YXInLCBjdXN0b21pemVQcmVmaXhDbHMpO1xuXG4gICAgY29uc3QgeyBpc0ltZ0V4aXN0LCBzY2FsZSB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGNvbnN0IHNpemVDbHMgPSBjbGFzc05hbWVzKHtcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWxnYF06IHNpemUgPT09IFNpemUubGFyZ2UsXG4gICAgICBbYCR7cHJlZml4Q2xzfS1zbWBdOiBzaXplID09PSBTaXplLnNtYWxsLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY2xhc3NTdHJpbmcgPSBjbGFzc05hbWVzKHByZWZpeENscywgY2xhc3NOYW1lLCBzaXplQ2xzLCB7XG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke3NoYXBlfWBdOiBzaGFwZSxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWltYWdlYF06IHNyYyAmJiBpc0ltZ0V4aXN0LFxuICAgICAgW2Ake3ByZWZpeENsc30taWNvbmBdOiBpY29uLFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2l6ZVN0eWxlOiBDU1NQcm9wZXJ0aWVzID0gaXNOdW1iZXIoc2l6ZSlcbiAgICAgID8ge1xuICAgICAgICAgIHdpZHRoOiBzaXplLFxuICAgICAgICAgIGhlaWdodDogc2l6ZSxcbiAgICAgICAgICBsaW5lSGVpZ2h0OiBgJHtzaXplfXB4YCxcbiAgICAgICAgICBmb250U2l6ZTogaWNvbiA/IHNpemUgLyAyIDogMTgsXG4gICAgICAgIH1cbiAgICAgIDoge307XG5cbiAgICBsZXQgeyBjaGlsZHJlbiB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoc3JjICYmIGlzSW1nRXhpc3QpIHtcbiAgICAgIGNoaWxkcmVuID0gPGltZyBzcmM9e3NyY30gb25FcnJvcj17dGhpcy5oYW5kbGVJbWdMb2FkRXJyb3J9IGFsdD17YWx0fSAvPjtcbiAgICB9IGVsc2UgaWYgKGljb24pIHtcbiAgICAgIGNoaWxkcmVuID0gPEljb24gdHlwZT17aWNvbn0gLz47XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuTm9kZSA9IHRoaXMuYXZhdGFyQ2hpbGRyZW47XG4gICAgICBpZiAoY2hpbGRyZW5Ob2RlIHx8IHNjYWxlICE9PSAxKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybVN0cmluZyA9IGBzY2FsZSgke3NjYWxlfSkgdHJhbnNsYXRlWCgtNTAlKWA7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuU3R5bGU6IENTU1Byb3BlcnRpZXMgPSB7XG4gICAgICAgICAgbXNUcmFuc2Zvcm06IHRyYW5zZm9ybVN0cmluZyxcbiAgICAgICAgICBXZWJraXRUcmFuc2Zvcm06IHRyYW5zZm9ybVN0cmluZyxcbiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybVN0cmluZyxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgc2l6ZUNoaWxkcmVuU3R5bGU6IENTU1Byb3BlcnRpZXMgPSBpc051bWJlcihzaXplKVxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBsaW5lSGVpZ2h0OiBgJHtzaXplfXB4YCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICA6IHt9O1xuICAgICAgICBjaGlsZHJlbiA9IChcbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXN0cmluZ2B9XG4gICAgICAgICAgICByZWY9e3NwYW4gPT4gKHRoaXMuYXZhdGFyQ2hpbGRyZW4gPSBzcGFuKX1cbiAgICAgICAgICAgIHN0eWxlPXt7IC4uLnNpemVDaGlsZHJlblN0eWxlLCAuLi5jaGlsZHJlblN0eWxlIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNoaWxkcmVuID0gKFxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1zdHJpbmdgfSByZWY9e3NwYW4gPT4gKHRoaXMuYXZhdGFyQ2hpbGRyZW4gPSBzcGFuKX0+XG4gICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPHNwYW4gey4uLm90aGVyc30gc3R5bGU9e3sgLi4uc2l6ZVN0eWxlLCAuLi5vdGhlcnMuc3R5bGUgfX0gY2xhc3NOYW1lPXtjbGFzc1N0cmluZ30+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvc3Bhbj5cbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=