import { __decorate } from "tslib";
import React, { Component } from 'react';
import PropTypes from 'prop-types';
import { observer, PropTypes as MobxPropTypes } from 'mobx-react';
import { action, observable } from 'mobx';
import { pxToRem } from 'choerodon-ui/lib/_util/UnitConvertor';
import measureScrollbar from 'choerodon-ui/lib/_util/measureScrollbar';
import IconItem from './IconItem';
import Pagination from '../pagination/Pagination';
import autobind from '../_util/autobind';
let IconCategory = class IconCategory extends Component {
    constructor(props) {
        super(props);
        this.setPage(props.page);
    }
    saveRef(node) {
        this.ul = node;
    }
    handlePageChange(page) {
        this.setPage(page);
        const { onPageChange, category } = this.props;
        if (onPageChange) {
            onPageChange(page, category);
        }
    }
    handleItemSelect(icon) {
        const { onSelect } = this.props;
        onSelect(icon);
    }
    componentWillReceiveProps(nextProps) {
        if (nextProps.page && nextProps.page !== this.page) {
            this.setPage(nextProps.page);
        }
    }
    componentDidMount() {
        this.syncItemPosition();
    }
    componentDidUpdate() {
        this.syncItemPosition();
    }
    syncItemPosition() {
        const { props: { value, prefixCls }, ul, } = this;
        if (value && ul) {
            const item = ul.querySelector(`li.${prefixCls}-item-selected`);
            if (item) {
                const { offsetHeight, scrollTop } = ul;
                const { offsetTop, offsetHeight: height } = item;
                if (offsetTop < scrollTop) {
                    ul.scrollTo(0, offsetTop);
                }
                else if (offsetTop + height > scrollTop + offsetHeight) {
                    ul.scrollTo(0, offsetTop + height - offsetHeight);
                }
            }
        }
    }
    setPage(page = 1) {
        this.page = page;
    }
    renderPagination() {
        const { page, props: { paging, pageSize, prefixCls, icons }, } = this;
        const total = icons.length;
        if (paging && total > pageSize) {
            return (React.createElement(Pagination, { key: "page", className: `${prefixCls}-pagination`, total: total, page: page, pageSize: pageSize, showSizeChanger: false, onChange: this.handlePageChange, style: { right: pxToRem(measureScrollbar()) } }));
        }
    }
    renderIcons() {
        const { value, prefixCls } = this.props;
        return this.getIcons().map(icon => (React.createElement(IconItem, { key: icon, prefixCls: prefixCls, type: icon, onSelect: this.handleItemSelect, active: value === icon })));
    }
    getIcons() {
        const { page, props: { paging, pageSize, icons }, } = this;
        if (paging && icons.length > pageSize) {
            return icons.slice((page - 1) * pageSize, page * pageSize);
        }
        return icons;
    }
    render() {
        const { props: { prefixCls }, } = this;
        return (React.createElement("div", { className: `${prefixCls}-category` },
            this.renderPagination(),
            React.createElement("ul", { key: "icon-items", ref: this.saveRef }, this.renderIcons())));
    }
};
IconCategory.displayName = 'IconCategory';
IconCategory.propTypes = {
    prefixCls: PropTypes.string,
    icons: MobxPropTypes.arrayOrObservableArrayOf(PropTypes.string).isRequired,
    value: PropTypes.string,
    onSelect: PropTypes.func.isRequired,
    onPageChange: PropTypes.func,
    pageSize: PropTypes.number,
    page: PropTypes.number,
    paging: PropTypes.bool,
};
IconCategory.defaultProps = {
    paging: true,
};
__decorate([
    observable
], IconCategory.prototype, "page", void 0);
__decorate([
    autobind
], IconCategory.prototype, "saveRef", null);
__decorate([
    autobind
], IconCategory.prototype, "handlePageChange", null);
__decorate([
    autobind
], IconCategory.prototype, "handleItemSelect", null);
__decorate([
    action
], IconCategory.prototype, "setPage", null);
IconCategory = __decorate([
    observer
], IconCategory);
export default IconCategory;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL2ljb24tcGlja2VyL0ljb25DYXRlZ29yeS50c3giLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQ3pDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQztBQUNuQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsSUFBSSxhQUFhLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDbEUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDMUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQy9ELE9BQU8sZ0JBQWdCLE1BQU0seUNBQXlDLENBQUM7QUFDdkUsT0FBTyxRQUFRLE1BQU0sWUFBWSxDQUFDO0FBQ2xDLE9BQU8sVUFBVSxNQUFNLDBCQUEwQixDQUFDO0FBQ2xELE9BQU8sUUFBUSxNQUFNLG1CQUFtQixDQUFDO0FBZXpDLElBQXFCLFlBQVksR0FBakMsTUFBcUIsWUFBYSxTQUFRLFNBQXdCO0lBc0JoRSxZQUFZLEtBQUs7UUFDZixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBR0QsT0FBTyxDQUFDLElBQUk7UUFDVixJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQztJQUNqQixDQUFDO0lBR0QsZ0JBQWdCLENBQUMsSUFBWTtRQUMzQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25CLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUM5QyxJQUFJLFlBQVksRUFBRTtZQUNoQixZQUFZLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQzlCO0lBQ0gsQ0FBQztJ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STtDQUN2QixDQUFDO0FBRUsseUJBQVksR0FBRztJQUNwQixNQUFNLEVBQUUsSUFBSTtDQUNiLENBQUM7QUFFVTtJQUFYLFVBQVU7MENBQWM7QUFVekI7SUFEQyxRQUFROzJDQUdSO0FBR0Q7SUFEQyxRQUFRO29EQU9SO0FBR0Q7SUFEQyxRQUFRO29EQUlSO0FBb0NEO0lBREMsTUFBTTsyQ0FHTjtBQW5Ga0IsWUFBWTtJQURoQyxRQUFRO0dBQ1ksWUFBWSxDQWdKaEM7ZUFoSm9CLFlBQVkiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL2ljb24tcGlja2VyL0ljb25DYXRlZ29yeS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBvYnNlcnZlciwgUHJvcFR5cGVzIGFzIE1vYnhQcm9wVHlwZXMgfSBmcm9tICdtb2J4LXJlYWN0JztcbmltcG9ydCB7IGFjdGlvbiwgb2JzZXJ2YWJsZSB9IGZyb20gJ21vYngnO1xuaW1wb3J0IHsgcHhUb1JlbSB9IGZyb20gJ2Nob2Vyb2Rvbi11aS9saWIvX3V0aWwvVW5pdENvbnZlcnRvcic7XG5pbXBvcnQgbWVhc3VyZVNjcm9sbGJhciBmcm9tICdjaG9lcm9kb24tdWkvbGliL191dGlsL21lYXN1cmVTY3JvbGxiYXInO1xuaW1wb3J0IEljb25JdGVtIGZyb20gJy4vSWNvbkl0ZW0nO1xuaW1wb3J0IFBhZ2luYXRpb24gZnJvbSAnLi4vcGFnaW5hdGlvbi9QYWdpbmF0aW9uJztcbmltcG9ydCBhdXRvYmluZCBmcm9tICcuLi9fdXRpbC9hdXRvYmluZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSWNvbkl0ZW1Qcm9wcyB7XG4gIHByZWZpeENscz86IHN0cmluZztcbiAgaWNvbnM6IHN0cmluZ1tdO1xuICBjYXRlZ29yeT86IHN0cmluZztcbiAgdmFsdWU/OiBzdHJpbmc7XG4gIHBhZ2luZz86IGJvb2xlYW47XG4gIHBhZ2U/OiBudW1iZXI7XG4gIHBhZ2VTaXplPzogbnVtYmVyO1xuICBvblNlbGVjdDogKHR5cGU6IHN0cmluZykgPT4gdm9pZDtcbiAgb25QYWdlQ2hhbmdlPzogKHBhZ2U6IG51bWJlciwgY2F0ZWdvcnk/OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbkBvYnNlcnZlclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSWNvbkNhdGVnb3J5IGV4dGVuZHMgQ29tcG9uZW50PEljb25JdGVtUHJvcHM+IHtcbiAgc3RhdGljIGRpc3BsYXlOYW1lID0gJ0ljb25DYXRlZ29yeSc7XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBwcmVmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgaWNvbnM6IE1vYnhQcm9wVHlwZXMuYXJyYXlPck9ic2VydmFibGVBcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLmlzUmVxdWlyZWQsXG4gICAgdmFsdWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgb25TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgb25QYWdlQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBwYWdlU2l6ZTogUHJvcFR5cGVzLm51bWJlcixcbiAgICBwYWdlOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHBhZ2luZzogUHJvcFR5cGVzLmJvb2wsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBwYWdpbmc6IHRydWUsXG4gIH07XG5cbiAgQG9ic2VydmFibGUgcGFnZTogbnVtYmVyO1xuXG4gIHVsPzogSFRNTFVMaXN0RWxlbWVudCB8IG51bGw7XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zZXRQYWdlKHByb3BzLnBhZ2UpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIHNhdmVSZWYobm9kZSkge1xuICAgIHRoaXMudWwgPSBub2RlO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGhhbmRsZVBhZ2VDaGFuZ2UocGFnZTogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRQYWdlKHBhZ2UpO1xuICAgIGNvbnN0IHsgb25QYWdlQ2hhbmdlLCBjYXRlZ29yeSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAob25QYWdlQ2hhbmdlKSB7XG4gICAgICBvblBhZ2VDaGFuZ2UocGFnZSwgY2F0ZWdvcnkpO1xuICAgIH1cbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVJdGVtU2VsZWN0KGljb24pIHtcbiAgICBjb25zdCB7IG9uU2VsZWN0IH0gPSB0aGlzLnByb3BzO1xuICAgIG9uU2VsZWN0KGljb24pO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAobmV4dFByb3BzLnBhZ2UgJiYgbmV4dFByb3BzLnBhZ2UgIT09IHRoaXMucGFnZSkge1xuICAgICAgdGhpcy5zZXRQYWdlKG5leHRQcm9wcy5wYWdlKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnN5bmNJdGVtUG9zaXRpb24oKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnN5bmNJdGVtUG9zaXRpb24oKTtcbiAgfVxuXG4gIHN5bmNJdGVtUG9zaXRpb24oKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJvcHM6IHsgdmFsdWUsIHByZWZpeENscyB9LFxuICAgICAgdWwsXG4gICAgfSA9IHRoaXM7XG4gICAgaWYgKHZhbHVlICYmIHVsKSB7XG4gICAgICBjb25zdCBpdGVtID0gdWwucXVlcnlTZWxlY3RvcihgbGkuJHtwcmVmaXhDbHN9LWl0ZW0tc2VsZWN0ZWRgKSBhcyBIVE1MTElFbGVtZW50O1xuICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgY29uc3QgeyBvZmZzZXRIZWlnaHQsIHNjcm9sbFRvcCB9ID0gdWw7XG4gICAgICAgIGNvbnN0IHsgb2Zmc2V0VG9wLCBvZmZzZXRIZWlnaHQ6IGhlaWdodCB9ID0gaXRlbTtcbiAgICAgICAgaWYgKG9mZnNldFRvcCA8IHNjcm9sbFRvcCkge1xuICAgICAgICAgIHVsLnNjcm9sbFRvKDAsIG9mZnNldFRvcCk7XG4gICAgICAgIH0gZWxzZSBpZiAob2Zmc2V0VG9wICsgaGVpZ2h0ID4gc2Nyb2xsVG9wICsgb2Zmc2V0SGVpZ2h0KSB7XG4gICAgICAgICAgdWwuc2Nyb2xsVG8oMCwgb2Zmc2V0VG9wICsgaGVpZ2h0IC0gb2Zmc2V0SGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIEBhY3Rpb25cbiAgc2V0UGFnZShwYWdlOiBudW1iZXIgPSAxKSB7XG4gICAgdGhpcy5wYWdlID0gcGFnZTtcbiAgfVxuXG4gIHJlbmRlclBhZ2luYXRpb24oKSB7XG4gICAgY29uc3Qge1xuICAgICAgcGFnZSxcbiAgICAgIHByb3BzOiB7IHBhZ2luZywgcGFnZVNpemUsIHByZWZpeENscywgaWNvbnMgfSxcbiAgICB9ID0gdGhpcztcbiAgICBjb25zdCB0b3RhbCA9IGljb25zLmxlbmd0aDtcbiAgICBpZiAocGFnaW5nICYmIHRvdGFsID4gcGFnZVNpemUhKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8UGFnaW5hdGlvblxuICAgICAgICAgIGtleT1cInBhZ2VcIlxuICAgICAgICAgIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1wYWdpbmF0aW9uYH1cbiAgICAgICAgICB0b3RhbD17dG90YWx9XG4gICAgICAgICAgcGFnZT17cGFnZX1cbiAgICAgICAgICBwYWdlU2l6ZT17cGFnZVNpemV9XG4gICAgICAgICAgc2hvd1NpemVDaGFuZ2VyPXtmYWxzZX1cbiAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVQYWdlQ2hhbmdlfVxuICAgICAgICAgIHN0eWxlPXt7IHJpZ2h0OiBweFRvUmVtKG1lYXN1cmVTY3JvbGxiYXIoKSkgfX1cbiAgICAgICAgLz5cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVySWNvbnMoKSB7XG4gICAgY29uc3QgeyB2YWx1ZSwgcHJlZml4Q2xzIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiB0aGlzLmdldEljb25zKCkubWFwKGljb24gPT4gKFxuICAgICAgPEljb25JdGVtXG4gICAgICAgIGtleT17aWNvbn1cbiAgICAgICAgcHJlZml4Q2xzPXtwcmVmaXhDbHN9XG4gICAgICAgIHR5cGU9e2ljb259XG4gICAgICAgIG9uU2VsZWN0PXt0aGlzLmhhbmRsZUl0ZW1TZWxlY3R9XG4gICAgICAgIGFjdGl2ZT17dmFsdWUgPT09IGljb259XG4gICAgICAvPlxuICAgICkpO1xuICB9XG5cbiAgZ2V0SWNvbnMoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcGFnZSxcbiAgICAgIHByb3BzOiB7IHBhZ2luZywgcGFnZVNpemUsIGljb25zIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgaWYgKHBhZ2luZyAmJiBpY29ucy5sZW5ndGggPiBwYWdlU2l6ZSEpIHtcbiAgICAgIHJldHVybiBpY29ucy5zbGljZSgocGFnZSAtIDEpICogcGFnZVNpemUhLCBwYWdlICogcGFnZVNpemUhKTtcbiAgICB9XG4gICAgcmV0dXJuIGljb25zO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHByb3BzOiB7IHByZWZpeENscyB9LFxuICAgIH0gPSB0aGlzO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1jYXRlZ29yeWB9PlxuICAgICAgICB7dGhpcy5yZW5kZXJQYWdpbmF0aW9uKCl9XG4gICAgICAgIDx1bCBrZXk9XCJpY29uLWl0ZW1zXCIgcmVmPXt0aGlzLnNhdmVSZWZ9PlxuICAgICAgICAgIHt0aGlzLnJlbmRlckljb25zKCl9XG4gICAgICAgIDwvdWw+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=