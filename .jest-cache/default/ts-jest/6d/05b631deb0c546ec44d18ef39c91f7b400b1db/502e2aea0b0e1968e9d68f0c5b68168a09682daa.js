import { __decorate } from "tslib";
import React from 'react';
import { findDOMNode } from 'react-dom';
import PropTypes from 'prop-types';
import omit from 'lodash/omit';
import noop from 'lodash/noop';
import { action, computed, observable } from 'mobx';
import { PropTypes as MobxPropTypes } from 'mobx-react';
import Trigger from '../trigger/Trigger';
import { TextField } from '../text-field/TextField';
import autobind from '../_util/autobind';
import Icon from '../icon';
import TaskRunner from '../_util/TaskRunner';
const BUILT_IN_PLACEMENTS = {
    bottomLeft: {
        points: ['tl', 'bl'],
        offset: [0, 4],
        overflow: {
            adjustX: 1,
            adjustY: 1,
        },
    },
    bottomRight: {
        points: ['tr', 'br'],
        offset: [0, 4],
        overflow: {
            adjustX: 1,
            adjustY: 1,
        },
    },
    topLeft: {
        points: ['bl', 'tl'],
        offset: [0, -4],
        overflow: {
            adjustX: 1,
            adjustY: 1,
        },
    },
    topRight: {
        points: ['br', 'tr'],
        offset: [0, -4],
        overflow: {
            adjustX: 1,
            adjustY: 1,
        },
    },
};
export default class TriggerField extends TextField {
    constructor(props, context) {
        super(props, context);
        this.popupTask = new TaskRunner();
        this.setPopup(false);
    }
    get popup() {
        return this.statePopup;
    }
    isValidationMessageHidden(message) {
        return super.isValidationMessageHidden(message) || this.popup;
    }
    setPopup(statePopup) {
        this.statePopup = statePopup;
    }
    getRootDomNode() {
        return findDOMNode(this);
    }
    getOtherProps() {
        return omit(super.getOtherProps(), [
            'popupContent',
            'popupCls',
            'editable',
            'trigger',
            'triggerShowDelay',
            'triggerHiddenDelay',
            'onPopupHiddenChange',
            'getPopupContainer',
        ]);
    }
    getPopupProps() {
        return {};
    }
    getWrappedEditor() {
        const { prefixCls, props: { popupCls, popupStyle, popupContent, hidden, trigger, triggerShowDelay, triggerHiddenDelay, getPopupContainer, }, } = this;
        let content;
        if (popupContent !== undefined) {
            if (popupContent instanceof Function) {
                content = popupContent(this.getPopupProps());
            }
            else {
                content = popupContent;
            }
        }
        else {
            content = this.getPopupContent();
        }
        return (React.createElement(Trigger, { ref: node => (this.trigger = node), action: this.isReadOnly() || this.isDisabled() ? [] : trigger, focusDelay: triggerShowDelay, blurDelay: triggerHiddenDelay, mouseEnterDelay: triggerShowDelay, mouseLeaveDelay: triggerHiddenDelay, prefixCls: prefixCls, popupCls: popupCls, popupStyle: popupStyle, popupContent: content, popupPlacement: "bottomLeft", popupHidden: hidden || !this.popup, builtinPlacements: BUILT_IN_PLACEMENTS, onPopupAnimateAppear: this.handlePopupAnimateAppear, onPopupAnimateEnd: this.handlePopupAnimateEnd, onPopupHiddenChange: this.handlePopupHiddenChange, getPopupStyleFromAlign: this.getPopupStyleFromAlign, getRootDomNode: this.getRootDomNode, getPopupContainer: getPopupContainer }, this.getEditor()));
    }
    getWrapperClassNames(...args) {
        const { prefixCls } = this;
        return super.getWrapperClassNames(...args, {
            [`${prefixCls}-expand`]: this.popup,
            [`${prefixCls}-not-editable`]: !this.isDisabled() && !this.editable,
        });
    }
    getDefaultSuffix() {
        const { prefixCls } = this;
        return React.createElement(Icon, { type: this.getTriggerIconFont(), className: `${prefixCls}-trigger` });
    }
    handleTagAnimateEnd() {
        this.forcePopupAlign();
    }
    handlePopupMouseDown(e) {
        e.preventDefault();
        const { onMouseDown = noop } = this.props;
        onMouseDown(e);
    }
    handlePopupHiddenChange(hidden) {
        this.setPopup(!hidden);
        const { onPopupHiddenChange = noop } = this.props;
        onPopupHiddenChange(hidden);
    }
    forcePopupAlign() {
        if (this.trigger) {
            this.trigger.forcePopupAlign();
        }
    }
    expand() {
        this.popupTask.cancel();
        if (!this.isReadOnly() && !this.popup) {
            this.popupTask.delay(this.props.triggerShowDelay, () => {
                this.setPopup(true);
            });
        }
    }
    collapse() {
        this.popupTask.cancel();
        if (!this.isReadOnly() && this.popup) {
            this.popupTask.delay(this.props.triggerHiddenDelay, () => {
                this.setPopup(false);
            });
        }
    }
}
TriggerField.displayName = 'TriggerField';
TriggerField.propTypes = {
    /**
     * 下拉框的自定义内容
     */
    popupContent: PropTypes.element,
    /**
     * 下拉框的自定义样式名
     */
    popupCls: PropTypes.string,
    /**
     * 下拉框的内链样式
     */
    popupStyle: PropTypes.object,
    /**
     * 触发下拉框的方式
     * 可选值：click | focus | hover | contextMenu
     */
    trigger: MobxPropTypes.arrayOrObservableArrayOf(PropTypes.string),
    /**
     * 下拉框显示延迟
     * @defualt 150
     */
    triggerShowDelay: PropTypes.number,
    /**
     * 下拉框隐藏延迟
     * @defualt 50
     */
    triggerHiddenDelay: PropTypes.number,
    /**
     * 下拉框变化钩子
     */
    onPopupHiddenChange: PropTypes.func,
    /**
     * 定义浮层的容器，默认为 body
     */
    getPopupContainer: PropTypes.func,
    ...TextField.propTypes,
};
TriggerField.defaultProps = {
    ...TextField.defaultProps,
    suffixCls: 'trigger',
    clearButton: true,
    trigger: ['focus', 'click'],
    triggerShowDelay: 150,
    triggerHiddenDelay: 50,
};
__decorate([
    observable
], TriggerField.prototype, "statePopup", void 0);
__decorate([
    computed
], TriggerField.prototype, "popup", null);
__decorate([
    action
], TriggerField.prototype, "setPopup", null);
__decorate([
    autobind
], TriggerField.prototype, "getRootDomNode", null);
__decorate([
    autobind
], TriggerField.prototype, "handleTagAnimateEnd", null);
__decorate([
    autobind
], TriggerField.prototype, "handlePopupMouseDown", null);
__decorate([
    autobind
], TriggerField.prototype, "handlePopupHiddenChange", null);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3RyaWdnZXItZmllbGQvVHJpZ2dlckZpZWxkLnRzeCIsIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUFtQyxNQUFNLE9BQU8sQ0FBQztBQUN4RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ3hDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQztBQUNuQyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxJQUFJLE1BQU0sYUFBYSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxJQUFJLGFBQWEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN4RCxPQUFPLE9BQU8sTUFBTSxvQkFBb0IsQ0FBQztBQUV6QyxPQUFPLEVBQUUsU0FBUyxFQUFrQixNQUFNLHlCQUF5QixDQUFDO0FBQ3BFLE9BQU8sUUFBUSxNQUFNLG1CQUFtQixDQUFDO0FBQ3pDLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLFVBQVUsTUFBTSxxQkFBcUIsQ0FBQztBQUU3QyxNQUFNLG1CQUFtQixHQUFHO0lBQzFCLFVBQVUsRUFBRTtRQUNWLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDcEIsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNkLFFBQVEsRUFBRTtZQUNSLE9BQU8sRUFBRSxDQUFDO1lBQ1YsT0FBTyxFQUFFLENBQUM7U0FDWDtLQUNGO0lBQ0QsV0FBVyxFQUFFO1FBQ1gsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNwQixNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2QsUUFBUSxFQUFFO1lBQ1IsT0FBTyxFQUFFLENBQUM7WUFDVixPQUFPLEVBQUUsQ0FBQztT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QUM7U0FDSjtJQUNILENBQUM7O0FBcE5NLHdCQUFXLEdBQUcsY0FBYyxDQUFDO0FBRTdCLHNCQUFTLEdBQUc7SUFDakI7O09BRUc7SUFDSCxZQUFZLEVBQUUsU0FBUyxDQUFDLE9BQU87SUFDL0I7O09BRUc7SUFDSCxRQUFRLEVBQUUsU0FBUyxDQUFDLE1BQU07SUFDMUI7O09BRUc7SUFDSCxVQUFVLEVBQUUsU0FBUyxDQUFDLE1BQU07SUFDNUI7OztPQUdHO0lBQ0gsT0FBTyxFQUFFLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDO0lBQ2pFOzs7T0FHRztJQUNILGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxNQUFNO0lBQ2xDOzs7T0FHRztJQUNILGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxNQUFNO0lBQ3BDOztPQUVHO0lBQ0gsbUJBQW1CLEVBQUUsU0FBUyxDQUFDLElBQUk7SUFDbkM7O09BRUc7SUFDSCxpQkFBaUIsRUFBRSxTQUFTLENBQUMsSUFBSTtJQUNqQyxHQUFHLFNBQVMsQ0FBQyxTQUFTO0NBQ3ZCLENBQUM7QUFFSyx5QkFBWSxHQUFHO0lBQ3BCLEdBQUcsU0FBUyxDQUFDLFlBQVk7SUFDekIsU0FBUyxFQUFFLFNBQVM7SUFDcEIsV0FBVyxFQUFFLElBQUk7SUFDakIsT0FBTyxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQztJQUMzQixnQkFBZ0IsRUFBRSxHQUFHO0lBQ3JCLGtCQUFrQixFQUFFLEVBQUU7Q0FDdkIsQ0FBQztBQU1VO0lBQVgsVUFBVTtnREFBcUI7QUFHaEM7SUFEQyxRQUFRO3lDQUdSO0FBWUQ7SUFEQyxNQUFNOzRDQUdOO0FBYUQ7SUFEQyxRQUFRO2tEQUdSO0FBb0ZEO0lBREMsUUFBUTt1REFHUjtBQUdEO0lBREMsUUFBUTt3REFLUjtBQUdEO0lBREMsUUFBUTsyREFLUiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy1wcm8vdHJpZ2dlci1maWVsZC9UcmlnZ2VyRmllbGQudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDU1NQcm9wZXJ0aWVzLCBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBmaW5kRE9NTm9kZSB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IG9taXQgZnJvbSAnbG9kYXNoL29taXQnO1xuaW1wb3J0IG5vb3AgZnJvbSAnbG9kYXNoL25vb3AnO1xuaW1wb3J0IHsgYWN0aW9uLCBjb21wdXRlZCwgb2JzZXJ2YWJsZSB9IGZyb20gJ21vYngnO1xuaW1wb3J0IHsgUHJvcFR5cGVzIGFzIE1vYnhQcm9wVHlwZXMgfSBmcm9tICdtb2J4LXJlYWN0JztcbmltcG9ydCBUcmlnZ2VyIGZyb20gJy4uL3RyaWdnZXIvVHJpZ2dlcic7XG5pbXBvcnQgeyBBY3Rpb24gfSBmcm9tICcuLi90cmlnZ2VyL2VudW0nO1xuaW1wb3J0IHsgVGV4dEZpZWxkLCBUZXh0RmllbGRQcm9wcyB9IGZyb20gJy4uL3RleHQtZmllbGQvVGV4dEZpZWxkJztcbmltcG9ydCBhdXRvYmluZCBmcm9tICcuLi9fdXRpbC9hdXRvYmluZCc7XG5pbXBvcnQgSWNvbiBmcm9tICcuLi9pY29uJztcbmltcG9ydCBUYXNrUnVubmVyIGZyb20gJy4uL191dGlsL1Rhc2tSdW5uZXInO1xuXG5jb25zdCBCVUlMVF9JTl9QTEFDRU1FTlRTID0ge1xuICBib3R0b21MZWZ0OiB7XG4gICAgcG9pbnRzOiBbJ3RsJywgJ2JsJ10sXG4gICAgb2Zmc2V0OiBbMCwgNF0sXG4gICAgb3ZlcmZsb3c6IHtcbiAgICAgIGFkanVzdFg6IDEsXG4gICAgICBhZGp1c3RZOiAxLFxuICAgIH0sXG4gIH0sXG4gIGJvdHRvbVJpZ2h0OiB7XG4gICAgcG9pbnRzOiBbJ3RyJywgJ2JyJ10sXG4gICAgb2Zmc2V0OiBbMCwgNF0sXG4gICAgb3ZlcmZsb3c6IHtcbiAgICAgIGFkanVzdFg6IDEsXG4gICAgICBhZGp1c3RZOiAxLFxuICAgIH0sXG4gIH0sXG4gIHRvcExlZnQ6IHtcbiAgICBwb2ludHM6IFsnYmwnLCAndGwnXSxcbiAgICBvZmZzZXQ6IFswLCAtNF0sXG4gICAgb3ZlcmZsb3c6IHtcbiAgICAgIGFkanVzdFg6IDEsXG4gICAgICBhZGp1c3RZOiAxLFxuICAgIH0sXG4gIH0sXG4gIHRvcFJpZ2h0OiB7XG4gICAgcG9pbnRzOiBbJ2JyJywgJ3RyJ10sXG4gICAgb2Zmc2V0OiBbMCwgLTRdLFxuICAgIG92ZXJmbG93OiB7XG4gICAgICBhZGp1c3RYOiAxLFxuICAgICAgYWRqdXN0WTogMSxcbiAgICB9LFxuICB9LFxufTtcblxuZXhwb3J0IGludGVyZmFjZSBUcmlnZ2VyRmllbGRQcm9wcyBleHRlbmRzIFRleHRGaWVsZFByb3BzIHtcbiAgLyoqXG4gICAqIOS4i+aLieahhueahOiHquWumuS5ieWGheWuuVxuICAgKi9cbiAgcG9wdXBDb250ZW50PzogUmVhY3ROb2RlIHwgKChwcm9wczogYW55KSA9PiBSZWFjdE5vZGUpO1xuICAvKipcbiAgICog5LiL5ouJ5qGG55qE6Ieq5a6a5LmJ5qC35byP5ZCNXG4gICAqL1xuICBwb3B1cENscz86IHN0cmluZztcbiAgLyoqXG4gICAqIOS4i+aLieahhueahOWGhemTvuagt+W8j1xuICAgKi9cbiAgcG9wdXBTdHlsZT86IENTU1Byb3BlcnRpZXM7XG4gIC8qKlxuICAgKiDop6blj5HkuIvmi4nmoYbnmoTmlrnlvI/nu4RcbiAgICog5Y+v6YCJ5YC877yaY2xpY2sgfCBmb2N1cyB8IGhvdmVyIHwgY29udGV4dE1lbnVcbiAgICovXG4gIHRyaWdnZXI/OiBBY3Rpb25bXTtcbiAgLyoqXG4gICAqIOS4i+aLieahhuaYvuekuuW7tui/n1xuICAgKiBAZGVmdWFsdCAxNTBcbiAgICovXG4gIHRyaWdnZXJTaG93RGVsYXk/OiBudW1iZXI7XG4gIC8qKlxuICAgKiDkuIvmi4nmoYbpmpDol4/lu7bov59cbiAgICogQGRlZnVhbHQgNTBcbiAgICovXG4gIHRyaWdnZXJIaWRkZW5EZWxheT86IG51bWJlcjtcbiAgLyoqXG4gICAqIOS4i+aLieahhuWPmOWMlumSqeWtkFxuICAgKi9cbiAgb25Qb3B1cEhpZGRlbkNoYW5nZT86IChoaWRkZW46IGJvb2xlYW4pID0+IHZvaWQ7XG4gIC8qKlxuICAgKiDlrprkuYnmta7lsYLnmoTlrrnlmajvvIzpu5jorqTkuLogYm9keVxuICAgKiBAcGFyYW0gdHJpZ2dlck5vZGVcbiAgICovXG4gIGdldFBvcHVwQ29udGFpbmVyPzogKHRyaWdnZXJOb2RlOiBIVE1MRWxlbWVudCkgPT4gSFRNTEVsZW1lbnQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFic3RyYWN0IGNsYXNzIFRyaWdnZXJGaWVsZDxUIGV4dGVuZHMgVHJpZ2dlckZpZWxkUHJvcHM+IGV4dGVuZHMgVGV4dEZpZWxkPFxuICBUICYgVHJpZ2dlckZpZWxkUHJvcHNcbj4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnVHJpZ2dlckZpZWxkJztcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIOS4i+aLieahhueahOiHquWumuS5ieWGheWuuVxuICAgICAqL1xuICAgIHBvcHVwQ29udGVudDogUHJvcFR5cGVzLmVsZW1lbnQsXG4gICAgLyoqXG4gICAgICog5LiL5ouJ5qGG55qE6Ieq5a6a5LmJ5qC35byP5ZCNXG4gICAgICovXG4gICAgcG9wdXBDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgLyoqXG4gICAgICog5LiL5ouJ5qGG55qE5YaF6ZO+5qC35byPXG4gICAgICovXG4gICAgcG9wdXBTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICAvKipcbiAgICAgKiDop6blj5HkuIvmi4nmoYbnmoTmlrnlvI9cbiAgICAgKiDlj6/pgInlgLzvvJpjbGljayB8IGZvY3VzIHwgaG92ZXIgfCBjb250ZXh0TWVudVxuICAgICAqL1xuICAgIHRyaWdnZXI6IE1vYnhQcm9wVHlwZXMuYXJyYXlPck9ic2VydmFibGVBcnJheU9mKFByb3BUeXBlcy5zdHJpbmcpLFxuICAgIC8qKlxuICAgICAqIOS4i+aLieahhuaYvuekuuW7tui/n1xuICAgICAqIEBkZWZ1YWx0IDE1MFxuICAgICAqL1xuICAgIHRyaWdnZXJTaG93RGVsYXk6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgLyoqXG4gICAgICog5LiL5ouJ5qGG6ZqQ6JeP5bu26L+fXG4gICAgICogQGRlZnVhbHQgNTBcbiAgICAgKi9cbiAgICB0cmlnZ2VySGlkZGVuRGVsYXk6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgLyoqXG4gICAgICog5LiL5ouJ5qGG5Y+Y5YyW6ZKp5a2QXG4gICAgICovXG4gICAgb25Qb3B1cEhpZGRlbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgLyoqXG4gICAgICog5a6a5LmJ5rWu5bGC55qE5a655Zmo77yM6buY6K6k5Li6IGJvZHlcbiAgICAgKi9cbiAgICBnZXRQb3B1cENvbnRhaW5lcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgLi4uVGV4dEZpZWxkLnByb3BUeXBlcyxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIC4uLlRleHRGaWVsZC5kZWZhdWx0UHJvcHMsXG4gICAgc3VmZml4Q2xzOiAndHJpZ2dlcicsXG4gICAgY2xlYXJCdXR0b246IHRydWUsXG4gICAgdHJpZ2dlcjogWydmb2N1cycsICdjbGljayddLFxuICAgIHRyaWdnZXJTaG93RGVsYXk6IDE1MCxcbiAgICB0cmlnZ2VySGlkZGVuRGVsYXk6IDUwLFxuICB9O1xuXG4gIHBvcHVwVGFzazogVGFza1J1bm5lciA9IG5ldyBUYXNrUnVubmVyKCk7XG5cbiAgdHJpZ2dlcjogVHJpZ2dlciB8IG51bGw7XG5cbiAgQG9ic2VydmFibGUgc3RhdGVQb3B1cDogYm9vbGVhbjtcblxuICBAY29tcHV0ZWRcbiAgZ2V0IHBvcHVwKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0YXRlUG9wdXA7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wcywgY29udGV4dCkge1xuICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcbiAgICB0aGlzLnNldFBvcHVwKGZhbHNlKTtcbiAgfVxuXG4gIGlzVmFsaWRhdGlvbk1lc3NhZ2VIaWRkZW4obWVzc2FnZT86IFJlYWN0Tm9kZSk6IHVuZGVmaW5lZCB8IGJvb2xlYW4ge1xuICAgIHJldHVybiBzdXBlci5pc1ZhbGlkYXRpb25NZXNzYWdlSGlkZGVuKG1lc3NhZ2UpIHx8IHRoaXMucG9wdXA7XG4gIH1cblxuICBAYWN0aW9uXG4gIHNldFBvcHVwKHN0YXRlUG9wdXA6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnN0YXRlUG9wdXAgPSBzdGF0ZVBvcHVwO1xuICB9XG5cbiAgYWJzdHJhY3QgZ2V0VHJpZ2dlckljb25Gb250KCk6IHN0cmluZztcblxuICBhYnN0cmFjdCBoYW5kbGVQb3B1cEFuaW1hdGVBcHBlYXIoa2V5KTogdm9pZDtcblxuICBhYnN0cmFjdCBoYW5kbGVQb3B1cEFuaW1hdGVFbmQoa2V5LCBleGlzdHMpOiB2b2lkO1xuXG4gIGFic3RyYWN0IGdldFBvcHVwU3R5bGVGcm9tQWxpZ24odGFyZ2V0KTogQ1NTUHJvcGVydGllcyB8IHVuZGVmaW5lZDtcblxuICBhYnN0cmFjdCBnZXRQb3B1cENvbnRlbnQoKTogUmVhY3ROb2RlO1xuXG4gIEBhdXRvYmluZFxuICBnZXRSb290RG9tTm9kZSgpIHtcbiAgICByZXR1cm4gZmluZERPTU5vZGUodGhpcyk7XG4gIH1cblxuICBnZXRPdGhlclByb3BzKCkge1xuICAgIHJldHVybiBvbWl0KHN1cGVyLmdldE90aGVyUHJvcHMoKSwgW1xuICAgICAgJ3BvcHVwQ29udGVudCcsXG4gICAgICAncG9wdXBDbHMnLFxuICAgICAgJ2VkaXRhYmxlJyxcbiAgICAgICd0cmlnZ2VyJyxcbiAgICAgICd0cmlnZ2VyU2hvd0RlbGF5JyxcbiAgICAgICd0cmlnZ2VySGlkZGVuRGVsYXknLFxuICAgICAgJ29uUG9wdXBIaWRkZW5DaGFuZ2UnLFxuICAgICAgJ2dldFBvcHVwQ29udGFpbmVyJyxcbiAgICBdKTtcbiAgfVxuXG4gIGdldFBvcHVwUHJvcHMoKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgZ2V0V3JhcHBlZEVkaXRvcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBwcm9wczoge1xuICAgICAgICBwb3B1cENscyxcbiAgICAgICAgcG9wdXBTdHlsZSxcbiAgICAgICAgcG9wdXBDb250ZW50LFxuICAgICAgICBoaWRkZW4sXG4gICAgICAgIHRyaWdnZXIsXG4gICAgICAgIHRyaWdnZXJTaG93RGVsYXksXG4gICAgICAgIHRyaWdnZXJIaWRkZW5EZWxheSxcbiAgICAgICAgZ2V0UG9wdXBDb250YWluZXIsXG4gICAgICB9LFxuICAgIH0gPSB0aGlzO1xuICAgIGxldCBjb250ZW50O1xuICAgIGlmIChwb3B1cENvbnRlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKHBvcHVwQ29udGVudCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG4gICAgICAgIGNvbnRlbnQgPSBwb3B1cENvbnRlbnQodGhpcy5nZXRQb3B1cFByb3BzKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGVudCA9IHBvcHVwQ29udGVudDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29udGVudCA9IHRoaXMuZ2V0UG9wdXBDb250ZW50KCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8VHJpZ2dlclxuICAgICAgICByZWY9e25vZGUgPT4gKHRoaXMudHJpZ2dlciA9IG5vZGUpfVxuICAgICAgICBhY3Rpb249e3RoaXMuaXNSZWFkT25seSgpIHx8IHRoaXMuaXNEaXNhYmxlZCgpID8gW10gOiB0cmlnZ2VyfVxuICAgICAgICBmb2N1c0RlbGF5PXt0cmlnZ2VyU2hvd0RlbGF5fVxuICAgICAgICBibHVyRGVsYXk9e3RyaWdnZXJIaWRkZW5EZWxheX1cbiAgICAgICAgbW91c2VFbnRlckRlbGF5PXt0cmlnZ2VyU2hvd0RlbGF5fVxuICAgICAgICBtb3VzZUxlYXZlRGVsYXk9e3RyaWdnZXJIaWRkZW5EZWxheX1cbiAgICAgICAgcHJlZml4Q2xzPXtwcmVmaXhDbHN9XG4gICAgICAgIHBvcHVwQ2xzPXtwb3B1cENsc31cbiAgICAgICAgcG9wdXBTdHlsZT17cG9wdXBTdHlsZX1cbiAgICAgICAgcG9wdXBDb250ZW50PXtjb250ZW50fVxuICAgICAgICBwb3B1cFBsYWNlbWVudD1cImJvdHRvbUxlZnRcIlxuICAgICAgICBwb3B1cEhpZGRlbj17aGlkZGVuIHx8ICF0aGlzLnBvcHVwfVxuICAgICAgICBidWlsdGluUGxhY2VtZW50cz17QlVJTFRfSU5fUExBQ0VNRU5UU31cbiAgICAgICAgb25Qb3B1cEFuaW1hdGVBcHBlYXI9e3RoaXMuaGFuZGxlUG9wdXBBbmltYXRlQXBwZWFyfVxuICAgICAgICBvblBvcHVwQW5pbWF0ZUVuZD17dGhpcy5oYW5kbGVQb3B1cEFuaW1hdGVFbmR9XG4gICAgICAgIG9uUG9wdXBIaWRkZW5DaGFuZ2U9e3RoaXMuaGFuZGxlUG9wdXBIaWRkZW5DaGFuZ2V9XG4gICAgICAgIGdldFBvcHVwU3R5bGVGcm9tQWxpZ249e3RoaXMuZ2V0UG9wdXBTdHlsZUZyb21BbGlnbn1cbiAgICAgICAgZ2V0Um9vdERvbU5vZGU9e3RoaXMuZ2V0Um9vdERvbU5vZGV9XG4gICAgICAgIGdldFBvcHVwQ29udGFpbmVyPXtnZXRQb3B1cENvbnRhaW5lcn1cbiAgICAgID5cbiAgICAgICAge3RoaXMuZ2V0RWRpdG9yKCl9XG4gICAgICA8L1RyaWdnZXI+XG4gICAgKTtcbiAgfVxuXG4gIGdldFdyYXBwZXJDbGFzc05hbWVzKC4uLmFyZ3MpOiBzdHJpbmcge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzIH0gPSB0aGlzO1xuICAgIHJldHVybiBzdXBlci5nZXRXcmFwcGVyQ2xhc3NOYW1lcyguLi5hcmdzLCB7XG4gICAgICBbYCR7cHJlZml4Q2xzfS1leHBhbmRgXTogdGhpcy5wb3B1cCxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LW5vdC1lZGl0YWJsZWBdOiAhdGhpcy5pc0Rpc2FibGVkKCkgJiYgIXRoaXMuZWRpdGFibGUsXG4gICAgfSk7XG4gIH1cblxuICBnZXREZWZhdWx0U3VmZml4KCk6IFJlYWN0Tm9kZSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIDxJY29uIHR5cGU9e3RoaXMuZ2V0VHJpZ2dlckljb25Gb250KCl9IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS10cmlnZ2VyYH0gLz47XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlVGFnQW5pbWF0ZUVuZCgpIHtcbiAgICB0aGlzLmZvcmNlUG9wdXBBbGlnbigpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGhhbmRsZVBvcHVwTW91c2VEb3duKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBvbk1vdXNlRG93biA9IG5vb3AgfSA9IHRoaXMucHJvcHM7XG4gICAgb25Nb3VzZURvd24oZSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlUG9wdXBIaWRkZW5DaGFuZ2UoaGlkZGVuOiBib29sZWFuKSB7XG4gICAgdGhpcy5zZXRQb3B1cCghaGlkZGVuKTtcbiAgICBjb25zdCB7IG9uUG9wdXBIaWRkZW5DaGFuZ2UgPSBub29wIH0gPSB0aGlzLnByb3BzO1xuICAgIG9uUG9wdXBIaWRkZW5DaGFuZ2UoaGlkZGVuKTtcbiAgfVxuXG4gIGZvcmNlUG9wdXBBbGlnbigpIHtcbiAgICBpZiAodGhpcy50cmlnZ2VyKSB7XG4gICAgICB0aGlzLnRyaWdnZXIuZm9yY2VQb3B1cEFsaWduKCk7XG4gICAgfVxuICB9XG5cbiAgZXhwYW5kKCkge1xuICAgIHRoaXMucG9wdXBUYXNrLmNhbmNlbCgpO1xuICAgIGlmICghdGhpcy5pc1JlYWRPbmx5KCkgJiYgIXRoaXMucG9wdXApIHtcbiAgICAgIHRoaXMucG9wdXBUYXNrLmRlbGF5KHRoaXMucHJvcHMudHJpZ2dlclNob3dEZWxheSBhcyBudW1iZXIsICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRQb3B1cCh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbGxhcHNlKCkge1xuICAgIHRoaXMucG9wdXBUYXNrLmNhbmNlbCgpO1xuICAgIGlmICghdGhpcy5pc1JlYWRPbmx5KCkgJiYgdGhpcy5wb3B1cCkge1xuICAgICAgdGhpcy5wb3B1cFRhc2suZGVsYXkodGhpcy5wcm9wcy50cmlnZ2VySGlkZGVuRGVsYXkgYXMgbnVtYmVyLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0UG9wdXAoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=