import React from 'react';
import noop from 'lodash/noop';
import isString from 'lodash/isString';
import Icon from '../icon';
import Notification from '../rc-components/notification';
import { getPlacementStyle, getPlacementTransitionName } from './util';
import { getPrefixCls } from '../configure';
let defaultDuration = 3;
let defaultTop = 24;
let defaultBottom = 24;
let messageInstance;
let key = 1;
let customizePrefixCls;
let transitionName = 'move-up';
let defaultPlacement = 'leftBottom';
let getContainer;
function getCustomizePrefixCls() {
    return getPrefixCls('message', customizePrefixCls);
}
function getMessageInstance(placement, callback) {
    if (messageInstance) {
        callback(messageInstance);
        return;
    }
    Notification.newInstance({
        prefixCls: getCustomizePrefixCls(),
        style: getPlacementStyle(placement, defaultTop, defaultBottom),
        transitionName: getPlacementTransitionName(placement, transitionName),
        getContainer,
    }, (instance) => {
        if (messageInstance) {
            callback(messageInstance);
            return;
        }
        messageInstance = instance;
        callback(instance);
    });
}
function notice(content, duration = defaultDuration, type, onClose, placement) {
    const iconType = {
        info: 'info',
        success: 'check_circle',
        error: 'error',
        warning: 'warning',
        loading: 'loading',
    }[type];
    if (isString(onClose)) {
        placement = onClose;
        onClose = noop;
    }
    if (typeof duration === 'function') {
        onClose = duration;
        duration = defaultDuration;
    }
    else if (isString(duration)) {
        placement = duration;
    }
    const target = key++;
    const prefixCls = getCustomizePrefixCls();
    getMessageInstance(placement || defaultPlacement, instance => {
        instance.notice({
            key: target,
            duration,
            style: {},
            content: (React.createElement("div", { className: `${prefixCls}-custom-content ${prefixCls}-${type}` },
                React.createElement(Icon, { type: iconType }),
                React.createElement("span", null, content))),
            onClose,
        });
    });
    return () => {
        if (messageInstance) {
            messageInstance.removeNotice(target);
        }
    };
}
export default {
    info(content, duration, onClose, placement) {
        return notice(content, duration, 'info', onClose, placement);
    },
    success(content, duration, onClose, placement) {
        return notice(content, duration, 'success', onClose, placement);
    },
    error(content, duration, onClose, placement) {
        return notice(content, duration, 'error', onClose, placement);
    },
    // Departed usage, please use warning()
    warn(content, duration, onClose, placement) {
        return notice(content, duration, 'warning', onClose, placement);
    },
    warning(content, duration, onClose, placement) {
        return notice(content, duration, 'warning', onClose, placement);
    },
    loading(content, duration, onClose, placement) {
        return notice(content, duration, 'loading', onClose, placement);
    },
    config(options) {
        if (options.top !== undefined) {
            defaultTop = options.top;
            messageInstance = null; // delete messageInstance for new defaultTop
        }
        if (options.bottom !== undefined) {
            defaultBottom = options.bottom;
            messageInstance = null; // delete messageInstance for new defaultBottom
        }
        if (options.duration !== undefined) {
            defaultDuration = options.duration;
        }
        if (options.prefixCls !== undefined) {
            customizePrefixCls = options.prefixCls;
        }
        if (options.getContainer !== undefined) {
            getContainer = options.getContainer;
        }
        if (options.transitionName !== undefined) {
            transitionName = options.transitionName;
            messageInstance = null; // delete messageInstance for new transitionName
        }
        if (options.placement !== undefined) {
            defaultPlacement = options.placement;
        }
    },
    destroy() {
        if (messageInstance) {
            messageInstance.destroy();
            messageInstance = null;
        }
    },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvbWVzc2FnZS9pbmRleC50c3giLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFvQixNQUFNLE9BQU8sQ0FBQztBQUN6QyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxRQUFRLE1BQU0saUJBQWlCLENBQUM7QUFDdkMsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFDO0FBQzNCLE9BQU8sWUFBWSxNQUFNLCtCQUErQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSwwQkFBMEIsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUN2RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTVDLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQztBQUN4QixJQUFJLFVBQVUsR0FBVyxFQUFFLENBQUM7QUFDNUIsSUFBSSxhQUFhLEdBQVcsRUFBRSxDQUFDO0FBQy9CLElBQUksZUFBb0IsQ0FBQztBQUN6QixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDWixJQUFJLGtCQUFrQixDQUFDO0FBQ3ZCLElBQUksY0FBYyxHQUFHLFNBQVMsQ0FBQztBQUMvQixJQUFJLGdCQUFnQixHQUFjLFlBQVksQ0FBQztBQUMvQyxJQUFJLFlBQStCLENBQUM7QUFxQnBDLFNBQVMscUJBQXFCO0lBQzVCLE9BQU8sWUFBWSxDQUFDLFNBQVMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0FBQ3JELENBQUM7QUFFRCxTQUFTLGtCQUFrQixDQUFDLFNBQW9CLEVBQUUsUUFBMEI7SUFDMUUsSUFBSSxlQUFlLEVBQUU7UUFDbkIsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzFCLE9BQU87S0FDUjtJQUNELFlBQVksQ0FBQyxXQUFXLENBQ3RCO1FBQ0UsU0FBUyxFQUFFLHFCQUFxQixFQUFFO1FBQ2xDLEtBQUssRUFBRSxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLGFBQWEsQ0FBQztRQUM5RCxjQUFjLEVBQUUsMEJBQTBCLENBQUMsU0FBUyxFQUFFLGNBQWMsQ0FBQztRQUNyRSxZQUFZO0tBQ2IsRUFDRCxDQUFDLFFBQWEsRUFBRSxFQUFFO1FBQ2hCLElBQUksZUFBZSxFQUFFO1lBQ25CLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUMxQixPQUFPO1NBQ1I7UUFDRCxlQUFlLEdBQUcsUUFBUSxDQUFDO1FBQzNCLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNyQixDQUFDLENBQ0YsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLE1BQU0sQ0FDYixPQUFrQixFQUNsQixXQUEyQixlQUFlLEVBQzFDLElBQWdCLEVBQ2hCLE9BQXVCLEVBQ3ZCLFNBQXFCO0lBRXJCLE1BQU0sUUFBUSxHQUFHO1FBQ2YsSUFBSSxFQUFFLE1BQU07UUFDWixPQUFPLEVBQUUsY0FBYztRQUN2QixLQUFLLEVBQUUsT0FBTztRQUNkLE9BQU8sRUFBRSxTQUFTO1FBQ2xCLE9BQU8sRUFBRSxTQUFTO0tBQ25CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFUixJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRTtRQUNyQixTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3BCLE9BQU8sR0FBRyxJQUFJLENBQUM7S0FDaEI7SUFFRCxJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRTtRQUNsQyxPQUFPLEdBQUcsUUFBUSxDQUFDO1FBQ25CLFFBQVEsR0FBRyxlQUFlLENBQUM7S0FDNUI7U0FBTSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUM3QixTQUFTLEdBQUcsUUFBUSxDQUFDO0tBQ3RCO0lBRUQsTUFBTSxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDckIsTUFBTSxTQUFTLEdBQUcscUJBQXFCLEVBQUUsQ0FBQztJQUMxQyxrQkFBa0IsQ0FBQyxTQUFTLElBQUksZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLEVBQUU7UUFDM0QsUUFBUSxDQUFDLE1BQU0sQ0FBQztZQUNkLEdBQUcsRUFBRSxNQUFNO1lBQ1gsUUFBUTtZQUNSLEtBQUssRUFBRSxFQUFFO1lBQ1QsT0FBTyxFQUFFLENBQ1AsNkJBQUssU0FBUyxFQUFFLEdBQUcsU0FBUyxtQkFBbUIsU0FBUyxJQUFJLElBQUksRUFBRTtnQkFDaEUsb0JBQUMsSUFBSSxJQUFDLElBQUksRUFBRSxRQUFRLEdBQUk7Z0JBQ3hCLGtDQUFPLE9BQU8sQ0FBUSxDQUNsQixDQUNQO1lBQ0QsT0FBTztTQUNSLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxHQUFHLEVBQUU7UUFDVixJQUFJLGVBQWUsRUFBRTtZQUNuQixlQUFlLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3RDO0lBQ0gsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQWVELGVBQWU7SUFDYixJQUFJLENBQ0YsT0FBc0IsRUFDdEIsUUFBeUIsRUFDekIsT0FBdUIsRUFDdkIsU0FBcUI7UUFFckIsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFDRCxPQUFPLENBQ0wsT0FBc0IsRUFDdEIsUUFBeUIsRUFDekIsT0FBdUIsRUFDdkIsU0FBcUI7UUFFckIsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFDRCxLQUFLLENBQ0gsT0FBc0IsRUFDdEIsUUFBeUIsRUFDekIsT0FBdUIsRUFDdkIsU0FBcUI7UUFFckIsT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFDRCx1Q0FBdUM7SUFDdkMsSUFBSSxDQUNGLE9BQXNCLEVBQ3RCLFFBQXlCLEVBQ3pCLE9BQXVCLEVBQ3ZCLFNBQXFCO1FBRXJCLE9BQU8sTUFBTSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBQ0QsT0FBTyxDQUNMLE9BQXNCLEVBQ3RCLFFBQXlCLEVBQ3pCLE9BQXVCLEVBQ3ZCLFNBQXFCO1FBRXJCLE9BQU8sTUFBTSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBQ0QsT0FBTyxDQUNMLE9BQXNCLEVBQ3RCLFFBQXlCLEVBQ3pCLE9BQXVCLEVBQ3ZCLFNBQXFCO1FBRXJCLE9BQU8sTUFBTSxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBQ0QsTUFBTSxDQUFDLE9BQXNCO1FBQzNCLElBQUksT0FBTyxDQUFDLEdBQUcsS0FBSyxTQUFTLEVBQUU7WUFDN0IsVUFBVSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7WUFDekIsZUFBZSxHQUFHLElBQUksQ0FBQyxDQUFDLDRDQUE0QztTQUNyRTtRQUNELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxTQUFTLEVBQUU7WUFDaEMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDL0IsZUFBZSxHQUFHLElBQUksQ0FBQyxDQUFDLCtDQUErQztTQUN4RTtRQUNELElBQUksT0FBTyxDQUFDLFFBQVEsS0FBSyxTQUFTLEVBQUU7WUFDbEMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7U0FDcEM7UUFDRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFO1lBQ25DLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7U0FDeEM7UUFDRCxJQUFJLE9BQU8sQ0FBQyxZQUFZLEtBQUssU0FBUyxFQUFFO1lBQ3RDLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDO1NBQ3JDO1FBQ0QsSUFBSSxPQUFPLENBQUMsY0FBYyxLQUFLLFNBQVMsRUFBRTtZQUN4QyxjQUFjLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQztZQUN4QyxlQUFlLEdBQUcsSUFBSSxDQUFDLENBQUMsZ0RBQWdEO1NBQ3pFO1FBQ0QsSUFBSSxPQUFPLENBQUMsU0FBUyxLQUFLLFNBQVMsRUFBRTtZQUNuQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDO1NBQ3RDO0lBQ0gsQ0FBQztJQUNELE9BQU87UUFDTCxJQUFJLGVBQWUsRUFBRTtZQUNuQixlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDMUIsZUFBZSxHQUFHLElBQUksQ0FBQztTQUN4QjtJQUNILENBQUM7Q0FDRixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzL21lc3NhZ2UvaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgbm9vcCBmcm9tICdsb2Rhc2gvbm9vcCc7XG5pbXBvcnQgaXNTdHJpbmcgZnJvbSAnbG9kYXNoL2lzU3RyaW5nJztcbmltcG9ydCBJY29uIGZyb20gJy4uL2ljb24nO1xuaW1wb3J0IE5vdGlmaWNhdGlvbiBmcm9tICcuLi9yYy1jb21wb25lbnRzL25vdGlmaWNhdGlvbic7XG5pbXBvcnQgeyBnZXRQbGFjZW1lbnRTdHlsZSwgZ2V0UGxhY2VtZW50VHJhbnNpdGlvbk5hbWUgfSBmcm9tICcuL3V0aWwnO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcblxubGV0IGRlZmF1bHREdXJhdGlvbiA9IDM7XG5sZXQgZGVmYXVsdFRvcDogbnVtYmVyID0gMjQ7XG5sZXQgZGVmYXVsdEJvdHRvbTogbnVtYmVyID0gMjQ7XG5sZXQgbWVzc2FnZUluc3RhbmNlOiBhbnk7XG5sZXQga2V5ID0gMTtcbmxldCBjdXN0b21pemVQcmVmaXhDbHM7XG5sZXQgdHJhbnNpdGlvbk5hbWUgPSAnbW92ZS11cCc7XG5sZXQgZGVmYXVsdFBsYWNlbWVudDogUGxhY2VtZW50ID0gJ2xlZnRCb3R0b20nO1xubGV0IGdldENvbnRhaW5lcjogKCkgPT4gSFRNTEVsZW1lbnQ7XG5cbnR5cGUgTm90aWNlVHlwZSA9ICdpbmZvJyB8ICdzdWNjZXNzJyB8ICdlcnJvcicgfCAnd2FybmluZycgfCAnbG9hZGluZyc7XG50eXBlIFBsYWNlbWVudCA9XG4gIHwgJ3RvcCdcbiAgfCAnbGVmdCdcbiAgfCAncmlnaHQnXG4gIHwgJ2JvdHRvbSdcbiAgfCAndG9wUmlnaHQnXG4gIHwgJ3RvcExlZnQnXG4gIHwgJ2JvdHRvbVJpZ2h0J1xuICB8ICdib3R0b21MZWZ0J1xuICB8ICdyaWdodFRvcCdcbiAgfCAnbGVmdFRvcCdcbiAgfCAncmlnaHRCb3R0b20nXG4gIHwgJ2xlZnRCb3R0b20nO1xuXG50eXBlIENvbmZpZ0NvbnRlbnQgPSBSZWFjdE5vZGU7XG50eXBlIENvbmZpZ0R1cmF0aW9uID0gbnVtYmVyIHwgUGxhY2VtZW50IHwgKCgpID0+IHZvaWQpO1xuZXhwb3J0IHR5cGUgQ29uZmlnT25DbG9zZSA9ICgoKSA9PiB2b2lkKSB8IFBsYWNlbWVudDtcblxuZnVuY3Rpb24gZ2V0Q3VzdG9taXplUHJlZml4Q2xzKCkge1xuICByZXR1cm4gZ2V0UHJlZml4Q2xzKCdtZXNzYWdlJywgY3VzdG9taXplUHJlZml4Q2xzKTtcbn1cblxuZnVuY3Rpb24gZ2V0TWVzc2FnZUluc3RhbmNlKHBsYWNlbWVudDogUGxhY2VtZW50LCBjYWxsYmFjazogKGk6IGFueSkgPT4gdm9pZCkge1xuICBpZiAobWVzc2FnZUluc3RhbmNlKSB7XG4gICAgY2FsbGJhY2sobWVzc2FnZUluc3RhbmNlKTtcbiAgICByZXR1cm47XG4gIH1cbiAgTm90aWZpY2F0aW9uLm5ld0luc3RhbmNlKFxuICAgIHtcbiAgICAgIHByZWZpeENsczogZ2V0Q3VzdG9taXplUHJlZml4Q2xzKCksXG4gICAgICBzdHlsZTogZ2V0UGxhY2VtZW50U3R5bGUocGxhY2VtZW50LCBkZWZhdWx0VG9wLCBkZWZhdWx0Qm90dG9tKSxcbiAgICAgIHRyYW5zaXRpb25OYW1lOiBnZXRQbGFjZW1lbnRUcmFuc2l0aW9uTmFtZShwbGFjZW1lbnQsIHRyYW5zaXRpb25OYW1lKSxcbiAgICAgIGdldENvbnRhaW5lcixcbiAgICB9LFxuICAgIChpbnN0YW5jZTogYW55KSA9PiB7XG4gICAgICBpZiAobWVzc2FnZUluc3RhbmNlKSB7XG4gICAgICAgIGNhbGxiYWNrKG1lc3NhZ2VJbnN0YW5jZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IGluc3RhbmNlO1xuICAgICAgY2FsbGJhY2soaW5zdGFuY2UpO1xuICAgIH0sXG4gICk7XG59XG5cbmZ1bmN0aW9uIG5vdGljZShcbiAgY29udGVudDogUmVhY3ROb2RlLFxuICBkdXJhdGlvbjogQ29uZmlnRHVyYXRpb24gPSBkZWZhdWx0RHVyYXRpb24sXG4gIHR5cGU6IE5vdGljZVR5cGUsXG4gIG9uQ2xvc2U/OiBDb25maWdPbkNsb3NlLFxuICBwbGFjZW1lbnQ/OiBQbGFjZW1lbnQsXG4pIHtcbiAgY29uc3QgaWNvblR5cGUgPSB7XG4gICAgaW5mbzogJ2luZm8nLFxuICAgIHN1Y2Nlc3M6ICdjaGVja19jaXJjbGUnLFxuICAgIGVycm9yOiAnZXJyb3InLFxuICAgIHdhcm5pbmc6ICd3YXJuaW5nJyxcbiAgICBsb2FkaW5nOiAnbG9hZGluZycsXG4gIH1bdHlwZV07XG5cbiAgaWYgKGlzU3RyaW5nKG9uQ2xvc2UpKSB7XG4gICAgcGxhY2VtZW50ID0gb25DbG9zZTtcbiAgICBvbkNsb3NlID0gbm9vcDtcbiAgfVxuXG4gIGlmICh0eXBlb2YgZHVyYXRpb24gPT09ICdmdW5jdGlvbicpIHtcbiAgICBvbkNsb3NlID0gZHVyYXRpb247XG4gICAgZHVyYXRpb24gPSBkZWZhdWx0RHVyYXRpb247XG4gIH0gZWxzZSBpZiAoaXNTdHJpbmcoZHVyYXRpb24pKSB7XG4gICAgcGxhY2VtZW50ID0gZHVyYXRpb247XG4gIH1cblxuICBjb25zdCB0YXJnZXQgPSBrZXkrKztcbiAgY29uc3QgcHJlZml4Q2xzID0gZ2V0Q3VzdG9taXplUHJlZml4Q2xzKCk7XG4gIGdldE1lc3NhZ2VJbnN0YW5jZShwbGFjZW1lbnQgfHwgZGVmYXVsdFBsYWNlbWVudCwgaW5zdGFuY2UgPT4ge1xuICAgIGluc3RhbmNlLm5vdGljZSh7XG4gICAgICBrZXk6IHRhcmdldCxcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgc3R5bGU6IHt9LFxuICAgICAgY29udGVudDogKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1jdXN0b20tY29udGVudCAke3ByZWZpeENsc30tJHt0eXBlfWB9PlxuICAgICAgICAgIDxJY29uIHR5cGU9e2ljb25UeXBlfSAvPlxuICAgICAgICAgIDxzcGFuPntjb250ZW50fTwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApLFxuICAgICAgb25DbG9zZSxcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiAoKSA9PiB7XG4gICAgaWYgKG1lc3NhZ2VJbnN0YW5jZSkge1xuICAgICAgbWVzc2FnZUluc3RhbmNlLnJlbW92ZU5vdGljZSh0YXJnZXQpO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWdPcHRpb25zIHtcbiAgdG9wPzogbnVtYmVyO1xuICBkdXJhdGlvbj86IG51bWJlcjtcbiAgcHJlZml4Q2xzPzogc3RyaW5nO1xuICBnZXRDb250YWluZXI/OiAoKSA9PiBIVE1MRWxlbWVudDtcbiAgdHJhbnNpdGlvbk5hbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiDmtojmga/ot53nprvop4bnqpfkvY3nva5cbiAgICovXG4gIGJvdHRvbT86IG51bWJlcjtcbiAgcGxhY2VtZW50PzogUGxhY2VtZW50O1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGluZm8oXG4gICAgY29udGVudDogQ29uZmlnQ29udGVudCxcbiAgICBkdXJhdGlvbj86IENvbmZpZ0R1cmF0aW9uLFxuICAgIG9uQ2xvc2U/OiBDb25maWdPbkNsb3NlLFxuICAgIHBsYWNlbWVudD86IFBsYWNlbWVudCxcbiAgKSB7XG4gICAgcmV0dXJuIG5vdGljZShjb250ZW50LCBkdXJhdGlvbiwgJ2luZm8nLCBvbkNsb3NlLCBwbGFjZW1lbnQpO1xuICB9LFxuICBzdWNjZXNzKFxuICAgIGNvbnRlbnQ6IENvbmZpZ0NvbnRlbnQsXG4gICAgZHVyYXRpb24/OiBDb25maWdEdXJhdGlvbixcbiAgICBvbkNsb3NlPzogQ29uZmlnT25DbG9zZSxcbiAgICBwbGFjZW1lbnQ/OiBQbGFjZW1lbnQsXG4gICkge1xuICAgIHJldHVybiBub3RpY2UoY29udGVudCwgZHVyYXRpb24sICdzdWNjZXNzJywgb25DbG9zZSwgcGxhY2VtZW50KTtcbiAgfSxcbiAgZXJyb3IoXG4gICAgY29udGVudDogQ29uZmlnQ29udGVudCxcbiAgICBkdXJhdGlvbj86IENvbmZpZ0R1cmF0aW9uLFxuICAgIG9uQ2xvc2U/OiBDb25maWdPbkNsb3NlLFxuICAgIHBsYWNlbWVudD86IFBsYWNlbWVudCxcbiAgKSB7XG4gICAgcmV0dXJuIG5vdGljZShjb250ZW50LCBkdXJhdGlvbiwgJ2Vycm9yJywgb25DbG9zZSwgcGxhY2VtZW50KTtcbiAgfSxcbiAgLy8gRGVwYXJ0ZWQgdXNhZ2UsIHBsZWFzZSB1c2Ugd2FybmluZygpXG4gIHdhcm4oXG4gICAgY29udGVudDogQ29uZmlnQ29udGVudCxcbiAgICBkdXJhdGlvbj86IENvbmZpZ0R1cmF0aW9uLFxuICAgIG9uQ2xvc2U/OiBDb25maWdPbkNsb3NlLFxuICAgIHBsYWNlbWVudD86IFBsYWNlbWVudCxcbiAgKSB7XG4gICAgcmV0dXJuIG5vdGljZShjb250ZW50LCBkdXJhdGlvbiwgJ3dhcm5pbmcnLCBvbkNsb3NlLCBwbGFjZW1lbnQpO1xuICB9LFxuICB3YXJuaW5nKFxuICAgIGNvbnRlbnQ6IENvbmZpZ0NvbnRlbnQsXG4gICAgZHVyYXRpb24/OiBDb25maWdEdXJhdGlvbixcbiAgICBvbkNsb3NlPzogQ29uZmlnT25DbG9zZSxcbiAgICBwbGFjZW1lbnQ/OiBQbGFjZW1lbnQsXG4gICkge1xuICAgIHJldHVybiBub3RpY2UoY29udGVudCwgZHVyYXRpb24sICd3YXJuaW5nJywgb25DbG9zZSwgcGxhY2VtZW50KTtcbiAgfSxcbiAgbG9hZGluZyhcbiAgICBjb250ZW50OiBDb25maWdDb250ZW50LFxuICAgIGR1cmF0aW9uPzogQ29uZmlnRHVyYXRpb24sXG4gICAgb25DbG9zZT86IENvbmZpZ09uQ2xvc2UsXG4gICAgcGxhY2VtZW50PzogUGxhY2VtZW50LFxuICApIHtcbiAgICByZXR1cm4gbm90aWNlKGNvbnRlbnQsIGR1cmF0aW9uLCAnbG9hZGluZycsIG9uQ2xvc2UsIHBsYWNlbWVudCk7XG4gIH0sXG4gIGNvbmZpZyhvcHRpb25zOiBDb25maWdPcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGRlZmF1bHRUb3AgPSBvcHRpb25zLnRvcDtcbiAgICAgIG1lc3NhZ2VJbnN0YW5jZSA9IG51bGw7IC8vIGRlbGV0ZSBtZXNzYWdlSW5zdGFuY2UgZm9yIG5ldyBkZWZhdWx0VG9wXG4gICAgfVxuICAgIGlmIChvcHRpb25zLmJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBkZWZhdWx0Qm90dG9tID0gb3B0aW9ucy5ib3R0b207XG4gICAgICBtZXNzYWdlSW5zdGFuY2UgPSBudWxsOyAvLyBkZWxldGUgbWVzc2FnZUluc3RhbmNlIGZvciBuZXcgZGVmYXVsdEJvdHRvbVxuICAgIH1cbiAgICBpZiAob3B0aW9ucy5kdXJhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBkZWZhdWx0RHVyYXRpb24gPSBvcHRpb25zLmR1cmF0aW9uO1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5wcmVmaXhDbHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY3VzdG9taXplUHJlZml4Q2xzID0gb3B0aW9ucy5wcmVmaXhDbHM7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmdldENvbnRhaW5lciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBnZXRDb250YWluZXIgPSBvcHRpb25zLmdldENvbnRhaW5lcjtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMudHJhbnNpdGlvbk5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdHJhbnNpdGlvbk5hbWUgPSBvcHRpb25zLnRyYW5zaXRpb25OYW1lO1xuICAgICAgbWVzc2FnZUluc3RhbmNlID0gbnVsbDsgLy8gZGVsZXRlIG1lc3NhZ2VJbnN0YW5jZSBmb3IgbmV3IHRyYW5zaXRpb25OYW1lXG4gICAgfVxuICAgIGlmIChvcHRpb25zLnBsYWNlbWVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBkZWZhdWx0UGxhY2VtZW50ID0gb3B0aW9ucy5wbGFjZW1lbnQ7XG4gICAgfVxuICB9LFxuICBkZXN0cm95KCkge1xuICAgIGlmIChtZXNzYWdlSW5zdGFuY2UpIHtcbiAgICAgIG1lc3NhZ2VJbnN0YW5jZS5kZXN0cm95KCk7XG4gICAgICBtZXNzYWdlSW5zdGFuY2UgPSBudWxsO1xuICAgIH1cbiAgfSxcbn07XG4iXSwidmVyc2lvbiI6M30=