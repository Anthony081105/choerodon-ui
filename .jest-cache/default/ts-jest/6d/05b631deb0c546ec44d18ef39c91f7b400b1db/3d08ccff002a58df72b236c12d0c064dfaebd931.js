import React, { Component } from 'react';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import noop from 'lodash/noop';
import List from './list';
import Operation from './operation';
import Search from './search';
import LocaleReceiver from '../locale-provider/LocaleReceiver';
import defaultLocale from '../locale-provider/default';
import { getPrefixCls } from '../configure';
export default class Transfer extends Component {
    constructor(props) {
        super(props);
        this.moveTo = (direction) => {
            const { targetKeys = [], dataSource = [], onChange } = this.props;
            const { sourceSelectedKeys, targetSelectedKeys } = this.state;
            const moveKeys = direction === "right" /* right */ ? sourceSelectedKeys : targetSelectedKeys;
            // filter the disabled options
            const newMoveKeys = moveKeys.filter((key) => !dataSource.some(data => !!(key === data.key && data.disabled)));
            // move items to target box
            const newTargetKeys = direction === "right" /* right */
                ? newMoveKeys.concat(targetKeys)
                : targetKeys.filter(targetKey => newMoveKeys.indexOf(targetKey) === -1);
            // empty checked keys
            const oppositeDirection = direction === "right" /* right */ ? "left" /* left */ : "right" /* right */;
            this.setState({
                [this.getSelectedKeysName(oppositeDirection)]: [],
            });
            this.handleSelectChange(oppositeDirection, []);
            if (onChange) {
                onChange(newTargetKeys, direction, newMoveKeys);
            }
        };
        this.moveToLeft = () => this.moveTo("left" /* left */);
        this.moveToRight = () => this.moveTo("right" /* right */);
        this.handleSelectAll = (direction, filteredDataSource, checkAll) => {
            const { state, props: { selectedKeys }, } = this;
            const originalSelectedKeys = state[this.getSelectedKeysName(direction)] || [];
            const currentKeys = filteredDataSource.map(item => item.key);
            // Only operate current keys from original selected keys
            const newKeys1 = originalSelectedKeys.filter((key) => currentKeys.indexOf(key) === -1);
            const newKeys2 = [...originalSelectedKeys];
            currentKeys.forEach(key => {
                if (newKeys2.indexOf(key) === -1) {
                    newKeys2.push(key);
                }
            });
            const holder = checkAll ? newKeys1 : newKeys2;
            this.handleSelectChange(direction, holder);
            if (!selectedKeys) {
                this.setState({
                    [this.getSelectedKeysName(direction)]: holder,
                });
            }
        };
        this.handleLeftSelectAll = (filteredDataSource, checkAll) => this.handleSelectAll("left" /* left */, filteredDataSource, checkAll);
        this.handleRightSelectAll = (filteredDataSource, checkAll) => this.handleSelectAll("right" /* right */, filteredDataSource, checkAll);
        this.handleFilter = (direction, e) => {
            const { onSearchChange } = this.props;
            this.setState({
                // add filter
                [`${direction}Filter`]: e.target.value,
            });
            if (onSearchChange) {
                onSearchChange(direction, e);
            }
        };
        this.handleLeftFilter = (e) => this.handleFilter("left" /* left */, e);
        this.handleRightFilter = (e) => this.handleFilter("right" /* right */, e);
        this.handleClear = (direction) => {
            this.setState({
                [`${direction}Filter`]: '',
            });
        };
        this.handleLeftClear = () => this.handleClear("left" /* left */);
        this.handleRightClear = () => this.handleClear("right" /* right */);
        this.handleSelect = (direction, selectedItem, checked) => {
            const { selectedKeys } = this.props;
            const { sourceSelectedKeys, targetSelectedKeys } = this.state;
            const holder = direction === "left" /* left */ ? [...sourceSelectedKeys] : [...targetSelectedKeys];
            const index = holder.indexOf(selectedItem.key);
            if (index > -1) {
                holder.splice(index, 1);
            }
            if (checked) {
                holder.push(selectedItem.key);
            }
            this.handleSelectChange(direction, holder);
            if (!selectedKeys) {
                this.setState({
                    [this.getSelectedKeysName(direction)]: holder,
                });
            }
        };
        this.handleLeftSelect = (selectedItem, checked) => {
            return this.handleSelect("left" /* left */, selectedItem, checked);
        };
        this.handleRightSelect = (selectedItem, checked) => {
            return this.handleSelect("right" /* right */, selectedItem, checked);
        };
        this.handleScroll = (direction, e) => {
            const { onScroll } = this.props;
            if (onScroll) {
                onScroll(direction, e);
            }
        };
        this.handleLeftScroll = (e) => this.handleScroll("left" /* left */, e);
        this.handleRightScroll = (e) => this.handleScroll("right" /* right */, e);
        this.renderTransfer = (locale) => {
            const { prefixCls: customizePrefixCls, className, operations = [], showSearch, notFoundContent, searchPlaceholder, body, footer, listStyle, filterOption, render, lazy, } = this.props;
            const prefixCls = getPrefixCls('transfer', customizePrefixCls);
            const { leftFilter, rightFilter, sourceSelectedKeys, targetSelectedKeys } = this.state;
            const { leftDataSource, rightDataSource } = this.splitDataSource();
            const leftActive = targetSelectedKeys.length > 0;
            const rightActive = sourceSelectedKeys.length > 0;
            const cls = classNames(className, prefixCls);
            const titles = this.getTitles(locale);
            return (React.createElement("div", { className: cls },
                React.createElement(List, { prefixCls: `${prefixCls}-list`, titleText: titles[0], dataSource: leftDataSource, filter: leftFilter, filterOption: filterOption, style: listStyle, checkedKeys: sourceSelectedKeys, handleFilter: this.handleLeftFilter, handleClear: this.handleLeftClear, handleSelect: this.handleLeftSelect, handleSelectAll: this.handleLeftSelectAll, render: render, showSearch: showSearch, searchPlaceholder: searchPlaceholder || locale.searchPlaceholder, notFoundContent: notFoundContent || locale.notFoundContent, itemUnit: locale.itemUnit, itemsUnit: locale.itemsUnit, body: body, footer: footer, lazy: lazy, onScroll: this.handleLeftScroll }),
                React.createElement(Operation, { className: `${prefixCls}-operation`, rightActive: rightActive, rightArrowText: operations[0], moveToRight: this.moveToRight, leftActive: leftActive, leftArrowText: operations[1], moveToLeft: this.moveToLeft }),
                React.createElement(List, { prefixCls: `${prefixCls}-list`, titleText: titles[1], dataSource: rightDataSource, filter: rightFilter, filterOption: filterOption, style: listStyle, checkedKeys: targetSelectedKeys, handleFilter: this.handleRightFilter, handleClear: this.handleRightClear, handleSelect: this.handleRightSelect, handleSelectAll: this.handleRightSelectAll, render: render, showSearch: showSearch, searchPlaceholder: searchPlaceholder || locale.searchPlaceholder, notFoundContent: notFoundContent || locale.notFoundContent, itemUnit: locale.itemUnit, itemsUnit: locale.itemsUnit, body: body, footer: footer, lazy: lazy, onScroll: this.handleRightScroll })));
        };
        const { selectedKeys = [], targetKeys = [] } = props;
        this.state = {
            leftFilter: '',
            rightFilter: '',
            sourceSelectedKeys: selectedKeys.filter(key => targetKeys.indexOf(key) === -1),
            targetSelectedKeys: selectedKeys.filter(key => targetKeys.indexOf(key) > -1),
        };
    }
    componentWillReceiveProps(nextProps) {
        const { sourceSelectedKeys, targetSelectedKeys } = this.state;
        const { props } = this;
        if (nextProps.targetKeys !== props.targetKeys || nextProps.dataSource !== props.dataSource) {
            // clear cached splited dataSource
            this.splitedDataSource = null;
            if (!nextProps.selectedKeys) {
                // clear key nolonger existed
                // clear checkedKeys according to targetKeys
                const { dataSource, targetKeys = [] } = nextProps;
                const newSourceSelectedKeys = [];
                const newTargetSelectedKeys = [];
                dataSource.forEach(({ key }) => {
                    if (sourceSelectedKeys.includes(key) && !targetKeys.includes(key)) {
                        newSourceSelectedKeys.push(key);
                    }
                    if (targetSelectedKeys.includes(key) && targetKeys.includes(key)) {
                        newTargetSelectedKeys.push(key);
                    }
                });
                this.setState({
                    sourceSelectedKeys: newSourceSelectedKeys,
                    targetSelectedKeys: newTargetSelectedKeys,
                });
            }
        }
        if (nextProps.selectedKeys) {
            const targetKeys = nextProps.targetKeys || [];
            this.setState({
                sourceSelectedKeys: nextProps.selectedKeys.filter(key => !targetKeys.includes(key)),
                targetSelectedKeys: nextProps.selectedKeys.filter(key => targetKeys.includes(key)),
            });
        }
    }
    splitDataSource() {
        if (this.splitedDataSource) {
            return this.splitedDataSource;
        }
        const { dataSource, rowKey, targetKeys = [] } = this.props;
        const leftDataSource = [];
        const rightDataSource = new Array(targetKeys.length);
        dataSource.forEach(record => {
            if (rowKey) {
                record.key = rowKey(record);
            }
            // rightDataSource should be ordered by targetKeys
            // leftDataSource should be ordered by dataSource
            const indexOfKey = targetKeys.indexOf(record.key);
            if (indexOfKey !== -1) {
                rightDataSource[indexOfKey] = record;
            }
            else {
                leftDataSource.push(record);
            }
        });
        this.splitedDataSource = {
            leftDataSource,
            rightDataSource,
        };
        return this.splitedDataSource;
    }
    handleSelectChange(direction, holder) {
        const { onSelectChange } = this.props;
        const { sourceSelectedKeys, targetSelectedKeys } = this.state;
        if (!onSelectChange) {
            return;
        }
        if (direction === "left" /* left */) {
            onSelectChange(holder, targetSelectedKeys);
        }
        else {
            onSelectChange(sourceSelectedKeys, holder);
        }
    }
    getTitles(transferLocale) {
        const { props } = this;
        if (props.titles) {
            return props.titles;
        }
        return transferLocale.titles;
    }
    getSelectedKeysName(direction) {
        return direction === "left" /* left */ ? 'sourceSelectedKeys' : 'targetSelectedKeys';
    }
    render() {
        return (React.createElement(LocaleReceiver, { componentName: "Transfer", defaultLocale: defaultLocale.Transfer }, this.renderTransfer));
    }
}
Transfer.displayName = 'Transfer';
Transfer.List = List;
Transfer.Operation = Operation;
Transfer.Search = Search;
Transfer.defaultProps = {
    dataSource: [],
    render: noop,
    showSearch: false,
};
Transfer.propTypes = {
    prefixCls: PropTypes.string,
    dataSource: PropTypes.array,
    render: PropTypes.func,
    targetKeys: PropTypes.array,
    onChange: PropTypes.func,
    listStyle: PropTypes.object,
    className: PropTypes.string,
    titles: PropTypes.array,
    operations: PropTypes.array,
    showSearch: PropTypes.bool,
    filterOption: PropTypes.func,
    searchPlaceholder: PropTypes.string,
    notFoundContent: PropTypes.node,
    body: PropTypes.func,
    footer: PropTypes.func,
    rowKey: PropTypes.func,
    lazy: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvdHJhbnNmZXIvaW5kZXgudHN4IiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQWUsU0FBUyxFQUE0QyxNQUFNLE9BQU8sQ0FBQztBQUNoRyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxVQUFVLE1BQU0sWUFBWSxDQUFDO0FBQ3BDLE9BQU8sSUFBSSxNQUFNLGFBQWEsQ0FBQztBQUMvQixPQUFPLElBQTJCLE1BQU0sUUFBUSxDQUFDO0FBQ2pELE9BQU8sU0FBUyxNQUFNLGFBQWEsQ0FBQztBQUNwQyxPQUFPLE1BQU0sTUFBTSxVQUFVLENBQUM7QUFDOUIsT0FBTyxjQUFjLE1BQU0sbUNBQW1DLENBQUM7QUFDL0QsT0FBTyxhQUFhLE1BQU0sNEJBQTRCLENBQUM7QUFFdkQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQThDNUMsTUFBTSxDQUFDLE9BQU8sT0FBTyxRQUFTLFNBQVEsU0FBNkI7SUF3Q2pFLFlBQVksS0FBb0I7UUFDOUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBa0ZmLFdBQU0sR0FBRyxDQUFDLFNBQTRCLEVBQUUsRUFBRTtZQUN4QyxNQUFNLEVBQUUsVUFBVSxHQUFHLEVBQUUsRUFBRSxVQUFVLEdBQUcsRUFBRSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDbEUsTUFBTSxFQUFFLGtCQUFrQixFQUFFLGtCQUFrQixFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUM5RCxNQUFNLFFBQVEsR0FDWixTQUFTLHdCQUE0QixDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUM7WUFDbEYsOEJBQThCO1lBQzlCLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQ2pDLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FB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STtJQUN0QixNQUFNLEVBQUUsU0FBUyxDQUFDLElBQUk7SUFDdEIsSUFBSSxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUM5RCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzL3RyYW5zZmVyL2luZGV4LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ2hhbmdlRXZlbnQsIENvbXBvbmVudCwgQ1NTUHJvcGVydGllcywgUmVhY3ROb2RlLCBTeW50aGV0aWNFdmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBub29wIGZyb20gJ2xvZGFzaC9ub29wJztcbmltcG9ydCBMaXN0LCB7IFRyYW5zZmVyTGlzdFByb3BzIH0gZnJvbSAnLi9saXN0JztcbmltcG9ydCBPcGVyYXRpb24gZnJvbSAnLi9vcGVyYXRpb24nO1xuaW1wb3J0IFNlYXJjaCBmcm9tICcuL3NlYXJjaCc7XG5pbXBvcnQgTG9jYWxlUmVjZWl2ZXIgZnJvbSAnLi4vbG9jYWxlLXByb3ZpZGVyL0xvY2FsZVJlY2VpdmVyJztcbmltcG9ydCBkZWZhdWx0TG9jYWxlIGZyb20gJy4uL2xvY2FsZS1wcm92aWRlci9kZWZhdWx0JztcbmltcG9ydCB7IFRyYW5zZmVyRGlyZWN0aW9uIH0gZnJvbSAnLi9lbnVtJztcbmltcG9ydCB7IGdldFByZWZpeENscyB9IGZyb20gJy4uL2NvbmZpZ3VyZSc7XG5cbmV4cG9ydCB7IFRyYW5zZmVyTGlzdFByb3BzIH0gZnJvbSAnLi9saXN0JztcbmV4cG9ydCB7IFRyYW5zZmVyT3BlcmF0aW9uUHJvcHMgfSBmcm9tICcuL29wZXJhdGlvbic7XG5leHBvcnQgeyBUcmFuc2ZlclNlYXJjaFByb3BzIH0gZnJvbSAnLi9zZWFyY2gnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZmVySXRlbSB7XG4gIGtleTogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZmVyUHJvcHMge1xuICBwcmVmaXhDbHM/OiBzdHJpbmc7XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbiAgZGF0YVNvdXJjZTogVHJhbnNmZXJJdGVtW107XG4gIHRhcmdldEtleXM/OiBzdHJpbmdbXTtcbiAgc2VsZWN0ZWRLZXlzPzogc3RyaW5nW107XG4gIHJlbmRlcj86IChyZWNvcmQ6IFRyYW5zZmVySXRlbSkgPT4gUmVhY3ROb2RlO1xuICBvbkNoYW5nZT86ICh0YXJnZXRLZXlzOiBzdHJpbmdbXSwgZGlyZWN0aW9uOiBzdHJpbmcsIG1vdmVLZXlzOiBhbnkpID0+IHZvaWQ7XG4gIG9uU2VsZWN0Q2hhbmdlPzogKHNvdXJjZVNlbGVjdGVkS2V5czogc3RyaW5nW10sIHRhcmdldFNlbGVjdGVkS2V5czogc3RyaW5nW10pID0+IHZvaWQ7XG4gIHN0eWxlPzogQ1NTUHJvcGVydGllcztcbiAgbGlzdFN0eWxlPzogQ1NTUHJvcGVydGllcztcbiAgdGl0bGVzPzogc3RyaW5nW107XG4gIG9wZXJhdGlvbnM/OiBzdHJpbmdbXTtcbiAgc2hvd1NlYXJjaD86IGJvb2xlYW47XG4gIGZpbHRlck9wdGlvbj86IChpbnB1dFZhbHVlOiBhbnksIGl0ZW06IGFueSkgPT4gYm9vbGVhbjtcbiAgc2VhcmNoUGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIG5vdEZvdW5kQ29udGVudD86IFJlYWN0Tm9kZTtcbiAgZm9vdGVyPzogKHByb3BzOiBUcmFuc2Zlckxpc3RQcm9wcykgPT4gUmVhY3ROb2RlO1xuICBib2R5PzogKHByb3BzOiBUcmFuc2Zlckxpc3RQcm9wcykgPT4gUmVhY3ROb2RlO1xuICByb3dLZXk/OiAocmVjb3JkOiBUcmFuc2Zlckl0ZW0pID0+IHN0cmluZztcbiAgb25TZWFyY2hDaGFuZ2U/OiAoZGlyZWN0aW9uOiBUcmFuc2ZlckRpcmVjdGlvbiwgZTogQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHZvaWQ7XG4gIGxhenk/OiB7fSB8IGJvb2xlYW47XG4gIG9uU2Nyb2xsPzogKGRpcmVjdGlvbjogVHJhbnNmZXJEaXJlY3Rpb24sIGU6IFN5bnRoZXRpY0V2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4gdm9pZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUcmFuc2ZlckxvY2FsZSB7XG4gIHRpdGxlczogc3RyaW5nW107XG4gIG5vdEZvdW5kQ29udGVudDogc3RyaW5nO1xuICBzZWFyY2hQbGFjZWhvbGRlcjogc3RyaW5nO1xuICBpdGVtVW5pdDogc3RyaW5nO1xuICBpdGVtc1VuaXQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhbnNmZXIgZXh0ZW5kcyBDb21wb25lbnQ8VHJhbnNmZXJQcm9wcywgYW55PiB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdUcmFuc2Zlcic7XG5cbiAgc3RhdGljIExpc3QgPSBMaXN0O1xuXG4gIHN0YXRpYyBPcGVyYXRpb24gPSBPcGVyYXRpb247XG5cbiAgc3RhdGljIFNlYXJjaCA9IFNlYXJjaDtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGRhdGFTb3VyY2U6IFtdLFxuICAgIHJlbmRlcjogbm9vcCxcbiAgICBzaG93U2VhcmNoOiBmYWxzZSxcbiAgfTtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBkYXRhU291cmNlOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgcmVuZGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICB0YXJnZXRLZXlzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIGxpc3RTdHlsZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGl0bGVzOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgb3BlcmF0aW9uczogUHJvcFR5cGVzLmFycmF5LFxuICAgIHNob3dTZWFyY2g6IFByb3BUeXBlcy5ib29sLFxuICAgIGZpbHRlck9wdGlvbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2VhcmNoUGxhY2Vob2xkZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgbm90Rm91bmRDb250ZW50OiBQcm9wVHlwZXMubm9kZSxcbiAgICBib2R5OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBmb290ZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIHJvd0tleTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgbGF6eTogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm9iamVjdCwgUHJvcFR5cGVzLmJvb2xdKSxcbiAgfTtcblxuICBzcGxpdGVkRGF0YVNvdXJjZToge1xuICAgIGxlZnREYXRhU291cmNlOiBUcmFuc2Zlckl0ZW1bXTtcbiAgICByaWdodERhdGFTb3VyY2U6IFRyYW5zZmVySXRlbVtdO1xuICB9IHwgbnVsbDtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogVHJhbnNmZXJQcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIGNvbnN0IHsgc2VsZWN0ZWRLZXlzID0gW10sIHRhcmdldEtleXMgPSBbXSB9ID0gcHJvcHM7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGxlZnRGaWx0ZXI6ICcnLFxuICAgICAgcmlnaHRGaWx0ZXI6ICcnLFxuICAgICAgc291cmNlU2VsZWN0ZWRLZXlzOiBzZWxlY3RlZEtleXMuZmlsdGVyKGtleSA9PiB0YXJnZXRLZXlzLmluZGV4T2Yoa2V5KSA9PT0gLTEpLFxuICAgICAgdGFyZ2V0U2VsZWN0ZWRLZXlzOiBzZWxlY3RlZEtleXMuZmlsdGVyKGtleSA9PiB0YXJnZXRLZXlzLmluZGV4T2Yoa2V5KSA+IC0xKSxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHM6IFRyYW5zZmVyUHJvcHMpIHtcbiAgICBjb25zdCB7IHNvdXJjZVNlbGVjdGVkS2V5cywgdGFyZ2V0U2VsZWN0ZWRLZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG5cbiAgICBpZiAobmV4dFByb3BzLnRhcmdldEtleXMgIT09IHByb3BzLnRhcmdldEtleXMgfHwgbmV4dFByb3BzLmRhdGFTb3VyY2UgIT09IHByb3BzLmRhdGFTb3VyY2UpIHtcbiAgICAgIC8vIGNsZWFyIGNhY2hlZCBzcGxpdGVkIGRhdGFTb3VyY2VcbiAgICAgIHRoaXMuc3BsaXRlZERhdGFTb3VyY2UgPSBudWxsO1xuXG4gICAgICBpZiAoIW5leHRQcm9wcy5zZWxlY3RlZEtleXMpIHtcbiAgICAgICAgLy8gY2xlYXIga2V5IG5vbG9uZ2VyIGV4aXN0ZWRcbiAgICAgICAgLy8gY2xlYXIgY2hlY2tlZEtleXMgYWNjb3JkaW5nIHRvIHRhcmdldEtleXNcbiAgICAgICAgY29uc3QgeyBkYXRhU291cmNlLCB0YXJnZXRLZXlzID0gW10gfSA9IG5leHRQcm9wcztcblxuICAgICAgICBjb25zdCBuZXdTb3VyY2VTZWxlY3RlZEtleXM6IFN0cmluZ1tdID0gW107XG4gICAgICAgIGNvbnN0IG5ld1RhcmdldFNlbGVjdGVkS2V5czogU3RyaW5nW10gPSBbXTtcbiAgICAgICAgZGF0YVNvdXJjZS5mb3JFYWNoKCh7IGtleSB9KSA9PiB7XG4gICAgICAgICAgaWYgKHNvdXJjZVNlbGVjdGVkS2V5cy5pbmNsdWRlcyhrZXkpICYmICF0YXJnZXRLZXlzLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgICAgIG5ld1NvdXJjZVNlbGVjdGVkS2V5cy5wdXNoKGtleSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0YXJnZXRTZWxlY3RlZEtleXMuaW5jbHVkZXMoa2V5KSAmJiB0YXJnZXRLZXlzLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgICAgIG5ld1RhcmdldFNlbGVjdGVkS2V5cy5wdXNoKGtleSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgc291cmNlU2VsZWN0ZWRLZXlzOiBuZXdTb3VyY2VTZWxlY3RlZEtleXMsXG4gICAgICAgICAgdGFyZ2V0U2VsZWN0ZWRLZXlzOiBuZXdUYXJnZXRTZWxlY3RlZEtleXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChuZXh0UHJvcHMuc2VsZWN0ZWRLZXlzKSB7XG4gICAgICBjb25zdCB0YXJnZXRLZXlzID0gbmV4dFByb3BzLnRhcmdldEtleXMgfHwgW107XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgc291cmNlU2VsZWN0ZWRLZXlzOiBuZXh0UHJvcHMuc2VsZWN0ZWRLZXlzLmZpbHRlcihrZXkgPT4gIXRhcmdldEtleXMuaW5jbHVkZXMoa2V5KSksXG4gICAgICAgIHRhcmdldFNlbGVjdGVkS2V5czogbmV4dFByb3BzLnNlbGVjdGVkS2V5cy5maWx0ZXIoa2V5ID0+IHRhcmdldEtleXMuaW5jbHVkZXMoa2V5KSksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBzcGxpdERhdGFTb3VyY2UoKSB7XG4gICAgaWYgKHRoaXMuc3BsaXRlZERhdGFTb3VyY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLnNwbGl0ZWREYXRhU291cmNlO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YVNvdXJjZSwgcm93S2V5LCB0YXJnZXRLZXlzID0gW10gfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCBsZWZ0RGF0YVNvdXJjZTogVHJhbnNmZXJJdGVtW10gPSBbXTtcbiAgICBjb25zdCByaWdodERhdGFTb3VyY2U6IFRyYW5zZmVySXRlbVtdID0gbmV3IEFycmF5KHRhcmdldEtleXMubGVuZ3RoKTtcbiAgICBkYXRhU291cmNlLmZvckVhY2gocmVjb3JkID0+IHtcbiAgICAgIGlmIChyb3dLZXkpIHtcbiAgICAgICAgcmVjb3JkLmtleSA9IHJvd0tleShyZWNvcmQpO1xuICAgICAgfVxuXG4gICAgICAvLyByaWdodERhdGFTb3VyY2Ugc2hvdWxkIGJlIG9yZGVyZWQgYnkgdGFyZ2V0S2V5c1xuICAgICAgLy8gbGVmdERhdGFTb3VyY2Ugc2hvdWxkIGJlIG9yZGVyZWQgYnkgZGF0YVNvdXJjZVxuICAgICAgY29uc3QgaW5kZXhPZktleSA9IHRhcmdldEtleXMuaW5kZXhPZihyZWNvcmQua2V5KTtcbiAgICAgIGlmIChpbmRleE9mS2V5ICE9PSAtMSkge1xuICAgICAgICByaWdodERhdGFTb3VyY2VbaW5kZXhPZktleV0gPSByZWNvcmQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZWZ0RGF0YVNvdXJjZS5wdXNoKHJlY29yZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnNwbGl0ZWREYXRhU291cmNlID0ge1xuICAgICAgbGVmdERhdGFTb3VyY2UsXG4gICAgICByaWdodERhdGFTb3VyY2UsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLnNwbGl0ZWREYXRhU291cmNlO1xuICB9XG5cbiAgbW92ZVRvID0gKGRpcmVjdGlvbjogVHJhbnNmZXJEaXJlY3Rpb24pID0+IHtcbiAgICBjb25zdCB7IHRhcmdldEtleXMgPSBbXSwgZGF0YVNvdXJjZSA9IFtdLCBvbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IHNvdXJjZVNlbGVjdGVkS2V5cywgdGFyZ2V0U2VsZWN0ZWRLZXlzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IG1vdmVLZXlzID1cbiAgICAgIGRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQgPyBzb3VyY2VTZWxlY3RlZEtleXMgOiB0YXJnZXRTZWxlY3RlZEtleXM7XG4gICAgLy8gZmlsdGVyIHRoZSBkaXNhYmxlZCBvcHRpb25zXG4gICAgY29uc3QgbmV3TW92ZUtleXMgPSBtb3ZlS2V5cy5maWx0ZXIoXG4gICAgICAoa2V5OiBzdHJpbmcpID0+ICFkYXRhU291cmNlLnNvbWUoZGF0YSA9PiAhIShrZXkgPT09IGRhdGEua2V5ICYmIGRhdGEuZGlzYWJsZWQpKSxcbiAgICApO1xuICAgIC8vIG1vdmUgaXRlbXMgdG8gdGFyZ2V0IGJveFxuICAgIGNvbnN0IG5ld1RhcmdldEtleXMgPVxuICAgICAgZGlyZWN0aW9uID09PSBUcmFuc2ZlckRpcmVjdGlvbi5yaWdodFxuICAgICAgICA/IG5ld01vdmVLZXlzLmNvbmNhdCh0YXJnZXRLZXlzKVxuICAgICAgICA6IHRhcmdldEtleXMuZmlsdGVyKHRhcmdldEtleSA9PiBuZXdNb3ZlS2V5cy5pbmRleE9mKHRhcmdldEtleSkgPT09IC0xKTtcblxuICAgIC8vIGVtcHR5IGNoZWNrZWQga2V5c1xuICAgIGNvbnN0IG9wcG9zaXRlRGlyZWN0aW9uID1cbiAgICAgIGRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQgPyBUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0IDogVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQ7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBbdGhpcy5nZXRTZWxlY3RlZEtleXNOYW1lKG9wcG9zaXRlRGlyZWN0aW9uKV06IFtdLFxuICAgIH0pO1xuICAgIHRoaXMuaGFuZGxlU2VsZWN0Q2hhbmdlKG9wcG9zaXRlRGlyZWN0aW9uLCBbXSk7XG5cbiAgICBpZiAob25DaGFuZ2UpIHtcbiAgICAgIG9uQ2hhbmdlKG5ld1RhcmdldEtleXMsIGRpcmVjdGlvbiwgbmV3TW92ZUtleXMpO1xuICAgIH1cbiAgfTtcblxuICBtb3ZlVG9MZWZ0ID0gKCkgPT4gdGhpcy5tb3ZlVG8oVHJhbnNmZXJEaXJlY3Rpb24ubGVmdCk7XG5cbiAgbW92ZVRvUmlnaHQgPSAoKSA9PiB0aGlzLm1vdmVUbyhUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCk7XG5cbiAgaGFuZGxlU2VsZWN0Q2hhbmdlKGRpcmVjdGlvbjogVHJhbnNmZXJEaXJlY3Rpb24sIGhvbGRlcjogc3RyaW5nW10pIHtcbiAgICBjb25zdCB7IG9uU2VsZWN0Q2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgc291cmNlU2VsZWN0ZWRLZXlzLCB0YXJnZXRTZWxlY3RlZEtleXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKCFvblNlbGVjdENoYW5nZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChkaXJlY3Rpb24gPT09IFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQpIHtcbiAgICAgIG9uU2VsZWN0Q2hhbmdlKGhvbGRlciwgdGFyZ2V0U2VsZWN0ZWRLZXlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb25TZWxlY3RDaGFuZ2Uoc291cmNlU2VsZWN0ZWRLZXlzLCBob2xkZXIpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZVNlbGVjdEFsbCA9IChcbiAgICBkaXJlY3Rpb246IFRyYW5zZmVyRGlyZWN0aW9uLFxuICAgIGZpbHRlcmVkRGF0YVNvdXJjZTogVHJhbnNmZXJJdGVtW10sXG4gICAgY2hlY2tBbGw6IGJvb2xlYW4sXG4gICkgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIHN0YXRlLFxuICAgICAgcHJvcHM6IHsgc2VsZWN0ZWRLZXlzIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3Qgb3JpZ2luYWxTZWxlY3RlZEtleXMgPSBzdGF0ZVt0aGlzLmdldFNlbGVjdGVkS2V5c05hbWUoZGlyZWN0aW9uKV0gfHwgW107XG4gICAgY29uc3QgY3VycmVudEtleXMgPSBmaWx0ZXJlZERhdGFTb3VyY2UubWFwKGl0ZW0gPT4gaXRlbS5rZXkpO1xuICAgIC8vIE9ubHkgb3BlcmF0ZSBjdXJyZW50IGtleXMgZnJvbSBvcmlnaW5hbCBzZWxlY3RlZCBrZXlzXG4gICAgY29uc3QgbmV3S2V5czEgPSBvcmlnaW5hbFNlbGVjdGVkS2V5cy5maWx0ZXIoKGtleTogc3RyaW5nKSA9PiBjdXJyZW50S2V5cy5pbmRleE9mKGtleSkgPT09IC0xKTtcbiAgICBjb25zdCBuZXdLZXlzMiA9IFsuLi5vcmlnaW5hbFNlbGVjdGVkS2V5c107XG4gICAgY3VycmVudEtleXMuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgaWYgKG5ld0tleXMyLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHtcbiAgICAgICAgbmV3S2V5czIucHVzaChrZXkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnN0IGhvbGRlciA9IGNoZWNrQWxsID8gbmV3S2V5czEgOiBuZXdLZXlzMjtcbiAgICB0aGlzLmhhbmRsZVNlbGVjdENoYW5nZShkaXJlY3Rpb24sIGhvbGRlcik7XG5cbiAgICBpZiAoIXNlbGVjdGVkS2V5cykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIFt0aGlzLmdldFNlbGVjdGVkS2V5c05hbWUoZGlyZWN0aW9uKV06IGhvbGRlcixcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVMZWZ0U2VsZWN0QWxsID0gKGZpbHRlcmVkRGF0YVNvdXJjZTogVHJhbnNmZXJJdGVtW10sIGNoZWNrQWxsOiBib29sZWFuKSA9PlxuICAgIHRoaXMuaGFuZGxlU2VsZWN0QWxsKFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQsIGZpbHRlcmVkRGF0YVNvdXJjZSwgY2hlY2tBbGwpO1xuXG4gIGhhbmRsZVJpZ2h0U2VsZWN0QWxsID0gKGZpbHRlcmVkRGF0YVNvdXJjZTogVHJhbnNmZXJJdGVtW10sIGNoZWNrQWxsOiBib29sZWFuKSA9PlxuICAgIHRoaXMuaGFuZGxlU2VsZWN0QWxsKFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0LCBmaWx0ZXJlZERhdGFTb3VyY2UsIGNoZWNrQWxsKTtcblxuICBoYW5kbGVGaWx0ZXIgPSAoZGlyZWN0aW9uOiBUcmFuc2ZlckRpcmVjdGlvbiwgZTogQ2hhbmdlRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCB7IG9uU2VhcmNoQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgLy8gYWRkIGZpbHRlclxuICAgICAgW2Ake2RpcmVjdGlvbn1GaWx0ZXJgXTogZS50YXJnZXQudmFsdWUsXG4gICAgfSk7XG4gICAgaWYgKG9uU2VhcmNoQ2hhbmdlKSB7XG4gICAgICBvblNlYXJjaENoYW5nZShkaXJlY3Rpb24sIGUpO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVMZWZ0RmlsdGVyID0gKGU6IENoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PlxuICAgIHRoaXMuaGFuZGxlRmlsdGVyKFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQsIGUpO1xuXG4gIGhhbmRsZVJpZ2h0RmlsdGVyID0gKGU6IENoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PlxuICAgIHRoaXMuaGFuZGxlRmlsdGVyKFRyYW5zZmVyRGlyZWN0aW9uLnJpZ2h0LCBlKTtcblxuICBoYW5kbGVDbGVhciA9IChkaXJlY3Rpb246IHN0cmluZykgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgW2Ake2RpcmVjdGlvbn1GaWx0ZXJgXTogJycsXG4gICAgfSk7XG4gIH07XG5cbiAgaGFuZGxlTGVmdENsZWFyID0gKCkgPT4gdGhpcy5oYW5kbGVDbGVhcihUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0KTtcblxuICBoYW5kbGVSaWdodENsZWFyID0gKCkgPT4gdGhpcy5oYW5kbGVDbGVhcihUcmFuc2ZlckRpcmVjdGlvbi5yaWdodCk7XG5cbiAgaGFuZGxlU2VsZWN0ID0gKGRpcmVjdGlvbjogVHJhbnNmZXJEaXJlY3Rpb24sIHNlbGVjdGVkSXRlbTogVHJhbnNmZXJJdGVtLCBjaGVja2VkOiBib29sZWFuKSA9PiB7XG4gICAgY29uc3QgeyBzZWxlY3RlZEtleXMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBzb3VyY2VTZWxlY3RlZEtleXMsIHRhcmdldFNlbGVjdGVkS2V5cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBob2xkZXIgPVxuICAgICAgZGlyZWN0aW9uID09PSBUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0ID8gWy4uLnNvdXJjZVNlbGVjdGVkS2V5c10gOiBbLi4udGFyZ2V0U2VsZWN0ZWRLZXlzXTtcbiAgICBjb25zdCBpbmRleCA9IGhvbGRlci5pbmRleE9mKHNlbGVjdGVkSXRlbS5rZXkpO1xuICAgIGlmIChpbmRleCA+IC0xKSB7XG4gICAgICBob2xkZXIuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgaWYgKGNoZWNrZWQpIHtcbiAgICAgIGhvbGRlci5wdXNoKHNlbGVjdGVkSXRlbS5rZXkpO1xuICAgIH1cbiAgICB0aGlzLmhhbmRsZVNlbGVjdENoYW5nZShkaXJlY3Rpb24sIGhvbGRlcik7XG5cbiAgICBpZiAoIXNlbGVjdGVkS2V5cykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIFt0aGlzLmdldFNlbGVjdGVkS2V5c05hbWUoZGlyZWN0aW9uKV06IGhvbGRlcixcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVMZWZ0U2VsZWN0ID0gKHNlbGVjdGVkSXRlbTogVHJhbnNmZXJJdGVtLCBjaGVja2VkOiBib29sZWFuKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuaGFuZGxlU2VsZWN0KFRyYW5zZmVyRGlyZWN0aW9uLmxlZnQsIHNlbGVjdGVkSXRlbSwgY2hlY2tlZCk7XG4gIH07XG5cbiAgaGFuZGxlUmlnaHRTZWxlY3QgPSAoc2VsZWN0ZWRJdGVtOiBUcmFuc2Zlckl0ZW0sIGNoZWNrZWQ6IGJvb2xlYW4pID0+IHtcbiAgICByZXR1cm4gdGhpcy5oYW5kbGVTZWxlY3QoVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQsIHNlbGVjdGVkSXRlbSwgY2hlY2tlZCk7XG4gIH07XG5cbiAgaGFuZGxlU2Nyb2xsID0gKGRpcmVjdGlvbjogVHJhbnNmZXJEaXJlY3Rpb24sIGU6IFN5bnRoZXRpY0V2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgIGNvbnN0IHsgb25TY3JvbGwgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKG9uU2Nyb2xsKSB7XG4gICAgICBvblNjcm9sbChkaXJlY3Rpb24sIGUpO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVMZWZ0U2Nyb2xsID0gKGU6IFN5bnRoZXRpY0V2ZW50PEhUTUxEaXZFbGVtZW50PikgPT5cbiAgICB0aGlzLmhhbmRsZVNjcm9sbChUcmFuc2ZlckRpcmVjdGlvbi5sZWZ0LCBlKTtcblxuICBoYW5kbGVSaWdodFNjcm9sbCA9IChlOiBTeW50aGV0aWNFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+XG4gICAgdGhpcy5oYW5kbGVTY3JvbGwoVHJhbnNmZXJEaXJlY3Rpb24ucmlnaHQsIGUpO1xuXG4gIGdldFRpdGxlcyh0cmFuc2ZlckxvY2FsZTogVHJhbnNmZXJMb2NhbGUpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgeyBwcm9wcyB9ID0gdGhpcztcbiAgICBpZiAocHJvcHMudGl0bGVzKSB7XG4gICAgICByZXR1cm4gcHJvcHMudGl0bGVzO1xuICAgIH1cbiAgICByZXR1cm4gdHJhbnNmZXJMb2NhbGUudGl0bGVzO1xuICB9XG5cbiAgZ2V0U2VsZWN0ZWRLZXlzTmFtZShkaXJlY3Rpb246IFRyYW5zZmVyRGlyZWN0aW9uKSB7XG4gICAgcmV0dXJuIGRpcmVjdGlvbiA9PT0gVHJhbnNmZXJEaXJlY3Rpb24ubGVmdCA/ICdzb3VyY2VTZWxlY3RlZEtleXMnIDogJ3RhcmdldFNlbGVjdGVkS2V5cyc7XG4gIH1cblxuICByZW5kZXJUcmFuc2ZlciA9IChsb2NhbGU6IFRyYW5zZmVyTG9jYWxlKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzOiBjdXN0b21pemVQcmVmaXhDbHMsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBvcGVyYXRpb25zID0gW10sXG4gICAgICBzaG93U2VhcmNoLFxuICAgICAgbm90Rm91bmRDb250ZW50LFxuICAgICAgc2VhcmNoUGxhY2Vob2xkZXIsXG4gICAgICBib2R5LFxuICAgICAgZm9vdGVyLFxuICAgICAgbGlzdFN0eWxlLFxuICAgICAgZmlsdGVyT3B0aW9uLFxuICAgICAgcmVuZGVyLFxuICAgICAgbGF6eSxcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBwcmVmaXhDbHMgPSBnZXRQcmVmaXhDbHMoJ3RyYW5zZmVyJywgY3VzdG9taXplUHJlZml4Q2xzKTtcbiAgICBjb25zdCB7IGxlZnRGaWx0ZXIsIHJpZ2h0RmlsdGVyLCBzb3VyY2VTZWxlY3RlZEtleXMsIHRhcmdldFNlbGVjdGVkS2V5cyB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGNvbnN0IHsgbGVmdERhdGFTb3VyY2UsIHJpZ2h0RGF0YVNvdXJjZSB9ID0gdGhpcy5zcGxpdERhdGFTb3VyY2UoKTtcbiAgICBjb25zdCBsZWZ0QWN0aXZlID0gdGFyZ2V0U2VsZWN0ZWRLZXlzLmxlbmd0aCA+IDA7XG4gICAgY29uc3QgcmlnaHRBY3RpdmUgPSBzb3VyY2VTZWxlY3RlZEtleXMubGVuZ3RoID4gMDtcblxuICAgIGNvbnN0IGNscyA9IGNsYXNzTmFtZXMoY2xhc3NOYW1lLCBwcmVmaXhDbHMpO1xuXG4gICAgY29uc3QgdGl0bGVzID0gdGhpcy5nZXRUaXRsZXMobG9jYWxlKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Nsc30+XG4gICAgICAgIDxMaXN0XG4gICAgICAgICAgcHJlZml4Q2xzPXtgJHtwcmVmaXhDbHN9LWxpc3RgfVxuICAgICAgICAgIHRpdGxlVGV4dD17dGl0bGVzWzBdfVxuICAgICAgICAgIGRhdGFTb3VyY2U9e2xlZnREYXRhU291cmNlfVxuICAgICAgICAgIGZpbHRlcj17bGVmdEZpbHRlcn1cbiAgICAgICAgICBmaWx0ZXJPcHRpb249e2ZpbHRlck9wdGlvbn1cbiAgICAgICAgICBzdHlsZT17bGlzdFN0eWxlfVxuICAgICAgICAgIGNoZWNrZWRLZXlzPXtzb3VyY2VTZWxlY3RlZEtleXN9XG4gICAgICAgICAgaGFuZGxlRmlsdGVyPXt0aGlzLmhhbmRsZUxlZnRGaWx0ZXJ9XG4gICAgICAgICAgaGFuZGxlQ2xlYXI9e3RoaXMuaGFuZGxlTGVmdENsZWFyfVxuICAgICAgICAgIGhhbmRsZVNlbGVjdD17dGhpcy5oYW5kbGVMZWZ0U2VsZWN0fVxuICAgICAgICAgIGhhbmRsZVNlbGVjdEFsbD17dGhpcy5oYW5kbGVMZWZ0U2VsZWN0QWxsfVxuICAgICAgICAgIHJlbmRlcj17cmVuZGVyfVxuICAgICAgICAgIHNob3dTZWFyY2g9e3Nob3dTZWFyY2h9XG4gICAgICAgICAgc2VhcmNoUGxhY2Vob2xkZXI9e3NlYXJjaFBsYWNlaG9sZGVyIHx8IGxvY2FsZS5zZWFyY2hQbGFjZWhvbGRlcn1cbiAgICAgICAgICBub3RGb3VuZENvbnRlbnQ9e25vdEZvdW5kQ29udGVudCB8fCBsb2NhbGUubm90Rm91bmRDb250ZW50fVxuICAgICAgICAgIGl0ZW1Vbml0PXtsb2NhbGUuaXRlbVVuaXR9XG4gICAgICAgICAgaXRlbXNVbml0PXtsb2NhbGUuaXRlbXNVbml0fVxuICAgICAgICAgIGJvZHk9e2JvZHl9XG4gICAgICAgICAgZm9vdGVyPXtmb290ZXJ9XG4gICAgICAgICAgbGF6eT17bGF6eX1cbiAgICAgICAgICBvblNjcm9sbD17dGhpcy5oYW5kbGVMZWZ0U2Nyb2xsfVxuICAgICAgICAvPlxuICAgICAgICA8T3BlcmF0aW9uXG4gICAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LW9wZXJhdGlvbmB9XG4gICAgICAgICAgcmlnaHRBY3RpdmU9e3JpZ2h0QWN0aXZlfVxuICAgICAgICAgIHJpZ2h0QXJyb3dUZXh0PXtvcGVyYXRpb25zWzBdfVxuICAgICAgICAgIG1vdmVUb1JpZ2h0PXt0aGlzLm1vdmVUb1JpZ2h0fVxuICAgICAgICAgIGxlZnRBY3RpdmU9e2xlZnRBY3RpdmV9XG4gICAgICAgICAgbGVmdEFycm93VGV4dD17b3BlcmF0aW9uc1sxXX1cbiAgICAgICAgICBtb3ZlVG9MZWZ0PXt0aGlzLm1vdmVUb0xlZnR9XG4gICAgICAgIC8+XG4gICAgICAgIDxMaXN0XG4gICAgICAgICAgcHJlZml4Q2xzPXtgJHtwcmVmaXhDbHN9LWxpc3RgfVxuICAgICAgICAgIHRpdGxlVGV4dD17dGl0bGVzWzFdfVxuICAgICAgICAgIGRhdGFTb3VyY2U9e3JpZ2h0RGF0YVNvdXJjZX1cbiAgICAgICAgICBmaWx0ZXI9e3JpZ2h0RmlsdGVyfVxuICAgICAgICAgIGZpbHRlck9wdGlvbj17ZmlsdGVyT3B0aW9ufVxuICAgICAgICAgIHN0eWxlPXtsaXN0U3R5bGV9XG4gICAgICAgICAgY2hlY2tlZEtleXM9e3RhcmdldFNlbGVjdGVkS2V5c31cbiAgICAgICAgICBoYW5kbGVGaWx0ZXI9e3RoaXMuaGFuZGxlUmlnaHRGaWx0ZXJ9XG4gICAgICAgICAgaGFuZGxlQ2xlYXI9e3RoaXMuaGFuZGxlUmlnaHRDbGVhcn1cbiAgICAgICAgICBoYW5kbGVTZWxlY3Q9e3RoaXMuaGFuZGxlUmlnaHRTZWxlY3R9XG4gICAgICAgICAgaGFuZGxlU2VsZWN0QWxsPXt0aGlzLmhhbmRsZVJpZ2h0U2VsZWN0QWxsfVxuICAgICAgICAgIHJlbmRlcj17cmVuZGVyfVxuICAgICAgICAgIHNob3dTZWFyY2g9e3Nob3dTZWFyY2h9XG4gICAgICAgICAgc2VhcmNoUGxhY2Vob2xkZXI9e3NlYXJjaFBsYWNlaG9sZGVyIHx8IGxvY2FsZS5zZWFyY2hQbGFjZWhvbGRlcn1cbiAgICAgICAgICBub3RGb3VuZENvbnRlbnQ9e25vdEZvdW5kQ29udGVudCB8fCBsb2NhbGUubm90Rm91bmRDb250ZW50fVxuICAgICAgICAgIGl0ZW1Vbml0PXtsb2NhbGUuaXRlbVVuaXR9XG4gICAgICAgICAgaXRlbXNVbml0PXtsb2NhbGUuaXRlbXNVbml0fVxuICAgICAgICAgIGJvZHk9e2JvZHl9XG4gICAgICAgICAgZm9vdGVyPXtmb290ZXJ9XG4gICAgICAgICAgbGF6eT17bGF6eX1cbiAgICAgICAgICBvblNjcm9sbD17dGhpcy5oYW5kbGVSaWdodFNjcm9sbH1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8TG9jYWxlUmVjZWl2ZXIgY29tcG9uZW50TmFtZT1cIlRyYW5zZmVyXCIgZGVmYXVsdExvY2FsZT17ZGVmYXVsdExvY2FsZS5UcmFuc2Zlcn0+XG4gICAgICAgIHt0aGlzLnJlbmRlclRyYW5zZmVyfVxuICAgICAgPC9Mb2NhbGVSZWNlaXZlcj5cbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=