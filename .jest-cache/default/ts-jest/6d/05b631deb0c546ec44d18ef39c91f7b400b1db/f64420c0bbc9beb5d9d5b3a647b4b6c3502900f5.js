import { __decorate } from "tslib";
import React from 'react';
import classNames from 'classnames';
import autobind from '../_util/autobind';
import Icon from '../icon';
import DaysView, { alwaysValidDate } from './DaysView';
import { stopEvent } from '../_util/EventManager';
export default class YearsView extends DaysView {
    handlePrevYearClick() {
        this.changeSelectedDate(this.getCloneDate().subtract(10, 'y'));
    }
    handleYearSelect() {
        this.changeViewMode("decade" /* decade */);
    }
    handleNextYearClick() {
        this.changeSelectedDate(this.getCloneDate().add(10, 'y'));
    }
    handleKeyDownHome(e) {
        stopEvent(e);
        const date = this.getCloneDate();
        this.changeSelectedDate(date.subtract(date.year() % 10, 'y'));
    }
    handleKeyDownEnd(e) {
        stopEvent(e);
        const date = this.getCloneDate();
        this.changeSelectedDate(date.add(9 - (date.year() % 10), 'y'));
    }
    handleKeyDownLeft(e) {
        stopEvent(e);
        if (e.altKey) {
            this.changeViewMode("decade" /* decade */);
        }
        else {
            this.changeSelectedDate(this.getCloneDate().subtract(1, 'y'));
        }
    }
    handleKeyDownRight(e) {
        stopEvent(e);
        if (e.altKey) {
            if (this.props.mode !== "year" /* year */) {
                this.changeViewMode("month" /* month */);
            }
        }
        else {
            this.changeSelectedDate(this.getCloneDate().add(1, 'y'));
        }
    }
    handleKeyDownUp(e) {
        stopEvent(e);
        this.changeSelectedDate(this.getCloneDate().subtract(3, 'y'));
    }
    handleKeyDownDown(e) {
        stopEvent(e);
        this.changeSelectedDate(this.getCloneDate().add(3, 'y'));
    }
    handleKeyDownPageUp(e) {
        stopEvent(e);
        this.changeSelectedDate(this.getCloneDate().subtract(e.altKey ? 100 : 10, 'y'));
    }
    handleKeyDownPageDown(e) {
        stopEvent(e);
        this.changeSelectedDate(this.getCloneDate().add(e.altKey ? 100 : 10, 'y'));
    }
    renderHeader() {
        const { prefixCls, props: { date }, } = this;
        const year = date.year() % 10;
        const from = date.clone().subtract(year, 'y');
        const to = from.clone().add(9, 'y');
        return (React.createElement("div", { className: `${prefixCls}-header` },
            React.createElement("a", { className: `${prefixCls}-prev-year`, onClick: this.handlePrevYearClick },
                React.createElement(Icon, { type: "first_page" })),
            React.createElement("a", { className: `${prefixCls}-view-select`, onClick: this.handleYearSelect },
                from.year(),
                " - ",
                to.year()),
            React.createElement("a", { className: `${prefixCls}-next-year` },
                React.createElement(Icon, { type: "last_page", onClick: this.handleNextYearClick }))));
    }
    renderPanelHead() {
        return undefined;
    }
    renderPanelBody() {
        const { prefixCls, props: { date, renderer = this.renderCell, isValidDate = alwaysValidDate }, } = this;
        const selected = date.clone();
        const from = date
            .clone()
            .startOf('y')
            .subtract(date.year() % 10, 'y');
        const to = from.clone().add(10, 'y');
        const prevYear = from.clone().subtract(1, 'y');
        const lastYear = to.clone().add(1, 'y');
        const rows = [];
        let cells = [];
        while (prevYear.isBefore(lastYear)) {
            const currentYear = prevYear.clone();
            const isDisabled = !isValidDate(currentYear, selected);
            const className = classNames(`${prefixCls}-cell`, {
                [`${prefixCls}-old`]: currentYear.isBefore(from, 'y'),
                [`${prefixCls}-new`]: currentYear.isSame(to, 'y'),
                [`${prefixCls}-selected`]: prevYear.isSame(selected, 'y'),
                [`${prefixCls}-disabled`]: isDisabled,
            });
            const text = String(prevYear.year());
            const yearProps = {
                key: text,
                className,
                children: this.renderInner(text),
            };
            if (!isDisabled) {
                yearProps.onClick = this.handleCellClick.bind(this, currentYear);
            }
            cells.push(renderer(yearProps, text, currentYear, selected));
            if (cells.length === 3) {
                rows.push(React.createElement("tr", { key: text }, cells));
                cells = [];
            }
            prevYear.add(1, 'y');
        }
        return rows;
    }
    renderFooter() {
        return undefined;
    }
    getPanelClass() {
        return `${this.prefixCls}-year-panel`;
    }
    choose(date) {
        const { mode } = this.props;
        if (mode !== "year" /* year */) {
            this.changeSelectedDate(date);
            this.changeViewMode("month" /* month */);
        }
        else {
            super.choose(date);
        }
    }
}
YearsView.displayName = 'YearsView';
YearsView.type = "year" /* year */;
__decorate([
    autobind
], YearsView.prototype, "handlePrevYearClick", null);
__decorate([
    autobind
], YearsView.prototype, "handleYearSelect", null);
__decorate([
    autobind
], YearsView.prototype, "handleNextYearClick", null);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL2RhdGUtcGlja2VyL1llYXJzVmlldy50c3giLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBb0IsTUFBTSxPQUFPLENBQUM7QUFFekMsT0FBTyxVQUFVLE1BQU0sWUFBWSxDQUFDO0FBQ3BDLE9BQU8sUUFBUSxNQUFNLG1CQUFtQixDQUFDO0FBQ3pDLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUUzQixPQUFPLFFBQVEsRUFBRSxFQUFFLGVBQWUsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUV2RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFbEQsTUFBTSxDQUFDLE9BQU8sT0FBTyxTQUFVLFNBQVEsUUFBUTtJQU03QyxtQkFBbUI7UUFDakIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUdELGdCQUFnQjtRQUNkLElBQUksQ0FBQyxjQUFjLHVCQUFpQixDQUFDO0lBQ3ZDLENBQUM7SUFHRCxtQkFBbUI7UUFDakIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELGlCQUFpQixDQUFDLENBQUM7UUFDakIsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2IsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRUQsZ0JBQWdCLENBQUMsQ0FBQztRQUNoQixTQUFT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O2FBQ2xFO1lBRUQsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUU3RCxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLDRCQUFJLEdBQUcsRUFBRSxJQUFJLElBQUcsS0FBSyxDQUFNLENBQUMsQ0FBQztnQkFDdkMsS0FBSyxHQUFHLEVBQUUsQ0FBQzthQUNaO1lBRUQsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDdEI7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxZQUFZO1FBQ1YsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELGFBQWE7UUFDWCxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsYUFBYSxDQUFDO0lBQ3hDLENBQUM7SUFFRCxNQUFNLENBQUMsSUFBWTtRQUNqQixNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUM1QixJQUFJLElBQUksc0JBQWtCLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzlCLElBQUksQ0FBQyxjQUFjLHFCQUFnQixDQUFDO1NBQ3JDO2FBQU07WUFDTCxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3BCO0lBQ0gsQ0FBQzs7QUFyS00scUJBQVcsR0FBRyxXQUFXLENBQUM7QUFFMUIsY0FBSSxxQkFBa0I7QUFHN0I7SUFEQyxRQUFRO29EQUdSO0FBR0Q7SUFEQyxRQUFRO2lEQUdSO0FBR0Q7SUFEQyxRQUFRO29EQUdSIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby9kYXRlLXBpY2tlci9ZZWFyc1ZpZXcudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBNb21lbnQgfSBmcm9tICdtb21lbnQnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnLi4vX3V0aWwvYXV0b2JpbmQnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgeyBWaWV3TW9kZSB9IGZyb20gJy4vZW51bSc7XG5pbXBvcnQgRGF5c1ZpZXcsIHsgYWx3YXlzVmFsaWREYXRlIH0gZnJvbSAnLi9EYXlzVmlldyc7XG5pbXBvcnQgeyBGaWVsZFR5cGUgfSBmcm9tICcuLi9kYXRhLXNldC9lbnVtJztcbmltcG9ydCB7IHN0b3BFdmVudCB9IGZyb20gJy4uL191dGlsL0V2ZW50TWFuYWdlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFllYXJzVmlldyBleHRlbmRzIERheXNWaWV3IHtcbiAgc3RhdGljIGRpc3BsYXlOYW1lID0gJ1llYXJzVmlldyc7XG5cbiAgc3RhdGljIHR5cGUgPSBGaWVsZFR5cGUueWVhcjtcblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlUHJldlllYXJDbGljaygpIHtcbiAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLnN1YnRyYWN0KDEwLCAneScpKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVZZWFyU2VsZWN0KCkge1xuICAgIHRoaXMuY2hhbmdlVmlld01vZGUoVmlld01vZGUuZGVjYWRlKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVOZXh0WWVhckNsaWNrKCkge1xuICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKHRoaXMuZ2V0Q2xvbmVEYXRlKCkuYWRkKDEwLCAneScpKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25Ib21lKGUpIHtcbiAgICBzdG9wRXZlbnQoZSk7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuZ2V0Q2xvbmVEYXRlKCk7XG4gICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGUoZGF0ZS5zdWJ0cmFjdChkYXRlLnllYXIoKSAlIDEwLCAneScpKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25FbmQoZSkge1xuICAgIHN0b3BFdmVudChlKTtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5nZXRDbG9uZURhdGUoKTtcbiAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZShkYXRlLmFkZCg5IC0gKGRhdGUueWVhcigpICUgMTApLCAneScpKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25MZWZ0KGUpIHtcbiAgICBzdG9wRXZlbnQoZSk7XG4gICAgaWYgKGUuYWx0S2V5KSB7XG4gICAgICB0aGlzLmNoYW5nZVZpZXdNb2RlKFZpZXdNb2RlLmRlY2FkZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKHRoaXMuZ2V0Q2xvbmVEYXRlKCkuc3VidHJhY3QoMSwgJ3knKSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5RG93blJpZ2h0KGUpIHtcbiAgICBzdG9wRXZlbnQoZSk7XG4gICAgaWYgKGUuYWx0S2V5KSB7XG4gICAgICBpZiAodGhpcy5wcm9wcy5tb2RlICE9PSBWaWV3TW9kZS55ZWFyKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlVmlld01vZGUoVmlld01vZGUubW9udGgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLmFkZCgxLCAneScpKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVLZXlEb3duVXAoZSkge1xuICAgIHN0b3BFdmVudChlKTtcbiAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLnN1YnRyYWN0KDMsICd5JykpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93bkRvd24oZSkge1xuICAgIHN0b3BFdmVudChlKTtcbiAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLmFkZCgzLCAneScpKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25QYWdlVXAoZSkge1xuICAgIHN0b3BFdmVudChlKTtcbiAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLnN1YnRyYWN0KGUuYWx0S2V5ID8gMTAwIDogMTAsICd5JykpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93blBhZ2VEb3duKGUpIHtcbiAgICBzdG9wRXZlbnQoZSk7XG4gICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGUodGhpcy5nZXRDbG9uZURhdGUoKS5hZGQoZS5hbHRLZXkgPyAxMDAgOiAxMCwgJ3knKSk7XG4gIH1cblxuICByZW5kZXJIZWFkZXIoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBwcm9wczogeyBkYXRlIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3QgeWVhciA9IGRhdGUueWVhcigpICUgMTA7XG4gICAgY29uc3QgZnJvbSA9IGRhdGUuY2xvbmUoKS5zdWJ0cmFjdCh5ZWFyLCAneScpO1xuICAgIGNvbnN0IHRvID0gZnJvbS5jbG9uZSgpLmFkZCg5LCAneScpO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1oZWFkZXJgfT5cbiAgICAgICAgPGEgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXByZXYteWVhcmB9IG9uQ2xpY2s9e3RoaXMuaGFuZGxlUHJldlllYXJDbGlja30+XG4gICAgICAgICAgPEljb24gdHlwZT1cImZpcnN0X3BhZ2VcIiAvPlxuICAgICAgICA8L2E+XG4gICAgICAgIDxhIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS12aWV3LXNlbGVjdGB9IG9uQ2xpY2s9e3RoaXMuaGFuZGxlWWVhclNlbGVjdH0+XG4gICAgICAgICAge2Zyb20ueWVhcigpfSAtIHt0by55ZWFyKCl9XG4gICAgICAgIDwvYT5cbiAgICAgICAgPGEgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LW5leHQteWVhcmB9PlxuICAgICAgICAgIDxJY29uIHR5cGU9XCJsYXN0X3BhZ2VcIiBvbkNsaWNrPXt0aGlzLmhhbmRsZU5leHRZZWFyQ2xpY2t9IC8+XG4gICAgICAgIDwvYT5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJQYW5lbEhlYWQoKTogUmVhY3ROb2RlIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgcmVuZGVyUGFuZWxCb2R5KCk6IFJlYWN0Tm9kZSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgcHJvcHM6IHsgZGF0ZSwgcmVuZGVyZXIgPSB0aGlzLnJlbmRlckNlbGwsIGlzVmFsaWREYXRlID0gYWx3YXlzVmFsaWREYXRlIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3Qgc2VsZWN0ZWQgPSBkYXRlLmNsb25lKCk7XG4gICAgY29uc3QgZnJvbSA9IGRhdGVcbiAgICAgIC5jbG9uZSgpXG4gICAgICAuc3RhcnRPZigneScpXG4gICAgICAuc3VidHJhY3QoZGF0ZS55ZWFyKCkgJSAxMCwgJ3knKTtcbiAgICBjb25zdCB0byA9IGZyb20uY2xvbmUoKS5hZGQoMTAsICd5Jyk7XG4gICAgY29uc3QgcHJldlllYXIgPSBmcm9tLmNsb25lKCkuc3VidHJhY3QoMSwgJ3knKTtcbiAgICBjb25zdCBsYXN0WWVhciA9IHRvLmNsb25lKCkuYWRkKDEsICd5Jyk7XG4gICAgY29uc3Qgcm93czogUmVhY3ROb2RlW10gPSBbXTtcbiAgICBsZXQgY2VsbHM6IFJlYWN0Tm9kZVtdID0gW107XG5cbiAgICB3aGlsZSAocHJldlllYXIuaXNCZWZvcmUobGFzdFllYXIpKSB7XG4gICAgICBjb25zdCBjdXJyZW50WWVhciA9IHByZXZZZWFyLmNsb25lKCk7XG4gICAgICBjb25zdCBpc0Rpc2FibGVkID0gIWlzVmFsaWREYXRlKGN1cnJlbnRZZWFyLCBzZWxlY3RlZCk7XG4gICAgICBjb25zdCBjbGFzc05hbWUgPSBjbGFzc05hbWVzKGAke3ByZWZpeENsc30tY2VsbGAsIHtcbiAgICAgICAgW2Ake3ByZWZpeENsc30tb2xkYF06IGN1cnJlbnRZZWFyLmlzQmVmb3JlKGZyb20sICd5JyksXG4gICAgICAgIFtgJHtwcmVmaXhDbHN9LW5ld2BdOiBjdXJyZW50WWVhci5pc1NhbWUodG8sICd5JyksXG4gICAgICAgIFtgJHtwcmVmaXhDbHN9LXNlbGVjdGVkYF06IHByZXZZZWFyLmlzU2FtZShzZWxlY3RlZCwgJ3knKSxcbiAgICAgICAgW2Ake3ByZWZpeENsc30tZGlzYWJsZWRgXTogaXNEaXNhYmxlZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0ZXh0ID0gU3RyaW5nKHByZXZZZWFyLnllYXIoKSk7XG5cbiAgICAgIGNvbnN0IHllYXJQcm9wczogYW55ID0ge1xuICAgICAgICBrZXk6IHRleHQsXG4gICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgY2hpbGRyZW46IHRoaXMucmVuZGVySW5uZXIodGV4dCksXG4gICAgICB9O1xuXG4gICAgICBpZiAoIWlzRGlzYWJsZWQpIHtcbiAgICAgICAgeWVhclByb3BzLm9uQ2xpY2sgPSB0aGlzLmhhbmRsZUNlbGxDbGljay5iaW5kKHRoaXMsIGN1cnJlbnRZZWFyKTtcbiAgICAgIH1cblxuICAgICAgY2VsbHMucHVzaChyZW5kZXJlcih5ZWFyUHJvcHMsIHRleHQsIGN1cnJlbnRZZWFyLCBzZWxlY3RlZCkpO1xuXG4gICAgICBpZiAoY2VsbHMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIHJvd3MucHVzaCg8dHIga2V5PXt0ZXh0fT57Y2VsbHN9PC90cj4pO1xuICAgICAgICBjZWxscyA9IFtdO1xuICAgICAgfVxuXG4gICAgICBwcmV2WWVhci5hZGQoMSwgJ3knKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcm93cztcbiAgfVxuXG4gIHJlbmRlckZvb3RlcigpOiBSZWFjdE5vZGUge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXRQYW5lbENsYXNzKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke3RoaXMucHJlZml4Q2xzfS15ZWFyLXBhbmVsYDtcbiAgfVxuXG4gIGNob29zZShkYXRlOiBNb21lbnQpOiB2b2lkIHtcbiAgICBjb25zdCB7IG1vZGUgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKG1vZGUgIT09IFZpZXdNb2RlLnllYXIpIHtcbiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKGRhdGUpO1xuICAgICAgdGhpcy5jaGFuZ2VWaWV3TW9kZShWaWV3TW9kZS5tb250aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN1cGVyLmNob29zZShkYXRlKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==