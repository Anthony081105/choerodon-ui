import React from 'react';
import Icon from '../icon';
import Notification from '../rc-components/notification';
import { getPrefixCls } from '../configure';
const notificationInstance = {};
let defaultDuration = 4.5;
let defaultTop = 24;
let defaultBottom = 24;
let defaultPlacement = 'topRight';
let defaultGetContainer;
function setNotificationConfig(options) {
    const { duration, placement, bottom, top, getContainer } = options;
    if (duration !== undefined) {
        defaultDuration = duration;
    }
    if (placement !== undefined) {
        defaultPlacement = placement;
    }
    if (bottom !== undefined) {
        defaultBottom = bottom;
    }
    if (top !== undefined) {
        defaultTop = top;
    }
    if (getContainer !== undefined) {
        defaultGetContainer = getContainer;
    }
}
function getPlacementStyle(placement) {
    let style;
    switch (placement) {
        case 'topLeft':
            style = {
                left: 0,
                top: defaultTop,
                bottom: 'auto',
            };
            break;
        case 'topRight':
            style = {
                right: 0,
                top: defaultTop,
                bottom: 'auto',
            };
            break;
        case 'bottomLeft':
            style = {
                left: 0,
                top: 'auto',
                bottom: defaultBottom,
            };
            break;
        default:
            style = {
                right: 0,
                top: 'auto',
                bottom: defaultBottom,
            };
            break;
    }
    return style;
}
function getNotificationInstance(prefixCls, placement, callback) {
    const cacheKey = `${prefixCls}-${placement}`;
    if (notificationInstance[cacheKey]) {
        callback(notificationInstance[cacheKey]);
        return;
    }
    Notification.newInstance({
        prefixCls,
        className: `${prefixCls}-${placement}`,
        style: getPlacementStyle(placement),
        getContainer: defaultGetContainer,
        closeIcon: React.createElement(Icon, { className: `${prefixCls}-close-icon`, type: "close" }),
    }, (notification) => {
        notificationInstance[cacheKey] = notification;
        callback(notification);
    });
}
const typeToIcon = {
    success: 'check',
    info: 'info',
    error: 'error',
    warning: 'warning',
};
function notice(args) {
    const outerPrefixCls = getPrefixCls('notification', args.prefixCls);
    const prefixCls = `${outerPrefixCls}-notice`;
    const duration = args.duration === undefined ? defaultDuration : args.duration;
    let iconNode = null;
    if (args.icon) {
        iconNode = React.createElement("span", { className: `${prefixCls}-icon` }, args.icon);
    }
    else if (args.type) {
        const iconType = typeToIcon[args.type];
        iconNode = (React.createElement(Icon, { className: `${prefixCls}-icon ${prefixCls}-icon-${args.type}`, type: iconType }));
    }
    const autoMarginTag = !args.description && iconNode ? (React.createElement("span", { className: `${prefixCls}-message-single-line-auto-margin` })) : null;
    getNotificationInstance(outerPrefixCls, args.placement || defaultPlacement, (notification) => {
        notification.notice({
            content: (React.createElement("div", { className: iconNode ? `${prefixCls}-with-icon` : '' },
                iconNode,
                React.createElement("div", { className: `${prefixCls}-message` },
                    autoMarginTag,
                    args.message),
                React.createElement("div", { className: `${prefixCls}-description` }, args.description),
                args.btn ? React.createElement("span", { className: `${prefixCls}-btn` }, args.btn) : null)),
            duration,
            closable: true,
            onClose: args.onClose,
            key: args.key,
            style: args.style || {},
            className: args.className,
        });
    });
}
const api = {
    open: notice,
    close(key) {
        Object.keys(notificationInstance).forEach(cacheKey => notificationInstance[cacheKey].removeNotice(key));
    },
    config: setNotificationConfig,
    destroy() {
        Object.keys(notificationInstance).forEach(cacheKey => {
            notificationInstance[cacheKey].destroy();
            delete notificationInstance[cacheKey];
        });
    },
};
['success', 'info', 'warning', 'error'].forEach(type => {
    api[type] = (args) => api.open({
        ...args,
        type,
    });
});
api.warn = api.warning;
export default api;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvbm90aWZpY2F0aW9uL2luZGV4LnRzeCIsIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQW1DLE1BQU0sT0FBTyxDQUFDO0FBQ3hELE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLFlBQVksTUFBTSwrQkFBK0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBTTVDLE1BQU0sb0JBQW9CLEdBQTJCLEVBQUUsQ0FBQztBQUN4RCxJQUFJLGVBQWUsR0FBRyxHQUFHLENBQUM7QUFDMUIsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO0FBQ3BCLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztBQUN2QixJQUFJLGdCQUFnQixHQUEwQixVQUFVLENBQUM7QUFDekQsSUFBSSxtQkFBc0MsQ0FBQztBQVUzQyxTQUFTLHFCQUFxQixDQUFDLE9BQW9CO0lBQ2pELE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFLEdBQUcsT0FBTyxDQUFDO0lBQ25FLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRTtRQUMxQixlQUFlLEdBQUcsUUFBUSxDQUFDO0tBQzVCO0lBQ0QsSUFBSSxTQUFTLEtBQUssU0FBUyxFQUFFO1FBQzNCLGdCQUFnQixHQUFHLFNBQVMsQ0FBQztLQUM5QjtJQUNELElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtRQUN4QixhQUFhLEdBQUcsTUFBTSxDQUFDO0tBQ3hCO0lBQ0QsSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFO1FBQ3JCLFVBQVUsR0FBRyxHQUFHLENBQUM7S0FDbEI7SUFDRCxJQUFJLFlBQVksS0FBSyxTQUFTLEVBQUU7UUFDOUIsbUJBQW1CLEdBQUcsWUFBWSxDQUFDO0tBQ3BDO0FBQ0gsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQUMsU0FBZ0M7SUFDekQsSUFBSSxLQUFLLENB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T0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQ25ELG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FDakQsQ0FBQztJQUNKLENBQUM7SUFDRCxNQUFNLEVBQUUscUJBQXFCO0lBQzdCLE9BQU87UUFDTCxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ25ELG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3pDLE9BQU8sb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YsQ0FBQztBQUVGLENBQUMsU0FBUyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3JELEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQWUsRUFBRSxFQUFFLENBQzlCLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDUCxHQUFHLElBQUk7UUFDUCxJQUFJO0tBQ0wsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUM7QUFFSCxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUM7QUFzQnZCLGVBQWUsR0FBc0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy9ub3RpZmljYXRpb24vaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDU1NQcm9wZXJ0aWVzLCBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgSWNvbiBmcm9tICcuLi9pY29uJztcbmltcG9ydCBOb3RpZmljYXRpb24gZnJvbSAnLi4vcmMtY29tcG9uZW50cy9ub3RpZmljYXRpb24nO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcblxuZXhwb3J0IHR5cGUgTm90aWZpY2F0aW9uUGxhY2VtZW50ID0gJ3RvcExlZnQnIHwgJ3RvcFJpZ2h0JyB8ICdib3R0b21MZWZ0JyB8ICdib3R0b21SaWdodCc7XG5cbmV4cG9ydCB0eXBlIEljb25UeXBlID0gJ3N1Y2Nlc3MnIHwgJ2luZm8nIHwgJ2Vycm9yJyB8ICd3YXJuaW5nJztcblxuY29uc3Qgbm90aWZpY2F0aW9uSW5zdGFuY2U6IHsgW2tleTogc3RyaW5nXTogYW55IH0gPSB7fTtcbmxldCBkZWZhdWx0RHVyYXRpb24gPSA0LjU7XG5sZXQgZGVmYXVsdFRvcCA9IDI0O1xubGV0IGRlZmF1bHRCb3R0b20gPSAyNDtcbmxldCBkZWZhdWx0UGxhY2VtZW50OiBOb3RpZmljYXRpb25QbGFjZW1lbnQgPSAndG9wUmlnaHQnO1xubGV0IGRlZmF1bHRHZXRDb250YWluZXI6ICgpID0+IEhUTUxFbGVtZW50O1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbmZpZ1Byb3BzIHtcbiAgdG9wPzogbnVtYmVyO1xuICBib3R0b20/OiBudW1iZXI7XG4gIGR1cmF0aW9uPzogbnVtYmVyO1xuICBwbGFjZW1lbnQ/OiBOb3RpZmljYXRpb25QbGFjZW1lbnQ7XG4gIGdldENvbnRhaW5lcj86ICgpID0+IEhUTUxFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBzZXROb3RpZmljYXRpb25Db25maWcob3B0aW9uczogQ29uZmlnUHJvcHMpIHtcbiAgY29uc3QgeyBkdXJhdGlvbiwgcGxhY2VtZW50LCBib3R0b20sIHRvcCwgZ2V0Q29udGFpbmVyIH0gPSBvcHRpb25zO1xuICBpZiAoZHVyYXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgIGRlZmF1bHREdXJhdGlvbiA9IGR1cmF0aW9uO1xuICB9XG4gIGlmIChwbGFjZW1lbnQgIT09IHVuZGVmaW5lZCkge1xuICAgIGRlZmF1bHRQbGFjZW1lbnQgPSBwbGFjZW1lbnQ7XG4gIH1cbiAgaWYgKGJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZGVmYXVsdEJvdHRvbSA9IGJvdHRvbTtcbiAgfVxuICBpZiAodG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICBkZWZhdWx0VG9wID0gdG9wO1xuICB9XG4gIGlmIChnZXRDb250YWluZXIgIT09IHVuZGVmaW5lZCkge1xuICAgIGRlZmF1bHRHZXRDb250YWluZXIgPSBnZXRDb250YWluZXI7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0UGxhY2VtZW50U3R5bGUocGxhY2VtZW50OiBOb3RpZmljYXRpb25QbGFjZW1lbnQpIHtcbiAgbGV0IHN0eWxlO1xuICBzd2l0Y2ggKHBsYWNlbWVudCkge1xuICAgIGNhc2UgJ3RvcExlZnQnOlxuICAgICAgc3R5bGUgPSB7XG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIHRvcDogZGVmYXVsdFRvcCxcbiAgICAgICAgYm90dG9tOiAnYXV0bycsXG4gICAgICB9O1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndG9wUmlnaHQnOlxuICAgICAgc3R5bGUgPSB7XG4gICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICB0b3A6IGRlZmF1bHRUb3AsXG4gICAgICAgIGJvdHRvbTogJ2F1dG8nLFxuICAgICAgfTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2JvdHRvbUxlZnQnOlxuICAgICAgc3R5bGUgPSB7XG4gICAgICAgIGxlZnQ6IDAsXG4gICAgICAgIHRvcDogJ2F1dG8nLFxuICAgICAgICBib3R0b206IGRlZmF1bHRCb3R0b20sXG4gICAgICB9O1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHN0eWxlID0ge1xuICAgICAgICByaWdodDogMCxcbiAgICAgICAgdG9wOiAnYXV0bycsXG4gICAgICAgIGJvdHRvbTogZGVmYXVsdEJvdHRvbSxcbiAgICAgIH07XG4gICAgICBicmVhaztcbiAgfVxuICByZXR1cm4gc3R5bGU7XG59XG5cbmZ1bmN0aW9uIGdldE5vdGlmaWNhdGlvbkluc3RhbmNlKFxuICBwcmVmaXhDbHM6IHN0cmluZyxcbiAgcGxhY2VtZW50OiBOb3RpZmljYXRpb25QbGFjZW1lbnQsXG4gIGNhbGxiYWNrOiAobjogYW55KSA9PiB2b2lkLFxuKSB7XG4gIGNvbnN0IGNhY2hlS2V5ID0gYCR7cHJlZml4Q2xzfS0ke3BsYWNlbWVudH1gO1xuICBpZiAobm90aWZpY2F0aW9uSW5zdGFuY2VbY2FjaGVLZXldKSB7XG4gICAgY2FsbGJhY2sobm90aWZpY2F0aW9uSW5zdGFuY2VbY2FjaGVLZXldKTtcbiAgICByZXR1cm47XG4gIH1cbiAgKE5vdGlmaWNhdGlvbiBhcyBhbnkpLm5ld0luc3RhbmNlKFxuICAgIHtcbiAgICAgIHByZWZpeENscyxcbiAgICAgIGNsYXNzTmFtZTogYCR7cHJlZml4Q2xzfS0ke3BsYWNlbWVudH1gLFxuICAgICAgc3R5bGU6IGdldFBsYWNlbWVudFN0eWxlKHBsYWNlbWVudCksXG4gICAgICBnZXRDb250YWluZXI6IGRlZmF1bHRHZXRDb250YWluZXIsXG4gICAgICBjbG9zZUljb246IDxJY29uIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1jbG9zZS1pY29uYH0gdHlwZT1cImNsb3NlXCIgLz4sXG4gICAgfSxcbiAgICAobm90aWZpY2F0aW9uOiBhbnkpID0+IHtcbiAgICAgIG5vdGlmaWNhdGlvbkluc3RhbmNlW2NhY2hlS2V5XSA9IG5vdGlmaWNhdGlvbjtcbiAgICAgIGNhbGxiYWNrKG5vdGlmaWNhdGlvbik7XG4gICAgfSxcbiAgKTtcbn1cblxuY29uc3QgdHlwZVRvSWNvbiA9IHtcbiAgc3VjY2VzczogJ2NoZWNrJyxcbiAgaW5mbzogJ2luZm8nLFxuICBlcnJvcjogJ2Vycm9yJyxcbiAgd2FybmluZzogJ3dhcm5pbmcnLFxufTtcblxuZXhwb3J0IGludGVyZmFjZSBBcmdzUHJvcHMge1xuICBtZXNzYWdlOiBSZWFjdE5vZGU7XG4gIGRlc2NyaXB0aW9uOiBSZWFjdE5vZGU7XG4gIGJ0bj86IFJlYWN0Tm9kZTtcbiAga2V5Pzogc3RyaW5nO1xuICBvbkNsb3NlPzogKCkgPT4gdm9pZDtcbiAgZHVyYXRpb24/OiBudW1iZXIgfCBudWxsO1xuICBpY29uPzogUmVhY3ROb2RlO1xuICBwbGFjZW1lbnQ/OiBOb3RpZmljYXRpb25QbGFjZW1lbnQ7XG4gIHN0eWxlPzogQ1NTUHJvcGVydGllcztcbiAgcHJlZml4Q2xzPzogc3RyaW5nO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIHJlYWRvbmx5IHR5cGU/OiBJY29uVHlwZTtcbn1cblxuZnVuY3Rpb24gbm90aWNlKGFyZ3M6IEFyZ3NQcm9wcykge1xuICBjb25zdCBvdXRlclByZWZpeENscyA9IGdldFByZWZpeENscygnbm90aWZpY2F0aW9uJywgYXJncy5wcmVmaXhDbHMpO1xuICBjb25zdCBwcmVmaXhDbHMgPSBgJHtvdXRlclByZWZpeENsc30tbm90aWNlYDtcbiAgY29uc3QgZHVyYXRpb24gPSBhcmdzLmR1cmF0aW9uID09PSB1bmRlZmluZWQgPyBkZWZhdWx0RHVyYXRpb24gOiBhcmdzLmR1cmF0aW9uO1xuXG4gIGxldCBpY29uTm9kZTogUmVhY3ROb2RlID0gbnVsbDtcbiAgaWYgKGFyZ3MuaWNvbikge1xuICAgIGljb25Ob2RlID0gPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWljb25gfT57YXJncy5pY29ufTwvc3Bhbj47XG4gIH0gZWxzZSBpZiAoYXJncy50eXBlKSB7XG4gICAgY29uc3QgaWNvblR5cGUgPSB0eXBlVG9JY29uW2FyZ3MudHlwZV07XG4gICAgaWNvbk5vZGUgPSAoXG4gICAgICA8SWNvbiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taWNvbiAke3ByZWZpeENsc30taWNvbi0ke2FyZ3MudHlwZX1gfSB0eXBlPXtpY29uVHlwZX0gLz5cbiAgICApO1xuICB9XG5cbiAgY29uc3QgYXV0b01hcmdpblRhZyA9XG4gICAgIWFyZ3MuZGVzY3JpcHRpb24gJiYgaWNvbk5vZGUgPyAoXG4gICAgICA8c3BhbiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tbWVzc2FnZS1zaW5nbGUtbGluZS1hdXRvLW1hcmdpbmB9IC8+XG4gICAgKSA6IG51bGw7XG5cbiAgZ2V0Tm90aWZpY2F0aW9uSW5zdGFuY2UoXG4gICAgb3V0ZXJQcmVmaXhDbHMsXG4gICAgYXJncy5wbGFjZW1lbnQgfHwgZGVmYXVsdFBsYWNlbWVudCxcbiAgICAobm90aWZpY2F0aW9uOiBhbnkpID0+IHtcbiAgICAgIG5vdGlmaWNhdGlvbi5ub3RpY2Uoe1xuICAgICAgICBjb250ZW50OiAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2ljb25Ob2RlID8gYCR7cHJlZml4Q2xzfS13aXRoLWljb25gIDogJyd9PlxuICAgICAgICAgICAge2ljb25Ob2RlfVxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tbWVzc2FnZWB9PlxuICAgICAgICAgICAgICB7YXV0b01hcmdpblRhZ31cbiAgICAgICAgICAgICAge2FyZ3MubWVzc2FnZX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tZGVzY3JpcHRpb25gfT57YXJncy5kZXNjcmlwdGlvbn08L2Rpdj5cbiAgICAgICAgICAgIHthcmdzLmJ0biA/IDxzcGFuIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1idG5gfT57YXJncy5idG59PC9zcGFuPiA6IG51bGx9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICksXG4gICAgICAgIGR1cmF0aW9uLFxuICAgICAgICBjbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgb25DbG9zZTogYXJncy5vbkNsb3NlLFxuICAgICAgICBrZXk6IGFyZ3Mua2V5LFxuICAgICAgICBzdHlsZTogYXJncy5zdHlsZSB8fCB7fSxcbiAgICAgICAgY2xhc3NOYW1lOiBhcmdzLmNsYXNzTmFtZSxcbiAgICAgIH0pO1xuICAgIH0sXG4gICk7XG59XG5cbmNvbnN0IGFwaTogYW55ID0ge1xuICBvcGVuOiBub3RpY2UsXG4gIGNsb3NlKGtleTogc3RyaW5nKSB7XG4gICAgT2JqZWN0LmtleXMobm90aWZpY2F0aW9uSW5zdGFuY2UpLmZvckVhY2goY2FjaGVLZXkgPT5cbiAgICAgIG5vdGlmaWNhdGlvbkluc3RhbmNlW2NhY2hlS2V5XS5yZW1vdmVOb3RpY2Uoa2V5KSxcbiAgICApO1xuICB9LFxuICBjb25maWc6IHNldE5vdGlmaWNhdGlvbkNvbmZpZyxcbiAgZGVzdHJveSgpIHtcbiAgICBPYmplY3Qua2V5cyhub3RpZmljYXRpb25JbnN0YW5jZSkuZm9yRWFjaChjYWNoZUtleSA9PiB7XG4gICAgICBub3RpZmljYXRpb25JbnN0YW5jZVtjYWNoZUtleV0uZGVzdHJveSgpO1xuICAgICAgZGVsZXRlIG5vdGlmaWNhdGlvbkluc3RhbmNlW2NhY2hlS2V5XTtcbiAgICB9KTtcbiAgfSxcbn07XG5cblsnc3VjY2VzcycsICdpbmZvJywgJ3dhcm5pbmcnLCAnZXJyb3InXS5mb3JFYWNoKHR5cGUgPT4ge1xuICBhcGlbdHlwZV0gPSAoYXJnczogQXJnc1Byb3BzKSA9PlxuICAgIGFwaS5vcGVuKHtcbiAgICAgIC4uLmFyZ3MsXG4gICAgICB0eXBlLFxuICAgIH0pO1xufSk7XG5cbmFwaS53YXJuID0gYXBpLndhcm5pbmc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTm90aWZpY2F0aW9uQXBpIHtcbiAgc3VjY2VzcyhhcmdzOiBBcmdzUHJvcHMpOiB2b2lkO1xuXG4gIGVycm9yKGFyZ3M6IEFyZ3NQcm9wcyk6IHZvaWQ7XG5cbiAgaW5mbyhhcmdzOiBBcmdzUHJvcHMpOiB2b2lkO1xuXG4gIHdhcm4oYXJnczogQXJnc1Byb3BzKTogdm9pZDtcblxuICB3YXJuaW5nKGFyZ3M6IEFyZ3NQcm9wcyk6IHZvaWQ7XG5cbiAgb3BlbihhcmdzOiBBcmdzUHJvcHMpOiB2b2lkO1xuXG4gIGNsb3NlKGtleTogc3RyaW5nKTogdm9pZDtcblxuICBjb25maWcob3B0aW9uczogQ29uZmlnUHJvcHMpOiB2b2lkO1xuXG4gIGRlc3Ryb3koKTogdm9pZDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXBpIGFzIE5vdGlmaWNhdGlvbkFwaTtcbiJdLCJ2ZXJzaW9uIjozfQ==