import { __decorate } from "tslib";
import React from 'react';
import { computed } from 'mobx';
import { observer } from 'mobx-react';
import classNames from 'classnames';
import omit from 'lodash/omit';
import ObserverCheckBox from '../check-box/CheckBox';
import { $l } from '../locale-context';
import ObserverTextField from '../text-field/TextField';
import Icon from '../icon';
import { getItemKey, Select } from '../select/Select';
import autobind from '../_util/autobind';
import { stopPropagation } from '../_util/EventManager';
import ViewComponent from '../core/ViewComponent';
let TransferList = class TransferList extends Select {
    get popup() {
        return true;
    }
    get header() {
        const { prefixCls, multiple, observableProps: { header }, } = this;
        if (multiple || header) {
            return (React.createElement("div", { className: `${prefixCls}-header` },
                this.getHeaderSelected(),
                header && React.createElement("span", { className: `${prefixCls}-header-title` }, header)));
        }
        return undefined;
    }
    get footer() {
        const { prefixCls, filteredOptions, observableProps: { footer }, } = this;
        if (footer) {
            return React.createElement("div", { className: `${prefixCls}-footer` }, footer(filteredOptions));
        }
        return undefined;
    }
    getOtherProps() {
        return omit(super.getOtherProps(), [
            'type',
            'autoComplete',
            'ref',
            'body',
            'footer',
            'header',
            'selected',
            'onChange',
            'onSelect',
            'onSelectAll',
            'onKeyDown',
        ]);
    }
    getObservableProps(props, context) {
        return {
            ...super.getObservableProps(props, context),
            header: props.header,
            footer: props.footer,
        };
    }
    getMenuPrefixCls() {
        return `${this.prefixCls}-content`;
    }
    handleSelectAllChange(value) {
        const { onSelectAll } = this.props;
        if (onSelectAll) {
            onSelectAll(value ? this.filteredOptions : []);
        }
    }
    handleClear() {
        this.setText(undefined);
    }
    getHeaderSelected() {
        const { filteredOptions: { length }, multiple, prefixCls, props: { selected: { length: selectedLength }, }, } = this;
        const selectedText = selectedLength ? `${selectedLength}/` : '';
        if (multiple) {
            return (React.createElement(ObserverCheckBox, { disabled: this.isDisabled(), onChange: this.handleSelectAllChange, onFocus: stopPropagation, checked: !!length && length === selectedLength, indeterminate: !!selectedLength && length !== selectedLength },
                React.createElement("span", { className: `${prefixCls}-header-selected` }, `${selectedText}${length}${$l('Transfer', 'items')}`)));
        }
    }
    getSearchField() {
        const { prefixCls } = this;
        return (React.createElement("div", { className: `${prefixCls}-body-search-wrapper` },
            React.createElement(ObserverTextField, { ref: this.elementReference, onInput: this.handleChange, onClear: this.handleClear, onKeyDown: this.handleKeyDown, suffix: React.createElement(Icon, { type: "search" }), clearButton: true })));
    }
    renderBody() {
        const { prefixCls, searchable, textField, valueField, props: { selected, onSelect }, } = this;
        const searchField = searchable && this.getSearchField();
        const classString = classNames(`${prefixCls}-body`, {
            [`${prefixCls}-body-with-search`]: searchable,
        });
        const selectedKeys = selected.map(record => getItemKey(record, record.get(textField), record.get(valueField)));
        return (React.createElement("div", { className: classString },
            searchField,
            React.createElement("div", { className: `${prefixCls}-content-wrapper`, onFocus: searchable ? stopPropagation : undefined }, this.getMenu({ selectedKeys, onClick: onSelect, focusable: !this.searchable }))));
    }
    getClassName() {
        const { prefixCls, header, footer } = this;
        return super.getClassName({
            [`${prefixCls}-with-header`]: header,
            [`${prefixCls}-with-footer`]: footer,
        });
    }
    removeLastValue() { }
    handleBlur(e) {
        ViewComponent.prototype.handleBlur.call(this, e);
    }
    render() {
        const { header, footer } = this;
        return (React.createElement("div", Object.assign({}, this.getOtherProps()),
            header,
            this.renderBody(),
            footer));
    }
};
__decorate([
    computed
], TransferList.prototype, "popup", null);
__decorate([
    computed
], TransferList.prototype, "header", null);
__decorate([
    computed
], TransferList.prototype, "footer", null);
__decorate([
    autobind
], TransferList.prototype, "handleSelectAllChange", null);
__decorate([
    autobind
], TransferList.prototype, "handleClear", null);
__decorate([
    autobind
], TransferList.prototype, "handleBlur", null);
TransferList = __decorate([
    observer
], TransferList);
export default TransferList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3RyYW5zZmVyL1RyYW5zZmVyTGlzdC50c3giLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBb0IsTUFBTSxPQUFPLENBQUM7QUFDekMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RDLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQUNwQyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxnQkFBZ0IsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFdkMsT0FBTyxpQkFBaUIsTUFBTSx5QkFBeUIsQ0FBQztBQUN4RCxPQUFPLElBQUksTUFBTSxTQUFTLENBQUM7QUFDM0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQWUsTUFBTSxrQkFBa0IsQ0FBQztBQUNuRSxPQUFPLFFBQVEsTUFBTSxtQkFBbUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxhQUFhLE1BQU0sdUJBQXVCLENBQUM7QUFXbEQsSUFBcUIsWUFBWSxHQUFqQyxNQUFxQixZQUFhLFNBQVEsTUFBeUI7SUFFakUsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBR0QsSUFBSSxNQUFNO1FBQ1IsTUFBTSxFQUNKLFNBQVMsRUFDVCxRQUFRLEVBQ1IsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQzVCLEdBQUcsSUFBSSxDQUFDO1FBQ1QsSUFBSSxRQUFRLElBQUksTUFBTSxFQUFFO1lBQ3RCLE9BQU8sQ0FDTCw2QkFBSyxTQUFTLEVBQUUsR0FBRyxTQUFTLFNBQVM7Z0JBQ2xDLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtnQkFDeEIsTUFBTSxJQUFJLDhC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Q1YsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQzNDLE9BQU8sS0FBSyxDQUFDLFlBQVksQ0FBQztZQUN4QixDQUFDLEdBQUcsU0FBUyxjQUFjLENBQUMsRUFBRSxNQUFNO1lBQ3BDLENBQUMsR0FBRyxTQUFTLGNBQWMsQ0FBQyxFQUFFLE1BQU07U0FDckMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGVBQWUsS0FBSSxDQUFDO0lBR3BCLFVBQVUsQ0FBQyxDQUFDO1FBQ1YsYUFBYSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLE9BQU8sQ0FDTCw2Q0FBUyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQzFCLE1BQU07WUFDTixJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2pCLE1BQU0sQ0FDSCxDQUNQLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQTtBQTVLQztJQURDLFFBQVE7eUNBR1I7QUFHRDtJQURDLFFBQVE7MENBZ0JSO0FBR0Q7SUFEQyxRQUFROzBDQVdSO0FBK0JEO0lBREMsUUFBUTt5REFNUjtBQUdEO0lBREMsUUFBUTsrQ0FHUjtBQW9GRDtJQURDLFFBQVE7OENBR1I7QUFsS2tCLFlBQVk7SUFEaEMsUUFBUTtHQUNZLFlBQVksQ0E4S2hDO2VBOUtvQixZQUFZIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby90cmFuc2Zlci9UcmFuc2Zlckxpc3QudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBjb21wdXRlZCB9IGZyb20gJ21vYngnO1xuaW1wb3J0IHsgb2JzZXJ2ZXIgfSBmcm9tICdtb2J4LXJlYWN0JztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IG9taXQgZnJvbSAnbG9kYXNoL29taXQnO1xuaW1wb3J0IE9ic2VydmVyQ2hlY2tCb3ggZnJvbSAnLi4vY2hlY2stYm94L0NoZWNrQm94JztcbmltcG9ydCB7ICRsIH0gZnJvbSAnLi4vbG9jYWxlLWNvbnRleHQnO1xuaW1wb3J0IFJlY29yZCBmcm9tICcuLi9kYXRhLXNldC9SZWNvcmQnO1xuaW1wb3J0IE9ic2VydmVyVGV4dEZpZWxkIGZyb20gJy4uL3RleHQtZmllbGQvVGV4dEZpZWxkJztcbmltcG9ydCBJY29uIGZyb20gJy4uL2ljb24nO1xuaW1wb3J0IHsgZ2V0SXRlbUtleSwgU2VsZWN0LCBTZWxlY3RQcm9wcyB9IGZyb20gJy4uL3NlbGVjdC9TZWxlY3QnO1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJy4uL191dGlsL2F1dG9iaW5kJztcbmltcG9ydCB7IHN0b3BQcm9wYWdhdGlvbiB9IGZyb20gJy4uL191dGlsL0V2ZW50TWFuYWdlcic7XG5pbXBvcnQgVmlld0NvbXBvbmVudCBmcm9tICcuLi9jb3JlL1ZpZXdDb21wb25lbnQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZmVyTGlzdFByb3BzIGV4dGVuZHMgU2VsZWN0UHJvcHMge1xuICBoZWFkZXI/OiBSZWFjdE5vZGU7XG4gIHNlbGVjdGVkOiBSZWNvcmRbXTtcbiAgZm9vdGVyPzogKG9wdGlvbnM6IFJlY29yZFtdKSA9PiBSZWFjdE5vZGU7XG4gIG9uU2VsZWN0OiAoZSkgPT4gdm9pZDtcbiAgb25TZWxlY3RBbGw6ICh2YWx1ZTogYW55KSA9PiB2b2lkO1xufVxuXG5Ab2JzZXJ2ZXJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRyYW5zZmVyTGlzdCBleHRlbmRzIFNlbGVjdDxUcmFuc2Zlckxpc3RQcm9wcz4ge1xuICBAY29tcHV0ZWRcbiAgZ2V0IHBvcHVwKCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBoZWFkZXIoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBtdWx0aXBsZSxcbiAgICAgIG9ic2VydmFibGVQcm9wczogeyBoZWFkZXIgfSxcbiAgICB9ID0gdGhpcztcbiAgICBpZiAobXVsdGlwbGUgfHwgaGVhZGVyKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1oZWFkZXJgfT5cbiAgICAgICAgICB7dGhpcy5nZXRIZWFkZXJTZWxlY3RlZCgpfVxuICAgICAgICAgIHtoZWFkZXIgJiYgPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWhlYWRlci10aXRsZWB9PntoZWFkZXJ9PC9zcGFuPn1cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBmb290ZXIoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBmaWx0ZXJlZE9wdGlvbnMsXG4gICAgICBvYnNlcnZhYmxlUHJvcHM6IHsgZm9vdGVyIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgaWYgKGZvb3Rlcikge1xuICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWZvb3RlcmB9Pntmb290ZXIoZmlsdGVyZWRPcHRpb25zKX08L2Rpdj47XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXRPdGhlclByb3BzKCkge1xuICAgIHJldHVybiBvbWl0KHN1cGVyLmdldE90aGVyUHJvcHMoKSwgW1xuICAgICAgJ3R5cGUnLFxuICAgICAgJ2F1dG9Db21wbGV0ZScsXG4gICAgICAncmVmJyxcbiAgICAgICdib2R5JyxcbiAgICAgICdmb290ZXInLFxuICAgICAgJ2hlYWRlcicsXG4gICAgICAnc2VsZWN0ZWQnLFxuICAgICAgJ29uQ2hhbmdlJyxcbiAgICAgICdvblNlbGVjdCcsXG4gICAgICAnb25TZWxlY3RBbGwnLFxuICAgICAgJ29uS2V5RG93bicsXG4gICAgXSk7XG4gIH1cblxuICBnZXRPYnNlcnZhYmxlUHJvcHMocHJvcHMsIGNvbnRleHQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3VwZXIuZ2V0T2JzZXJ2YWJsZVByb3BzKHByb3BzLCBjb250ZXh0KSxcbiAgICAgIGhlYWRlcjogcHJvcHMuaGVhZGVyLFxuICAgICAgZm9vdGVyOiBwcm9wcy5mb290ZXIsXG4gICAgfTtcbiAgfVxuXG4gIGdldE1lbnVQcmVmaXhDbHMoKSB7XG4gICAgcmV0dXJuIGAke3RoaXMucHJlZml4Q2xzfS1jb250ZW50YDtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVTZWxlY3RBbGxDaGFuZ2UodmFsdWUpIHtcbiAgICBjb25zdCB7IG9uU2VsZWN0QWxsIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChvblNlbGVjdEFsbCkge1xuICAgICAgb25TZWxlY3RBbGwodmFsdWUgPyB0aGlzLmZpbHRlcmVkT3B0aW9ucyA6IFtdKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlQ2xlYXIoKSB7XG4gICAgdGhpcy5zZXRUZXh0KHVuZGVmaW5lZCk7XG4gIH1cblxuICBnZXRIZWFkZXJTZWxlY3RlZCgpIHtcbiAgICBjb25zdCB7XG4gICAgICBmaWx0ZXJlZE9wdGlvbnM6IHsgbGVuZ3RoIH0sXG4gICAgICBtdWx0aXBsZSxcbiAgICAgIHByZWZpeENscyxcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIHNlbGVjdGVkOiB7IGxlbmd0aDogc2VsZWN0ZWRMZW5ndGggfSxcbiAgICAgIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3Qgc2VsZWN0ZWRUZXh0ID0gc2VsZWN0ZWRMZW5ndGggPyBgJHtzZWxlY3RlZExlbmd0aH0vYCA6ICcnO1xuICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPE9ic2VydmVyQ2hlY2tCb3hcbiAgICAgICAgICBkaXNhYmxlZD17dGhpcy5pc0Rpc2FibGVkKCl9XG4gICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlU2VsZWN0QWxsQ2hhbmdlfVxuICAgICAgICAgIG9uRm9jdXM9e3N0b3BQcm9wYWdhdGlvbn1cbiAgICAgICAgICBjaGVja2VkPXshIWxlbmd0aCAmJiBsZW5ndGggPT09IHNlbGVjdGVkTGVuZ3RofVxuICAgICAgICAgIGluZGV0ZXJtaW5hdGU9eyEhc2VsZWN0ZWRMZW5ndGggJiYgbGVuZ3RoICE9PSBzZWxlY3RlZExlbmd0aH1cbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1oZWFkZXItc2VsZWN0ZWRgfT5cbiAgICAgICAgICAgIHtgJHtzZWxlY3RlZFRleHR9JHtsZW5ndGh9JHskbCgnVHJhbnNmZXInLCAnaXRlbXMnKX1gfVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9PYnNlcnZlckNoZWNrQm94PlxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBnZXRTZWFyY2hGaWVsZCgpOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1ib2R5LXNlYXJjaC13cmFwcGVyYH0+XG4gICAgICAgIDxPYnNlcnZlclRleHRGaWVsZFxuICAgICAgICAgIHJlZj17dGhpcy5lbGVtZW50UmVmZXJlbmNlfVxuICAgICAgICAgIG9uSW5wdXQ9e3RoaXMuaGFuZGxlQ2hhbmdlfVxuICAgICAgICAgIG9uQ2xlYXI9e3RoaXMuaGFuZGxlQ2xlYXJ9XG4gICAgICAgICAgb25LZXlEb3duPXt0aGlzLmhhbmRsZUtleURvd259XG4gICAgICAgICAgc3VmZml4PXs8SWNvbiB0eXBlPVwic2VhcmNoXCIgLz59XG4gICAgICAgICAgY2xlYXJCdXR0b25cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJCb2R5KCk6IFJlYWN0Tm9kZSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgc2VhcmNoYWJsZSxcbiAgICAgIHRleHRGaWVsZCxcbiAgICAgIHZhbHVlRmllbGQsXG4gICAgICBwcm9wczogeyBzZWxlY3RlZCwgb25TZWxlY3QgfSxcbiAgICB9ID0gdGhpcztcbiAgICBjb25zdCBzZWFyY2hGaWVsZCA9IHNlYXJjaGFibGUgJiYgdGhpcy5nZXRTZWFyY2hGaWVsZCgpO1xuICAgIGNvbnN0IGNsYXNzU3RyaW5nID0gY2xhc3NOYW1lcyhgJHtwcmVmaXhDbHN9LWJvZHlgLCB7XG4gICAgICBbYCR7cHJlZml4Q2xzfS1ib2R5LXdpdGgtc2VhcmNoYF06IHNlYXJjaGFibGUsXG4gICAgfSk7XG4gICAgY29uc3Qgc2VsZWN0ZWRLZXlzID0gc2VsZWN0ZWQubWFwKHJlY29yZCA9PlxuICAgICAgZ2V0SXRlbUtleShyZWNvcmQsIHJlY29yZC5nZXQodGV4dEZpZWxkKSwgcmVjb3JkLmdldCh2YWx1ZUZpZWxkKSksXG4gICAgKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzU3RyaW5nfT5cbiAgICAgICAge3NlYXJjaEZpZWxkfVxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWNvbnRlbnQtd3JhcHBlcmB9XG4gICAgICAgICAgb25Gb2N1cz17c2VhcmNoYWJsZSA/IHN0b3BQcm9wYWdhdGlvbiA6IHVuZGVmaW5lZH1cbiAgICAgICAgPlxuICAgICAgICAgIHt0aGlzLmdldE1lbnUoeyBzZWxlY3RlZEtleXMsIG9uQ2xpY2s6IG9uU2VsZWN0LCBmb2N1c2FibGU6ICF0aGlzLnNlYXJjaGFibGUgfSl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIGdldENsYXNzTmFtZSgpIHtcbiAgICBjb25zdCB7IHByZWZpeENscywgaGVhZGVyLCBmb290ZXIgfSA9IHRoaXM7XG4gICAgcmV0dXJuIHN1cGVyLmdldENsYXNzTmFtZSh7XG4gICAgICBbYCR7cHJlZml4Q2xzfS13aXRoLWhlYWRlcmBdOiBoZWFkZXIsXG4gICAgICBbYCR7cHJlZml4Q2xzfS13aXRoLWZvb3RlcmBdOiBmb290ZXIsXG4gICAgfSk7XG4gIH1cblxuICByZW1vdmVMYXN0VmFsdWUoKSB7fVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVCbHVyKGUpIHtcbiAgICBWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5oYW5kbGVCbHVyLmNhbGwodGhpcywgZSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBoZWFkZXIsIGZvb3RlciB9ID0gdGhpcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiB7Li4udGhpcy5nZXRPdGhlclByb3BzKCl9PlxuICAgICAgICB7aGVhZGVyfVxuICAgICAgICB7dGhpcy5yZW5kZXJCb2R5KCl9XG4gICAgICAgIHtmb290ZXJ9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=