import { __decorate } from "tslib";
import React from 'react';
import PropTypes from 'prop-types';
import { action, computed, isArrayLike, observable, runInAction } from 'mobx';
import { observer } from 'mobx-react';
import omit from 'lodash/omit';
import flatten from 'lodash/flatten';
import KeyCode from 'choerodon-ui/lib/_util/KeyCode';
import { getConfig } from 'choerodon-ui/lib/configure';
import TriggerField from '../trigger-field/TriggerField';
import Icon from '../icon';
import Tabs from '../tabs';
import { $l } from '../locale-context';
import IconCategory from './IconCategory';
import autobind from '../_util/autobind';
import { stopEvent } from '../_util/EventManager';
const COLUMNS = 5;
let IconPicker = class IconPicker extends TriggerField {
    constructor(props, context) {
        super(props, context);
        runInAction(() => {
            this.categoryPages = {};
            this.activeCategory = this.categoryKeys[0];
        });
    }
    get categories() {
        const icons = getConfig('icons');
        return isArrayLike(icons) ? { default: icons } : icons;
    }
    get categoryKeys() {
        return Object.keys(this.categories);
    }
    get selectedIndex() {
        return this.categories[this.activeCategory].indexOf(this.selectedIcon);
    }
    get filteredIcons() {
        const { text, categories } = this;
        if (text) {
            return flatten(this.categoryKeys.map(category => categories[category].filter(icon => icon.startsWith(text))));
        }
        return [];
    }
    get selectedIcon() {
        const { categories } = this;
        return this.selected || this.getValue() || categories[this.activeCategory][0];
    }
    getOtherProps() {
        return omit(super.getOtherProps(), ['pageSize']);
    }
    setActiveCategory(category) {
        this.activeCategory = category;
        const page = this.categoryPages[category];
        this.changeSelected(this.categories[category][(page - 1) * this.props.pageSize]);
    }
    setCategoryPage(page, category) {
        this.categoryPages[category] = page;
        this.changeSelected(this.categories[category][(page - 1) * this.props.pageSize]);
    }
    handleTabsChange(category) {
        this.setActiveCategory(category);
    }
    handleItemSelect(icon) {
        this.choose(icon);
    }
    handlePageChange(page, category) {
        this.setCategoryPage(page, category);
    }
    handleKeyDown(e) {
        if (!this.isDisabled() && !this.isReadOnly()) {
            if (this.popup) {
                switch (e.keyCode) {
                    case KeyCode.RIGHT:
                        stopEvent(e);
                        this.handleKeyDownRight();
                        break;
                    case KeyCode.LEFT:
                        stopEvent(e);
                        this.handleKeyDownLeft();
                        break;
                    case KeyCode.DOWN:
                        stopEvent(e);
                        this.handleKeyDownDown();
                        break;
                    case KeyCode.UP:
                        stopEvent(e);
                        this.handleKeyDownUp();
                        break;
                    case KeyCode.END:
                        stopEvent(e);
                        this.handleKeyDownEnd();
                        break;
                    case KeyCode.HOME:
                        stopEvent(e);
                        this.handleKeyDownHome();
                        break;
                    case KeyCode.PAGE_UP:
                        stopEvent(e);
                        this.handleKeyDownPageUp();
                        break;
                    case KeyCode.PAGE_DOWN:
                        stopEvent(e);
                        this.handleKeyDownPageDown();
                        break;
                    case KeyCode.ENTER:
                        e.preventDefault();
                        this.handleKeyDownEnter();
                        break;
                    case KeyCode.TAB:
                        this.handleKeyDownTab();
                        break;
                    case KeyCode.ESC:
                        e.preventDefault();
                        this.handleKeyDownEsc();
                        break;
                    default:
                }
            }
            else if (e.keyCode === KeyCode.SPACE) {
                e.preventDefault();
                this.handleKeyDownSpace();
            }
        }
        super.handleKeyDown(e);
    }
    handleKeyDownHome() {
        const { activeCategory, categoryPages, props: { pageSize }, } = this;
        const category = this.categories[activeCategory];
        const page = categoryPages[activeCategory] || 1;
        this.changeSelected(category[(page - 1) * pageSize]);
    }
    handleKeyDownEnd() {
        const { activeCategory, categoryPages, props: { pageSize }, } = this;
        const category = this.categories[activeCategory];
        const page = categoryPages[activeCategory] || 1;
        this.changeSelected(category[page * pageSize - 1] || category[category.length - 1]);
    }
    handleKeyDownLeftOrRight(isLeft) {
        const { activeCategory, selectedIndex, categoryPages, categories, categoryKeys, props: { pageSize }, } = this;
        const step = isLeft ? -1 : 1;
        let category = categories[activeCategory];
        let index = selectedIndex;
        if (index % COLUMNS === (isLeft ? 0 : COLUMNS - 1) ||
            (!isLeft && index === category.length - 1)) {
            const activeCategoryIndex = categoryKeys.indexOf(activeCategory);
            if (activeCategoryIndex !== (isLeft ? 0 : categoryKeys.length - 1)) {
                const newTabIndex = activeCategoryIndex + step;
                const newKey = categoryKeys[newTabIndex];
                this.setActiveCategory(newKey);
                const page = categoryPages[activeCategory] || 1;
                category = categories[newKey];
                const newPage = categoryPages[newKey] || 1;
                index += (newPage - page) * pageSize;
                if (!category[index]) {
                    index = isLeft ? category.length - 1 : (newPage - 1) * pageSize;
                }
            }
        }
        else {
            index += step;
        }
        if (category[index]) {
            this.changeSelected(category[index]);
        }
    }
    handleKeyDownUpOrDown(isUP) {
        const { activeCategory, selectedIndex, categoryPages, props: { pageSize }, } = this;
        const step = isUP ? -1 : 1;
        const category = this.categories[activeCategory];
        let index = selectedIndex;
        const page = categoryPages[activeCategory] || 1;
        if (isUP
            ? index < (page - 1) * pageSize + COLUMNS && page > 1
            : index > page * pageSize - COLUMNS && page < Math.ceil(category.length / pageSize)) {
            this.setCategoryPage(page + step, activeCategory);
        }
        index += step * COLUMNS;
        if (category[index]) {
            this.changeSelected(category[index]);
        }
    }
    handleKeyDownLeft() {
        this.handleKeyDownLeftOrRight(true);
    }
    handleKeyDownRight() {
        this.handleKeyDownLeftOrRight(false);
    }
    handleKeyDownUp() {
        this.handleKeyDownUpOrDown(true);
    }
    handleKeyDownDown() {
        if (this.popup) {
            this.handleKeyDownUpOrDown(false);
        }
        else {
            this.expand();
        }
    }
    handleKeyDownPageUp() {
        const { activeCategory, selectedIndex, categoryPages, props: { pageSize }, } = this;
        const page = categoryPages[activeCategory] || 1;
        const category = this.categories[activeCategory];
        if (page > 1) {
            this.setCategoryPage(page - 1, activeCategory);
            this.changeSelected(category[selectedIndex - pageSize]);
        }
    }
    handleKeyDownPageDown() {
        const { activeCategory, selectedIndex, categoryPages, props: { pageSize }, } = this;
        const page = categoryPages[activeCategory] || 1;
        const category = this.categories[activeCategory];
        if (page < Math.ceil(category.length / pageSize)) {
            this.setCategoryPage(page + 1, activeCategory);
            this.changeSelected(category[selectedIndex + pageSize] || category[category.length - 1]);
        }
    }
    handleKeyDownEnter() {
        this.choose(this.selectedIcon);
    }
    handleKeyDownEsc() {
        this.collapse();
    }
    handleKeyDownTab() {
        this.collapse();
    }
    handleKeyDownSpace() {
        this.expand();
    }
    changeSelected(selected) {
        this.selected = selected;
    }
    choose(icon) {
        this.prepareSetValue(icon);
        this.changeSelected(icon);
        if (!this.multiple) {
            this.collapse();
        }
    }
    syncValueOnBlur(value) {
        if (this.filteredIcons.indexOf(value) !== -1) {
            this.choose(value);
        }
        else {
            this.setText(undefined);
        }
    }
    handlePopupAnimateAppear() { }
    handlePopupAnimateEnd() { }
    getPopupStyleFromAlign() {
        return undefined;
    }
    getTriggerIconFont() {
        return 'developer_board';
    }
    getPopupContent() {
        const { text } = this;
        if (text) {
            return this.renderFilteredIcons();
        }
        return this.renderIconCategories();
    }
    getPrefix() {
        const value = this.getValue();
        if (value) {
            return this.wrapperPrefix(React.createElement(Icon, { type: value }));
        }
    }
    renderFilteredIcons() {
        const { prefixCls } = this;
        return (React.createElement("div", { className: `${prefixCls}-single-tab` },
            React.createElement(IconCategory, { paging: false, value: this.selectedIcon, icons: this.filteredIcons, prefixCls: prefixCls, onSelect: this.handleItemSelect })));
    }
    renderIconCategories() {
        const { activeCategory, prefixCls, props: { pageSize }, categories, categoryKeys, categoryPages, } = this;
        const { TabPane } = Tabs;
        if (categoryKeys.length > 1) {
            const tabs = categoryKeys.map(category => (React.createElement(TabPane, { key: category, tab: $l('Icon', category), className: `${prefixCls}-tab` },
                React.createElement(IconCategory, { page: categoryPages[category], pageSize: pageSize, category: category, value: category === activeCategory ? this.selectedIcon : undefined, icons: categories[category], prefixCls: prefixCls, onSelect: this.handleItemSelect, onPageChange: this.handlePageChange }))));
            return (React.createElement("div", null,
                React.createElement(Tabs, { onChange: this.handleTabsChange, activeKey: activeCategory }, tabs)));
        }
        const category = categoryKeys[0];
        return (React.createElement("div", { className: `${prefixCls}-single-tab` },
            React.createElement(IconCategory, { page: categoryPages[category], pageSize: pageSize, category: category, value: category === activeCategory ? this.selectedIcon : undefined, icons: categories[category], prefixCls: prefixCls, onSelect: this.handleItemSelect, onPageChange: this.handlePageChange })));
    }
};
IconPicker.displayName = 'IconPicker';
IconPicker.propTypes = {
    ...TriggerField.propTypes,
    pageSize: PropTypes.number,
};
IconPicker.defaultProps = {
    ...TriggerField.defaultProps,
    suffixCls: 'icon-picker',
    pageSize: 100,
};
__decorate([
    observable
], IconPicker.prototype, "activeCategory", void 0);
__decorate([
    observable
], IconPicker.prototype, "selected", void 0);
__decorate([
    observable
], IconPicker.prototype, "categoryPages", void 0);
__decorate([
    computed
], IconPicker.prototype, "categories", null);
__decorate([
    computed
], IconPicker.prototype, "categoryKeys", null);
__decorate([
    computed
], IconPicker.prototype, "selectedIndex", null);
__decorate([
    computed
], IconPicker.prototype, "filteredIcons", null);
__decorate([
    computed
], IconPicker.prototype, "selectedIcon", null);
__decorate([
    action
], IconPicker.prototype, "setActiveCategory", null);
__decorate([
    action
], IconPicker.prototype, "setCategoryPage", null);
__decorate([
    autobind
], IconPicker.prototype, "handleTabsChange", null);
__decorate([
    autobind
], IconPicker.prototype, "handleItemSelect", null);
__decorate([
    autobind
], IconPicker.prototype, "handlePageChange", null);
__decorate([
    autobind
], IconPicker.prototype, "handleKeyDown", null);
__decorate([
    action
], IconPicker.prototype, "changeSelected", null);
IconPicker = __decorate([
    observer
], IconPicker);
export default IconPicker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL2ljb24tcGlja2VyL0ljb25QaWNrZXIudHN4IiwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEtBQW1DLE1BQU0sT0FBTyxDQUFDO0FBQ3hELE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQztBQUNuQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5RSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RDLE9BQU8sSUFBSSxNQUFNLGFBQWEsQ0FBQztBQUMvQixPQUFPLE9BQU8sTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLE9BQU8sTUFBTSxnQ0FBZ0MsQ0FBQztBQUNyRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDdkQsT0FBTyxZQUFtQyxNQUFNLCtCQUErQixDQUFDO0FBQ2hGLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLElBQUksTUFBTSxTQUFTLENBQUM7QUFDM0IsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sWUFBWSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sUUFBUSxNQUFNLG1CQUFtQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVsRCxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUM7QUFPbEIsSUFBcUIsVUFBVSxHQUEvQixNQUFxQixVQUFXLFNBQVEsWUFBNkI7SUF1RG5FLFlBQVksS0FBSyxFQUFFLE9BQU87UUFDeEIsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN0QixXQUFXLENBQUMsR0FBRyxFQUFFO1lBQ2YsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFD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QUFDLFlBQVk7SUFDNUIsU0FBUyxFQUFFLGFBQWE7SUFDeEIsUUFBUSxFQUFFLEdBQUc7Q0FDZCxDQUFDO0FBRVU7SUFBWCxVQUFVO2tEQUF3QjtBQUV2QjtJQUFYLFVBQVU7NENBQW1CO0FBRWxCO0lBQVgsVUFBVTtpREFBMEM7QUFHckQ7SUFEQyxRQUFROzRDQUlSO0FBR0Q7SUFEQyxRQUFROzhDQUdSO0FBR0Q7SUFEQyxRQUFROytDQUdSO0FBR0Q7SUFEQyxRQUFROytDQVdSO0FBR0Q7SUFEQyxRQUFROzhDQUlSO0FBZUQ7SUFEQyxNQUFNO21EQUtOO0FBR0Q7SUFEQyxNQUFNO2lEQUlOO0FBR0Q7SUFEQyxRQUFRO2tEQUdSO0FBR0Q7SUFEQyxRQUFRO2tEQUdSO0FBR0Q7SUFEQyxRQUFRO2tEQUdSO0FBR0Q7SUFEQyxRQUFROytDQXdEUjtBQXdKRDtJQURDLE1BQU07Z0RBR047QUFqVGtCLFVBQVU7SUFEOUIsUUFBUTtHQUNZLFVBQVUsQ0E4WjlCO2VBOVpvQixVQUFVIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby9pY29uLXBpY2tlci9JY29uUGlja2VyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ1NTUHJvcGVydGllcywgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGFjdGlvbiwgY29tcHV0ZWQsIGlzQXJyYXlMaWtlLCBvYnNlcnZhYmxlLCBydW5JbkFjdGlvbiB9IGZyb20gJ21vYngnO1xuaW1wb3J0IHsgb2JzZXJ2ZXIgfSBmcm9tICdtb2J4LXJlYWN0JztcbmltcG9ydCBvbWl0IGZyb20gJ2xvZGFzaC9vbWl0JztcbmltcG9ydCBmbGF0dGVuIGZyb20gJ2xvZGFzaC9mbGF0dGVuJztcbmltcG9ydCBLZXlDb2RlIGZyb20gJ2Nob2Vyb2Rvbi11aS9saWIvX3V0aWwvS2V5Q29kZSc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICdjaG9lcm9kb24tdWkvbGliL2NvbmZpZ3VyZSc7XG5pbXBvcnQgVHJpZ2dlckZpZWxkLCB7IFRyaWdnZXJGaWVsZFByb3BzIH0gZnJvbSAnLi4vdHJpZ2dlci1maWVsZC9UcmlnZ2VyRmllbGQnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgVGFicyBmcm9tICcuLi90YWJzJztcbmltcG9ydCB7ICRsIH0gZnJvbSAnLi4vbG9jYWxlLWNvbnRleHQnO1xuaW1wb3J0IEljb25DYXRlZ29yeSBmcm9tICcuL0ljb25DYXRlZ29yeSc7XG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnLi4vX3V0aWwvYXV0b2JpbmQnO1xuaW1wb3J0IHsgc3RvcEV2ZW50IH0gZnJvbSAnLi4vX3V0aWwvRXZlbnRNYW5hZ2VyJztcblxuY29uc3QgQ09MVU1OUyA9IDU7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSWNvblBpY2tlclByb3BzIGV4dGVuZHMgVHJpZ2dlckZpZWxkUHJvcHMge1xuICBwYWdlU2l6ZT86IG51bWJlcjtcbn1cblxuQG9ic2VydmVyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJY29uUGlja2VyIGV4dGVuZHMgVHJpZ2dlckZpZWxkPEljb25QaWNrZXJQcm9wcz4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnSWNvblBpY2tlcic7XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAuLi5UcmlnZ2VyRmllbGQucHJvcFR5cGVzLFxuICAgIHBhZ2VTaXplOiBQcm9wVHlwZXMubnVtYmVyLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgLi4uVHJpZ2dlckZpZWxkLmRlZmF1bHRQcm9wcyxcbiAgICBzdWZmaXhDbHM6ICdpY29uLXBpY2tlcicsXG4gICAgcGFnZVNpemU6IDEwMCxcbiAgfTtcblxuICBAb2JzZXJ2YWJsZSBhY3RpdmVDYXRlZ29yeTogc3RyaW5nO1xuXG4gIEBvYnNlcnZhYmxlIHNlbGVjdGVkPzogc3RyaW5nO1xuXG4gIEBvYnNlcnZhYmxlIGNhdGVnb3J5UGFnZXM6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH07XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBjYXRlZ29yaWVzKCk6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nW10gfSB7XG4gICAgY29uc3QgaWNvbnMgPSBnZXRDb25maWcoJ2ljb25zJyk7XG4gICAgcmV0dXJuIGlzQXJyYXlMaWtlKGljb25zKSA/IHsgZGVmYXVsdDogaWNvbnMgfSA6IGljb25zO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBjYXRlZ29yeUtleXMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLmNhdGVnb3JpZXMpO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBzZWxlY3RlZEluZGV4KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuY2F0ZWdvcmllc1t0aGlzLmFjdGl2ZUNhdGVnb3J5XS5pbmRleE9mKHRoaXMuc2VsZWN0ZWRJY29uKTtcbiAgfVxuXG4gIEBjb21wdXRlZFxuICBnZXQgZmlsdGVyZWRJY29ucygpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgeyB0ZXh0LCBjYXRlZ29yaWVzIH0gPSB0aGlzO1xuICAgIGlmICh0ZXh0KSB7XG4gICAgICByZXR1cm4gZmxhdHRlbihcbiAgICAgICAgdGhpcy5jYXRlZ29yeUtleXMubWFwKGNhdGVnb3J5ID0+XG4gICAgICAgICAgY2F0ZWdvcmllc1tjYXRlZ29yeV0uZmlsdGVyKGljb24gPT4gaWNvbi5zdGFydHNXaXRoKHRleHQpKSxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIEBjb21wdXRlZFxuICBnZXQgc2VsZWN0ZWRJY29uKCkge1xuICAgIGNvbnN0IHsgY2F0ZWdvcmllcyB9ID0gdGhpcztcbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZCB8fCB0aGlzLmdldFZhbHVlKCkgfHwgY2F0ZWdvcmllc1t0aGlzLmFjdGl2ZUNhdGVnb3J5XVswXTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzLCBjb250ZXh0KSB7XG4gICAgc3VwZXIocHJvcHMsIGNvbnRleHQpO1xuICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcbiAgICAgIHRoaXMuY2F0ZWdvcnlQYWdlcyA9IHt9O1xuICAgICAgdGhpcy5hY3RpdmVDYXRlZ29yeSA9IHRoaXMuY2F0ZWdvcnlLZXlzWzBdO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0T3RoZXJQcm9wcygpIHtcbiAgICByZXR1cm4gb21pdChzdXBlci5nZXRPdGhlclByb3BzKCksIFsncGFnZVNpemUnXSk7XG4gIH1cblxuICBAYWN0aW9uXG4gIHNldEFjdGl2ZUNhdGVnb3J5KGNhdGVnb3J5OiBzdHJpbmcpIHtcbiAgICB0aGlzLmFjdGl2ZUNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgY29uc3QgcGFnZSA9IHRoaXMuY2F0ZWdvcnlQYWdlc1tjYXRlZ29yeV07XG4gICAgdGhpcy5jaGFuZ2VTZWxlY3RlZCh0aGlzLmNhdGVnb3JpZXNbY2F0ZWdvcnldWyhwYWdlIC0gMSkgKiB0aGlzLnByb3BzLnBhZ2VTaXplIV0pO1xuICB9XG5cbiAgQGFjdGlvblxuICBzZXRDYXRlZ29yeVBhZ2UocGFnZTogbnVtYmVyLCBjYXRlZ29yeTogc3RyaW5nKSB7XG4gICAgdGhpcy5jYXRlZ29yeVBhZ2VzW2NhdGVnb3J5XSA9IHBhZ2U7XG4gICAgdGhpcy5jaGFuZ2VTZWxlY3RlZCh0aGlzLmNhdGVnb3JpZXNbY2F0ZWdvcnldWyhwYWdlIC0gMSkgKiB0aGlzLnByb3BzLnBhZ2VTaXplIV0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGhhbmRsZVRhYnNDaGFuZ2UoY2F0ZWdvcnk6IHN0cmluZykge1xuICAgIHRoaXMuc2V0QWN0aXZlQ2F0ZWdvcnkoY2F0ZWdvcnkpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGhhbmRsZUl0ZW1TZWxlY3QoaWNvbjogc3RyaW5nKSB7XG4gICAgdGhpcy5jaG9vc2UoaWNvbik7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlUGFnZUNoYW5nZShwYWdlOiBudW1iZXIsIGNhdGVnb3J5OiBzdHJpbmcpIHtcbiAgICB0aGlzLnNldENhdGVnb3J5UGFnZShwYWdlLCBjYXRlZ29yeSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlS2V5RG93bihlKSB7XG4gICAgaWYgKCF0aGlzLmlzRGlzYWJsZWQoKSAmJiAhdGhpcy5pc1JlYWRPbmx5KCkpIHtcbiAgICAgIGlmICh0aGlzLnBvcHVwKSB7XG4gICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLlJJR0hUOlxuICAgICAgICAgICAgc3RvcEV2ZW50KGUpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVLZXlEb3duUmlnaHQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgS2V5Q29kZS5MRUZUOlxuICAgICAgICAgICAgc3RvcEV2ZW50KGUpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVLZXlEb3duTGVmdCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLkRPV046XG4gICAgICAgICAgICBzdG9wRXZlbnQoZSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUtleURvd25Eb3duKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEtleUNvZGUuVVA6XG4gICAgICAgICAgICBzdG9wRXZlbnQoZSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUtleURvd25VcCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLkVORDpcbiAgICAgICAgICAgIHN0b3BFdmVudChlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlS2V5RG93bkVuZCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLkhPTUU6XG4gICAgICAgICAgICBzdG9wRXZlbnQoZSk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUtleURvd25Ib21lKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEtleUNvZGUuUEFHRV9VUDpcbiAgICAgICAgICAgIHN0b3BFdmVudChlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlS2V5RG93blBhZ2VVcCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLlBBR0VfRE9XTjpcbiAgICAgICAgICAgIHN0b3BFdmVudChlKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlS2V5RG93blBhZ2VEb3duKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEtleUNvZGUuRU5URVI6XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUtleURvd25FbnRlcigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLlRBQjpcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlS2V5RG93blRhYigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBLZXlDb2RlLkVTQzpcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlS2V5RG93bkVzYygpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IEtleUNvZGUuU1BBQ0UpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLmhhbmRsZUtleURvd25TcGFjZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBzdXBlci5oYW5kbGVLZXlEb3duKGUpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93bkhvbWUoKSB7XG4gICAgY29uc3Qge1xuICAgICAgYWN0aXZlQ2F0ZWdvcnksXG4gICAgICBjYXRlZ29yeVBhZ2VzLFxuICAgICAgcHJvcHM6IHsgcGFnZVNpemUgfSxcbiAgICB9ID0gdGhpcztcbiAgICBjb25zdCBjYXRlZ29yeSA9IHRoaXMuY2F0ZWdvcmllc1thY3RpdmVDYXRlZ29yeV07XG4gICAgY29uc3QgcGFnZSA9IGNhdGVnb3J5UGFnZXNbYWN0aXZlQ2F0ZWdvcnldIHx8IDE7XG4gICAgdGhpcy5jaGFuZ2VTZWxlY3RlZChjYXRlZ29yeVsocGFnZSAtIDEpICogcGFnZVNpemUhXSk7XG4gIH1cblxuICBoYW5kbGVLZXlEb3duRW5kKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGFjdGl2ZUNhdGVnb3J5LFxuICAgICAgY2F0ZWdvcnlQYWdlcyxcbiAgICAgIHByb3BzOiB7IHBhZ2VTaXplIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3QgY2F0ZWdvcnkgPSB0aGlzLmNhdGVnb3JpZXNbYWN0aXZlQ2F0ZWdvcnldO1xuICAgIGNvbnN0IHBhZ2UgPSBjYXRlZ29yeVBhZ2VzW2FjdGl2ZUNhdGVnb3J5XSB8fCAxO1xuICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWQoY2F0ZWdvcnlbcGFnZSAqIHBhZ2VTaXplISAtIDFdIHx8IGNhdGVnb3J5W2NhdGVnb3J5Lmxlbmd0aCAtIDFdKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25MZWZ0T3JSaWdodChpc0xlZnQ6IGJvb2xlYW4pIHtcbiAgICBjb25zdCB7XG4gICAgICBhY3RpdmVDYXRlZ29yeSxcbiAgICAgIHNlbGVjdGVkSW5kZXgsXG4gICAgICBjYXRlZ29yeVBhZ2VzLFxuICAgICAgY2F0ZWdvcmllcyxcbiAgICAgIGNhdGVnb3J5S2V5cyxcbiAgICAgIHByb3BzOiB7IHBhZ2VTaXplIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3Qgc3RlcCA9IGlzTGVmdCA/IC0xIDogMTtcbiAgICBsZXQgY2F0ZWdvcnkgPSBjYXRlZ29yaWVzW2FjdGl2ZUNhdGVnb3J5XTtcbiAgICBsZXQgaW5kZXggPSBzZWxlY3RlZEluZGV4O1xuICAgIGlmIChcbiAgICAgIGluZGV4ICUgQ09MVU1OUyA9PT0gKGlzTGVmdCA/IDAgOiBDT0xVTU5TIC0gMSkgfHxcbiAgICAgICghaXNMZWZ0ICYmIGluZGV4ID09PSBjYXRlZ29yeS5sZW5ndGggLSAxKVxuICAgICkge1xuICAgICAgY29uc3QgYWN0aXZlQ2F0ZWdvcnlJbmRleCA9IGNhdGVnb3J5S2V5cy5pbmRleE9mKGFjdGl2ZUNhdGVnb3J5KTtcbiAgICAgIGlmIChhY3RpdmVDYXRlZ29yeUluZGV4ICE9PSAoaXNMZWZ0ID8gMCA6IGNhdGVnb3J5S2V5cy5sZW5ndGggLSAxKSkge1xuICAgICAgICBjb25zdCBuZXdUYWJJbmRleCA9IGFjdGl2ZUNhdGVnb3J5SW5kZXggKyBzdGVwO1xuICAgICAgICBjb25zdCBuZXdLZXkgPSBjYXRlZ29yeUtleXNbbmV3VGFiSW5kZXhdO1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUNhdGVnb3J5KG5ld0tleSk7XG4gICAgICAgIGNvbnN0IHBhZ2UgPSBjYXRlZ29yeVBhZ2VzW2FjdGl2ZUNhdGVnb3J5XSB8fCAxO1xuICAgICAgICBjYXRlZ29yeSA9IGNhdGVnb3JpZXNbbmV3S2V5XTtcbiAgICAgICAgY29uc3QgbmV3UGFnZSA9IGNhdGVnb3J5UGFnZXNbbmV3S2V5XSB8fCAxO1xuICAgICAgICBpbmRleCArPSAobmV3UGFnZSAtIHBhZ2UpICogcGFnZVNpemUhO1xuICAgICAgICBpZiAoIWNhdGVnb3J5W2luZGV4XSkge1xuICAgICAgICAgIGluZGV4ID0gaXNMZWZ0ID8gY2F0ZWdvcnkubGVuZ3RoIC0gMSA6IChuZXdQYWdlIC0gMSkgKiBwYWdlU2l6ZSE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaW5kZXggKz0gc3RlcDtcbiAgICB9XG4gICAgaWYgKGNhdGVnb3J5W2luZGV4XSkge1xuICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZChjYXRlZ29yeVtpbmRleF0pO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUtleURvd25VcE9yRG93bihpc1VQKSB7XG4gICAgY29uc3Qge1xuICAgICAgYWN0aXZlQ2F0ZWdvcnksXG4gICAgICBzZWxlY3RlZEluZGV4LFxuICAgICAgY2F0ZWdvcnlQYWdlcyxcbiAgICAgIHByb3BzOiB7IHBhZ2VTaXplIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3Qgc3RlcCA9IGlzVVAgPyAtMSA6IDE7XG4gICAgY29uc3QgY2F0ZWdvcnkgPSB0aGlzLmNhdGVnb3JpZXNbYWN0aXZlQ2F0ZWdvcnldO1xuICAgIGxldCBpbmRleCA9IHNlbGVjdGVkSW5kZXg7XG4gICAgY29uc3QgcGFnZSA9IGNhdGVnb3J5UGFnZXNbYWN0aXZlQ2F0ZWdvcnldIHx8IDE7XG4gICAgaWYgKFxuICAgICAgaXNVUFxuICAgICAgICA/IGluZGV4IDwgKHBhZ2UgLSAxKSAqIHBhZ2VTaXplISArIENPTFVNTlMgJiYgcGFnZSA+IDFcbiAgICAgICAgOiBpbmRleCA+IHBhZ2UgKiBwYWdlU2l6ZSEgLSBDT0xVTU5TICYmIHBhZ2UgPCBNYXRoLmNlaWwoY2F0ZWdvcnkubGVuZ3RoIC8gcGFnZVNpemUhKVxuICAgICkge1xuICAgICAgdGhpcy5zZXRDYXRlZ29yeVBhZ2UocGFnZSArIHN0ZXAsIGFjdGl2ZUNhdGVnb3J5KTtcbiAgICB9XG4gICAgaW5kZXggKz0gc3RlcCAqIENPTFVNTlM7XG4gICAgaWYgKGNhdGVnb3J5W2luZGV4XSkge1xuICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZChjYXRlZ29yeVtpbmRleF0pO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUtleURvd25MZWZ0KCkge1xuICAgIHRoaXMuaGFuZGxlS2V5RG93bkxlZnRPclJpZ2h0KHRydWUpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93blJpZ2h0KCkge1xuICAgIHRoaXMuaGFuZGxlS2V5RG93bkxlZnRPclJpZ2h0KGZhbHNlKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25VcCgpIHtcbiAgICB0aGlzLmhhbmRsZUtleURvd25VcE9yRG93bih0cnVlKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25Eb3duKCkge1xuICAgIGlmICh0aGlzLnBvcHVwKSB7XG4gICAgICB0aGlzLmhhbmRsZUtleURvd25VcE9yRG93bihmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXhwYW5kKCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5RG93blBhZ2VVcCgpIHtcbiAgICBjb25zdCB7XG4gICAgICBhY3RpdmVDYXRlZ29yeSxcbiAgICAgIHNlbGVjdGVkSW5kZXgsXG4gICAgICBjYXRlZ29yeVBhZ2VzLFxuICAgICAgcHJvcHM6IHsgcGFnZVNpemUgfSxcbiAgICB9ID0gdGhpcztcbiAgICBjb25zdCBwYWdlID0gY2F0ZWdvcnlQYWdlc1thY3RpdmVDYXRlZ29yeV0gfHwgMTtcbiAgICBjb25zdCBjYXRlZ29yeSA9IHRoaXMuY2F0ZWdvcmllc1thY3RpdmVDYXRlZ29yeV07XG4gICAgaWYgKHBhZ2UgPiAxKSB7XG4gICAgICB0aGlzLnNldENhdGVnb3J5UGFnZShwYWdlIC0gMSwgYWN0aXZlQ2F0ZWdvcnkpO1xuICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZChjYXRlZ29yeVtzZWxlY3RlZEluZGV4IC0gcGFnZVNpemUhXSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5RG93blBhZ2VEb3duKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGFjdGl2ZUNhdGVnb3J5LFxuICAgICAgc2VsZWN0ZWRJbmRleCxcbiAgICAgIGNhdGVnb3J5UGFnZXMsXG4gICAgICBwcm9wczogeyBwYWdlU2l6ZSB9LFxuICAgIH0gPSB0aGlzO1xuICAgIGNvbnN0IHBhZ2UgPSBjYXRlZ29yeVBhZ2VzW2FjdGl2ZUNhdGVnb3J5XSB8fCAxO1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gdGhpcy5jYXRlZ29yaWVzW2FjdGl2ZUNhdGVnb3J5XTtcbiAgICBpZiAocGFnZSA8IE1hdGguY2VpbChjYXRlZ29yeS5sZW5ndGggLyBwYWdlU2l6ZSEpKSB7XG4gICAgICB0aGlzLnNldENhdGVnb3J5UGFnZShwYWdlICsgMSwgYWN0aXZlQ2F0ZWdvcnkpO1xuICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZChjYXRlZ29yeVtzZWxlY3RlZEluZGV4ICsgcGFnZVNpemUhXSB8fCBjYXRlZ29yeVtjYXRlZ29yeS5sZW5ndGggLSAxXSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5RG93bkVudGVyKCkge1xuICAgIHRoaXMuY2hvb3NlKHRoaXMuc2VsZWN0ZWRJY29uKTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd25Fc2MoKSB7XG4gICAgdGhpcy5jb2xsYXBzZSgpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93blRhYigpIHtcbiAgICB0aGlzLmNvbGxhcHNlKCk7XG4gIH1cblxuICBoYW5kbGVLZXlEb3duU3BhY2UoKSB7XG4gICAgdGhpcy5leHBhbmQoKTtcbiAgfVxuXG4gIEBhY3Rpb25cbiAgY2hhbmdlU2VsZWN0ZWQoc2VsZWN0ZWQ/OiBzdHJpbmcpIHtcbiAgICB0aGlzLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XG4gIH1cblxuICBjaG9vc2UoaWNvbj86IHN0cmluZykge1xuICAgIHRoaXMucHJlcGFyZVNldFZhbHVlKGljb24pO1xuICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWQoaWNvbik7XG4gICAgaWYgKCF0aGlzLm11bHRpcGxlKSB7XG4gICAgICB0aGlzLmNvbGxhcHNlKCk7XG4gICAgfVxuICB9XG5cbiAgc3luY1ZhbHVlT25CbHVyKHZhbHVlKSB7XG4gICAgaWYgKHRoaXMuZmlsdGVyZWRJY29ucy5pbmRleE9mKHZhbHVlKSAhPT0gLTEpIHtcbiAgICAgIHRoaXMuY2hvb3NlKHZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRUZXh0KHVuZGVmaW5lZCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlUG9wdXBBbmltYXRlQXBwZWFyKCkge31cblxuICBoYW5kbGVQb3B1cEFuaW1hdGVFbmQoKSB7fVxuXG4gIGdldFBvcHVwU3R5bGVGcm9tQWxpZ24oKTogQ1NTUHJvcGVydGllcyB8IGFueSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldFRyaWdnZXJJY29uRm9udCgpIHtcbiAgICByZXR1cm4gJ2RldmVsb3Blcl9ib2FyZCc7XG4gIH1cblxuICBnZXRQb3B1cENvbnRlbnQoKSB7XG4gICAgY29uc3QgeyB0ZXh0IH0gPSB0aGlzO1xuICAgIGlmICh0ZXh0KSB7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJGaWx0ZXJlZEljb25zKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnJlbmRlckljb25DYXRlZ29yaWVzKCk7XG4gIH1cblxuICBnZXRQcmVmaXgoKSB7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdGhpcy53cmFwcGVyUHJlZml4KDxJY29uIHR5cGU9e3ZhbHVlfSAvPik7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyRmlsdGVyZWRJY29ucygpOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHsgcHJlZml4Q2xzIH0gPSB0aGlzO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1zaW5nbGUtdGFiYH0+XG4gICAgICAgIDxJY29uQ2F0ZWdvcnlcbiAgICAgICAgICBwYWdpbmc9e2ZhbHNlfVxuICAgICAgICAgIHZhbHVlPXt0aGlzLnNlbGVjdGVkSWNvbn1cbiAgICAgICAgICBpY29ucz17dGhpcy5maWx0ZXJlZEljb25zfVxuICAgICAgICAgIHByZWZpeENscz17cHJlZml4Q2xzfVxuICAgICAgICAgIG9uU2VsZWN0PXt0aGlzLmhhbmRsZUl0ZW1TZWxlY3R9XG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVySWNvbkNhdGVnb3JpZXMoKSB7XG4gICAgY29uc3Qge1xuICAgICAgYWN0aXZlQ2F0ZWdvcnksXG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBwcm9wczogeyBwYWdlU2l6ZSB9LFxuICAgICAgY2F0ZWdvcmllcyxcbiAgICAgIGNhdGVnb3J5S2V5cyxcbiAgICAgIGNhdGVnb3J5UGFnZXMsXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBUYWJQYW5lIH0gPSBUYWJzO1xuICAgIGlmIChjYXRlZ29yeUtleXMubGVuZ3RoID4gMSkge1xuICAgICAgY29uc3QgdGFicyA9IGNhdGVnb3J5S2V5cy5tYXAoY2F0ZWdvcnkgPT4gKFxuICAgICAgICA8VGFiUGFuZSBrZXk9e2NhdGVnb3J5fSB0YWI9eyRsKCdJY29uJywgY2F0ZWdvcnkpfSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdGFiYH0+XG4gICAgICAgICAgPEljb25DYXRlZ29yeVxuICAgICAgICAgICAgcGFnZT17Y2F0ZWdvcnlQYWdlc1tjYXRlZ29yeV19XG4gICAgICAgICAgICBwYWdlU2l6ZT17cGFnZVNpemV9XG4gICAgICAgICAgICBjYXRlZ29yeT17Y2F0ZWdvcnl9XG4gICAgICAgICAgICB2YWx1ZT17Y2F0ZWdvcnkgPT09IGFjdGl2ZUNhdGVnb3J5ID8gdGhpcy5zZWxlY3RlZEljb24gOiB1bmRlZmluZWR9XG4gICAgICAgICAgICBpY29ucz17Y2F0ZWdvcmllc1tjYXRlZ29yeV19XG4gICAgICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgICAgIG9uU2VsZWN0PXt0aGlzLmhhbmRsZUl0ZW1TZWxlY3R9XG4gICAgICAgICAgICBvblBhZ2VDaGFuZ2U9e3RoaXMuaGFuZGxlUGFnZUNoYW5nZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L1RhYlBhbmU+XG4gICAgICApKTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPFRhYnMgb25DaGFuZ2U9e3RoaXMuaGFuZGxlVGFic0NoYW5nZX0gYWN0aXZlS2V5PXthY3RpdmVDYXRlZ29yeX0+XG4gICAgICAgICAgICB7dGFic31cbiAgICAgICAgICA8L1RhYnM+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgY2F0ZWdvcnkgPSBjYXRlZ29yeUtleXNbMF07XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXNpbmdsZS10YWJgfT5cbiAgICAgICAgPEljb25DYXRlZ29yeVxuICAgICAgICAgIHBhZ2U9e2NhdGVnb3J5UGFnZXNbY2F0ZWdvcnldfVxuICAgICAgICAgIHBhZ2VTaXplPXtwYWdlU2l6ZX1cbiAgICAgICAgICBjYXRlZ29yeT17Y2F0ZWdvcnl9XG4gICAgICAgICAgdmFsdWU9e2NhdGVnb3J5ID09PSBhY3RpdmVDYXRlZ29yeSA/IHRoaXMuc2VsZWN0ZWRJY29uIDogdW5kZWZpbmVkfVxuICAgICAgICAgIGljb25zPXtjYXRlZ29yaWVzW2NhdGVnb3J5XX1cbiAgICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgICBvblNlbGVjdD17dGhpcy5oYW5kbGVJdGVtU2VsZWN0fVxuICAgICAgICAgIG9uUGFnZUNoYW5nZT17dGhpcy5oYW5kbGVQYWdlQ2hhbmdlfVxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9