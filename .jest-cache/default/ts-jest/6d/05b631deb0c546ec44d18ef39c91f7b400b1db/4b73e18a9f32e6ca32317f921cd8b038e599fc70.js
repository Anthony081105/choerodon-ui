import React, { Component } from 'react';
import moment from 'moment';
import classNames from 'classnames';
import Icon from '../icon';
import Input from '../input';
import Button from '../button';
import interopDefault from '../_util/interopDefault';
import Calendar from '../rc-components/calendar';
import RcDatePicker from '../rc-components/calendar/Picker';
function formatValue(value, format) {
    return (value && value.format(format)) || '';
}
export default class WeekPicker extends Component {
    constructor(props) {
        super(props);
        this.weekDateRender = (current) => {
            const { value } = this.state;
            const { prefixCls } = this.props;
            if (value && current.year() === value.year() && current.week() === value.week()) {
                return (React.createElement("div", { className: `${prefixCls}-selected-day` },
                    React.createElement("div", { className: `${prefixCls}-date` }, current.date())));
            }
            return React.createElement("div", { className: `${prefixCls}-calendar-date` }, current.date());
        };
        this.handleOpenChange = (status) => {
            const { onOpenChange } = this.props;
            const { focused } = this.state;
            if (status !== focused) {
                this.setState({
                    focused: status,
                });
            }
            if (onOpenChange) {
                onOpenChange(status);
            }
        };
        this.handleChange = (value) => {
            if (!('value' in this.props)) {
                this.setState({ value });
            }
            const { onChange, format } = this.props;
            onChange(value, formatValue(value, format));
        };
        this.clearSelection = e => {
            e.preventDefault();
            e.stopPropagation();
            this.handleChange(null);
        };
        this.onPickerIconClick = e => {
            e.preventDefault();
            e.stopPropagation();
            const { disabled } = this.props;
            if (disabled) {
                return;
            }
            const { focused } = this.state;
            this.picker.setOpen(!focused);
        };
        this.saveInput = (node) => {
            this.input = node;
        };
        this.savePicker = (node) => {
            this.picker = node;
        };
        const value = props.value || props.defaultValue;
        if (value && !interopDefault(moment).isMoment(value)) {
            throw new Error('The value/defaultValue of DatePicker or MonthPicker must be a moment object');
        }
        this.state = {
            value,
            focused: false,
        };
    }
    componentWillReceiveProps(nextProps) {
        if ('value' in nextProps) {
            this.setState({ value: nextProps.value });
        }
    }
    focus() {
        this.input.focus();
    }
    blur() {
        this.input.blur();
    }
    render() {
        const { props } = this;
        const { focused, value } = this.state;
        const { prefixCls, className, disabled, pickerClass, popupStyle, pickerInputClass, format, allowClear, locale, localeCode, disabledDate, style, onFocus, onBlur, label, id, } = props;
        const pickerValue = value;
        if (pickerValue && localeCode) {
            pickerValue.locale(localeCode);
        }
        const placeholder = 'placeholder' in props ? props.placeholder : locale.lang.placeholder;
        const calendar = (React.createElement(Calendar, { showWeekNumber: true, dateRender: this.weekDateRender, prefixCls: prefixCls, format: format, locale: locale.lang, showDateInput: false, showToday: false, disabledDate: disabledDate }));
        const clearIcon = !disabled && allowClear && value ? (React.createElement(Button, { className: `${prefixCls}-picker-clear`, onClick: this.clearSelection, shape: "circle", icon: "close", size: "small" /* small */ })) : null;
        const suffix = (React.createElement("span", { className: `${prefixCls}-picker-icon-wrapper`, onClick: this.onPickerIconClick },
            clearIcon,
            React.createElement(Icon, { type: "date_range", className: `${prefixCls}-picker-icon` })));
        const input = ({ value: inputValue }) => (React.createElement(Input, { ref: this.saveInput, disabled: disabled, readOnly: true, value: (inputValue && inputValue.format(format)) || '', placeholder: placeholder, className: pickerInputClass, onFocus: onFocus, onBlur: onBlur, style: style, suffix: suffix, label: label, focused: focused }));
        return (React.createElement("span", { className: classNames(className, pickerClass), id: id },
            React.createElement(RcDatePicker, Object.assign({}, this.props, { calendar: calendar, prefixCls: `${prefixCls}-picker-container`, value: pickerValue, onChange: this.handleChange, onOpenChange: this.handleOpenChange, style: popupStyle, ref: this.savePicker }), input)));
    }
}
WeekPicker.defaultProps = {
    format: 'gggg-wo',
    allowClear: true,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvZGF0ZS1waWNrZXIvV2Vla1BpY2tlci50c3giLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQXFCLE1BQU0sT0FBTyxDQUFDO0FBQzVELE9BQU8sTUFBa0IsTUFBTSxRQUFRLENBQUM7QUFDeEMsT0FBTyxVQUFVLE1BQU0sWUFBWSxDQUFDO0FBQ3BDLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLEtBQUssTUFBTSxVQUFVLENBQUM7QUFDN0IsT0FBTyxNQUFNLE1BQU0sV0FBVyxDQUFDO0FBQy9CLE9BQU8sY0FBYyxNQUFNLHlCQUF5QixDQUFDO0FBQ3JELE9BQU8sUUFBUSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pELE9BQU8sWUFBWSxNQUFNLGtDQUFrQyxDQUFDO0FBRzVELFNBQVMsV0FBVyxDQUFDLEtBQW9CLEVBQUUsTUFBYztJQUN2RCxPQUFPLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDL0MsQ0FBQztBQUVELE1BQU0sQ0FBQyxPQUFPLE9BQU8sVUFBVyxTQUFRLFNBQW1CO0lBVXpELFlBQVksS0FBVTtRQUNwQixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFtQmYsbUJBQWMsR0FBRyxDQUFDLE9BQVksRUFBRSxFQUFFO1lBQ2hDLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQzdCLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ2pDLElBQUksS0FBSyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLEtBQUssQ0FBQyxJQUFJLEVBQUUsRUFBRTtnQkFDL0UsT0FBTyxDQUNMLDZC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QUFDLEVBQUUsRUFBRSxFQUFFLEVBQUU7WUFDekQsb0JBQUMsWUFBWSxvQkFDUCxJQUFJLENBQUMsS0FBSyxJQUNkLFFBQVEsRUFBRSxRQUFRLEVBQ2xCLFNBQVMsRUFBRSxHQUFHLFNBQVMsbUJBQW1CLEVBQzFDLEtBQUssRUFBRSxXQUFXLEVBQ2xCLFFBQVEsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUMzQixZQUFZLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUNuQyxLQUFLLEVBQUUsVUFBVSxFQUNqQixHQUFHLEVBQUUsSUFBSSxDQUFDLFVBQVUsS0FFbkIsS0FBSyxDQUNPLENBQ1YsQ0FDUixDQUFDO0lBQ0osQ0FBQzs7QUExTE0sdUJBQVksR0FBRztJQUNwQixNQUFNLEVBQUUsU0FBUztJQUNqQixVQUFVLEVBQUUsSUFBSTtDQUNqQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzL2RhdGUtcGlja2VyL1dlZWtQaWNrZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQsIE1vdXNlRXZlbnRIYW5kbGVyIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IG1vbWVudCwgeyBNb21lbnQgfSBmcm9tICdtb21lbnQnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgSWNvbiBmcm9tICcuLi9pY29uJztcbmltcG9ydCBJbnB1dCBmcm9tICcuLi9pbnB1dCc7XG5pbXBvcnQgQnV0dG9uIGZyb20gJy4uL2J1dHRvbic7XG5pbXBvcnQgaW50ZXJvcERlZmF1bHQgZnJvbSAnLi4vX3V0aWwvaW50ZXJvcERlZmF1bHQnO1xuaW1wb3J0IENhbGVuZGFyIGZyb20gJy4uL3JjLWNvbXBvbmVudHMvY2FsZW5kYXInO1xuaW1wb3J0IFJjRGF0ZVBpY2tlciBmcm9tICcuLi9yYy1jb21wb25lbnRzL2NhbGVuZGFyL1BpY2tlcic7XG5pbXBvcnQgeyBTaXplIH0gZnJvbSAnLi4vX3V0aWwvZW51bSc7XG5cbmZ1bmN0aW9uIGZvcm1hdFZhbHVlKHZhbHVlOiBNb21lbnQgfCBudWxsLCBmb3JtYXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiAodmFsdWUgJiYgdmFsdWUuZm9ybWF0KGZvcm1hdCkpIHx8ICcnO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXZWVrUGlja2VyIGV4dGVuZHMgQ29tcG9uZW50PGFueSwgYW55PiB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgZm9ybWF0OiAnZ2dnZy13bycsXG4gICAgYWxsb3dDbGVhcjogdHJ1ZSxcbiAgfTtcblxuICBwcml2YXRlIGlucHV0OiBhbnk7XG5cbiAgcHJpdmF0ZSBwaWNrZXI6IGFueTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogYW55KSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIGNvbnN0IHZhbHVlID0gcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgIGlmICh2YWx1ZSAmJiAhaW50ZXJvcERlZmF1bHQobW9tZW50KS5pc01vbWVudCh2YWx1ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1RoZSB2YWx1ZS9kZWZhdWx0VmFsdWUgb2YgRGF0ZVBpY2tlciBvciBNb250aFBpY2tlciBtdXN0IGJlIGEgbW9tZW50IG9iamVjdCcsXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgdmFsdWUsXG4gICAgICBmb2N1c2VkOiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHM6IGFueSkge1xuICAgIGlmICgndmFsdWUnIGluIG5leHRQcm9wcykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlOiBuZXh0UHJvcHMudmFsdWUgfSk7XG4gICAgfVxuICB9XG5cbiAgd2Vla0RhdGVSZW5kZXIgPSAoY3VycmVudDogYW55KSA9PiB7XG4gICAgY29uc3QgeyB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7IHByZWZpeENscyB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAodmFsdWUgJiYgY3VycmVudC55ZWFyKCkgPT09IHZhbHVlLnllYXIoKSAmJiBjdXJyZW50LndlZWsoKSA9PT0gdmFsdWUud2VlaygpKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1zZWxlY3RlZC1kYXlgfT5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1kYXRlYH0+e2N1cnJlbnQuZGF0ZSgpfTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1jYWxlbmRhci1kYXRlYH0+e2N1cnJlbnQuZGF0ZSgpfTwvZGl2PjtcbiAgfTtcblxuICBoYW5kbGVPcGVuQ2hhbmdlID0gKHN0YXR1czogYm9vbGVhbikgPT4ge1xuICAgIGNvbnN0IHsgb25PcGVuQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgZm9jdXNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBpZiAoc3RhdHVzICE9PSBmb2N1c2VkKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgZm9jdXNlZDogc3RhdHVzLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChvbk9wZW5DaGFuZ2UpIHtcbiAgICAgIG9uT3BlbkNoYW5nZShzdGF0dXMpO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVDaGFuZ2UgPSAodmFsdWU6IE1vbWVudCB8IG51bGwpID0+IHtcbiAgICBpZiAoISgndmFsdWUnIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSk7XG4gICAgfVxuICAgIGNvbnN0IHsgb25DaGFuZ2UsIGZvcm1hdCB9ID0gdGhpcy5wcm9wcztcbiAgICBvbkNoYW5nZSh2YWx1ZSwgZm9ybWF0VmFsdWUodmFsdWUsIGZvcm1hdCkpO1xuICB9O1xuXG4gIGNsZWFyU2VsZWN0aW9uOiBNb3VzZUV2ZW50SGFuZGxlcjxIVE1MRWxlbWVudD4gPSBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLmhhbmRsZUNoYW5nZShudWxsKTtcbiAgfTtcblxuICBvblBpY2tlckljb25DbGljazogTW91c2VFdmVudEhhbmRsZXI8SFRNTEVsZW1lbnQ+ID0gZSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgY29uc3QgeyBkaXNhYmxlZCB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoZGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBmb2N1c2VkIH0gPSB0aGlzLnN0YXRlO1xuICAgIHRoaXMucGlja2VyLnNldE9wZW4oIWZvY3VzZWQpO1xuICB9O1xuXG4gIGZvY3VzKCkge1xuICAgIHRoaXMuaW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIGJsdXIoKSB7XG4gICAgdGhpcy5pbnB1dC5ibHVyKCk7XG4gIH1cblxuICBzYXZlSW5wdXQgPSAobm9kZTogYW55KSA9PiB7XG4gICAgdGhpcy5pbnB1dCA9IG5vZGU7XG4gIH07XG5cbiAgc2F2ZVBpY2tlciA9IChub2RlOiBhbnkpID0+IHtcbiAgICB0aGlzLnBpY2tlciA9IG5vZGU7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgcHJvcHMgfSA9IHRoaXM7XG4gICAgY29uc3QgeyBmb2N1c2VkLCB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICBjbGFzc05hbWUsXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIHBpY2tlckNsYXNzLFxuICAgICAgcG9wdXBTdHlsZSxcbiAgICAgIHBpY2tlcklucHV0Q2xhc3MsXG4gICAgICBmb3JtYXQsXG4gICAgICBhbGxvd0NsZWFyLFxuICAgICAgbG9jYWxlLFxuICAgICAgbG9jYWxlQ29kZSxcbiAgICAgIGRpc2FibGVkRGF0ZSxcbiAgICAgIHN0eWxlLFxuICAgICAgb25Gb2N1cyxcbiAgICAgIG9uQmx1cixcbiAgICAgIGxhYmVsLFxuICAgICAgaWQsXG4gICAgfSA9IHByb3BzO1xuXG4gICAgY29uc3QgcGlja2VyVmFsdWUgPSB2YWx1ZTtcbiAgICBpZiAocGlja2VyVmFsdWUgJiYgbG9jYWxlQ29kZSkge1xuICAgICAgcGlja2VyVmFsdWUubG9jYWxlKGxvY2FsZUNvZGUpO1xuICAgIH1cblxuICAgIGNvbnN0IHBsYWNlaG9sZGVyID0gJ3BsYWNlaG9sZGVyJyBpbiBwcm9wcyA/IHByb3BzLnBsYWNlaG9sZGVyIDogbG9jYWxlLmxhbmcucGxhY2Vob2xkZXI7XG5cbiAgICBjb25zdCBjYWxlbmRhciA9IChcbiAgICAgIDxDYWxlbmRhclxuICAgICAgICBzaG93V2Vla051bWJlclxuICAgICAgICBkYXRlUmVuZGVyPXt0aGlzLndlZWtEYXRlUmVuZGVyfVxuICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgZm9ybWF0PXtmb3JtYXR9XG4gICAgICAgIGxvY2FsZT17bG9jYWxlLmxhbmd9XG4gICAgICAgIHNob3dEYXRlSW5wdXQ9e2ZhbHNlfVxuICAgICAgICBzaG93VG9kYXk9e2ZhbHNlfVxuICAgICAgICBkaXNhYmxlZERhdGU9e2Rpc2FibGVkRGF0ZX1cbiAgICAgIC8+XG4gICAgKTtcbiAgICBjb25zdCBjbGVhckljb24gPVxuICAgICAgIWRpc2FibGVkICYmIGFsbG93Q2xlYXIgJiYgdmFsdWUgPyAoXG4gICAgICAgIDxCdXR0b25cbiAgICAgICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tcGlja2VyLWNsZWFyYH1cbiAgICAgICAgICBvbkNsaWNrPXt0aGlzLmNsZWFyU2VsZWN0aW9ufVxuICAgICAgICAgIHNoYXBlPVwiY2lyY2xlXCJcbiAgICAgICAgICBpY29uPVwiY2xvc2VcIlxuICAgICAgICAgIHNpemU9e1NpemUuc21hbGx9XG4gICAgICAgIC8+XG4gICAgICApIDogbnVsbDtcblxuICAgIGNvbnN0IHN1ZmZpeCA9IChcbiAgICAgIDxzcGFuIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1waWNrZXItaWNvbi13cmFwcGVyYH0gb25DbGljaz17dGhpcy5vblBpY2tlckljb25DbGlja30+XG4gICAgICAgIHtjbGVhckljb259XG4gICAgICAgIDxJY29uIHR5cGU9XCJkYXRlX3JhbmdlXCIgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXBpY2tlci1pY29uYH0gLz5cbiAgICAgIDwvc3Bhbj5cbiAgICApO1xuICAgIGNvbnN0IGlucHV0ID0gKHsgdmFsdWU6IGlucHV0VmFsdWUgfTogeyB2YWx1ZTogTW9tZW50IHwgdW5kZWZpbmVkIH0pID0+IChcbiAgICAgIDxJbnB1dFxuICAgICAgICByZWY9e3RoaXMuc2F2ZUlucHV0fVxuICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgIHJlYWRPbmx5XG4gICAgICAgIHZhbHVlPXsoaW5wdXRWYWx1ZSAmJiBpbnB1dFZhbHVlLmZvcm1hdChmb3JtYXQpKSB8fCAnJ31cbiAgICAgICAgcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfVxuICAgICAgICBjbGFzc05hbWU9e3BpY2tlcklucHV0Q2xhc3N9XG4gICAgICAgIG9uRm9jdXM9e29uRm9jdXN9XG4gICAgICAgIG9uQmx1cj17b25CbHVyfVxuICAgICAgICBzdHlsZT17c3R5bGV9XG4gICAgICAgIHN1ZmZpeD17c3VmZml4fVxuICAgICAgICBsYWJlbD17bGFiZWx9XG4gICAgICAgIGZvY3VzZWQ9e2ZvY3VzZWR9XG4gICAgICAvPlxuICAgICk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhjbGFzc05hbWUsIHBpY2tlckNsYXNzKX0gaWQ9e2lkfT5cbiAgICAgICAgPFJjRGF0ZVBpY2tlclxuICAgICAgICAgIHsuLi50aGlzLnByb3BzfVxuICAgICAgICAgIGNhbGVuZGFyPXtjYWxlbmRhcn1cbiAgICAgICAgICBwcmVmaXhDbHM9e2Ake3ByZWZpeENsc30tcGlja2VyLWNvbnRhaW5lcmB9XG4gICAgICAgICAgdmFsdWU9e3BpY2tlclZhbHVlfVxuICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYW5nZX1cbiAgICAgICAgICBvbk9wZW5DaGFuZ2U9e3RoaXMuaGFuZGxlT3BlbkNoYW5nZX1cbiAgICAgICAgICBzdHlsZT17cG9wdXBTdHlsZX1cbiAgICAgICAgICByZWY9e3RoaXMuc2F2ZVBpY2tlcn1cbiAgICAgICAgPlxuICAgICAgICAgIHtpbnB1dH1cbiAgICAgICAgPC9SY0RhdGVQaWNrZXI+XG4gICAgICA8L3NwYW4+XG4gICAgKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9