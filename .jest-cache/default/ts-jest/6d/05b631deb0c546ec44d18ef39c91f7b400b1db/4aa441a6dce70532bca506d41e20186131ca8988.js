import { __decorate } from "tslib";
import React from 'react';
import moment from 'moment';
import classNames from 'classnames';
import { action, computed, observable } from 'mobx';
import { observer } from 'mobx-react';
import autobind from '../_util/autobind';
import DaysView, { alwaysValidDate } from './DaysView';
import { $l } from '../locale-context';
import { stopEvent } from '../_util/EventManager';
const stepMapping = {
    ["h" /* hour */]: 'hour',
    ["m" /* minute */]: 'minute',
    ["s" /* second */]: 'second',
};
let TimesView = class TimesView extends DaysView {
    get showHour() {
        const { format } = this.observableProps;
        return format.indexOf('H') > -1 || format.indexOf('h') > -1 || format.indexOf('k') > -1;
    }
    get showMinute() {
        const { format } = this.observableProps;
        return format.indexOf('m') > -1;
    }
    get showSecond() {
        const { format } = this.observableProps;
        return format.indexOf('s') > -1;
    }
    get use12Hours() {
        const { format } = this.observableProps;
        return format.indexOf('h') > -1 || format.indexOf('a') > -1 || format.indexOf('A') > -1;
    }
    get timeUnitQueue() {
        const { showHour, showMinute, showSecond, use12Hours } = this;
        const queue = [];
        if (showHour) {
            queue.push("h" /* hour */);
        }
        if (showMinute) {
            queue.push("m" /* minute */);
        }
        if (showSecond) {
            queue.push("s" /* second */);
        }
        if (use12Hours) {
            queue.push("a" /* a */);
        }
        return queue;
    }
    get barStyle() {
        return {
            width: `${100 / this.timeUnitQueue.length}%`,
        };
    }
    get activeStyle() {
        const { timeUnitQueue } = this;
        const width = 100 / timeUnitQueue.length;
        return {
            width: `${width}%`,
            left: `${timeUnitQueue.indexOf(this.getCurrentUnit()) * width}%`,
        };
    }
    savePanel(node) {
        this.panel = node;
    }
    getObservableProps(props) {
        return {
            format: props.format,
        };
    }
    componentDidMount() {
        if (this.panel) {
            // 兼容Firefox wheel为通用事件
            this.panel.addEventListener('wheel', this.handleWheel, { passive: false });
        }
    }
    componentWillUnmount() {
        if (this.panel) {
            this.panel.removeEventListener('wheel', this.handleWheel);
        }
    }
    handleDateTimeSelect() {
        this.changeViewMode("dateTime" /* dateTime */);
    }
    handleKeyDownHome(e) {
        this.handleKeyDownPageUp(e);
    }
    handleKeyDownEnd(e) {
        this.handleKeyDownPageDown(e);
    }
    handleKeyDownLeft(e) {
        stopEvent(e);
        if (e.altKey) {
            if (this.props.mode !== "time" /* time */) {
                this.changeViewMode("dateTime" /* dateTime */);
            }
        }
        else {
            this.changeUnit(this.getPrevUnit());
        }
    }
    handleKeyDownRight(e) {
        stopEvent(e);
        if (!e.altKey) {
            this.changeUnit(this.getNextUnit());
        }
    }
    handleKeyDownUp(e) {
        stopEvent(e);
        const unit = this.getCurrentUnit();
        if (unit === "a" /* a */) {
            this.changeSelectedDate(this.getCloneDate().subtract(12, "h" /* hour */));
        }
        else {
            const { step } = this.props;
            const unitStep = step[stepMapping[unit]] || 1;
            const date = this.getCloneDate();
            const parentUnit = unit === "s" /* second */ ? "m" /* minute */ : unit === "m" /* minute */ ? "h" /* hour */ : null;
            if (parentUnit) {
                const parentStep = step[stepMapping[parentUnit]];
                if (parentStep) {
                    const preValue = date.get(parentUnit);
                    date.subtract(unitStep, unit);
                    if (preValue !== date.get(parentUnit)) {
                        date.subtract(parentStep - 1, parentUnit);
                    }
                    this.changeSelectedDate(date);
                    return;
                }
            }
            this.changeSelectedDate(date.subtract(unitStep, unit));
        }
    }
    handleKeyDownDown(e) {
        stopEvent(e);
        const unit = this.getCurrentUnit();
        if (unit === "a" /* a */) {
            this.changeSelectedDate(this.getCloneDate().add(12, "h" /* hour */));
        }
        else {
            const { step } = this.props;
            const unitStep = step[stepMapping[unit]] || 1;
            const date = this.getCloneDate();
            const parentUnit = unit === "s" /* second */ ? "m" /* minute */ : unit === "m" /* minute */ ? "h" /* hour */ : null;
            if (parentUnit) {
                const parentStep = step[stepMapping[parentUnit]];
                if (parentStep) {
                    const preValue = date.get(parentUnit);
                    date.add(unitStep, unit);
                    if (preValue !== date.get(parentUnit)) {
                        date.add(parentStep - 1, parentUnit);
                    }
                    this.changeSelectedDate(date);
                    return;
                }
            }
            this.changeSelectedDate(date.add(unitStep, unit));
        }
    }
    handleKeyDownPageUp(e) {
        stopEvent(e);
        const unit = this.getCurrentUnit();
        if (unit === "a" /* a */) {
            this.changeSelectedDate(this.getCloneDate().set("h" /* hour */, 0));
        }
        else {
            this.changeSelectedDate(this.getCloneDate().set(unit, 0));
        }
    }
    handleKeyDownPageDown(e) {
        stopEvent(e);
        const unit = this.getCurrentUnit();
        if (unit === "a" /* a */) {
            this.changeSelectedDate(this.getCloneDate().set("h" /* hour */, 12));
        }
        else {
            const { step } = this.props;
            const unitStep = step[stepMapping[unit]] || 1;
            const size = unit === "h" /* hour */ ? this.use12Hours ? 12 : 24 : 60;
            this.changeSelectedDate(this.getCloneDate().set(unit, size - unitStep));
        }
    }
    handleTimeCellClick(date, unit) {
        this.changeUnit(unit);
        this.changeSelectedDate(date);
    }
    handleWheel(e) {
        e.preventDefault();
        if (e.deltaY > 0) {
            this.handleKeyDownDown(e);
        }
        else if (e.deltaY < 0) {
            this.handleKeyDownUp(e);
        }
    }
    renderHeader() {
        const { prefixCls, props: { date, mode }, observableProps: { format }, } = this;
        if (mode === "time" /* time */) {
            return (React.createElement("div", { className: `${prefixCls}-header` },
                React.createElement("span", { className: `${prefixCls}-view-select` }, date.format(format))));
        }
        return (React.createElement("div", { className: `${prefixCls}-header` },
            React.createElement("a", { className: `${prefixCls}-view-select`, onClick: this.handleMonthSelect }, date.localeData().monthsShort(date)),
            React.createElement("a", { className: `${prefixCls}-view-select`, onClick: this.handleDateTimeSelect }, date.date()),
            React.createElement("a", { className: `${prefixCls}-view-select`, onClick: this.handleYearSelect }, date.year())));
    }
    renderFooter() {
        const { prefixCls } = this;
        return (React.createElement("div", { className: `${prefixCls}-footer` },
            React.createElement("a", { className: `${prefixCls}-footer-now-btn`, onClick: this.choose.bind(this, moment()) }, $l('DatePicker', 'now')),
            React.createElement("a", { className: `${prefixCls}-footer-view-select`, onClick: this.choose.bind(this, this.props.date) }, $l('DatePicker', 'ok'))));
    }
    renderPanel() {
        const className = this.getPanelClass();
        return (React.createElement("div", { ref: this.savePanel, className: className },
            React.createElement("div", { className: `${className}-inner` }, this.renderPanelBody())));
    }
    renderPanelBody() {
        const { showHour, showMinute, showSecond, use12Hours, activeStyle } = this;
        return [
            showHour && this.getTimeBar("h" /* hour */),
            showMinute && this.getTimeBar("m" /* minute */),
            showSecond && this.getTimeBar("s" /* second */),
            use12Hours && this.getTimeBar("a" /* a */),
            React.createElement("div", { key: "active", style: activeStyle, className: `${this.prefixCls}-time-focus-active` }),
        ];
    }
    renderCell(props) {
        return React.createElement("li", Object.assign({}, props));
    }
    getTimeBar(unit) {
        const { prefixCls, use12Hours, props: { date, renderer = this.renderCell, isValidDate = alwaysValidDate, step }, observableProps: { format }, } = this;
        const isUpperCase = format.indexOf('A') > -1;
        const items = [];
        const selected = date.clone();
        const finalUnit = unit === "a" /* a */ ? "h" /* hour */ : unit;
        const selectedValue = selected.get(finalUnit);
        const size = unit === "a" /* a */ ? 13 : unit === "h" /* hour */ ? use12Hours ? 12 : 24 : 60;
        const begin = unit === "a" /* a */ ? selectedValue % 12 : unit === "h" /* hour */ && use12Hours && selectedValue > 11 ? 12 : 0;
        const pre = date.clone().set(finalUnit, begin);
        const last = pre.clone().add(size, finalUnit);
        while (pre.isBefore(last)) {
            const current = pre.clone();
            const isDisabled = !isValidDate(current, selected);
            const text = unit === "a" /* a */ ?
                current.format(isUpperCase ? 'A' : 'a') :
                String(pre.get(unit) - (use12Hours && pre.get(unit) > 11 ? 12 : 0) || (use12Hours && finalUnit === "h" /* hour */ ? 12 : 0));
            const className = classNames(`${prefixCls}-cell`, {
                [`${prefixCls}-selected`]: unit === "a" /* a */ ? current.get("h" /* hour */) === selectedValue : current.isSame(selected, finalUnit),
                [`${prefixCls}-disabled`]: isDisabled,
            });
            const props = {
                key: text,
                className,
                children: React.createElement("div", { className: `${prefixCls}-cell-inner` }, text),
            };
            if (!isDisabled) {
                props.onClick = this.handleTimeCellClick.bind(this, current, unit);
            }
            items.push(renderer(props, text, current, selected));
            pre.add(unit === "a" /* a */ ? 12 : (step[stepMapping[unit]] || 1), finalUnit);
        }
        const top = unit === "a" /* a */ ?
            -Math.floor(selectedValue / 12) :
            (unit === "h" /* hour */ && use12Hours ?
                -selectedValue % 12 :
                -selectedValue) / (step[stepMapping[unit]] || 1);
        return (React.createElement("div", { key: unit, className: `${prefixCls}-time-list`, onMouseEnter: this.changeUnit.bind(this, unit), style: this.barStyle },
            React.createElement("ul", { style: { top: `${(top + 4.5) * 100}%` } }, items),
            React.createElement("div", { className: `${prefixCls}-time-focus` })));
    }
    getPanelClass() {
        return `${this.prefixCls}-time-panel`;
    }
    getCurrentUnit() {
        const { currentUnit } = this;
        return currentUnit || this.timeUnitQueue[0];
    }
    getPrevUnit() {
        const { timeUnitQueue } = this;
        return timeUnitQueue[timeUnitQueue.indexOf(this.getCurrentUnit()) - 1];
    }
    getNextUnit() {
        const { timeUnitQueue } = this;
        return timeUnitQueue[timeUnitQueue.indexOf(this.getCurrentUnit()) + 1];
    }
    changeUnit(unit) {
        if (unit !== undefined && unit !== this.currentUnit) {
            this.currentUnit = unit;
        }
    }
    choose(date) {
        const { mode } = this.props;
        if (mode !== "time" /* time */) {
            this.changeSelectedDate(date);
            this.changeViewMode(mode);
        }
        super.choose(date);
    }
};
TimesView.displayName = 'TimesView';
TimesView.type = "time" /* time */;
__decorate([
    observable
], TimesView.prototype, "currentUnit", void 0);
__decorate([
    computed
], TimesView.prototype, "showHour", null);
__decorate([
    computed
], TimesView.prototype, "showMinute", null);
__decorate([
    computed
], TimesView.prototype, "showSecond", null);
__decorate([
    computed
], TimesView.prototype, "use12Hours", null);
__decorate([
    computed
], TimesView.prototype, "timeUnitQueue", null);
__decorate([
    computed
], TimesView.prototype, "barStyle", null);
__decorate([
    computed
], TimesView.prototype, "activeStyle", null);
__decorate([
    autobind
], TimesView.prototype, "savePanel", null);
__decorate([
    autobind
], TimesView.prototype, "handleDateTimeSelect", null);
__decorate([
    autobind
], TimesView.prototype, "handleWheel", null);
__decorate([
    autobind
], TimesView.prototype, "renderCell", null);
__decorate([
    action
], TimesView.prototype, "changeUnit", null);
TimesView = __decorate([
    observer
], TimesView);
export default TimesView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL2RhdGUtcGlja2VyL1RpbWVzVmlldy50c3giLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBbUMsTUFBTSxPQUFPLENBQUM7QUFDeEQsT0FBTyxNQUFrQixNQUFNLFFBQVEsQ0FBQztBQUN4QyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxRQUFRLE1BQU0sbUJBQW1CLENBQUM7QUFFekMsT0FBTyxRQUFRLEVBQUUsRUFBRSxlQUFlLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFdkQsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVsRCxNQUFNLFdBQVcsR0FBRztJQUNsQixnQkFBZSxFQUFFLE1BQU07SUFDdkIsa0JBQWlCLEVBQUUsUUFBUTtJQUMzQixrQkFBaUIsRUFBRSxRQUFRO0NBQzVCLENBQUM7QUFHRixJQUFxQixTQUFTLEdBQTlCLE1BQXFCLFNBQVUsU0FBUSxRQUFRO0lBVTdDLElBQUksUUFBUTtRQUNWLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQ3hDLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDMUYsQ0FBQztJQUdELElBQUksVUFBVTtRQUNaLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxJ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LENBQUM7UUFDNUIsSUFBSSxJQUFJLHNCQUFrQixFQUFFO1lBQzFCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzNCO1FBQ0QsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNyQixDQUFDO0NBQ0YsQ0FBQTtBQXpYUSxxQkFBVyxHQUFHLFdBQVcsQ0FBQztBQUUxQixjQUFJLHFCQUFrQjtBQUVqQjtJQUFYLFVBQVU7OENBQXdCO0FBS25DO0lBREMsUUFBUTt5Q0FJUjtBQUdEO0lBREMsUUFBUTsyQ0FJUjtBQUdEO0lBREMsUUFBUTsyQ0FJUjtBQUdEO0lBREMsUUFBUTsyQ0FJUjtBQUdEO0lBREMsUUFBUTs4Q0FpQlI7QUFHRDtJQURDLFFBQVE7eUNBS1I7QUFHRDtJQURDLFFBQVE7NENBUVI7QUFHRDtJQURDLFFBQVE7MENBR1I7QUFzQkQ7SUFEQyxRQUFRO3FEQUdSO0FBNkdEO0lBREMsUUFBUTs0Q0FRUjtBQXlFRDtJQURDLFFBQVE7MkNBR1I7QUE2RUQ7SUFEQyxNQUFNOzJDQUtOO0FBaFhrQixTQUFTO0lBRDdCLFFBQVE7R0FDWSxTQUFTLENBMFg3QjtlQTFYb0IsU0FBUyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy1wcm8vZGF0ZS1waWNrZXIvVGltZXNWaWV3LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ1NTUHJvcGVydGllcywgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IG1vbWVudCwgeyBNb21lbnQgfSBmcm9tICdtb21lbnQnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgeyBhY3Rpb24sIGNvbXB1dGVkLCBvYnNlcnZhYmxlIH0gZnJvbSAnbW9ieCc7XG5pbXBvcnQgeyBvYnNlcnZlciB9IGZyb20gJ21vYngtcmVhY3QnO1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJy4uL191dGlsL2F1dG9iaW5kJztcbmltcG9ydCB7IFRpbWVVbml0LCBWaWV3TW9kZSB9IGZyb20gJy4vZW51bSc7XG5pbXBvcnQgRGF5c1ZpZXcsIHsgYWx3YXlzVmFsaWREYXRlIH0gZnJvbSAnLi9EYXlzVmlldyc7XG5pbXBvcnQgeyBGaWVsZFR5cGUgfSBmcm9tICcuLi9kYXRhLXNldC9lbnVtJztcbmltcG9ydCB7ICRsIH0gZnJvbSAnLi4vbG9jYWxlLWNvbnRleHQnO1xuaW1wb3J0IHsgc3RvcEV2ZW50IH0gZnJvbSAnLi4vX3V0aWwvRXZlbnRNYW5hZ2VyJztcblxuY29uc3Qgc3RlcE1hcHBpbmcgPSB7XG4gIFtUaW1lVW5pdC5ob3VyXTogJ2hvdXInLFxuICBbVGltZVVuaXQubWludXRlXTogJ21pbnV0ZScsXG4gIFtUaW1lVW5pdC5zZWNvbmRdOiAnc2Vjb25kJyxcbn07XG5cbkBvYnNlcnZlclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGltZXNWaWV3IGV4dGVuZHMgRGF5c1ZpZXcge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnVGltZXNWaWV3JztcblxuICBzdGF0aWMgdHlwZSA9IEZpZWxkVHlwZS50aW1lO1xuXG4gIEBvYnNlcnZhYmxlIGN1cnJlbnRVbml0PzogVGltZVVuaXQ7XG5cbiAgcGFuZWw6IEhUTUxEaXZFbGVtZW50IHwgbnVsbDtcblxuICBAY29tcHV0ZWRcbiAgZ2V0IHNob3dIb3VyKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHsgZm9ybWF0IH0gPSB0aGlzLm9ic2VydmFibGVQcm9wcztcbiAgICByZXR1cm4gZm9ybWF0LmluZGV4T2YoJ0gnKSA+IC0xIHx8IGZvcm1hdC5pbmRleE9mKCdoJykgPiAtMSB8fCBmb3JtYXQuaW5kZXhPZignaycpID4gLTE7XG4gIH1cblxuICBAY29tcHV0ZWRcbiAgZ2V0IHNob3dNaW51dGUoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgeyBmb3JtYXQgfSA9IHRoaXMub2JzZXJ2YWJsZVByb3BzO1xuICAgIHJldHVybiBmb3JtYXQuaW5kZXhPZignbScpID4gLTE7XG4gIH1cblxuICBAY29tcHV0ZWRcbiAgZ2V0IHNob3dTZWNvbmQoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgeyBmb3JtYXQgfSA9IHRoaXMub2JzZXJ2YWJsZVByb3BzO1xuICAgIHJldHVybiBmb3JtYXQuaW5kZXhPZigncycpID4gLTE7XG4gIH1cblxuICBAY29tcHV0ZWRcbiAgZ2V0IHVzZTEySG91cnMoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgeyBmb3JtYXQgfSA9IHRoaXMub2JzZXJ2YWJsZVByb3BzO1xuICAgIHJldHVybiBmb3JtYXQuaW5kZXhPZignaCcpID4gLTEgfHwgZm9ybWF0LmluZGV4T2YoJ2EnKSA+IC0xIHx8IGZvcm1hdC5pbmRleE9mKCdBJykgPiAtMTtcbiAgfVxuXG4gIEBjb21wdXRlZFxuICBnZXQgdGltZVVuaXRRdWV1ZSgpOiBUaW1lVW5pdFtdIHtcbiAgICBjb25zdCB7IHNob3dIb3VyLCBzaG93TWludXRlLCBzaG93U2Vjb25kLCB1c2UxMkhvdXJzIH0gPSB0aGlzO1xuICAgIGNvbnN0IHF1ZXVlOiBUaW1lVW5pdFtdID0gW107XG4gICAgaWYgKHNob3dIb3VyKSB7XG4gICAgICBxdWV1ZS5wdXNoKFRpbWVVbml0LmhvdXIpO1xuICAgIH1cbiAgICBpZiAoc2hvd01pbnV0ZSkge1xuICAgICAgcXVldWUucHVzaChUaW1lVW5pdC5taW51dGUpO1xuICAgIH1cbiAgICBpZiAoc2hvd1NlY29uZCkge1xuICAgICAgcXVldWUucHVzaChUaW1lVW5pdC5zZWNvbmQpO1xuICAgIH1cbiAgICBpZiAodXNlMTJIb3Vycykge1xuICAgICAgcXVldWUucHVzaChUaW1lVW5pdC5hKTtcbiAgICB9XG4gICAgcmV0dXJuIHF1ZXVlO1xuICB9XG5cbiAgQGNvbXB1dGVkXG4gIGdldCBiYXJTdHlsZSgpOiBDU1NQcm9wZXJ0aWVzIHtcbiAgICByZXR1cm4ge1xuICAgICAgd2lkdGg6IGAkezEwMCAvIHRoaXMudGltZVVuaXRRdWV1ZS5sZW5ndGh9JWAsXG4gICAgfTtcbiAgfVxuXG4gIEBjb21wdXRlZFxuICBnZXQgYWN0aXZlU3R5bGUoKTogQ1NTUHJvcGVydGllcyB7XG4gICAgY29uc3QgeyB0aW1lVW5pdFF1ZXVlIH0gPSB0aGlzO1xuICAgIGNvbnN0IHdpZHRoID0gMTAwIC8gdGltZVVuaXRRdWV1ZS5sZW5ndGg7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiBgJHt3aWR0aH0lYCxcbiAgICAgIGxlZnQ6IGAke3RpbWVVbml0UXVldWUuaW5kZXhPZih0aGlzLmdldEN1cnJlbnRVbml0KCkpICogd2lkdGh9JWAsXG4gICAgfTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBzYXZlUGFuZWwobm9kZSkge1xuICAgIHRoaXMucGFuZWwgPSBub2RlO1xuICB9XG5cbiAgZ2V0T2JzZXJ2YWJsZVByb3BzKHByb3BzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGZvcm1hdDogcHJvcHMuZm9ybWF0LFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5wYW5lbCkge1xuICAgICAgLy8g5YW85a65RmlyZWZveCB3aGVlbOS4uumAmueUqOS6i+S7tlxuICAgICAgdGhpcy5wYW5lbC5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHRoaXMuaGFuZGxlV2hlZWwsIHsgcGFzc2l2ZTogZmFsc2UgfSk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucGFuZWwpIHtcbiAgICAgIHRoaXMucGFuZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCB0aGlzLmhhbmRsZVdoZWVsKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlRGF0ZVRpbWVTZWxlY3QoKSB7XG4gICAgdGhpcy5jaGFuZ2VWaWV3TW9kZShWaWV3TW9kZS5kYXRlVGltZSk7XG4gIH1cblxuICBoYW5kbGVLZXlEb3duSG9tZShlKSB7XG4gICAgdGhpcy5oYW5kbGVLZXlEb3duUGFnZVVwKGUpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93bkVuZChlKSB7XG4gICAgdGhpcy5oYW5kbGVLZXlEb3duUGFnZURvd24oZSk7XG4gIH1cblxuICBoYW5kbGVLZXlEb3duTGVmdChlKSB7XG4gICAgc3RvcEV2ZW50KGUpO1xuICAgIGlmIChlLmFsdEtleSkge1xuICAgICAgaWYgKHRoaXMucHJvcHMubW9kZSAhPT0gVmlld01vZGUudGltZSkge1xuICAgICAgICB0aGlzLmNoYW5nZVZpZXdNb2RlKFZpZXdNb2RlLmRhdGVUaW1lKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGFuZ2VVbml0KHRoaXMuZ2V0UHJldlVuaXQoKSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5RG93blJpZ2h0KGUpIHtcbiAgICBzdG9wRXZlbnQoZSk7XG4gICAgaWYgKCFlLmFsdEtleSkge1xuICAgICAgdGhpcy5jaGFuZ2VVbml0KHRoaXMuZ2V0TmV4dFVuaXQoKSk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5RG93blVwKGUpIHtcbiAgICBzdG9wRXZlbnQoZSk7XG4gICAgY29uc3QgdW5pdCA9IHRoaXMuZ2V0Q3VycmVudFVuaXQoKTtcbiAgICBpZiAodW5pdCA9PT0gVGltZVVuaXQuYSkge1xuICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGUodGhpcy5nZXRDbG9uZURhdGUoKS5zdWJ0cmFjdCgxMiwgVGltZVVuaXQuaG91cikpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IHN0ZXAgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCB1bml0U3RlcCA9IHN0ZXBbc3RlcE1hcHBpbmdbdW5pdF1dIHx8IDE7XG4gICAgICBjb25zdCBkYXRlID0gdGhpcy5nZXRDbG9uZURhdGUoKTtcbiAgICAgIGNvbnN0IHBhcmVudFVuaXQgPSB1bml0ID09PSBUaW1lVW5pdC5zZWNvbmQgPyBUaW1lVW5pdC5taW51dGUgOiB1bml0ID09PSBUaW1lVW5pdC5taW51dGUgPyBUaW1lVW5pdC5ob3VyIDogbnVsbDtcbiAgICAgIGlmIChwYXJlbnRVbml0KSB7XG4gICAgICAgIGNvbnN0IHBhcmVudFN0ZXAgPSBzdGVwW3N0ZXBNYXBwaW5nW3BhcmVudFVuaXRdXTtcbiAgICAgICAgaWYgKHBhcmVudFN0ZXApIHtcbiAgICAgICAgICBjb25zdCBwcmVWYWx1ZSA9IGRhdGUuZ2V0KHBhcmVudFVuaXQpO1xuICAgICAgICAgIGRhdGUuc3VidHJhY3QodW5pdFN0ZXAsIHVuaXQpO1xuICAgICAgICAgIGlmIChwcmVWYWx1ZSAhPT0gZGF0ZS5nZXQocGFyZW50VW5pdCkpIHtcbiAgICAgICAgICAgIGRhdGUuc3VidHJhY3QocGFyZW50U3RlcCAtIDEsIHBhcmVudFVuaXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZShkYXRlKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKGRhdGUuc3VidHJhY3QodW5pdFN0ZXAsIHVuaXQpKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVLZXlEb3duRG93bihlKSB7XG4gICAgc3RvcEV2ZW50KGUpO1xuICAgIGNvbnN0IHVuaXQgPSB0aGlzLmdldEN1cnJlbnRVbml0KCk7XG4gICAgaWYgKHVuaXQgPT09IFRpbWVVbml0LmEpIHtcbiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKHRoaXMuZ2V0Q2xvbmVEYXRlKCkuYWRkKDEyLCBUaW1lVW5pdC5ob3VyKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHsgc3RlcCB9ID0gdGhpcy5wcm9wcztcbiAgICAgIGNvbnN0IHVuaXRTdGVwID0gc3RlcFtzdGVwTWFwcGluZ1t1bml0XV0gfHwgMTtcbiAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLmdldENsb25lRGF0ZSgpO1xuICAgICAgY29uc3QgcGFyZW50VW5pdCA9IHVuaXQgPT09IFRpbWVVbml0LnNlY29uZCA/IFRpbWVVbml0Lm1pbnV0ZSA6IHVuaXQgPT09IFRpbWVVbml0Lm1pbnV0ZSA/IFRpbWVVbml0LmhvdXIgOiBudWxsO1xuICAgICAgaWYgKHBhcmVudFVuaXQpIHtcbiAgICAgICAgY29uc3QgcGFyZW50U3RlcCA9IHN0ZXBbc3RlcE1hcHBpbmdbcGFyZW50VW5pdF1dO1xuICAgICAgICBpZiAocGFyZW50U3RlcCkge1xuICAgICAgICAgIGNvbnN0IHByZVZhbHVlID0gZGF0ZS5nZXQocGFyZW50VW5pdCk7XG4gICAgICAgICAgZGF0ZS5hZGQodW5pdFN0ZXAsIHVuaXQpO1xuICAgICAgICAgIGlmIChwcmVWYWx1ZSAhPT0gZGF0ZS5nZXQocGFyZW50VW5pdCkpIHtcbiAgICAgICAgICAgIGRhdGUuYWRkKHBhcmVudFN0ZXAgLSAxLCBwYXJlbnRVbml0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGUoZGF0ZSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZShkYXRlLmFkZCh1bml0U3RlcCwgdW5pdCkpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUtleURvd25QYWdlVXAoZSkge1xuICAgIHN0b3BFdmVudChlKTtcbiAgICBjb25zdCB1bml0ID0gdGhpcy5nZXRDdXJyZW50VW5pdCgpO1xuICAgIGlmICh1bml0ID09PSBUaW1lVW5pdC5hKSB7XG4gICAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLnNldChUaW1lVW5pdC5ob3VyLCAwKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKHRoaXMuZ2V0Q2xvbmVEYXRlKCkuc2V0KHVuaXQsIDApKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVLZXlEb3duUGFnZURvd24oZSkge1xuICAgIHN0b3BFdmVudChlKTtcbiAgICBjb25zdCB1bml0ID0gdGhpcy5nZXRDdXJyZW50VW5pdCgpO1xuICAgIGlmICh1bml0ID09PSBUaW1lVW5pdC5hKSB7XG4gICAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZSh0aGlzLmdldENsb25lRGF0ZSgpLnNldChUaW1lVW5pdC5ob3VyLCAxMikpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB7IHN0ZXAgfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCB1bml0U3RlcCA9IHN0ZXBbc3RlcE1hcHBpbmdbdW5pdF1dIHx8IDE7XG4gICAgICBjb25zdCBzaXplID0gdW5pdCA9PT0gVGltZVVuaXQuaG91ciA/IHRoaXMudXNlMTJIb3VycyA/IDEyIDogMjQgOiA2MDtcbiAgICAgIHRoaXMuY2hhbmdlU2VsZWN0ZWREYXRlKHRoaXMuZ2V0Q2xvbmVEYXRlKCkuc2V0KHVuaXQsIHNpemUgLSB1bml0U3RlcCkpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZVRpbWVDZWxsQ2xpY2soZGF0ZTogTW9tZW50LCB1bml0OiBUaW1lVW5pdCkge1xuICAgIHRoaXMuY2hhbmdlVW5pdCh1bml0KTtcbiAgICB0aGlzLmNoYW5nZVNlbGVjdGVkRGF0ZShkYXRlKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVXaGVlbChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmIChlLmRlbHRhWSA+IDApIHtcbiAgICAgIHRoaXMuaGFuZGxlS2V5RG93bkRvd24oZSk7XG4gICAgfSBlbHNlIGlmIChlLmRlbHRhWSA8IDApIHtcbiAgICAgIHRoaXMuaGFuZGxlS2V5RG93blVwKGUpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlckhlYWRlcigpOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENscyxcbiAgICAgIHByb3BzOiB7IGRhdGUsIG1vZGUgfSxcbiAgICAgIG9ic2VydmFibGVQcm9wczogeyBmb3JtYXQgfSxcbiAgICB9ID0gdGhpcztcbiAgICBpZiAobW9kZSA9PT0gVmlld01vZGUudGltZSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taGVhZGVyYH0+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXZpZXctc2VsZWN0YH0+XG4gICAgICAgICAgICB7ZGF0ZS5mb3JtYXQoZm9ybWF0KX1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWhlYWRlcmB9PlxuICAgICAgICA8YSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdmlldy1zZWxlY3RgfSBvbkNsaWNrPXt0aGlzLmhhbmRsZU1vbnRoU2VsZWN0fT5cbiAgICAgICAgICB7ZGF0ZS5sb2NhbGVEYXRhKCkubW9udGhzU2hvcnQoZGF0ZSl9XG4gICAgICAgIDwvYT5cbiAgICAgICAgPGEgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXZpZXctc2VsZWN0YH0gb25DbGljaz17dGhpcy5oYW5kbGVEYXRlVGltZVNlbGVjdH0+XG4gICAgICAgICAge2RhdGUuZGF0ZSgpfVxuICAgICAgICA8L2E+XG4gICAgICAgIDxhIGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS12aWV3LXNlbGVjdGB9IG9uQ2xpY2s9e3RoaXMuaGFuZGxlWWVhclNlbGVjdH0+XG4gICAgICAgICAge2RhdGUueWVhcigpfVxuICAgICAgICA8L2E+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyRm9vdGVyKCk6IFJlYWN0Tm9kZSB7XG4gICAgY29uc3QgeyBwcmVmaXhDbHMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWZvb3RlcmB9PlxuICAgICAgICA8YSBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tZm9vdGVyLW5vdy1idG5gfSBvbkNsaWNrPXt0aGlzLmNob29zZS5iaW5kKHRoaXMsIG1vbWVudCgpKX0+XG4gICAgICAgICAgeyRsKCdEYXRlUGlja2VyJywgJ25vdycpfVxuICAgICAgICA8L2E+XG4gICAgICAgIDxhXG4gICAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWZvb3Rlci12aWV3LXNlbGVjdGB9XG4gICAgICAgICAgb25DbGljaz17dGhpcy5jaG9vc2UuYmluZCh0aGlzLCB0aGlzLnByb3BzLmRhdGUpfVxuICAgICAgICA+XG4gICAgICAgICAgeyRsKCdEYXRlUGlja2VyJywgJ29rJyl9XG4gICAgICAgIDwvYT5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJQYW5lbCgpIHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmdldFBhbmVsQ2xhc3MoKTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICByZWY9e3RoaXMuc2F2ZVBhbmVsfVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cbiAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2NsYXNzTmFtZX0taW5uZXJgfT57dGhpcy5yZW5kZXJQYW5lbEJvZHkoKX08L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXJQYW5lbEJvZHkoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7IHNob3dIb3VyLCBzaG93TWludXRlLCBzaG93U2Vjb25kLCB1c2UxMkhvdXJzLCBhY3RpdmVTdHlsZSB9ID0gdGhpcztcbiAgICByZXR1cm4gW1xuICAgICAgc2hvd0hvdXIgJiYgdGhpcy5nZXRUaW1lQmFyKFRpbWVVbml0LmhvdXIpLFxuICAgICAgc2hvd01pbnV0ZSAmJiB0aGlzLmdldFRpbWVCYXIoVGltZVVuaXQubWludXRlKSxcbiAgICAgIHNob3dTZWNvbmQgJiYgdGhpcy5nZXRUaW1lQmFyKFRpbWVVbml0LnNlY29uZCksXG4gICAgICB1c2UxMkhvdXJzICYmIHRoaXMuZ2V0VGltZUJhcihUaW1lVW5pdC5hKSxcbiAgICAgIDxkaXYga2V5PVwiYWN0aXZlXCIgc3R5bGU9e2FjdGl2ZVN0eWxlfSBjbGFzc05hbWU9e2Ake3RoaXMucHJlZml4Q2xzfS10aW1lLWZvY3VzLWFjdGl2ZWB9IC8+LFxuICAgIF07XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgcmVuZGVyQ2VsbChwcm9wczogb2JqZWN0KTogUmVhY3ROb2RlIHtcbiAgICByZXR1cm4gPGxpIHsuLi5wcm9wc30gLz47XG4gIH1cblxuICBnZXRUaW1lQmFyKHVuaXQ6IFRpbWVVbml0KTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCB7XG4gICAgICBwcmVmaXhDbHMsXG4gICAgICB1c2UxMkhvdXJzLFxuICAgICAgcHJvcHM6IHsgZGF0ZSwgcmVuZGVyZXIgPSB0aGlzLnJlbmRlckNlbGwsIGlzVmFsaWREYXRlID0gYWx3YXlzVmFsaWREYXRlLCBzdGVwIH0sXG4gICAgICBvYnNlcnZhYmxlUHJvcHM6IHsgZm9ybWF0IH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3QgaXNVcHBlckNhc2UgPSBmb3JtYXQuaW5kZXhPZignQScpID4gLTE7XG4gICAgY29uc3QgaXRlbXM6IFJlYWN0Tm9kZVtdID0gW107XG4gICAgY29uc3Qgc2VsZWN0ZWQgPSBkYXRlLmNsb25lKCk7XG4gICAgY29uc3QgZmluYWxVbml0ID0gdW5pdCA9PT0gVGltZVVuaXQuYSA/IFRpbWVVbml0LmhvdXIgOiB1bml0O1xuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWUgPSBzZWxlY3RlZC5nZXQoZmluYWxVbml0KTtcbiAgICBjb25zdCBzaXplID0gdW5pdCA9PT0gVGltZVVuaXQuYSA/IDEzIDogdW5pdCA9PT0gVGltZVVuaXQuaG91ciA/IHVzZTEySG91cnMgPyAxMiA6IDI0IDogNjA7XG4gICAgY29uc3QgYmVnaW4gPSB1bml0ID09PSBUaW1lVW5pdC5hID8gc2VsZWN0ZWRWYWx1ZSAlIDEyIDogdW5pdCA9PT0gVGltZVVuaXQuaG91ciAmJiB1c2UxMkhvdXJzICYmIHNlbGVjdGVkVmFsdWUgPiAxMSA/IDEyIDogMDtcbiAgICBjb25zdCBwcmUgPSBkYXRlLmNsb25lKCkuc2V0KGZpbmFsVW5pdCwgYmVnaW4pO1xuICAgIGNvbnN0IGxhc3QgPSBwcmUuY2xvbmUoKS5hZGQoc2l6ZSwgZmluYWxVbml0KTtcbiAgICB3aGlsZSAocHJlLmlzQmVmb3JlKGxhc3QpKSB7XG4gICAgICBjb25zdCBjdXJyZW50ID0gcHJlLmNsb25lKCk7XG4gICAgICBjb25zdCBpc0Rpc2FibGVkID0gIWlzVmFsaWREYXRlKGN1cnJlbnQsIHNlbGVjdGVkKTtcbiAgICAgIGNvbnN0IHRleHQgPSB1bml0ID09PSBUaW1lVW5pdC5hID9cbiAgICAgICAgY3VycmVudC5mb3JtYXQoaXNVcHBlckNhc2UgPyAnQScgOiAnYScpIDpcbiAgICAgICAgU3RyaW5nKHByZS5nZXQodW5pdCkgLSAodXNlMTJIb3VycyAmJiBwcmUuZ2V0KHVuaXQpID4gMTEgPyAxMiA6IDApIHx8ICh1c2UxMkhvdXJzICYmIGZpbmFsVW5pdCA9PT0gVGltZVVuaXQuaG91ciA/IDEyIDogMCkpO1xuICAgICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NOYW1lcyhgJHtwcmVmaXhDbHN9LWNlbGxgLCB7XG4gICAgICAgIFtgJHtwcmVmaXhDbHN9LXNlbGVjdGVkYF06IHVuaXQgPT09IFRpbWVVbml0LmEgPyBjdXJyZW50LmdldChUaW1lVW5pdC5ob3VyKSA9PT0gc2VsZWN0ZWRWYWx1ZSA6IGN1cnJlbnQuaXNTYW1lKHNlbGVjdGVkLCBmaW5hbFVuaXQpLFxuICAgICAgICBbYCR7cHJlZml4Q2xzfS1kaXNhYmxlZGBdOiBpc0Rpc2FibGVkLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBwcm9wczogYW55ID0ge1xuICAgICAgICBrZXk6IHRleHQsXG4gICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgY2hpbGRyZW46IDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWNlbGwtaW5uZXJgfT57dGV4dH08L2Rpdj4sXG4gICAgICB9O1xuICAgICAgaWYgKCFpc0Rpc2FibGVkKSB7XG4gICAgICAgIHByb3BzLm9uQ2xpY2sgPSB0aGlzLmhhbmRsZVRpbWVDZWxsQ2xpY2suYmluZCh0aGlzLCBjdXJyZW50LCB1bml0KTtcbiAgICAgIH1cbiAgICAgIGl0ZW1zLnB1c2gocmVuZGVyZXIocHJvcHMsIHRleHQsIGN1cnJlbnQsIHNlbGVjdGVkKSk7XG4gICAgICBwcmUuYWRkKHVuaXQgPT09IFRpbWVVbml0LmEgPyAxMiA6IChzdGVwW3N0ZXBNYXBwaW5nW3VuaXRdXSB8fCAxKSwgZmluYWxVbml0KTtcbiAgICB9XG4gICAgY29uc3QgdG9wID0gdW5pdCA9PT0gVGltZVVuaXQuYSA/XG4gICAgICAtTWF0aC5mbG9vcihzZWxlY3RlZFZhbHVlIC8gMTIpIDpcbiAgICAgICh1bml0ID09PSBUaW1lVW5pdC5ob3VyICYmIHVzZTEySG91cnMgP1xuICAgICAgICAtc2VsZWN0ZWRWYWx1ZSAlIDEyIDpcbiAgICAgICAgLXNlbGVjdGVkVmFsdWUpIC8gKHN0ZXBbc3RlcE1hcHBpbmdbdW5pdF1dIHx8IDEpO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIGtleT17dW5pdH1cbiAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXRpbWUtbGlzdGB9XG4gICAgICAgIG9uTW91c2VFbnRlcj17dGhpcy5jaGFuZ2VVbml0LmJpbmQodGhpcywgdW5pdCl9XG4gICAgICAgIHN0eWxlPXt0aGlzLmJhclN0eWxlfVxuICAgICAgPlxuICAgICAgICA8dWwgc3R5bGU9e3sgdG9wOiBgJHsodG9wICsgNC41KSAqIDEwMH0lYCB9fT57aXRlbXN9PC91bD5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdGltZS1mb2N1c2B9IC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgZ2V0UGFuZWxDbGFzcygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHt0aGlzLnByZWZpeENsc30tdGltZS1wYW5lbGA7XG4gIH1cblxuICBnZXRDdXJyZW50VW5pdCgpOiBUaW1lVW5pdCB7XG4gICAgY29uc3QgeyBjdXJyZW50VW5pdCB9ID0gdGhpcztcbiAgICByZXR1cm4gY3VycmVudFVuaXQgfHwgdGhpcy50aW1lVW5pdFF1ZXVlWzBdO1xuICB9XG5cbiAgZ2V0UHJldlVuaXQoKTogVGltZVVuaXQge1xuICAgIGNvbnN0IHsgdGltZVVuaXRRdWV1ZSB9ID0gdGhpcztcbiAgICByZXR1cm4gdGltZVVuaXRRdWV1ZVt0aW1lVW5pdFF1ZXVlLmluZGV4T2YodGhpcy5nZXRDdXJyZW50VW5pdCgpKSAtIDFdO1xuICB9XG5cbiAgZ2V0TmV4dFVuaXQoKTogVGltZVVuaXQge1xuICAgIGNvbnN0IHsgdGltZVVuaXRRdWV1ZSB9ID0gdGhpcztcbiAgICByZXR1cm4gdGltZVVuaXRRdWV1ZVt0aW1lVW5pdFF1ZXVlLmluZGV4T2YodGhpcy5nZXRDdXJyZW50VW5pdCgpKSArIDFdO1xuICB9XG5cbiAgQGFjdGlvblxuICBjaGFuZ2VVbml0KHVuaXQ/OiBUaW1lVW5pdCkge1xuICAgIGlmICh1bml0ICE9PSB1bmRlZmluZWQgJiYgdW5pdCAhPT0gdGhpcy5jdXJyZW50VW5pdCkge1xuICAgICAgdGhpcy5jdXJyZW50VW5pdCA9IHVuaXQ7XG4gICAgfVxuICB9XG5cbiAgY2hvb3NlKGRhdGU6IE1vbWVudCkge1xuICAgIGNvbnN0IHsgbW9kZSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobW9kZSAhPT0gVmlld01vZGUudGltZSkge1xuICAgICAgdGhpcy5jaGFuZ2VTZWxlY3RlZERhdGUoZGF0ZSk7XG4gICAgICB0aGlzLmNoYW5nZVZpZXdNb2RlKG1vZGUpO1xuICAgIH1cbiAgICBzdXBlci5jaG9vc2UoZGF0ZSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==