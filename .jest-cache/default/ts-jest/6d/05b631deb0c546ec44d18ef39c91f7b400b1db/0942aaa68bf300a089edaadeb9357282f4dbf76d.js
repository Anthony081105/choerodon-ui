import React, { Component } from 'react';
import moment from 'moment';
import classNames from 'classnames';
import LocaleReceiver from '../locale-provider/LocaleReceiver';
import defaultLocale from './locale/en_US';
import interopDefault from '../_util/interopDefault';
import RcTimePicker from '../rc-components/time-picker';
import { getPrefixCls } from '../configure';
export function generateShowHourMinuteSecond(format) {
    // Ref: http://momentjs.com/docs/#/parsing/string-format/
    return {
        showHour: format.indexOf('H') > -1 || format.indexOf('h') > -1 || format.indexOf('k') > -1,
        showMinute: format.indexOf('m') > -1,
        showSecond: format.indexOf('s') > -1,
    };
}
export default class TimePicker extends Component {
    constructor(props) {
        super(props);
        this.handleChange = (value) => {
            if (!('value' in this.props)) {
                this.setState({ value });
            }
            const { onChange, format = 'HH:mm:ss' } = this.props;
            if (onChange) {
                onChange(value, (value && value.format(format)) || '');
            }
        };
        this.handleOpenClose = ({ open }) => {
            const { onOpenChange } = this.props;
            if (onOpenChange) {
                onOpenChange(open);
            }
        };
        this.saveTimePicker = (timePickerRef) => {
            this.timePickerRef = timePickerRef;
        };
        this.renderTimePicker = (locale) => {
            const props = {
                ...this.props,
            };
            const { value } = this.state;
            delete props.defaultValue;
            const prefixCls = getPrefixCls('time-picker', props.prefixCls);
            const format = this.getDefaultFormat();
            const className = classNames(props.className, {
                [`${prefixCls}-${props.size}`]: !!props.size,
            });
            const addon = (panel) => props.addon ? React.createElement("div", { className: `${prefixCls}-panel-addon` }, props.addon(panel)) : null;
            return (React.createElement(RcTimePicker, Object.assign({}, generateShowHourMinuteSecond(format), props, { prefixCls: prefixCls, ref: this.saveTimePicker, format: format, className: className, value: value, placeholder: props.placeholder === undefined ? locale.placeholder : props.placeholder, onChange: this.handleChange, onOpen: this.handleOpenClose, onClose: this.handleOpenClose, addon: addon })));
        };
        const value = props.value || props.defaultValue;
        if (value && !interopDefault(moment).isMoment(value)) {
            throw new Error('The value/defaultValue of TimePicker must be a moment object');
        }
        this.state = {
            value,
        };
    }
    componentWillReceiveProps(nextProps) {
        if ('value' in nextProps) {
            this.setState({ value: nextProps.value });
        }
    }
    focus() {
        this.timePickerRef.focus();
    }
    blur() {
        this.timePickerRef.blur();
    }
    getDefaultFormat() {
        const { format, use12Hours } = this.props;
        if (format) {
            return format;
        }
        if (use12Hours) {
            return 'h:mm:ss a';
        }
        return 'HH:mm:ss';
    }
    render() {
        return (React.createElement(LocaleReceiver, { componentName: "TimePicker", defaultLocale: defaultLocale }, this.renderTimePicker));
    }
}
TimePicker.displayName = 'TimePicker';
TimePicker.defaultProps = {
    align: {
        offset: [0, -2],
    },
    disabled: false,
    disabledHours: undefined,
    disabledMinutes: undefined,
    disabledSeconds: undefined,
    hideDisabledOptions: false,
    placement: 'bottomLeft',
    transitionName: 'slide-up',
    focusOnOpen: true,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvdGltZS1waWNrZXIvaW5kZXgudHN4IiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUErQixNQUFNLE9BQU8sQ0FBQztBQUN0RSxPQUFPLE1BQWtCLE1BQU0sUUFBUSxDQUFDO0FBQ3hDLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQUNwQyxPQUFPLGNBQWMsTUFBTSxtQ0FBbUMsQ0FBQztBQUMvRCxPQUFPLGFBQWEsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLGNBQWMsTUFBTSx5QkFBeUIsQ0FBQztBQUNyRCxPQUFPLFlBQVksTUFBTSw4QkFBOEIsQ0FBQztBQUV4RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTVDLE1BQU0sVUFBVSw0QkFBNEIsQ0FBQyxNQUFjO0lBQ3pELHlEQUF5RDtJQUN6RCxPQUFPO1FBQ0wsUUFBUSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxRixVQUFVLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ3JDLENBQUM7QUFDSixDQUFDO0FBc0NELE1BQU0sQ0FBQyxPQUFPLE9BQU8sVUFBVyxTQUFRLFNBQStCO0lBbUJyRSxZQUFZLEtBQXNCO1FBQ2hDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQWdCZixpQkFBWSxHQUFHLENBQUMsS0FBYSxFQUFFLEVBQUU7WUFDL0IsSUFBSSxDQUFDLENBQUMsT0FBTyxJ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Q0FDbEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy90aW1lLXBpY2tlci9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgQ1NTUHJvcGVydGllcywgUmVhY3RFbGVtZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IG1vbWVudCwgeyBNb21lbnQgfSBmcm9tICdtb21lbnQnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgTG9jYWxlUmVjZWl2ZXIgZnJvbSAnLi4vbG9jYWxlLXByb3ZpZGVyL0xvY2FsZVJlY2VpdmVyJztcbmltcG9ydCBkZWZhdWx0TG9jYWxlIGZyb20gJy4vbG9jYWxlL2VuX1VTJztcbmltcG9ydCBpbnRlcm9wRGVmYXVsdCBmcm9tICcuLi9fdXRpbC9pbnRlcm9wRGVmYXVsdCc7XG5pbXBvcnQgUmNUaW1lUGlja2VyIGZyb20gJy4uL3JjLWNvbXBvbmVudHMvdGltZS1waWNrZXInO1xuaW1wb3J0IHsgU2l6ZSB9IGZyb20gJy4uL191dGlsL2VudW0nO1xuaW1wb3J0IHsgZ2V0UHJlZml4Q2xzIH0gZnJvbSAnLi4vY29uZmlndXJlJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2hvd0hvdXJNaW51dGVTZWNvbmQoZm9ybWF0OiBzdHJpbmcpIHtcbiAgLy8gUmVmOiBodHRwOi8vbW9tZW50anMuY29tL2RvY3MvIy9wYXJzaW5nL3N0cmluZy1mb3JtYXQvXG4gIHJldHVybiB7XG4gICAgc2hvd0hvdXI6IGZvcm1hdC5pbmRleE9mKCdIJykgPiAtMSB8fCBmb3JtYXQuaW5kZXhPZignaCcpID4gLTEgfHwgZm9ybWF0LmluZGV4T2YoJ2snKSA+IC0xLFxuICAgIHNob3dNaW51dGU6IGZvcm1hdC5pbmRleE9mKCdtJykgPiAtMSxcbiAgICBzaG93U2Vjb25kOiBmb3JtYXQuaW5kZXhPZigncycpID4gLTEsXG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZVBpY2tlclByb3BzIHtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBzaXplPzogU2l6ZTtcbiAgdmFsdWU/OiBNb21lbnQ7XG4gIGRlZmF1bHRWYWx1ZT86IE1vbWVudCB8IE1vbWVudFtdO1xuICBvcGVuPzogYm9vbGVhbjtcbiAgZm9ybWF0Pzogc3RyaW5nO1xuICBvbkNoYW5nZT86ICh0aW1lOiBNb21lbnQsIHRpbWVTdHJpbmc6IHN0cmluZykgPT4gdm9pZDtcbiAgb25PcGVuQ2hhbmdlPzogKG9wZW46IGJvb2xlYW4pID0+IHZvaWQ7XG4gIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIHByZWZpeENscz86IHN0cmluZztcbiAgaGlkZURpc2FibGVkT3B0aW9ucz86IGJvb2xlYW47XG4gIGRpc2FibGVkSG91cnM/OiAoKSA9PiBudW1iZXJbXTtcbiAgZGlzYWJsZWRNaW51dGVzPzogKHNlbGVjdGVkSG91cjogbnVtYmVyKSA9PiBudW1iZXJbXTtcbiAgZGlzYWJsZWRTZWNvbmRzPzogKHNlbGVjdGVkSG91cjogbnVtYmVyLCBzZWxlY3RlZE1pbnV0ZTogbnVtYmVyKSA9PiBudW1iZXJbXTtcbiAgc3R5bGU/OiBDU1NQcm9wZXJ0aWVzO1xuICBnZXRQb3B1cENvbnRhaW5lcj86ICh0cmlnZ2VyTm9kZTogRWxlbWVudCkgPT4gSFRNTEVsZW1lbnQ7XG4gIGFkZG9uPzogRnVuY3Rpb247XG4gIHVzZTEySG91cnM/OiBib29sZWFuO1xuICBmb2N1c09uT3Blbj86IGJvb2xlYW47XG4gIGhvdXJTdGVwPzogbnVtYmVyO1xuICBtaW51dGVTdGVwPzogbnVtYmVyO1xuICBzZWNvbmRTdGVwPzogbnVtYmVyO1xuICBhbGxvd0VtcHR5PzogYm9vbGVhbjtcbiAgaW5wdXRSZWFkT25seT86IGJvb2xlYW47XG4gIGNsZWFyVGV4dD86IHN0cmluZztcbiAgZGVmYXVsdE9wZW5WYWx1ZT86IE1vbWVudDtcbiAgcG9wdXBDbGFzc05hbWU/OiBzdHJpbmc7XG4gIGxhYmVsPzogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRpbWVQaWNrZXJMb2NhbGUge1xuICBwbGFjZWhvbGRlcjogc3RyaW5nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUaW1lUGlja2VyIGV4dGVuZHMgQ29tcG9uZW50PFRpbWVQaWNrZXJQcm9wcywgYW55PiB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdUaW1lUGlja2VyJztcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGFsaWduOiB7XG4gICAgICBvZmZzZXQ6IFswLCAtMl0sXG4gICAgfSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgZGlzYWJsZWRIb3VyczogdW5kZWZpbmVkLFxuICAgIGRpc2FibGVkTWludXRlczogdW5kZWZpbmVkLFxuICAgIGRpc2FibGVkU2Vjb25kczogdW5kZWZpbmVkLFxuICAgIGhpZGVEaXNhYmxlZE9wdGlvbnM6IGZhbHNlLFxuICAgIHBsYWNlbWVudDogJ2JvdHRvbUxlZnQnLFxuICAgIHRyYW5zaXRpb25OYW1lOiAnc2xpZGUtdXAnLFxuICAgIGZvY3VzT25PcGVuOiB0cnVlLFxuICB9O1xuXG4gIHByaXZhdGUgdGltZVBpY2tlclJlZjogYW55O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBUaW1lUGlja2VyUHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wcy52YWx1ZSB8fCBwcm9wcy5kZWZhdWx0VmFsdWU7XG4gICAgaWYgKHZhbHVlICYmICFpbnRlcm9wRGVmYXVsdChtb21lbnQpLmlzTW9tZW50KHZhbHVlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgdmFsdWUvZGVmYXVsdFZhbHVlIG9mIFRpbWVQaWNrZXIgbXVzdCBiZSBhIG1vbWVudCBvYmplY3QnKTtcbiAgICB9XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHZhbHVlLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogVGltZVBpY2tlclByb3BzKSB7XG4gICAgaWYgKCd2YWx1ZScgaW4gbmV4dFByb3BzKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IG5leHRQcm9wcy52YWx1ZSB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVDaGFuZ2UgPSAodmFsdWU6IE1vbWVudCkgPT4ge1xuICAgIGlmICghKCd2YWx1ZScgaW4gdGhpcy5wcm9wcykpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZSB9KTtcbiAgICB9XG4gICAgY29uc3QgeyBvbkNoYW5nZSwgZm9ybWF0ID0gJ0hIOm1tOnNzJyB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAob25DaGFuZ2UpIHtcbiAgICAgIG9uQ2hhbmdlKHZhbHVlLCAodmFsdWUgJiYgdmFsdWUuZm9ybWF0KGZvcm1hdCkpIHx8ICcnKTtcbiAgICB9XG4gIH07XG5cbiAgaGFuZGxlT3BlbkNsb3NlID0gKHsgb3BlbiB9OiB7IG9wZW46IGJvb2xlYW4gfSkgPT4ge1xuICAgIGNvbnN0IHsgb25PcGVuQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChvbk9wZW5DaGFuZ2UpIHtcbiAgICAgIG9uT3BlbkNoYW5nZShvcGVuKTtcbiAgICB9XG4gIH07XG5cbiAgc2F2ZVRpbWVQaWNrZXIgPSAodGltZVBpY2tlclJlZjogUmNUaW1lUGlja2VyIHwgbnVsbCkgPT4ge1xuICAgIHRoaXMudGltZVBpY2tlclJlZiA9IHRpbWVQaWNrZXJSZWY7XG4gIH07XG5cbiAgZm9jdXMoKSB7XG4gICAgdGhpcy50aW1lUGlja2VyUmVmLmZvY3VzKCk7XG4gIH1cblxuICBibHVyKCkge1xuICAgIHRoaXMudGltZVBpY2tlclJlZi5ibHVyKCk7XG4gIH1cblxuICBnZXREZWZhdWx0Rm9ybWF0KCkge1xuICAgIGNvbnN0IHsgZm9ybWF0LCB1c2UxMkhvdXJzIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmIChmb3JtYXQpIHtcbiAgICAgIHJldHVybiBmb3JtYXQ7XG4gICAgfVxuICAgIGlmICh1c2UxMkhvdXJzKSB7XG4gICAgICByZXR1cm4gJ2g6bW06c3MgYSc7XG4gICAgfVxuICAgIHJldHVybiAnSEg6bW06c3MnO1xuICB9XG5cbiAgcmVuZGVyVGltZVBpY2tlciA9IChsb2NhbGU6IFRpbWVQaWNrZXJMb2NhbGUpID0+IHtcbiAgICBjb25zdCBwcm9wczogVGltZVBpY2tlclByb3BzICYgeyBjaGlsZHJlbj86IGFueSB9ID0ge1xuICAgICAgLi4udGhpcy5wcm9wcyxcbiAgICB9O1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgZGVsZXRlIHByb3BzLmRlZmF1bHRWYWx1ZTtcbiAgICBjb25zdCBwcmVmaXhDbHMgPSBnZXRQcmVmaXhDbHMoJ3RpbWUtcGlja2VyJywgcHJvcHMucHJlZml4Q2xzKTtcbiAgICBjb25zdCBmb3JtYXQgPSB0aGlzLmdldERlZmF1bHRGb3JtYXQoKTtcbiAgICBjb25zdCBjbGFzc05hbWUgPSBjbGFzc05hbWVzKHByb3BzLmNsYXNzTmFtZSwge1xuICAgICAgW2Ake3ByZWZpeENsc30tJHtwcm9wcy5zaXplfWBdOiAhIXByb3BzLnNpemUsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhZGRvbiA9IChwYW5lbDogUmVhY3RFbGVtZW50PGFueT4pID0+XG4gICAgICBwcm9wcy5hZGRvbiA/IDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXBhbmVsLWFkZG9uYH0+e3Byb3BzLmFkZG9uKHBhbmVsKX08L2Rpdj4gOiBudWxsO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxSY1RpbWVQaWNrZXJcbiAgICAgICAgey4uLmdlbmVyYXRlU2hvd0hvdXJNaW51dGVTZWNvbmQoZm9ybWF0KX1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgcmVmPXt0aGlzLnNhdmVUaW1lUGlja2VyfVxuICAgICAgICBmb3JtYXQ9e2Zvcm1hdH1cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWV9XG4gICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgcGxhY2Vob2xkZXI9e3Byb3BzLnBsYWNlaG9sZGVyID09PSB1bmRlZmluZWQgPyBsb2NhbGUucGxhY2Vob2xkZXIgOiBwcm9wcy5wbGFjZWhvbGRlcn1cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfVxuICAgICAgICBvbk9wZW49e3RoaXMuaGFuZGxlT3BlbkNsb3NlfVxuICAgICAgICBvbkNsb3NlPXt0aGlzLmhhbmRsZU9wZW5DbG9zZX1cbiAgICAgICAgYWRkb249e2FkZG9ufVxuICAgICAgLz5cbiAgICApO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPExvY2FsZVJlY2VpdmVyIGNvbXBvbmVudE5hbWU9XCJUaW1lUGlja2VyXCIgZGVmYXVsdExvY2FsZT17ZGVmYXVsdExvY2FsZX0+XG4gICAgICAgIHt0aGlzLnJlbmRlclRpbWVQaWNrZXJ9XG4gICAgICA8L0xvY2FsZVJlY2VpdmVyPlxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==