import React, { Component, } from 'react';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import omit from 'lodash/omit';
import Icon from '../icon';
import { getPrefixCls } from '../configure';
function fixControlledValue(value) {
    if (typeof value === 'undefined' || value === null) {
        return '';
    }
    return value;
}
export default class Input extends Component {
    constructor(props) {
        super(props);
        this.handleKeyDown = (e) => {
            const { onPressEnter, onKeyDown } = this.props;
            if (e.keyCode === 13 && onPressEnter) {
                onPressEnter(e);
            }
            if (onKeyDown) {
                onKeyDown(e);
            }
        };
        this.handleFocus = (e) => {
            const { onFocus, readOnly } = this.props;
            if (!readOnly) {
                this.setState({
                    focused: true,
                });
            }
            if (onFocus) {
                onFocus(e);
            }
        };
        this.handleBlur = (e) => {
            const { onBlur, readOnly } = this.props;
            if (!readOnly) {
                this.setState({
                    focused: false,
                });
            }
            if (onBlur) {
                onBlur(e);
            }
        };
        this.handleChange = e => {
            const { onChange } = this.props;
            if (!('value' in this.props)) {
                this.setState({ value: e.target.value });
            }
            if (onChange) {
                onChange(e);
            }
        };
        this.handleCopy = () => {
            const { onCopy } = this.props;
            this.input.select();
            document.execCommand('Copy');
            if (onCopy) {
                onCopy(this.input.value);
            }
        };
        this.handleTogglePassword = () => {
            const { showPassword } = this.state;
            this.setState({
                showPassword: !showPassword,
            });
        };
        this.saveInput = (node) => {
            this.input = node;
        };
        this.saveRenderedRef = (node) => {
            this.rendered = node;
        };
        this.savePrefix = (node) => {
            this.prefix = node;
        };
        this.saveSuffix = (node) => {
            this.suffix = node;
        };
        this.state = {
            value: typeof props.value === 'undefined' ? props.defaultValue : props.value,
            focused: false,
            showPassword: false,
        };
    }
    componentDidMount() {
        const { focused, autoFocus } = this.props;
        if (autoFocus) {
            this.setState({
                focused: true,
            });
        }
        if (typeof focused === 'boolean') {
            this.setState({
                focused,
            });
        }
        this.setRenderedStyle();
    }
    componentWillReceiveProps(nextProps) {
        const { value } = this.state;
        if ('value' in nextProps && value !== nextProps.value) {
            this.setState({
                value: nextProps.value,
            });
        }
        if (nextProps.autoFocus) {
            this.setState({
                focused: true,
            });
        }
        if (typeof nextProps.focused === 'boolean') {
            this.setState({
                focused: nextProps.focused,
            });
        }
        if (nextProps.type !== 'password') {
            this.setState({
                showPassword: false,
            });
        }
    }
    componentDidUpdate() {
        this.setRenderedStyle();
    }
    setRenderedStyle() {
        const { rendered, suffix, prefix } = this;
        let suffixWidth;
        let prefixWidth;
        let margin = '0';
        let width = '100%';
        if (suffix && prefix) {
            suffixWidth = `${(suffix.clientWidth || -2) + 2}px`;
            prefixWidth = `${(prefix.clientWidth || -2) + 2}px`;
            margin = `0 ${suffixWidth} 0 ${prefixWidth}`;
            width = `calc(100% - ${suffixWidth} - ${prefixWidth})`;
        }
        else if (suffix) {
            suffixWidth = `${(suffix.clientWidth || -2) + 2}px`;
            margin = `0 ${suffixWidth} 0 0`;
            width = `calc(100% - ${suffixWidth})`;
        }
        else if (prefix) {
            prefixWidth = `${(prefix.clientWidth || -2) + 2}px`;
            margin = `0 0 0 ${prefixWidth}`;
            width = `calc(100% - ${prefixWidth})`;
        }
        rendered.style.margin = margin;
        rendered.style.width = width;
    }
    focus() {
        this.input.focus();
    }
    blur() {
        this.input.blur();
    }
    getPrefixCls() {
        const { prefixCls } = this.props;
        return getPrefixCls('input', prefixCls);
    }
    getInputClassName() {
        const { size, copy } = this.props;
        const prefixCls = this.getPrefixCls();
        return classNames(prefixCls, {
            [`${prefixCls}-sm`]: size === "small" /* small */,
            [`${prefixCls}-lg`]: size === "large" /* large */,
            [`${prefixCls}-has-copy`]: copy,
        });
    }
    renderCopyIcon() {
        const { copy } = this.props;
        const prefixCls = this.getPrefixCls();
        return copy ? (React.createElement("span", { className: `${prefixCls}-icon`, onClick: this.handleCopy },
            React.createElement(Icon, { className: `${prefixCls}-icon-copy`, type: "library_books" }))) : null;
    }
    renderShowPassword() {
        const { type } = this.props;
        const prefixCls = this.getPrefixCls();
        const { showPassword } = this.state;
        return type === 'password' ? (React.createElement("span", { className: `${prefixCls}-icon`, onClick: this.handleTogglePassword },
            React.createElement(Icon, { className: `${prefixCls}-icon-copy`, type: showPassword ? 'visibility' : 'visibility_off' }))) : null;
    }
    renderInput() {
        const { className, type } = this.props;
        const { showPassword, value } = this.state;
        // Fix https://fb.me/react-unknown-prop
        const otherProps = omit(this.props, [
            'placeholder',
            'prefixCls',
            'onPressEnter',
            'addonBefore',
            'addonAfter',
            'prefix',
            'suffix',
            'label',
            'copy',
            'style',
            'focused',
            'showLengthInfo',
            'showPasswordEye',
            'size',
            'border',
        ]);
        return (React.createElement("input", Object.assign({}, otherProps, { value: fixControlledValue(value), className: classNames(this.getInputClassName(), className), onKeyDown: this.handleKeyDown, ref: this.saveInput, onFocus: this.handleFocus, onBlur: this.handleBlur, onChange: this.handleChange, type: showPassword ? 'text' : type })));
    }
    getLengthInfo() {
        const { maxLength, showLengthInfo } = this.props;
        const prefixCls = this.getPrefixCls();
        const { value } = this.state;
        const inputLength = value ? value.length : 0;
        return (maxLength && showLengthInfo) ||
            (maxLength && maxLength > 0 && inputLength === maxLength) ? (React.createElement("div", { className: `${prefixCls}-length-info` }, `${inputLength}/${maxLength}`)) : null;
    }
    getLabel() {
        const { placeholder, label } = this.props;
        if (!this.hasValue() && placeholder) {
            return placeholder;
        }
        return label;
    }
    renderFloatLabel() {
        const label = this.getLabel();
        const { border } = this.props;
        if (label && border) {
            const prefixCls = this.getPrefixCls();
            return (React.createElement("div", { className: `${prefixCls}-label-wrapper` },
                React.createElement("div", { className: `${prefixCls}-label` }, label)));
        }
    }
    getSizeClassName(name) {
        const { size } = this.props;
        const prefixCls = this.getPrefixCls();
        return classNames(`${prefixCls}-${name}`, {
            [`${prefixCls}-${name}-sm`]: size === "small" /* small */,
            [`${prefixCls}-${name}-lg`]: size === "large" /* large */,
        });
    }
    hasValue() {
        const { value } = this.state;
        return value && value.length !== 0;
    }
    renderPlaceholder() {
        const { placeholder, border } = this.props;
        if (!border && placeholder) {
            const prefixCls = this.getPrefixCls();
            return React.createElement("div", { className: `${prefixCls}-placeholder` }, placeholder);
        }
    }
    render() {
        const props = this.props;
        const { disabled, label, style, showPasswordEye, border } = this.props;
        const prefixCls = this.getPrefixCls();
        const { focused } = this.state;
        const prefix = props.prefix ? (React.createElement("span", { ref: this.savePrefix, className: this.getSizeClassName('prefix') }, props.prefix)) : null;
        const suffix = props.suffix ? (React.createElement("span", { ref: this.saveSuffix, className: this.getSizeClassName('suffix') }, props.suffix)) : null;
        const className = classNames(`${prefixCls}-wrapper`, {
            [`${prefixCls}-has-value`]: this.hasValue(),
            [`${prefixCls}-focused`]: focused,
            [`${prefixCls}-disabled`]: disabled,
            [`${prefixCls}-has-label`]: !!label,
            [`${prefixCls}-has-prefix`]: !!prefix,
            [`${prefixCls}-has-suffix`]: !!suffix,
            [`${prefixCls}-has-border`]: border,
        });
        return (React.createElement("span", { className: className, style: style },
            React.createElement("div", { className: `${prefixCls}-content` },
                React.createElement("div", { className: `${prefixCls}-rendered-wrapper` },
                    prefix,
                    React.createElement("div", { className: this.getSizeClassName('rendered'), ref: this.saveRenderedRef },
                        this.renderPlaceholder(),
                        this.renderInput(),
                        this.renderFloatLabel(),
                        this.renderCopyIcon(),
                        showPasswordEye ? this.renderShowPassword() : null),
                    suffix),
                this.getLengthInfo())));
    }
}
Input.displayName = 'Input';
Input.defaultProps = {
    type: 'text',
    disabled: false,
    readOnly: false,
    showLengthInfo: true,
    showPasswordEye: false,
    border: true,
};
Input.propTypes = {
    type: PropTypes.string,
    id: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),
    label: PropTypes.node,
    size: PropTypes.oneOf(["small" /* small */, "default" /* default */, "large" /* large */]),
    maxLength: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),
    disabled: PropTypes.bool,
    value: PropTypes.any,
    defaultValue: PropTypes.any,
    className: PropTypes.string,
    addonBefore: PropTypes.node,
    addonAfter: PropTypes.node,
    prefixCls: PropTypes.string,
    autosize: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),
    onPressEnter: PropTypes.func,
    onKeyDown: PropTypes.func,
    onKeyUp: PropTypes.func,
    onFocus: PropTypes.func,
    onBlur: PropTypes.func,
    prefix: PropTypes.node,
    suffix: PropTypes.node,
    copy: PropTypes.bool,
    onCopy: PropTypes.func,
    readOnly: PropTypes.bool,
    focused: PropTypes.bool,
    border: PropTypes.bool,
    showLengthInfo: PropTypes.bool,
    showPasswordEye: PropTypes.bool,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvaW5wdXQvSW5wdXQudHN4IiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBRVosU0FBUyxHQU1WLE1BQU0sT0FBTyxDQUFDO0FBQ2YsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFDO0FBQ25DLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQUNwQyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFJL0IsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFDO0FBRTNCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFNUMsU0FBUyxrQkFBa0IsQ0FBQyxLQUFnQztJQUMxRCxJQUFJLE9BQU8sS0FBSyxLQUFLLFdBQVcsSUFBSSxLQUFLLEtBQUssSUFBSSxFQUFFO1FBQ2xELE9BQU8sRUFBRSxDQUFDO0tBQ1g7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUFtREQsTUFBTSxDQUFDLE9BQU8sT0FBTyxLQUFNLFNBQVEsU0FBMEI7SUEwRDNELFlBQVksS0FBSztRQUNmLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQVFmLGtCQUFhLEdBQUcsQ0FBQyxDQUFrQyxFQUFFLEVBQUU7WUFDckQsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQy9DLElBQUksQ0FBQyxDQUFDLE9BQU8sS0FBSyxFQUFFLElBQUksWUFBWSxFQUFFO2dCQUNwQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDakI7WUFDRCxJQUFJLFNBQVMsRUFBRTtnQkFDYixTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDZDtRQUNILENBQUMsQ0FBQztRQXFFRixnQkFBVyxHQUFHLENBQUMsQ0FBK0IsRUFBRSxFQUFFO1lBQ2hELE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN6QyxJ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Q0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy9pbnB1dC9JbnB1dC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gIENoYW5nZUV2ZW50SGFuZGxlcixcbiAgQ29tcG9uZW50LFxuICBDU1NQcm9wZXJ0aWVzLFxuICBGb2N1c0V2ZW50LFxuICBGb3JtRXZlbnRIYW5kbGVyLFxuICBLZXlib2FyZEV2ZW50LFxuICBSZWFjdE5vZGUsXG59IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBvbWl0IGZyb20gJ2xvZGFzaC9vbWl0JztcbmltcG9ydCBHcm91cCBmcm9tICcuL0dyb3VwJztcbmltcG9ydCBTZWFyY2ggZnJvbSAnLi9TZWFyY2gnO1xuaW1wb3J0IFRleHRBcmVhIGZyb20gJy4vVGV4dEFyZWEnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgeyBTaXplIH0gZnJvbSAnLi4vX3V0aWwvZW51bSc7XG5pbXBvcnQgeyBnZXRQcmVmaXhDbHMgfSBmcm9tICcuLi9jb25maWd1cmUnO1xuXG5mdW5jdGlvbiBmaXhDb250cm9sbGVkVmFsdWUodmFsdWU6IHVuZGVmaW5lZCB8IG51bGwgfCBzdHJpbmcpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFic3RyYWN0SW5wdXRQcm9wcyB7XG4gIHByZWZpeENscz86IHN0cmluZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBkZWZhdWx0VmFsdWU/OiBhbnk7XG4gIHZhbHVlPzogYW55O1xuICB0YWJJbmRleD86IG51bWJlcjtcbiAgc3R5bGU/OiBDU1NQcm9wZXJ0aWVzO1xuICBsYWJlbD86IFJlYWN0Tm9kZTtcbiAgc2hvd0xlbmd0aEluZm8/OiBib29sZWFuO1xuICBzaG93UGFzc3dvcmRFeWU/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElucHV0UHJvcHMgZXh0ZW5kcyBBYnN0cmFjdElucHV0UHJvcHMge1xuICBwbGFjZWhvbGRlcj86IHN0cmluZztcbiAgY29weT86IGJvb2xlYW47XG4gIHR5cGU/OiBzdHJpbmc7XG4gIGlkPzogc3RyaW5nO1xuICBuYW1lPzogc3RyaW5nO1xuICBzaXplPzogU2l6ZTtcbiAgbWF4TGVuZ3RoPzogbnVtYmVyO1xuICBkaXNhYmxlZD86IGJvb2xlYW47XG4gIHJlYWRPbmx5PzogYm9vbGVhbjtcbiAgYWRkb25CZWZvcmU/OiBSZWFjdE5vZGU7XG4gIGFkZG9uQWZ0ZXI/OiBSZWFjdE5vZGU7XG4gIG9uUHJlc3NFbnRlcj86IEZvcm1FdmVudEhhbmRsZXI8SFRNTElucHV0RWxlbWVudD47XG4gIG9uS2V5RG93bj86IEZvcm1FdmVudEhhbmRsZXI8SFRNTElucHV0RWxlbWVudD47XG4gIG9uS2V5VXA/OiBGb3JtRXZlbnRIYW5kbGVyPEhUTUxJbnB1dEVsZW1lbnQ+O1xuICBvbkNoYW5nZT86IENoYW5nZUV2ZW50SGFuZGxlcjxIVE1MSW5wdXRFbGVtZW50PjtcbiAgb25DbGljaz86IEZvcm1FdmVudEhhbmRsZXI8SFRNTElucHV0RWxlbWVudD47XG4gIG9uRm9jdXM/OiBGb3JtRXZlbnRIYW5kbGVyPEhUTUxJbnB1dEVsZW1lbnQ+O1xuICBvbkJsdXI/OiBGb3JtRXZlbnRIYW5kbGVyPEhUTUxJbnB1dEVsZW1lbnQ+O1xuICBvbklucHV0PzogRm9ybUV2ZW50SGFuZGxlcjxIVE1MSW5wdXRFbGVtZW50PjtcbiAgb25Db3B5PzogKHZhbHVlOiBhbnkpID0+IHZvaWQ7XG4gIGF1dG9Db21wbGV0ZT86IHN0cmluZztcbiAgcHJlZml4PzogUmVhY3ROb2RlO1xuICBzdWZmaXg/OiBSZWFjdE5vZGU7XG4gIHNwZWxsQ2hlY2s/OiBib29sZWFuO1xuICBhdXRvRm9jdXM/OiBib29sZWFuO1xuICBmb2N1c2VkPzogYm9vbGVhbjtcbiAgYm9yZGVyPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbnB1dFN0YXRlIHtcbiAgdmFsdWU/OiBhbnk7XG4gIGZvY3VzZWQ/OiBib29sZWFuO1xuICBzaG93UGFzc3dvcmRFeWU/OiBib29sZWFuO1xuICBzaG93UGFzc3dvcmQ/OiBib29sZWFuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbnB1dCBleHRlbmRzIENvbXBvbmVudDxJbnB1dFByb3BzLCBhbnk+IHtcbiAgc3RhdGljIGRpc3BsYXlOYW1lID0gJ0lucHV0JztcblxuICBzdGF0aWMgR3JvdXA6IHR5cGVvZiBHcm91cDtcblxuICBzdGF0aWMgU2VhcmNoOiB0eXBlb2YgU2VhcmNoO1xuXG4gIHN0YXRpYyBUZXh0QXJlYTogdHlwZW9mIFRleHRBcmVhO1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgdHlwZTogJ3RleHQnLFxuICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICByZWFkT25seTogZmFsc2UsXG4gICAgc2hvd0xlbmd0aEluZm86IHRydWUsXG4gICAgc2hvd1Bhc3N3b3JkRXllOiBmYWxzZSxcbiAgICBib3JkZXI6IHRydWUsXG4gIH07XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICB0eXBlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGlkOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMubnVtYmVyXSksXG4gICAgbGFiZWw6IFByb3BUeXBlcy5ub2RlLFxuICAgIHNpemU6IFByb3BUeXBlcy5vbmVPZihbU2l6ZS5zbWFsbCwgU2l6ZS5kZWZhdWx0LCBTaXplLmxhcmdlXSksXG4gICAgbWF4TGVuZ3RoOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuc3RyaW5nLCBQcm9wVHlwZXMubnVtYmVyXSksXG4gICAgZGlzYWJsZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55LFxuICAgIGRlZmF1bHRWYWx1ZTogUHJvcFR5cGVzLmFueSxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgYWRkb25CZWZvcmU6IFByb3BUeXBlcy5ub2RlLFxuICAgIGFkZG9uQWZ0ZXI6IFByb3BUeXBlcy5ub2RlLFxuICAgIHByZWZpeENsczogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBhdXRvc2l6ZTogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmJvb2wsIFByb3BUeXBlcy5vYmplY3RdKSxcbiAgICBvblByZXNzRW50ZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uS2V5RG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25LZXlVcDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Gb2N1czogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25CbHVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBwcmVmaXg6IFByb3BUeXBlcy5ub2RlLFxuICAgIHN1ZmZpeDogUHJvcFR5cGVzLm5vZGUsXG4gICAgY29weTogUHJvcFR5cGVzLmJvb2wsXG4gICAgb25Db3B5OiBQcm9wVHlwZXMuZnVuYyxcbiAgICByZWFkT25seTogUHJvcFR5cGVzLmJvb2wsXG4gICAgZm9jdXNlZDogUHJvcFR5cGVzLmJvb2wsXG4gICAgYm9yZGVyOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBzaG93TGVuZ3RoSW5mbzogUHJvcFR5cGVzLmJvb2wsXG4gICAgc2hvd1Bhc3N3b3JkRXllOiBQcm9wVHlwZXMuYm9vbCxcbiAgfTtcblxuICBzdGF0ZTogSW5wdXRTdGF0ZTtcblxuICBpbnB1dDogSFRNTElucHV0RWxlbWVudDtcblxuICByZW5kZXJlZDogSFRNTERpdkVsZW1lbnQ7XG5cbiAgcHJlZml4OiBIVE1MU3BhbkVsZW1lbnQ7XG5cbiAgc3VmZml4OiBIVE1MU3BhbkVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHZhbHVlOiB0eXBlb2YgcHJvcHMudmFsdWUgPT09ICd1bmRlZmluZWQnID8gcHJvcHMuZGVmYXVsdFZhbHVlIDogcHJvcHMudmFsdWUsXG4gICAgICBmb2N1c2VkOiBmYWxzZSxcbiAgICAgIHNob3dQYXNzd29yZDogZmFsc2UsXG4gICAgfTtcbiAgfVxuXG4gIGhhbmRsZUtleURvd24gPSAoZTogS2V5Ym9hcmRFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4ge1xuICAgIGNvbnN0IHsgb25QcmVzc0VudGVyLCBvbktleURvd24gfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMTMgJiYgb25QcmVzc0VudGVyKSB7XG4gICAgICBvblByZXNzRW50ZXIoZSk7XG4gICAgfVxuICAgIGlmIChvbktleURvd24pIHtcbiAgICAgIG9uS2V5RG93bihlKTtcbiAgICB9XG4gIH07XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgY29uc3QgeyBmb2N1c2VkLCBhdXRvRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKGF1dG9Gb2N1cykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGZvY3VzZWQ6IHRydWUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBmb2N1c2VkID09PSAnYm9vbGVhbicpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBmb2N1c2VkLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuc2V0UmVuZGVyZWRTdHlsZSgpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHM6IElucHV0UHJvcHMpIHtcbiAgICBjb25zdCB7IHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGlmICgndmFsdWUnIGluIG5leHRQcm9wcyAmJiB2YWx1ZSAhPT0gbmV4dFByb3BzLnZhbHVlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgdmFsdWU6IG5leHRQcm9wcy52YWx1ZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAobmV4dFByb3BzLmF1dG9Gb2N1cykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGZvY3VzZWQ6IHRydWUsXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBuZXh0UHJvcHMuZm9jdXNlZCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgZm9jdXNlZDogbmV4dFByb3BzLmZvY3VzZWQsXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKG5leHRQcm9wcy50eXBlICE9PSAncGFzc3dvcmQnKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgc2hvd1Bhc3N3b3JkOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnNldFJlbmRlcmVkU3R5bGUoKTtcbiAgfVxuXG4gIHNldFJlbmRlcmVkU3R5bGUoKSB7XG4gICAgY29uc3QgeyByZW5kZXJlZCwgc3VmZml4LCBwcmVmaXggfSA9IHRoaXM7XG4gICAgbGV0IHN1ZmZpeFdpZHRoOiBzdHJpbmc7XG4gICAgbGV0IHByZWZpeFdpZHRoOiBzdHJpbmc7XG4gICAgbGV0IG1hcmdpbjogc3RyaW5nID0gJzAnO1xuICAgIGxldCB3aWR0aDogc3RyaW5nID0gJzEwMCUnO1xuICAgIGlmIChzdWZmaXggJiYgcHJlZml4KSB7XG4gICAgICBzdWZmaXhXaWR0aCA9IGAkeyhzdWZmaXguY2xpZW50V2lkdGggfHwgLTIpICsgMn1weGA7XG4gICAgICBwcmVmaXhXaWR0aCA9IGAkeyhwcmVmaXguY2xpZW50V2lkdGggfHwgLTIpICsgMn1weGA7XG4gICAgICBtYXJnaW4gPSBgMCAke3N1ZmZpeFdpZHRofSAwICR7cHJlZml4V2lkdGh9YDtcbiAgICAgIHdpZHRoID0gYGNhbGMoMTAwJSAtICR7c3VmZml4V2lkdGh9IC0gJHtwcmVmaXhXaWR0aH0pYDtcbiAgICB9IGVsc2UgaWYgKHN1ZmZpeCkge1xuICAgICAgc3VmZml4V2lkdGggPSBgJHsoc3VmZml4LmNsaWVudFdpZHRoIHx8IC0yKSArIDJ9cHhgO1xuICAgICAgbWFyZ2luID0gYDAgJHtzdWZmaXhXaWR0aH0gMCAwYDtcbiAgICAgIHdpZHRoID0gYGNhbGMoMTAwJSAtICR7c3VmZml4V2lkdGh9KWA7XG4gICAgfSBlbHNlIGlmIChwcmVmaXgpIHtcbiAgICAgIHByZWZpeFdpZHRoID0gYCR7KHByZWZpeC5jbGllbnRXaWR0aCB8fCAtMikgKyAyfXB4YDtcbiAgICAgIG1hcmdpbiA9IGAwIDAgMCAke3ByZWZpeFdpZHRofWA7XG4gICAgICB3aWR0aCA9IGBjYWxjKDEwMCUgLSAke3ByZWZpeFdpZHRofSlgO1xuICAgIH1cbiAgICByZW5kZXJlZC5zdHlsZS5tYXJnaW4gPSBtYXJnaW47XG4gICAgcmVuZGVyZWQuc3R5bGUud2lkdGggPSB3aWR0aDtcbiAgfVxuXG4gIGhhbmRsZUZvY3VzID0gKGU6IEZvY3VzRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCB7IG9uRm9jdXMsIHJlYWRPbmx5IH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghcmVhZE9ubHkpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBmb2N1c2VkOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChvbkZvY3VzKSB7XG4gICAgICBvbkZvY3VzKGUpO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVCbHVyID0gKGU6IEZvY3VzRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICBjb25zdCB7IG9uQmx1ciwgcmVhZE9ubHkgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCFyZWFkT25seSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmIChvbkJsdXIpIHtcbiAgICAgIG9uQmx1cihlKTtcbiAgICB9XG4gIH07XG5cbiAgaGFuZGxlQ2hhbmdlID0gZSA9PiB7XG4gICAgY29uc3QgeyBvbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoISgndmFsdWUnIGluIHRoaXMucHJvcHMpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWU6IGUudGFyZ2V0LnZhbHVlIH0pO1xuICAgIH1cbiAgICBpZiAob25DaGFuZ2UpIHtcbiAgICAgIG9uQ2hhbmdlKGUpO1xuICAgIH1cbiAgfTtcblxuICBoYW5kbGVDb3B5ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgb25Db3B5IH0gPSB0aGlzLnByb3BzO1xuICAgIHRoaXMuaW5wdXQuc2VsZWN0KCk7XG4gICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ0NvcHknKTtcbiAgICBpZiAob25Db3B5KSB7XG4gICAgICBvbkNvcHkodGhpcy5pbnB1dC52YWx1ZSk7XG4gICAgfVxuICB9O1xuXG4gIGhhbmRsZVRvZ2dsZVBhc3N3b3JkID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgc2hvd1Bhc3N3b3JkIH0gPSB0aGlzLnN0YXRlO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc2hvd1Bhc3N3b3JkOiAhc2hvd1Bhc3N3b3JkLFxuICAgIH0pO1xuICB9O1xuXG4gIHNhdmVJbnB1dCA9IChub2RlOiBIVE1MSW5wdXRFbGVtZW50KSA9PiB7XG4gICAgdGhpcy5pbnB1dCA9IG5vZGU7XG4gIH07XG5cbiAgc2F2ZVJlbmRlcmVkUmVmID0gKG5vZGU6IEhUTUxEaXZFbGVtZW50KSA9PiB7XG4gICAgdGhpcy5yZW5kZXJlZCA9IG5vZGU7XG4gIH07XG5cbiAgc2F2ZVByZWZpeCA9IChub2RlOiBIVE1MU3BhbkVsZW1lbnQpID0+IHtcbiAgICB0aGlzLnByZWZpeCA9IG5vZGU7XG4gIH07XG5cbiAgc2F2ZVN1ZmZpeCA9IChub2RlOiBIVE1MU3BhbkVsZW1lbnQpID0+IHtcbiAgICB0aGlzLnN1ZmZpeCA9IG5vZGU7XG4gIH07XG5cbiAgZm9jdXMoKSB7XG4gICAgdGhpcy5pbnB1dC5mb2N1cygpO1xuICB9XG5cbiAgYmx1cigpIHtcbiAgICB0aGlzLmlucHV0LmJsdXIoKTtcbiAgfVxuXG4gIGdldFByZWZpeENscygpIHtcbiAgICBjb25zdCB7IHByZWZpeENscyB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gZ2V0UHJlZml4Q2xzKCdpbnB1dCcsIHByZWZpeENscyk7XG4gIH1cblxuICBnZXRJbnB1dENsYXNzTmFtZSgpIHtcbiAgICBjb25zdCB7IHNpemUsIGNvcHkgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcHJlZml4Q2xzID0gdGhpcy5nZXRQcmVmaXhDbHMoKTtcbiAgICByZXR1cm4gY2xhc3NOYW1lcyhwcmVmaXhDbHMsIHtcbiAgICAgIFtgJHtwcmVmaXhDbHN9LXNtYF06IHNpemUgPT09IFNpemUuc21hbGwsXG4gICAgICBbYCR7cHJlZml4Q2xzfS1sZ2BdOiBzaXplID09PSBTaXplLmxhcmdlLFxuICAgICAgW2Ake3ByZWZpeENsc30taGFzLWNvcHlgXTogY29weSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlckNvcHlJY29uKCkge1xuICAgIGNvbnN0IHsgY29weSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBwcmVmaXhDbHMgPSB0aGlzLmdldFByZWZpeENscygpO1xuICAgIHJldHVybiBjb3B5ID8gKFxuICAgICAgPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWljb25gfSBvbkNsaWNrPXt0aGlzLmhhbmRsZUNvcHl9PlxuICAgICAgICA8SWNvbiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taWNvbi1jb3B5YH0gdHlwZT1cImxpYnJhcnlfYm9va3NcIiAvPlxuICAgICAgPC9zcGFuPlxuICAgICkgOiBudWxsO1xuICB9XG5cbiAgcmVuZGVyU2hvd1Bhc3N3b3JkKCkge1xuICAgIGNvbnN0IHsgdHlwZSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBwcmVmaXhDbHMgPSB0aGlzLmdldFByZWZpeENscygpO1xuICAgIGNvbnN0IHsgc2hvd1Bhc3N3b3JkIH0gPSB0aGlzLnN0YXRlO1xuICAgIHJldHVybiB0eXBlID09PSAncGFzc3dvcmQnID8gKFxuICAgICAgPHNwYW4gY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWljb25gfSBvbkNsaWNrPXt0aGlzLmhhbmRsZVRvZ2dsZVBhc3N3b3JkfT5cbiAgICAgICAgPEljb25cbiAgICAgICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30taWNvbi1jb3B5YH1cbiAgICAgICAgICB0eXBlPXtzaG93UGFzc3dvcmQgPyAndmlzaWJpbGl0eScgOiAndmlzaWJpbGl0eV9vZmYnfVxuICAgICAgICAvPlxuICAgICAgPC9zcGFuPlxuICAgICkgOiBudWxsO1xuICB9XG5cbiAgcmVuZGVySW5wdXQoKSB7XG4gICAgY29uc3QgeyBjbGFzc05hbWUsIHR5cGUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBzaG93UGFzc3dvcmQsIHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIC8vIEZpeCBodHRwczovL2ZiLm1lL3JlYWN0LXVua25vd24tcHJvcFxuICAgIGNvbnN0IG90aGVyUHJvcHMgPSBvbWl0PFxuICAgICAgSW5wdXRQcm9wcyxcbiAgICAgIHwgJ3BsYWNlaG9sZGVyJ1xuICAgICAgfCAncHJlZml4Q2xzJ1xuICAgICAgfCAnb25QcmVzc0VudGVyJ1xuICAgICAgfCAnYWRkb25CZWZvcmUnXG4gICAgICB8ICdhZGRvbkFmdGVyJ1xuICAgICAgfCAncHJlZml4J1xuICAgICAgfCAnc3VmZml4J1xuICAgICAgfCAnbGFiZWwnXG4gICAgICB8ICdjb3B5J1xuICAgICAgfCAnc3R5bGUnXG4gICAgICB8ICdmb2N1c2VkJ1xuICAgICAgfCAnc2hvd0xlbmd0aEluZm8nXG4gICAgICB8ICdzaG93UGFzc3dvcmRFeWUnXG4gICAgICB8ICdzaXplJ1xuICAgICAgfCAnYm9yZGVyJ1xuICAgID4odGhpcy5wcm9wcywgW1xuICAgICAgJ3BsYWNlaG9sZGVyJyxcbiAgICAgICdwcmVmaXhDbHMnLFxuICAgICAgJ29uUHJlc3NFbnRlcicsXG4gICAgICAnYWRkb25CZWZvcmUnLFxuICAgICAgJ2FkZG9uQWZ0ZXInLFxuICAgICAgJ3ByZWZpeCcsXG4gICAgICAnc3VmZml4JyxcbiAgICAgICdsYWJlbCcsXG4gICAgICAnY29weScsXG4gICAgICAnc3R5bGUnLFxuICAgICAgJ2ZvY3VzZWQnLFxuICAgICAgJ3Nob3dMZW5ndGhJbmZvJyxcbiAgICAgICdzaG93UGFzc3dvcmRFeWUnLFxuICAgICAgJ3NpemUnLFxuICAgICAgJ2JvcmRlcicsXG4gICAgXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGlucHV0XG4gICAgICAgIHsuLi5vdGhlclByb3BzfVxuICAgICAgICB2YWx1ZT17Zml4Q29udHJvbGxlZFZhbHVlKHZhbHVlKX1cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKHRoaXMuZ2V0SW5wdXRDbGFzc05hbWUoKSwgY2xhc3NOYW1lKX1cbiAgICAgICAgb25LZXlEb3duPXt0aGlzLmhhbmRsZUtleURvd259XG4gICAgICAgIHJlZj17dGhpcy5zYXZlSW5wdXR9XG4gICAgICAgIG9uRm9jdXM9e3RoaXMuaGFuZGxlRm9jdXN9XG4gICAgICAgIG9uQmx1cj17dGhpcy5oYW5kbGVCbHVyfVxuICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2V9XG4gICAgICAgIHR5cGU9e3Nob3dQYXNzd29yZCA/ICd0ZXh0JyA6IHR5cGV9XG4gICAgICAvPlxuICAgICk7XG4gIH1cblxuICBnZXRMZW5ndGhJbmZvKCkge1xuICAgIGNvbnN0IHsgbWF4TGVuZ3RoLCBzaG93TGVuZ3RoSW5mbyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBwcmVmaXhDbHMgPSB0aGlzLmdldFByZWZpeENscygpO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgaW5wdXRMZW5ndGggPSB2YWx1ZSA/IHZhbHVlLmxlbmd0aCA6IDA7XG4gICAgcmV0dXJuIChtYXhMZW5ndGggJiYgc2hvd0xlbmd0aEluZm8pIHx8XG4gICAgICAobWF4TGVuZ3RoICYmIG1heExlbmd0aCA+IDAgJiYgaW5wdXRMZW5ndGggPT09IG1heExlbmd0aCkgPyAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1sZW5ndGgtaW5mb2B9PntgJHtpbnB1dExlbmd0aH0vJHttYXhMZW5ndGh9YH08L2Rpdj5cbiAgICApIDogbnVsbDtcbiAgfVxuXG4gIGdldExhYmVsKCkge1xuICAgIGNvbnN0IHsgcGxhY2Vob2xkZXIsIGxhYmVsIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghdGhpcy5oYXNWYWx1ZSgpICYmIHBsYWNlaG9sZGVyKSB7XG4gICAgICByZXR1cm4gcGxhY2Vob2xkZXI7XG4gICAgfVxuICAgIHJldHVybiBsYWJlbDtcbiAgfVxuXG4gIHJlbmRlckZsb2F0TGFiZWwoKTogUmVhY3ROb2RlIHtcbiAgICBjb25zdCBsYWJlbCA9IHRoaXMuZ2V0TGFiZWwoKTtcbiAgICBjb25zdCB7IGJvcmRlciB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobGFiZWwgJiYgYm9yZGVyKSB7XG4gICAgICBjb25zdCBwcmVmaXhDbHMgPSB0aGlzLmdldFByZWZpeENscygpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tbGFiZWwtd3JhcHBlcmB9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LWxhYmVsYH0+e2xhYmVsfTwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgZ2V0U2l6ZUNsYXNzTmFtZShuYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCB7IHNpemUgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgcHJlZml4Q2xzID0gdGhpcy5nZXRQcmVmaXhDbHMoKTtcbiAgICByZXR1cm4gY2xhc3NOYW1lcyhgJHtwcmVmaXhDbHN9LSR7bmFtZX1gLCB7XG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke25hbWV9LXNtYF06IHNpemUgPT09IFNpemUuc21hbGwsXG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke25hbWV9LWxnYF06IHNpemUgPT09IFNpemUubGFyZ2UsXG4gICAgfSk7XG4gIH1cblxuICBoYXNWYWx1ZSgpIHtcbiAgICBjb25zdCB7IHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIHJldHVybiB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggIT09IDA7XG4gIH1cblxuICByZW5kZXJQbGFjZWhvbGRlcigpIHtcbiAgICBjb25zdCB7IHBsYWNlaG9sZGVyLCBib3JkZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgaWYgKCFib3JkZXIgJiYgcGxhY2Vob2xkZXIpIHtcbiAgICAgIGNvbnN0IHByZWZpeENscyA9IHRoaXMuZ2V0UHJlZml4Q2xzKCk7XG4gICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tcGxhY2Vob2xkZXJgfT57cGxhY2Vob2xkZXJ9PC9kaXY+O1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBkaXNhYmxlZCwgbGFiZWwsIHN0eWxlLCBzaG93UGFzc3dvcmRFeWUsIGJvcmRlciB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBwcmVmaXhDbHMgPSB0aGlzLmdldFByZWZpeENscygpO1xuICAgIGNvbnN0IHsgZm9jdXNlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBwcmVmaXggPSBwcm9wcy5wcmVmaXggPyAoXG4gICAgICA8c3BhbiByZWY9e3RoaXMuc2F2ZVByZWZpeH0gY2xhc3NOYW1lPXt0aGlzLmdldFNpemVDbGFzc05hbWUoJ3ByZWZpeCcpfT5cbiAgICAgICAge3Byb3BzLnByZWZpeH1cbiAgICAgIDwvc3Bhbj5cbiAgICApIDogbnVsbDtcbiAgICBjb25zdCBzdWZmaXggPSBwcm9wcy5zdWZmaXggPyAoXG4gICAgICA8c3BhbiByZWY9e3RoaXMuc2F2ZVN1ZmZpeH0gY2xhc3NOYW1lPXt0aGlzLmdldFNpemVDbGFzc05hbWUoJ3N1ZmZpeCcpfT5cbiAgICAgICAge3Byb3BzLnN1ZmZpeH1cbiAgICAgIDwvc3Bhbj5cbiAgICApIDogbnVsbDtcblxuICAgIGNvbnN0IGNsYXNzTmFtZSA9IGNsYXNzTmFtZXMoYCR7cHJlZml4Q2xzfS13cmFwcGVyYCwge1xuICAgICAgW2Ake3ByZWZpeENsc30taGFzLXZhbHVlYF06IHRoaXMuaGFzVmFsdWUoKSxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWZvY3VzZWRgXTogZm9jdXNlZCxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWRpc2FibGVkYF06IGRpc2FibGVkLFxuICAgICAgW2Ake3ByZWZpeENsc30taGFzLWxhYmVsYF06ICEhbGFiZWwsXG4gICAgICBbYCR7cHJlZml4Q2xzfS1oYXMtcHJlZml4YF06ICEhcHJlZml4LFxuICAgICAgW2Ake3ByZWZpeENsc30taGFzLXN1ZmZpeGBdOiAhIXN1ZmZpeCxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWhhcy1ib3JkZXJgXTogYm9yZGVyLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBzdHlsZT17c3R5bGV9PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7cHJlZml4Q2xzfS1jb250ZW50YH0+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tcmVuZGVyZWQtd3JhcHBlcmB9PlxuICAgICAgICAgICAge3ByZWZpeH1cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXt0aGlzLmdldFNpemVDbGFzc05hbWUoJ3JlbmRlcmVkJyl9IHJlZj17dGhpcy5zYXZlUmVuZGVyZWRSZWZ9PlxuICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJQbGFjZWhvbGRlcigpfVxuICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJJbnB1dCgpfVxuICAgICAgICAgICAgICB7dGhpcy5yZW5kZXJGbG9hdExhYmVsKCl9XG4gICAgICAgICAgICAgIHt0aGlzLnJlbmRlckNvcHlJY29uKCl9XG4gICAgICAgICAgICAgIHtzaG93UGFzc3dvcmRFeWUgPyB0aGlzLnJlbmRlclNob3dQYXNzd29yZCgpIDogbnVsbH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAge3N1ZmZpeH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICB7dGhpcy5nZXRMZW5ndGhJbmZvKCl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9zcGFuPlxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==