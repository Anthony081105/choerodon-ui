import * as React from 'react';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import ColumnResizeHandler from './ColumnResizeHandler';
import { isNullOrUndefined, getUnhandledProps, defaultClassPrefix, prefix } from './utils';
import Cell from './Cell';
class HeaderCell extends React.PureComponent {
    constructor(props) {
        super(props);
        this.handleColumnResizeStart = () => {
            const { left, fixed, onColumnResizeStart } = this.props;
            onColumnResizeStart?.(this.state.columnWidth, left, !!fixed);
        };
        this.handleColumnResizeEnd = (columnWidth, cursorDelta) => {
            const { dataKey, index, onColumnResizeEnd, onResize } = this.props;
            this.setState({ columnWidth });
            onColumnResizeEnd?.(columnWidth, cursorDelta, dataKey, index);
            onResize?.(columnWidth, dataKey);
        };
        this.handleClick = () => {
            if (this.props.sortable) {
                this.props.onSortColumn?.(this.props.dataKey);
            }
        };
        // @ts-ignore
        this.addPrefix = (name) => prefix(this.props.classPrefix)(name);
        this.state = {
            width: props.width,
            flexGrow: props.flexGrow,
            columnWidth: isNullOrUndefined(props.flexGrow) ? props.width : 0,
        };
    }
    static getDerivedStateFromProps(nextProps, prevState) {
        if (nextProps.width !== prevState.width || nextProps.flexGrow !== prevState.flexGrow) {
            return {
                width: nextProps.width,
                flexGrow: nextProps.flexGrow,
                columnWidth: isNullOrUndefined(nextProps.flexGrow) ? nextProps.width : 0,
            };
        }
        return null;
    }
    renderResizeSpanner() {
        const { resizable, left, onColumnResizeMove, fixed, headerHeight } = this.props;
        const { columnWidth } = this.state;
        if (!resizable) {
            return null;
        }
        return (React.createElement(ColumnResizeHandler, { defaultColumnWidth: columnWidth, key: columnWidth, columnLeft: left, columnFixed: fixed, height: headerHeight ? headerHeight - 1 : undefined, onColumnResizeMove: onColumnResizeMove, onColumnResizeStart: this.handleColumnResizeStart, onColumnResizeEnd: this.handleColumnResizeEnd }));
    }
    renderSortColumn() {
        const { sortable, sortColumn, sortType = '', dataKey } = this.props;
        if (sortable) {
            const iconClasses = classNames(this.addPrefix('icon-sort icon'), {
                [this.addPrefix(`icon-sort-${sortType}`)]: sortColumn === dataKey,
            });
            return (React.createElement("span", { className: this.addPrefix('sort-wrapper') },
                React.createElement("i", { className: iconClasses })));
        }
        return null;
    }
    render() {
        const { className, width, dataKey, headerHeight, children, left, sortable, classPrefix, ...rest } = this.props;
        const classes = classNames(classPrefix, className, {
            [this.addPrefix('sortable')]: sortable,
        });
        const unhandledProps = getUnhandledProps(HeaderCell, rest);
        return (React.createElement("div", { className: classes },
            React.createElement(Cell, Object.assign({}, unhandledProps, { width: width, dataKey: dataKey, left: left, headerHeight: headerHeight, isHeaderCell: true, onClick: this.handleClick }),
                children,
                this.renderSortColumn()),
            this.renderResizeSpanner()));
    }
}
HeaderCell.propTypes = {
    index: PropTypes.number,
    sortColumn: PropTypes.string,
    sortType: PropTypes.oneOf(['desc', 'asc']),
    sortable: PropTypes.bool,
    resizable: PropTypes.bool,
    onColumnResizeStart: PropTypes.func,
    onColumnResizeEnd: PropTypes.func,
    onResize: PropTypes.func,
    onColumnResizeMove: PropTypes.func,
    onSortColumn: PropTypes.func,
    flexGrow: PropTypes.number,
    fixed: PropTypes.oneOfType([PropTypes.bool, PropTypes.oneOf(['left', 'right'])]),
};
HeaderCell.defaultProps = {
    classPrefix: defaultClassPrefix('performance-table-cell-header'),
};
export default HeaderCell;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3BlcmZvcm1hbmNlLXRhYmxlL0hlYWRlckNlbGwudHN4IiwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQztBQUNuQyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUM7QUFDcEMsT0FBTyxtQkFBbUIsTUFBTSx1QkFBdUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsaUJBQWlCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQzNGLE9BQU8sSUFBSSxNQUFNLFFBQVEsQ0FBQztBQVMxQixNQUFNLFVBQVcsU0FBUSxLQUFLLENBQUMsYUFBOEM7SUErQjNFLFlBQVksS0FBc0I7UUFDaEMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBUWYsNEJBQXVCLEdBQUcsR0FBRyxFQUFFO1lBQzdCLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLG1CQUFtQixFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUV4RCxtQkFBbUIsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0QsQ0FBQyxDQUFDO1FBRUYsMEJBQXFCLEdBQUcsQ0FBQyxXQUFvQixFQUFFLFdBQW9CLEVBQUUsRUFBRTtZQUNyRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ25FLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBQy9CLGlCQUFpQixFQUFFLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDOUQs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Q25DLGlCQUFpQixFQUFFLFNBQVMsQ0FBQyxJQUFJO0lBQ2pDLFFBQVEsRUFBRSxTQUFTLENBQUMsSUFBSTtJQUN4QixrQkFBa0IsRUFBRSxTQUFTLENBQUMsSUFBSTtJQUNsQyxZQUFZLEVBQUUsU0FBUyxDQUFDLElBQUk7SUFDNUIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxNQUFNO0lBQzFCLEtBQUssRUFBRSxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUNqRixDQUFDO0FBQ0ssdUJBQVksR0FBRztJQUNwQixXQUFXLEVBQUUsa0JBQWtCLENBQUMsK0JBQStCLENBQUM7Q0FDakUsQ0FBQztBQTBISixlQUFlLFVBQVUsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvaHVpaHVhd2svRG9jdW1lbnRzL29wdC9jaG9lcm9kb24tdWkvY29tcG9uZW50cy1wcm8vcGVyZm9ybWFuY2UtdGFibGUvSGVhZGVyQ2VsbC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IENvbHVtblJlc2l6ZUhhbmRsZXIgZnJvbSAnLi9Db2x1bW5SZXNpemVIYW5kbGVyJztcbmltcG9ydCB7IGlzTnVsbE9yVW5kZWZpbmVkLCBnZXRVbmhhbmRsZWRQcm9wcywgZGVmYXVsdENsYXNzUHJlZml4LCBwcmVmaXggfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBDZWxsIGZyb20gJy4vQ2VsbCc7XG5pbXBvcnQgeyBIZWFkZXJDZWxsUHJvcHMgfSBmcm9tICcuL0hlYWRlckNlbGwuZCc7XG5cbmludGVyZmFjZSBIZWFkZXJDZWxsdGF0ZSB7XG4gIGNvbHVtbldpZHRoPzogbnVtYmVyO1xuICB3aWR0aD86IG51bWJlcjtcbiAgZmxleEdyb3c/OiBudW1iZXI7XG59XG5cbmNsYXNzIEhlYWRlckNlbGwgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PEhlYWRlckNlbGxQcm9wcywgSGVhZGVyQ2VsbHRhdGU+IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBpbmRleDogUHJvcFR5cGVzLm51bWJlcixcbiAgICBzb3J0Q29sdW1uOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHNvcnRUeXBlOiBQcm9wVHlwZXMub25lT2YoWydkZXNjJywgJ2FzYyddKSxcbiAgICBzb3J0YWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgcmVzaXphYmxlOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBvbkNvbHVtblJlc2l6ZVN0YXJ0OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbkNvbHVtblJlc2l6ZUVuZDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25SZXNpemU6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQ29sdW1uUmVzaXplTW92ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25Tb3J0Q29sdW1uOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBmbGV4R3JvdzogUHJvcFR5cGVzLm51bWJlcixcbiAgICBmaXhlZDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmJvb2wsIFByb3BUeXBlcy5vbmVPZihbJ2xlZnQnLCAncmlnaHQnXSldKSxcbiAgfTtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBjbGFzc1ByZWZpeDogZGVmYXVsdENsYXNzUHJlZml4KCdwZXJmb3JtYW5jZS10YWJsZS1jZWxsLWhlYWRlcicpLFxuICB9O1xuXG4gIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMobmV4dFByb3BzOiBIZWFkZXJDZWxsUHJvcHMsIHByZXZTdGF0ZTogSGVhZGVyQ2VsbHRhdGUpIHtcbiAgICBpZiAobmV4dFByb3BzLndpZHRoICE9PSBwcmV2U3RhdGUud2lkdGggfHwgbmV4dFByb3BzLmZsZXhHcm93ICE9PSBwcmV2U3RhdGUuZmxleEdyb3cpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdpZHRoOiBuZXh0UHJvcHMud2lkdGgsXG4gICAgICAgIGZsZXhHcm93OiBuZXh0UHJvcHMuZmxleEdyb3csXG4gICAgICAgIGNvbHVtbldpZHRoOiBpc051bGxPclVuZGVmaW5lZChuZXh0UHJvcHMuZmxleEdyb3cpID8gbmV4dFByb3BzLndpZHRoIDogMCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wczogSGVhZGVyQ2VsbFByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB3aWR0aDogcHJvcHMud2lkdGgsXG4gICAgICBmbGV4R3JvdzogcHJvcHMuZmxleEdyb3csXG4gICAgICBjb2x1bW5XaWR0aDogaXNOdWxsT3JVbmRlZmluZWQocHJvcHMuZmxleEdyb3cpID8gcHJvcHMud2lkdGggOiAwLFxuICAgIH07XG4gIH1cblxuICBoYW5kbGVDb2x1bW5SZXNpemVTdGFydCA9ICgpID0+IHtcbiAgICBjb25zdCB7IGxlZnQsIGZpeGVkLCBvbkNvbHVtblJlc2l6ZVN0YXJ0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgb25Db2x1bW5SZXNpemVTdGFydD8uKHRoaXMuc3RhdGUuY29sdW1uV2lkdGgsIGxlZnQsICEhZml4ZWQpO1xuICB9O1xuXG4gIGhhbmRsZUNvbHVtblJlc2l6ZUVuZCA9IChjb2x1bW5XaWR0aD86IG51bWJlciwgY3Vyc29yRGVsdGE/OiBudW1iZXIpID0+IHtcbiAgICBjb25zdCB7IGRhdGFLZXksIGluZGV4LCBvbkNvbHVtblJlc2l6ZUVuZCwgb25SZXNpemUgfSA9IHRoaXMucHJvcHM7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGNvbHVtbldpZHRoIH0pO1xuICAgIG9uQ29sdW1uUmVzaXplRW5kPy4oY29sdW1uV2lkdGgsIGN1cnNvckRlbHRhLCBkYXRhS2V5LCBpbmRleCk7XG4gICAgb25SZXNpemU/Lihjb2x1bW5XaWR0aCwgZGF0YUtleSk7XG4gIH07XG5cbiAgaGFuZGxlQ2xpY2sgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMucHJvcHMuc29ydGFibGUpIHtcbiAgICAgIHRoaXMucHJvcHMub25Tb3J0Q29sdW1uPy4odGhpcy5wcm9wcy5kYXRhS2V5KTtcbiAgICB9XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICBhZGRQcmVmaXggPSAobmFtZTogc3RyaW5nKSA9PiBwcmVmaXgodGhpcy5wcm9wcy5jbGFzc1ByZWZpeCkobmFtZSk7XG5cbiAgcmVuZGVyUmVzaXplU3Bhbm5lcigpIHtcbiAgICBjb25zdCB7IHJlc2l6YWJsZSwgbGVmdCwgb25Db2x1bW5SZXNpemVNb3ZlLCBmaXhlZCwgaGVhZGVySGVpZ2h0IH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgY29sdW1uV2lkdGggfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAoIXJlc2l6YWJsZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxDb2x1bW5SZXNpemVIYW5kbGVyXG4gICAgICAgIGRlZmF1bHRDb2x1bW5XaWR0aD17Y29sdW1uV2lkdGh9XG4gICAgICAgIGtleT17Y29sdW1uV2lkdGh9XG4gICAgICAgIGNvbHVtbkxlZnQ9e2xlZnR9XG4gICAgICAgIGNvbHVtbkZpeGVkPXtmaXhlZH1cbiAgICAgICAgaGVpZ2h0PXtoZWFkZXJIZWlnaHQgPyBoZWFkZXJIZWlnaHQgLSAxIDogdW5kZWZpbmVkfVxuICAgICAgICBvbkNvbHVtblJlc2l6ZU1vdmU9e29uQ29sdW1uUmVzaXplTW92ZX1cbiAgICAgICAgb25Db2x1bW5SZXNpemVTdGFydD17dGhpcy5oYW5kbGVDb2x1bW5SZXNpemVTdGFydH1cbiAgICAgICAgb25Db2x1bW5SZXNpemVFbmQ9e3RoaXMuaGFuZGxlQ29sdW1uUmVzaXplRW5kfVxuICAgICAgLz5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyU29ydENvbHVtbigpOiBSZWFjdC5SZWFjdE5vZGUge1xuICAgIGNvbnN0IHsgc29ydGFibGUsIHNvcnRDb2x1bW4sIHNvcnRUeXBlID0gJycsIGRhdGFLZXkgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoc29ydGFibGUpIHtcbiAgICAgIGNvbnN0IGljb25DbGFzc2VzID0gY2xhc3NOYW1lcyh0aGlzLmFkZFByZWZpeCgnaWNvbi1zb3J0IGljb24nKSwge1xuICAgICAgICBbdGhpcy5hZGRQcmVmaXgoYGljb24tc29ydC0ke3NvcnRUeXBlfWApXTogc29ydENvbHVtbiA9PT0gZGF0YUtleSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXt0aGlzLmFkZFByZWZpeCgnc29ydC13cmFwcGVyJyl9PlxuICAgICAgICAgIDxpIGNsYXNzTmFtZT17aWNvbkNsYXNzZXN9IC8+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIHdpZHRoLFxuICAgICAgZGF0YUtleSxcbiAgICAgIGhlYWRlckhlaWdodCxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgbGVmdCxcbiAgICAgIHNvcnRhYmxlLFxuICAgICAgY2xhc3NQcmVmaXgsXG4gICAgICAuLi5yZXN0XG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCBjbGFzc2VzID0gY2xhc3NOYW1lcyhjbGFzc1ByZWZpeCwgY2xhc3NOYW1lLCB7XG4gICAgICBbdGhpcy5hZGRQcmVmaXgoJ3NvcnRhYmxlJyldOiBzb3J0YWJsZSxcbiAgICB9KTtcbiAgICBjb25zdCB1bmhhbmRsZWRQcm9wcyA9IGdldFVuaGFuZGxlZFByb3BzKEhlYWRlckNlbGwsIHJlc3QpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc2VzfT5cbiAgICAgICAgPENlbGxcbiAgICAgICAgICB7Li4udW5oYW5kbGVkUHJvcHN9XG4gICAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICAgIGRhdGFLZXk9e2RhdGFLZXl9XG4gICAgICAgICAgbGVmdD17bGVmdH1cbiAgICAgICAgICBoZWFkZXJIZWlnaHQ9e2hlYWRlckhlaWdodH1cbiAgICAgICAgICBpc0hlYWRlckNlbGw9e3RydWV9XG4gICAgICAgICAgb25DbGljaz17dGhpcy5oYW5kbGVDbGlja31cbiAgICAgICAgPlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICB7dGhpcy5yZW5kZXJTb3J0Q29sdW1uKCl9XG4gICAgICAgIDwvQ2VsbD5cblxuICAgICAgICB7dGhpcy5yZW5kZXJSZXNpemVTcGFubmVyKCl9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEhlYWRlckNlbGw7XG4iXSwidmVyc2lvbiI6M30=