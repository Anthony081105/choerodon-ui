import { __decorate } from "tslib";
import React from 'react';
import PropTypes from 'prop-types';
import { observer } from 'mobx-react';
import omit from 'lodash/omit';
import { NumberField } from '../number-field/NumberField';
import autobind from '../_util/autobind';
import EventManager from '../_util/EventManager';
let Range = class Range extends NumberField {
    constructor() {
        super(...arguments);
        this.dragEvent = new EventManager(typeof window !== 'undefined' && document);
        this.type = 'range';
    }
    getFieldType() {
        return "number" /* number */;
    }
    getOtherProps() {
        return omit(super.getOtherProps(), ['vertical']);
    }
    getValue() {
        return super.getValue() || 0;
    }
    getWrapperClassNames() {
        const { props: { vertical }, prefixCls, } = this;
        return super.getWrapperClassNames({
            [`${prefixCls}-vertical`]: vertical,
        });
    }
    renderWrapper() {
        return (React.createElement("label", Object.assign({ key: "wrapper" }, this.getWrapperProps()),
            React.createElement("input", Object.assign({}, this.getOtherProps(), { value: this.getValue() })),
            this.renderTrack(),
            this.renderFloatLabel()));
    }
    renderTrack() {
        const percent = this.getPercent();
        const { props: { vertical }, prefixCls, } = this;
        return (React.createElement("div", { className: `${prefixCls}-track`, onMouseDown: this.isReadOnly() || this.isDisabled() ? undefined : this.handleTrackClick },
            React.createElement("div", { className: `${prefixCls}-draghandle`, style: vertical ? { bottom: percent } : { left: percent } }),
            React.createElement("div", { className: `${prefixCls}-selection`, style: vertical ? { height: percent } : { width: percent } })));
    }
    handleTrackClick(e) {
        this.track = e.currentTarget;
        this.handleDrag(e);
        this.handleDragStart();
    }
    handleDragStart() {
        this.dragEvent
            .addEventListener('mousemove', this.handleDrag)
            .addEventListener('mouseup', this.handleDragEnd);
    }
    handleDragEnd() {
        this.dragEvent
            .removeEventListener('mousemove', this.handleDrag)
            .removeEventListener('mouseup', this.handleDragEnd);
    }
    handleDrag(e) {
        const { track } = this;
        const { vertical } = this.props;
        const max = this.getProp('max');
        const min = this.getProp('min');
        const step = this.getProp('step');
        const { bottom, left } = track.getBoundingClientRect();
        const length = vertical ? bottom - e.clientY : e.clientX - left;
        const totalLength = vertical ? track.clientHeight : track.clientWidth;
        const oneStepLength = (1 / ((max - min) / step)) * totalLength;
        let value = min;
        if (length <= 0) {
            value = min;
        }
        else if (length >= totalLength) {
            value = max;
        }
        else {
            value = Math.round(length / oneStepLength) * step + min;
        }
        this.setValue(value);
    }
    getPercent() {
        const value = this.getValue();
        const max = this.getProp('max');
        const min = this.getProp('min');
        if (value <= min) {
            return 0;
        }
        if (value >= max) {
            return '100%';
        }
        return `${((value - min) / (max - min)) * 100}%`;
    }
};
Range.displayName = 'Range';
Range.propTypes = {
    /**
     * 是否垂直方向
     * @default
     * false
     */
    vertical: PropTypes.bool,
    ...NumberField.propTypes,
};
Range.defaultProps = {
    ...NumberField.defaultProps,
    suffixCls: 'range',
    min: 0,
    step: 1,
    max: 100,
    vertical: false,
};
__decorate([
    autobind
], Range.prototype, "handleTrackClick", null);
__decorate([
    autobind
], Range.prototype, "handleDragStart", null);
__decorate([
    autobind
], Range.prototype, "handleDragEnd", null);
__decorate([
    autobind
], Range.prototype, "handleDrag", null);
Range = __decorate([
    observer
], Range);
export default Range;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3JhbmdlL1JhbmdlLnRzeCIsIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUFvQixNQUFNLE9BQU8sQ0FBQztBQUN6QyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0QyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxFQUFFLFdBQVcsRUFBb0IsTUFBTSw2QkFBNkIsQ0FBQztBQUM1RSxPQUFPLFFBQVEsTUFBTSxtQkFBbUIsQ0FBQztBQUN6QyxPQUFPLFlBQVksTUFBTSx1QkFBdUIsQ0FBQztBQVdqRCxJQUFxQixLQUFLLEdBQTFCLE1BQXFCLEtBQU0sU0FBUSxXQUF1QjtJQUExRDs7UUFzQkUsY0FBUyxHQUFpQixJQUFJLFlBQVksQ0FBQyxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksUUFBUSxDQUFDLENBQUM7UUFJdEYsU0FBSSxHQUFXLE9BQU8sQ0FBQztJQWdIekIsQ0FBQztJQTlHQyxZQUFZO1FBQ1YsNkJBQXdCO0lBQzFCLENBQUM7SUFFRCxhQUFhO1FBQ1gsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQsUUFBUTtRQUNOLE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRUQsb0JBQW9CO1FBQ2xCLE1BQU0sRUFDSixLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFDbkIsU0FBUyxHQUNWLEdBQUcsSUFBSSxDQUFDO1FBQ1QsT0FBTyxLQUFLLENBQUMsb0JBQW9CLENBQUM7WUFDaEMsQ0FBQyxHQUFHLFNBQVMsV0FBVyxDQUFDLEVBQUUsUUFBUTtTQUNwQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsYUFBYTtRQUNYLE9BQU8sQ0FD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O0FBRUssa0JBQVksR0FBRztJQUNwQixHQUFHLFdBQVcsQ0FBQyxZQUFZO0lBQzNCLFNBQVMsRUFBRSxPQUFPO0lBQ2xCLEdBQUcsRUFBRSxDQUFDO0lBQ04sSUFBSSxFQUFFLENBQUM7SUFDUCxHQUFHLEVBQUUsR0FBRztJQUNSLFFBQVEsRUFBRSxLQUFLO0NBQ2hCLENBQUM7QUFnRUY7SUFEQyxRQUFROzZDQUtSO0FBR0Q7SUFEQyxRQUFROzRDQUtSO0FBR0Q7SUFEQyxRQUFROzBDQUtSO0FBR0Q7SUFEQyxRQUFRO3VDQW9CUjtBQTVIa0IsS0FBSztJQUR6QixRQUFRO0dBQ1ksS0FBSyxDQTBJekI7ZUExSW9CLEtBQUsiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3JhbmdlL1JhbmdlLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IG9ic2VydmVyIH0gZnJvbSAnbW9ieC1yZWFjdCc7XG5pbXBvcnQgb21pdCBmcm9tICdsb2Rhc2gvb21pdCc7XG5pbXBvcnQgeyBOdW1iZXJGaWVsZCwgTnVtYmVyRmllbGRQcm9wcyB9IGZyb20gJy4uL251bWJlci1maWVsZC9OdW1iZXJGaWVsZCc7XG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnLi4vX3V0aWwvYXV0b2JpbmQnO1xuaW1wb3J0IEV2ZW50TWFuYWdlciBmcm9tICcuLi9fdXRpbC9FdmVudE1hbmFnZXInO1xuaW1wb3J0IHsgRmllbGRUeXBlIH0gZnJvbSAnLi4vZGF0YS1zZXQvZW51bSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmFuZ2VQcm9wcyBleHRlbmRzIE51bWJlckZpZWxkUHJvcHMge1xuICAvKipcbiAgICogIOaYr+WQpuWeguebtOaWueWQkVxuICAgKi9cbiAgdmVydGljYWw/OiBib29sZWFuO1xufVxuXG5Ab2JzZXJ2ZXJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJhbmdlIGV4dGVuZHMgTnVtYmVyRmllbGQ8UmFuZ2VQcm9wcz4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnUmFuZ2UnO1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLyoqXG4gICAgICog5piv5ZCm5Z6C55u05pa55ZCRXG4gICAgICogQGRlZmF1bHRcbiAgICAgKiBmYWxzZVxuICAgICAqL1xuICAgIHZlcnRpY2FsOiBQcm9wVHlwZXMuYm9vbCxcbiAgICAuLi5OdW1iZXJGaWVsZC5wcm9wVHlwZXMsXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICAuLi5OdW1iZXJGaWVsZC5kZWZhdWx0UHJvcHMsXG4gICAgc3VmZml4Q2xzOiAncmFuZ2UnLFxuICAgIG1pbjogMCxcbiAgICBzdGVwOiAxLFxuICAgIG1heDogMTAwLFxuICAgIHZlcnRpY2FsOiBmYWxzZSxcbiAgfTtcblxuICBkcmFnRXZlbnQ6IEV2ZW50TWFuYWdlciA9IG5ldyBFdmVudE1hbmFnZXIodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgZG9jdW1lbnQpO1xuXG4gIHRyYWNrOiBIVE1MRGl2RWxlbWVudDtcblxuICB0eXBlOiBzdHJpbmcgPSAncmFuZ2UnO1xuXG4gIGdldEZpZWxkVHlwZSgpOiBGaWVsZFR5cGUge1xuICAgIHJldHVybiBGaWVsZFR5cGUubnVtYmVyO1xuICB9XG5cbiAgZ2V0T3RoZXJQcm9wcygpIHtcbiAgICByZXR1cm4gb21pdChzdXBlci5nZXRPdGhlclByb3BzKCksIFsndmVydGljYWwnXSk7XG4gIH1cblxuICBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gc3VwZXIuZ2V0VmFsdWUoKSB8fCAwO1xuICB9XG5cbiAgZ2V0V3JhcHBlckNsYXNzTmFtZXMoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJvcHM6IHsgdmVydGljYWwgfSxcbiAgICAgIHByZWZpeENscyxcbiAgICB9ID0gdGhpcztcbiAgICByZXR1cm4gc3VwZXIuZ2V0V3JhcHBlckNsYXNzTmFtZXMoe1xuICAgICAgW2Ake3ByZWZpeENsc30tdmVydGljYWxgXTogdmVydGljYWwsXG4gICAgfSk7XG4gIH1cblxuICByZW5kZXJXcmFwcGVyKCk6IFJlYWN0Tm9kZSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxsYWJlbCBrZXk9XCJ3cmFwcGVyXCIgey4uLnRoaXMuZ2V0V3JhcHBlclByb3BzKCl9PlxuICAgICAgICA8aW5wdXQgey4uLnRoaXMuZ2V0T3RoZXJQcm9wcygpfSB2YWx1ZT17dGhpcy5nZXRWYWx1ZSgpfSAvPlxuICAgICAgICB7dGhpcy5yZW5kZXJUcmFjaygpfVxuICAgICAgICB7dGhpcy5yZW5kZXJGbG9hdExhYmVsKCl9XG4gICAgICA8L2xhYmVsPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJUcmFjaygpIHtcbiAgICBjb25zdCBwZXJjZW50ID0gdGhpcy5nZXRQZXJjZW50KCk7XG4gICAgY29uc3Qge1xuICAgICAgcHJvcHM6IHsgdmVydGljYWwgfSxcbiAgICAgIHByZWZpeENscyxcbiAgICB9ID0gdGhpcztcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tdHJhY2tgfVxuICAgICAgICBvbk1vdXNlRG93bj17dGhpcy5pc1JlYWRPbmx5KCkgfHwgdGhpcy5pc0Rpc2FibGVkKCkgPyB1bmRlZmluZWQgOiB0aGlzLmhhbmRsZVRyYWNrQ2xpY2t9XG4gICAgICA+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9e2Ake3ByZWZpeENsc30tZHJhZ2hhbmRsZWB9XG4gICAgICAgICAgc3R5bGU9e3ZlcnRpY2FsID8geyBib3R0b206IHBlcmNlbnQgfSA6IHsgbGVmdDogcGVyY2VudCB9fVxuICAgICAgICAvPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgY2xhc3NOYW1lPXtgJHtwcmVmaXhDbHN9LXNlbGVjdGlvbmB9XG4gICAgICAgICAgc3R5bGU9e3ZlcnRpY2FsID8geyBoZWlnaHQ6IHBlcmNlbnQgfSA6IHsgd2lkdGg6IHBlcmNlbnQgfX1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlVHJhY2tDbGljayhlKTogdm9pZCB7XG4gICAgdGhpcy50cmFjayA9IGUuY3VycmVudFRhcmdldDtcbiAgICB0aGlzLmhhbmRsZURyYWcoZSk7XG4gICAgdGhpcy5oYW5kbGVEcmFnU3RhcnQoKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVEcmFnU3RhcnQoKTogdm9pZCB7XG4gICAgdGhpcy5kcmFnRXZlbnRcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLmhhbmRsZURyYWcpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuaGFuZGxlRHJhZ0VuZCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlRHJhZ0VuZCgpOiB2b2lkIHtcbiAgICB0aGlzLmRyYWdFdmVudFxuICAgICAgLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuaGFuZGxlRHJhZylcbiAgICAgIC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5oYW5kbGVEcmFnRW5kKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBoYW5kbGVEcmFnKGUpIHtcbiAgICBjb25zdCB7IHRyYWNrIH0gPSB0aGlzO1xuICAgIGNvbnN0IHsgdmVydGljYWwgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgbWF4ID0gdGhpcy5nZXRQcm9wKCdtYXgnKTtcbiAgICBjb25zdCBtaW4gPSB0aGlzLmdldFByb3AoJ21pbicpO1xuICAgIGNvbnN0IHN0ZXAgPSB0aGlzLmdldFByb3AoJ3N0ZXAnKTtcbiAgICBjb25zdCB7IGJvdHRvbSwgbGVmdCB9ID0gdHJhY2suZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgY29uc3QgbGVuZ3RoID0gdmVydGljYWwgPyBib3R0b20gLSBlLmNsaWVudFkgOiBlLmNsaWVudFggLSBsZWZ0O1xuICAgIGNvbnN0IHRvdGFsTGVuZ3RoID0gdmVydGljYWwgPyB0cmFjay5jbGllbnRIZWlnaHQgOiB0cmFjay5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBvbmVTdGVwTGVuZ3RoID0gKDEgLyAoKG1heCAtIG1pbikgLyBzdGVwKSkgKiB0b3RhbExlbmd0aDtcbiAgICBsZXQgdmFsdWUgPSBtaW47XG4gICAgaWYgKGxlbmd0aCA8PSAwKSB7XG4gICAgICB2YWx1ZSA9IG1pbjtcbiAgICB9IGVsc2UgaWYgKGxlbmd0aCA+PSB0b3RhbExlbmd0aCkge1xuICAgICAgdmFsdWUgPSBtYXg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gTWF0aC5yb3VuZChsZW5ndGggLyBvbmVTdGVwTGVuZ3RoKSAqIHN0ZXAgKyBtaW47XG4gICAgfVxuICAgIHRoaXMuc2V0VmFsdWUodmFsdWUpO1xuICB9XG5cbiAgZ2V0UGVyY2VudCgpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcbiAgICBjb25zdCBtYXggPSB0aGlzLmdldFByb3AoJ21heCcpO1xuICAgIGNvbnN0IG1pbiA9IHRoaXMuZ2V0UHJvcCgnbWluJyk7XG4gICAgaWYgKHZhbHVlIDw9IG1pbikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGlmICh2YWx1ZSA+PSBtYXgpIHtcbiAgICAgIHJldHVybiAnMTAwJSc7XG4gICAgfVxuICAgIHJldHVybiBgJHsoKHZhbHVlIC0gbWluKSAvIChtYXggLSBtaW4pKSAqIDEwMH0lYDtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9