import { __decorate } from "tslib";
import React from 'react';
import { observer } from 'mobx-react';
import { omit } from 'lodash';
import Menu, { Item } from 'choerodon-ui/lib/rc-components/menu';
import { action } from 'mobx';
import autobind from '../_util/autobind';
import { getItemKey, Select } from '../select/Select';
import DataSet from '../data-set';
export class AutoComplete extends Select {
    constructor() {
        super(...arguments);
        this.isChoose = false;
        this.inputText = '';
    }
    getTriggerIconFont() {
        return '';
    }
    getNotFoundContent() {
        return null;
    }
    getOtherProps() {
        const otherProps = omit(super.getOtherProps(), [
            'searchable',
        ]);
        return otherProps;
    }
    handleChange(e) {
        this.isChoose = false;
        super.handleChange(e);
    }
    choose(record) {
        this.isChoose = true;
        super.choose(record);
    }
    handleFocus(e) {
        this.inputText = e.target?.value;
        super.handleFocus(e);
    }
    handleBlur(e) {
        if (!e.isDefaultPrevented()) {
            if (!this.isChoose) {
                const inputText = this.text || this.inputText;
                this.inputText = inputText;
                const temDs = new DataSet({
                    fields: [
                        { name: this.textField, type: "string" /* string */ },
                        { name: this.valueField, type: "string" /* string */ },
                    ],
                    data: [{
                            [this.textField]: inputText,
                            [this.valueField]: inputText,
                        }],
                });
                this.choose(temDs.current);
            }
            super.handleBlur(e);
        }
    }
    getMenu(menuProps = {}) {
        const { options, textField, valueField, props: { dropdownMenuStyle, optionRenderer, onOption }, } = this;
        const inputText = this.text || this.inputText;
        if (!options) {
            return null;
        }
        const optGroups = [];
        const menuDisabled = this.isDisabled();
        const selectedKeys = [];
        options.forEach(record => {
            const value = record.get(valueField);
            // 判断是否符合自动补全的条件
            if (inputText && value.indexOf(inputText) === -1) {
                return;
            }
            const text = record.get(textField);
            const key = getItemKey(record, text, value);
            const optionProps = onOption({ dataSet: options, record });
            const optionDisabled = menuDisabled || (optionProps && optionProps.disabled);
            const itemContent = optionRenderer
                ? optionRenderer({ dataSet: this.options, record, text, value })
                : text;
            const option = (React.createElement(Item, Object.assign({}, optionProps, { key: key, value: record, disabled: optionDisabled }), itemContent));
            optGroups.push(option);
        });
        if (!optGroups.length) {
            return null;
        }
        return (React.createElement(Menu, Object.assign({ ref: this.saveMenu, disabled: menuDisabled, defaultActiveFirst: true, multiple: this.menuMultiple, selectedKeys: selectedKeys, prefixCls: this.getMenuPrefixCls(), onClick: this.handleMenuClick, style: dropdownMenuStyle, focusable: false }, menuProps), optGroups));
    }
}
AutoComplete.displayName = 'AutoComplete';
AutoComplete.propTypes = {
    ...Select.propTypes,
};
AutoComplete.defaultProps = {
    ...Select.defaultProps,
    searchable: true,
    suffixCls: 'auto-complete',
};
__decorate([
    autobind,
    action
], AutoComplete.prototype, "handleChange", null);
__decorate([
    autobind
], AutoComplete.prototype, "handleFocus", null);
__decorate([
    autobind
], AutoComplete.prototype, "handleBlur", null);
__decorate([
    autobind
], AutoComplete.prototype, "getMenu", null);
let ObserverAutoComplete = class ObserverAutoComplete extends AutoComplete {
};
ObserverAutoComplete.defaultProps = AutoComplete.defaultProps;
ObserverAutoComplete = __decorate([
    observer
], ObserverAutoComplete);
export default ObserverAutoComplete;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL2F1dG8tY29tcGxldGUvQXV0b0NvbXBsZXRlLnRzeCIsIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUF1QyxNQUFNLE9BQU8sQ0FBQztBQUM1RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFDOUIsT0FBTyxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNqRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRzlCLE9BQU8sUUFBUSxNQUFNLG1CQUFtQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFlLE1BQU0sa0JBQWtCLENBQUM7QUFDbkUsT0FBTyxPQUFPLE1BQU0sYUFBYSxDQUFDO0FBT2xDLE1BQU0sT0FBTyxZQUEwQyxTQUFRLE1BQVM7SUFBeEU7O1FBTUUsYUFBUSxHQUFhLEtBQUssQ0FBQztRQUUzQixjQUFTLEdBQVcsRUFBRSxDQUFDO0lBbUl6QixDQUFDO0lBdkhDLGtCQUFrQjtRQUNoQixPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsYUFBYTtRQUNYLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDN0MsWUFBWTtTQUNiLENBQUMsQ0FBQztRQUNILE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFJRCxZQUFZLENBQUMsQ0FBQztRQUNaLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUVELE1BQU0sQ0FBQyxNQUFzQjtRQUMzQixJQUFJLENBQUMsUUFBUSxHQUFH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QyxZQUFZLENBQUM7QUFEN0Isb0JBQW9CO0lBRHhDLFFBQVE7R0FDWSxvQkFBb0IsQ0FFeEM7ZUFGb0Isb0JBQW9CIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzLXByby9hdXRvLWNvbXBsZXRlL0F1dG9Db21wbGV0ZS50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFJlYWN0Tm9kZSwgUmVhY3RFbGVtZW50LCBLZXkgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBvYnNlcnZlciB9IGZyb20gJ21vYngtcmVhY3QnO1xuaW1wb3J0IHsgb21pdCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgTWVudSwgeyBJdGVtIH0gZnJvbSAnY2hvZXJvZG9uLXVpL2xpYi9yYy1jb21wb25lbnRzL21lbnUnO1xuaW1wb3J0IHsgYWN0aW9uIH0gZnJvbSAnbW9ieCc7XG5pbXBvcnQgUmVjb3JkIGZyb20gJy4uL2RhdGEtc2V0L1JlY29yZCc7XG5cbmltcG9ydCBhdXRvYmluZCBmcm9tICcuLi9fdXRpbC9hdXRvYmluZCc7XG5pbXBvcnQgeyBnZXRJdGVtS2V5LCBTZWxlY3QsIFNlbGVjdFByb3BzIH0gZnJvbSAnLi4vc2VsZWN0L1NlbGVjdCc7XG5pbXBvcnQgRGF0YVNldCBmcm9tICcuLi9kYXRhLXNldCc7XG5pbXBvcnQgeyBGaWVsZFR5cGUgfSBmcm9tICcuLi9kYXRhLXNldC9lbnVtJztcblxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dG9Db21wbGV0ZVByb3BzIGV4dGVuZHMgU2VsZWN0UHJvcHMge1xufVxuXG5leHBvcnQgY2xhc3MgQXV0b0NvbXBsZXRlPFQgZXh0ZW5kcyBBdXRvQ29tcGxldGVQcm9wcz4gZXh0ZW5kcyBTZWxlY3Q8VD4ge1xuXG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdBdXRvQ29tcGxldGUnO1xuXG4gIG1lbnU/OiBNZW51IHwgbnVsbDtcblxuICBpc0Nob29zZT86IGJvb2xlYW4gPSBmYWxzZTtcblxuICBpbnB1dFRleHQ6IHN0cmluZyA9ICcnO1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgLi4uU2VsZWN0LnByb3BUeXBlcyxcbiAgfTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIC4uLlNlbGVjdC5kZWZhdWx0UHJvcHMsXG4gICAgc2VhcmNoYWJsZTogdHJ1ZSxcbiAgICBzdWZmaXhDbHM6ICdhdXRvLWNvbXBsZXRlJyxcbiAgfTtcblxuICBnZXRUcmlnZ2VySWNvbkZvbnQoKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgZ2V0Tm90Rm91bmRDb250ZW50KCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZ2V0T3RoZXJQcm9wcygpIHtcbiAgICBjb25zdCBvdGhlclByb3BzID0gb21pdChzdXBlci5nZXRPdGhlclByb3BzKCksIFtcbiAgICAgICdzZWFyY2hhYmxlJyxcbiAgICBdKTtcbiAgICByZXR1cm4gb3RoZXJQcm9wcztcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBAYWN0aW9uXG4gIGhhbmRsZUNoYW5nZShlKSB7XG4gICAgdGhpcy5pc0Nob29zZSA9IGZhbHNlO1xuICAgIHN1cGVyLmhhbmRsZUNoYW5nZShlKTtcbiAgfVxuXG4gIGNob29zZShyZWNvcmQ/OiBSZWNvcmQgfCBudWxsKSB7XG4gICAgdGhpcy5pc0Nob29zZSA9IHRydWU7XG4gICAgc3VwZXIuY2hvb3NlKHJlY29yZCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgaGFuZGxlRm9jdXMoZSkge1xuICAgIHRoaXMuaW5wdXRUZXh0ID0gZS50YXJnZXQ/LnZhbHVlO1xuICAgIHN1cGVyLmhhbmRsZUZvY3VzKGUpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGhhbmRsZUJsdXIoZSkge1xuICAgIGlmICghZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgaWYgKCF0aGlzLmlzQ2hvb3NlKSB7XG4gICAgICAgIGNvbnN0IGlucHV0VGV4dCA9IHRoaXMudGV4dCB8fCB0aGlzLmlucHV0VGV4dDtcbiAgICAgICAgdGhpcy5pbnB1dFRleHQgPSBpbnB1dFRleHQ7XG4gICAgICAgIGNvbnN0IHRlbURzID0gbmV3IERhdGFTZXQoe1xuICAgICAgICAgIGZpZWxkczogW1xuICAgICAgICAgICAgeyBuYW1lOiB0aGlzLnRleHRGaWVsZCwgdHlwZTogRmllbGRUeXBlLnN0cmluZyB9LFxuICAgICAgICAgICAgeyBuYW1lOiB0aGlzLnZhbHVlRmllbGQsIHR5cGU6IEZpZWxkVHlwZS5zdHJpbmcgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGRhdGE6IFt7XG4gICAgICAgICAgICBbdGhpcy50ZXh0RmllbGRdOiBpbnB1dFRleHQsXG4gICAgICAgICAgICBbdGhpcy52YWx1ZUZpZWxkXTogaW5wdXRUZXh0LFxuICAgICAgICAgIH1dLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jaG9vc2UodGVtRHMuY3VycmVudCk7XG4gICAgICB9XG4gICAgICBzdXBlci5oYW5kbGVCbHVyKGUpO1xuICAgIH1cbiAgfVxuXG4gIEBhdXRvYmluZFxuICBnZXRNZW51KG1lbnVQcm9wczogb2JqZWN0ID0ge30pOiBSZWFjdE5vZGUge1xuICAgIGNvbnN0IHtcbiAgICAgIG9wdGlvbnMsXG4gICAgICB0ZXh0RmllbGQsXG4gICAgICB2YWx1ZUZpZWxkLFxuICAgICAgcHJvcHM6IHsgZHJvcGRvd25NZW51U3R5bGUsIG9wdGlvblJlbmRlcmVyLCBvbk9wdGlvbiB9LFxuICAgIH0gPSB0aGlzO1xuICAgIGNvbnN0IGlucHV0VGV4dCA9IHRoaXMudGV4dCB8fCB0aGlzLmlucHV0VGV4dDtcblxuICAgIGlmICghb3B0aW9ucykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IG9wdEdyb3VwczogUmVhY3RFbGVtZW50PGFueT5bXSA9IFtdO1xuICAgIGNvbnN0IG1lbnVEaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZCgpO1xuICAgIGNvbnN0IHNlbGVjdGVkS2V5czogS2V5W10gPSBbXTtcblxuICAgIG9wdGlvbnMuZm9yRWFjaChyZWNvcmQgPT4ge1xuXG4gICAgICBjb25zdCB2YWx1ZSA9IHJlY29yZC5nZXQodmFsdWVGaWVsZCk7XG4gICAgICAvLyDliKTmlq3mmK/lkKbnrKblkIjoh6rliqjooaXlhajnmoTmnaHku7ZcbiAgICAgIGlmIChpbnB1dFRleHQgJiYgdmFsdWUuaW5kZXhPZihpbnB1dFRleHQpID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRleHQgPSByZWNvcmQuZ2V0KHRleHRGaWVsZCk7XG4gICAgICBjb25zdCBrZXk6IEtleSA9IGdldEl0ZW1LZXkocmVjb3JkLCB0ZXh0LCB2YWx1ZSk7XG4gICAgICBjb25zdCBvcHRpb25Qcm9wcyA9IG9uT3B0aW9uKHsgZGF0YVNldDogb3B0aW9ucywgcmVjb3JkIH0pO1xuICAgICAgY29uc3Qgb3B0aW9uRGlzYWJsZWQgPSBtZW51RGlzYWJsZWQgfHwgKG9wdGlvblByb3BzICYmIG9wdGlvblByb3BzLmRpc2FibGVkKTtcblxuICAgICAgY29uc3QgaXRlbUNvbnRlbnQgPSBvcHRpb25SZW5kZXJlclxuICAgICAgICA/IG9wdGlvblJlbmRlcmVyKHsgZGF0YVNldDogdGhpcy5vcHRpb25zLCByZWNvcmQsIHRleHQsIHZhbHVlIH0pXG4gICAgICAgIDogdGV4dDtcbiAgICAgIGNvbnN0IG9wdGlvbjogUmVhY3RFbGVtZW50ID0gKFxuICAgICAgICA8SXRlbSB7Li4ub3B0aW9uUHJvcHN9IGtleT17a2V5fSB2YWx1ZT17cmVjb3JkfSBkaXNhYmxlZD17b3B0aW9uRGlzYWJsZWR9PlxuICAgICAgICAgIHtpdGVtQ29udGVudH1cbiAgICAgICAgPC9JdGVtPlxuICAgICAgKTtcblxuICAgICAgb3B0R3JvdXBzLnB1c2gob3B0aW9uKTtcbiAgICB9KTtcblxuICAgIGlmICghb3B0R3JvdXBzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxNZW51XG4gICAgICAgIHJlZj17dGhpcy5zYXZlTWVudX1cbiAgICAgICAgZGlzYWJsZWQ9e21lbnVEaXNhYmxlZH1cbiAgICAgICAgZGVmYXVsdEFjdGl2ZUZpcnN0XG4gICAgICAgIG11bHRpcGxlPXt0aGlzLm1lbnVNdWx0aXBsZX1cbiAgICAgICAgc2VsZWN0ZWRLZXlzPXtzZWxlY3RlZEtleXN9XG4gICAgICAgIHByZWZpeENscz17dGhpcy5nZXRNZW51UHJlZml4Q2xzKCl9XG4gICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlTWVudUNsaWNrfVxuICAgICAgICBzdHlsZT17ZHJvcGRvd25NZW51U3R5bGV9XG4gICAgICAgIGZvY3VzYWJsZT17ZmFsc2V9XG4gICAgICAgIHsuLi5tZW51UHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtvcHRHcm91cHN9XG4gICAgICA8L01lbnU+XG4gICAgKTtcbiAgfVxuXG59XG5cbkBvYnNlcnZlclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT2JzZXJ2ZXJBdXRvQ29tcGxldGUgZXh0ZW5kcyBBdXRvQ29tcGxldGU8QXV0b0NvbXBsZXRlUHJvcHM+IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IEF1dG9Db21wbGV0ZS5kZWZhdWx0UHJvcHM7XG59XG4iXSwidmVyc2lvbiI6M30=