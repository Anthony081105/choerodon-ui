import React, { Children, Component, isValidElement } from 'react';
import PropTypes from 'prop-types';
import { getProPrefixCls } from 'choerodon-ui/lib/configure';
import Trigger from '../trigger/Trigger';
import getPlacements from './placements';
const splitObject = (obj, keys) => {
    const picked = {};
    const ommitted = { ...obj };
    keys.forEach(key => {
        if (obj && key in obj) {
            picked[key] = obj[key];
            delete ommitted[key];
        }
    });
    return { picked, ommitted };
};
/**
 * Fix the tooltip won't hide when child element is button
 * @param element ReactElement
 */
function getDisabledCompatobleChildren(element) {
    const elementType = element.type;
    if ((elementType.__Pro_BUTTON === true ||
        elementType.__Pro_SWITCH === true ||
        elementType.__Pro_CHECKBOX === true ||
        element.type.__ANT_BUTTON ||
        element.type === 'button') &&
        element.props.disabled) {
        const { picked, ommitted } = splitObject(element.props.style, [
            'position',
            'left',
            'right',
            'top',
            'bottom',
            'float',
            'display',
            'zIndex',
        ]);
        const spanStyle = {
            display: 'inline-block',
            ...picked,
            cursor: 'not-allowed',
            width: element.props.block ? '100%' : null,
        };
        const buttonStyle = {
            ...ommitted,
            pointerEvents: 'none',
        };
        const child = React.cloneElement(element, {
            style: buttonStyle,
            className: null,
        });
        return (React.createElement("span", { style: spanStyle, className: element.props.classNames }, child));
    }
    return element;
}
export default class Tooltip extends Component {
    get prefixCls() {
        const { suffixCls, prefixCls } = this.props;
        return getProPrefixCls(suffixCls, prefixCls);
    }
    get popupContent() {
        const { title } = this.props;
        if (!title) {
            return null;
        }
        const { prefixCls, props: { overlay, theme }, } = this;
        let content = '';
        if (typeof overlay === 'function') {
            content = overlay();
        }
        else if (overlay) {
            content = overlay;
        }
        else {
            content = title || '';
        }
        const arrowCls = `${prefixCls}-popup-arrow`;
        const contentCls = `${prefixCls}-popup-inner`;
        return (React.createElement("div", null,
            React.createElement("div", { className: `${arrowCls} ${arrowCls}-${theme}`, key: "arrow" }),
            React.createElement("div", { className: `${contentCls} ${contentCls}-${theme}`, key: "content" }, content)));
    }
    get placements() {
        const { builtinPlacements, arrowPointAtCenter, autoAdjustOverflow } = this.props;
        return (builtinPlacements ||
            getPlacements({
                arrowPointAtCenter,
                verticalArrowShift: 8,
                autoAdjustOverflow,
            }));
    }
    render() {
        const { prefixCls, popupContent, props: { children, placement, onHiddenChange, trigger, defaultHidden, hidden, ...restProps }, } = this;
        const child = Children.map(children, node => {
            node = getDisabledCompatobleChildren(isValidElement(node) ? node : React.createElement("span", { key: `text-${node}` }, node));
            return node;
        });
        const extraProps = { ...restProps };
        if ('hidden' in this.props) {
            extraProps.popupHidden = hidden;
        }
        return (React.createElement(Trigger, Object.assign({ prefixCls: prefixCls, action: trigger, builtinPlacements: this.placements, popupPlacement: placement, popupContent: popupContent, onPopupHiddenChange: onHiddenChange, defaultPopupHidden: defaultHidden }, extraProps), child));
    }
}
Tooltip.displayName = 'Tooltip';
Tooltip.propTypes = {
    title: PropTypes.any,
    arrowPointAtCenter: PropTypes.bool,
    autoAdjustOverflow: PropTypes.bool,
    defaultHidden: PropTypes.bool,
    mouseEnterDelay: PropTypes.number,
    mouseLeaveDelay: PropTypes.number,
    placement: PropTypes.oneOf([
        'top',
        'topLeft',
        'topRight',
        'bottom',
        'bottomLeft',
        'bottomRight',
        'left',
        'leftTop',
        'leftBottom',
        'right',
        'rightTop',
        'rightBottom',
    ]),
    trigger: PropTypes.arrayOf(PropTypes.oneOf(["click" /* click */, "hover" /* hover */, "contextMenu" /* contextMenu */, "focus" /* focus */])),
    hidden: PropTypes.bool,
    onHiddenChange: PropTypes.func,
    suffixCls: PropTypes.string,
    transitionName: PropTypes.string,
    theme: PropTypes.oneOf(['light', 'dark']),
};
Tooltip.defaultProps = {
    suffixCls: 'tooltip',
    placement: 'bottom',
    transitionName: 'zoom-big-fast',
    mouseEnterDelay: 100,
    mouseLeaveDelay: 100,
    arrowPointAtCenter: false,
    autoAdjustOverflow: true,
    theme: 'dark',
    defaultHidden: true,
    trigger: ["hover" /* hover */],
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3Rvb2x0aXAvVG9vbHRpcC50c3giLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLGNBQWMsRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUNuRSxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRTdELE9BQU8sT0FBeUIsTUFBTSxvQkFBb0IsQ0FBQztBQUUzRCxPQUFPLGFBQWlDLE1BQU0sY0FBYyxDQUFDO0FBMkM3RCxNQUFNLFdBQVcsR0FBRyxDQUFDLEdBQU8sRUFBQyxJQUFhLEVBQUUsRUFBRTtJQUM1QyxNQUFNLE1BQU0sR0FBTyxFQUFFLENBQUM7SUFDdEIsTUFBTSxRQUFRLEdBQU8sRUFBQyxHQUFHLEdBQUcsRUFBQyxDQUFDO0lBQzlCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDakIsSUFBRyxHQUFHLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBQztZQUNuQixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3RCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUFDO0FBQzlCLENBQUMsQ0FBQTtBQUVDOzs7R0FHRztBQUNILFNBQVMsNkJBQTZCLENBQUMsT0FBK0I7SUFDcEUsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLElBQVcsQ0FBQTtJQUN2QyxJQUNJLENBQUUsV0FBVyxDQUFDLFlBQVksS0FBSyxJQUFJO1FBQ2pDLFdBQVcsQ0FBQyxZQUFZLEtBQUssSUFBSTtRQUNqQyxXQUFXLENBQUMsY0FBYyxLQUFLLElBQUk7UUFDbEMsT0FBTyxDQUFDLElBQXNC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QyxrQkFBa0IsRUFBRSxTQUFTLENBQUMsSUFBSTtJQUNsQyxhQUFhLEVBQUUsU0FBUyxDQUFDLElBQUk7SUFDN0IsZUFBZSxFQUFFLFNBQVMsQ0FBQyxNQUFNO0lBQ2pDLGVBQWUsRUFBRSxTQUFTLENBQUMsTUFBTTtJQUNqQyxTQUFTLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQztRQUN6QixLQUFLO1FBQ0wsU0FBUztRQUNULFVBQVU7UUFDVixRQUFRO1FBQ1IsWUFBWTtRQUNaLGFBQWE7UUFDYixNQUFNO1FBQ04sU0FBUztRQUNULFlBQVk7UUFDWixPQUFPO1FBQ1AsVUFBVTtRQUNWLGFBQWE7S0FDZCxDQUFDO0lBQ0YsT0FBTyxFQUFFLFNBQVMsQ0FBQyxPQUFPLENBQ3hCLFNBQVMsQ0FBQyxLQUFLLENBQUMsZ0dBQThELENBQUMsQ0FDaEY7SUFDRCxNQUFNLEVBQUUsU0FBUyxDQUFDLElBQUk7SUFDdEIsY0FBYyxFQUFFLFNBQVMsQ0FBQyxJQUFJO0lBQzlCLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtJQUMzQixjQUFjLEVBQUUsU0FBUyxDQUFDLE1BQU07SUFDaEMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7Q0FDMUMsQ0FBQztBQUVLLG9CQUFZLEdBQUc7SUFDcEIsU0FBUyxFQUFFLFNBQVM7SUFDcEIsU0FBUyxFQUFFLFFBQVE7SUFDbkIsY0FBYyxFQUFFLGVBQWU7SUFDL0IsZUFBZSxFQUFFLEdBQUc7SUFDcEIsZUFBZSxFQUFFLEdBQUc7SUFDcEIsa0JBQWtCLEVBQUUsS0FBSztJQUN6QixrQkFBa0IsRUFBRSxJQUFJO0lBQ3hCLEtBQUssRUFBRSxNQUFNO0lBQ2IsYUFBYSxFQUFFLElBQUk7SUFDbkIsT0FBTyxFQUFFLHFCQUFjO0NBQ3hCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMtcHJvL3Rvb2x0aXAvVG9vbHRpcC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENoaWxkcmVuLCBDb21wb25lbnQsIGlzVmFsaWRFbGVtZW50IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGdldFByb1ByZWZpeENscyB9IGZyb20gJ2Nob2Vyb2Rvbi11aS9saWIvY29uZmlndXJlJztcbmltcG9ydCBCdXR0b24gZnJvbSAnY2hvZXJvZG9uLXVpL2xpYi9idXR0b24nO1xuaW1wb3J0IFRyaWdnZXIsIHsgVHJpZ2dlclByb3BzIH0gZnJvbSAnLi4vdHJpZ2dlci9UcmlnZ2VyJztcbmltcG9ydCB7IEFjdGlvbiB9IGZyb20gJy4uL3RyaWdnZXIvZW51bSc7XG5pbXBvcnQgZ2V0UGxhY2VtZW50cywgeyBBZGp1c3RPdmVyZmxvdyB9IGZyb20gJy4vcGxhY2VtZW50cyc7XG5cbmV4cG9ydCB0eXBlIFRvb2x0aXBQbGFjZW1lbnQgPVxuICB8ICd0b3AnXG4gIHwgJ2xlZnQnXG4gIHwgJ3JpZ2h0J1xuICB8ICdib3R0b20nXG4gIHwgJ3RvcExlZnQnXG4gIHwgJ3RvcFJpZ2h0J1xuICB8ICdib3R0b21MZWZ0J1xuICB8ICdib3R0b21SaWdodCdcbiAgfCAnbGVmdFRvcCdcbiAgfCAnbGVmdEJvdHRvbSdcbiAgfCAncmlnaHRUb3AnXG4gIHwgJ3JpZ2h0Qm90dG9tJztcblxuZXhwb3J0IHR5cGUgVG9vbHRpcFRoZW1lID0gJ2xpZ2h0JyB8ICdkYXJrJztcblxuZXhwb3J0IHR5cGUgUmVuZGVyRnVuY3Rpb24gPSAoKSA9PiBSZWFjdC5SZWFjdE5vZGU7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbHRpcFByb3BzIHtcbiAgcHJlZml4Q2xzPzogc3RyaW5nO1xuICBzdWZmaXhDbHM/OiBzdHJpbmc7XG4gIG92ZXJsYXlDbGFzc05hbWU/OiBzdHJpbmc7XG4gIHN0eWxlPzogUmVhY3QuQ1NTUHJvcGVydGllcztcbiAgb3ZlcmxheVN0eWxlPzogUmVhY3QuQ1NTUHJvcGVydGllcztcbiAgcGxhY2VtZW50PzogVG9vbHRpcFBsYWNlbWVudDtcbiAgYnVpbHRpblBsYWNlbWVudHM/OiBPYmplY3Q7XG4gIGhpZGRlbj86IGJvb2xlYW47XG4gIGRlZmF1bHRIaWRkZW4/OiBib29sZWFuO1xuICBvbkhpZGRlbkNoYW5nZT86IChoaWRkZW46IGJvb2xlYW4pID0+IHZvaWQ7XG4gIG1vdXNlRW50ZXJEZWxheT86IG51bWJlcjtcbiAgbW91c2VMZWF2ZURlbGF5PzogbnVtYmVyO1xuICB0cmFuc2l0aW9uTmFtZT86IHN0cmluZztcbiAgdHJpZ2dlcj86IEFjdGlvbltdO1xuICBvcGVuQ2xhc3NOYW1lPzogc3RyaW5nO1xuICBhcnJvd1BvaW50QXRDZW50ZXI/OiBib29sZWFuO1xuICBhdXRvQWRqdXN0T3ZlcmZsb3c/OiBib29sZWFuIHwgQWRqdXN0T3ZlcmZsb3c7XG4gIHRpdGxlPzogUmVhY3QuUmVhY3ROb2RlIHwgUmVuZGVyRnVuY3Rpb247XG4gIG92ZXJsYXk/OiBSZWFjdC5SZWFjdE5vZGUgfCBSZW5kZXJGdW5jdGlvbjtcbiAgdGhlbWU/OiBUb29sdGlwVGhlbWU7XG59XG5cbmNvbnN0IHNwbGl0T2JqZWN0ID0gKG9iajphbnksa2V5czpzdHJpbmdbXSkgPT4ge1xuICBjb25zdCBwaWNrZWQ6YW55ID0ge307XG4gIGNvbnN0IG9tbWl0dGVkOmFueSA9IHsuLi5vYmp9O1xuICBrZXlzLmZvckVhY2goa2V5ID0+IHtcbiAgICBpZihvYmogJiYga2V5IGluIG9iail7XG4gICAgICBwaWNrZWRba2V5XSA9IG9ialtrZXldO1xuICAgICAgZGVsZXRlIG9tbWl0dGVkW2tleV07XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHsgcGlja2VkLCBvbW1pdHRlZCB9O1xufVxuXG4gIC8qKlxuICAgKiBGaXggdGhlIHRvb2x0aXAgd29uJ3QgaGlkZSB3aGVuIGNoaWxkIGVsZW1lbnQgaXMgYnV0dG9uIFxuICAgKiBAcGFyYW0gZWxlbWVudCBSZWFjdEVsZW1lbnRcbiAgICovXG4gIGZ1bmN0aW9uIGdldERpc2FibGVkQ29tcGF0b2JsZUNoaWxkcmVuKGVsZW1lbnQ6UmVhY3QuUmVhY3RFbGVtZW50PGFueT4pe1xuICAgIGNvbnN0IGVsZW1lbnRUeXBlID0gZWxlbWVudC50eXBlIGFzIGFueVxuICAgIGlmKFxuICAgICAgICAoIGVsZW1lbnRUeXBlLl9fUHJvX0JVVFRPTiA9PT0gdHJ1ZSB8fFxuICAgICAgICAgIGVsZW1lbnRUeXBlLl9fUHJvX1NXSVRDSCA9PT0gdHJ1ZSB8fFxuICAgICAgICAgIGVsZW1lbnRUeXBlLl9fUHJvX0NIRUNLQk9YID09PSB0cnVlIHx8IFxuICAgICAgICAgIChlbGVtZW50LnR5cGUgYXMgdHlwZW9mIEJ1dHRvbikuX19BTlRfQlVUVE9OIHx8IFxuICAgICAgICAgIGVsZW1lbnQudHlwZSA9PT0gJ2J1dHRvbicpICYmXG4gICAgICAgICAgZWxlbWVudC5wcm9wcy5kaXNhYmxlZCBcbiAgICAgICAgKXtcbiAgICAgICAgICBjb25zdCB7cGlja2VkLCBvbW1pdHRlZH0gPSBzcGxpdE9iamVjdChlbGVtZW50LnByb3BzLnN0eWxlLFtcbiAgICAgICAgICAgICdwb3NpdGlvbicsXG4gICAgICAgICAgICAnbGVmdCcsXG4gICAgICAgICAgICAncmlnaHQnLFxuICAgICAgICAgICAgJ3RvcCcsXG4gICAgICAgICAgICAnYm90dG9tJyxcbiAgICAgICAgICAgICdmbG9hdCcsXG4gICAgICAgICAgICAnZGlzcGxheScsXG4gICAgICAgICAgICAnekluZGV4JyxcbiAgICAgICAgICBdKTtcbiAgICAgICAgICBjb25zdCBzcGFuU3R5bGUgPSB7XG4gICAgICAgICAgICBkaXNwbGF5OidpbmxpbmUtYmxvY2snLFxuICAgICAgICAgICAgLi4ucGlja2VkLFxuICAgICAgICAgICAgY3Vyc29yOidub3QtYWxsb3dlZCcsXG4gICAgICAgICAgICB3aWR0aDplbGVtZW50LnByb3BzLmJsb2NrID8gJzEwMCUnOm51bGwsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCBidXR0b25TdHlsZSA9IHtcbiAgICAgICAgICAgIC4uLm9tbWl0dGVkLFxuICAgICAgICAgICAgcG9pbnRlckV2ZW50czonbm9uZScsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCBjaGlsZCA9IFJlYWN0LmNsb25lRWxlbWVudChlbGVtZW50LHtcbiAgICAgICAgICAgIHN0eWxlOmJ1dHRvblN0eWxlLFxuICAgICAgICAgICAgY2xhc3NOYW1lOm51bGwsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxzcGFuIHN0eWxlPXtzcGFuU3R5bGV9IGNsYXNzTmFtZT17ZWxlbWVudC5wcm9wcy5jbGFzc05hbWVzfT5cbiAgICAgICAgICAgICAge2NoaWxkfVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZWxlbWVudFxuICAgfVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb29sdGlwIGV4dGVuZHMgQ29tcG9uZW50PFRvb2x0aXBQcm9wcywgYW55PiB7XG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdUb29sdGlwJztcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIHRpdGxlOiBQcm9wVHlwZXMuYW55LFxuICAgIGFycm93UG9pbnRBdENlbnRlcjogUHJvcFR5cGVzLmJvb2wsXG4gICAgYXV0b0FkanVzdE92ZXJmbG93OiBQcm9wVHlwZXMuYm9vbCxcbiAgICBkZWZhdWx0SGlkZGVuOiBQcm9wVHlwZXMuYm9vbCxcbiAgICBtb3VzZUVudGVyRGVsYXk6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgbW91c2VMZWF2ZURlbGF5OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHBsYWNlbWVudDogUHJvcFR5cGVzLm9uZU9mKFtcbiAgICAgICd0b3AnLFxuICAgICAgJ3RvcExlZnQnLFxuICAgICAgJ3RvcFJpZ2h0JyxcbiAgICAgICdib3R0b20nLFxuICAgICAgJ2JvdHRvbUxlZnQnLFxuICAgICAgJ2JvdHRvbVJpZ2h0JyxcbiAgICAgICdsZWZ0JyxcbiAgICAgICdsZWZ0VG9wJyxcbiAgICAgICdsZWZ0Qm90dG9tJyxcbiAgICAgICdyaWdodCcsXG4gICAgICAncmlnaHRUb3AnLFxuICAgICAgJ3JpZ2h0Qm90dG9tJyxcbiAgICBdKSxcbiAgICB0cmlnZ2VyOiBQcm9wVHlwZXMuYXJyYXlPZihcbiAgICAgIFByb3BUeXBlcy5vbmVPZihbQWN0aW9uLmNsaWNrLCBBY3Rpb24uaG92ZXIsIEFjdGlvbi5jb250ZXh0TWVudSwgQWN0aW9uLmZvY3VzXSksXG4gICAgKSxcbiAgICBoaWRkZW46IFByb3BUeXBlcy5ib29sLFxuICAgIG9uSGlkZGVuQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzdWZmaXhDbHM6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdHJhbnNpdGlvbk5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgdGhlbWU6IFByb3BUeXBlcy5vbmVPZihbJ2xpZ2h0JywgJ2RhcmsnXSksXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBzdWZmaXhDbHM6ICd0b29sdGlwJyxcbiAgICBwbGFjZW1lbnQ6ICdib3R0b20nLFxuICAgIHRyYW5zaXRpb25OYW1lOiAnem9vbS1iaWctZmFzdCcsXG4gICAgbW91c2VFbnRlckRlbGF5OiAxMDAsXG4gICAgbW91c2VMZWF2ZURlbGF5OiAxMDAsXG4gICAgYXJyb3dQb2ludEF0Q2VudGVyOiBmYWxzZSxcbiAgICBhdXRvQWRqdXN0T3ZlcmZsb3c6IHRydWUsXG4gICAgdGhlbWU6ICdkYXJrJyxcbiAgICBkZWZhdWx0SGlkZGVuOiB0cnVlLFxuICAgIHRyaWdnZXI6IFtBY3Rpb24uaG92ZXJdLFxuICB9O1xuXG4gIGdldCBwcmVmaXhDbHMoKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IHN1ZmZpeENscywgcHJlZml4Q2xzIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiBnZXRQcm9QcmVmaXhDbHMoc3VmZml4Q2xzISwgcHJlZml4Q2xzKTtcbiAgfVxuXG4gIGdldCBwb3B1cENvbnRlbnQoKSB7XG4gICAgY29uc3QgeyB0aXRsZSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoIXRpdGxlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgcHJvcHM6IHsgb3ZlcmxheSwgdGhlbWUgfSxcbiAgICB9ID0gdGhpcztcblxuICAgIGxldCBjb250ZW50OiBhbnkgPSAnJztcbiAgICBpZiAodHlwZW9mIG92ZXJsYXkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNvbnRlbnQgPSBvdmVybGF5KCk7XG4gICAgfSBlbHNlIGlmIChvdmVybGF5KSB7XG4gICAgICBjb250ZW50ID0gb3ZlcmxheTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGVudCA9IHRpdGxlIHx8ICcnO1xuICAgIH1cblxuICAgIGNvbnN0IGFycm93Q2xzID0gYCR7cHJlZml4Q2xzfS1wb3B1cC1hcnJvd2A7XG4gICAgY29uc3QgY29udGVudENscyA9IGAke3ByZWZpeENsc30tcG9wdXAtaW5uZXJgO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHthcnJvd0Nsc30gJHthcnJvd0Nsc30tJHt0aGVtZX1gfSBrZXk9XCJhcnJvd1wiIC8+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtjb250ZW50Q2xzfSAke2NvbnRlbnRDbHN9LSR7dGhlbWV9YH0ga2V5PVwiY29udGVudFwiPlxuICAgICAgICAgIHtjb250ZW50fVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBnZXQgcGxhY2VtZW50cygpIHtcbiAgICBjb25zdCB7IGJ1aWx0aW5QbGFjZW1lbnRzLCBhcnJvd1BvaW50QXRDZW50ZXIsIGF1dG9BZGp1c3RPdmVyZmxvdyB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKFxuICAgICAgYnVpbHRpblBsYWNlbWVudHMgfHxcbiAgICAgIGdldFBsYWNlbWVudHMoe1xuICAgICAgICBhcnJvd1BvaW50QXRDZW50ZXIsXG4gICAgICAgIHZlcnRpY2FsQXJyb3dTaGlmdDogOCxcbiAgICAgICAgYXV0b0FkanVzdE92ZXJmbG93LFxuICAgICAgfSlcbiAgICApO1xuICB9XG5cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgcHJlZml4Q2xzLFxuICAgICAgcG9wdXBDb250ZW50LFxuICAgICAgcHJvcHM6IHsgY2hpbGRyZW4sIHBsYWNlbWVudCwgb25IaWRkZW5DaGFuZ2UsIHRyaWdnZXIsIGRlZmF1bHRIaWRkZW4sIGhpZGRlbiwgLi4ucmVzdFByb3BzIH0sXG4gICAgfSA9IHRoaXM7XG4gICAgY29uc3QgY2hpbGQgPSBDaGlsZHJlbi5tYXAoY2hpbGRyZW4sIG5vZGUgPT4ge1xuICAgICAgbm9kZSA9IGdldERpc2FibGVkQ29tcGF0b2JsZUNoaWxkcmVuKFxuICAgICAgICBpc1ZhbGlkRWxlbWVudChub2RlKSA/IG5vZGUgOiA8c3BhbiBrZXk9e2B0ZXh0LSR7bm9kZX1gfT57bm9kZX08L3NwYW4+LFxuICAgICAgKVxuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfSk7XG5cbiAgICBjb25zdCBleHRyYVByb3BzOiBUcmlnZ2VyUHJvcHMgPSB7IC4uLnJlc3RQcm9wcyB9O1xuICAgIGlmICgnaGlkZGVuJyBpbiB0aGlzLnByb3BzKSB7XG4gICAgICBleHRyYVByb3BzLnBvcHVwSGlkZGVuID0gaGlkZGVuO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8VHJpZ2dlclxuICAgICAgICBwcmVmaXhDbHM9e3ByZWZpeENsc31cbiAgICAgICAgYWN0aW9uPXt0cmlnZ2VyfVxuICAgICAgICBidWlsdGluUGxhY2VtZW50cz17dGhpcy5wbGFjZW1lbnRzfVxuICAgICAgICBwb3B1cFBsYWNlbWVudD17cGxhY2VtZW50fVxuICAgICAgICBwb3B1cENvbnRlbnQ9e3BvcHVwQ29udGVudH1cbiAgICAgICAgb25Qb3B1cEhpZGRlbkNoYW5nZT17b25IaWRkZW5DaGFuZ2V9XG4gICAgICAgIGRlZmF1bHRQb3B1cEhpZGRlbj17ZGVmYXVsdEhpZGRlbn1cbiAgICAgICAgey4uLmV4dHJhUHJvcHN9XG4gICAgICA+XG4gICAgICAgIHtjaGlsZH1cbiAgICAgIDwvVHJpZ2dlcj5cbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=