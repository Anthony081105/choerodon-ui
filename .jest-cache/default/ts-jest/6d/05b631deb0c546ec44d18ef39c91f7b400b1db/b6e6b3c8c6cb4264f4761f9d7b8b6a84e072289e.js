import React, { Children, Component, } from 'react';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import omit from 'lodash/omit';
import Icon from '../icon';
import Ripple from '../ripple';
import { getPrefixCls } from '../configure';
import Progress from '../progress';
export default class Button extends Component {
    constructor(props) {
        super(props);
        this.handleClick = e => {
            clearTimeout(this.timeout);
            this.timeout = window.setTimeout(() => this.setState({ clicked: false }), 500);
            const { onClick } = this.props;
            if (onClick) {
                onClick(e);
            }
        };
        this.state = {
            loading: props.loading,
            clicked: false,
        };
    }
    componentWillReceiveProps(nextProps) {
        const { loading: currentLoading } = this.props;
        const { loading } = nextProps;
        if (currentLoading) {
            clearTimeout(this.delayTimeout);
        }
        if (typeof loading !== 'boolean' && loading && loading.delay) {
            this.delayTimeout = window.setTimeout(() => this.setState({ loading }), loading.delay);
        }
        else {
            this.setState({ loading });
        }
    }
    componentWillUnmount() {
        if (this.timeout) {
            clearTimeout(this.timeout);
        }
        if (this.delayTimeout) {
            clearTimeout(this.delayTimeout);
        }
    }
    render() {
        const { prefixCls: customizePrefixCls, type, shape, size, className, htmlType, children, icon, ghost, funcType, ...others } = this.props;
        const { loading, clicked } = this.state;
        const prefixCls = getPrefixCls('btn', customizePrefixCls);
        // large => lg
        // small => sm
        let sizeCls = '';
        switch (size) {
            case "large" /* large */:
                sizeCls = 'lg';
                break;
            case "small" /* small */:
                sizeCls = 'sm';
                break;
            default:
        }
        const ComponentProp = others.href ? 'a' : 'button';
        const classes = classNames(prefixCls, className, {
            [`${prefixCls}-${type}`]: type,
            [`${prefixCls}-${shape}`]: shape,
            [`${prefixCls}-${sizeCls}`]: sizeCls,
            [`${prefixCls}-icon-only`]: !children && icon,
            [`${prefixCls}-loading`]: loading,
            [`${prefixCls}-clicked`]: clicked,
            [`${prefixCls}-background-ghost`]: ghost,
            [`${prefixCls}-${funcType}`]: funcType,
        });
        let iconNode = icon ? React.createElement(Icon, { type: icon }) : null;
        iconNode = loading ? (React.createElement(Progress, { key: "loading", type: "loading" /* loading */, size: "small" /* small */ })) : (iconNode);
        const kids = children || children === 0
            ? Children.map(children, child => {
                if (typeof child === 'string') {
                    return React.createElement("span", null, child);
                }
                return child;
            })
            : null;
        return (React.createElement(Ripple, { disabled: others.disabled },
            React.createElement(ComponentProp, Object.assign({}, omit(others, ['loading']), { 
                // 如果没有href属性，则表示组件使用button标签，type为'submit' | 'reset' | 'button'
                type: others.href ? undefined : htmlType || 'button', className: classes, onClick: this.handleClick }),
                iconNode,
                kids)));
    }
}
Button.displayName = 'Button';
Button.__ANT_BUTTON = true;
Button.defaultProps = {
    loading: false,
    ghost: false,
    funcType: 'flat',
};
Button.propTypes = {
    type: PropTypes.string,
    shape: PropTypes.oneOf(['circle', 'circle-outline']),
    size: PropTypes.oneOf(["large" /* large */, "default" /* default */, "small" /* small */]),
    htmlType: PropTypes.oneOf(['submit', 'button', 'reset']),
    onClick: PropTypes.func,
    loading: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),
    className: PropTypes.string,
    icon: PropTypes.string,
    ghost: PropTypes.bool,
    funcType: PropTypes.oneOf(['raised', 'flat']),
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvYnV0dG9uL0J1dHRvbi50c3giLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFDWixRQUFRLEVBQ1IsU0FBUyxHQU1WLE1BQU0sT0FBTyxDQUFDO0FBQ2YsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFDO0FBQ25DLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQUNwQyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFDO0FBRTNCLE9BQU8sTUFBTSxNQUFNLFdBQVcsQ0FBQztBQUUvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRTVDLE9BQU8sUUFBUSxNQUFNLGFBQWEsQ0FBQztBQThCbkMsTUFBTSxDQUFDLE9BQU8sT0FBTyxNQUFPLFNBQVEsU0FBMkI7SUE4QjdELFlBQVksS0FBa0I7UUFDNUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBK0JmLGdCQUFXLEdBQTZELENBQUMsQ0FBQyxFQUFFO1lBQzFFLFlBQVksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUUvRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMvQixJQUFJLE9BQU8sRUFBRTtnQkFDWCxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDWjtRQUNILENBQUMsQ0FBQztRQXRDQSxJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1gsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO1lBQ3RCLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQztJQUNKLENBQUM7SUFF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QyxDQUFDO0lBQ3BELElBQUksRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLG1FQUFzQyxDQUFDO0lBQzdELFFBQVEsRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN4RCxPQUFPLEVBQUUsU0FBUyxDQUFDLElBQUk7SUFDdkIsT0FBTyxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNoRSxTQUFTLEVBQUUsU0FBUyxDQUFDLE1BQU07SUFDM0IsSUFBSSxFQUFFLFNBQVMsQ0FBQyxNQUFNO0lBQ3RCLEtBQUssRUFBRSxTQUFTLENBQUMsSUFBSTtJQUNyQixRQUFRLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztDQUM5QyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9odWlodWF3ay9Eb2N1bWVudHMvb3B0L2Nob2Vyb2Rvbi11aS9jb21wb25lbnRzL2J1dHRvbi9CdXR0b24udHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xuICBDaGlsZHJlbixcbiAgQ29tcG9uZW50LFxuICBDU1NQcm9wZXJ0aWVzLFxuICBGb3JtRXZlbnRIYW5kbGVyLFxuICBLZXlib2FyZEV2ZW50SGFuZGxlcixcbiAgQnV0dG9uSFRNTEF0dHJpYnV0ZXMsXG4gIE1vdXNlRXZlbnRIYW5kbGVyLFxufSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgb21pdCBmcm9tICdsb2Rhc2gvb21pdCc7XG5pbXBvcnQgSWNvbiBmcm9tICcuLi9pY29uJztcbmltcG9ydCBHcm91cCBmcm9tICcuL0J1dHRvbkdyb3VwJztcbmltcG9ydCBSaXBwbGUgZnJvbSAnLi4vcmlwcGxlJztcbmltcG9ydCB7IFNpemUgfSBmcm9tICcuLi9fdXRpbC9lbnVtJztcbmltcG9ydCB7IGdldFByZWZpeENscyB9IGZyb20gJy4uL2NvbmZpZ3VyZSc7XG5pbXBvcnQgeyBQcm9ncmVzc1R5cGUgfSBmcm9tICcuLi9wcm9ncmVzcy9lbnVtJztcbmltcG9ydCBQcm9ncmVzcyBmcm9tICcuLi9wcm9ncmVzcyc7XG5cbmV4cG9ydCB0eXBlIEJ1dHRvblR5cGUgPSAncHJpbWFyeScgfCAnZ2hvc3QnIHwgJ2Rhc2hlZCcgfCAnZGFuZ2VyJztcbmV4cG9ydCB0eXBlIEJ1dHRvblNoYXBlID0gJ2NpcmNsZScgfCAnY2lyY2xlLW91dGxpbmUnO1xuZXhwb3J0IHR5cGUgQnV0dG9uRnVuY1R5cGUgPSAncmFpc2VkJyB8ICdmbGF0JztcblxuZXhwb3J0IGludGVyZmFjZSBCdXR0b25Qcm9wcyB7XG4gIHR5cGU/OiBCdXR0b25UeXBlO1xuICBodG1sVHlwZT86IHN0cmluZztcbiAgaWNvbj86IHN0cmluZztcbiAgc2hhcGU/OiBCdXR0b25TaGFwZTtcbiAgc2l6ZT86IFNpemU7XG4gIG9uQ2xpY2s/OiBGb3JtRXZlbnRIYW5kbGVyPGFueT47XG4gIG9uTW91c2VVcD86IEZvcm1FdmVudEhhbmRsZXI8YW55PjtcbiAgb25Nb3VzZURvd24/OiBGb3JtRXZlbnRIYW5kbGVyPGFueT47XG4gIG9uS2V5UHJlc3M/OiBLZXlib2FyZEV2ZW50SGFuZGxlcjxhbnk+O1xuICBvbktleURvd24/OiBLZXlib2FyZEV2ZW50SGFuZGxlcjxhbnk+O1xuICB0YWJJbmRleD86IG51bWJlcjtcbiAgbG9hZGluZz86IGJvb2xlYW4gfCB7IGRlbGF5PzogbnVtYmVyIH07XG4gIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgc3R5bGU/OiBDU1NQcm9wZXJ0aWVzO1xuICBwcmVmaXhDbHM/OiBzdHJpbmc7XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbiAgZ2hvc3Q/OiBib29sZWFuO1xuICB0YXJnZXQ/OiBzdHJpbmc7XG4gIGhyZWY/OiBzdHJpbmc7XG4gIGRvd25sb2FkPzogc3RyaW5nO1xuICBmdW5jVHlwZT86IEJ1dHRvbkZ1bmNUeXBlO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCdXR0b24gZXh0ZW5kcyBDb21wb25lbnQ8QnV0dG9uUHJvcHMsIGFueT4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnQnV0dG9uJztcblxuICBzdGF0aWMgR3JvdXA6IHR5cGVvZiBHcm91cDtcblxuICBzdGF0aWMgX19BTlRfQlVUVE9OID0gdHJ1ZTtcblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgIGdob3N0OiBmYWxzZSxcbiAgICBmdW5jVHlwZTogJ2ZsYXQnLFxuICB9O1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgdHlwZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBzaGFwZTogUHJvcFR5cGVzLm9uZU9mKFsnY2lyY2xlJywgJ2NpcmNsZS1vdXRsaW5lJ10pLFxuICAgIHNpemU6IFByb3BUeXBlcy5vbmVPZihbU2l6ZS5sYXJnZSwgU2l6ZS5kZWZhdWx0LCBTaXplLnNtYWxsXSksXG4gICAgaHRtbFR5cGU6IFByb3BUeXBlcy5vbmVPZihbJ3N1Ym1pdCcsICdidXR0b24nLCAncmVzZXQnXSksXG4gICAgb25DbGljazogUHJvcFR5cGVzLmZ1bmMsXG4gICAgbG9hZGluZzogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmJvb2wsIFByb3BUeXBlcy5vYmplY3RdKSxcbiAgICBjbGFzc05hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgaWNvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBnaG9zdDogUHJvcFR5cGVzLmJvb2wsXG4gICAgZnVuY1R5cGU6IFByb3BUeXBlcy5vbmVPZihbJ3JhaXNlZCcsICdmbGF0J10pLFxuICB9O1xuXG4gIHRpbWVvdXQ6IG51bWJlcjtcblxuICBkZWxheVRpbWVvdXQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogQnV0dG9uUHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGxvYWRpbmc6IHByb3BzLmxvYWRpbmcsXG4gICAgICBjbGlja2VkOiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHM6IEJ1dHRvblByb3BzKSB7XG4gICAgY29uc3QgeyBsb2FkaW5nOiBjdXJyZW50TG9hZGluZyB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGxvYWRpbmcgfSA9IG5leHRQcm9wcztcblxuICAgIGlmIChjdXJyZW50TG9hZGluZykge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZGVsYXlUaW1lb3V0KTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGxvYWRpbmcgIT09ICdib29sZWFuJyAmJiBsb2FkaW5nICYmIGxvYWRpbmcuZGVsYXkpIHtcbiAgICAgIHRoaXMuZGVsYXlUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmcgfSksIGxvYWRpbmcuZGVsYXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGluZyB9KTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBpZiAodGhpcy50aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZGVsYXlUaW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5kZWxheVRpbWVvdXQpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUNsaWNrOiBNb3VzZUV2ZW50SGFuZGxlcjxIVE1MQnV0dG9uRWxlbWVudCB8IEhUTUxBbmNob3JFbGVtZW50PiA9IGUgPT4ge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xuICAgIHRoaXMudGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHRoaXMuc2V0U3RhdGUoeyBjbGlja2VkOiBmYWxzZSB9KSwgNTAwKTtcblxuICAgIGNvbnN0IHsgb25DbGljayB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAob25DbGljaykge1xuICAgICAgb25DbGljayhlKTtcbiAgICB9XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIHByZWZpeENsczogY3VzdG9taXplUHJlZml4Q2xzLFxuICAgICAgdHlwZSxcbiAgICAgIHNoYXBlLFxuICAgICAgc2l6ZSxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGh0bWxUeXBlLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICBpY29uLFxuICAgICAgZ2hvc3QsXG4gICAgICBmdW5jVHlwZSxcbiAgICAgIC4uLm90aGVyc1xuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgY29uc3QgeyBsb2FkaW5nLCBjbGlja2VkIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgY29uc3QgcHJlZml4Q2xzID0gZ2V0UHJlZml4Q2xzKCdidG4nLCBjdXN0b21pemVQcmVmaXhDbHMpO1xuXG4gICAgLy8gbGFyZ2UgPT4gbGdcbiAgICAvLyBzbWFsbCA9PiBzbVxuICAgIGxldCBzaXplQ2xzID0gJyc7XG4gICAgc3dpdGNoIChzaXplKSB7XG4gICAgICBjYXNlIFNpemUubGFyZ2U6XG4gICAgICAgIHNpemVDbHMgPSAnbGcnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU2l6ZS5zbWFsbDpcbiAgICAgICAgc2l6ZUNscyA9ICdzbSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICB9XG5cbiAgICBjb25zdCBDb21wb25lbnRQcm9wID0gb3RoZXJzLmhyZWYgPyAnYScgOiAnYnV0dG9uJztcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjbGFzc05hbWVzKHByZWZpeENscywgY2xhc3NOYW1lLCB7XG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke3R5cGV9YF06IHR5cGUsXG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke3NoYXBlfWBdOiBzaGFwZSxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LSR7c2l6ZUNsc31gXTogc2l6ZUNscyxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWljb24tb25seWBdOiAhY2hpbGRyZW4gJiYgaWNvbixcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWxvYWRpbmdgXTogbG9hZGluZyxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWNsaWNrZWRgXTogY2xpY2tlZCxcbiAgICAgIFtgJHtwcmVmaXhDbHN9LWJhY2tncm91bmQtZ2hvc3RgXTogZ2hvc3QsXG4gICAgICBbYCR7cHJlZml4Q2xzfS0ke2Z1bmNUeXBlfWBdOiBmdW5jVHlwZSxcbiAgICB9KTtcblxuICAgIGxldCBpY29uTm9kZTogYW55ID0gaWNvbiA/IDxJY29uIHR5cGU9e2ljb259IC8+IDogbnVsbDtcbiAgICBpY29uTm9kZSA9IGxvYWRpbmcgPyAoXG4gICAgICA8UHJvZ3Jlc3Mga2V5PVwibG9hZGluZ1wiIHR5cGU9e1Byb2dyZXNzVHlwZS5sb2FkaW5nfSBzaXplPXtTaXplLnNtYWxsfSAvPlxuICAgICkgOiAoXG4gICAgICBpY29uTm9kZVxuICAgICk7XG4gICAgY29uc3Qga2lkcyA9XG4gICAgICBjaGlsZHJlbiB8fCBjaGlsZHJlbiA9PT0gMFxuICAgICAgICA/IENoaWxkcmVuLm1hcChjaGlsZHJlbiwgY2hpbGQgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIDxzcGFuPntjaGlsZH08L3NwYW4+O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgICAgIH0pXG4gICAgICAgIDogbnVsbDtcblxuICAgIHJldHVybiAoXG4gICAgICA8UmlwcGxlIGRpc2FibGVkPXtvdGhlcnMuZGlzYWJsZWR9PlxuICAgICAgICA8Q29tcG9uZW50UHJvcFxuICAgICAgICAgIHsuLi5vbWl0KG90aGVycywgWydsb2FkaW5nJ10pfVxuICAgICAgICAgIC8vIOWmguaenOayoeaciWhyZWblsZ7mgKfvvIzliJnooajnpLrnu4Tku7bkvb/nlKhidXR0b27moIfnrb7vvIx0eXBl5Li6J3N1Ym1pdCcgfCAncmVzZXQnIHwgJ2J1dHRvbidcbiAgICAgICAgICB0eXBlPXtcbiAgICAgICAgICAgIG90aGVycy5ocmVmID8gdW5kZWZpbmVkIDogKGh0bWxUeXBlIGFzIEJ1dHRvbkhUTUxBdHRyaWJ1dGVzPGFueT5bJ3R5cGUnXSkgfHwgJ2J1dHRvbidcbiAgICAgICAgICB9XG4gICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzfVxuICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlQ2xpY2t9XG4gICAgICAgID5cbiAgICAgICAgICB7aWNvbk5vZGV9XG4gICAgICAgICAge2tpZHN9XG4gICAgICAgIDwvQ29tcG9uZW50UHJvcD5cbiAgICAgIDwvUmlwcGxlPlxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==