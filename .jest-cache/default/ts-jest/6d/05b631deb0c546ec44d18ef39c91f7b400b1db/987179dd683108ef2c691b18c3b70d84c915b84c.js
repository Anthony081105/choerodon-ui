import React, { Component } from 'react';
import classNames from 'classnames';
import omit from 'lodash/omit';
import { icons } from 'choerodon-ui-font';
import Icon from '../icon';
import Select from '../select';
import Pagination from '../pagination';
import Tooltip from '../tooltip';
import { getPrefixCls } from '../configure';
const Option = Select.Option;
export default class IconSelect extends Component {
    constructor(props) {
        super(props);
        this.handleRender = (label) => {
            if (typeof label === 'string' && label) {
                return (React.createElement("span", null,
                    React.createElement(Icon, { type: label }),
                    " ",
                    label));
            }
            if (typeof label === 'object' && label.props) {
                const { children } = label.props;
                return children ? React.createElement("span", null, children) : null;
            }
            return null;
        };
        this.handlePageChange = (current, pageSize) => {
            const { filterValue } = this.state;
            this.initIcon(current, pageSize, filterValue);
        };
        this.handleFilter = (value) => {
            this.initIcon(1, 20, value);
        };
        this.saveRef = (node) => {
            if (node) {
                this.rcSelect = node;
            }
        };
        this.state = {
            current: 1,
            total: 0,
            pageSize: 20,
            filterValue: '',
            data: [],
        };
    }
    componentDidMount() {
        this.initIcon();
    }
    initIcon(current = 1, pageSize = 20, filterValue = '') {
        const { showAll } = this.props;
        const minIndex = (current - 1) * pageSize;
        const maxIndex = current * pageSize;
        let items;
        if (showAll) {
            items = icons.default;
            if (filterValue) {
                items = icons.favorite.filter(name => {
                    return name.toLowerCase().indexOf(filterValue.toLowerCase()) !== -1;
                });
            }
        }
        else {
            items = icons.favorite;
            if (filterValue) {
                items = icons.favorite.filter(name => {
                    return name.toLowerCase().indexOf(filterValue.toLowerCase()) !== -1;
                });
            }
        }
        const total = items.length || 0;
        const currentData = items.filter((name, index) => {
            return name && index >= minIndex && index < maxIndex;
        });
        this.setState({
            data: currentData,
            total,
            pageSize,
            current,
            filterValue,
        });
    }
    renderOption() {
        const { data } = this.state;
        return data.map((icon) => {
            return (React.createElement(Option, { key: icon, value: icon },
                React.createElement(Tooltip, { placement: "bottomLeft", title: icon },
                    React.createElement(Icon, { type: icon }),
                    React.createElement("span", { className: "text" }, icon))));
        });
    }
    renderFooter() {
        const { total, pageSize, current } = this.state;
        return (React.createElement(Pagination, { total: total, onChange: this.handlePageChange, pageSizeOptions: ['20', '40', '80'], pageSize: pageSize, onShowSizeChange: this.handlePageChange, current: current }));
    }
    render() {
        const { className, prefixCls: customizePrefixCls, dropdownClassName } = this.props;
        const { filterValue } = this.state;
        const prefixCls = getPrefixCls('icon-select', customizePrefixCls);
        const selectCls = classNames(className, prefixCls);
        const dropDownCls = classNames(dropdownClassName, `${prefixCls}-dropdown`);
        const selectProps = {
            ...this.props,
            className: selectCls,
            dropdownClassName: dropDownCls,
        };
        const otherProps = omit(selectProps, ['prefixCls']);
        return (React.createElement(Select, Object.assign({}, otherProps, { footer: this.renderFooter(), onFilterChange: this.handleFilter, filterValue: filterValue, choiceRender: this.handleRender, filter: true, ref: this.saveRef }), this.renderOption()));
    }
}
IconSelect.displayName = 'IconSelect';
IconSelect.defaultProps = {
    filter: true,
    showArrow: false,
    showCheckAll: false,
    showAll: false,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvaWNvbi1zZWxlY3QvSWNvblNlbGVjdC50c3giLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFBRSxTQUFTLEVBQTJCLE1BQU0sT0FBTyxDQUFDO0FBQ2xFLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQztBQUNwQyxPQUFPLElBQUksTUFBTSxhQUFhLENBQUM7QUFDL0IsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzFDLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLE1BQXVCLE1BQU0sV0FBVyxDQUFDO0FBQ2hELE9BQU8sVUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN2QyxPQUFPLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFDakMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUU1QyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO0FBZTdCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sVUFBVyxTQUFRLFNBQTJDO0lBY2pGLFlBQVksS0FBc0I7UUFDaEMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBNkRmLGlCQUFZLEdBQUcsQ0FBQyxLQUF3QixFQUFFLEVBQUU7WUFDMUMsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksS0FBSyxFQUFFO2dCQUN0QyxPQUFPLENBQ0w7b0JBQ0Usb0JBQUMsSUFBSSxJQUFDLElBQUksRUFBRSxLQUFLLEdBQUk7O29CQUFFLEtBQUssQ0FDdkIsQ0FDUixDQUFDO2FBQ0g7WUFDRCxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsSUFBSSxLQUFLLENBQUMsS0FBSyxFQUFFO2dCQUM1QyxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztnQkFDakMsT0FBTyxRQUFRLENBQUMsQ0FBQyxDQUFDLGtDQUFPLFFBQVEsQ0FBUSxDQUFDLENBQUMsQ0FB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LFNBQVMsV0FBVyxDQUFDLENBQUM7UUFDM0UsTUFBTSxXQUFXLEdBQUc7WUFDbEIsR0FBRyxJQUFJLENBQUMsS0FBSztZQUNiLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLGlCQUFpQixFQUFFLFdBQVc7U0FDL0IsQ0FBQztRQUNGLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sQ0FDTCxvQkFBQyxNQUFNLG9CQUNELFVBQVUsSUFDZCxNQUFNLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxFQUMzQixjQUFjLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFDakMsV0FBVyxFQUFFLFdBQVcsRUFDeEIsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQy9CLE1BQU0sUUFDTixHQUFHLEVBQUUsSUFBSSxDQUFDLE9BQU8sS0FFaEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUNiLENBQ1YsQ0FBQztJQUNKLENBQUM7O0FBaEpNLHNCQUFXLEdBQUcsWUFBWSxDQUFDO0FBRTNCLHVCQUFZLEdBQUc7SUFDcEIsTUFBTSxFQUFFLElBQUk7SUFDWixTQUFTLEVBQUUsS0FBSztJQUNoQixZQUFZLEVBQUUsS0FBSztJQUNuQixPQUFPLEVBQUUsS0FBSztDQUNmLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2h1aWh1YXdrL0RvY3VtZW50cy9vcHQvY2hvZXJvZG9uLXVpL2NvbXBvbmVudHMvaWNvbi1zZWxlY3QvSWNvblNlbGVjdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUmVhY3RFbGVtZW50LCBSZWFjdE5vZGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tICdjbGFzc25hbWVzJztcbmltcG9ydCBvbWl0IGZyb20gJ2xvZGFzaC9vbWl0JztcbmltcG9ydCB7IGljb25zIH0gZnJvbSAnY2hvZXJvZG9uLXVpLWZvbnQnO1xuaW1wb3J0IEljb24gZnJvbSAnLi4vaWNvbic7XG5pbXBvcnQgU2VsZWN0LCB7IFNlbGVjdFByb3BzIH0gZnJvbSAnLi4vc2VsZWN0JztcbmltcG9ydCBQYWdpbmF0aW9uIGZyb20gJy4uL3BhZ2luYXRpb24nO1xuaW1wb3J0IFRvb2x0aXAgZnJvbSAnLi4vdG9vbHRpcCc7XG5pbXBvcnQgeyBnZXRQcmVmaXhDbHMgfSBmcm9tICcuLi9jb25maWd1cmUnO1xuXG5jb25zdCBPcHRpb24gPSBTZWxlY3QuT3B0aW9uO1xuXG5leHBvcnQgaW50ZXJmYWNlIEljb25TZWxlY3RQcm9wcyBleHRlbmRzIFNlbGVjdFByb3BzIHtcbiAgcHJlZml4Q2xzPzogc3RyaW5nO1xuICBzaG93QWxsPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJY29uU2VsZWN0U3RhdGUge1xuICBjdXJyZW50OiBudW1iZXI7XG4gIHRvdGFsOiBudW1iZXI7XG4gIHBhZ2VTaXplOiBudW1iZXI7XG4gIGZpbHRlclZhbHVlOiBzdHJpbmc7XG4gIGRhdGE6IGFueTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSWNvblNlbGVjdCBleHRlbmRzIENvbXBvbmVudDxJY29uU2VsZWN0UHJvcHMsIEljb25TZWxlY3RTdGF0ZT4ge1xuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnSWNvblNlbGVjdCc7XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBmaWx0ZXI6IHRydWUsXG4gICAgc2hvd0Fycm93OiBmYWxzZSxcbiAgICBzaG93Q2hlY2tBbGw6IGZhbHNlLFxuICAgIHNob3dBbGw6IGZhbHNlLFxuICB9O1xuXG4gIGljb25zOiBhbnk7XG5cbiAgcmNTZWxlY3Q6IFJlYWN0Tm9kZSB8IG51bGw7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IEljb25TZWxlY3RQcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgY3VycmVudDogMSxcbiAgICAgIHRvdGFsOiAwLFxuICAgICAgcGFnZVNpemU6IDIwLFxuICAgICAgZmlsdGVyVmFsdWU6ICcnLFxuICAgICAgZGF0YTogW10sXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuaW5pdEljb24oKTtcbiAgfVxuXG4gIGluaXRJY29uKGN1cnJlbnQ6IG51bWJlciA9IDEsIHBhZ2VTaXplOiBudW1iZXIgPSAyMCwgZmlsdGVyVmFsdWU6IHN0cmluZyA9ICcnKSB7XG4gICAgY29uc3QgeyBzaG93QWxsIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IG1pbkluZGV4ID0gKGN1cnJlbnQgLSAxKSAqIHBhZ2VTaXplO1xuICAgIGNvbnN0IG1heEluZGV4ID0gY3VycmVudCAqIHBhZ2VTaXplO1xuICAgIGxldCBpdGVtcztcbiAgICBpZiAoc2hvd0FsbCkge1xuICAgICAgaXRlbXMgPSBpY29ucy5kZWZhdWx0O1xuICAgICAgaWYgKGZpbHRlclZhbHVlKSB7XG4gICAgICAgIGl0ZW1zID0gaWNvbnMuZmF2b3JpdGUuZmlsdGVyKG5hbWUgPT4ge1xuICAgICAgICAgIHJldHVybiBuYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpKSAhPT0gLTE7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpdGVtcyA9IGljb25zLmZhdm9yaXRlO1xuICAgICAgaWYgKGZpbHRlclZhbHVlKSB7XG4gICAgICAgIGl0ZW1zID0gaWNvbnMuZmF2b3JpdGUuZmlsdGVyKG5hbWUgPT4ge1xuICAgICAgICAgIHJldHVybiBuYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpKSAhPT0gLTE7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCB0b3RhbCA9IGl0ZW1zLmxlbmd0aCB8fCAwO1xuICAgIGNvbnN0IGN1cnJlbnREYXRhID0gaXRlbXMuZmlsdGVyKChuYW1lLCBpbmRleCkgPT4ge1xuICAgICAgcmV0dXJuIG5hbWUgJiYgaW5kZXggPj0gbWluSW5kZXggJiYgaW5kZXggPCBtYXhJbmRleDtcbiAgICB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGRhdGE6IGN1cnJlbnREYXRhLFxuICAgICAgdG90YWwsXG4gICAgICBwYWdlU2l6ZSxcbiAgICAgIGN1cnJlbnQsXG4gICAgICBmaWx0ZXJWYWx1ZSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlck9wdGlvbigpIHtcbiAgICBjb25zdCB7IGRhdGEgfSA9IHRoaXMuc3RhdGU7XG4gICAgcmV0dXJuIGRhdGEubWFwKChpY29uOiBzdHJpbmcpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxPcHRpb24ga2V5PXtpY29ufSB2YWx1ZT17aWNvbn0+XG4gICAgICAgICAgPFRvb2x0aXAgcGxhY2VtZW50PVwiYm90dG9tTGVmdFwiIHRpdGxlPXtpY29ufT5cbiAgICAgICAgICAgIDxJY29uIHR5cGU9e2ljb259IC8+XG4gICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0ZXh0XCI+e2ljb259PC9zcGFuPlxuICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgPC9PcHRpb24+XG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlUmVuZGVyID0gKGxhYmVsOiBSZWFjdEVsZW1lbnQ8YW55PikgPT4ge1xuICAgIGlmICh0eXBlb2YgbGFiZWwgPT09ICdzdHJpbmcnICYmIGxhYmVsKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8c3Bhbj5cbiAgICAgICAgICA8SWNvbiB0eXBlPXtsYWJlbH0gLz4ge2xhYmVsfVxuICAgICAgICA8L3NwYW4+XG4gICAgICApO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGxhYmVsID09PSAnb2JqZWN0JyAmJiBsYWJlbC5wcm9wcykge1xuICAgICAgY29uc3QgeyBjaGlsZHJlbiB9ID0gbGFiZWwucHJvcHM7XG4gICAgICByZXR1cm4gY2hpbGRyZW4gPyA8c3Bhbj57Y2hpbGRyZW59PC9zcGFuPiA6IG51bGw7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIGhhbmRsZVBhZ2VDaGFuZ2UgPSAoY3VycmVudDogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgeyBmaWx0ZXJWYWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICB0aGlzLmluaXRJY29uKGN1cnJlbnQsIHBhZ2VTaXplLCBmaWx0ZXJWYWx1ZSk7XG4gIH07XG5cbiAgaGFuZGxlRmlsdGVyID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICB0aGlzLmluaXRJY29uKDEsIDIwLCB2YWx1ZSk7XG4gIH07XG5cbiAgc2F2ZVJlZiA9IChub2RlOiBSZWFjdE5vZGUpID0+IHtcbiAgICBpZiAobm9kZSkge1xuICAgICAgdGhpcy5yY1NlbGVjdCA9IG5vZGU7XG4gICAgfVxuICB9O1xuXG4gIHJlbmRlckZvb3RlcigpIHtcbiAgICBjb25zdCB7IHRvdGFsLCBwYWdlU2l6ZSwgY3VycmVudCB9ID0gdGhpcy5zdGF0ZTtcbiAgICByZXR1cm4gKFxuICAgICAgPFBhZ2luYXRpb25cbiAgICAgICAgdG90YWw9e3RvdGFsfVxuICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVQYWdlQ2hhbmdlfVxuICAgICAgICBwYWdlU2l6ZU9wdGlvbnM9e1snMjAnLCAnNDAnLCAnODAnXX1cbiAgICAgICAgcGFnZVNpemU9e3BhZ2VTaXplfVxuICAgICAgICBvblNob3dTaXplQ2hhbmdlPXt0aGlzLmhhbmRsZVBhZ2VDaGFuZ2V9XG4gICAgICAgIGN1cnJlbnQ9e2N1cnJlbnR9XG4gICAgICAvPlxuICAgICk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBjbGFzc05hbWUsIHByZWZpeENsczogY3VzdG9taXplUHJlZml4Q2xzLCBkcm9wZG93bkNsYXNzTmFtZSB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGZpbHRlclZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHByZWZpeENscyA9IGdldFByZWZpeENscygnaWNvbi1zZWxlY3QnLCBjdXN0b21pemVQcmVmaXhDbHMpO1xuICAgIGNvbnN0IHNlbGVjdENscyA9IGNsYXNzTmFtZXMoY2xhc3NOYW1lLCBwcmVmaXhDbHMpO1xuICAgIGNvbnN0IGRyb3BEb3duQ2xzID0gY2xhc3NOYW1lcyhkcm9wZG93bkNsYXNzTmFtZSwgYCR7cHJlZml4Q2xzfS1kcm9wZG93bmApO1xuICAgIGNvbnN0IHNlbGVjdFByb3BzID0ge1xuICAgICAgLi4udGhpcy5wcm9wcyxcbiAgICAgIGNsYXNzTmFtZTogc2VsZWN0Q2xzLFxuICAgICAgZHJvcGRvd25DbGFzc05hbWU6IGRyb3BEb3duQ2xzLFxuICAgIH07XG4gICAgY29uc3Qgb3RoZXJQcm9wcyA9IG9taXQoc2VsZWN0UHJvcHMsIFsncHJlZml4Q2xzJ10pO1xuICAgIHJldHVybiAoXG4gICAgICA8U2VsZWN0XG4gICAgICAgIHsuLi5vdGhlclByb3BzfVxuICAgICAgICBmb290ZXI9e3RoaXMucmVuZGVyRm9vdGVyKCl9XG4gICAgICAgIG9uRmlsdGVyQ2hhbmdlPXt0aGlzLmhhbmRsZUZpbHRlcn1cbiAgICAgICAgZmlsdGVyVmFsdWU9e2ZpbHRlclZhbHVlfVxuICAgICAgICBjaG9pY2VSZW5kZXI9e3RoaXMuaGFuZGxlUmVuZGVyfVxuICAgICAgICBmaWx0ZXJcbiAgICAgICAgcmVmPXt0aGlzLnNhdmVSZWZ9XG4gICAgICA+XG4gICAgICAgIHt0aGlzLnJlbmRlck9wdGlvbigpfVxuICAgICAgPC9TZWxlY3Q+XG4gICAgKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9